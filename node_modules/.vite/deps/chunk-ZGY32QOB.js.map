{
  "version": 3,
  "sources": ["../../vscode-oniguruma/release/main.js", "../../vscode-textmate/release/webpack:/vscodetextmate/webpack/universalModuleDefinition", "../../vscode-textmate/release/webpack:/vscodetextmate/out/debug.js", "../../vscode-textmate/release/webpack:/vscodetextmate/out/encodedTokenAttributes.js", "../../vscode-textmate/release/webpack:/vscodetextmate/out/grammar/basicScopesAttributeProvider.js", "../../vscode-textmate/release/webpack:/vscodetextmate/out/grammar/grammar.js", "../../vscode-textmate/release/webpack:/vscodetextmate/out/grammar/grammarDependencies.js", "../../vscode-textmate/release/webpack:/vscodetextmate/out/grammar/index.js", "../../vscode-textmate/release/webpack:/vscodetextmate/out/grammar/tokenizeString.js", "../../vscode-textmate/release/webpack:/vscodetextmate/out/json.js", "../../vscode-textmate/release/webpack:/vscodetextmate/out/main.js", "../../vscode-textmate/release/webpack:/vscodetextmate/out/matcher.js", "../../vscode-textmate/release/webpack:/vscodetextmate/out/onigLib.js", "../../vscode-textmate/release/webpack:/vscodetextmate/out/parseRawGrammar.js", "../../vscode-textmate/release/webpack:/vscodetextmate/out/plist.js", "../../vscode-textmate/release/webpack:/vscodetextmate/out/registry.js", "../../vscode-textmate/release/webpack:/vscodetextmate/out/rule.js", "../../vscode-textmate/release/webpack:/vscodetextmate/out/theme.js", "../../vscode-textmate/release/webpack:/vscodetextmate/out/utils.js", "../../vscode-textmate/release/webpack:/vscodetextmate/webpack/bootstrap", "../../vscode-textmate/release/webpack:/vscodetextmate/webpack/startup", "browser-external:path", "browser-external:fs", "../../jszip/dist/jszip.min.js", "../../@blocksuite/blocks/src/components/button.ts", "../../@blocksuite/lit/src/width-disposable.ts", "../../@blocksuite/lit/src/element/shadowless-element.ts", "../../@blocksuite/lit/src/element/block-element.ts", "../../lit-html/src/static.ts", "../../@blocksuite/lit/src/event/base.ts", "../../@blocksuite/lit/src/event/state.ts", "../../@blocksuite/lit/src/event/keyboard.ts", "../../@blocksuite/lit/src/event/utils.ts", "../../@blocksuite/lit/src/event/pointer.ts", "../../@blocksuite/lit/src/event/dispatcher.ts", "../../@blocksuite/lit/src/element/lit-root.ts", "../../@blocksuite/blocks/src/components/tooltip/tooltip.ts", "../../@blocksuite/blocks/src/bookmark-block/images/icons.ts", "../../@popperjs/core/lib/enums.js", "../../@popperjs/core/lib/dom-utils/getNodeName.js", "../../@popperjs/core/lib/dom-utils/getWindow.js", "../../@popperjs/core/lib/dom-utils/instanceOf.js", "../../@popperjs/core/lib/modifiers/applyStyles.js", "../../@popperjs/core/lib/utils/getBasePlacement.js", "../../@popperjs/core/lib/utils/math.js", "../../@popperjs/core/lib/utils/userAgent.js", "../../@popperjs/core/lib/dom-utils/isLayoutViewport.js", "../../@popperjs/core/lib/dom-utils/getBoundingClientRect.js", "../../@popperjs/core/lib/dom-utils/getLayoutRect.js", "../../@popperjs/core/lib/dom-utils/contains.js", "../../@popperjs/core/lib/dom-utils/getComputedStyle.js", "../../@popperjs/core/lib/dom-utils/isTableElement.js", "../../@popperjs/core/lib/dom-utils/getDocumentElement.js", "../../@popperjs/core/lib/dom-utils/getParentNode.js", "../../@popperjs/core/lib/dom-utils/getOffsetParent.js", "../../@popperjs/core/lib/utils/getMainAxisFromPlacement.js", "../../@popperjs/core/lib/utils/within.js", "../../@popperjs/core/lib/utils/getFreshSideObject.js", "../../@popperjs/core/lib/utils/mergePaddingObject.js", "../../@popperjs/core/lib/utils/expandToHashMap.js", "../../@popperjs/core/lib/modifiers/arrow.js", "../../@popperjs/core/lib/utils/getVariation.js", "../../@popperjs/core/lib/modifiers/computeStyles.js", "../../@popperjs/core/lib/modifiers/eventListeners.js", "../../@popperjs/core/lib/utils/getOppositePlacement.js", "../../@popperjs/core/lib/utils/getOppositeVariationPlacement.js", "../../@popperjs/core/lib/dom-utils/getWindowScroll.js", "../../@popperjs/core/lib/dom-utils/getWindowScrollBarX.js", "../../@popperjs/core/lib/dom-utils/getViewportRect.js", "../../@popperjs/core/lib/dom-utils/getDocumentRect.js", "../../@popperjs/core/lib/dom-utils/isScrollParent.js", "../../@popperjs/core/lib/dom-utils/getScrollParent.js", "../../@popperjs/core/lib/dom-utils/listScrollParents.js", "../../@popperjs/core/lib/utils/rectToClientRect.js", "../../@popperjs/core/lib/dom-utils/getClippingRect.js", "../../@popperjs/core/lib/utils/computeOffsets.js", "../../@popperjs/core/lib/utils/detectOverflow.js", "../../@popperjs/core/lib/utils/computeAutoPlacement.js", "../../@popperjs/core/lib/modifiers/flip.js", "../../@popperjs/core/lib/modifiers/hide.js", "../../@popperjs/core/lib/modifiers/offset.js", "../../@popperjs/core/lib/modifiers/popperOffsets.js", "../../@popperjs/core/lib/utils/getAltAxis.js", "../../@popperjs/core/lib/modifiers/preventOverflow.js", "../../@popperjs/core/lib/dom-utils/getHTMLElementScroll.js", "../../@popperjs/core/lib/dom-utils/getNodeScroll.js", "../../@popperjs/core/lib/dom-utils/getCompositeRect.js", "../../@popperjs/core/lib/utils/orderModifiers.js", "../../@popperjs/core/lib/utils/debounce.js", "../../@popperjs/core/lib/utils/mergeByName.js", "../../@popperjs/core/lib/createPopper.js", "../../@popperjs/core/lib/popper-lite.js", "../../@popperjs/core/lib/popper.js", "../../@blocksuite/blocks/src/components/toast.ts", "../../@blocksuite/phasor/src/consts.ts", "../../@blocksuite/phasor/src/elements/connector/types.ts", "../../@blocksuite/phasor/src/perfect-freehand/getStrokeRadius.ts", "../../@blocksuite/phasor/src/perfect-freehand/vec.ts", "../../@blocksuite/phasor/src/perfect-freehand/getStrokeOutlinePoints.ts", "../../@blocksuite/phasor/src/perfect-freehand/getStrokePoints.ts", "../../@blocksuite/phasor/src/perfect-freehand/getStroke.ts", "../../@blocksuite/blocks/src/__internal__/utils/block-range.ts", "../../@blocksuite/blocks/src/__internal__/utils/drag-and-drop.ts", "../../@blocksuite/blocks/src/__internal__/utils/event.ts", "../../@blocksuite/blocks/src/__internal__/utils/filesys.ts", "../../hotkeys-js/dist/hotkeys.esm.js", "../../@blocksuite/blocks/src/__internal__/utils/hotkey.ts", "../../@blocksuite/blocks/src/__internal__/utils/reordering.ts", "../../@blocksuite/blocks/src/page-block/default/backlink-popover.ts", "../../@blocksuite/blocks/src/__internal__/utils/virgo.ts", "../../@blocksuite/blocks/src/components/format-quick-bar/button.ts", "../../@blocksuite/blocks/src/page-block/utils/position.ts", "../../@blocksuite/connector/src/heap.ts", "../../@blocksuite/connector/src/a-star.ts", "../../@blocksuite/connector/src/graph.ts", "../../@blocksuite/connector/src/create-graph/create-nodes.ts", "../../@blocksuite/connector/src/create-graph/create-rulers.ts", "../../@blocksuite/connector/src/create-graph/manual-generate-graph.ts", "../../@blocksuite/connector/src/create-graph/create-graph.ts", "../../@blocksuite/connector/src/rectangle.ts", "../../@blocksuite/connector/src/simplify-path.ts", "../../@blocksuite/connector/src/route.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/align-panel.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/color-panel.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/utils.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/component-toolbar/change-text-button.ts", "../../@blocksuite/blocks/src/__internal__/theme/css-variables.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/surface-text-editor.ts", "../../@blocksuite/blocks/src/page-block/edgeless/utils.ts", "../../html-to-image/src/util.ts", "../../html-to-image/src/clone-pseudos.ts", "../../html-to-image/src/mimes.ts", "../../html-to-image/src/dataurl.ts", "../../html-to-image/src/clone-node.ts", "../../html-to-image/src/embed-resources.ts", "../../html-to-image/src/embed-images.ts", "../../html-to-image/src/apply-style.ts", "../../html-to-image/src/embed-webfonts.ts", "../../html-to-image/src/index.ts", "../../marked/lib/marked.esm.js", "../../@blocksuite/blocks/src/__internal__/clipboard/clipboard-item.ts", "../../@blocksuite/blocks/src/__internal__/clipboard/utils/pure.ts", "../../turndown/lib/turndown.browser.es.js", "../../@blocksuite/blocks/src/__internal__/content-parser/file-exporter/exporter-style.ts", "../../@blocksuite/blocks/src/__internal__/content-parser/file-exporter/file-exporter.ts", "../../shiki/dist/index.esm.js", "../../@blocksuite/blocks/src/code-block/utils/consts.ts", "../../@blocksuite/blocks/src/code-block/utils/code-languages.ts", "../../@blocksuite/blocks/src/__internal__/content-parser/parse-html.ts", "../../@blocksuite/blocks/src/__internal__/content-parser/index.ts", "../../@blocksuite/blocks/src/__internal__/clipboard/utils/markdown.ts", "../../@blocksuite/blocks/src/__internal__/clipboard/utils/commons.ts", "../../@blocksuite/blocks/src/components/database-modal/styles.ts", "../../@blocksuite/blocks/src/components/database-modal/database-modal.ts", "../../@blocksuite/blocks/src/components/database-modal/index.ts", "../../@blocksuite/blocks/src/page-block/utils/const.ts", "../../@blocksuite/blocks/src/components/link-popover/styles.ts", "../../@blocksuite/blocks/src/components/link-popover/link-popover.ts", "../../@blocksuite/blocks/src/components/link-popover/create-link-popover.ts", "../../@blocksuite/blocks/src/__internal__/rich-text/virgo/affine-text.ts", "../../@blocksuite/blocks/src/__internal__/rich-text/link-node/affine-link.ts", "../../@blocksuite/blocks/src/__internal__/rich-text/link-node/mock-selection.ts", "../../@blocksuite/blocks/src/__internal__/rich-text/link-node/create-link.ts", "../../@blocksuite/blocks/src/page-block/utils/format-config.ts", "../../@blocksuite/blocks/src/components/format-quick-bar/styles.ts", "../../@blocksuite/blocks/src/components/format-quick-bar/format-bar-node.ts", "../../@blocksuite/blocks/src/components/format-quick-bar/index.ts", "../../@blocksuite/blocks/src/components/utils.ts", "../../@blocksuite/blocks/src/__internal__/rich-text/reference-node.ts", "../../lit-html/src/directives/class-map.ts", "../../@blocksuite/blocks/src/components/drag-handle.ts", "../../@blocksuite/blocks/src/components/block-hub.ts", "../../@blocksuite/blocks/src/components/loader.ts", "../../@blocksuite/blocks/src/components/import-page/import-page.ts", "../../@blocksuite/blocks/src/components/import-page/styles.ts", "../../@blocksuite/blocks/src/components/import-page/index.ts", "../../@blocksuite/blocks/src/components/menu-divider.ts", "../../@blocksuite/blocks/src/components/remote-selection/remote-selection.ts", "../../@blocksuite/blocks/src/components/selected-blocks.ts", "../../@blocksuite/blocks/src/page-block/default/utils.ts", "../../@blocksuite/blocks/src/components/linked-page/styles.ts", "../../@blocksuite/blocks/src/components/linked-page/linked-page-popover.ts", "../../@blocksuite/blocks/src/components/linked-page/index.ts", "../../@blocksuite/blocks/src/components/slash-menu/config.ts", "../../@blocksuite/blocks/src/components/slash-menu/styles.ts", "../../@blocksuite/blocks/src/components/slash-menu/slash-menu-popover.ts", "../../@blocksuite/blocks/src/components/slash-menu/index.ts", "../../@blocksuite/blocks/src/page-block/utils/container-operations.ts", "../../@blocksuite/blocks/src/page-block/utils/bind-hotkey.ts", "../../@blocksuite/blocks/src/page-block/default/components.ts", "../../@blocksuite/blocks/src/page-block/default/selection-manager/utils.ts", "../../@blocksuite/blocks/src/page-block/default/selection-manager/block-drag-handlers.ts", "../../@blocksuite/blocks/src/page-block/default/selection-manager/embed-resize-manager.ts", "../../@blocksuite/blocks/src/page-block/default/selection-manager/native-drag-handlers.ts", "../../@blocksuite/blocks/src/page-block/default/selection-manager/preview-drag-handlers.ts", "../../@blocksuite/blocks/src/page-block/default/selection-manager/selection-state.ts", "../../@blocksuite/blocks/src/page-block/default/selection-manager/selection-manager.ts", "../../@blocksuite/blocks/src/page-block/default/default-page-block.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/tool-icon-button.ts", "../../@blocksuite/blocks/src/page-block/edgeless/toolbar/shape-tool/shape-menu-config.ts", "../../@blocksuite/blocks/src/page-block/edgeless/toolbar/shape-tool/shape-menu.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/line-size-button.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/line-style-button.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/panel-wrapper.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/line-styles-panel.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/component-toolbar/change-shape-button.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/component-toolbar/change-brush-button.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/component-toolbar/change-connector-button.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/component-toolbar/change-frame-button.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/component-toolbar/more-button.ts", "../../lit-html/src/directives/join.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/component-toolbar/component-toolbar.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/resize-handles.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/resize-manager.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/single-connector-handles.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/edgeless-selected-rect.ts", "../../@blocksuite/blocks/src/page-block/edgeless/toolbar/shape-tool/shape-tool-button.ts", "../../@blocksuite/blocks/src/page-block/edgeless/toolbar/brush-tool/brush-menu.ts", "../../@blocksuite/blocks/src/page-block/edgeless/toolbar/brush-tool/brush-tool-button.ts", "../../@blocksuite/blocks/src/page-block/edgeless/toolbar/connector-tool/connector-menu.ts", "../../@blocksuite/blocks/src/page-block/edgeless/toolbar/connector-tool/connector-tool-button.ts", "../../@blocksuite/blocks/src/page-block/edgeless/toolbar/edgeless-toolbar.ts", "../../@blocksuite/blocks/src/__internal__/theme/utils.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/block-children-container.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/dragging-area.ts", "../../@blocksuite/blocks/src/page-block/edgeless/components/hover-rect.ts", "../../@blocksuite/blocks/src/page-block/edgeless/mode-controllers/index.ts", "../../@blocksuite/blocks/src/page-block/edgeless/mode-controllers/default-mode.ts", "../../@blocksuite/blocks/src/page-block/edgeless/create-drag-handle.ts", "../../@blocksuite/blocks/src/page-block/edgeless/frame-resize-observer.ts", "../../@blocksuite/blocks/src/page-block/edgeless/hotkey.ts", "../../@blocksuite/blocks/src/page-block/edgeless/mode-controllers/brush-mode.ts", "../../@blocksuite/blocks/src/page-block/edgeless/mode-controllers/connector-mode.ts", "../../@blocksuite/blocks/src/page-block/edgeless/mode-controllers/note-mode.ts", "../../@blocksuite/blocks/src/page-block/edgeless/mode-controllers/pan-mode.ts", "../../@blocksuite/blocks/src/page-block/edgeless/mode-controllers/shape-mode.ts", "../../@blocksuite/blocks/src/page-block/edgeless/mode-controllers/text-mode.ts", "../../@blocksuite/blocks/src/page-block/edgeless/selection-manager.ts", "../../@blocksuite/blocks/src/page-block/edgeless/edgeless-page-block.ts", "../../@blocksuite/blocks/src/page-block/page-model.ts", "../../@blocksuite/blocks/src/__internal__/service/json2block.ts", "../../@blocksuite/blocks/src/__internal__/rich-text/markdown-convert.ts", "../../@blocksuite/blocks/src/__internal__/service/keymap.ts", "../../@blocksuite/blocks/src/__internal__/service/index.ts", "../../@blocksuite/blocks/src/page-block/page-service.ts", "../../@blocksuite/blocks/src/counter-block/counter-block.ts", "../../@blocksuite/blocks/src/__internal__/rich-text/inline-suggestion.ts", "../../@blocksuite/blocks/src/__internal__/rich-text/bracket-complete.ts", "../../@blocksuite/blocks/src/__internal__/rich-text/keyboard.ts", "../../@blocksuite/blocks/src/__internal__/rich-text/virgo/types.ts", "../../@blocksuite/blocks/src/__internal__/rich-text/rich-text.ts", "../../@blocksuite/blocks/src/__internal__/rich-text/virgo/attribute-renderer.ts", "../../@blocksuite/blocks/src/paragraph-block/paragraph-service.ts", "../../@blocksuite/blocks/src/paragraph-block/paragraph-block.ts", "../../@blocksuite/blocks/src/paragraph-block/paragraph-model.ts", "../../@blocksuite/blocks/src/list-block/list-service.ts", "../../@blocksuite/blocks/src/list-block/utils/get-number-prefix.ts", "../../@blocksuite/blocks/src/list-block/utils/icons.ts", "../../@blocksuite/blocks/src/list-block/utils/get-list-icon.ts", "../../@blocksuite/blocks/src/list-block/utils/get-list-info.ts", "../../@blocksuite/blocks/src/list-block/list-block.ts", "../../@blocksuite/blocks/src/list-block/list-model.ts", "../../@blocksuite/blocks/src/frame-block/frame-service.ts", "../../@blocksuite/blocks/src/frame-block/frame-block.ts", "../../@blocksuite/blocks/src/frame-block/frame-model.ts", "../../@blocksuite/blocks/src/divider-block/divider-service.ts", "../../@blocksuite/blocks/src/divider-block/divider-block.ts", "../../@blocksuite/blocks/src/divider-block/divider-model.ts", "../../@blocksuite/blocks/src/code-block/utils/highlight-cache.ts", "../../@blocksuite/blocks/src/code-block/affine-code-line.ts", "../../@blocksuite/blocks/src/embed-block/embed-service.ts", "../../@blocksuite/blocks/src/embed-block/embed-block.ts", "../../@blocksuite/blocks/src/embed-block/embed-model.ts", "../../@blocksuite/blocks/src/embed-block/image/placeholder/circle-loading.ts", "../../@blocksuite/blocks/src/embed-block/image/placeholder/loading-card.ts", "../../@blocksuite/blocks/src/embed-block/image/placeholder/image-not-found.ts", "../../@blocksuite/blocks/src/embed-block/image/image-block.ts", "../../@blocksuite/blocks/src/surface-block/surface-model.ts", "../../@blocksuite/blocks/src/database-block/utils.ts", "../../@blocksuite/blocks/src/database-block/table/consts.ts", "../../@blocksuite/blocks/src/database-block/table/types.ts", "../../@blocksuite/blocks/src/database-block/table/components/edit-column-popup/styles.ts", "../../@blocksuite/blocks/src/database-block/table/components/edit-column-popup/column-type-popup.ts", "../../@blocksuite/blocks/src/database-block/table/components/edit-column-popup/utils.ts", "../../@blocksuite/blocks/src/database-block/table/components/edit-column-popup/edit-column-popup.ts", "../../@blocksuite/blocks/src/database-block/table/components/column-header/column-move/column-drag-indicator.ts", "../../@blocksuite/blocks/src/database-block/table/components/column-header/column-move/column-drag-preview.ts", "../../@blocksuite/blocks/src/database-block/table/components/column-header/column-move/index.ts", "../../@blocksuite/blocks/src/database-block/table/components/column-header/column-width/index.ts", "../../@blocksuite/blocks/src/database-block/table/components/column-header/styles.ts", "../../@blocksuite/blocks/src/database-block/table/components/column-header/column-header.ts", "../../@blocksuite/blocks/src/database-block/table/register.ts", "../../@blocksuite/blocks/src/database-block/table/components/cell-container.ts", "../../@blocksuite/blocks/src/database-block/table/components/toolbar/toolbar-action-popup.ts", "../../@blocksuite/blocks/src/database-block/table/components/toolbar/index.ts", "../../@blocksuite/blocks/src/database-block/table/components/toolbar/toolbar.ts", "../../@blocksuite/blocks/src/components/virgo-input/virgo-input.ts", "../../@blocksuite/blocks/src/database-block/table/components/database-title.ts", "../../@blocksuite/blocks/src/database-block/table/components/column-type/checkbox.ts", "../../@blocksuite/blocks/src/database-block/table/components/column-type/multi-select.ts", "../../@blocksuite/blocks/src/database-block/table/components/column-type/number.ts", "../../@blocksuite/blocks/src/database-block/table/components/column-type/progress.ts", "../../@blocksuite/blocks/src/database-block/table/components/column-type/rich-text.ts", "../../@blocksuite/blocks/src/database-block/table/components/column-type/select/select-option.ts", "../../@blocksuite/blocks/src/database-block/table/components/selection/cell-selection.ts", "../../@blocksuite/blocks/src/database-block/table/components/selection/row-selection.ts", "../../@blocksuite/blocks/src/database-block/table/components/selection/utils.ts", "../../@blocksuite/blocks/src/database-block/table/selection-manager/cell.ts", "../../@blocksuite/blocks/src/database-block/table/components/column-type/select/select-option-popup.ts", "../../@blocksuite/blocks/src/database-block/table/components/column-type/select/select-cell-editing.ts", "../../@blocksuite/blocks/src/database-block/table/components/column-type/select/select.ts", "../../@blocksuite/blocks/src/database-block/table/components/column-type/index.ts", "../../@blocksuite/blocks/src/database-block/table/components/row-container.ts", "../../@blocksuite/blocks/src/database-block/table/selection-manager/utils.ts", "../../@blocksuite/blocks/src/database-block/table/selection-manager/row.ts", "../../@blocksuite/blocks/src/database-block/table/table-view.ts", "../../@blocksuite/blocks/src/database-block/kanban/kanban-view.ts", "../../@blocksuite/blocks/src/database-block/database-service.ts", "../../@blocksuite/blocks/src/database-block/database-block.ts", "../../@blocksuite/blocks/src/database-block/database-model.ts", "../../@blocksuite/blocks/src/__internal__/theme/theme-observer.ts", "../../@blocksuite/blocks/src/components/portal.ts", "../../@blocksuite/blocks/src/code-block/components/code-option.ts", "../../@blocksuite/blocks/src/code-block/components/lang-list.ts", "../../@blocksuite/blocks/src/code-block/code-service.ts", "../../@blocksuite/blocks/src/code-block/utils/code-line-renderer.ts", "../../@blocksuite/blocks/src/code-block/code-block.ts", "../../@blocksuite/blocks/src/code-block/code-model.ts", "../../@blocksuite/blocks/src/preset/index.ts", "../../@blocksuite/blocks/src/index.ts", "../../@blocksuite/phasor/src/utils/numerical.ts", "../../@blocksuite/phasor/src/utils/line.ts", "../../@blocksuite/phasor/src/utils/vec.ts", "../../@blocksuite/phasor/src/utils/tl-utils.ts", "../../@blocksuite/phasor/src/utils/xywh.ts", "../../@blocksuite/phasor/src/utils/bound.ts", "../../@blocksuite/phasor/src/utils/hit-utils.ts", "../../@blocksuite/phasor/src/elements/surface-element.ts", "../../@blocksuite/phasor/src/elements/brush/brush-element.ts", "../../@blocksuite/phasor/src/elements/brush/constants.ts", "../../@blocksuite/phasor/src/elements/connector/utils.ts", "../../@blocksuite/phasor/src/elements/connector/connector-element.ts", "../../@blocksuite/phasor/src/elements/connector/constants.ts", "../../@blocksuite/phasor/src/elements/debug/debug-element.ts", "../../@blocksuite/phasor/src/elements/shape/constants.ts", "../../@blocksuite/phasor/src/elements/shape/shapes/diamond.ts", "../../@blocksuite/phasor/src/elements/shape/shapes/ellipse.ts", "../../@blocksuite/phasor/src/elements/shape/shapes/rect.ts", "../../@blocksuite/phasor/src/elements/shape/shapes/triangle.ts", "../../@blocksuite/phasor/src/elements/shape/shapes/index.ts", "../../@blocksuite/phasor/src/elements/shape/shape-element.ts", "../../@blocksuite/phasor/src/elements/text/constants.ts", "../../@blocksuite/phasor/src/elements/text/utils.ts", "../../@blocksuite/phasor/src/elements/text/text-element.ts", "../../@blocksuite/phasor/src/elements/index.ts", "../../@blocksuite/phasor/src/grid.ts", "../../roughjs/bin/geometry.js", "../../roughjs/bin/fillers/scan-line-hachure.js", "../../roughjs/bin/fillers/hachure-filler.js", "../../roughjs/bin/fillers/zigzag-filler.js", "../../roughjs/bin/fillers/hatch-filler.js", "../../roughjs/bin/fillers/dot-filler.js", "../../roughjs/bin/fillers/dashed-filler.js", "../../roughjs/bin/fillers/zigzag-line-filler.js", "../../roughjs/bin/fillers/filler.js", "../../roughjs/bin/math.js", "../../path-data-parser/lib/parser.js", "../../path-data-parser/lib/absolutize.js", "../../path-data-parser/lib/normalize.js", "../../roughjs/bin/renderer.js", "../../points-on-curve/lib/curve-to-bezier.js", "../../points-on-curve/lib/index.js", "../../points-on-path/lib/index.js", "../../roughjs/bin/generator.js", "../../roughjs/bin/canvas.js", "../../@blocksuite/phasor/src/renderer.ts", "../../fractional-indexing/src/index.js", "../../@blocksuite/phasor/src/utils/std.ts", "../../@blocksuite/phasor/src/surface.ts", "../../@blocksuite/blocks/src/__internal__/clipboard/edgeless-clipboard.ts", "../../@blocksuite/blocks/src/__internal__/clipboard/page-clipboard.ts", "../../@blocksuite/blocks/src/bookmark-block/bookmark-model.ts", "../../@blocksuite/blocks/src/bookmark-block/utils.ts", "../../@blocksuite/blocks/src/bookmark-block/components/bookmark-operation-popper.ts", "../../@blocksuite/blocks/src/bookmark-block/components/bookmark-toolbar.ts", "../../@blocksuite/blocks/src/bookmark-block/components/bookmark-edit-modal.ts", "../../@blocksuite/blocks/src/bookmark-block/components/bookmark-create-modal.ts", "../../@blocksuite/blocks/src/bookmark-block/components/loader.ts", "../../@blocksuite/blocks/src/bookmark-block/bookmark-service.ts", "../../@blocksuite/blocks/src/bookmark-block/images/banners.ts", "../../@blocksuite/blocks/src/bookmark-block/bookmark-block.ts", "../../@blocksuite/blocks/src/services.ts", "../../@blocksuite/blocks/src/__internal__/service.ts"],
  "sourcesContent": ["!function(t,n){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=n():\"function\"==typeof define&&define.amd?define([],n):\"object\"==typeof exports?exports.onig=n():t.onig=n()}(this,(()=>{return t={770:function(t,n,e){\"use strict\";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,\"__esModule\",{value:!0}),n.setDefaultDebugCall=n.createOnigScanner=n.createOnigString=n.loadWASM=n.OnigScanner=n.OnigString=void 0;const i=r(e(418));let o=null,a=!1;class f{static _utf8ByteLength(t){let n=0;for(let e=0,r=t.length;e<r;e++){const i=t.charCodeAt(e);let o=i,a=!1;if(i>=55296&&i<=56319&&e+1<r){const n=t.charCodeAt(e+1);n>=56320&&n<=57343&&(o=65536+(i-55296<<10)|n-56320,a=!0)}n+=o<=127?1:o<=2047?2:o<=65535?3:4,a&&e++}return n}constructor(t){const n=t.length,e=f._utf8ByteLength(t),r=e!==n,i=r?new Uint32Array(n+1):null;r&&(i[n]=e);const o=r?new Uint32Array(e+1):null;r&&(o[e]=n);const a=new Uint8Array(e);let s=0;for(let e=0;e<n;e++){const f=t.charCodeAt(e);let u=f,c=!1;if(f>=55296&&f<=56319&&e+1<n){const n=t.charCodeAt(e+1);n>=56320&&n<=57343&&(u=65536+(f-55296<<10)|n-56320,c=!0)}r&&(i[e]=s,c&&(i[e+1]=s),u<=127?o[s+0]=e:u<=2047?(o[s+0]=e,o[s+1]=e):u<=65535?(o[s+0]=e,o[s+1]=e,o[s+2]=e):(o[s+0]=e,o[s+1]=e,o[s+2]=e,o[s+3]=e)),u<=127?a[s++]=u:u<=2047?(a[s++]=192|(1984&u)>>>6,a[s++]=128|(63&u)>>>0):u<=65535?(a[s++]=224|(61440&u)>>>12,a[s++]=128|(4032&u)>>>6,a[s++]=128|(63&u)>>>0):(a[s++]=240|(1835008&u)>>>18,a[s++]=128|(258048&u)>>>12,a[s++]=128|(4032&u)>>>6,a[s++]=128|(63&u)>>>0),c&&e++}this.utf16Length=n,this.utf8Length=e,this.utf16Value=t,this.utf8Value=a,this.utf16OffsetToUtf8=i,this.utf8OffsetToUtf16=o}createString(t){const n=t._omalloc(this.utf8Length);return t.HEAPU8.set(this.utf8Value,n),n}}class s{constructor(t){if(this.id=++s.LAST_ID,!o)throw new Error(\"Must invoke loadWASM first.\");this._onigBinding=o,this.content=t;const n=new f(t);this.utf16Length=n.utf16Length,this.utf8Length=n.utf8Length,this.utf16OffsetToUtf8=n.utf16OffsetToUtf8,this.utf8OffsetToUtf16=n.utf8OffsetToUtf16,this.utf8Length<1e4&&!s._sharedPtrInUse?(s._sharedPtr||(s._sharedPtr=o._omalloc(1e4)),s._sharedPtrInUse=!0,o.HEAPU8.set(n.utf8Value,s._sharedPtr),this.ptr=s._sharedPtr):this.ptr=n.createString(o)}convertUtf8OffsetToUtf16(t){return this.utf8OffsetToUtf16?t<0?0:t>this.utf8Length?this.utf16Length:this.utf8OffsetToUtf16[t]:t}convertUtf16OffsetToUtf8(t){return this.utf16OffsetToUtf8?t<0?0:t>this.utf16Length?this.utf8Length:this.utf16OffsetToUtf8[t]:t}dispose(){this.ptr===s._sharedPtr?s._sharedPtrInUse=!1:this._onigBinding._ofree(this.ptr)}}n.OnigString=s,s.LAST_ID=0,s._sharedPtr=0,s._sharedPtrInUse=!1;class u{constructor(t){if(!o)throw new Error(\"Must invoke loadWASM first.\");const n=[],e=[];for(let r=0,i=t.length;r<i;r++){const i=new f(t[r]);n[r]=i.createString(o),e[r]=i.utf8Length}const r=o._omalloc(4*t.length);o.HEAPU32.set(n,r/4);const i=o._omalloc(4*t.length);o.HEAPU32.set(e,i/4);const a=o._createOnigScanner(r,i,t.length);for(let e=0,r=t.length;e<r;e++)o._ofree(n[e]);o._ofree(i),o._ofree(r),0===a&&function(t){throw new Error(t.UTF8ToString(t._getLastOnigError()))}(o),this._onigBinding=o,this._ptr=a}dispose(){this._onigBinding._freeOnigScanner(this._ptr)}findNextMatchSync(t,n,e){let r=a,i=0;if(\"number\"==typeof e?(8&e&&(r=!0),i=e):\"boolean\"==typeof e&&(r=e),\"string\"==typeof t){t=new s(t);const e=this._findNextMatchSync(t,n,r,i);return t.dispose(),e}return this._findNextMatchSync(t,n,r,i)}_findNextMatchSync(t,n,e,r){const i=this._onigBinding;let o;if(o=e?i._findNextOnigScannerMatchDbg(this._ptr,t.id,t.ptr,t.utf8Length,t.convertUtf16OffsetToUtf8(n),r):i._findNextOnigScannerMatch(this._ptr,t.id,t.ptr,t.utf8Length,t.convertUtf16OffsetToUtf8(n),r),0===o)return null;const a=i.HEAPU32;let f=o/4;const s=a[f++],u=a[f++];let c=[];for(let n=0;n<u;n++){const e=t.convertUtf8OffsetToUtf16(a[f++]),r=t.convertUtf8OffsetToUtf16(a[f++]);c[n]={start:e,end:r,length:r-e}}return{index:s,captureIndices:c}}}n.OnigScanner=u;let c=!1,l=null;n.loadWASM=function(t){if(c)return l;let n,e,r,a;if(c=!0,function(t){return\"function\"==typeof t.instantiator}(t))n=t.instantiator,e=t.print;else{let r;!function(t){return void 0!==t.data}(t)?r=t:(r=t.data,e=t.print),n=function(t){return\"undefined\"!=typeof Response&&t instanceof Response}(r)?\"function\"==typeof WebAssembly.instantiateStreaming?function(t){return n=>WebAssembly.instantiateStreaming(t,n)}(r):function(t){return async n=>{const e=await t.arrayBuffer();return WebAssembly.instantiate(e,n)}}(r):function(t){return n=>WebAssembly.instantiate(t,n)}(r)}return l=new Promise(((t,n)=>{r=t,a=n})),function(t,n,e,r){(0,i.default)({print:n,instantiateWasm:(n,e)=>{if(\"undefined\"==typeof performance){const t=()=>Date.now();n.env.emscripten_get_now=t,n.wasi_snapshot_preview1.emscripten_get_now=t}return t(n).then((t=>e(t.instance)),r),{}}}).then((t=>{o=t,e()}))}(n,e,r,a),l},n.createOnigString=function(t){return new s(t)},n.createOnigScanner=function(t){return new u(t)},n.setDefaultDebugCall=function(t){a=t}},418:t=>{var n=(\"undefined\"!=typeof document&&document.currentScript&&document.currentScript.src,function(t){var n,e,r=void 0!==(t=t||{})?t:{};r.ready=new Promise((function(t,r){n=t,e=r}));var i,o=Object.assign({},r),a=[],f=!1,s=!1,u=!0,c=\"\";function l(t){return r.locateFile?r.locateFile(t,c):c+t}u&&(i=function(t){let n;return\"function\"==typeof readbuffer?new Uint8Array(readbuffer(t)):(n=read(t,\"binary\"),m(\"object\"==typeof n),n)},\"undefined\"!=typeof scriptArgs?a=scriptArgs:void 0!==arguments&&(a=arguments),\"undefined\"!=typeof onig_print&&(\"undefined\"==typeof console&&(console={}),console.log=onig_print,console.warn=console.error=\"undefined\"!=typeof printErr?printErr:onig_print));var h,p,d=r.print||console.log.bind(console),g=r.printErr||console.warn.bind(console);Object.assign(r,o),o=null,r.arguments&&(a=r.arguments),r.thisProgram&&r.thisProgram,r.quit&&r.quit,r.wasmBinary&&(h=r.wasmBinary),r.noExitRuntime,\"object\"!=typeof WebAssembly&&k(\"no native wasm support detected\");var _=!1;function m(t,n){t||k(n)}var y,w,S,v=\"undefined\"!=typeof TextDecoder?new TextDecoder(\"utf8\"):void 0;function A(t,n,e){for(var r=n+e,i=n;t[i]&&!(i>=r);)++i;if(i-n>16&&t.buffer&&v)return v.decode(t.subarray(n,i));for(var o=\"\";n<i;){var a=t[n++];if(128&a){var f=63&t[n++];if(192!=(224&a)){var s=63&t[n++];if((a=224==(240&a)?(15&a)<<12|f<<6|s:(7&a)<<18|f<<12|s<<6|63&t[n++])<65536)o+=String.fromCharCode(a);else{var u=a-65536;o+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else o+=String.fromCharCode((31&a)<<6|f)}else o+=String.fromCharCode(a)}return o}function b(t,n){return t?A(w,t,n):\"\"}function O(t){y=t,r.HEAP8=new Int8Array(t),r.HEAP16=new Int16Array(t),r.HEAP32=new Int32Array(t),r.HEAPU8=w=new Uint8Array(t),r.HEAPU16=new Uint16Array(t),r.HEAPU32=S=new Uint32Array(t),r.HEAPF32=new Float32Array(t),r.HEAPF64=new Float64Array(t)}r.INITIAL_MEMORY;var U=[],P=[],R=[];function x(){if(r.preRun)for(\"function\"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)M(r.preRun.shift());G(U)}function T(){G(P)}function E(){if(r.postRun)for(\"function\"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)I(r.postRun.shift());G(R)}function M(t){U.unshift(t)}function L(t){P.unshift(t)}function I(t){R.unshift(t)}var W=0,D=null,C=null;function N(t){W++,r.monitorRunDependencies&&r.monitorRunDependencies(W)}function j(t){if(W--,r.monitorRunDependencies&&r.monitorRunDependencies(W),0==W&&(null!==D&&(clearInterval(D),D=null),C)){var n=C;C=null,n()}}function k(t){r.onAbort&&r.onAbort(t),g(t=\"Aborted(\"+t+\")\"),_=!0,t+=\". Build with -sASSERTIONS for more info.\";var n=new WebAssembly.RuntimeError(t);throw e(n),n}var B,H,F=\"data:application/octet-stream;base64,\";function V(t){return t.startsWith(F)}function z(t){try{if(t==B&&h)return new Uint8Array(h);if(i)return i(t);throw\"both async and sync fetching of the wasm failed\"}catch(t){k(t)}}function q(){return h||!f&&!s||\"function\"!=typeof fetch?Promise.resolve().then((function(){return z(B)})):fetch(B,{credentials:\"same-origin\"}).then((function(t){if(!t.ok)throw\"failed to load wasm binary file at '\"+B+\"'\";return t.arrayBuffer()})).catch((function(){return z(B)}))}function Y(){var t={env:nt,wasi_snapshot_preview1:nt};function n(t,n){var e=t.exports;r.asm=e,O((p=r.asm.memory).buffer),r.asm.__indirect_function_table,L(r.asm.__wasm_call_ctors),j()}function i(t){n(t.instance)}function o(n){return q().then((function(n){return WebAssembly.instantiate(n,t)})).then((function(t){return t})).then(n,(function(t){g(\"failed to asynchronously prepare wasm: \"+t),k(t)}))}if(N(),r.instantiateWasm)try{return r.instantiateWasm(t,n)}catch(t){g(\"Module.instantiateWasm callback failed with error: \"+t),e(t)}return(h||\"function\"!=typeof WebAssembly.instantiateStreaming||V(B)||\"function\"!=typeof fetch?o(i):fetch(B,{credentials:\"same-origin\"}).then((function(n){return WebAssembly.instantiateStreaming(n,t).then(i,(function(t){return g(\"wasm streaming compile failed: \"+t),g(\"falling back to ArrayBuffer instantiation\"),o(i)}))}))).catch(e),{}}function G(t){for(;t.length>0;)t.shift()(r)}function J(t,n,e){w.copyWithin(t,n,n+e)}function K(t){try{return p.grow(t-y.byteLength+65535>>>16),O(p.buffer),1}catch(t){}}function Q(t){var n,e=w.length,r=2147483648;if((t>>>=0)>r)return!1;for(var i=1;i<=4;i*=2){var o=e*(1+.2/i);if(o=Math.min(o,t+100663296),K(Math.min(r,(n=Math.max(t,o))+(65536-n%65536)%65536)))return!0}return!1}V(B=\"onig.wasm\")||(B=l(B)),H=\"undefined\"!=typeof dateNow?dateNow:()=>performance.now();var X=[null,[],[]];function Z(t,n){var e=X[t];0===n||10===n?((1===t?d:g)(A(e,0)),e.length=0):e.push(n)}function $(t,n,e,r){for(var i=0,o=0;o<e;o++){var a=S[n>>2],f=S[n+4>>2];n+=8;for(var s=0;s<f;s++)Z(t,w[a+s]);i+=f}return S[r>>2]=i,0}var tt,nt={emscripten_get_now:H,emscripten_memcpy_big:J,emscripten_resize_heap:Q,fd_write:$};function et(t){function e(){tt||(tt=!0,r.calledRun=!0,_||(T(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),E()))}t=t||a,W>0||(x(),W>0||(r.setStatus?(r.setStatus(\"Running...\"),setTimeout((function(){setTimeout((function(){r.setStatus(\"\")}),1),e()}),1)):e()))}if(Y(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.__wasm_call_ctors).apply(null,arguments)},r.___errno_location=function(){return(r.___errno_location=r.asm.__errno_location).apply(null,arguments)},r._omalloc=function(){return(r._omalloc=r.asm.omalloc).apply(null,arguments)},r._ofree=function(){return(r._ofree=r.asm.ofree).apply(null,arguments)},r._getLastOnigError=function(){return(r._getLastOnigError=r.asm.getLastOnigError).apply(null,arguments)},r._createOnigScanner=function(){return(r._createOnigScanner=r.asm.createOnigScanner).apply(null,arguments)},r._freeOnigScanner=function(){return(r._freeOnigScanner=r.asm.freeOnigScanner).apply(null,arguments)},r._findNextOnigScannerMatch=function(){return(r._findNextOnigScannerMatch=r.asm.findNextOnigScannerMatch).apply(null,arguments)},r._findNextOnigScannerMatchDbg=function(){return(r._findNextOnigScannerMatchDbg=r.asm.findNextOnigScannerMatchDbg).apply(null,arguments)},r.stackSave=function(){return(r.stackSave=r.asm.stackSave).apply(null,arguments)},r.stackRestore=function(){return(r.stackRestore=r.asm.stackRestore).apply(null,arguments)},r.stackAlloc=function(){return(r.stackAlloc=r.asm.stackAlloc).apply(null,arguments)},r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.dynCall_jiji).apply(null,arguments)},r.UTF8ToString=b,C=function t(){tt||et(),tt||(C=t)},r.preInit)for(\"function\"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return et(),t.ready});t.exports=n}},n={},function e(r){var i=n[r];if(void 0!==i)return i.exports;var o=n[r]={exports:{}};return t[r].call(o.exports,o,o.exports,e),o.exports}(770);var t,n}));", "(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"vscodetextmate\"] = factory();\n\telse\n\t\troot[\"vscodetextmate\"] = factory();\n})(this, function() {\nreturn ", "\"use strict\";\n/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.UseOnigurumaFindOptions = exports.DebugFlags = void 0;\nexports.DebugFlags = {\n    InDebugMode: (typeof process !== 'undefined' && !!process.env['VSCODE_TEXTMATE_DEBUG'])\n};\nexports.UseOnigurumaFindOptions = false;\n//# sourceMappingURL=debug.js.map", "\"use strict\";\n/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.toOptionalTokenType = exports.EncodedTokenAttributes = void 0;\nvar EncodedTokenAttributes;\n(function (EncodedTokenAttributes) {\n    function toBinaryStr(encodedTokenAttributes) {\n        let r = encodedTokenAttributes.toString(2);\n        while (r.length < 32) {\n            r = \"0\" + r;\n        }\n        return r;\n    }\n    EncodedTokenAttributes.toBinaryStr = toBinaryStr;\n    function print(encodedTokenAttributes) {\n        const languageId = EncodedTokenAttributes.getLanguageId(encodedTokenAttributes);\n        const tokenType = EncodedTokenAttributes.getTokenType(encodedTokenAttributes);\n        const fontStyle = EncodedTokenAttributes.getFontStyle(encodedTokenAttributes);\n        const foreground = EncodedTokenAttributes.getForeground(encodedTokenAttributes);\n        const background = EncodedTokenAttributes.getBackground(encodedTokenAttributes);\n        console.log({\n            languageId: languageId,\n            tokenType: tokenType,\n            fontStyle: fontStyle,\n            foreground: foreground,\n            background: background,\n        });\n    }\n    EncodedTokenAttributes.print = print;\n    function getLanguageId(encodedTokenAttributes) {\n        return ((encodedTokenAttributes & 255 /* LANGUAGEID_MASK */) >>>\n            0 /* LANGUAGEID_OFFSET */);\n    }\n    EncodedTokenAttributes.getLanguageId = getLanguageId;\n    function getTokenType(encodedTokenAttributes) {\n        return ((encodedTokenAttributes & 768 /* TOKEN_TYPE_MASK */) >>>\n            8 /* TOKEN_TYPE_OFFSET */);\n    }\n    EncodedTokenAttributes.getTokenType = getTokenType;\n    function containsBalancedBrackets(encodedTokenAttributes) {\n        return (encodedTokenAttributes & 1024 /* BALANCED_BRACKETS_MASK */) !== 0;\n    }\n    EncodedTokenAttributes.containsBalancedBrackets = containsBalancedBrackets;\n    function getFontStyle(encodedTokenAttributes) {\n        return ((encodedTokenAttributes & 30720 /* FONT_STYLE_MASK */) >>>\n            11 /* FONT_STYLE_OFFSET */);\n    }\n    EncodedTokenAttributes.getFontStyle = getFontStyle;\n    function getForeground(encodedTokenAttributes) {\n        return ((encodedTokenAttributes & 16744448 /* FOREGROUND_MASK */) >>>\n            15 /* FOREGROUND_OFFSET */);\n    }\n    EncodedTokenAttributes.getForeground = getForeground;\n    function getBackground(encodedTokenAttributes) {\n        return ((encodedTokenAttributes & 4278190080 /* BACKGROUND_MASK */) >>>\n            24 /* BACKGROUND_OFFSET */);\n    }\n    EncodedTokenAttributes.getBackground = getBackground;\n    /**\n     * Updates the fields in `metadata`.\n     * A value of `0`, `NotSet` or `null` indicates that the corresponding field should be left as is.\n     */\n    function set(encodedTokenAttributes, languageId, tokenType, containsBalancedBrackets, fontStyle, foreground, background) {\n        let _languageId = EncodedTokenAttributes.getLanguageId(encodedTokenAttributes);\n        let _tokenType = EncodedTokenAttributes.getTokenType(encodedTokenAttributes);\n        let _containsBalancedBracketsBit = EncodedTokenAttributes.containsBalancedBrackets(encodedTokenAttributes) ? 1 : 0;\n        let _fontStyle = EncodedTokenAttributes.getFontStyle(encodedTokenAttributes);\n        let _foreground = EncodedTokenAttributes.getForeground(encodedTokenAttributes);\n        let _background = EncodedTokenAttributes.getBackground(encodedTokenAttributes);\n        if (languageId !== 0) {\n            _languageId = languageId;\n        }\n        if (tokenType !== 8 /* NotSet */) {\n            _tokenType = fromOptionalTokenType(tokenType);\n        }\n        if (containsBalancedBrackets !== null) {\n            _containsBalancedBracketsBit = containsBalancedBrackets ? 1 : 0;\n        }\n        if (fontStyle !== -1 /* NotSet */) {\n            _fontStyle = fontStyle;\n        }\n        if (foreground !== 0) {\n            _foreground = foreground;\n        }\n        if (background !== 0) {\n            _background = background;\n        }\n        return (((_languageId << 0 /* LANGUAGEID_OFFSET */) |\n            (_tokenType << 8 /* TOKEN_TYPE_OFFSET */) |\n            (_containsBalancedBracketsBit <<\n                10 /* BALANCED_BRACKETS_OFFSET */) |\n            (_fontStyle << 11 /* FONT_STYLE_OFFSET */) |\n            (_foreground << 15 /* FOREGROUND_OFFSET */) |\n            (_background << 24 /* BACKGROUND_OFFSET */)) >>>\n            0);\n    }\n    EncodedTokenAttributes.set = set;\n})(EncodedTokenAttributes = exports.EncodedTokenAttributes || (exports.EncodedTokenAttributes = {}));\nfunction toOptionalTokenType(standardType) {\n    return standardType;\n}\nexports.toOptionalTokenType = toOptionalTokenType;\nfunction fromOptionalTokenType(standardType) {\n    return standardType;\n}\n//# sourceMappingURL=encodedTokenAttributes.js.map", "\"use strict\";\n/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BasicScopeAttributesProvider = exports.BasicScopeAttributes = void 0;\nconst utils_1 = require(\"../utils\");\nclass BasicScopeAttributes {\n    constructor(languageId, tokenType) {\n        this.languageId = languageId;\n        this.tokenType = tokenType;\n    }\n}\nexports.BasicScopeAttributes = BasicScopeAttributes;\nclass BasicScopeAttributesProvider {\n    constructor(initialLanguageId, embeddedLanguages) {\n        this._getBasicScopeAttributes = new utils_1.CachedFn((scopeName) => {\n            const languageId = this._scopeToLanguage(scopeName);\n            const standardTokenType = this._toStandardTokenType(scopeName);\n            return new BasicScopeAttributes(languageId, standardTokenType);\n        });\n        this._defaultAttributes = new BasicScopeAttributes(initialLanguageId, 8 /* NotSet */);\n        this._embeddedLanguagesMatcher = new ScopeMatcher(Object.entries(embeddedLanguages || {}));\n    }\n    getDefaultAttributes() {\n        return this._defaultAttributes;\n    }\n    getBasicScopeAttributes(scopeName) {\n        if (scopeName === null) {\n            return BasicScopeAttributesProvider._NULL_SCOPE_METADATA;\n        }\n        return this._getBasicScopeAttributes.get(scopeName);\n    }\n    /**\n     * Given a produced TM scope, return the language that token describes or null if unknown.\n     * e.g. source.html => html, source.css.embedded.html => css, punctuation.definition.tag.html => null\n     */\n    _scopeToLanguage(scope) {\n        return this._embeddedLanguagesMatcher.match(scope) || 0;\n    }\n    _toStandardTokenType(scopeName) {\n        const m = scopeName.match(BasicScopeAttributesProvider.STANDARD_TOKEN_TYPE_REGEXP);\n        if (!m) {\n            return 8 /* NotSet */;\n        }\n        switch (m[1]) {\n            case \"comment\":\n                return 1 /* Comment */;\n            case \"string\":\n                return 2 /* String */;\n            case \"regex\":\n                return 3 /* RegEx */;\n            case \"meta.embedded\":\n                return 0 /* Other */;\n        }\n        throw new Error(\"Unexpected match for standard token type!\");\n    }\n}\nexports.BasicScopeAttributesProvider = BasicScopeAttributesProvider;\nBasicScopeAttributesProvider._NULL_SCOPE_METADATA = new BasicScopeAttributes(0, 0);\nBasicScopeAttributesProvider.STANDARD_TOKEN_TYPE_REGEXP = /\\b(comment|string|regex|meta\\.embedded)\\b/;\nclass ScopeMatcher {\n    constructor(values) {\n        if (values.length === 0) {\n            this.values = null;\n            this.scopesRegExp = null;\n        }\n        else {\n            this.values = new Map(values);\n            // create the regex\n            const escapedScopes = values.map(([scopeName, value]) => utils_1.escapeRegExpCharacters(scopeName));\n            escapedScopes.sort();\n            escapedScopes.reverse(); // Longest scope first\n            this.scopesRegExp = new RegExp(`^((${escapedScopes.join(\")|(\")}))($|\\\\.)`, \"\");\n        }\n    }\n    match(scope) {\n        if (!this.scopesRegExp) {\n            return undefined;\n        }\n        const m = scope.match(this.scopesRegExp);\n        if (!m) {\n            // no scopes matched\n            return undefined;\n        }\n        return this.values.get(m[1]);\n    }\n}\n//# sourceMappingURL=basicScopesAttributeProvider.js.map", "\"use strict\";\n/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.LineTokens = exports.BalancedBracketSelectors = exports.StateStack = exports.AttributedScopeStack = exports.Grammar = exports.createGrammar = void 0;\nconst debug_1 = require(\"../debug\");\nconst encodedTokenAttributes_1 = require(\"../encodedTokenAttributes\");\nconst matcher_1 = require(\"../matcher\");\nconst onigLib_1 = require(\"../onigLib\");\nconst rule_1 = require(\"../rule\");\nconst theme_1 = require(\"../theme\");\nconst utils_1 = require(\"../utils\");\nconst basicScopesAttributeProvider_1 = require(\"./basicScopesAttributeProvider\");\nconst tokenizeString_1 = require(\"./tokenizeString\");\nfunction createGrammar(scopeName, grammar, initialLanguage, embeddedLanguages, tokenTypes, balancedBracketSelectors, grammarRepository, onigLib) {\n    return new Grammar(scopeName, grammar, initialLanguage, embeddedLanguages, tokenTypes, balancedBracketSelectors, grammarRepository, onigLib); //TODO\n}\nexports.createGrammar = createGrammar;\nfunction collectInjections(result, selector, rule, ruleFactoryHelper, grammar) {\n    const matchers = matcher_1.createMatchers(selector, nameMatcher);\n    const ruleId = rule_1.RuleFactory.getCompiledRuleId(rule, ruleFactoryHelper, grammar.repository);\n    for (const matcher of matchers) {\n        result.push({\n            debugSelector: selector,\n            matcher: matcher.matcher,\n            ruleId: ruleId,\n            grammar: grammar,\n            priority: matcher.priority\n        });\n    }\n}\nfunction nameMatcher(identifers, scopes) {\n    if (scopes.length < identifers.length) {\n        return false;\n    }\n    let lastIndex = 0;\n    return identifers.every(identifier => {\n        for (let i = lastIndex; i < scopes.length; i++) {\n            if (scopesAreMatching(scopes[i], identifier)) {\n                lastIndex = i + 1;\n                return true;\n            }\n        }\n        return false;\n    });\n}\nfunction scopesAreMatching(thisScopeName, scopeName) {\n    if (!thisScopeName) {\n        return false;\n    }\n    if (thisScopeName === scopeName) {\n        return true;\n    }\n    const len = scopeName.length;\n    return thisScopeName.length > len && thisScopeName.substr(0, len) === scopeName && thisScopeName[len] === '.';\n}\nclass Grammar {\n    constructor(_rootScopeName, grammar, initialLanguage, embeddedLanguages, tokenTypes, balancedBracketSelectors, grammarRepository, _onigLib) {\n        this._rootScopeName = _rootScopeName;\n        this.balancedBracketSelectors = balancedBracketSelectors;\n        this._onigLib = _onigLib;\n        this._basicScopeAttributesProvider = new basicScopesAttributeProvider_1.BasicScopeAttributesProvider(initialLanguage, embeddedLanguages);\n        this._rootId = -1;\n        this._lastRuleId = 0;\n        this._ruleId2desc = [null];\n        this._includedGrammars = {};\n        this._grammarRepository = grammarRepository;\n        this._grammar = initGrammar(grammar, null);\n        this._injections = null;\n        this._tokenTypeMatchers = [];\n        if (tokenTypes) {\n            for (const selector of Object.keys(tokenTypes)) {\n                const matchers = matcher_1.createMatchers(selector, nameMatcher);\n                for (const matcher of matchers) {\n                    this._tokenTypeMatchers.push({\n                        matcher: matcher.matcher,\n                        type: tokenTypes[selector],\n                    });\n                }\n            }\n        }\n    }\n    get themeProvider() { return this._grammarRepository; }\n    dispose() {\n        for (const rule of this._ruleId2desc) {\n            if (rule) {\n                rule.dispose();\n            }\n        }\n    }\n    createOnigScanner(sources) {\n        return this._onigLib.createOnigScanner(sources);\n    }\n    createOnigString(sources) {\n        return this._onigLib.createOnigString(sources);\n    }\n    getMetadataForScope(scope) {\n        return this._basicScopeAttributesProvider.getBasicScopeAttributes(scope);\n    }\n    _collectInjections() {\n        const grammarRepository = {\n            lookup: (scopeName) => {\n                if (scopeName === this._rootScopeName) {\n                    return this._grammar;\n                }\n                return this.getExternalGrammar(scopeName);\n            },\n            injections: (scopeName) => {\n                return this._grammarRepository.injections(scopeName);\n            },\n        };\n        const result = [];\n        const scopeName = this._rootScopeName;\n        const grammar = grammarRepository.lookup(scopeName);\n        if (grammar) {\n            // add injections from the current grammar\n            const rawInjections = grammar.injections;\n            if (rawInjections) {\n                for (let expression in rawInjections) {\n                    collectInjections(result, expression, rawInjections[expression], this, grammar);\n                }\n            }\n            // add injection grammars contributed for the current scope\n            const injectionScopeNames = this._grammarRepository.injections(scopeName);\n            if (injectionScopeNames) {\n                injectionScopeNames.forEach((injectionScopeName) => {\n                    const injectionGrammar = this.getExternalGrammar(injectionScopeName);\n                    if (injectionGrammar) {\n                        const selector = injectionGrammar.injectionSelector;\n                        if (selector) {\n                            collectInjections(result, selector, injectionGrammar, this, injectionGrammar);\n                        }\n                    }\n                });\n            }\n        }\n        result.sort((i1, i2) => i1.priority - i2.priority); // sort by priority\n        return result;\n    }\n    getInjections() {\n        if (this._injections === null) {\n            this._injections = this._collectInjections();\n            if (debug_1.DebugFlags.InDebugMode && this._injections.length > 0) {\n                console.log(`Grammar ${this._rootScopeName} contains the following injections:`);\n                for (const injection of this._injections) {\n                    console.log(`  - ${injection.debugSelector}`);\n                }\n            }\n        }\n        return this._injections;\n    }\n    registerRule(factory) {\n        const id = ++this._lastRuleId;\n        const result = factory(rule_1.ruleIdFromNumber(id));\n        this._ruleId2desc[id] = result;\n        return result;\n    }\n    getRule(ruleId) {\n        return this._ruleId2desc[rule_1.ruleIdToNumber(ruleId)];\n    }\n    getExternalGrammar(scopeName, repository) {\n        if (this._includedGrammars[scopeName]) {\n            return this._includedGrammars[scopeName];\n        }\n        else if (this._grammarRepository) {\n            const rawIncludedGrammar = this._grammarRepository.lookup(scopeName);\n            if (rawIncludedGrammar) {\n                // console.log('LOADED GRAMMAR ' + pattern.include);\n                this._includedGrammars[scopeName] = initGrammar(rawIncludedGrammar, repository && repository.$base);\n                return this._includedGrammars[scopeName];\n            }\n        }\n        return undefined;\n    }\n    tokenizeLine(lineText, prevState, timeLimit = 0) {\n        const r = this._tokenize(lineText, prevState, false, timeLimit);\n        return {\n            tokens: r.lineTokens.getResult(r.ruleStack, r.lineLength),\n            ruleStack: r.ruleStack,\n            stoppedEarly: r.stoppedEarly,\n        };\n    }\n    tokenizeLine2(lineText, prevState, timeLimit = 0) {\n        const r = this._tokenize(lineText, prevState, true, timeLimit);\n        return {\n            tokens: r.lineTokens.getBinaryResult(r.ruleStack, r.lineLength),\n            ruleStack: r.ruleStack,\n            stoppedEarly: r.stoppedEarly,\n        };\n    }\n    _tokenize(lineText, prevState, emitBinaryTokens, timeLimit) {\n        if (this._rootId === -1) {\n            this._rootId = rule_1.RuleFactory.getCompiledRuleId(this._grammar.repository.$self, this, this._grammar.repository);\n        }\n        let isFirstLine;\n        if (!prevState || prevState === StateStack.NULL) {\n            isFirstLine = true;\n            const rawDefaultMetadata = this._basicScopeAttributesProvider.getDefaultAttributes();\n            const defaultStyle = this.themeProvider.getDefaults();\n            const defaultMetadata = encodedTokenAttributes_1.EncodedTokenAttributes.set(0, rawDefaultMetadata.languageId, rawDefaultMetadata.tokenType, null, defaultStyle.fontStyle, defaultStyle.foregroundId, defaultStyle.backgroundId);\n            const rootScopeName = this.getRule(this._rootId).getName(null, null);\n            let scopeList;\n            if (rootScopeName) {\n                scopeList = AttributedScopeStack.createRootAndLookUpScopeName(rootScopeName, defaultMetadata, this);\n            }\n            else {\n                scopeList = AttributedScopeStack.createRoot(\"unknown\", defaultMetadata);\n            }\n            prevState = new StateStack(null, this._rootId, -1, -1, false, null, scopeList, scopeList);\n        }\n        else {\n            isFirstLine = false;\n            prevState.reset();\n        }\n        lineText = lineText + \"\\n\";\n        const onigLineText = this.createOnigString(lineText);\n        const lineLength = onigLineText.content.length;\n        const lineTokens = new LineTokens(emitBinaryTokens, lineText, this._tokenTypeMatchers, this.balancedBracketSelectors);\n        const r = tokenizeString_1._tokenizeString(this, onigLineText, isFirstLine, 0, prevState, lineTokens, true, timeLimit);\n        onigLib_1.disposeOnigString(onigLineText);\n        return {\n            lineLength: lineLength,\n            lineTokens: lineTokens,\n            ruleStack: r.stack,\n            stoppedEarly: r.stoppedEarly,\n        };\n    }\n}\nexports.Grammar = Grammar;\nfunction initGrammar(grammar, base) {\n    grammar = utils_1.clone(grammar);\n    grammar.repository = grammar.repository || {};\n    grammar.repository.$self = {\n        $vscodeTextmateLocation: grammar.$vscodeTextmateLocation,\n        patterns: grammar.patterns,\n        name: grammar.scopeName\n    };\n    grammar.repository.$base = base || grammar.repository.$self;\n    return grammar;\n}\nclass AttributedScopeStack {\n    constructor(parent, scopePath, tokenAttributes) {\n        this.parent = parent;\n        this.scopePath = scopePath;\n        this.tokenAttributes = tokenAttributes;\n    }\n    static createRoot(scopeName, tokenAttributes) {\n        return new AttributedScopeStack(null, new theme_1.ScopeStack(null, scopeName), tokenAttributes);\n    }\n    static createRootAndLookUpScopeName(scopeName, tokenAttributes, grammar) {\n        const rawRootMetadata = grammar.getMetadataForScope(scopeName);\n        const scopePath = new theme_1.ScopeStack(null, scopeName);\n        const rootStyle = grammar.themeProvider.themeMatch(scopePath);\n        const resolvedTokenAttributes = AttributedScopeStack.mergeAttributes(tokenAttributes, rawRootMetadata, rootStyle);\n        return new AttributedScopeStack(null, scopePath, resolvedTokenAttributes);\n    }\n    get scopeName() { return this.scopePath.scopeName; }\n    equals(other) {\n        return AttributedScopeStack._equals(this, other);\n    }\n    static _equals(a, b) {\n        do {\n            if (a === b) {\n                return true;\n            }\n            if (!a && !b) {\n                // End of list reached for both\n                return true;\n            }\n            if (!a || !b) {\n                // End of list reached only for one\n                return false;\n            }\n            if (a.scopeName !== b.scopeName || a.tokenAttributes !== b.tokenAttributes) {\n                return false;\n            }\n            // Go to previous pair\n            a = a.parent;\n            b = b.parent;\n        } while (true);\n    }\n    static mergeAttributes(existingTokenAttributes, basicScopeAttributes, styleAttributes) {\n        let fontStyle = -1 /* NotSet */;\n        let foreground = 0;\n        let background = 0;\n        if (styleAttributes !== null) {\n            fontStyle = styleAttributes.fontStyle;\n            foreground = styleAttributes.foregroundId;\n            background = styleAttributes.backgroundId;\n        }\n        return encodedTokenAttributes_1.EncodedTokenAttributes.set(existingTokenAttributes, basicScopeAttributes.languageId, basicScopeAttributes.tokenType, null, fontStyle, foreground, background);\n    }\n    pushAttributed(scopePath, grammar) {\n        if (scopePath === null) {\n            return this;\n        }\n        if (scopePath.indexOf(' ') === -1) {\n            // This is the common case and much faster\n            return AttributedScopeStack._pushAttributed(this, scopePath, grammar);\n        }\n        const scopes = scopePath.split(/ /g);\n        let result = this;\n        for (const scope of scopes) {\n            result = AttributedScopeStack._pushAttributed(result, scope, grammar);\n        }\n        return result;\n    }\n    static _pushAttributed(target, scopeName, grammar) {\n        const rawMetadata = grammar.getMetadataForScope(scopeName);\n        const newPath = target.scopePath.push(scopeName);\n        const scopeThemeMatchResult = grammar.themeProvider.themeMatch(newPath);\n        const metadata = AttributedScopeStack.mergeAttributes(target.tokenAttributes, rawMetadata, scopeThemeMatchResult);\n        return new AttributedScopeStack(target, newPath, metadata);\n    }\n    getScopeNames() {\n        return this.scopePath.getSegments();\n    }\n}\nexports.AttributedScopeStack = AttributedScopeStack;\n/**\n * Represents a \"pushed\" state on the stack (as a linked list element).\n */\nclass StateStack {\n    constructor(\n    /**\n     * The previous state on the stack (or null for the root state).\n     */\n    parent, \n    /**\n     * The state (rule) that this element represents.\n     */\n    ruleId, enterPos, anchorPos, \n    /**\n     * The state has entered and captured \\n. This means that the next line should have an anchorPosition of 0.\n     */\n    beginRuleCapturedEOL, \n    /**\n     * The \"pop\" (end) condition for this state in case that it was dynamically generated through captured text.\n     */\n    endRule, \n    /**\n     * The list of scopes containing the \"name\" for this state.\n     */\n    nameScopesList, \n    /**\n     * The list of scopes containing the \"contentName\" (besides \"name\") for this state.\n     * This list **must** contain as an element `scopeName`.\n     */\n    contentNameScopesList) {\n        this.parent = parent;\n        this.ruleId = ruleId;\n        this.beginRuleCapturedEOL = beginRuleCapturedEOL;\n        this.endRule = endRule;\n        this.nameScopesList = nameScopesList;\n        this.contentNameScopesList = contentNameScopesList;\n        this._stackElementBrand = undefined;\n        this.depth = this.parent ? this.parent.depth + 1 : 1;\n        this._enterPos = enterPos;\n        this._anchorPos = anchorPos;\n    }\n    equals(other) {\n        if (other === null) {\n            return false;\n        }\n        return StateStack._equals(this, other);\n    }\n    static _equals(a, b) {\n        if (a === b) {\n            return true;\n        }\n        if (!this._structuralEquals(a, b)) {\n            return false;\n        }\n        return a.contentNameScopesList.equals(b.contentNameScopesList);\n    }\n    /**\n     * A structural equals check. Does not take into account `scopes`.\n     */\n    static _structuralEquals(a, b) {\n        do {\n            if (a === b) {\n                return true;\n            }\n            if (!a && !b) {\n                // End of list reached for both\n                return true;\n            }\n            if (!a || !b) {\n                // End of list reached only for one\n                return false;\n            }\n            if (a.depth !== b.depth ||\n                a.ruleId !== b.ruleId ||\n                a.endRule !== b.endRule) {\n                return false;\n            }\n            // Go to previous pair\n            a = a.parent;\n            b = b.parent;\n        } while (true);\n    }\n    clone() {\n        return this;\n    }\n    static _reset(el) {\n        while (el) {\n            el._enterPos = -1;\n            el._anchorPos = -1;\n            el = el.parent;\n        }\n    }\n    reset() {\n        StateStack._reset(this);\n    }\n    pop() {\n        return this.parent;\n    }\n    safePop() {\n        if (this.parent) {\n            return this.parent;\n        }\n        return this;\n    }\n    push(ruleId, enterPos, anchorPos, beginRuleCapturedEOL, endRule, nameScopesList, contentNameScopesList) {\n        return new StateStack(this, ruleId, enterPos, anchorPos, beginRuleCapturedEOL, endRule, nameScopesList, contentNameScopesList);\n    }\n    getEnterPos() {\n        return this._enterPos;\n    }\n    getAnchorPos() {\n        return this._anchorPos;\n    }\n    getRule(grammar) {\n        return grammar.getRule(this.ruleId);\n    }\n    toString() {\n        const r = [];\n        this._writeString(r, 0);\n        return \"[\" + r.join(\",\") + \"]\";\n    }\n    _writeString(res, outIndex) {\n        if (this.parent) {\n            outIndex = this.parent._writeString(res, outIndex);\n        }\n        res[outIndex++] = `(${this.ruleId}, TODO-${this.nameScopesList}, TODO-${this.contentNameScopesList})`;\n        return outIndex;\n    }\n    withContentNameScopesList(contentNameScopeStack) {\n        if (this.contentNameScopesList === contentNameScopeStack) {\n            return this;\n        }\n        return this.parent.push(this.ruleId, this._enterPos, this._anchorPos, this.beginRuleCapturedEOL, this.endRule, this.nameScopesList, contentNameScopeStack);\n    }\n    withEndRule(endRule) {\n        if (this.endRule === endRule) {\n            return this;\n        }\n        return new StateStack(this.parent, this.ruleId, this._enterPos, this._anchorPos, this.beginRuleCapturedEOL, endRule, this.nameScopesList, this.contentNameScopesList);\n    }\n    // Used to warn of endless loops\n    hasSameRuleAs(other) {\n        let el = this;\n        while (el && el._enterPos === other._enterPos) {\n            if (el.ruleId === other.ruleId) {\n                return true;\n            }\n            el = el.parent;\n        }\n        return false;\n    }\n}\nexports.StateStack = StateStack;\n// TODO remove me\nStateStack.NULL = new StateStack(null, 0, 0, 0, false, null, null, null);\nclass BalancedBracketSelectors {\n    constructor(balancedBracketScopes, unbalancedBracketScopes) {\n        this.allowAny = false;\n        this.balancedBracketScopes = balancedBracketScopes.flatMap((selector) => {\n            if (selector === '*') {\n                this.allowAny = true;\n                return [];\n            }\n            return matcher_1.createMatchers(selector, nameMatcher).map((m) => m.matcher);\n        });\n        this.unbalancedBracketScopes = unbalancedBracketScopes.flatMap((selector) => matcher_1.createMatchers(selector, nameMatcher).map((m) => m.matcher));\n    }\n    get matchesAlways() {\n        return this.allowAny && this.unbalancedBracketScopes.length === 0;\n    }\n    get matchesNever() {\n        return this.balancedBracketScopes.length === 0 && !this.allowAny;\n    }\n    match(scopes) {\n        for (const excluder of this.unbalancedBracketScopes) {\n            if (excluder(scopes)) {\n                return false;\n            }\n        }\n        for (const includer of this.balancedBracketScopes) {\n            if (includer(scopes)) {\n                return true;\n            }\n        }\n        return this.allowAny;\n    }\n}\nexports.BalancedBracketSelectors = BalancedBracketSelectors;\nclass LineTokens {\n    constructor(emitBinaryTokens, lineText, tokenTypeOverrides, balancedBracketSelectors) {\n        this.balancedBracketSelectors = balancedBracketSelectors;\n        this._emitBinaryTokens = emitBinaryTokens;\n        this._tokenTypeOverrides = tokenTypeOverrides;\n        if (debug_1.DebugFlags.InDebugMode) {\n            this._lineText = lineText;\n        }\n        else {\n            this._lineText = null;\n        }\n        this._tokens = [];\n        this._binaryTokens = [];\n        this._lastTokenEndIndex = 0;\n    }\n    produce(stack, endIndex) {\n        this.produceFromScopes(stack.contentNameScopesList, endIndex);\n    }\n    produceFromScopes(scopesList, endIndex) {\n        if (this._lastTokenEndIndex >= endIndex) {\n            return;\n        }\n        if (this._emitBinaryTokens) {\n            let metadata = scopesList.tokenAttributes;\n            let containsBalancedBrackets = false;\n            if (this.balancedBracketSelectors?.matchesAlways) {\n                containsBalancedBrackets = true;\n            }\n            if (this._tokenTypeOverrides.length > 0 || (this.balancedBracketSelectors && !this.balancedBracketSelectors.matchesAlways && !this.balancedBracketSelectors.matchesNever)) {\n                // Only generate scope array when required to improve performance\n                const scopes = scopesList.getScopeNames();\n                for (const tokenType of this._tokenTypeOverrides) {\n                    if (tokenType.matcher(scopes)) {\n                        metadata = encodedTokenAttributes_1.EncodedTokenAttributes.set(metadata, 0, encodedTokenAttributes_1.toOptionalTokenType(tokenType.type), null, -1 /* NotSet */, 0, 0);\n                    }\n                }\n                if (this.balancedBracketSelectors) {\n                    containsBalancedBrackets = this.balancedBracketSelectors.match(scopes);\n                }\n            }\n            if (containsBalancedBrackets) {\n                metadata = encodedTokenAttributes_1.EncodedTokenAttributes.set(metadata, 0, 8 /* NotSet */, containsBalancedBrackets, -1 /* NotSet */, 0, 0);\n            }\n            if (this._binaryTokens.length > 0 && this._binaryTokens[this._binaryTokens.length - 1] === metadata) {\n                // no need to push a token with the same metadata\n                this._lastTokenEndIndex = endIndex;\n                return;\n            }\n            if (debug_1.DebugFlags.InDebugMode) {\n                const scopes = scopesList.getScopeNames();\n                console.log('  token: |' + this._lineText.substring(this._lastTokenEndIndex, endIndex).replace(/\\n$/, '\\\\n') + '|');\n                for (let k = 0; k < scopes.length; k++) {\n                    console.log('      * ' + scopes[k]);\n                }\n            }\n            this._binaryTokens.push(this._lastTokenEndIndex);\n            this._binaryTokens.push(metadata);\n            this._lastTokenEndIndex = endIndex;\n            return;\n        }\n        const scopes = scopesList.getScopeNames();\n        if (debug_1.DebugFlags.InDebugMode) {\n            console.log('  token: |' + this._lineText.substring(this._lastTokenEndIndex, endIndex).replace(/\\n$/, '\\\\n') + '|');\n            for (let k = 0; k < scopes.length; k++) {\n                console.log('      * ' + scopes[k]);\n            }\n        }\n        this._tokens.push({\n            startIndex: this._lastTokenEndIndex,\n            endIndex: endIndex,\n            // value: lineText.substring(lastTokenEndIndex, endIndex),\n            scopes: scopes\n        });\n        this._lastTokenEndIndex = endIndex;\n    }\n    getResult(stack, lineLength) {\n        if (this._tokens.length > 0 && this._tokens[this._tokens.length - 1].startIndex === lineLength - 1) {\n            // pop produced token for newline\n            this._tokens.pop();\n        }\n        if (this._tokens.length === 0) {\n            this._lastTokenEndIndex = -1;\n            this.produce(stack, lineLength);\n            this._tokens[this._tokens.length - 1].startIndex = 0;\n        }\n        return this._tokens;\n    }\n    getBinaryResult(stack, lineLength) {\n        if (this._binaryTokens.length > 0 && this._binaryTokens[this._binaryTokens.length - 2] === lineLength - 1) {\n            // pop produced token for newline\n            this._binaryTokens.pop();\n            this._binaryTokens.pop();\n        }\n        if (this._binaryTokens.length === 0) {\n            this._lastTokenEndIndex = -1;\n            this.produce(stack, lineLength);\n            this._binaryTokens[this._binaryTokens.length - 2] = 0;\n        }\n        const result = new Uint32Array(this._binaryTokens.length);\n        for (let i = 0, len = this._binaryTokens.length; i < len; i++) {\n            result[i] = this._binaryTokens[i];\n        }\n        return result;\n    }\n}\nexports.LineTokens = LineTokens;\n//# sourceMappingURL=grammar.js.map", "\"use strict\";\n/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.parseInclude = exports.TopLevelRepositoryReference = exports.TopLevelReference = exports.RelativeReference = exports.SelfReference = exports.BaseReference = exports.ScopeDependencyProcessor = exports.ExternalReferenceCollector = exports.TopLevelRepositoryRuleReference = exports.TopLevelRuleReference = void 0;\nconst utils_1 = require(\"../utils\");\n/**\n * References the top level rule of a grammar with the given scope name.\n*/\nclass TopLevelRuleReference {\n    constructor(scopeName) {\n        this.scopeName = scopeName;\n    }\n    toKey() {\n        return this.scopeName;\n    }\n}\nexports.TopLevelRuleReference = TopLevelRuleReference;\n/**\n * References a rule of a grammar in the top level repository section with the given name.\n*/\nclass TopLevelRepositoryRuleReference {\n    constructor(scopeName, ruleName) {\n        this.scopeName = scopeName;\n        this.ruleName = ruleName;\n    }\n    toKey() {\n        return `${this.scopeName}#${this.ruleName}`;\n    }\n}\nexports.TopLevelRepositoryRuleReference = TopLevelRepositoryRuleReference;\nclass ExternalReferenceCollector {\n    constructor() {\n        this._references = [];\n        this._seenReferenceKeys = new Set();\n        this.visitedRule = new Set();\n    }\n    get references() {\n        return this._references;\n    }\n    add(reference) {\n        const key = reference.toKey();\n        if (this._seenReferenceKeys.has(key)) {\n            return;\n        }\n        this._seenReferenceKeys.add(key);\n        this._references.push(reference);\n    }\n}\nexports.ExternalReferenceCollector = ExternalReferenceCollector;\nclass ScopeDependencyProcessor {\n    constructor(repo, initialScopeName) {\n        this.repo = repo;\n        this.initialScopeName = initialScopeName;\n        this.seenFullScopeRequests = new Set();\n        this.seenPartialScopeRequests = new Set();\n        this.seenFullScopeRequests.add(this.initialScopeName);\n        this.Q = [new TopLevelRuleReference(this.initialScopeName)];\n    }\n    processQueue() {\n        const q = this.Q;\n        this.Q = [];\n        const deps = new ExternalReferenceCollector();\n        for (const dep of q) {\n            collectReferencesOfReference(dep, this.initialScopeName, this.repo, deps);\n        }\n        for (const dep of deps.references) {\n            if (dep instanceof TopLevelRuleReference) {\n                if (this.seenFullScopeRequests.has(dep.scopeName)) {\n                    // already processed\n                    continue;\n                }\n                this.seenFullScopeRequests.add(dep.scopeName);\n                this.Q.push(dep);\n            }\n            else {\n                if (this.seenFullScopeRequests.has(dep.scopeName)) {\n                    // already processed in full\n                    continue;\n                }\n                if (this.seenPartialScopeRequests.has(dep.toKey())) {\n                    // already processed\n                    continue;\n                }\n                this.seenPartialScopeRequests.add(dep.toKey());\n                this.Q.push(dep);\n            }\n        }\n    }\n}\nexports.ScopeDependencyProcessor = ScopeDependencyProcessor;\nfunction collectReferencesOfReference(reference, baseGrammarScopeName, repo, result) {\n    const selfGrammar = repo.lookup(reference.scopeName);\n    if (!selfGrammar) {\n        if (reference.scopeName === baseGrammarScopeName) {\n            throw new Error(`No grammar provided for <${baseGrammarScopeName}>`);\n        }\n        return;\n    }\n    const baseGrammar = repo.lookup(baseGrammarScopeName);\n    if (reference instanceof TopLevelRuleReference) {\n        collectExternalReferencesInTopLevelRule({ baseGrammar, selfGrammar }, result);\n    }\n    else {\n        collectExternalReferencesInTopLevelRepositoryRule(reference.ruleName, { baseGrammar, selfGrammar, repository: selfGrammar.repository }, result);\n    }\n    const injections = repo.injections(reference.scopeName);\n    if (injections) {\n        for (const injection of injections) {\n            result.add(new TopLevelRuleReference(injection));\n        }\n    }\n}\nfunction collectExternalReferencesInTopLevelRepositoryRule(ruleName, context, result) {\n    if (context.repository && context.repository[ruleName]) {\n        const rule = context.repository[ruleName];\n        collectExternalReferencesInRules([rule], context, result);\n    }\n}\nfunction collectExternalReferencesInTopLevelRule(context, result) {\n    if (context.selfGrammar.patterns && Array.isArray(context.selfGrammar.patterns)) {\n        collectExternalReferencesInRules(context.selfGrammar.patterns, { ...context, repository: context.selfGrammar.repository }, result);\n    }\n    if (context.selfGrammar.injections) {\n        collectExternalReferencesInRules(Object.values(context.selfGrammar.injections), { ...context, repository: context.selfGrammar.repository }, result);\n    }\n}\nfunction collectExternalReferencesInRules(rules, context, result) {\n    for (const rule of rules) {\n        if (result.visitedRule.has(rule)) {\n            continue;\n        }\n        result.visitedRule.add(rule);\n        const patternRepository = rule.repository ? utils_1.mergeObjects({}, context.repository, rule.repository) : context.repository;\n        if (Array.isArray(rule.patterns)) {\n            collectExternalReferencesInRules(rule.patterns, { ...context, repository: patternRepository }, result);\n        }\n        const include = rule.include;\n        if (!include) {\n            continue;\n        }\n        const reference = parseInclude(include);\n        switch (reference.kind) {\n            case 0 /* Base */:\n                collectExternalReferencesInTopLevelRule({ ...context, selfGrammar: context.baseGrammar }, result);\n                break;\n            case 1 /* Self */:\n                collectExternalReferencesInTopLevelRule(context, result);\n                break;\n            case 2 /* RelativeReference */:\n                collectExternalReferencesInTopLevelRepositoryRule(reference.ruleName, { ...context, repository: patternRepository }, result);\n                break;\n            case 3 /* TopLevelReference */:\n            case 4 /* TopLevelRepositoryReference */:\n                const selfGrammar = reference.scopeName === context.selfGrammar.scopeName\n                    ? context.selfGrammar\n                    : reference.scopeName === context.baseGrammar.scopeName\n                        ? context.baseGrammar\n                        : undefined;\n                if (selfGrammar) {\n                    const newContext = { baseGrammar: context.baseGrammar, selfGrammar, repository: patternRepository };\n                    if (reference.kind === 4 /* TopLevelRepositoryReference */) {\n                        collectExternalReferencesInTopLevelRepositoryRule(reference.ruleName, newContext, result);\n                    }\n                    else {\n                        collectExternalReferencesInTopLevelRule(newContext, result);\n                    }\n                }\n                else {\n                    if (reference.kind === 4 /* TopLevelRepositoryReference */) {\n                        result.add(new TopLevelRepositoryRuleReference(reference.scopeName, reference.ruleName));\n                    }\n                    else {\n                        result.add(new TopLevelRuleReference(reference.scopeName));\n                    }\n                }\n                break;\n        }\n    }\n}\nclass BaseReference {\n    constructor() {\n        this.kind = 0 /* Base */;\n    }\n}\nexports.BaseReference = BaseReference;\nclass SelfReference {\n    constructor() {\n        this.kind = 1 /* Self */;\n    }\n}\nexports.SelfReference = SelfReference;\nclass RelativeReference {\n    constructor(ruleName) {\n        this.ruleName = ruleName;\n        this.kind = 2 /* RelativeReference */;\n    }\n}\nexports.RelativeReference = RelativeReference;\nclass TopLevelReference {\n    constructor(scopeName) {\n        this.scopeName = scopeName;\n        this.kind = 3 /* TopLevelReference */;\n    }\n}\nexports.TopLevelReference = TopLevelReference;\nclass TopLevelRepositoryReference {\n    constructor(scopeName, ruleName) {\n        this.scopeName = scopeName;\n        this.ruleName = ruleName;\n        this.kind = 4 /* TopLevelRepositoryReference */;\n    }\n}\nexports.TopLevelRepositoryReference = TopLevelRepositoryReference;\nfunction parseInclude(include) {\n    if (include === '$base') {\n        return new BaseReference();\n    }\n    else if (include === '$self') {\n        return new SelfReference();\n    }\n    const indexOfSharp = include.indexOf(\"#\");\n    if (indexOfSharp === -1) {\n        return new TopLevelReference(include);\n    }\n    else if (indexOfSharp === 0) {\n        return new RelativeReference(include.substring(1));\n    }\n    else {\n        const scopeName = include.substring(0, indexOfSharp);\n        const ruleName = include.substring(indexOfSharp + 1);\n        return new TopLevelRepositoryReference(scopeName, ruleName);\n    }\n}\nexports.parseInclude = parseInclude;\n//# sourceMappingURL=grammarDependencies.js.map", "\"use strict\";\n/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./grammar\"), exports);\n//# sourceMappingURL=index.js.map", "\"use strict\";\n/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.LocalStackElement = exports._tokenizeString = void 0;\nconst debug_1 = require(\"../debug\");\nconst onigLib_1 = require(\"../onigLib\");\nconst rule_1 = require(\"../rule\");\nconst utils_1 = require(\"../utils\");\nclass TokenizeStringResult {\n    constructor(stack, stoppedEarly) {\n        this.stack = stack;\n        this.stoppedEarly = stoppedEarly;\n    }\n}\n/**\n * Tokenize a string\n * @param grammar\n * @param lineText\n * @param isFirstLine\n * @param linePos\n * @param stack\n * @param lineTokens\n * @param checkWhileConditions\n * @param timeLimit Use `0` to indicate no time limit\n * @returns the StackElement or StackElement.TIME_LIMIT_REACHED if the time limit has been reached\n */\nfunction _tokenizeString(grammar, lineText, isFirstLine, linePos, stack, lineTokens, checkWhileConditions, timeLimit) {\n    const lineLength = lineText.content.length;\n    let STOP = false;\n    let anchorPosition = -1;\n    if (checkWhileConditions) {\n        const whileCheckResult = _checkWhileConditions(grammar, lineText, isFirstLine, linePos, stack, lineTokens);\n        stack = whileCheckResult.stack;\n        linePos = whileCheckResult.linePos;\n        isFirstLine = whileCheckResult.isFirstLine;\n        anchorPosition = whileCheckResult.anchorPosition;\n    }\n    const startTime = Date.now();\n    while (!STOP) {\n        if (timeLimit !== 0) {\n            const elapsedTime = Date.now() - startTime;\n            if (elapsedTime > timeLimit) {\n                return new TokenizeStringResult(stack, true);\n            }\n        }\n        scanNext(); // potentially modifies linePos && anchorPosition\n    }\n    return new TokenizeStringResult(stack, false);\n    function scanNext() {\n        if (debug_1.DebugFlags.InDebugMode) {\n            console.log(\"\");\n            console.log(`@@scanNext ${linePos}: |${lineText.content\n                .substr(linePos)\n                .replace(/\\n$/, \"\\\\n\")}|`);\n        }\n        const r = matchRuleOrInjections(grammar, lineText, isFirstLine, linePos, stack, anchorPosition);\n        if (!r) {\n            if (debug_1.DebugFlags.InDebugMode) {\n                console.log(\"  no more matches.\");\n            }\n            // No match\n            lineTokens.produce(stack, lineLength);\n            STOP = true;\n            return;\n        }\n        const captureIndices = r.captureIndices;\n        const matchedRuleId = r.matchedRuleId;\n        const hasAdvanced = captureIndices && captureIndices.length > 0\n            ? captureIndices[0].end > linePos\n            : false;\n        if (matchedRuleId === rule_1.endRuleId) {\n            // We matched the `end` for this rule => pop it\n            const poppedRule = stack.getRule(grammar);\n            if (debug_1.DebugFlags.InDebugMode) {\n                console.log(\"  popping \" +\n                    poppedRule.debugName +\n                    \" - \" +\n                    poppedRule.debugEndRegExp);\n            }\n            lineTokens.produce(stack, captureIndices[0].start);\n            stack = stack.withContentNameScopesList(stack.nameScopesList);\n            handleCaptures(grammar, lineText, isFirstLine, stack, lineTokens, poppedRule.endCaptures, captureIndices);\n            lineTokens.produce(stack, captureIndices[0].end);\n            // pop\n            const popped = stack;\n            stack = stack.parent;\n            anchorPosition = popped.getAnchorPos();\n            if (!hasAdvanced && popped.getEnterPos() === linePos) {\n                // Grammar pushed & popped a rule without advancing\n                if (debug_1.DebugFlags.InDebugMode) {\n                    console.error(\"[1] - Grammar is in an endless loop - Grammar pushed & popped a rule without advancing\");\n                }\n                // See https://github.com/Microsoft/vscode-textmate/issues/12\n                // Let's assume this was a mistake by the grammar author and the intent was to continue in this state\n                stack = popped;\n                lineTokens.produce(stack, lineLength);\n                STOP = true;\n                return;\n            }\n        }\n        else {\n            // We matched a rule!\n            const _rule = grammar.getRule(matchedRuleId);\n            lineTokens.produce(stack, captureIndices[0].start);\n            const beforePush = stack;\n            // push it on the stack rule\n            const scopeName = _rule.getName(lineText.content, captureIndices);\n            const nameScopesList = stack.contentNameScopesList.pushAttributed(scopeName, grammar);\n            stack = stack.push(matchedRuleId, linePos, anchorPosition, captureIndices[0].end === lineLength, null, nameScopesList, nameScopesList);\n            if (_rule instanceof rule_1.BeginEndRule) {\n                const pushedRule = _rule;\n                if (debug_1.DebugFlags.InDebugMode) {\n                    console.log(\"  pushing \" +\n                        pushedRule.debugName +\n                        \" - \" +\n                        pushedRule.debugBeginRegExp);\n                }\n                handleCaptures(grammar, lineText, isFirstLine, stack, lineTokens, pushedRule.beginCaptures, captureIndices);\n                lineTokens.produce(stack, captureIndices[0].end);\n                anchorPosition = captureIndices[0].end;\n                const contentName = pushedRule.getContentName(lineText.content, captureIndices);\n                const contentNameScopesList = nameScopesList.pushAttributed(contentName, grammar);\n                stack = stack.withContentNameScopesList(contentNameScopesList);\n                if (pushedRule.endHasBackReferences) {\n                    stack = stack.withEndRule(pushedRule.getEndWithResolvedBackReferences(lineText.content, captureIndices));\n                }\n                if (!hasAdvanced && beforePush.hasSameRuleAs(stack)) {\n                    // Grammar pushed the same rule without advancing\n                    if (debug_1.DebugFlags.InDebugMode) {\n                        console.error(\"[2] - Grammar is in an endless loop - Grammar pushed the same rule without advancing\");\n                    }\n                    stack = stack.pop();\n                    lineTokens.produce(stack, lineLength);\n                    STOP = true;\n                    return;\n                }\n            }\n            else if (_rule instanceof rule_1.BeginWhileRule) {\n                const pushedRule = _rule;\n                if (debug_1.DebugFlags.InDebugMode) {\n                    console.log(\"  pushing \" + pushedRule.debugName);\n                }\n                handleCaptures(grammar, lineText, isFirstLine, stack, lineTokens, pushedRule.beginCaptures, captureIndices);\n                lineTokens.produce(stack, captureIndices[0].end);\n                anchorPosition = captureIndices[0].end;\n                const contentName = pushedRule.getContentName(lineText.content, captureIndices);\n                const contentNameScopesList = nameScopesList.pushAttributed(contentName, grammar);\n                stack = stack.withContentNameScopesList(contentNameScopesList);\n                if (pushedRule.whileHasBackReferences) {\n                    stack = stack.withEndRule(pushedRule.getWhileWithResolvedBackReferences(lineText.content, captureIndices));\n                }\n                if (!hasAdvanced && beforePush.hasSameRuleAs(stack)) {\n                    // Grammar pushed the same rule without advancing\n                    if (debug_1.DebugFlags.InDebugMode) {\n                        console.error(\"[3] - Grammar is in an endless loop - Grammar pushed the same rule without advancing\");\n                    }\n                    stack = stack.pop();\n                    lineTokens.produce(stack, lineLength);\n                    STOP = true;\n                    return;\n                }\n            }\n            else {\n                const matchingRule = _rule;\n                if (debug_1.DebugFlags.InDebugMode) {\n                    console.log(\"  matched \" +\n                        matchingRule.debugName +\n                        \" - \" +\n                        matchingRule.debugMatchRegExp);\n                }\n                handleCaptures(grammar, lineText, isFirstLine, stack, lineTokens, matchingRule.captures, captureIndices);\n                lineTokens.produce(stack, captureIndices[0].end);\n                // pop rule immediately since it is a MatchRule\n                stack = stack.pop();\n                if (!hasAdvanced) {\n                    // Grammar is not advancing, nor is it pushing/popping\n                    if (debug_1.DebugFlags.InDebugMode) {\n                        console.error(\"[4] - Grammar is in an endless loop - Grammar is not advancing, nor is it pushing/popping\");\n                    }\n                    stack = stack.safePop();\n                    lineTokens.produce(stack, lineLength);\n                    STOP = true;\n                    return;\n                }\n            }\n        }\n        if (captureIndices[0].end > linePos) {\n            // Advance stream\n            linePos = captureIndices[0].end;\n            isFirstLine = false;\n        }\n    }\n}\nexports._tokenizeString = _tokenizeString;\n/**\n * Walk the stack from bottom to top, and check each while condition in this order.\n * If any fails, cut off the entire stack above the failed while condition. While conditions\n * may also advance the linePosition.\n */\nfunction _checkWhileConditions(grammar, lineText, isFirstLine, linePos, stack, lineTokens) {\n    let anchorPosition = (stack.beginRuleCapturedEOL ? 0 : -1);\n    const whileRules = [];\n    for (let node = stack; node; node = node.pop()) {\n        const nodeRule = node.getRule(grammar);\n        if (nodeRule instanceof rule_1.BeginWhileRule) {\n            whileRules.push({\n                rule: nodeRule,\n                stack: node\n            });\n        }\n    }\n    for (let whileRule = whileRules.pop(); whileRule; whileRule = whileRules.pop()) {\n        const { ruleScanner, findOptions } = prepareRuleWhileSearch(whileRule.rule, grammar, whileRule.stack.endRule, isFirstLine, linePos === anchorPosition);\n        const r = ruleScanner.findNextMatchSync(lineText, linePos, findOptions);\n        if (debug_1.DebugFlags.InDebugMode) {\n            console.log('  scanning for while rule');\n            console.log(ruleScanner.toString());\n        }\n        if (r) {\n            const matchedRuleId = r.ruleId;\n            if (matchedRuleId !== rule_1.whileRuleId) {\n                // we shouldn't end up here\n                stack = whileRule.stack.pop();\n                break;\n            }\n            if (r.captureIndices && r.captureIndices.length) {\n                lineTokens.produce(whileRule.stack, r.captureIndices[0].start);\n                handleCaptures(grammar, lineText, isFirstLine, whileRule.stack, lineTokens, whileRule.rule.whileCaptures, r.captureIndices);\n                lineTokens.produce(whileRule.stack, r.captureIndices[0].end);\n                anchorPosition = r.captureIndices[0].end;\n                if (r.captureIndices[0].end > linePos) {\n                    linePos = r.captureIndices[0].end;\n                    isFirstLine = false;\n                }\n            }\n        }\n        else {\n            if (debug_1.DebugFlags.InDebugMode) {\n                console.log('  popping ' + whileRule.rule.debugName + ' - ' + whileRule.rule.debugWhileRegExp);\n            }\n            stack = whileRule.stack.pop();\n            break;\n        }\n    }\n    return { stack: stack, linePos: linePos, anchorPosition: anchorPosition, isFirstLine: isFirstLine };\n}\nfunction matchRuleOrInjections(grammar, lineText, isFirstLine, linePos, stack, anchorPosition) {\n    // Look for normal grammar rule\n    const matchResult = matchRule(grammar, lineText, isFirstLine, linePos, stack, anchorPosition);\n    // Look for injected rules\n    const injections = grammar.getInjections();\n    if (injections.length === 0) {\n        // No injections whatsoever => early return\n        return matchResult;\n    }\n    const injectionResult = matchInjections(injections, grammar, lineText, isFirstLine, linePos, stack, anchorPosition);\n    if (!injectionResult) {\n        // No injections matched => early return\n        return matchResult;\n    }\n    if (!matchResult) {\n        // Only injections matched => early return\n        return injectionResult;\n    }\n    // Decide if `matchResult` or `injectionResult` should win\n    const matchResultScore = matchResult.captureIndices[0].start;\n    const injectionResultScore = injectionResult.captureIndices[0].start;\n    if (injectionResultScore < matchResultScore || (injectionResult.priorityMatch && injectionResultScore === matchResultScore)) {\n        // injection won!\n        return injectionResult;\n    }\n    return matchResult;\n}\nfunction matchRule(grammar, lineText, isFirstLine, linePos, stack, anchorPosition) {\n    const rule = stack.getRule(grammar);\n    const { ruleScanner, findOptions } = prepareRuleSearch(rule, grammar, stack.endRule, isFirstLine, linePos === anchorPosition);\n    let perfStart = 0;\n    if (debug_1.DebugFlags.InDebugMode) {\n        perfStart = utils_1.performanceNow();\n    }\n    const r = ruleScanner.findNextMatchSync(lineText, linePos, findOptions);\n    if (debug_1.DebugFlags.InDebugMode) {\n        const elapsedMillis = utils_1.performanceNow() - perfStart;\n        if (elapsedMillis > 5) {\n            console.warn(`Rule ${rule.debugName} (${rule.id}) matching took ${elapsedMillis} against '${lineText}'`);\n        }\n        console.log(`  scanning for (linePos: ${linePos}, anchorPosition: ${anchorPosition})`);\n        console.log(ruleScanner.toString());\n        if (r) {\n            console.log(`matched rule id: ${r.ruleId} from ${r.captureIndices[0].start} to ${r.captureIndices[0].end}`);\n        }\n    }\n    if (r) {\n        return {\n            captureIndices: r.captureIndices,\n            matchedRuleId: r.ruleId\n        };\n    }\n    return null;\n}\nfunction matchInjections(injections, grammar, lineText, isFirstLine, linePos, stack, anchorPosition) {\n    // The lower the better\n    let bestMatchRating = Number.MAX_VALUE;\n    let bestMatchCaptureIndices = null;\n    let bestMatchRuleId;\n    let bestMatchResultPriority = 0;\n    const scopes = stack.contentNameScopesList.getScopeNames();\n    for (let i = 0, len = injections.length; i < len; i++) {\n        const injection = injections[i];\n        if (!injection.matcher(scopes)) {\n            // injection selector doesn't match stack\n            continue;\n        }\n        const rule = grammar.getRule(injection.ruleId);\n        const { ruleScanner, findOptions } = prepareRuleSearch(rule, grammar, null, isFirstLine, linePos === anchorPosition);\n        const matchResult = ruleScanner.findNextMatchSync(lineText, linePos, findOptions);\n        if (!matchResult) {\n            continue;\n        }\n        if (debug_1.DebugFlags.InDebugMode) {\n            console.log(`  matched injection: ${injection.debugSelector}`);\n            console.log(ruleScanner.toString());\n        }\n        const matchRating = matchResult.captureIndices[0].start;\n        if (matchRating >= bestMatchRating) {\n            // Injections are sorted by priority, so the previous injection had a better or equal priority\n            continue;\n        }\n        bestMatchRating = matchRating;\n        bestMatchCaptureIndices = matchResult.captureIndices;\n        bestMatchRuleId = matchResult.ruleId;\n        bestMatchResultPriority = injection.priority;\n        if (bestMatchRating === linePos) {\n            // No more need to look at the rest of the injections.\n            break;\n        }\n    }\n    if (bestMatchCaptureIndices) {\n        return {\n            priorityMatch: bestMatchResultPriority === -1,\n            captureIndices: bestMatchCaptureIndices,\n            matchedRuleId: bestMatchRuleId\n        };\n    }\n    return null;\n}\nfunction prepareRuleSearch(rule, grammar, endRegexSource, allowA, allowG) {\n    if (debug_1.UseOnigurumaFindOptions) {\n        const ruleScanner = rule.compile(grammar, endRegexSource);\n        const findOptions = getFindOptions(allowA, allowG);\n        return { ruleScanner, findOptions };\n    }\n    const ruleScanner = rule.compileAG(grammar, endRegexSource, allowA, allowG);\n    return { ruleScanner, findOptions: 0 /* None */ };\n}\nfunction prepareRuleWhileSearch(rule, grammar, endRegexSource, allowA, allowG) {\n    if (debug_1.UseOnigurumaFindOptions) {\n        const ruleScanner = rule.compileWhile(grammar, endRegexSource);\n        const findOptions = getFindOptions(allowA, allowG);\n        return { ruleScanner, findOptions };\n    }\n    const ruleScanner = rule.compileWhileAG(grammar, endRegexSource, allowA, allowG);\n    return { ruleScanner, findOptions: 0 /* None */ };\n}\nfunction getFindOptions(allowA, allowG) {\n    let options = 0 /* None */;\n    if (!allowA) {\n        options |= 1 /* NotBeginString */;\n    }\n    if (!allowG) {\n        options |= 4 /* NotBeginPosition */;\n    }\n    return options;\n}\nfunction handleCaptures(grammar, lineText, isFirstLine, stack, lineTokens, captures, captureIndices) {\n    if (captures.length === 0) {\n        return;\n    }\n    const lineTextContent = lineText.content;\n    const len = Math.min(captures.length, captureIndices.length);\n    const localStack = [];\n    const maxEnd = captureIndices[0].end;\n    for (let i = 0; i < len; i++) {\n        const captureRule = captures[i];\n        if (captureRule === null) {\n            // Not interested\n            continue;\n        }\n        const captureIndex = captureIndices[i];\n        if (captureIndex.length === 0) {\n            // Nothing really captured\n            continue;\n        }\n        if (captureIndex.start > maxEnd) {\n            // Capture going beyond consumed string\n            break;\n        }\n        // pop captures while needed\n        while (localStack.length > 0 && localStack[localStack.length - 1].endPos <= captureIndex.start) {\n            // pop!\n            lineTokens.produceFromScopes(localStack[localStack.length - 1].scopes, localStack[localStack.length - 1].endPos);\n            localStack.pop();\n        }\n        if (localStack.length > 0) {\n            lineTokens.produceFromScopes(localStack[localStack.length - 1].scopes, captureIndex.start);\n        }\n        else {\n            lineTokens.produce(stack, captureIndex.start);\n        }\n        if (captureRule.retokenizeCapturedWithRuleId) {\n            // the capture requires additional matching\n            const scopeName = captureRule.getName(lineTextContent, captureIndices);\n            const nameScopesList = stack.contentNameScopesList.pushAttributed(scopeName, grammar);\n            const contentName = captureRule.getContentName(lineTextContent, captureIndices);\n            const contentNameScopesList = nameScopesList.pushAttributed(contentName, grammar);\n            const stackClone = stack.push(captureRule.retokenizeCapturedWithRuleId, captureIndex.start, -1, false, null, nameScopesList, contentNameScopesList);\n            const onigSubStr = grammar.createOnigString(lineTextContent.substring(0, captureIndex.end));\n            _tokenizeString(grammar, onigSubStr, (isFirstLine && captureIndex.start === 0), captureIndex.start, stackClone, lineTokens, false, /* no time limit */ 0);\n            onigLib_1.disposeOnigString(onigSubStr);\n            continue;\n        }\n        const captureRuleScopeName = captureRule.getName(lineTextContent, captureIndices);\n        if (captureRuleScopeName !== null) {\n            // push\n            const base = localStack.length > 0 ? localStack[localStack.length - 1].scopes : stack.contentNameScopesList;\n            const captureRuleScopesList = base.pushAttributed(captureRuleScopeName, grammar);\n            localStack.push(new LocalStackElement(captureRuleScopesList, captureIndex.end));\n        }\n    }\n    while (localStack.length > 0) {\n        // pop!\n        lineTokens.produceFromScopes(localStack[localStack.length - 1].scopes, localStack[localStack.length - 1].endPos);\n        localStack.pop();\n    }\n}\nclass LocalStackElement {\n    constructor(scopes, endPos) {\n        this.scopes = scopes;\n        this.endPos = endPos;\n    }\n}\nexports.LocalStackElement = LocalStackElement;\n//# sourceMappingURL=tokenizeString.js.map", "\"use strict\";\n/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.parseJSON = void 0;\nfunction doFail(streamState, msg) {\n    // console.log('Near offset ' + streamState.pos + ': ' + msg + ' ~~~' + streamState.source.substr(streamState.pos, 50) + '~~~');\n    throw new Error('Near offset ' + streamState.pos + ': ' + msg + ' ~~~' + streamState.source.substr(streamState.pos, 50) + '~~~');\n}\nfunction parseJSON(source, filename, withMetadata) {\n    let streamState = new JSONStreamState(source);\n    let token = new JSONToken();\n    let state = 0 /* ROOT_STATE */;\n    let cur = null;\n    let stateStack = [];\n    let objStack = [];\n    function pushState() {\n        stateStack.push(state);\n        objStack.push(cur);\n    }\n    function popState() {\n        state = stateStack.pop();\n        cur = objStack.pop();\n    }\n    function fail(msg) {\n        doFail(streamState, msg);\n    }\n    while (nextJSONToken(streamState, token)) {\n        if (state === 0 /* ROOT_STATE */) {\n            if (cur !== null) {\n                fail('too many constructs in root');\n            }\n            if (token.type === 3 /* LEFT_CURLY_BRACKET */) {\n                cur = {};\n                if (withMetadata) {\n                    cur.$vscodeTextmateLocation = token.toLocation(filename);\n                }\n                pushState();\n                state = 1 /* DICT_STATE */;\n                continue;\n            }\n            if (token.type === 2 /* LEFT_SQUARE_BRACKET */) {\n                cur = [];\n                pushState();\n                state = 4 /* ARR_STATE */;\n                continue;\n            }\n            fail('unexpected token in root');\n        }\n        if (state === 2 /* DICT_STATE_COMMA */) {\n            if (token.type === 5 /* RIGHT_CURLY_BRACKET */) {\n                popState();\n                continue;\n            }\n            if (token.type === 7 /* COMMA */) {\n                state = 3 /* DICT_STATE_NO_CLOSE */;\n                continue;\n            }\n            fail('expected , or }');\n        }\n        if (state === 1 /* DICT_STATE */ || state === 3 /* DICT_STATE_NO_CLOSE */) {\n            if (state === 1 /* DICT_STATE */ && token.type === 5 /* RIGHT_CURLY_BRACKET */) {\n                popState();\n                continue;\n            }\n            if (token.type === 1 /* STRING */) {\n                let keyValue = token.value;\n                if (!nextJSONToken(streamState, token) || token.type !== 6 /* COLON */) {\n                    fail('expected colon');\n                }\n                if (!nextJSONToken(streamState, token)) {\n                    fail('expected value');\n                }\n                state = 2 /* DICT_STATE_COMMA */;\n                if (token.type === 1 /* STRING */) {\n                    cur[keyValue] = token.value;\n                    continue;\n                }\n                if (token.type === 8 /* NULL */) {\n                    cur[keyValue] = null;\n                    continue;\n                }\n                if (token.type === 9 /* TRUE */) {\n                    cur[keyValue] = true;\n                    continue;\n                }\n                if (token.type === 10 /* FALSE */) {\n                    cur[keyValue] = false;\n                    continue;\n                }\n                if (token.type === 11 /* NUMBER */) {\n                    cur[keyValue] = parseFloat(token.value);\n                    continue;\n                }\n                if (token.type === 2 /* LEFT_SQUARE_BRACKET */) {\n                    let newArr = [];\n                    cur[keyValue] = newArr;\n                    pushState();\n                    state = 4 /* ARR_STATE */;\n                    cur = newArr;\n                    continue;\n                }\n                if (token.type === 3 /* LEFT_CURLY_BRACKET */) {\n                    let newDict = {};\n                    if (withMetadata) {\n                        newDict.$vscodeTextmateLocation = token.toLocation(filename);\n                    }\n                    cur[keyValue] = newDict;\n                    pushState();\n                    state = 1 /* DICT_STATE */;\n                    cur = newDict;\n                    continue;\n                }\n            }\n            fail('unexpected token in dict');\n        }\n        if (state === 5 /* ARR_STATE_COMMA */) {\n            if (token.type === 4 /* RIGHT_SQUARE_BRACKET */) {\n                popState();\n                continue;\n            }\n            if (token.type === 7 /* COMMA */) {\n                state = 6 /* ARR_STATE_NO_CLOSE */;\n                continue;\n            }\n            fail('expected , or ]');\n        }\n        if (state === 4 /* ARR_STATE */ || state === 6 /* ARR_STATE_NO_CLOSE */) {\n            if (state === 4 /* ARR_STATE */ && token.type === 4 /* RIGHT_SQUARE_BRACKET */) {\n                popState();\n                continue;\n            }\n            state = 5 /* ARR_STATE_COMMA */;\n            if (token.type === 1 /* STRING */) {\n                cur.push(token.value);\n                continue;\n            }\n            if (token.type === 8 /* NULL */) {\n                cur.push(null);\n                continue;\n            }\n            if (token.type === 9 /* TRUE */) {\n                cur.push(true);\n                continue;\n            }\n            if (token.type === 10 /* FALSE */) {\n                cur.push(false);\n                continue;\n            }\n            if (token.type === 11 /* NUMBER */) {\n                cur.push(parseFloat(token.value));\n                continue;\n            }\n            if (token.type === 2 /* LEFT_SQUARE_BRACKET */) {\n                let newArr = [];\n                cur.push(newArr);\n                pushState();\n                state = 4 /* ARR_STATE */;\n                cur = newArr;\n                continue;\n            }\n            if (token.type === 3 /* LEFT_CURLY_BRACKET */) {\n                let newDict = {};\n                if (withMetadata) {\n                    newDict.$vscodeTextmateLocation = token.toLocation(filename);\n                }\n                cur.push(newDict);\n                pushState();\n                state = 1 /* DICT_STATE */;\n                cur = newDict;\n                continue;\n            }\n            fail('unexpected token in array');\n        }\n        fail('unknown state');\n    }\n    if (objStack.length !== 0) {\n        fail('unclosed constructs');\n    }\n    return cur;\n}\nexports.parseJSON = parseJSON;\nclass JSONStreamState {\n    constructor(source) {\n        this.source = source;\n        this.pos = 0;\n        this.len = source.length;\n        this.line = 1;\n        this.char = 0;\n    }\n}\nclass JSONToken {\n    constructor() {\n        this.value = null;\n        this.type = 0 /* UNKNOWN */;\n        this.offset = -1;\n        this.len = -1;\n        this.line = -1;\n        this.char = -1;\n    }\n    toLocation(filename) {\n        return {\n            filename: filename,\n            line: this.line,\n            char: this.char\n        };\n    }\n}\n/**\n * precondition: the string is known to be valid JSON (https://www.ietf.org/rfc/rfc4627.txt)\n */\nfunction nextJSONToken(_state, _out) {\n    _out.value = null;\n    _out.type = 0 /* UNKNOWN */;\n    _out.offset = -1;\n    _out.len = -1;\n    _out.line = -1;\n    _out.char = -1;\n    let source = _state.source;\n    let pos = _state.pos;\n    let len = _state.len;\n    let line = _state.line;\n    let char = _state.char;\n    //------------------------ skip whitespace\n    let chCode;\n    do {\n        if (pos >= len) {\n            return false; /*EOS*/\n        }\n        chCode = source.charCodeAt(pos);\n        if (chCode === 32 /* SPACE */ || chCode === 9 /* HORIZONTAL_TAB */ || chCode === 13 /* CARRIAGE_RETURN */) {\n            // regular whitespace\n            pos++;\n            char++;\n            continue;\n        }\n        if (chCode === 10 /* LINE_FEED */) {\n            // newline\n            pos++;\n            line++;\n            char = 0;\n            continue;\n        }\n        // not whitespace\n        break;\n    } while (true);\n    _out.offset = pos;\n    _out.line = line;\n    _out.char = char;\n    if (chCode === 34 /* QUOTATION_MARK */) {\n        //------------------------ strings\n        _out.type = 1 /* STRING */;\n        pos++;\n        char++;\n        do {\n            if (pos >= len) {\n                return false; /*EOS*/\n            }\n            chCode = source.charCodeAt(pos);\n            pos++;\n            char++;\n            if (chCode === 92 /* BACKSLASH */) {\n                // skip next char\n                pos++;\n                char++;\n                continue;\n            }\n            if (chCode === 34 /* QUOTATION_MARK */) {\n                // end of the string\n                break;\n            }\n        } while (true);\n        _out.value = source.substring(_out.offset + 1, pos - 1).replace(/\\\\u([0-9A-Fa-f]{4})/g, (_, m0) => {\n            return String.fromCodePoint(parseInt(m0, 16));\n        }).replace(/\\\\(.)/g, (_, m0) => {\n            switch (m0) {\n                case '\"': return '\"';\n                case '\\\\': return '\\\\';\n                case '/': return '/';\n                case 'b': return '\\b';\n                case 'f': return '\\f';\n                case 'n': return '\\n';\n                case 'r': return '\\r';\n                case 't': return '\\t';\n                default: doFail(_state, 'invalid escape sequence');\n            }\n            throw new Error('unreachable');\n        });\n    }\n    else if (chCode === 91 /* LEFT_SQUARE_BRACKET */) {\n        _out.type = 2 /* LEFT_SQUARE_BRACKET */;\n        pos++;\n        char++;\n    }\n    else if (chCode === 123 /* LEFT_CURLY_BRACKET */) {\n        _out.type = 3 /* LEFT_CURLY_BRACKET */;\n        pos++;\n        char++;\n    }\n    else if (chCode === 93 /* RIGHT_SQUARE_BRACKET */) {\n        _out.type = 4 /* RIGHT_SQUARE_BRACKET */;\n        pos++;\n        char++;\n    }\n    else if (chCode === 125 /* RIGHT_CURLY_BRACKET */) {\n        _out.type = 5 /* RIGHT_CURLY_BRACKET */;\n        pos++;\n        char++;\n    }\n    else if (chCode === 58 /* COLON */) {\n        _out.type = 6 /* COLON */;\n        pos++;\n        char++;\n    }\n    else if (chCode === 44 /* COMMA */) {\n        _out.type = 7 /* COMMA */;\n        pos++;\n        char++;\n    }\n    else if (chCode === 110 /* n */) {\n        //------------------------ null\n        _out.type = 8 /* NULL */;\n        pos++;\n        char++;\n        chCode = source.charCodeAt(pos);\n        if (chCode !== 117 /* u */) {\n            return false; /* INVALID */\n        }\n        pos++;\n        char++;\n        chCode = source.charCodeAt(pos);\n        if (chCode !== 108 /* l */) {\n            return false; /* INVALID */\n        }\n        pos++;\n        char++;\n        chCode = source.charCodeAt(pos);\n        if (chCode !== 108 /* l */) {\n            return false; /* INVALID */\n        }\n        pos++;\n        char++;\n    }\n    else if (chCode === 116 /* t */) {\n        //------------------------ true\n        _out.type = 9 /* TRUE */;\n        pos++;\n        char++;\n        chCode = source.charCodeAt(pos);\n        if (chCode !== 114 /* r */) {\n            return false; /* INVALID */\n        }\n        pos++;\n        char++;\n        chCode = source.charCodeAt(pos);\n        if (chCode !== 117 /* u */) {\n            return false; /* INVALID */\n        }\n        pos++;\n        char++;\n        chCode = source.charCodeAt(pos);\n        if (chCode !== 101 /* e */) {\n            return false; /* INVALID */\n        }\n        pos++;\n        char++;\n    }\n    else if (chCode === 102 /* f */) {\n        //------------------------ false\n        _out.type = 10 /* FALSE */;\n        pos++;\n        char++;\n        chCode = source.charCodeAt(pos);\n        if (chCode !== 97 /* a */) {\n            return false; /* INVALID */\n        }\n        pos++;\n        char++;\n        chCode = source.charCodeAt(pos);\n        if (chCode !== 108 /* l */) {\n            return false; /* INVALID */\n        }\n        pos++;\n        char++;\n        chCode = source.charCodeAt(pos);\n        if (chCode !== 115 /* s */) {\n            return false; /* INVALID */\n        }\n        pos++;\n        char++;\n        chCode = source.charCodeAt(pos);\n        if (chCode !== 101 /* e */) {\n            return false; /* INVALID */\n        }\n        pos++;\n        char++;\n    }\n    else {\n        //------------------------ numbers\n        _out.type = 11 /* NUMBER */;\n        do {\n            if (pos >= len) {\n                return false; /*EOS*/\n            }\n            chCode = source.charCodeAt(pos);\n            if (chCode === 46 /* DOT */\n                || (chCode >= 48 /* D0 */ && chCode <= 57 /* D9 */)\n                || (chCode === 101 /* e */ || chCode === 69 /* E */)\n                || (chCode === 45 /* MINUS */ || chCode === 43 /* PLUS */)) {\n                // looks like a piece of a number\n                pos++;\n                char++;\n                continue;\n            }\n            // pos--; char--;\n            break;\n        } while (true);\n    }\n    _out.len = pos - _out.offset;\n    if (_out.value === null) {\n        _out.value = source.substr(_out.offset, _out.len);\n    }\n    _state.pos = pos;\n    _state.line = line;\n    _state.char = char;\n    // console.log('PRODUCING TOKEN: ', _out.value, JSONTokenType[_out.type]);\n    return true;\n}\n//# sourceMappingURL=json.js.map", "\"use strict\";\n/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.parseRawGrammar = exports.INITIAL = exports.Registry = void 0;\nconst grammar_1 = require(\"./grammar\");\nconst grammarReader = require(\"./parseRawGrammar\");\nconst registry_1 = require(\"./registry\");\nconst theme_1 = require(\"./theme\");\nconst grammarDependencies_1 = require(\"./grammar/grammarDependencies\");\n__exportStar(require(\"./onigLib\"), exports);\n/**\n * The registry that will hold all grammars.\n */\nclass Registry {\n    constructor(options) {\n        this._options = options;\n        this._syncRegistry = new registry_1.SyncRegistry(theme_1.Theme.createFromRawTheme(options.theme, options.colorMap), options.onigLib);\n        this._ensureGrammarCache = new Map();\n    }\n    dispose() {\n        this._syncRegistry.dispose();\n    }\n    /**\n     * Change the theme. Once called, no previous `ruleStack` should be used anymore.\n     */\n    setTheme(theme, colorMap) {\n        this._syncRegistry.setTheme(theme_1.Theme.createFromRawTheme(theme, colorMap));\n    }\n    /**\n     * Returns a lookup array for color ids.\n     */\n    getColorMap() {\n        return this._syncRegistry.getColorMap();\n    }\n    /**\n     * Load the grammar for `scopeName` and all referenced included grammars asynchronously.\n     * Please do not use language id 0.\n     */\n    loadGrammarWithEmbeddedLanguages(initialScopeName, initialLanguage, embeddedLanguages) {\n        return this.loadGrammarWithConfiguration(initialScopeName, initialLanguage, { embeddedLanguages });\n    }\n    /**\n     * Load the grammar for `scopeName` and all referenced included grammars asynchronously.\n     * Please do not use language id 0.\n     */\n    loadGrammarWithConfiguration(initialScopeName, initialLanguage, configuration) {\n        return this._loadGrammar(initialScopeName, initialLanguage, configuration.embeddedLanguages, configuration.tokenTypes, new grammar_1.BalancedBracketSelectors(configuration.balancedBracketSelectors || [], configuration.unbalancedBracketSelectors || []));\n    }\n    /**\n     * Load the grammar for `scopeName` and all referenced included grammars asynchronously.\n     */\n    loadGrammar(initialScopeName) {\n        return this._loadGrammar(initialScopeName, 0, null, null, null);\n    }\n    async _loadGrammar(initialScopeName, initialLanguage, embeddedLanguages, tokenTypes, balancedBracketSelectors) {\n        const dependencyProcessor = new grammarDependencies_1.ScopeDependencyProcessor(this._syncRegistry, initialScopeName);\n        while (dependencyProcessor.Q.length > 0) {\n            await Promise.all(dependencyProcessor.Q.map((request) => this._loadSingleGrammar(request.scopeName)));\n            dependencyProcessor.processQueue();\n        }\n        return this._grammarForScopeName(initialScopeName, initialLanguage, embeddedLanguages, tokenTypes, balancedBracketSelectors);\n    }\n    async _loadSingleGrammar(scopeName) {\n        if (!this._ensureGrammarCache.has(scopeName)) {\n            this._ensureGrammarCache.set(scopeName, this._doLoadSingleGrammar(scopeName));\n        }\n        return this._ensureGrammarCache.get(scopeName);\n    }\n    async _doLoadSingleGrammar(scopeName) {\n        const grammar = await this._options.loadGrammar(scopeName);\n        if (grammar) {\n            const injections = typeof this._options.getInjections === \"function\" ? this._options.getInjections(scopeName) : undefined;\n            this._syncRegistry.addGrammar(grammar, injections);\n        }\n    }\n    /**\n     * Adds a rawGrammar.\n     */\n    async addGrammar(rawGrammar, injections = [], initialLanguage = 0, embeddedLanguages = null) {\n        this._syncRegistry.addGrammar(rawGrammar, injections);\n        return (await this._grammarForScopeName(rawGrammar.scopeName, initialLanguage, embeddedLanguages));\n    }\n    /**\n     * Get the grammar for `scopeName`. The grammar must first be created via `loadGrammar` or `addGrammar`.\n     */\n    _grammarForScopeName(scopeName, initialLanguage = 0, embeddedLanguages = null, tokenTypes = null, balancedBracketSelectors = null) {\n        return this._syncRegistry.grammarForScopeName(scopeName, initialLanguage, embeddedLanguages, tokenTypes, balancedBracketSelectors);\n    }\n}\nexports.Registry = Registry;\nexports.INITIAL = grammar_1.StateStack.NULL;\nexports.parseRawGrammar = grammarReader.parseRawGrammar;\n//# sourceMappingURL=main.js.map", "\"use strict\";\n/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createMatchers = void 0;\nfunction createMatchers(selector, matchesName) {\n    const results = [];\n    const tokenizer = newTokenizer(selector);\n    let token = tokenizer.next();\n    while (token !== null) {\n        let priority = 0;\n        if (token.length === 2 && token.charAt(1) === ':') {\n            switch (token.charAt(0)) {\n                case 'R':\n                    priority = 1;\n                    break;\n                case 'L':\n                    priority = -1;\n                    break;\n                default:\n                    console.log(`Unknown priority ${token} in scope selector`);\n            }\n            token = tokenizer.next();\n        }\n        let matcher = parseConjunction();\n        results.push({ matcher, priority });\n        if (token !== ',') {\n            break;\n        }\n        token = tokenizer.next();\n    }\n    return results;\n    function parseOperand() {\n        if (token === '-') {\n            token = tokenizer.next();\n            const expressionToNegate = parseOperand();\n            return matcherInput => !!expressionToNegate && !expressionToNegate(matcherInput);\n        }\n        if (token === '(') {\n            token = tokenizer.next();\n            const expressionInParents = parseInnerExpression();\n            if (token === ')') {\n                token = tokenizer.next();\n            }\n            return expressionInParents;\n        }\n        if (isIdentifier(token)) {\n            const identifiers = [];\n            do {\n                identifiers.push(token);\n                token = tokenizer.next();\n            } while (isIdentifier(token));\n            return matcherInput => matchesName(identifiers, matcherInput);\n        }\n        return null;\n    }\n    function parseConjunction() {\n        const matchers = [];\n        let matcher = parseOperand();\n        while (matcher) {\n            matchers.push(matcher);\n            matcher = parseOperand();\n        }\n        return matcherInput => matchers.every(matcher => matcher(matcherInput)); // and\n    }\n    function parseInnerExpression() {\n        const matchers = [];\n        let matcher = parseConjunction();\n        while (matcher) {\n            matchers.push(matcher);\n            if (token === '|' || token === ',') {\n                do {\n                    token = tokenizer.next();\n                } while (token === '|' || token === ','); // ignore subsequent commas\n            }\n            else {\n                break;\n            }\n            matcher = parseConjunction();\n        }\n        return matcherInput => matchers.some(matcher => matcher(matcherInput)); // or\n    }\n}\nexports.createMatchers = createMatchers;\nfunction isIdentifier(token) {\n    return !!token && !!token.match(/[\\w\\.:]+/);\n}\nfunction newTokenizer(input) {\n    let regex = /([LR]:|[\\w\\.:][\\w\\.:\\-]*|[\\,\\|\\-\\(\\)])/g;\n    let match = regex.exec(input);\n    return {\n        next: () => {\n            if (!match) {\n                return null;\n            }\n            const res = match[0];\n            match = regex.exec(input);\n            return res;\n        }\n    };\n}\n//# sourceMappingURL=matcher.js.map", "\"use strict\";\n/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.disposeOnigString = void 0;\nfunction disposeOnigString(str) {\n    if (typeof str.dispose === 'function') {\n        str.dispose();\n    }\n}\nexports.disposeOnigString = disposeOnigString;\n//# sourceMappingURL=onigLib.js.map", "\"use strict\";\n/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.parseRawGrammar = void 0;\nconst plist = require(\"./plist\");\nconst debug_1 = require(\"./debug\");\nconst json_1 = require(\"./json\");\nfunction parseRawGrammar(content, filePath = null) {\n    if (filePath !== null && /\\.json$/.test(filePath)) {\n        return parseJSONGrammar(content, filePath);\n    }\n    return parsePLISTGrammar(content, filePath);\n}\nexports.parseRawGrammar = parseRawGrammar;\nfunction parseJSONGrammar(contents, filename) {\n    if (debug_1.DebugFlags.InDebugMode) {\n        return json_1.parseJSON(contents, filename, true);\n    }\n    return JSON.parse(contents);\n}\nfunction parsePLISTGrammar(contents, filename) {\n    if (debug_1.DebugFlags.InDebugMode) {\n        return plist.parseWithLocation(contents, filename, '$vscodeTextmateLocation');\n    }\n    return plist.parsePLIST(contents);\n}\n//# sourceMappingURL=parseRawGrammar.js.map", "\"use strict\";\n/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.parsePLIST = exports.parseWithLocation = void 0;\nfunction parseWithLocation(content, filename, locationKeyName) {\n    return _parse(content, filename, locationKeyName);\n}\nexports.parseWithLocation = parseWithLocation;\n/**\n * A very fast plist parser\n */\nfunction parsePLIST(content) {\n    return _parse(content, null, null);\n}\nexports.parsePLIST = parsePLIST;\nfunction _parse(content, filename, locationKeyName) {\n    const len = content.length;\n    let pos = 0;\n    let line = 1;\n    let char = 0;\n    // Skip UTF8 BOM\n    if (len > 0 && content.charCodeAt(0) === 65279 /* BOM */) {\n        pos = 1;\n    }\n    function advancePosBy(by) {\n        if (locationKeyName === null) {\n            pos = pos + by;\n        }\n        else {\n            while (by > 0) {\n                let chCode = content.charCodeAt(pos);\n                if (chCode === 10 /* LINE_FEED */) {\n                    pos++;\n                    line++;\n                    char = 0;\n                }\n                else {\n                    pos++;\n                    char++;\n                }\n                by--;\n            }\n        }\n    }\n    function advancePosTo(to) {\n        if (locationKeyName === null) {\n            pos = to;\n        }\n        else {\n            advancePosBy(to - pos);\n        }\n    }\n    function skipWhitespace() {\n        while (pos < len) {\n            let chCode = content.charCodeAt(pos);\n            if (chCode !== 32 /* SPACE */ && chCode !== 9 /* TAB */ && chCode !== 13 /* CARRIAGE_RETURN */ && chCode !== 10 /* LINE_FEED */) {\n                break;\n            }\n            advancePosBy(1);\n        }\n    }\n    function advanceIfStartsWith(str) {\n        if (content.substr(pos, str.length) === str) {\n            advancePosBy(str.length);\n            return true;\n        }\n        return false;\n    }\n    function advanceUntil(str) {\n        let nextOccurence = content.indexOf(str, pos);\n        if (nextOccurence !== -1) {\n            advancePosTo(nextOccurence + str.length);\n        }\n        else {\n            // EOF\n            advancePosTo(len);\n        }\n    }\n    function captureUntil(str) {\n        let nextOccurence = content.indexOf(str, pos);\n        if (nextOccurence !== -1) {\n            let r = content.substring(pos, nextOccurence);\n            advancePosTo(nextOccurence + str.length);\n            return r;\n        }\n        else {\n            // EOF\n            let r = content.substr(pos);\n            advancePosTo(len);\n            return r;\n        }\n    }\n    let state = 0 /* ROOT_STATE */;\n    let cur = null;\n    let stateStack = [];\n    let objStack = [];\n    let curKey = null;\n    function pushState(newState, newCur) {\n        stateStack.push(state);\n        objStack.push(cur);\n        state = newState;\n        cur = newCur;\n    }\n    function popState() {\n        if (stateStack.length === 0) {\n            return fail('illegal state stack');\n        }\n        state = stateStack.pop();\n        cur = objStack.pop();\n    }\n    function fail(msg) {\n        throw new Error('Near offset ' + pos + ': ' + msg + ' ~~~' + content.substr(pos, 50) + '~~~');\n    }\n    const dictState = {\n        enterDict: function () {\n            if (curKey === null) {\n                return fail('missing <key>');\n            }\n            let newDict = {};\n            if (locationKeyName !== null) {\n                newDict[locationKeyName] = {\n                    filename: filename,\n                    line: line,\n                    char: char\n                };\n            }\n            cur[curKey] = newDict;\n            curKey = null;\n            pushState(1 /* DICT_STATE */, newDict);\n        },\n        enterArray: function () {\n            if (curKey === null) {\n                return fail('missing <key>');\n            }\n            let newArr = [];\n            cur[curKey] = newArr;\n            curKey = null;\n            pushState(2 /* ARR_STATE */, newArr);\n        }\n    };\n    const arrState = {\n        enterDict: function () {\n            let newDict = {};\n            if (locationKeyName !== null) {\n                newDict[locationKeyName] = {\n                    filename: filename,\n                    line: line,\n                    char: char\n                };\n            }\n            cur.push(newDict);\n            pushState(1 /* DICT_STATE */, newDict);\n        },\n        enterArray: function () {\n            let newArr = [];\n            cur.push(newArr);\n            pushState(2 /* ARR_STATE */, newArr);\n        }\n    };\n    function enterDict() {\n        if (state === 1 /* DICT_STATE */) {\n            dictState.enterDict();\n        }\n        else if (state === 2 /* ARR_STATE */) {\n            arrState.enterDict();\n        }\n        else { // ROOT_STATE\n            cur = {};\n            if (locationKeyName !== null) {\n                cur[locationKeyName] = {\n                    filename: filename,\n                    line: line,\n                    char: char\n                };\n            }\n            pushState(1 /* DICT_STATE */, cur);\n        }\n    }\n    function leaveDict() {\n        if (state === 1 /* DICT_STATE */) {\n            popState();\n        }\n        else if (state === 2 /* ARR_STATE */) {\n            return fail('unexpected </dict>');\n        }\n        else { // ROOT_STATE\n            return fail('unexpected </dict>');\n        }\n    }\n    function enterArray() {\n        if (state === 1 /* DICT_STATE */) {\n            dictState.enterArray();\n        }\n        else if (state === 2 /* ARR_STATE */) {\n            arrState.enterArray();\n        }\n        else { // ROOT_STATE\n            cur = [];\n            pushState(2 /* ARR_STATE */, cur);\n        }\n    }\n    function leaveArray() {\n        if (state === 1 /* DICT_STATE */) {\n            return fail('unexpected </array>');\n        }\n        else if (state === 2 /* ARR_STATE */) {\n            popState();\n        }\n        else { // ROOT_STATE\n            return fail('unexpected </array>');\n        }\n    }\n    function acceptKey(val) {\n        if (state === 1 /* DICT_STATE */) {\n            if (curKey !== null) {\n                return fail('too many <key>');\n            }\n            curKey = val;\n        }\n        else if (state === 2 /* ARR_STATE */) {\n            return fail('unexpected <key>');\n        }\n        else { // ROOT_STATE\n            return fail('unexpected <key>');\n        }\n    }\n    function acceptString(val) {\n        if (state === 1 /* DICT_STATE */) {\n            if (curKey === null) {\n                return fail('missing <key>');\n            }\n            cur[curKey] = val;\n            curKey = null;\n        }\n        else if (state === 2 /* ARR_STATE */) {\n            cur.push(val);\n        }\n        else { // ROOT_STATE\n            cur = val;\n        }\n    }\n    function acceptReal(val) {\n        if (isNaN(val)) {\n            return fail('cannot parse float');\n        }\n        if (state === 1 /* DICT_STATE */) {\n            if (curKey === null) {\n                return fail('missing <key>');\n            }\n            cur[curKey] = val;\n            curKey = null;\n        }\n        else if (state === 2 /* ARR_STATE */) {\n            cur.push(val);\n        }\n        else { // ROOT_STATE\n            cur = val;\n        }\n    }\n    function acceptInteger(val) {\n        if (isNaN(val)) {\n            return fail('cannot parse integer');\n        }\n        if (state === 1 /* DICT_STATE */) {\n            if (curKey === null) {\n                return fail('missing <key>');\n            }\n            cur[curKey] = val;\n            curKey = null;\n        }\n        else if (state === 2 /* ARR_STATE */) {\n            cur.push(val);\n        }\n        else { // ROOT_STATE\n            cur = val;\n        }\n    }\n    function acceptDate(val) {\n        if (state === 1 /* DICT_STATE */) {\n            if (curKey === null) {\n                return fail('missing <key>');\n            }\n            cur[curKey] = val;\n            curKey = null;\n        }\n        else if (state === 2 /* ARR_STATE */) {\n            cur.push(val);\n        }\n        else { // ROOT_STATE\n            cur = val;\n        }\n    }\n    function acceptData(val) {\n        if (state === 1 /* DICT_STATE */) {\n            if (curKey === null) {\n                return fail('missing <key>');\n            }\n            cur[curKey] = val;\n            curKey = null;\n        }\n        else if (state === 2 /* ARR_STATE */) {\n            cur.push(val);\n        }\n        else { // ROOT_STATE\n            cur = val;\n        }\n    }\n    function acceptBool(val) {\n        if (state === 1 /* DICT_STATE */) {\n            if (curKey === null) {\n                return fail('missing <key>');\n            }\n            cur[curKey] = val;\n            curKey = null;\n        }\n        else if (state === 2 /* ARR_STATE */) {\n            cur.push(val);\n        }\n        else { // ROOT_STATE\n            cur = val;\n        }\n    }\n    function escapeVal(str) {\n        return str.replace(/&#([0-9]+);/g, function (_, m0) {\n            return String.fromCodePoint(parseInt(m0, 10));\n        }).replace(/&#x([0-9a-f]+);/g, function (_, m0) {\n            return String.fromCodePoint(parseInt(m0, 16));\n        }).replace(/&amp;|&lt;|&gt;|&quot;|&apos;/g, function (_) {\n            switch (_) {\n                case '&amp;': return '&';\n                case '&lt;': return '<';\n                case '&gt;': return '>';\n                case '&quot;': return '\"';\n                case '&apos;': return '\\'';\n            }\n            return _;\n        });\n    }\n    function parseOpenTag() {\n        let r = captureUntil('>');\n        let isClosed = false;\n        if (r.charCodeAt(r.length - 1) === 47 /* SLASH */) {\n            isClosed = true;\n            r = r.substring(0, r.length - 1);\n        }\n        return {\n            name: r.trim(),\n            isClosed: isClosed\n        };\n    }\n    function parseTagValue(tag) {\n        if (tag.isClosed) {\n            return '';\n        }\n        let val = captureUntil('</');\n        advanceUntil('>');\n        return escapeVal(val);\n    }\n    while (pos < len) {\n        skipWhitespace();\n        if (pos >= len) {\n            break;\n        }\n        const chCode = content.charCodeAt(pos);\n        advancePosBy(1);\n        if (chCode !== 60 /* LESS_THAN */) {\n            return fail('expected <');\n        }\n        if (pos >= len) {\n            return fail('unexpected end of input');\n        }\n        const peekChCode = content.charCodeAt(pos);\n        if (peekChCode === 63 /* QUESTION_MARK */) {\n            advancePosBy(1);\n            advanceUntil('?>');\n            continue;\n        }\n        if (peekChCode === 33 /* EXCLAMATION_MARK */) {\n            advancePosBy(1);\n            if (advanceIfStartsWith('--')) {\n                advanceUntil('-->');\n                continue;\n            }\n            advanceUntil('>');\n            continue;\n        }\n        if (peekChCode === 47 /* SLASH */) {\n            advancePosBy(1);\n            skipWhitespace();\n            if (advanceIfStartsWith('plist')) {\n                advanceUntil('>');\n                continue;\n            }\n            if (advanceIfStartsWith('dict')) {\n                advanceUntil('>');\n                leaveDict();\n                continue;\n            }\n            if (advanceIfStartsWith('array')) {\n                advanceUntil('>');\n                leaveArray();\n                continue;\n            }\n            return fail('unexpected closed tag');\n        }\n        let tag = parseOpenTag();\n        switch (tag.name) {\n            case 'dict':\n                enterDict();\n                if (tag.isClosed) {\n                    leaveDict();\n                }\n                continue;\n            case 'array':\n                enterArray();\n                if (tag.isClosed) {\n                    leaveArray();\n                }\n                continue;\n            case 'key':\n                acceptKey(parseTagValue(tag));\n                continue;\n            case 'string':\n                acceptString(parseTagValue(tag));\n                continue;\n            case 'real':\n                acceptReal(parseFloat(parseTagValue(tag)));\n                continue;\n            case 'integer':\n                acceptInteger(parseInt(parseTagValue(tag), 10));\n                continue;\n            case 'date':\n                acceptDate(new Date(parseTagValue(tag)));\n                continue;\n            case 'data':\n                acceptData(parseTagValue(tag));\n                continue;\n            case 'true':\n                parseTagValue(tag);\n                acceptBool(true);\n                continue;\n            case 'false':\n                parseTagValue(tag);\n                acceptBool(false);\n                continue;\n        }\n        if (/^plist/.test(tag.name)) {\n            continue;\n        }\n        return fail('unexpected opened tag ' + tag.name);\n    }\n    return cur;\n}\n//# sourceMappingURL=plist.js.map", "\"use strict\";\n/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SyncRegistry = void 0;\nconst grammar_1 = require(\"./grammar\");\nclass SyncRegistry {\n    constructor(theme, _onigLibPromise) {\n        this._onigLibPromise = _onigLibPromise;\n        this._grammars = new Map();\n        this._rawGrammars = new Map();\n        this._injectionGrammars = new Map();\n        this._theme = theme;\n    }\n    dispose() {\n        for (const grammar of this._grammars.values()) {\n            grammar.dispose();\n        }\n    }\n    setTheme(theme) {\n        this._theme = theme;\n    }\n    getColorMap() {\n        return this._theme.getColorMap();\n    }\n    /**\n     * Add `grammar` to registry and return a list of referenced scope names\n     */\n    addGrammar(grammar, injectionScopeNames) {\n        this._rawGrammars.set(grammar.scopeName, grammar);\n        if (injectionScopeNames) {\n            this._injectionGrammars.set(grammar.scopeName, injectionScopeNames);\n        }\n    }\n    /**\n     * Lookup a raw grammar.\n     */\n    lookup(scopeName) {\n        return this._rawGrammars.get(scopeName);\n    }\n    /**\n     * Returns the injections for the given grammar\n     */\n    injections(targetScope) {\n        return this._injectionGrammars.get(targetScope);\n    }\n    /**\n     * Get the default theme settings\n     */\n    getDefaults() {\n        return this._theme.getDefaults();\n    }\n    /**\n     * Match a scope in the theme.\n     */\n    themeMatch(scopePath) {\n        return this._theme.match(scopePath);\n    }\n    /**\n     * Lookup a grammar.\n     */\n    async grammarForScopeName(scopeName, initialLanguage, embeddedLanguages, tokenTypes, balancedBracketSelectors) {\n        if (!this._grammars.has(scopeName)) {\n            let rawGrammar = this._rawGrammars.get(scopeName);\n            if (!rawGrammar) {\n                return null;\n            }\n            this._grammars.set(scopeName, grammar_1.createGrammar(scopeName, rawGrammar, initialLanguage, embeddedLanguages, tokenTypes, balancedBracketSelectors, this, await this._onigLibPromise));\n        }\n        return this._grammars.get(scopeName);\n    }\n}\nexports.SyncRegistry = SyncRegistry;\n//# sourceMappingURL=registry.js.map", "\"use strict\";\n/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CompiledRule = exports.RegExpSourceList = exports.RegExpSource = exports.RuleFactory = exports.BeginWhileRule = exports.BeginEndRule = exports.IncludeOnlyRule = exports.MatchRule = exports.CaptureRule = exports.Rule = exports.ruleIdToNumber = exports.ruleIdFromNumber = exports.whileRuleId = exports.endRuleId = void 0;\nconst utils_1 = require(\"./utils\");\nconst grammarDependencies_1 = require(\"./grammar/grammarDependencies\");\nconst HAS_BACK_REFERENCES = /\\\\(\\d+)/;\nconst BACK_REFERENCING_END = /\\\\(\\d+)/g;\nconst ruleIdSymbol = Symbol('RuleId');\n// This is a special constant to indicate that the end regexp matched.\nexports.endRuleId = -1;\n// This is a special constant to indicate that the while regexp matched.\nexports.whileRuleId = -2;\nfunction ruleIdFromNumber(id) {\n    return id;\n}\nexports.ruleIdFromNumber = ruleIdFromNumber;\nfunction ruleIdToNumber(id) {\n    return id;\n}\nexports.ruleIdToNumber = ruleIdToNumber;\nclass Rule {\n    constructor($location, id, name, contentName) {\n        this.$location = $location;\n        this.id = id;\n        this._name = name || null;\n        this._nameIsCapturing = utils_1.RegexSource.hasCaptures(this._name);\n        this._contentName = contentName || null;\n        this._contentNameIsCapturing = utils_1.RegexSource.hasCaptures(this._contentName);\n    }\n    get debugName() {\n        const location = this.$location ? `${utils_1.basename(this.$location.filename)}:${this.$location.line}` : 'unknown';\n        return `${this.constructor.name}#${this.id} @ ${location}`;\n    }\n    getName(lineText, captureIndices) {\n        if (!this._nameIsCapturing || this._name === null || lineText === null || captureIndices === null) {\n            return this._name;\n        }\n        return utils_1.RegexSource.replaceCaptures(this._name, lineText, captureIndices);\n    }\n    getContentName(lineText, captureIndices) {\n        if (!this._contentNameIsCapturing || this._contentName === null) {\n            return this._contentName;\n        }\n        return utils_1.RegexSource.replaceCaptures(this._contentName, lineText, captureIndices);\n    }\n}\nexports.Rule = Rule;\nclass CaptureRule extends Rule {\n    constructor($location, id, name, contentName, retokenizeCapturedWithRuleId) {\n        super($location, id, name, contentName);\n        this.retokenizeCapturedWithRuleId = retokenizeCapturedWithRuleId;\n    }\n    dispose() {\n        // nothing to dispose\n    }\n    collectPatterns(grammar, out) {\n        throw new Error('Not supported!');\n    }\n    compile(grammar, endRegexSource) {\n        throw new Error('Not supported!');\n    }\n    compileAG(grammar, endRegexSource, allowA, allowG) {\n        throw new Error('Not supported!');\n    }\n}\nexports.CaptureRule = CaptureRule;\nclass MatchRule extends Rule {\n    constructor($location, id, name, match, captures) {\n        super($location, id, name, null);\n        this._match = new RegExpSource(match, this.id);\n        this.captures = captures;\n        this._cachedCompiledPatterns = null;\n    }\n    dispose() {\n        if (this._cachedCompiledPatterns) {\n            this._cachedCompiledPatterns.dispose();\n            this._cachedCompiledPatterns = null;\n        }\n    }\n    get debugMatchRegExp() {\n        return `${this._match.source}`;\n    }\n    collectPatterns(grammar, out) {\n        out.push(this._match);\n    }\n    compile(grammar, endRegexSource) {\n        return this._getCachedCompiledPatterns(grammar).compile(grammar);\n    }\n    compileAG(grammar, endRegexSource, allowA, allowG) {\n        return this._getCachedCompiledPatterns(grammar).compileAG(grammar, allowA, allowG);\n    }\n    _getCachedCompiledPatterns(grammar) {\n        if (!this._cachedCompiledPatterns) {\n            this._cachedCompiledPatterns = new RegExpSourceList();\n            this.collectPatterns(grammar, this._cachedCompiledPatterns);\n        }\n        return this._cachedCompiledPatterns;\n    }\n}\nexports.MatchRule = MatchRule;\nclass IncludeOnlyRule extends Rule {\n    constructor($location, id, name, contentName, patterns) {\n        super($location, id, name, contentName);\n        this.patterns = patterns.patterns;\n        this.hasMissingPatterns = patterns.hasMissingPatterns;\n        this._cachedCompiledPatterns = null;\n    }\n    dispose() {\n        if (this._cachedCompiledPatterns) {\n            this._cachedCompiledPatterns.dispose();\n            this._cachedCompiledPatterns = null;\n        }\n    }\n    collectPatterns(grammar, out) {\n        for (const pattern of this.patterns) {\n            const rule = grammar.getRule(pattern);\n            rule.collectPatterns(grammar, out);\n        }\n    }\n    compile(grammar, endRegexSource) {\n        return this._getCachedCompiledPatterns(grammar).compile(grammar);\n    }\n    compileAG(grammar, endRegexSource, allowA, allowG) {\n        return this._getCachedCompiledPatterns(grammar).compileAG(grammar, allowA, allowG);\n    }\n    _getCachedCompiledPatterns(grammar) {\n        if (!this._cachedCompiledPatterns) {\n            this._cachedCompiledPatterns = new RegExpSourceList();\n            this.collectPatterns(grammar, this._cachedCompiledPatterns);\n        }\n        return this._cachedCompiledPatterns;\n    }\n}\nexports.IncludeOnlyRule = IncludeOnlyRule;\nclass BeginEndRule extends Rule {\n    constructor($location, id, name, contentName, begin, beginCaptures, end, endCaptures, applyEndPatternLast, patterns) {\n        super($location, id, name, contentName);\n        this._begin = new RegExpSource(begin, this.id);\n        this.beginCaptures = beginCaptures;\n        this._end = new RegExpSource(end ? end : '\\uFFFF', -1);\n        this.endHasBackReferences = this._end.hasBackReferences;\n        this.endCaptures = endCaptures;\n        this.applyEndPatternLast = applyEndPatternLast || false;\n        this.patterns = patterns.patterns;\n        this.hasMissingPatterns = patterns.hasMissingPatterns;\n        this._cachedCompiledPatterns = null;\n    }\n    dispose() {\n        if (this._cachedCompiledPatterns) {\n            this._cachedCompiledPatterns.dispose();\n            this._cachedCompiledPatterns = null;\n        }\n    }\n    get debugBeginRegExp() {\n        return `${this._begin.source}`;\n    }\n    get debugEndRegExp() {\n        return `${this._end.source}`;\n    }\n    getEndWithResolvedBackReferences(lineText, captureIndices) {\n        return this._end.resolveBackReferences(lineText, captureIndices);\n    }\n    collectPatterns(grammar, out) {\n        out.push(this._begin);\n    }\n    compile(grammar, endRegexSource) {\n        return this._getCachedCompiledPatterns(grammar, endRegexSource).compile(grammar);\n    }\n    compileAG(grammar, endRegexSource, allowA, allowG) {\n        return this._getCachedCompiledPatterns(grammar, endRegexSource).compileAG(grammar, allowA, allowG);\n    }\n    _getCachedCompiledPatterns(grammar, endRegexSource) {\n        if (!this._cachedCompiledPatterns) {\n            this._cachedCompiledPatterns = new RegExpSourceList();\n            for (const pattern of this.patterns) {\n                const rule = grammar.getRule(pattern);\n                rule.collectPatterns(grammar, this._cachedCompiledPatterns);\n            }\n            if (this.applyEndPatternLast) {\n                this._cachedCompiledPatterns.push(this._end.hasBackReferences ? this._end.clone() : this._end);\n            }\n            else {\n                this._cachedCompiledPatterns.unshift(this._end.hasBackReferences ? this._end.clone() : this._end);\n            }\n        }\n        if (this._end.hasBackReferences) {\n            if (this.applyEndPatternLast) {\n                this._cachedCompiledPatterns.setSource(this._cachedCompiledPatterns.length() - 1, endRegexSource);\n            }\n            else {\n                this._cachedCompiledPatterns.setSource(0, endRegexSource);\n            }\n        }\n        return this._cachedCompiledPatterns;\n    }\n}\nexports.BeginEndRule = BeginEndRule;\nclass BeginWhileRule extends Rule {\n    constructor($location, id, name, contentName, begin, beginCaptures, _while, whileCaptures, patterns) {\n        super($location, id, name, contentName);\n        this._begin = new RegExpSource(begin, this.id);\n        this.beginCaptures = beginCaptures;\n        this.whileCaptures = whileCaptures;\n        this._while = new RegExpSource(_while, exports.whileRuleId);\n        this.whileHasBackReferences = this._while.hasBackReferences;\n        this.patterns = patterns.patterns;\n        this.hasMissingPatterns = patterns.hasMissingPatterns;\n        this._cachedCompiledPatterns = null;\n        this._cachedCompiledWhilePatterns = null;\n    }\n    dispose() {\n        if (this._cachedCompiledPatterns) {\n            this._cachedCompiledPatterns.dispose();\n            this._cachedCompiledPatterns = null;\n        }\n        if (this._cachedCompiledWhilePatterns) {\n            this._cachedCompiledWhilePatterns.dispose();\n            this._cachedCompiledWhilePatterns = null;\n        }\n    }\n    get debugBeginRegExp() {\n        return `${this._begin.source}`;\n    }\n    get debugWhileRegExp() {\n        return `${this._while.source}`;\n    }\n    getWhileWithResolvedBackReferences(lineText, captureIndices) {\n        return this._while.resolveBackReferences(lineText, captureIndices);\n    }\n    collectPatterns(grammar, out) {\n        out.push(this._begin);\n    }\n    compile(grammar, endRegexSource) {\n        return this._getCachedCompiledPatterns(grammar).compile(grammar);\n    }\n    compileAG(grammar, endRegexSource, allowA, allowG) {\n        return this._getCachedCompiledPatterns(grammar).compileAG(grammar, allowA, allowG);\n    }\n    _getCachedCompiledPatterns(grammar) {\n        if (!this._cachedCompiledPatterns) {\n            this._cachedCompiledPatterns = new RegExpSourceList();\n            for (const pattern of this.patterns) {\n                const rule = grammar.getRule(pattern);\n                rule.collectPatterns(grammar, this._cachedCompiledPatterns);\n            }\n        }\n        return this._cachedCompiledPatterns;\n    }\n    compileWhile(grammar, endRegexSource) {\n        return this._getCachedCompiledWhilePatterns(grammar, endRegexSource).compile(grammar);\n    }\n    compileWhileAG(grammar, endRegexSource, allowA, allowG) {\n        return this._getCachedCompiledWhilePatterns(grammar, endRegexSource).compileAG(grammar, allowA, allowG);\n    }\n    _getCachedCompiledWhilePatterns(grammar, endRegexSource) {\n        if (!this._cachedCompiledWhilePatterns) {\n            this._cachedCompiledWhilePatterns = new RegExpSourceList();\n            this._cachedCompiledWhilePatterns.push(this._while.hasBackReferences ? this._while.clone() : this._while);\n        }\n        if (this._while.hasBackReferences) {\n            this._cachedCompiledWhilePatterns.setSource(0, endRegexSource ? endRegexSource : '\\uFFFF');\n        }\n        return this._cachedCompiledWhilePatterns;\n    }\n}\nexports.BeginWhileRule = BeginWhileRule;\nclass RuleFactory {\n    static createCaptureRule(helper, $location, name, contentName, retokenizeCapturedWithRuleId) {\n        return helper.registerRule((id) => {\n            return new CaptureRule($location, id, name, contentName, retokenizeCapturedWithRuleId);\n        });\n    }\n    static getCompiledRuleId(desc, helper, repository) {\n        if (!desc.id) {\n            helper.registerRule((id) => {\n                desc.id = id;\n                if (desc.match) {\n                    return new MatchRule(desc.$vscodeTextmateLocation, desc.id, desc.name, desc.match, RuleFactory._compileCaptures(desc.captures, helper, repository));\n                }\n                if (typeof desc.begin === 'undefined') {\n                    if (desc.repository) {\n                        repository = utils_1.mergeObjects({}, repository, desc.repository);\n                    }\n                    let patterns = desc.patterns;\n                    if (typeof patterns === 'undefined' && desc.include) {\n                        patterns = [{ include: desc.include }];\n                    }\n                    return new IncludeOnlyRule(desc.$vscodeTextmateLocation, desc.id, desc.name, desc.contentName, RuleFactory._compilePatterns(patterns, helper, repository));\n                }\n                if (desc.while) {\n                    return new BeginWhileRule(desc.$vscodeTextmateLocation, desc.id, desc.name, desc.contentName, desc.begin, RuleFactory._compileCaptures(desc.beginCaptures || desc.captures, helper, repository), desc.while, RuleFactory._compileCaptures(desc.whileCaptures || desc.captures, helper, repository), RuleFactory._compilePatterns(desc.patterns, helper, repository));\n                }\n                return new BeginEndRule(desc.$vscodeTextmateLocation, desc.id, desc.name, desc.contentName, desc.begin, RuleFactory._compileCaptures(desc.beginCaptures || desc.captures, helper, repository), desc.end, RuleFactory._compileCaptures(desc.endCaptures || desc.captures, helper, repository), desc.applyEndPatternLast, RuleFactory._compilePatterns(desc.patterns, helper, repository));\n            });\n        }\n        return desc.id;\n    }\n    static _compileCaptures(captures, helper, repository) {\n        let r = [];\n        if (captures) {\n            // Find the maximum capture id\n            let maximumCaptureId = 0;\n            for (const captureId in captures) {\n                if (captureId === '$vscodeTextmateLocation') {\n                    continue;\n                }\n                const numericCaptureId = parseInt(captureId, 10);\n                if (numericCaptureId > maximumCaptureId) {\n                    maximumCaptureId = numericCaptureId;\n                }\n            }\n            // Initialize result\n            for (let i = 0; i <= maximumCaptureId; i++) {\n                r[i] = null;\n            }\n            // Fill out result\n            for (const captureId in captures) {\n                if (captureId === '$vscodeTextmateLocation') {\n                    continue;\n                }\n                const numericCaptureId = parseInt(captureId, 10);\n                let retokenizeCapturedWithRuleId = 0;\n                if (captures[captureId].patterns) {\n                    retokenizeCapturedWithRuleId = RuleFactory.getCompiledRuleId(captures[captureId], helper, repository);\n                }\n                r[numericCaptureId] = RuleFactory.createCaptureRule(helper, captures[captureId].$vscodeTextmateLocation, captures[captureId].name, captures[captureId].contentName, retokenizeCapturedWithRuleId);\n            }\n        }\n        return r;\n    }\n    static _compilePatterns(patterns, helper, repository) {\n        let r = [];\n        if (patterns) {\n            for (let i = 0, len = patterns.length; i < len; i++) {\n                const pattern = patterns[i];\n                let ruleId = -1;\n                if (pattern.include) {\n                    const reference = grammarDependencies_1.parseInclude(pattern.include);\n                    switch (reference.kind) {\n                        case 0 /* Base */:\n                        case 1 /* Self */:\n                            ruleId = RuleFactory.getCompiledRuleId(repository[pattern.include], helper, repository);\n                            break;\n                        case 2 /* RelativeReference */:\n                            // Local include found in `repository`\n                            let localIncludedRule = repository[reference.ruleName];\n                            if (localIncludedRule) {\n                                ruleId = RuleFactory.getCompiledRuleId(localIncludedRule, helper, repository);\n                            }\n                            else {\n                                // console.warn('CANNOT find rule for scopeName: ' + pattern.include + ', I am: ', repository['$base'].name);\n                            }\n                            break;\n                        case 3 /* TopLevelReference */:\n                        case 4 /* TopLevelRepositoryReference */:\n                            const externalGrammarName = reference.scopeName;\n                            const externalGrammarInclude = reference.kind === 4 /* TopLevelRepositoryReference */\n                                ? reference.ruleName\n                                : null;\n                            // External include\n                            const externalGrammar = helper.getExternalGrammar(externalGrammarName, repository);\n                            if (externalGrammar) {\n                                if (externalGrammarInclude) {\n                                    let externalIncludedRule = externalGrammar.repository[externalGrammarInclude];\n                                    if (externalIncludedRule) {\n                                        ruleId = RuleFactory.getCompiledRuleId(externalIncludedRule, helper, externalGrammar.repository);\n                                    }\n                                    else {\n                                        // console.warn('CANNOT find rule for scopeName: ' + pattern.include + ', I am: ', repository['$base'].name);\n                                    }\n                                }\n                                else {\n                                    ruleId = RuleFactory.getCompiledRuleId(externalGrammar.repository.$self, helper, externalGrammar.repository);\n                                }\n                            }\n                            else {\n                                // console.warn('CANNOT find grammar for scopeName: ' + pattern.include + ', I am: ', repository['$base'].name);\n                            }\n                            break;\n                    }\n                }\n                else {\n                    ruleId = RuleFactory.getCompiledRuleId(pattern, helper, repository);\n                }\n                if (ruleId !== -1) {\n                    const rule = helper.getRule(ruleId);\n                    let skipRule = false;\n                    if (rule instanceof IncludeOnlyRule || rule instanceof BeginEndRule || rule instanceof BeginWhileRule) {\n                        if (rule.hasMissingPatterns && rule.patterns.length === 0) {\n                            skipRule = true;\n                        }\n                    }\n                    if (skipRule) {\n                        // console.log('REMOVING RULE ENTIRELY DUE TO EMPTY PATTERNS THAT ARE MISSING');\n                        continue;\n                    }\n                    r.push(ruleId);\n                }\n            }\n        }\n        return {\n            patterns: r,\n            hasMissingPatterns: ((patterns ? patterns.length : 0) !== r.length)\n        };\n    }\n}\nexports.RuleFactory = RuleFactory;\nclass RegExpSource {\n    constructor(regExpSource, ruleId) {\n        if (regExpSource) {\n            const len = regExpSource.length;\n            let lastPushedPos = 0;\n            let output = [];\n            let hasAnchor = false;\n            for (let pos = 0; pos < len; pos++) {\n                const ch = regExpSource.charAt(pos);\n                if (ch === '\\\\') {\n                    if (pos + 1 < len) {\n                        const nextCh = regExpSource.charAt(pos + 1);\n                        if (nextCh === 'z') {\n                            output.push(regExpSource.substring(lastPushedPos, pos));\n                            output.push('$(?!\\\\n)(?<!\\\\n)');\n                            lastPushedPos = pos + 2;\n                        }\n                        else if (nextCh === 'A' || nextCh === 'G') {\n                            hasAnchor = true;\n                        }\n                        pos++;\n                    }\n                }\n            }\n            this.hasAnchor = hasAnchor;\n            if (lastPushedPos === 0) {\n                // No \\z hit\n                this.source = regExpSource;\n            }\n            else {\n                output.push(regExpSource.substring(lastPushedPos, len));\n                this.source = output.join('');\n            }\n        }\n        else {\n            this.hasAnchor = false;\n            this.source = regExpSource;\n        }\n        if (this.hasAnchor) {\n            this._anchorCache = this._buildAnchorCache();\n        }\n        else {\n            this._anchorCache = null;\n        }\n        this.ruleId = ruleId;\n        this.hasBackReferences = HAS_BACK_REFERENCES.test(this.source);\n        // console.log('input: ' + regExpSource + ' => ' + this.source + ', ' + this.hasAnchor);\n    }\n    clone() {\n        return new RegExpSource(this.source, this.ruleId);\n    }\n    setSource(newSource) {\n        if (this.source === newSource) {\n            return;\n        }\n        this.source = newSource;\n        if (this.hasAnchor) {\n            this._anchorCache = this._buildAnchorCache();\n        }\n    }\n    resolveBackReferences(lineText, captureIndices) {\n        let capturedValues = captureIndices.map((capture) => {\n            return lineText.substring(capture.start, capture.end);\n        });\n        BACK_REFERENCING_END.lastIndex = 0;\n        return this.source.replace(BACK_REFERENCING_END, (match, g1) => {\n            return utils_1.escapeRegExpCharacters(capturedValues[parseInt(g1, 10)] || '');\n        });\n    }\n    _buildAnchorCache() {\n        let A0_G0_result = [];\n        let A0_G1_result = [];\n        let A1_G0_result = [];\n        let A1_G1_result = [];\n        let pos, len, ch, nextCh;\n        for (pos = 0, len = this.source.length; pos < len; pos++) {\n            ch = this.source.charAt(pos);\n            A0_G0_result[pos] = ch;\n            A0_G1_result[pos] = ch;\n            A1_G0_result[pos] = ch;\n            A1_G1_result[pos] = ch;\n            if (ch === '\\\\') {\n                if (pos + 1 < len) {\n                    nextCh = this.source.charAt(pos + 1);\n                    if (nextCh === 'A') {\n                        A0_G0_result[pos + 1] = '\\uFFFF';\n                        A0_G1_result[pos + 1] = '\\uFFFF';\n                        A1_G0_result[pos + 1] = 'A';\n                        A1_G1_result[pos + 1] = 'A';\n                    }\n                    else if (nextCh === 'G') {\n                        A0_G0_result[pos + 1] = '\\uFFFF';\n                        A0_G1_result[pos + 1] = 'G';\n                        A1_G0_result[pos + 1] = '\\uFFFF';\n                        A1_G1_result[pos + 1] = 'G';\n                    }\n                    else {\n                        A0_G0_result[pos + 1] = nextCh;\n                        A0_G1_result[pos + 1] = nextCh;\n                        A1_G0_result[pos + 1] = nextCh;\n                        A1_G1_result[pos + 1] = nextCh;\n                    }\n                    pos++;\n                }\n            }\n        }\n        return {\n            A0_G0: A0_G0_result.join(''),\n            A0_G1: A0_G1_result.join(''),\n            A1_G0: A1_G0_result.join(''),\n            A1_G1: A1_G1_result.join('')\n        };\n    }\n    resolveAnchors(allowA, allowG) {\n        if (!this.hasAnchor || !this._anchorCache) {\n            return this.source;\n        }\n        if (allowA) {\n            if (allowG) {\n                return this._anchorCache.A1_G1;\n            }\n            else {\n                return this._anchorCache.A1_G0;\n            }\n        }\n        else {\n            if (allowG) {\n                return this._anchorCache.A0_G1;\n            }\n            else {\n                return this._anchorCache.A0_G0;\n            }\n        }\n    }\n}\nexports.RegExpSource = RegExpSource;\nclass RegExpSourceList {\n    constructor() {\n        this._items = [];\n        this._hasAnchors = false;\n        this._cached = null;\n        this._anchorCache = {\n            A0_G0: null,\n            A0_G1: null,\n            A1_G0: null,\n            A1_G1: null\n        };\n    }\n    dispose() {\n        this._disposeCaches();\n    }\n    _disposeCaches() {\n        if (this._cached) {\n            this._cached.dispose();\n            this._cached = null;\n        }\n        if (this._anchorCache.A0_G0) {\n            this._anchorCache.A0_G0.dispose();\n            this._anchorCache.A0_G0 = null;\n        }\n        if (this._anchorCache.A0_G1) {\n            this._anchorCache.A0_G1.dispose();\n            this._anchorCache.A0_G1 = null;\n        }\n        if (this._anchorCache.A1_G0) {\n            this._anchorCache.A1_G0.dispose();\n            this._anchorCache.A1_G0 = null;\n        }\n        if (this._anchorCache.A1_G1) {\n            this._anchorCache.A1_G1.dispose();\n            this._anchorCache.A1_G1 = null;\n        }\n    }\n    push(item) {\n        this._items.push(item);\n        this._hasAnchors = this._hasAnchors || item.hasAnchor;\n    }\n    unshift(item) {\n        this._items.unshift(item);\n        this._hasAnchors = this._hasAnchors || item.hasAnchor;\n    }\n    length() {\n        return this._items.length;\n    }\n    setSource(index, newSource) {\n        if (this._items[index].source !== newSource) {\n            // bust the cache\n            this._disposeCaches();\n            this._items[index].setSource(newSource);\n        }\n    }\n    compile(onigLib) {\n        if (!this._cached) {\n            let regExps = this._items.map(e => e.source);\n            this._cached = new CompiledRule(onigLib, regExps, this._items.map(e => e.ruleId));\n        }\n        return this._cached;\n    }\n    compileAG(onigLib, allowA, allowG) {\n        if (!this._hasAnchors) {\n            return this.compile(onigLib);\n        }\n        else {\n            if (allowA) {\n                if (allowG) {\n                    if (!this._anchorCache.A1_G1) {\n                        this._anchorCache.A1_G1 = this._resolveAnchors(onigLib, allowA, allowG);\n                    }\n                    return this._anchorCache.A1_G1;\n                }\n                else {\n                    if (!this._anchorCache.A1_G0) {\n                        this._anchorCache.A1_G0 = this._resolveAnchors(onigLib, allowA, allowG);\n                    }\n                    return this._anchorCache.A1_G0;\n                }\n            }\n            else {\n                if (allowG) {\n                    if (!this._anchorCache.A0_G1) {\n                        this._anchorCache.A0_G1 = this._resolveAnchors(onigLib, allowA, allowG);\n                    }\n                    return this._anchorCache.A0_G1;\n                }\n                else {\n                    if (!this._anchorCache.A0_G0) {\n                        this._anchorCache.A0_G0 = this._resolveAnchors(onigLib, allowA, allowG);\n                    }\n                    return this._anchorCache.A0_G0;\n                }\n            }\n        }\n    }\n    _resolveAnchors(onigLib, allowA, allowG) {\n        let regExps = this._items.map(e => e.resolveAnchors(allowA, allowG));\n        return new CompiledRule(onigLib, regExps, this._items.map(e => e.ruleId));\n    }\n}\nexports.RegExpSourceList = RegExpSourceList;\nclass CompiledRule {\n    constructor(onigLib, regExps, rules) {\n        this.regExps = regExps;\n        this.rules = rules;\n        this.scanner = onigLib.createOnigScanner(regExps);\n    }\n    dispose() {\n        if (typeof this.scanner.dispose === \"function\") {\n            this.scanner.dispose();\n        }\n    }\n    toString() {\n        const r = [];\n        for (let i = 0, len = this.rules.length; i < len; i++) {\n            r.push(\"   - \" + this.rules[i] + \": \" + this.regExps[i]);\n        }\n        return r.join(\"\\n\");\n    }\n    findNextMatchSync(string, startPosition, options) {\n        const result = this.scanner.findNextMatchSync(string, startPosition, options);\n        if (!result) {\n            return null;\n        }\n        return {\n            ruleId: this.rules[result.index],\n            captureIndices: result.captureIndices,\n        };\n    }\n}\nexports.CompiledRule = CompiledRule;\n//# sourceMappingURL=rule.js.map", "\"use strict\";\n/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ThemeTrieElement = exports.ThemeTrieElementRule = exports.ColorMap = exports.fontStyleToString = exports.ParsedThemeRule = exports.parseTheme = exports.StyleAttributes = exports.ScopeStack = exports.Theme = void 0;\nconst utils_1 = require(\"./utils\");\nclass Theme {\n    constructor(_colorMap, _defaults, _root) {\n        this._colorMap = _colorMap;\n        this._defaults = _defaults;\n        this._root = _root;\n        this._cachedMatchRoot = new utils_1.CachedFn((scopeName) => this._root.match(scopeName));\n    }\n    static createFromRawTheme(source, colorMap) {\n        return this.createFromParsedTheme(parseTheme(source), colorMap);\n    }\n    static createFromParsedTheme(source, colorMap) {\n        return resolveParsedThemeRules(source, colorMap);\n    }\n    getColorMap() {\n        return this._colorMap.getColorMap();\n    }\n    getDefaults() {\n        return this._defaults;\n    }\n    match(scopePath) {\n        if (scopePath === null) {\n            return this._defaults;\n        }\n        const scopeName = scopePath.scopeName;\n        const matchingTrieElements = this._cachedMatchRoot.get(scopeName);\n        const effectiveRule = matchingTrieElements.find((v) => _scopePathMatchesParentScopes(scopePath.parent, v.parentScopes));\n        if (!effectiveRule) {\n            return null;\n        }\n        return new StyleAttributes(effectiveRule.fontStyle, effectiveRule.foreground, effectiveRule.background);\n    }\n}\nexports.Theme = Theme;\nclass ScopeStack {\n    constructor(parent, scopeName) {\n        this.parent = parent;\n        this.scopeName = scopeName;\n    }\n    static from(...segments) {\n        let result = null;\n        for (let i = 0; i < segments.length; i++) {\n            result = new ScopeStack(result, segments[i]);\n        }\n        return result;\n    }\n    push(scopeName) {\n        return new ScopeStack(this, scopeName);\n    }\n    getSegments() {\n        let item = this;\n        const result = [];\n        while (item) {\n            result.push(item.scopeName);\n            item = item.parent;\n        }\n        result.reverse();\n        return result;\n    }\n    toString() {\n        return this.getSegments().join(' ');\n    }\n}\nexports.ScopeStack = ScopeStack;\nfunction _scopePathMatchesParentScopes(scopePath, parentScopes) {\n    if (parentScopes === null) {\n        return true;\n    }\n    let index = 0;\n    let scopePattern = parentScopes[index];\n    while (scopePath) {\n        if (_matchesScope(scopePath.scopeName, scopePattern)) {\n            index++;\n            if (index === parentScopes.length) {\n                return true;\n            }\n            scopePattern = parentScopes[index];\n        }\n        scopePath = scopePath.parent;\n    }\n    return false;\n}\nfunction _matchesScope(scopeName, scopePattern) {\n    return scopePattern === scopeName || (scopeName.startsWith(scopePattern) && scopeName[scopePattern.length] === '.');\n}\nclass StyleAttributes {\n    constructor(fontStyle, foregroundId, backgroundId) {\n        this.fontStyle = fontStyle;\n        this.foregroundId = foregroundId;\n        this.backgroundId = backgroundId;\n    }\n}\nexports.StyleAttributes = StyleAttributes;\n/**\n * Parse a raw theme into rules.\n */\nfunction parseTheme(source) {\n    if (!source) {\n        return [];\n    }\n    if (!source.settings || !Array.isArray(source.settings)) {\n        return [];\n    }\n    let settings = source.settings;\n    let result = [], resultLen = 0;\n    for (let i = 0, len = settings.length; i < len; i++) {\n        let entry = settings[i];\n        if (!entry.settings) {\n            continue;\n        }\n        let scopes;\n        if (typeof entry.scope === 'string') {\n            let _scope = entry.scope;\n            // remove leading commas\n            _scope = _scope.replace(/^[,]+/, '');\n            // remove trailing commans\n            _scope = _scope.replace(/[,]+$/, '');\n            scopes = _scope.split(',');\n        }\n        else if (Array.isArray(entry.scope)) {\n            scopes = entry.scope;\n        }\n        else {\n            scopes = [''];\n        }\n        let fontStyle = -1 /* NotSet */;\n        if (typeof entry.settings.fontStyle === 'string') {\n            fontStyle = 0 /* None */;\n            let segments = entry.settings.fontStyle.split(' ');\n            for (let j = 0, lenJ = segments.length; j < lenJ; j++) {\n                let segment = segments[j];\n                switch (segment) {\n                    case 'italic':\n                        fontStyle = fontStyle | 1 /* Italic */;\n                        break;\n                    case 'bold':\n                        fontStyle = fontStyle | 2 /* Bold */;\n                        break;\n                    case 'underline':\n                        fontStyle = fontStyle | 4 /* Underline */;\n                        break;\n                    case 'strikethrough':\n                        fontStyle = fontStyle | 8 /* Strikethrough */;\n                        break;\n                }\n            }\n        }\n        let foreground = null;\n        if (typeof entry.settings.foreground === 'string' && utils_1.isValidHexColor(entry.settings.foreground)) {\n            foreground = entry.settings.foreground;\n        }\n        let background = null;\n        if (typeof entry.settings.background === 'string' && utils_1.isValidHexColor(entry.settings.background)) {\n            background = entry.settings.background;\n        }\n        for (let j = 0, lenJ = scopes.length; j < lenJ; j++) {\n            let _scope = scopes[j].trim();\n            let segments = _scope.split(' ');\n            let scope = segments[segments.length - 1];\n            let parentScopes = null;\n            if (segments.length > 1) {\n                parentScopes = segments.slice(0, segments.length - 1);\n                parentScopes.reverse();\n            }\n            result[resultLen++] = new ParsedThemeRule(scope, parentScopes, i, fontStyle, foreground, background);\n        }\n    }\n    return result;\n}\nexports.parseTheme = parseTheme;\nclass ParsedThemeRule {\n    constructor(scope, parentScopes, index, fontStyle, foreground, background) {\n        this.scope = scope;\n        this.parentScopes = parentScopes;\n        this.index = index;\n        this.fontStyle = fontStyle;\n        this.foreground = foreground;\n        this.background = background;\n    }\n}\nexports.ParsedThemeRule = ParsedThemeRule;\nfunction fontStyleToString(fontStyle) {\n    if (fontStyle === -1 /* NotSet */) {\n        return 'not set';\n    }\n    let style = '';\n    if (fontStyle & 1 /* Italic */) {\n        style += 'italic ';\n    }\n    if (fontStyle & 2 /* Bold */) {\n        style += 'bold ';\n    }\n    if (fontStyle & 4 /* Underline */) {\n        style += 'underline ';\n    }\n    if (fontStyle & 8 /* Strikethrough */) {\n        style += 'strikethrough ';\n    }\n    if (style === '') {\n        style = 'none';\n    }\n    return style.trim();\n}\nexports.fontStyleToString = fontStyleToString;\n/**\n * Resolve rules (i.e. inheritance).\n */\nfunction resolveParsedThemeRules(parsedThemeRules, _colorMap) {\n    // Sort rules lexicographically, and then by index if necessary\n    parsedThemeRules.sort((a, b) => {\n        let r = utils_1.strcmp(a.scope, b.scope);\n        if (r !== 0) {\n            return r;\n        }\n        r = utils_1.strArrCmp(a.parentScopes, b.parentScopes);\n        if (r !== 0) {\n            return r;\n        }\n        return a.index - b.index;\n    });\n    // Determine defaults\n    let defaultFontStyle = 0 /* None */;\n    let defaultForeground = '#000000';\n    let defaultBackground = '#ffffff';\n    while (parsedThemeRules.length >= 1 && parsedThemeRules[0].scope === '') {\n        let incomingDefaults = parsedThemeRules.shift();\n        if (incomingDefaults.fontStyle !== -1 /* NotSet */) {\n            defaultFontStyle = incomingDefaults.fontStyle;\n        }\n        if (incomingDefaults.foreground !== null) {\n            defaultForeground = incomingDefaults.foreground;\n        }\n        if (incomingDefaults.background !== null) {\n            defaultBackground = incomingDefaults.background;\n        }\n    }\n    let colorMap = new ColorMap(_colorMap);\n    let defaults = new StyleAttributes(defaultFontStyle, colorMap.getId(defaultForeground), colorMap.getId(defaultBackground));\n    let root = new ThemeTrieElement(new ThemeTrieElementRule(0, null, -1 /* NotSet */, 0, 0), []);\n    for (let i = 0, len = parsedThemeRules.length; i < len; i++) {\n        let rule = parsedThemeRules[i];\n        root.insert(0, rule.scope, rule.parentScopes, rule.fontStyle, colorMap.getId(rule.foreground), colorMap.getId(rule.background));\n    }\n    return new Theme(colorMap, defaults, root);\n}\nclass ColorMap {\n    constructor(_colorMap) {\n        this._lastColorId = 0;\n        this._id2color = [];\n        this._color2id = Object.create(null);\n        if (Array.isArray(_colorMap)) {\n            this._isFrozen = true;\n            for (let i = 0, len = _colorMap.length; i < len; i++) {\n                this._color2id[_colorMap[i]] = i;\n                this._id2color[i] = _colorMap[i];\n            }\n        }\n        else {\n            this._isFrozen = false;\n        }\n    }\n    getId(color) {\n        if (color === null) {\n            return 0;\n        }\n        color = color.toUpperCase();\n        let value = this._color2id[color];\n        if (value) {\n            return value;\n        }\n        if (this._isFrozen) {\n            throw new Error(`Missing color in color map - ${color}`);\n        }\n        value = ++this._lastColorId;\n        this._color2id[color] = value;\n        this._id2color[value] = color;\n        return value;\n    }\n    getColorMap() {\n        return this._id2color.slice(0);\n    }\n}\nexports.ColorMap = ColorMap;\nclass ThemeTrieElementRule {\n    constructor(scopeDepth, parentScopes, fontStyle, foreground, background) {\n        this.scopeDepth = scopeDepth;\n        this.parentScopes = parentScopes;\n        this.fontStyle = fontStyle;\n        this.foreground = foreground;\n        this.background = background;\n    }\n    clone() {\n        return new ThemeTrieElementRule(this.scopeDepth, this.parentScopes, this.fontStyle, this.foreground, this.background);\n    }\n    static cloneArr(arr) {\n        let r = [];\n        for (let i = 0, len = arr.length; i < len; i++) {\n            r[i] = arr[i].clone();\n        }\n        return r;\n    }\n    acceptOverwrite(scopeDepth, fontStyle, foreground, background) {\n        if (this.scopeDepth > scopeDepth) {\n            console.log('how did this happen?');\n        }\n        else {\n            this.scopeDepth = scopeDepth;\n        }\n        // console.log('TODO -> my depth: ' + this.scopeDepth + ', overwriting depth: ' + scopeDepth);\n        if (fontStyle !== -1 /* NotSet */) {\n            this.fontStyle = fontStyle;\n        }\n        if (foreground !== 0) {\n            this.foreground = foreground;\n        }\n        if (background !== 0) {\n            this.background = background;\n        }\n    }\n}\nexports.ThemeTrieElementRule = ThemeTrieElementRule;\nclass ThemeTrieElement {\n    constructor(_mainRule, rulesWithParentScopes = [], _children = {}) {\n        this._mainRule = _mainRule;\n        this._children = _children;\n        this._rulesWithParentScopes = rulesWithParentScopes;\n    }\n    static _sortBySpecificity(arr) {\n        if (arr.length === 1) {\n            return arr;\n        }\n        arr.sort(this._cmpBySpecificity);\n        return arr;\n    }\n    static _cmpBySpecificity(a, b) {\n        if (a.scopeDepth === b.scopeDepth) {\n            const aParentScopes = a.parentScopes;\n            const bParentScopes = b.parentScopes;\n            let aParentScopesLen = aParentScopes === null ? 0 : aParentScopes.length;\n            let bParentScopesLen = bParentScopes === null ? 0 : bParentScopes.length;\n            if (aParentScopesLen === bParentScopesLen) {\n                for (let i = 0; i < aParentScopesLen; i++) {\n                    const aLen = aParentScopes[i].length;\n                    const bLen = bParentScopes[i].length;\n                    if (aLen !== bLen) {\n                        return bLen - aLen;\n                    }\n                }\n            }\n            return bParentScopesLen - aParentScopesLen;\n        }\n        return b.scopeDepth - a.scopeDepth;\n    }\n    match(scope) {\n        if (scope === '') {\n            return ThemeTrieElement._sortBySpecificity([].concat(this._mainRule).concat(this._rulesWithParentScopes));\n        }\n        let dotIndex = scope.indexOf('.');\n        let head;\n        let tail;\n        if (dotIndex === -1) {\n            head = scope;\n            tail = '';\n        }\n        else {\n            head = scope.substring(0, dotIndex);\n            tail = scope.substring(dotIndex + 1);\n        }\n        if (this._children.hasOwnProperty(head)) {\n            return this._children[head].match(tail);\n        }\n        return ThemeTrieElement._sortBySpecificity([].concat(this._mainRule).concat(this._rulesWithParentScopes));\n    }\n    insert(scopeDepth, scope, parentScopes, fontStyle, foreground, background) {\n        if (scope === '') {\n            this._doInsertHere(scopeDepth, parentScopes, fontStyle, foreground, background);\n            return;\n        }\n        let dotIndex = scope.indexOf('.');\n        let head;\n        let tail;\n        if (dotIndex === -1) {\n            head = scope;\n            tail = '';\n        }\n        else {\n            head = scope.substring(0, dotIndex);\n            tail = scope.substring(dotIndex + 1);\n        }\n        let child;\n        if (this._children.hasOwnProperty(head)) {\n            child = this._children[head];\n        }\n        else {\n            child = new ThemeTrieElement(this._mainRule.clone(), ThemeTrieElementRule.cloneArr(this._rulesWithParentScopes));\n            this._children[head] = child;\n        }\n        child.insert(scopeDepth + 1, tail, parentScopes, fontStyle, foreground, background);\n    }\n    _doInsertHere(scopeDepth, parentScopes, fontStyle, foreground, background) {\n        if (parentScopes === null) {\n            // Merge into the main rule\n            this._mainRule.acceptOverwrite(scopeDepth, fontStyle, foreground, background);\n            return;\n        }\n        // Try to merge into existing rule\n        for (let i = 0, len = this._rulesWithParentScopes.length; i < len; i++) {\n            let rule = this._rulesWithParentScopes[i];\n            if (utils_1.strArrCmp(rule.parentScopes, parentScopes) === 0) {\n                // bingo! => we get to merge this into an existing one\n                rule.acceptOverwrite(scopeDepth, fontStyle, foreground, background);\n                return;\n            }\n        }\n        // Must add a new rule\n        // Inherit from main rule\n        if (fontStyle === -1 /* NotSet */) {\n            fontStyle = this._mainRule.fontStyle;\n        }\n        if (foreground === 0) {\n            foreground = this._mainRule.foreground;\n        }\n        if (background === 0) {\n            background = this._mainRule.background;\n        }\n        this._rulesWithParentScopes.push(new ThemeTrieElementRule(scopeDepth, parentScopes, fontStyle, foreground, background));\n    }\n}\nexports.ThemeTrieElement = ThemeTrieElement;\n//# sourceMappingURL=theme.js.map", "\"use strict\";\n/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.performanceNow = exports.CachedFn = exports.escapeRegExpCharacters = exports.isValidHexColor = exports.strArrCmp = exports.strcmp = exports.RegexSource = exports.basename = exports.mergeObjects = exports.clone = void 0;\nfunction clone(something) {\n    return doClone(something);\n}\nexports.clone = clone;\nfunction doClone(something) {\n    if (Array.isArray(something)) {\n        return cloneArray(something);\n    }\n    if (typeof something === 'object') {\n        return cloneObj(something);\n    }\n    return something;\n}\nfunction cloneArray(arr) {\n    let r = [];\n    for (let i = 0, len = arr.length; i < len; i++) {\n        r[i] = doClone(arr[i]);\n    }\n    return r;\n}\nfunction cloneObj(obj) {\n    let r = {};\n    for (let key in obj) {\n        r[key] = doClone(obj[key]);\n    }\n    return r;\n}\nfunction mergeObjects(target, ...sources) {\n    sources.forEach(source => {\n        for (let key in source) {\n            target[key] = source[key];\n        }\n    });\n    return target;\n}\nexports.mergeObjects = mergeObjects;\nfunction basename(path) {\n    const idx = ~path.lastIndexOf('/') || ~path.lastIndexOf('\\\\');\n    if (idx === 0) {\n        return path;\n    }\n    else if (~idx === path.length - 1) {\n        return basename(path.substring(0, path.length - 1));\n    }\n    else {\n        return path.substr(~idx + 1);\n    }\n}\nexports.basename = basename;\nlet CAPTURING_REGEX_SOURCE = /\\$(\\d+)|\\${(\\d+):\\/(downcase|upcase)}/g;\nclass RegexSource {\n    static hasCaptures(regexSource) {\n        if (regexSource === null) {\n            return false;\n        }\n        CAPTURING_REGEX_SOURCE.lastIndex = 0;\n        return CAPTURING_REGEX_SOURCE.test(regexSource);\n    }\n    static replaceCaptures(regexSource, captureSource, captureIndices) {\n        return regexSource.replace(CAPTURING_REGEX_SOURCE, (match, index, commandIndex, command) => {\n            let capture = captureIndices[parseInt(index || commandIndex, 10)];\n            if (capture) {\n                let result = captureSource.substring(capture.start, capture.end);\n                // Remove leading dots that would make the selector invalid\n                while (result[0] === '.') {\n                    result = result.substring(1);\n                }\n                switch (command) {\n                    case 'downcase':\n                        return result.toLowerCase();\n                    case 'upcase':\n                        return result.toUpperCase();\n                    default:\n                        return result;\n                }\n            }\n            else {\n                return match;\n            }\n        });\n    }\n}\nexports.RegexSource = RegexSource;\nfunction strcmp(a, b) {\n    if (a < b) {\n        return -1;\n    }\n    if (a > b) {\n        return 1;\n    }\n    return 0;\n}\nexports.strcmp = strcmp;\nfunction strArrCmp(a, b) {\n    if (a === null && b === null) {\n        return 0;\n    }\n    if (!a) {\n        return -1;\n    }\n    if (!b) {\n        return 1;\n    }\n    let len1 = a.length;\n    let len2 = b.length;\n    if (len1 === len2) {\n        for (let i = 0; i < len1; i++) {\n            let res = strcmp(a[i], b[i]);\n            if (res !== 0) {\n                return res;\n            }\n        }\n        return 0;\n    }\n    return len1 - len2;\n}\nexports.strArrCmp = strArrCmp;\nfunction isValidHexColor(hex) {\n    if (/^#[0-9a-f]{6}$/i.test(hex)) {\n        // #rrggbb\n        return true;\n    }\n    if (/^#[0-9a-f]{8}$/i.test(hex)) {\n        // #rrggbbaa\n        return true;\n    }\n    if (/^#[0-9a-f]{3}$/i.test(hex)) {\n        // #rgb\n        return true;\n    }\n    if (/^#[0-9a-f]{4}$/i.test(hex)) {\n        // #rgba\n        return true;\n    }\n    return false;\n}\nexports.isValidHexColor = isValidHexColor;\n/**\n * Escapes regular expression characters in a given string\n */\nfunction escapeRegExpCharacters(value) {\n    return value.replace(/[\\-\\\\\\{\\}\\*\\+\\?\\|\\^\\$\\.\\,\\[\\]\\(\\)\\#\\s]/g, '\\\\$&');\n}\nexports.escapeRegExpCharacters = escapeRegExpCharacters;\nclass CachedFn {\n    constructor(fn) {\n        this.fn = fn;\n        this.cache = new Map();\n    }\n    get(key) {\n        if (this.cache.has(key)) {\n            return this.cache.get(key);\n        }\n        const value = this.fn(key);\n        this.cache.set(key, value);\n        return value;\n    }\n}\nexports.CachedFn = CachedFn;\nexports.performanceNow = typeof performance === \"undefined\"\n    // performance.now() is not available in this environment, so use Date.now()\n    ? function () {\n        return Date.now();\n    }\n    : function () {\n        return performance.now();\n    };\n//# sourceMappingURL=utils.js.map", "// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n", "// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(787);\n", "module.exports = Object.create(new Proxy({}, {\n  get(_, key) {\n    if (\n      key !== '__esModule' &&\n      key !== '__proto__' &&\n      key !== 'constructor' &&\n      key !== 'splice'\n    ) {\n      console.warn(`Module \"path\" has been externalized for browser compatibility. Cannot access \"path.${key}\" in client code. See http://vitejs.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)\n    }\n  }\n}))", "module.exports = Object.create(new Proxy({}, {\n  get(_, key) {\n    if (\n      key !== '__esModule' &&\n      key !== '__proto__' &&\n      key !== 'constructor' &&\n      key !== 'splice'\n    ) {\n      console.warn(`Module \"fs\" has been externalized for browser compatibility. Cannot access \"fs.${key}\" in client code. See http://vitejs.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)\n    }\n  }\n}))", "/*!\n\nJSZip v3.10.1 - A JavaScript class for generating and reading zip files\n<http://stuartk.com/jszip>\n\n(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>\nDual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.\n\nJSZip uses the library pako released under the MIT license :\nhttps://github.com/nodeca/pako/blob/main/LICENSE\n*/\n\n!function(e){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{(\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:this).JSZip=e()}}(function(){return function s(a,o,h){function u(r,e){if(!o[r]){if(!a[r]){var t=\"function\"==typeof require&&require;if(!e&&t)return t(r,!0);if(l)return l(r,!0);var n=new Error(\"Cannot find module '\"+r+\"'\");throw n.code=\"MODULE_NOT_FOUND\",n}var i=o[r]={exports:{}};a[r][0].call(i.exports,function(e){var t=a[r][1][e];return u(t||e)},i,i.exports,s,a,o,h)}return o[r].exports}for(var l=\"function\"==typeof require&&require,e=0;e<h.length;e++)u(h[e]);return u}({1:[function(e,t,r){\"use strict\";var d=e(\"./utils\"),c=e(\"./support\"),p=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";r.encode=function(e){for(var t,r,n,i,s,a,o,h=[],u=0,l=e.length,f=l,c=\"string\"!==d.getTypeOf(e);u<e.length;)f=l-u,n=c?(t=e[u++],r=u<l?e[u++]:0,u<l?e[u++]:0):(t=e.charCodeAt(u++),r=u<l?e.charCodeAt(u++):0,u<l?e.charCodeAt(u++):0),i=t>>2,s=(3&t)<<4|r>>4,a=1<f?(15&r)<<2|n>>6:64,o=2<f?63&n:64,h.push(p.charAt(i)+p.charAt(s)+p.charAt(a)+p.charAt(o));return h.join(\"\")},r.decode=function(e){var t,r,n,i,s,a,o=0,h=0,u=\"data:\";if(e.substr(0,u.length)===u)throw new Error(\"Invalid base64 input, it looks like a data url.\");var l,f=3*(e=e.replace(/[^A-Za-z0-9+/=]/g,\"\")).length/4;if(e.charAt(e.length-1)===p.charAt(64)&&f--,e.charAt(e.length-2)===p.charAt(64)&&f--,f%1!=0)throw new Error(\"Invalid base64 input, bad content length.\");for(l=c.uint8array?new Uint8Array(0|f):new Array(0|f);o<e.length;)t=p.indexOf(e.charAt(o++))<<2|(i=p.indexOf(e.charAt(o++)))>>4,r=(15&i)<<4|(s=p.indexOf(e.charAt(o++)))>>2,n=(3&s)<<6|(a=p.indexOf(e.charAt(o++))),l[h++]=t,64!==s&&(l[h++]=r),64!==a&&(l[h++]=n);return l}},{\"./support\":30,\"./utils\":32}],2:[function(e,t,r){\"use strict\";var n=e(\"./external\"),i=e(\"./stream/DataWorker\"),s=e(\"./stream/Crc32Probe\"),a=e(\"./stream/DataLengthProbe\");function o(e,t,r,n,i){this.compressedSize=e,this.uncompressedSize=t,this.crc32=r,this.compression=n,this.compressedContent=i}o.prototype={getContentWorker:function(){var e=new i(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a(\"data_length\")),t=this;return e.on(\"end\",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error(\"Bug : uncompressed data size mismatch\")}),e},getCompressedWorker:function(){return new i(n.Promise.resolve(this.compressedContent)).withStreamInfo(\"compressedSize\",this.compressedSize).withStreamInfo(\"uncompressedSize\",this.uncompressedSize).withStreamInfo(\"crc32\",this.crc32).withStreamInfo(\"compression\",this.compression)}},o.createWorkerFrom=function(e,t,r){return e.pipe(new s).pipe(new a(\"uncompressedSize\")).pipe(t.compressWorker(r)).pipe(new a(\"compressedSize\")).withStreamInfo(\"compression\",t)},t.exports=o},{\"./external\":6,\"./stream/Crc32Probe\":25,\"./stream/DataLengthProbe\":26,\"./stream/DataWorker\":27}],3:[function(e,t,r){\"use strict\";var n=e(\"./stream/GenericWorker\");r.STORE={magic:\"\\0\\0\",compressWorker:function(){return new n(\"STORE compression\")},uncompressWorker:function(){return new n(\"STORE decompression\")}},r.DEFLATE=e(\"./flate\")},{\"./flate\":7,\"./stream/GenericWorker\":28}],4:[function(e,t,r){\"use strict\";var n=e(\"./utils\");var o=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?\"string\"!==n.getTypeOf(e)?function(e,t,r,n){var i=o,s=n+r;e^=-1;for(var a=n;a<s;a++)e=e>>>8^i[255&(e^t[a])];return-1^e}(0|t,e,e.length,0):function(e,t,r,n){var i=o,s=n+r;e^=-1;for(var a=n;a<s;a++)e=e>>>8^i[255&(e^t.charCodeAt(a))];return-1^e}(0|t,e,e.length,0):0}},{\"./utils\":32}],5:[function(e,t,r){\"use strict\";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,t,r){\"use strict\";var n=null;n=\"undefined\"!=typeof Promise?Promise:e(\"lie\"),t.exports={Promise:n}},{lie:37}],7:[function(e,t,r){\"use strict\";var n=\"undefined\"!=typeof Uint8Array&&\"undefined\"!=typeof Uint16Array&&\"undefined\"!=typeof Uint32Array,i=e(\"pako\"),s=e(\"./utils\"),a=e(\"./stream/GenericWorker\"),o=n?\"uint8array\":\"array\";function h(e,t){a.call(this,\"FlateWorker/\"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}r.magic=\"\\b\\0\",s.inherits(h,a),h.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(o,e.data),!1)},h.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},r.compressWorker=function(e){return new h(\"Deflate\",e)},r.uncompressWorker=function(){return new h(\"Inflate\",{})}},{\"./stream/GenericWorker\":28,\"./utils\":32,pako:38}],8:[function(e,t,r){\"use strict\";function A(e,t){var r,n=\"\";for(r=0;r<t;r++)n+=String.fromCharCode(255&e),e>>>=8;return n}function n(e,t,r,n,i,s){var a,o,h=e.file,u=e.compression,l=s!==O.utf8encode,f=I.transformTo(\"string\",s(h.name)),c=I.transformTo(\"string\",O.utf8encode(h.name)),d=h.comment,p=I.transformTo(\"string\",s(d)),m=I.transformTo(\"string\",O.utf8encode(d)),_=c.length!==h.name.length,g=m.length!==d.length,b=\"\",v=\"\",y=\"\",w=h.dir,k=h.date,x={crc32:0,compressedSize:0,uncompressedSize:0};t&&!r||(x.crc32=e.crc32,x.compressedSize=e.compressedSize,x.uncompressedSize=e.uncompressedSize);var S=0;t&&(S|=8),l||!_&&!g||(S|=2048);var z=0,C=0;w&&(z|=16),\"UNIX\"===i?(C=798,z|=function(e,t){var r=e;return e||(r=t?16893:33204),(65535&r)<<16}(h.unixPermissions,w)):(C=20,z|=function(e){return 63&(e||0)}(h.dosPermissions)),a=k.getUTCHours(),a<<=6,a|=k.getUTCMinutes(),a<<=5,a|=k.getUTCSeconds()/2,o=k.getUTCFullYear()-1980,o<<=4,o|=k.getUTCMonth()+1,o<<=5,o|=k.getUTCDate(),_&&(v=A(1,1)+A(B(f),4)+c,b+=\"up\"+A(v.length,2)+v),g&&(y=A(1,1)+A(B(p),4)+m,b+=\"uc\"+A(y.length,2)+y);var E=\"\";return E+=\"\\n\\0\",E+=A(S,2),E+=u.magic,E+=A(a,2),E+=A(o,2),E+=A(x.crc32,4),E+=A(x.compressedSize,4),E+=A(x.uncompressedSize,4),E+=A(f.length,2),E+=A(b.length,2),{fileRecord:R.LOCAL_FILE_HEADER+E+f+b,dirRecord:R.CENTRAL_FILE_HEADER+A(C,2)+E+A(p.length,2)+\"\\0\\0\\0\\0\"+A(z,4)+A(n,4)+f+b+p}}var I=e(\"../utils\"),i=e(\"../stream/GenericWorker\"),O=e(\"../utf8\"),B=e(\"../crc32\"),R=e(\"../signature\");function s(e,t,r,n){i.call(this,\"ZipFileWorker\"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=r,this.encodeFileName=n,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}I.inherits(s,i),s.prototype.push=function(e){var t=e.meta.percent||0,r=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,i.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:r?(t+100*(r-n-1))/r:100}}))},s.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var r=n(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0},s.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,r=n(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),t)this.push({data:function(e){return R.DATA_DESCRIPTOR+A(e.crc32,4)+A(e.compressedSize,4)+A(e.uncompressedSize,4)}(e),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},s.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var r=this.bytesWritten-e,n=function(e,t,r,n,i){var s=I.transformTo(\"string\",i(n));return R.CENTRAL_DIRECTORY_END+\"\\0\\0\\0\\0\"+A(e,2)+A(e,2)+A(t,4)+A(r,4)+A(s.length,2)+s}(this.dirRecords.length,r,e,this.zipComment,this.encodeFileName);this.push({data:n,meta:{percent:100}})},s.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},s.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on(\"data\",function(e){t.processChunk(e)}),e.on(\"end\",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on(\"error\",function(e){t.error(e)}),this},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},s.prototype.error=function(e){var t=this._sources;if(!i.prototype.error.call(this,e))return!1;for(var r=0;r<t.length;r++)try{t[r].error(e)}catch(e){}return!0},s.prototype.lock=function(){i.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=s},{\"../crc32\":4,\"../signature\":23,\"../stream/GenericWorker\":28,\"../utf8\":31,\"../utils\":32}],9:[function(e,t,r){\"use strict\";var u=e(\"../compressions\"),n=e(\"./ZipFileWorker\");r.generateWorker=function(e,a,t){var o=new n(a.streamFiles,t,a.platform,a.encodeFileName),h=0;try{e.forEach(function(e,t){h++;var r=function(e,t){var r=e||t,n=u[r];if(!n)throw new Error(r+\" is not a valid compression method !\");return n}(t.options.compression,a.compression),n=t.options.compressionOptions||a.compressionOptions||{},i=t.dir,s=t.date;t._compressWorker(r,n).withStreamInfo(\"file\",{name:e,dir:i,date:s,comment:t.comment||\"\",unixPermissions:t.unixPermissions,dosPermissions:t.dosPermissions}).pipe(o)}),o.entriesCount=h}catch(e){o.error(e)}return o}},{\"../compressions\":3,\"./ZipFileWorker\":8}],10:[function(e,t,r){\"use strict\";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error(\"The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.\");this.files=Object.create(null),this.comment=null,this.root=\"\",this.clone=function(){var e=new n;for(var t in this)\"function\"!=typeof this[t]&&(e[t]=this[t]);return e}}(n.prototype=e(\"./object\")).loadAsync=e(\"./load\"),n.support=e(\"./support\"),n.defaults=e(\"./defaults\"),n.version=\"3.10.1\",n.loadAsync=function(e,t){return(new n).loadAsync(e,t)},n.external=e(\"./external\"),t.exports=n},{\"./defaults\":5,\"./external\":6,\"./load\":11,\"./object\":15,\"./support\":30}],11:[function(e,t,r){\"use strict\";var u=e(\"./utils\"),i=e(\"./external\"),n=e(\"./utf8\"),s=e(\"./zipEntries\"),a=e(\"./stream/Crc32Probe\"),l=e(\"./nodejsUtils\");function f(n){return new i.Promise(function(e,t){var r=n.decompressed.getContentWorker().pipe(new a);r.on(\"error\",function(e){t(e)}).on(\"end\",function(){r.streamInfo.crc32!==n.decompressed.crc32?t(new Error(\"Corrupted zip : CRC32 mismatch\")):e()}).resume()})}t.exports=function(e,o){var h=this;return o=u.extend(o||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:n.utf8decode}),l.isNode&&l.isStream(e)?i.Promise.reject(new Error(\"JSZip can't accept a stream when loading a zip file.\")):u.prepareContent(\"the loaded zip file\",e,!0,o.optimizedBinaryString,o.base64).then(function(e){var t=new s(o);return t.load(e),t}).then(function(e){var t=[i.Promise.resolve(e)],r=e.files;if(o.checkCRC32)for(var n=0;n<r.length;n++)t.push(f(r[n]));return i.Promise.all(t)}).then(function(e){for(var t=e.shift(),r=t.files,n=0;n<r.length;n++){var i=r[n],s=i.fileNameStr,a=u.resolve(i.fileNameStr);h.file(a,i.decompressed,{binary:!0,optimizedBinaryString:!0,date:i.date,dir:i.dir,comment:i.fileCommentStr.length?i.fileCommentStr:null,unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions,createFolders:o.createFolders}),i.dir||(h.file(a).unsafeOriginalName=s)}return t.zipComment.length&&(h.comment=t.zipComment),h})}},{\"./external\":6,\"./nodejsUtils\":14,\"./stream/Crc32Probe\":25,\"./utf8\":31,\"./utils\":32,\"./zipEntries\":33}],12:[function(e,t,r){\"use strict\";var n=e(\"../utils\"),i=e(\"../stream/GenericWorker\");function s(e,t){i.call(this,\"Nodejs stream input adapter for \"+e),this._upstreamEnded=!1,this._bindStream(t)}n.inherits(s,i),s.prototype._bindStream=function(e){var t=this;(this._stream=e).pause(),e.on(\"data\",function(e){t.push({data:e,meta:{percent:0}})}).on(\"error\",function(e){t.isPaused?this.generatedError=e:t.error(e)}).on(\"end\",function(){t.isPaused?t._upstreamEnded=!0:t.end()})},s.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=s},{\"../stream/GenericWorker\":28,\"../utils\":32}],13:[function(e,t,r){\"use strict\";var i=e(\"readable-stream\").Readable;function n(e,t,r){i.call(this,t),this._helper=e;var n=this;e.on(\"data\",function(e,t){n.push(e)||n._helper.pause(),r&&r(t)}).on(\"error\",function(e){n.emit(\"error\",e)}).on(\"end\",function(){n.push(null)})}e(\"../utils\").inherits(n,i),n.prototype._read=function(){this._helper.resume()},t.exports=n},{\"../utils\":32,\"readable-stream\":16}],14:[function(e,t,r){\"use strict\";t.exports={isNode:\"undefined\"!=typeof Buffer,newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if(\"number\"==typeof e)throw new Error('The \"data\" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&\"function\"==typeof e.on&&\"function\"==typeof e.pause&&\"function\"==typeof e.resume}}},{}],15:[function(e,t,r){\"use strict\";function s(e,t,r){var n,i=u.getTypeOf(t),s=u.extend(r||{},f);s.date=s.date||new Date,null!==s.compression&&(s.compression=s.compression.toUpperCase()),\"string\"==typeof s.unixPermissions&&(s.unixPermissions=parseInt(s.unixPermissions,8)),s.unixPermissions&&16384&s.unixPermissions&&(s.dir=!0),s.dosPermissions&&16&s.dosPermissions&&(s.dir=!0),s.dir&&(e=g(e)),s.createFolders&&(n=_(e))&&b.call(this,n,!0);var a=\"string\"===i&&!1===s.binary&&!1===s.base64;r&&void 0!==r.binary||(s.binary=!a),(t instanceof c&&0===t.uncompressedSize||s.dir||!t||0===t.length)&&(s.base64=!1,s.binary=!0,t=\"\",s.compression=\"STORE\",i=\"string\");var o=null;o=t instanceof c||t instanceof l?t:p.isNode&&p.isStream(t)?new m(e,t):u.prepareContent(e,t,s.binary,s.optimizedBinaryString,s.base64);var h=new d(e,o,s);this.files[e]=h}var i=e(\"./utf8\"),u=e(\"./utils\"),l=e(\"./stream/GenericWorker\"),a=e(\"./stream/StreamHelper\"),f=e(\"./defaults\"),c=e(\"./compressedObject\"),d=e(\"./zipObject\"),o=e(\"./generate\"),p=e(\"./nodejsUtils\"),m=e(\"./nodejs/NodejsStreamInputAdapter\"),_=function(e){\"/\"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf(\"/\");return 0<t?e.substring(0,t):\"\"},g=function(e){return\"/\"!==e.slice(-1)&&(e+=\"/\"),e},b=function(e,t){return t=void 0!==t?t:f.createFolders,e=g(e),this.files[e]||s.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function h(e){return\"[object RegExp]\"===Object.prototype.toString.call(e)}var n={load:function(){throw new Error(\"This method has been removed in JSZip 3.0, please check the upgrade guide.\")},forEach:function(e){var t,r,n;for(t in this.files)n=this.files[t],(r=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(r,n)},filter:function(r){var n=[];return this.forEach(function(e,t){r(e,t)&&n.push(t)}),n},file:function(e,t,r){if(1!==arguments.length)return e=this.root+e,s.call(this,e,t,r),this;if(h(e)){var n=e;return this.filter(function(e,t){return!t.dir&&n.test(e)})}var i=this.files[this.root+e];return i&&!i.dir?i:null},folder:function(r){if(!r)return this;if(h(r))return this.filter(function(e,t){return t.dir&&r.test(e)});var e=this.root+r,t=b.call(this,e),n=this.clone();return n.root=t.name,n},remove:function(r){r=this.root+r;var e=this.files[r];if(e||(\"/\"!==r.slice(-1)&&(r+=\"/\"),e=this.files[r]),e&&!e.dir)delete this.files[r];else for(var t=this.filter(function(e,t){return t.name.slice(0,r.length)===r}),n=0;n<t.length;n++)delete this.files[t[n].name];return this},generate:function(){throw new Error(\"This method has been removed in JSZip 3.0, please check the upgrade guide.\")},generateInternalStream:function(e){var t,r={};try{if((r=u.extend(e||{},{streamFiles:!1,compression:\"STORE\",compressionOptions:null,type:\"\",platform:\"DOS\",comment:null,mimeType:\"application/zip\",encodeFileName:i.utf8encode})).type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),\"binarystring\"===r.type&&(r.type=\"string\"),!r.type)throw new Error(\"No output type specified.\");u.checkSupport(r.type),\"darwin\"!==r.platform&&\"freebsd\"!==r.platform&&\"linux\"!==r.platform&&\"sunos\"!==r.platform||(r.platform=\"UNIX\"),\"win32\"===r.platform&&(r.platform=\"DOS\");var n=r.comment||this.comment||\"\";t=o.generateWorker(this,r,n)}catch(e){(t=new l(\"error\")).error(e)}return new a(t,r.type||\"string\",r.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type=\"nodebuffer\"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=n},{\"./compressedObject\":2,\"./defaults\":5,\"./generate\":9,\"./nodejs/NodejsStreamInputAdapter\":12,\"./nodejsUtils\":14,\"./stream/GenericWorker\":28,\"./stream/StreamHelper\":29,\"./utf8\":31,\"./utils\":32,\"./zipObject\":35}],16:[function(e,t,r){\"use strict\";t.exports=e(\"stream\")},{stream:void 0}],17:[function(e,t,r){\"use strict\";var n=e(\"./DataReader\");function i(e){n.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e(\"../utils\").inherits(i,n),i.prototype.byteAt=function(e){return this.data[this.zero+e]},i.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),s=this.length-4;0<=s;--s)if(this.data[s]===t&&this.data[s+1]===r&&this.data[s+2]===n&&this.data[s+3]===i)return s-this.zero;return-1},i.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),s=this.readData(4);return t===s[0]&&r===s[1]&&n===s[2]&&i===s[3]},i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{\"../utils\":32,\"./DataReader\":18}],18:[function(e,t,r){\"use strict\";var n=e(\"../utils\");function i(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error(\"End of data reached (data length = \"+this.length+\", asked index = \"+e+\"). Corrupted zip ?\")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return n.transformTo(\"string\",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=i},{\"../utils\":32}],19:[function(e,t,r){\"use strict\";var n=e(\"./Uint8ArrayReader\");function i(e){n.call(this,e)}e(\"../utils\").inherits(i,n),i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{\"../utils\":32,\"./Uint8ArrayReader\":21}],20:[function(e,t,r){\"use strict\";var n=e(\"./DataReader\");function i(e){n.call(this,e)}e(\"../utils\").inherits(i,n),i.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},i.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{\"../utils\":32,\"./DataReader\":18}],21:[function(e,t,r){\"use strict\";var n=e(\"./ArrayReader\");function i(e){n.call(this,e)}e(\"../utils\").inherits(i,n),i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{\"../utils\":32,\"./ArrayReader\":17}],22:[function(e,t,r){\"use strict\";var n=e(\"../utils\"),i=e(\"../support\"),s=e(\"./ArrayReader\"),a=e(\"./StringReader\"),o=e(\"./NodeBufferReader\"),h=e(\"./Uint8ArrayReader\");t.exports=function(e){var t=n.getTypeOf(e);return n.checkSupport(t),\"string\"!==t||i.uint8array?\"nodebuffer\"===t?new o(e):i.uint8array?new h(n.transformTo(\"uint8array\",e)):new s(n.transformTo(\"array\",e)):new a(e)}},{\"../support\":30,\"../utils\":32,\"./ArrayReader\":17,\"./NodeBufferReader\":19,\"./StringReader\":20,\"./Uint8ArrayReader\":21}],23:[function(e,t,r){\"use strict\";r.LOCAL_FILE_HEADER=\"PK\u0003\u0004\",r.CENTRAL_FILE_HEADER=\"PK\u0001\u0002\",r.CENTRAL_DIRECTORY_END=\"PK\u0005\u0006\",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR=\"PK\u0006\u0007\",r.ZIP64_CENTRAL_DIRECTORY_END=\"PK\u0006\u0006\",r.DATA_DESCRIPTOR=\"PK\u0007\\b\"},{}],24:[function(e,t,r){\"use strict\";var n=e(\"./GenericWorker\"),i=e(\"../utils\");function s(e){n.call(this,\"ConvertWorker to \"+e),this.destType=e}i.inherits(s,n),s.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})},t.exports=s},{\"../utils\":32,\"./GenericWorker\":28}],25:[function(e,t,r){\"use strict\";var n=e(\"./GenericWorker\"),i=e(\"../crc32\");function s(){n.call(this,\"Crc32Probe\"),this.withStreamInfo(\"crc32\",0)}e(\"../utils\").inherits(s,n),s.prototype.processChunk=function(e){this.streamInfo.crc32=i(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=s},{\"../crc32\":4,\"../utils\":32,\"./GenericWorker\":28}],26:[function(e,t,r){\"use strict\";var n=e(\"../utils\"),i=e(\"./GenericWorker\");function s(e){i.call(this,\"DataLengthProbe for \"+e),this.propName=e,this.withStreamInfo(e,0)}n.inherits(s,i),s.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}i.prototype.processChunk.call(this,e)},t.exports=s},{\"../utils\":32,\"./GenericWorker\":28}],27:[function(e,t,r){\"use strict\";var n=e(\"../utils\"),i=e(\"./GenericWorker\");function s(e){i.call(this,\"DataWorker\");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type=\"\",this._tickScheduled=!1,e.then(function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=n.getTypeOf(e),t.isPaused||t._tickAndRepeat()},function(e){t.error(e)})}n.inherits(s,i),s.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case\"string\":e=this.data.substring(this.index,t);break;case\"uint8array\":e=this.data.subarray(this.index,t);break;case\"array\":case\"nodebuffer\":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=s},{\"../utils\":32,\"./GenericWorker\":28}],28:[function(e,t,r){\"use strict\";function n(e){this.name=e||\"default\",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(e){this.emit(\"data\",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit(\"end\"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit(\"error\",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit(\"error\",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var r=0;r<this._listeners[e].length;r++)this._listeners[e][r].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error(\"The stream '\"+this+\"' has already been used.\");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on(\"data\",function(e){t.processChunk(e)}),e.on(\"end\",function(){t.end()}),e.on(\"error\",function(e){t.error(e)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var e=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error(\"The stream '\"+this+\"' has already been used.\");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e=\"Worker \"+this.name;return this.previous?this.previous+\" -> \"+e:e}},t.exports=n},{}],29:[function(e,t,r){\"use strict\";var h=e(\"../utils\"),i=e(\"./ConvertWorker\"),s=e(\"./GenericWorker\"),u=e(\"../base64\"),n=e(\"../support\"),a=e(\"../external\"),o=null;if(n.nodestream)try{o=e(\"../nodejs/NodejsStreamOutputAdapter\")}catch(e){}function l(e,o){return new a.Promise(function(t,r){var n=[],i=e._internalType,s=e._outputType,a=e._mimeType;e.on(\"data\",function(e,t){n.push(e),o&&o(t)}).on(\"error\",function(e){n=[],r(e)}).on(\"end\",function(){try{var e=function(e,t,r){switch(e){case\"blob\":return h.newBlob(h.transformTo(\"arraybuffer\",t),r);case\"base64\":return u.encode(t);default:return h.transformTo(e,t)}}(s,function(e,t){var r,n=0,i=null,s=0;for(r=0;r<t.length;r++)s+=t[r].length;switch(e){case\"string\":return t.join(\"\");case\"array\":return Array.prototype.concat.apply([],t);case\"uint8array\":for(i=new Uint8Array(s),r=0;r<t.length;r++)i.set(t[r],n),n+=t[r].length;return i;case\"nodebuffer\":return Buffer.concat(t);default:throw new Error(\"concat : unsupported type '\"+e+\"'\")}}(i,n),a);t(e)}catch(e){r(e)}n=[]}).resume()})}function f(e,t,r){var n=t;switch(t){case\"blob\":case\"arraybuffer\":n=\"uint8array\";break;case\"base64\":n=\"string\"}try{this._internalType=n,this._outputType=t,this._mimeType=r,h.checkSupport(n),this._worker=e.pipe(new i(n)),e.lock()}catch(e){this._worker=new s(\"error\"),this._worker.error(e)}}f.prototype={accumulate:function(e){return l(this,e)},on:function(e,t){var r=this;return\"data\"===e?this._worker.on(e,function(e){t.call(r,e.data,e.meta)}):this._worker.on(e,function(){h.delay(t,arguments,r)}),this},resume:function(){return h.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(h.checkSupport(\"nodestream\"),\"nodebuffer\"!==this._outputType)throw new Error(this._outputType+\" is not supported by this method\");return new o(this,{objectMode:\"nodebuffer\"!==this._outputType},e)}},t.exports=f},{\"../base64\":1,\"../external\":6,\"../nodejs/NodejsStreamOutputAdapter\":13,\"../support\":30,\"../utils\":32,\"./ConvertWorker\":24,\"./GenericWorker\":28}],30:[function(e,t,r){\"use strict\";if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=\"undefined\"!=typeof ArrayBuffer&&\"undefined\"!=typeof Uint8Array,r.nodebuffer=\"undefined\"!=typeof Buffer,r.uint8array=\"undefined\"!=typeof Uint8Array,\"undefined\"==typeof ArrayBuffer)r.blob=!1;else{var n=new ArrayBuffer(0);try{r.blob=0===new Blob([n],{type:\"application/zip\"}).size}catch(e){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(n),r.blob=0===i.getBlob(\"application/zip\").size}catch(e){r.blob=!1}}}try{r.nodestream=!!e(\"readable-stream\").Readable}catch(e){r.nodestream=!1}},{\"readable-stream\":16}],31:[function(e,t,s){\"use strict\";for(var o=e(\"./utils\"),h=e(\"./support\"),r=e(\"./nodejsUtils\"),n=e(\"./stream/GenericWorker\"),u=new Array(256),i=0;i<256;i++)u[i]=252<=i?6:248<=i?5:240<=i?4:224<=i?3:192<=i?2:1;u[254]=u[254]=1;function a(){n.call(this,\"utf-8 decode\"),this.leftOver=null}function l(){n.call(this,\"utf-8 encode\")}s.utf8encode=function(e){return h.nodebuffer?r.newBufferFrom(e,\"utf-8\"):function(e){var t,r,n,i,s,a=e.length,o=0;for(i=0;i<a;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=h.uint8array?new Uint8Array(o):new Array(o),i=s=0;s<o;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?t[s++]=r:(r<2048?t[s++]=192|r>>>6:(r<65536?t[s++]=224|r>>>12:(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63),t[s++]=128|r>>>6&63),t[s++]=128|63&r);return t}(e)},s.utf8decode=function(e){return h.nodebuffer?o.transformTo(\"nodebuffer\",e).toString(\"utf-8\"):function(e){var t,r,n,i,s=e.length,a=new Array(2*s);for(t=r=0;t<s;)if((n=e[t++])<128)a[r++]=n;else if(4<(i=u[n]))a[r++]=65533,t+=i-1;else{for(n&=2===i?31:3===i?15:7;1<i&&t<s;)n=n<<6|63&e[t++],i--;1<i?a[r++]=65533:n<65536?a[r++]=n:(n-=65536,a[r++]=55296|n>>10&1023,a[r++]=56320|1023&n)}return a.length!==r&&(a.subarray?a=a.subarray(0,r):a.length=r),o.applyFromCharCode(a)}(e=o.transformTo(h.uint8array?\"uint8array\":\"array\",e))},o.inherits(a,n),a.prototype.processChunk=function(e){var t=o.transformTo(h.uint8array?\"uint8array\":\"array\",e.data);if(this.leftOver&&this.leftOver.length){if(h.uint8array){var r=t;(t=new Uint8Array(r.length+this.leftOver.length)).set(this.leftOver,0),t.set(r,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var n=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0?t:0===r?t:r+u[e[r]]>t?r:t}(t),i=t;n!==t.length&&(h.uint8array?(i=t.subarray(0,n),this.leftOver=t.subarray(n,t.length)):(i=t.slice(0,n),this.leftOver=t.slice(n,t.length))),this.push({data:s.utf8decode(i),meta:e.meta})},a.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=a,o.inherits(l,n),l.prototype.processChunk=function(e){this.push({data:s.utf8encode(e.data),meta:e.meta})},s.Utf8EncodeWorker=l},{\"./nodejsUtils\":14,\"./stream/GenericWorker\":28,\"./support\":30,\"./utils\":32}],32:[function(e,t,a){\"use strict\";var o=e(\"./support\"),h=e(\"./base64\"),r=e(\"./nodejsUtils\"),u=e(\"./external\");function n(e){return e}function l(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}e(\"setimmediate\"),a.newBlob=function(t,r){a.checkSupport(\"blob\");try{return new Blob([t],{type:r})}catch(e){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(t),n.getBlob(r)}catch(e){throw new Error(\"Bug : can't construct the Blob.\")}}};var i={stringifyByChunk:function(e,t,r){var n=[],i=0,s=e.length;if(s<=r)return String.fromCharCode.apply(null,e);for(;i<s;)\"array\"===t||\"nodebuffer\"===t?n.push(String.fromCharCode.apply(null,e.slice(i,Math.min(i+r,s)))):n.push(String.fromCharCode.apply(null,e.subarray(i,Math.min(i+r,s)))),i+=r;return n.join(\"\")},stringifyByChar:function(e){for(var t=\"\",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},applyCanBeUsed:{uint8array:function(){try{return o.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return o.nodebuffer&&1===String.fromCharCode.apply(null,r.allocBuffer(1)).length}catch(e){return!1}}()}};function s(e){var t=65536,r=a.getTypeOf(e),n=!0;if(\"uint8array\"===r?n=i.applyCanBeUsed.uint8array:\"nodebuffer\"===r&&(n=i.applyCanBeUsed.nodebuffer),n)for(;1<t;)try{return i.stringifyByChunk(e,r,t)}catch(e){t=Math.floor(t/2)}return i.stringifyByChar(e)}function f(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}a.applyFromCharCode=s;var c={};c.string={string:n,array:function(e){return l(e,new Array(e.length))},arraybuffer:function(e){return c.string.uint8array(e).buffer},uint8array:function(e){return l(e,new Uint8Array(e.length))},nodebuffer:function(e){return l(e,r.allocBuffer(e.length))}},c.array={string:s,array:n,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return r.newBufferFrom(e)}},c.arraybuffer={string:function(e){return s(new Uint8Array(e))},array:function(e){return f(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:n,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return r.newBufferFrom(new Uint8Array(e))}},c.uint8array={string:s,array:function(e){return f(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:n,nodebuffer:function(e){return r.newBufferFrom(e)}},c.nodebuffer={string:s,array:function(e){return f(e,new Array(e.length))},arraybuffer:function(e){return c.nodebuffer.uint8array(e).buffer},uint8array:function(e){return f(e,new Uint8Array(e.length))},nodebuffer:n},a.transformTo=function(e,t){if(t=t||\"\",!e)return t;a.checkSupport(e);var r=a.getTypeOf(t);return c[r][e](t)},a.resolve=function(e){for(var t=e.split(\"/\"),r=[],n=0;n<t.length;n++){var i=t[n];\".\"===i||\"\"===i&&0!==n&&n!==t.length-1||(\"..\"===i?r.pop():r.push(i))}return r.join(\"/\")},a.getTypeOf=function(e){return\"string\"==typeof e?\"string\":\"[object Array]\"===Object.prototype.toString.call(e)?\"array\":o.nodebuffer&&r.isBuffer(e)?\"nodebuffer\":o.uint8array&&e instanceof Uint8Array?\"uint8array\":o.arraybuffer&&e instanceof ArrayBuffer?\"arraybuffer\":void 0},a.checkSupport=function(e){if(!o[e.toLowerCase()])throw new Error(e+\" is not supported by this platform\")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(e){var t,r,n=\"\";for(r=0;r<(e||\"\").length;r++)n+=\"\\\\x\"+((t=e.charCodeAt(r))<16?\"0\":\"\")+t.toString(16).toUpperCase();return n},a.delay=function(e,t,r){setImmediate(function(){e.apply(r||null,t||[])})},a.inherits=function(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r},a.extend=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])Object.prototype.hasOwnProperty.call(arguments[e],t)&&void 0===r[t]&&(r[t]=arguments[e][t]);return r},a.prepareContent=function(r,e,n,i,s){return u.Promise.resolve(e).then(function(n){return o.blob&&(n instanceof Blob||-1!==[\"[object File]\",\"[object Blob]\"].indexOf(Object.prototype.toString.call(n)))&&\"undefined\"!=typeof FileReader?new u.Promise(function(t,r){var e=new FileReader;e.onload=function(e){t(e.target.result)},e.onerror=function(e){r(e.target.error)},e.readAsArrayBuffer(n)}):n}).then(function(e){var t=a.getTypeOf(e);return t?(\"arraybuffer\"===t?e=a.transformTo(\"uint8array\",e):\"string\"===t&&(s?e=h.decode(e):n&&!0!==i&&(e=function(e){return l(e,o.uint8array?new Uint8Array(e.length):new Array(e.length))}(e))),e):u.Promise.reject(new Error(\"Can't read the data of '\"+r+\"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?\"))})}},{\"./base64\":1,\"./external\":6,\"./nodejsUtils\":14,\"./support\":30,setimmediate:54}],33:[function(e,t,r){\"use strict\";var n=e(\"./reader/readerFor\"),i=e(\"./utils\"),s=e(\"./signature\"),a=e(\"./zipEntry\"),o=e(\"./support\");function h(e){this.files=[],this.loadOptions=e}h.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error(\"Corrupted zip or bug: unexpected signature (\"+i.pretty(t)+\", expected \"+i.pretty(e)+\")\")}},isSignature:function(e,t){var r=this.reader.index;this.reader.setIndex(e);var n=this.reader.readString(4)===t;return this.reader.setIndex(r),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=o.uint8array?\"uint8array\":\"array\",r=i.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,n=this.zip64EndOfCentralSize-44;0<n;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error(\"Multi-volumes zip are not supported\")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(e=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error(\"Corrupted zip or bug: expected \"+this.centralDirRecords+\" records in central dir, got \"+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(e<0)throw!this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error(\"Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html\"):new Error(\"Corrupted zip: can't find end of central directory\");this.reader.setIndex(e);var t=e;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error(\"Corrupted zip: can't find the ZIP64 end of central directory locator\");if(this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error(\"Corrupted zip: can't find the ZIP64 end of central directory\");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var n=t-r;if(0<n)this.isSignature(t,s.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error(\"Corrupted zip: missing \"+Math.abs(n)+\" bytes.\")},prepareReader:function(e){this.reader=n(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=h},{\"./reader/readerFor\":22,\"./signature\":23,\"./support\":30,\"./utils\":32,\"./zipEntry\":34}],34:[function(e,t,r){\"use strict\";var n=e(\"./reader/readerFor\"),s=e(\"./utils\"),i=e(\"./compressedObject\"),a=e(\"./crc32\"),o=e(\"./utf8\"),h=e(\"./compressions\"),u=e(\"./support\");function l(e,t){this.options=e,this.loadOptions=t}l.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(r),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error(\"Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)\");if(null===(t=function(e){for(var t in h)if(Object.prototype.hasOwnProperty.call(h,t)&&h[t].magic===e)return h[t];return null}(this.compressionMethod)))throw new Error(\"Corrupted zip : compression \"+s.pretty(this.compressionMethod)+\" unknown (inner file : \"+s.transformTo(\"string\",this.fileName)+\")\");this.decompressed=new i(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error(\"Encrypted zip are not supported\");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||\"/\"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=n(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,r,n,i=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<i;)t=e.readInt(2),r=e.readInt(2),n=e.readData(r),this.extraFields[t]={id:t,length:r,value:n};e.setIndex(i)},handleUTF8:function(){var e=u.uint8array?\"uint8array\":\"array\";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var r=s.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var n=this.findExtraFieldUnicodeComment();if(null!==n)this.fileCommentStr=n;else{var i=s.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(i)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=n(e.value);return 1!==t.readInt(1)?null:a(this.fileName)!==t.readInt(4)?null:o.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=n(e.value);return 1!==t.readInt(1)?null:a(this.fileComment)!==t.readInt(4)?null:o.utf8decode(t.readData(e.length-5))}return null}},t.exports=l},{\"./compressedObject\":2,\"./compressions\":3,\"./crc32\":4,\"./reader/readerFor\":22,\"./support\":30,\"./utf8\":31,\"./utils\":32}],35:[function(e,t,r){\"use strict\";function n(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}}var s=e(\"./stream/StreamHelper\"),i=e(\"./stream/DataWorker\"),a=e(\"./utf8\"),o=e(\"./compressedObject\"),h=e(\"./stream/GenericWorker\");n.prototype={internalStream:function(e){var t=null,r=\"string\";try{if(!e)throw new Error(\"No output type specified.\");var n=\"string\"===(r=e.toLowerCase())||\"text\"===r;\"binarystring\"!==r&&\"text\"!==r||(r=\"string\"),t=this._decompressWorker();var i=!this._dataBinary;i&&!n&&(t=t.pipe(new a.Utf8EncodeWorker)),!i&&n&&(t=t.pipe(new a.Utf8DecodeWorker))}catch(e){(t=new h(\"error\")).error(e)}return new s(t,r,\"\")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||\"nodebuffer\").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof o&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new a.Utf8EncodeWorker)),o.createWorkerFrom(r,e,t)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof h?this._data:new i(this._data)}};for(var u=[\"asText\",\"asBinary\",\"asNodeBuffer\",\"asUint8Array\",\"asArrayBuffer\"],l=function(){throw new Error(\"This method has been removed in JSZip 3.0, please check the upgrade guide.\")},f=0;f<u.length;f++)n.prototype[u[f]]=l;t.exports=n},{\"./compressedObject\":2,\"./stream/DataWorker\":27,\"./stream/GenericWorker\":28,\"./stream/StreamHelper\":29,\"./utf8\":31}],36:[function(e,l,t){(function(t){\"use strict\";var r,n,e=t.MutationObserver||t.WebKitMutationObserver;if(e){var i=0,s=new e(u),a=t.document.createTextNode(\"\");s.observe(a,{characterData:!0}),r=function(){a.data=i=++i%2}}else if(t.setImmediate||void 0===t.MessageChannel)r=\"document\"in t&&\"onreadystatechange\"in t.document.createElement(\"script\")?function(){var e=t.document.createElement(\"script\");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var o=new t.MessageChannel;o.port1.onmessage=u,r=function(){o.port2.postMessage(0)}}var h=[];function u(){var e,t;n=!0;for(var r=h.length;r;){for(t=h,h=[],e=-1;++e<r;)t[e]();r=h.length}n=!1}l.exports=function(e){1!==h.push(e)||n||r()}}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{}],37:[function(e,t,r){\"use strict\";var i=e(\"immediate\");function u(){}var l={},s=[\"REJECTED\"],a=[\"FULFILLED\"],n=[\"PENDING\"];function o(e){if(\"function\"!=typeof e)throw new TypeError(\"resolver must be a function\");this.state=n,this.queue=[],this.outcome=void 0,e!==u&&d(this,e)}function h(e,t,r){this.promise=e,\"function\"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),\"function\"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function f(t,r,n){i(function(){var e;try{e=r(n)}catch(e){return l.reject(t,e)}e===t?l.reject(t,new TypeError(\"Cannot resolve promise with itself\")):l.resolve(t,e)})}function c(e){var t=e&&e.then;if(e&&(\"object\"==typeof e||\"function\"==typeof e)&&\"function\"==typeof t)return function(){t.apply(e,arguments)}}function d(t,e){var r=!1;function n(e){r||(r=!0,l.reject(t,e))}function i(e){r||(r=!0,l.resolve(t,e))}var s=p(function(){e(i,n)});\"error\"===s.status&&n(s.value)}function p(e,t){var r={};try{r.value=e(t),r.status=\"success\"}catch(e){r.status=\"error\",r.value=e}return r}(t.exports=o).prototype.finally=function(t){if(\"function\"!=typeof t)return this;var r=this.constructor;return this.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){throw e})})},o.prototype.catch=function(e){return this.then(null,e)},o.prototype.then=function(e,t){if(\"function\"!=typeof e&&this.state===a||\"function\"!=typeof t&&this.state===s)return this;var r=new this.constructor(u);this.state!==n?f(r,this.state===a?e:t,this.outcome):this.queue.push(new h(r,e,t));return r},h.prototype.callFulfilled=function(e){l.resolve(this.promise,e)},h.prototype.otherCallFulfilled=function(e){f(this.promise,this.onFulfilled,e)},h.prototype.callRejected=function(e){l.reject(this.promise,e)},h.prototype.otherCallRejected=function(e){f(this.promise,this.onRejected,e)},l.resolve=function(e,t){var r=p(c,t);if(\"error\"===r.status)return l.reject(e,r.value);var n=r.value;if(n)d(e,n);else{e.state=a,e.outcome=t;for(var i=-1,s=e.queue.length;++i<s;)e.queue[i].callFulfilled(t)}return e},l.reject=function(e,t){e.state=s,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},o.resolve=function(e){if(e instanceof this)return e;return l.resolve(new this(u),e)},o.reject=function(e){var t=new this(u);return l.reject(t,e)},o.all=function(e){var r=this;if(\"[object Array]\"!==Object.prototype.toString.call(e))return this.reject(new TypeError(\"must be an array\"));var n=e.length,i=!1;if(!n)return this.resolve([]);var s=new Array(n),a=0,t=-1,o=new this(u);for(;++t<n;)h(e[t],t);return o;function h(e,t){r.resolve(e).then(function(e){s[t]=e,++a!==n||i||(i=!0,l.resolve(o,s))},function(e){i||(i=!0,l.reject(o,e))})}},o.race=function(e){var t=this;if(\"[object Array]\"!==Object.prototype.toString.call(e))return this.reject(new TypeError(\"must be an array\"));var r=e.length,n=!1;if(!r)return this.resolve([]);var i=-1,s=new this(u);for(;++i<r;)a=e[i],t.resolve(a).then(function(e){n||(n=!0,l.resolve(s,e))},function(e){n||(n=!0,l.reject(s,e))});var a;return s}},{immediate:36}],38:[function(e,t,r){\"use strict\";var n={};(0,e(\"./lib/utils/common\").assign)(n,e(\"./lib/deflate\"),e(\"./lib/inflate\"),e(\"./lib/zlib/constants\")),t.exports=n},{\"./lib/deflate\":39,\"./lib/inflate\":40,\"./lib/utils/common\":41,\"./lib/zlib/constants\":44}],39:[function(e,t,r){\"use strict\";var a=e(\"./zlib/deflate\"),o=e(\"./utils/common\"),h=e(\"./utils/strings\"),i=e(\"./zlib/messages\"),s=e(\"./zlib/zstream\"),u=Object.prototype.toString,l=0,f=-1,c=0,d=8;function p(e){if(!(this instanceof p))return new p(e);this.options=o.assign({level:f,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:c,to:\"\"},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg=\"\",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var r=a.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==l)throw new Error(i[r]);if(t.header&&a.deflateSetHeader(this.strm,t.header),t.dictionary){var n;if(n=\"string\"==typeof t.dictionary?h.string2buf(t.dictionary):\"[object ArrayBuffer]\"===u.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=a.deflateSetDictionary(this.strm,n))!==l)throw new Error(i[r]);this._dict_set=!0}}function n(e,t){var r=new p(t);if(r.push(e,!0),r.err)throw r.msg||i[r.err];return r.result}p.prototype.push=function(e,t){var r,n,i=this.strm,s=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?4:0,\"string\"==typeof e?i.input=h.string2buf(e):\"[object ArrayBuffer]\"===u.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new o.Buf8(s),i.next_out=0,i.avail_out=s),1!==(r=a.deflate(i,n))&&r!==l)return this.onEnd(r),!(this.ended=!0);0!==i.avail_out&&(0!==i.avail_in||4!==n&&2!==n)||(\"string\"===this.options.to?this.onData(h.buf2binstring(o.shrinkBuf(i.output,i.next_out))):this.onData(o.shrinkBuf(i.output,i.next_out)))}while((0<i.avail_in||0===i.avail_out)&&1!==r);return 4===n?(r=a.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===l):2!==n||(this.onEnd(l),!(i.avail_out=0))},p.prototype.onData=function(e){this.chunks.push(e)},p.prototype.onEnd=function(e){e===l&&(\"string\"===this.options.to?this.result=this.chunks.join(\"\"):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Deflate=p,r.deflate=n,r.deflateRaw=function(e,t){return(t=t||{}).raw=!0,n(e,t)},r.gzip=function(e,t){return(t=t||{}).gzip=!0,n(e,t)}},{\"./utils/common\":41,\"./utils/strings\":42,\"./zlib/deflate\":46,\"./zlib/messages\":51,\"./zlib/zstream\":53}],40:[function(e,t,r){\"use strict\";var c=e(\"./zlib/inflate\"),d=e(\"./utils/common\"),p=e(\"./utils/strings\"),m=e(\"./zlib/constants\"),n=e(\"./zlib/messages\"),i=e(\"./zlib/zstream\"),s=e(\"./zlib/gzheader\"),_=Object.prototype.toString;function a(e){if(!(this instanceof a))return new a(e);this.options=d.assign({chunkSize:16384,windowBits:0,to:\"\"},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg=\"\",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;var r=c.inflateInit2(this.strm,t.windowBits);if(r!==m.Z_OK)throw new Error(n[r]);this.header=new s,c.inflateGetHeader(this.strm,this.header)}function o(e,t){var r=new a(t);if(r.push(e,!0),r.err)throw r.msg||n[r.err];return r.result}a.prototype.push=function(e,t){var r,n,i,s,a,o,h=this.strm,u=this.options.chunkSize,l=this.options.dictionary,f=!1;if(this.ended)return!1;n=t===~~t?t:!0===t?m.Z_FINISH:m.Z_NO_FLUSH,\"string\"==typeof e?h.input=p.binstring2buf(e):\"[object ArrayBuffer]\"===_.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new d.Buf8(u),h.next_out=0,h.avail_out=u),(r=c.inflate(h,m.Z_NO_FLUSH))===m.Z_NEED_DICT&&l&&(o=\"string\"==typeof l?p.string2buf(l):\"[object ArrayBuffer]\"===_.call(l)?new Uint8Array(l):l,r=c.inflateSetDictionary(this.strm,o)),r===m.Z_BUF_ERROR&&!0===f&&(r=m.Z_OK,f=!1),r!==m.Z_STREAM_END&&r!==m.Z_OK)return this.onEnd(r),!(this.ended=!0);h.next_out&&(0!==h.avail_out&&r!==m.Z_STREAM_END&&(0!==h.avail_in||n!==m.Z_FINISH&&n!==m.Z_SYNC_FLUSH)||(\"string\"===this.options.to?(i=p.utf8border(h.output,h.next_out),s=h.next_out-i,a=p.buf2string(h.output,i),h.next_out=s,h.avail_out=u-s,s&&d.arraySet(h.output,h.output,i,s,0),this.onData(a)):this.onData(d.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(f=!0)}while((0<h.avail_in||0===h.avail_out)&&r!==m.Z_STREAM_END);return r===m.Z_STREAM_END&&(n=m.Z_FINISH),n===m.Z_FINISH?(r=c.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===m.Z_OK):n!==m.Z_SYNC_FLUSH||(this.onEnd(m.Z_OK),!(h.avail_out=0))},a.prototype.onData=function(e){this.chunks.push(e)},a.prototype.onEnd=function(e){e===m.Z_OK&&(\"string\"===this.options.to?this.result=this.chunks.join(\"\"):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=a,r.inflate=o,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,o(e,t)},r.ungzip=o},{\"./utils/common\":41,\"./utils/strings\":42,\"./zlib/constants\":44,\"./zlib/gzheader\":47,\"./zlib/inflate\":49,\"./zlib/messages\":51,\"./zlib/zstream\":53}],41:[function(e,t,r){\"use strict\";var n=\"undefined\"!=typeof Uint8Array&&\"undefined\"!=typeof Uint16Array&&\"undefined\"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if(\"object\"!=typeof r)throw new TypeError(r+\"must be non-object\");for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var s=0;s<n;s++)e[i+s]=t[r+s]},flattenChunks:function(e){var t,r,n,i,s,a;for(t=n=0,r=e.length;t<r;t++)n+=e[t].length;for(a=new Uint8Array(n),t=i=0,r=e.length;t<r;t++)s=e[t],a.set(s,i),i+=s.length;return a}},s={arraySet:function(e,t,r,n,i){for(var s=0;s<n;s++)e[i+s]=t[r+s]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,s))},r.setTyped(n)},{}],42:[function(e,t,r){\"use strict\";var h=e(\"./common\"),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){s=!1}for(var u=new h.Buf8(256),n=0;n<256;n++)u[n]=252<=n?6:248<=n?5:240<=n?4:224<=n?3:192<=n?2:1;function l(e,t){if(t<65537&&(e.subarray&&s||!e.subarray&&i))return String.fromCharCode.apply(null,h.shrinkBuf(e,t));for(var r=\"\",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r}u[254]=u[254]=1,r.string2buf=function(e){var t,r,n,i,s,a=e.length,o=0;for(i=0;i<a;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new h.Buf8(o),i=s=0;s<o;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?t[s++]=r:(r<2048?t[s++]=192|r>>>6:(r<65536?t[s++]=224|r>>>12:(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63),t[s++]=128|r>>>6&63),t[s++]=128|63&r);return t},r.buf2binstring=function(e){return l(e,e.length)},r.binstring2buf=function(e){for(var t=new h.Buf8(e.length),r=0,n=t.length;r<n;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,n,i,s,a=t||e.length,o=new Array(2*a);for(r=n=0;r<a;)if((i=e[r++])<128)o[n++]=i;else if(4<(s=u[i]))o[n++]=65533,r+=s-1;else{for(i&=2===s?31:3===s?15:7;1<s&&r<a;)i=i<<6|63&e[r++],s--;1<s?o[n++]=65533:i<65536?o[n++]=i:(i-=65536,o[n++]=55296|i>>10&1023,o[n++]=56320|1023&i)}return l(o,n)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0?t:0===r?t:r+u[e[r]]>t?r:t}},{\"./common\":41}],43:[function(e,t,r){\"use strict\";t.exports=function(e,t,r,n){for(var i=65535&e|0,s=e>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;s=s+(i=i+t[n++]|0)|0,--a;);i%=65521,s%=65521}return i|s<<16|0}},{}],44:[function(e,t,r){\"use strict\";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,r){\"use strict\";var o=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,r,n){var i=o,s=n+r;e^=-1;for(var a=n;a<s;a++)e=e>>>8^i[255&(e^t[a])];return-1^e}},{}],46:[function(e,t,r){\"use strict\";var h,c=e(\"../utils/common\"),u=e(\"./trees\"),d=e(\"./adler32\"),p=e(\"./crc32\"),n=e(\"./messages\"),l=0,f=4,m=0,_=-2,g=-1,b=4,i=2,v=8,y=9,s=286,a=30,o=19,w=2*s+1,k=15,x=3,S=258,z=S+x+1,C=42,E=113,A=1,I=2,O=3,B=4;function R(e,t){return e.msg=n[t],t}function T(e){return(e<<1)-(4<e?9:0)}function D(e){for(var t=e.length;0<=--t;)e[t]=0}function F(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(c.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function N(e,t){u._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,F(e.strm)}function U(e,t){e.pending_buf[e.pending++]=t}function P(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function L(e,t){var r,n,i=e.max_chain_length,s=e.strstart,a=e.prev_length,o=e.nice_match,h=e.strstart>e.w_size-z?e.strstart-(e.w_size-z):0,u=e.window,l=e.w_mask,f=e.prev,c=e.strstart+S,d=u[s+a-1],p=u[s+a];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(u[(r=t)+a]===p&&u[r+a-1]===d&&u[r]===u[s]&&u[++r]===u[s+1]){s+=2,r++;do{}while(u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&s<c);if(n=S-(c-s),s=c-S,a<n){if(e.match_start=t,o<=(a=n))break;d=u[s+a-1],p=u[s+a]}}}while((t=f[t&l])>h&&0!=--i);return a<=e.lookahead?a:e.lookahead}function j(e){var t,r,n,i,s,a,o,h,u,l,f=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=f+(f-z)){for(c.arraySet(e.window,e.window,f,f,0),e.match_start-=f,e.strstart-=f,e.block_start-=f,t=r=e.hash_size;n=e.head[--t],e.head[t]=f<=n?n-f:0,--r;);for(t=r=f;n=e.prev[--t],e.prev[t]=f<=n?n-f:0,--r;);i+=f}if(0===e.strm.avail_in)break;if(a=e.strm,o=e.window,h=e.strstart+e.lookahead,u=i,l=void 0,l=a.avail_in,u<l&&(l=u),r=0===l?0:(a.avail_in-=l,c.arraySet(o,a.input,a.next_in,l,h),1===a.state.wrap?a.adler=d(a.adler,o,l,h):2===a.state.wrap&&(a.adler=p(a.adler,o,l,h)),a.next_in+=l,a.total_in+=l,l),e.lookahead+=r,e.lookahead+e.insert>=x)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+x-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<x)););}while(e.lookahead<z&&0!==e.strm.avail_in)}function Z(e,t){for(var r,n;;){if(e.lookahead<z){if(j(e),e.lookahead<z&&t===l)return A;if(0===e.lookahead)break}if(r=0,e.lookahead>=x&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+x-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-z&&(e.match_length=L(e,r)),e.match_length>=x)if(n=u._tr_tally(e,e.strstart-e.match_start,e.match_length-x),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=x){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+x-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(N(e,!1),0===e.strm.avail_out))return A}return e.insert=e.strstart<x-1?e.strstart:x-1,t===f?(N(e,!0),0===e.strm.avail_out?O:B):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?A:I}function W(e,t){for(var r,n,i;;){if(e.lookahead<z){if(j(e),e.lookahead<z&&t===l)return A;if(0===e.lookahead)break}if(r=0,e.lookahead>=x&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+x-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=x-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-z&&(e.match_length=L(e,r),e.match_length<=5&&(1===e.strategy||e.match_length===x&&4096<e.strstart-e.match_start)&&(e.match_length=x-1)),e.prev_length>=x&&e.match_length<=e.prev_length){for(i=e.strstart+e.lookahead-x,n=u._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-x),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+x-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=x-1,e.strstart++,n&&(N(e,!1),0===e.strm.avail_out))return A}else if(e.match_available){if((n=u._tr_tally(e,0,e.window[e.strstart-1]))&&N(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return A}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=u._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<x-1?e.strstart:x-1,t===f?(N(e,!0),0===e.strm.avail_out?O:B):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?A:I}function M(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function H(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new c.Buf16(2*w),this.dyn_dtree=new c.Buf16(2*(2*a+1)),this.bl_tree=new c.Buf16(2*(2*o+1)),D(this.dyn_ltree),D(this.dyn_dtree),D(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new c.Buf16(k+1),this.heap=new c.Buf16(2*s+1),D(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new c.Buf16(2*s+1),D(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function G(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=i,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?C:E,e.adler=2===t.wrap?0:1,t.last_flush=l,u._tr_init(t),m):R(e,_)}function K(e){var t=G(e);return t===m&&function(e){e.window_size=2*e.w_size,D(e.head),e.max_lazy_match=h[e.level].max_lazy,e.good_match=h[e.level].good_length,e.nice_match=h[e.level].nice_length,e.max_chain_length=h[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=x-1,e.match_available=0,e.ins_h=0}(e.state),t}function Y(e,t,r,n,i,s){if(!e)return _;var a=1;if(t===g&&(t=6),n<0?(a=0,n=-n):15<n&&(a=2,n-=16),i<1||y<i||r!==v||n<8||15<n||t<0||9<t||s<0||b<s)return R(e,_);8===n&&(n=9);var o=new H;return(e.state=o).strm=e,o.wrap=a,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+x-1)/x),o.window=new c.Buf8(2*o.w_size),o.head=new c.Buf16(o.hash_size),o.prev=new c.Buf16(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new c.Buf8(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=s,o.method=r,K(e)}h=[new M(0,0,0,0,function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(j(e),0===e.lookahead&&t===l)return A;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,N(e,!1),0===e.strm.avail_out))return A;if(e.strstart-e.block_start>=e.w_size-z&&(N(e,!1),0===e.strm.avail_out))return A}return e.insert=0,t===f?(N(e,!0),0===e.strm.avail_out?O:B):(e.strstart>e.block_start&&(N(e,!1),e.strm.avail_out),A)}),new M(4,4,8,4,Z),new M(4,5,16,8,Z),new M(4,6,32,32,Z),new M(4,4,16,16,W),new M(8,16,32,32,W),new M(8,16,128,128,W),new M(8,32,128,256,W),new M(32,128,258,1024,W),new M(32,258,258,4096,W)],r.deflateInit=function(e,t){return Y(e,t,v,15,8,0)},r.deflateInit2=Y,r.deflateReset=K,r.deflateResetKeep=G,r.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?_:(e.state.gzhead=t,m):_},r.deflate=function(e,t){var r,n,i,s;if(!e||!e.state||5<t||t<0)return e?R(e,_):_;if(n=e.state,!e.output||!e.input&&0!==e.avail_in||666===n.status&&t!==f)return R(e,0===e.avail_out?-5:_);if(n.strm=e,r=n.last_flush,n.last_flush=t,n.status===C)if(2===n.wrap)e.adler=0,U(n,31),U(n,139),U(n,8),n.gzhead?(U(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),U(n,255&n.gzhead.time),U(n,n.gzhead.time>>8&255),U(n,n.gzhead.time>>16&255),U(n,n.gzhead.time>>24&255),U(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),U(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(U(n,255&n.gzhead.extra.length),U(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=p(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(U(n,0),U(n,0),U(n,0),U(n,0),U(n,0),U(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),U(n,3),n.status=E);else{var a=v+(n.w_bits-8<<4)<<8;a|=(2<=n.strategy||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(a|=32),a+=31-a%31,n.status=E,P(n,a),0!==n.strstart&&(P(n,e.adler>>>16),P(n,65535&e.adler)),e.adler=1}if(69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(e.adler=p(e.adler,n.pending_buf,n.pending-i,i)),F(e),i=n.pending,n.pending!==n.pending_buf_size));)U(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(e.adler=p(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=p(e.adler,n.pending_buf,n.pending-i,i)),F(e),i=n.pending,n.pending===n.pending_buf_size)){s=1;break}s=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,U(n,s)}while(0!==s);n.gzhead.hcrc&&n.pending>i&&(e.adler=p(e.adler,n.pending_buf,n.pending-i,i)),0===s&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=p(e.adler,n.pending_buf,n.pending-i,i)),F(e),i=n.pending,n.pending===n.pending_buf_size)){s=1;break}s=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,U(n,s)}while(0!==s);n.gzhead.hcrc&&n.pending>i&&(e.adler=p(e.adler,n.pending_buf,n.pending-i,i)),0===s&&(n.status=103)}else n.status=103;if(103===n.status&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&F(e),n.pending+2<=n.pending_buf_size&&(U(n,255&e.adler),U(n,e.adler>>8&255),e.adler=0,n.status=E)):n.status=E),0!==n.pending){if(F(e),0===e.avail_out)return n.last_flush=-1,m}else if(0===e.avail_in&&T(t)<=T(r)&&t!==f)return R(e,-5);if(666===n.status&&0!==e.avail_in)return R(e,-5);if(0!==e.avail_in||0!==n.lookahead||t!==l&&666!==n.status){var o=2===n.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(j(e),0===e.lookahead)){if(t===l)return A;break}if(e.match_length=0,r=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(N(e,!1),0===e.strm.avail_out))return A}return e.insert=0,t===f?(N(e,!0),0===e.strm.avail_out?O:B):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?A:I}(n,t):3===n.strategy?function(e,t){for(var r,n,i,s,a=e.window;;){if(e.lookahead<=S){if(j(e),e.lookahead<=S&&t===l)return A;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=x&&0<e.strstart&&(n=a[i=e.strstart-1])===a[++i]&&n===a[++i]&&n===a[++i]){s=e.strstart+S;do{}while(n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<s);e.match_length=S-(s-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=x?(r=u._tr_tally(e,1,e.match_length-x),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(N(e,!1),0===e.strm.avail_out))return A}return e.insert=0,t===f?(N(e,!0),0===e.strm.avail_out?O:B):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?A:I}(n,t):h[n.level].func(n,t);if(o!==O&&o!==B||(n.status=666),o===A||o===O)return 0===e.avail_out&&(n.last_flush=-1),m;if(o===I&&(1===t?u._tr_align(n):5!==t&&(u._tr_stored_block(n,0,0,!1),3===t&&(D(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),F(e),0===e.avail_out))return n.last_flush=-1,m}return t!==f?m:n.wrap<=0?1:(2===n.wrap?(U(n,255&e.adler),U(n,e.adler>>8&255),U(n,e.adler>>16&255),U(n,e.adler>>24&255),U(n,255&e.total_in),U(n,e.total_in>>8&255),U(n,e.total_in>>16&255),U(n,e.total_in>>24&255)):(P(n,e.adler>>>16),P(n,65535&e.adler)),F(e),0<n.wrap&&(n.wrap=-n.wrap),0!==n.pending?m:1)},r.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==C&&69!==t&&73!==t&&91!==t&&103!==t&&t!==E&&666!==t?R(e,_):(e.state=null,t===E?R(e,-3):m):_},r.deflateSetDictionary=function(e,t){var r,n,i,s,a,o,h,u,l=t.length;if(!e||!e.state)return _;if(2===(s=(r=e.state).wrap)||1===s&&r.status!==C||r.lookahead)return _;for(1===s&&(e.adler=d(e.adler,t,l,0)),r.wrap=0,l>=r.w_size&&(0===s&&(D(r.head),r.strstart=0,r.block_start=0,r.insert=0),u=new c.Buf8(r.w_size),c.arraySet(u,t,l-r.w_size,r.w_size,0),t=u,l=r.w_size),a=e.avail_in,o=e.next_in,h=e.input,e.avail_in=l,e.next_in=0,e.input=t,j(r);r.lookahead>=x;){for(n=r.strstart,i=r.lookahead-(x-1);r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+x-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++,--i;);r.strstart=n,r.lookahead=x-1,j(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=x-1,r.match_available=0,e.next_in=o,e.input=h,e.avail_in=a,r.wrap=s,m},r.deflateInfo=\"pako deflate (from Nodeca project)\"},{\"../utils/common\":41,\"./adler32\":43,\"./crc32\":45,\"./messages\":51,\"./trees\":52}],47:[function(e,t,r){\"use strict\";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name=\"\",this.comment=\"\",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,r){\"use strict\";t.exports=function(e,t){var r,n,i,s,a,o,h,u,l,f,c,d,p,m,_,g,b,v,y,w,k,x,S,z,C;r=e.state,n=e.next_in,z=e.input,i=n+(e.avail_in-5),s=e.next_out,C=e.output,a=s-(t-e.avail_out),o=s+(e.avail_out-257),h=r.dmax,u=r.wsize,l=r.whave,f=r.wnext,c=r.window,d=r.hold,p=r.bits,m=r.lencode,_=r.distcode,g=(1<<r.lenbits)-1,b=(1<<r.distbits)-1;e:do{p<15&&(d+=z[n++]<<p,p+=8,d+=z[n++]<<p,p+=8),v=m[d&g];t:for(;;){if(d>>>=y=v>>>24,p-=y,0===(y=v>>>16&255))C[s++]=65535&v;else{if(!(16&y)){if(0==(64&y)){v=m[(65535&v)+(d&(1<<y)-1)];continue t}if(32&y){r.mode=12;break e}e.msg=\"invalid literal/length code\",r.mode=30;break e}w=65535&v,(y&=15)&&(p<y&&(d+=z[n++]<<p,p+=8),w+=d&(1<<y)-1,d>>>=y,p-=y),p<15&&(d+=z[n++]<<p,p+=8,d+=z[n++]<<p,p+=8),v=_[d&b];r:for(;;){if(d>>>=y=v>>>24,p-=y,!(16&(y=v>>>16&255))){if(0==(64&y)){v=_[(65535&v)+(d&(1<<y)-1)];continue r}e.msg=\"invalid distance code\",r.mode=30;break e}if(k=65535&v,p<(y&=15)&&(d+=z[n++]<<p,(p+=8)<y&&(d+=z[n++]<<p,p+=8)),h<(k+=d&(1<<y)-1)){e.msg=\"invalid distance too far back\",r.mode=30;break e}if(d>>>=y,p-=y,(y=s-a)<k){if(l<(y=k-y)&&r.sane){e.msg=\"invalid distance too far back\",r.mode=30;break e}if(S=c,(x=0)===f){if(x+=u-y,y<w){for(w-=y;C[s++]=c[x++],--y;);x=s-k,S=C}}else if(f<y){if(x+=u+f-y,(y-=f)<w){for(w-=y;C[s++]=c[x++],--y;);if(x=0,f<w){for(w-=y=f;C[s++]=c[x++],--y;);x=s-k,S=C}}}else if(x+=f-y,y<w){for(w-=y;C[s++]=c[x++],--y;);x=s-k,S=C}for(;2<w;)C[s++]=S[x++],C[s++]=S[x++],C[s++]=S[x++],w-=3;w&&(C[s++]=S[x++],1<w&&(C[s++]=S[x++]))}else{for(x=s-k;C[s++]=C[x++],C[s++]=C[x++],C[s++]=C[x++],2<(w-=3););w&&(C[s++]=C[x++],1<w&&(C[s++]=C[x++]))}break}}break}}while(n<i&&s<o);n-=w=p>>3,d&=(1<<(p-=w<<3))-1,e.next_in=n,e.next_out=s,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=s<o?o-s+257:257-(s-o),r.hold=d,r.bits=p}},{}],49:[function(e,t,r){\"use strict\";var I=e(\"../utils/common\"),O=e(\"./adler32\"),B=e(\"./crc32\"),R=e(\"./inffast\"),T=e(\"./inftrees\"),D=1,F=2,N=0,U=-2,P=1,n=852,i=592;function L(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function s(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new I.Buf16(320),this.work=new I.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg=\"\",t.wrap&&(e.adler=1&t.wrap),t.mode=P,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new I.Buf32(n),t.distcode=t.distdyn=new I.Buf32(i),t.sane=1,t.back=-1,N):U}function o(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,a(e)):U}function h(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?U:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,o(e))):U}function u(e,t){var r,n;return e?(n=new s,(e.state=n).window=null,(r=h(e,t))!==N&&(e.state=null),r):U}var l,f,c=!0;function j(e){if(c){var t;for(l=new I.Buf32(512),f=new I.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(T(D,e.lens,0,288,l,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;T(F,e.lens,0,32,f,0,e.work,{bits:5}),c=!1}e.lencode=l,e.lenbits=9,e.distcode=f,e.distbits=5}function Z(e,t,r,n){var i,s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new I.Buf8(s.wsize)),n>=s.wsize?(I.arraySet(s.window,t,r-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(n<(i=s.wsize-s.wnext)&&(i=n),I.arraySet(s.window,t,r-n,i,s.wnext),(n-=i)?(I.arraySet(s.window,t,r-n,n,0),s.wnext=n,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0}r.inflateReset=o,r.inflateReset2=h,r.inflateResetKeep=a,r.inflateInit=function(e){return u(e,15)},r.inflateInit2=u,r.inflate=function(e,t){var r,n,i,s,a,o,h,u,l,f,c,d,p,m,_,g,b,v,y,w,k,x,S,z,C=0,E=new I.Buf8(4),A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return U;12===(r=e.state).mode&&(r.mode=13),a=e.next_out,i=e.output,h=e.avail_out,s=e.next_in,n=e.input,o=e.avail_in,u=r.hold,l=r.bits,f=o,c=h,x=N;e:for(;;)switch(r.mode){case P:if(0===r.wrap){r.mode=13;break}for(;l<16;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(2&r.wrap&&35615===u){E[r.check=0]=255&u,E[1]=u>>>8&255,r.check=B(r.check,E,2,0),l=u=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg=\"incorrect header check\",r.mode=30;break}if(8!=(15&u)){e.msg=\"unknown compression method\",r.mode=30;break}if(l-=4,k=8+(15&(u>>>=4)),0===r.wbits)r.wbits=k;else if(k>r.wbits){e.msg=\"invalid window size\",r.mode=30;break}r.dmax=1<<k,e.adler=r.check=1,r.mode=512&u?10:12,l=u=0;break;case 2:for(;l<16;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(r.flags=u,8!=(255&r.flags)){e.msg=\"unknown compression method\",r.mode=30;break}if(57344&r.flags){e.msg=\"unknown header flags set\",r.mode=30;break}r.head&&(r.head.text=u>>8&1),512&r.flags&&(E[0]=255&u,E[1]=u>>>8&255,r.check=B(r.check,E,2,0)),l=u=0,r.mode=3;case 3:for(;l<32;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}r.head&&(r.head.time=u),512&r.flags&&(E[0]=255&u,E[1]=u>>>8&255,E[2]=u>>>16&255,E[3]=u>>>24&255,r.check=B(r.check,E,4,0)),l=u=0,r.mode=4;case 4:for(;l<16;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&r.flags&&(E[0]=255&u,E[1]=u>>>8&255,r.check=B(r.check,E,2,0)),l=u=0,r.mode=5;case 5:if(1024&r.flags){for(;l<16;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}r.length=u,r.head&&(r.head.extra_len=u),512&r.flags&&(E[0]=255&u,E[1]=u>>>8&255,r.check=B(r.check,E,2,0)),l=u=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(o<(d=r.length)&&(d=o),d&&(r.head&&(k=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),I.arraySet(r.head.extra,n,s,d,k)),512&r.flags&&(r.check=B(r.check,n,d,s)),o-=d,s+=d,r.length-=d),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===o)break e;for(d=0;k=n[s+d++],r.head&&k&&r.length<65536&&(r.head.name+=String.fromCharCode(k)),k&&d<o;);if(512&r.flags&&(r.check=B(r.check,n,d,s)),o-=d,s+=d,k)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===o)break e;for(d=0;k=n[s+d++],r.head&&k&&r.length<65536&&(r.head.comment+=String.fromCharCode(k)),k&&d<o;);if(512&r.flags&&(r.check=B(r.check,n,d,s)),o-=d,s+=d,k)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;l<16;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(u!==(65535&r.check)){e.msg=\"header crc mismatch\",r.mode=30;break}l=u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;l<32;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}e.adler=r.check=L(u),l=u=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=a,e.avail_out=h,e.next_in=s,e.avail_in=o,r.hold=u,r.bits=l,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){u>>>=7&l,l-=7&l,r.mode=27;break}for(;l<3;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}switch(r.last=1&u,l-=1,3&(u>>>=1)){case 0:r.mode=14;break;case 1:if(j(r),r.mode=20,6!==t)break;u>>>=2,l-=2;break e;case 2:r.mode=17;break;case 3:e.msg=\"invalid block type\",r.mode=30}u>>>=2,l-=2;break;case 14:for(u>>>=7&l,l-=7&l;l<32;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg=\"invalid stored block lengths\",r.mode=30;break}if(r.length=65535&u,l=u=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(d=r.length){if(o<d&&(d=o),h<d&&(d=h),0===d)break e;I.arraySet(i,n,s,d,a),o-=d,s+=d,h-=d,a+=d,r.length-=d;break}r.mode=12;break;case 17:for(;l<14;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(r.nlen=257+(31&u),u>>>=5,l-=5,r.ndist=1+(31&u),u>>>=5,l-=5,r.ncode=4+(15&u),u>>>=4,l-=4,286<r.nlen||30<r.ndist){e.msg=\"too many length or distance symbols\",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;l<3;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}r.lens[A[r.have++]]=7&u,u>>>=3,l-=3}for(;r.have<19;)r.lens[A[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,S={bits:r.lenbits},x=T(0,r.lens,0,19,r.lencode,0,r.work,S),r.lenbits=S.bits,x){e.msg=\"invalid code lengths set\",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;g=(C=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,b=65535&C,!((_=C>>>24)<=l);){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(b<16)u>>>=_,l-=_,r.lens[r.have++]=b;else{if(16===b){for(z=_+2;l<z;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(u>>>=_,l-=_,0===r.have){e.msg=\"invalid bit length repeat\",r.mode=30;break}k=r.lens[r.have-1],d=3+(3&u),u>>>=2,l-=2}else if(17===b){for(z=_+3;l<z;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}l-=_,k=0,d=3+(7&(u>>>=_)),u>>>=3,l-=3}else{for(z=_+7;l<z;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}l-=_,k=0,d=11+(127&(u>>>=_)),u>>>=7,l-=7}if(r.have+d>r.nlen+r.ndist){e.msg=\"invalid bit length repeat\",r.mode=30;break}for(;d--;)r.lens[r.have++]=k}}if(30===r.mode)break;if(0===r.lens[256]){e.msg=\"invalid code -- missing end-of-block\",r.mode=30;break}if(r.lenbits=9,S={bits:r.lenbits},x=T(D,r.lens,0,r.nlen,r.lencode,0,r.work,S),r.lenbits=S.bits,x){e.msg=\"invalid literal/lengths set\",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,S={bits:r.distbits},x=T(F,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,S),r.distbits=S.bits,x){e.msg=\"invalid distances set\",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(6<=o&&258<=h){e.next_out=a,e.avail_out=h,e.next_in=s,e.avail_in=o,r.hold=u,r.bits=l,R(e,c),a=e.next_out,i=e.output,h=e.avail_out,s=e.next_in,n=e.input,o=e.avail_in,u=r.hold,l=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;g=(C=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,b=65535&C,!((_=C>>>24)<=l);){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(g&&0==(240&g)){for(v=_,y=g,w=b;g=(C=r.lencode[w+((u&(1<<v+y)-1)>>v)])>>>16&255,b=65535&C,!(v+(_=C>>>24)<=l);){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}u>>>=v,l-=v,r.back+=v}if(u>>>=_,l-=_,r.back+=_,r.length=b,0===g){r.mode=26;break}if(32&g){r.back=-1,r.mode=12;break}if(64&g){e.msg=\"invalid literal/length code\",r.mode=30;break}r.extra=15&g,r.mode=22;case 22:if(r.extra){for(z=r.extra;l<z;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;g=(C=r.distcode[u&(1<<r.distbits)-1])>>>16&255,b=65535&C,!((_=C>>>24)<=l);){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(0==(240&g)){for(v=_,y=g,w=b;g=(C=r.distcode[w+((u&(1<<v+y)-1)>>v)])>>>16&255,b=65535&C,!(v+(_=C>>>24)<=l);){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}u>>>=v,l-=v,r.back+=v}if(u>>>=_,l-=_,r.back+=_,64&g){e.msg=\"invalid distance code\",r.mode=30;break}r.offset=b,r.extra=15&g,r.mode=24;case 24:if(r.extra){for(z=r.extra;l<z;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg=\"invalid distance too far back\",r.mode=30;break}r.mode=25;case 25:if(0===h)break e;if(d=c-h,r.offset>d){if((d=r.offset-d)>r.whave&&r.sane){e.msg=\"invalid distance too far back\",r.mode=30;break}p=d>r.wnext?(d-=r.wnext,r.wsize-d):r.wnext-d,d>r.length&&(d=r.length),m=r.window}else m=i,p=a-r.offset,d=r.length;for(h<d&&(d=h),h-=d,r.length-=d;i[a++]=m[p++],--d;);0===r.length&&(r.mode=21);break;case 26:if(0===h)break e;i[a++]=r.length,h--,r.mode=21;break;case 27:if(r.wrap){for(;l<32;){if(0===o)break e;o--,u|=n[s++]<<l,l+=8}if(c-=h,e.total_out+=c,r.total+=c,c&&(e.adler=r.check=r.flags?B(r.check,i,c,a-c):O(r.check,i,c,a-c)),c=h,(r.flags?u:L(u))!==r.check){e.msg=\"incorrect data check\",r.mode=30;break}l=u=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;l<32;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(u!==(4294967295&r.total)){e.msg=\"incorrect length check\",r.mode=30;break}l=u=0}r.mode=29;case 29:x=1;break e;case 30:x=-3;break e;case 31:return-4;case 32:default:return U}return e.next_out=a,e.avail_out=h,e.next_in=s,e.avail_in=o,r.hold=u,r.bits=l,(r.wsize||c!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&Z(e,e.output,e.next_out,c-e.avail_out)?(r.mode=31,-4):(f-=e.avail_in,c-=e.avail_out,e.total_in+=f,e.total_out+=c,r.total+=c,r.wrap&&c&&(e.adler=r.check=r.flags?B(r.check,i,c,e.next_out-c):O(r.check,i,c,e.next_out-c)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==f&&0===c||4===t)&&x===N&&(x=-5),x)},r.inflateEnd=function(e){if(!e||!e.state)return U;var t=e.state;return t.window&&(t.window=null),e.state=null,N},r.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?U:((r.head=t).done=!1,N):U},r.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?U:11===r.mode&&O(1,t,n,0)!==r.check?-3:Z(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,N):U},r.inflateInfo=\"pako inflate (from Nodeca project)\"},{\"../utils/common\":41,\"./adler32\":43,\"./crc32\":45,\"./inffast\":48,\"./inftrees\":50}],50:[function(e,t,r){\"use strict\";var D=e(\"../utils/common\"),F=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],N=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],U=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],P=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,r,n,i,s,a,o){var h,u,l,f,c,d,p,m,_,g=o.bits,b=0,v=0,y=0,w=0,k=0,x=0,S=0,z=0,C=0,E=0,A=null,I=0,O=new D.Buf16(16),B=new D.Buf16(16),R=null,T=0;for(b=0;b<=15;b++)O[b]=0;for(v=0;v<n;v++)O[t[r+v]]++;for(k=g,w=15;1<=w&&0===O[w];w--);if(w<k&&(k=w),0===w)return i[s++]=20971520,i[s++]=20971520,o.bits=1,0;for(y=1;y<w&&0===O[y];y++);for(k<y&&(k=y),b=z=1;b<=15;b++)if(z<<=1,(z-=O[b])<0)return-1;if(0<z&&(0===e||1!==w))return-1;for(B[1]=0,b=1;b<15;b++)B[b+1]=B[b]+O[b];for(v=0;v<n;v++)0!==t[r+v]&&(a[B[t[r+v]]++]=v);if(d=0===e?(A=R=a,19):1===e?(A=F,I-=257,R=N,T-=257,256):(A=U,R=P,-1),b=y,c=s,S=v=E=0,l=-1,f=(C=1<<(x=k))-1,1===e&&852<C||2===e&&592<C)return 1;for(;;){for(p=b-S,_=a[v]<d?(m=0,a[v]):a[v]>d?(m=R[T+a[v]],A[I+a[v]]):(m=96,0),h=1<<b-S,y=u=1<<x;i[c+(E>>S)+(u-=h)]=p<<24|m<<16|_|0,0!==u;);for(h=1<<b-1;E&h;)h>>=1;if(0!==h?(E&=h-1,E+=h):E=0,v++,0==--O[b]){if(b===w)break;b=t[r+a[v]]}if(k<b&&(E&f)!==l){for(0===S&&(S=k),c+=y,z=1<<(x=b-S);x+S<w&&!((z-=O[x+S])<=0);)x++,z<<=1;if(C+=1<<x,1===e&&852<C||2===e&&592<C)return 1;i[l=E&f]=k<<24|x<<16|c-s|0}}return 0!==E&&(i[c+E]=b-S<<24|64<<16|0),o.bits=k,0}},{\"../utils/common\":41}],51:[function(e,t,r){\"use strict\";t.exports={2:\"need dictionary\",1:\"stream end\",0:\"\",\"-1\":\"file error\",\"-2\":\"stream error\",\"-3\":\"data error\",\"-4\":\"insufficient memory\",\"-5\":\"buffer error\",\"-6\":\"incompatible version\"}},{}],52:[function(e,t,r){\"use strict\";var i=e(\"../utils/common\"),o=0,h=1;function n(e){for(var t=e.length;0<=--t;)e[t]=0}var s=0,a=29,u=256,l=u+1+a,f=30,c=19,_=2*l+1,g=15,d=16,p=7,m=256,b=16,v=17,y=18,w=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],k=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],S=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=new Array(2*(l+2));n(z);var C=new Array(2*f);n(C);var E=new Array(512);n(E);var A=new Array(256);n(A);var I=new Array(a);n(I);var O,B,R,T=new Array(f);function D(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function F(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function N(e){return e<256?E[e]:E[256+(e>>>7)]}function U(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function P(e,t,r){e.bi_valid>d-r?(e.bi_buf|=t<<e.bi_valid&65535,U(e,e.bi_buf),e.bi_buf=t>>d-e.bi_valid,e.bi_valid+=r-d):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function L(e,t,r){P(e,r[2*t],r[2*t+1])}function j(e,t){for(var r=0;r|=1&e,e>>>=1,r<<=1,0<--t;);return r>>>1}function Z(e,t,r){var n,i,s=new Array(g+1),a=0;for(n=1;n<=g;n++)s[n]=a=a+r[n-1]<<1;for(i=0;i<=t;i++){var o=e[2*i+1];0!==o&&(e[2*i]=j(s[o]++,o))}}function W(e){var t;for(t=0;t<l;t++)e.dyn_ltree[2*t]=0;for(t=0;t<f;t++)e.dyn_dtree[2*t]=0;for(t=0;t<c;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*m]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function M(e){8<e.bi_valid?U(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function H(e,t,r,n){var i=2*t,s=2*r;return e[i]<e[s]||e[i]===e[s]&&n[t]<=n[r]}function G(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&H(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!H(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function K(e,t,r){var n,i,s,a,o=0;if(0!==e.last_lit)for(;n=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],i=e.pending_buf[e.l_buf+o],o++,0===n?L(e,i,t):(L(e,(s=A[i])+u+1,t),0!==(a=w[s])&&P(e,i-=I[s],a),L(e,s=N(--n),r),0!==(a=k[s])&&P(e,n-=T[s],a)),o<e.last_lit;);L(e,m,t)}function Y(e,t){var r,n,i,s=t.dyn_tree,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,h=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=_,r=0;r<h;r++)0!==s[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):s[2*r+1]=0;for(;e.heap_len<2;)s[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,o&&(e.static_len-=a[2*i+1]);for(t.max_code=u,r=e.heap_len>>1;1<=r;r--)G(e,s,r);for(i=h;r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],G(e,s,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,s[2*i]=s[2*r]+s[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,s[2*r+1]=s[2*n+1]=i,e.heap[1]=i++,G(e,s,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,s,a,o,h=t.dyn_tree,u=t.max_code,l=t.stat_desc.static_tree,f=t.stat_desc.has_stree,c=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(s=0;s<=g;s++)e.bl_count[s]=0;for(h[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<_;r++)p<(s=h[2*h[2*(n=e.heap[r])+1]+1]+1)&&(s=p,m++),h[2*n+1]=s,u<n||(e.bl_count[s]++,a=0,d<=n&&(a=c[n-d]),o=h[2*n],e.opt_len+=o*(s+a),f&&(e.static_len+=o*(l[2*n+1]+a)));if(0!==m){do{for(s=p-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[p]--,m-=2}while(0<m);for(s=p;0!==s;s--)for(n=e.bl_count[s];0!==n;)u<(i=e.heap[--r])||(h[2*i+1]!==s&&(e.opt_len+=(s-h[2*i+1])*h[2*i],h[2*i+1]=s),n--)}}(e,t),Z(s,u,e.bl_count)}function X(e,t,r){var n,i,s=-1,a=t[1],o=0,h=7,u=4;for(0===a&&(h=138,u=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=t[2*(n+1)+1],++o<h&&i===a||(o<u?e.bl_tree[2*i]+=o:0!==i?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[2*b]++):o<=10?e.bl_tree[2*v]++:e.bl_tree[2*y]++,s=i,u=(o=0)===a?(h=138,3):i===a?(h=6,3):(h=7,4))}function V(e,t,r){var n,i,s=-1,a=t[1],o=0,h=7,u=4;for(0===a&&(h=138,u=3),n=0;n<=r;n++)if(i=a,a=t[2*(n+1)+1],!(++o<h&&i===a)){if(o<u)for(;L(e,i,e.bl_tree),0!=--o;);else 0!==i?(i!==s&&(L(e,i,e.bl_tree),o--),L(e,b,e.bl_tree),P(e,o-3,2)):o<=10?(L(e,v,e.bl_tree),P(e,o-3,3)):(L(e,y,e.bl_tree),P(e,o-11,7));s=i,u=(o=0)===a?(h=138,3):i===a?(h=6,3):(h=7,4)}}n(T);var q=!1;function J(e,t,r,n){P(e,(s<<1)+(n?1:0),3),function(e,t,r,n){M(e),n&&(U(e,r),U(e,~r)),i.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}r._tr_init=function(e){q||(function(){var e,t,r,n,i,s=new Array(g+1);for(n=r=0;n<a-1;n++)for(I[n]=r,e=0;e<1<<w[n];e++)A[r++]=n;for(A[r-1]=n,n=i=0;n<16;n++)for(T[n]=i,e=0;e<1<<k[n];e++)E[i++]=n;for(i>>=7;n<f;n++)for(T[n]=i<<7,e=0;e<1<<k[n]-7;e++)E[256+i++]=n;for(t=0;t<=g;t++)s[t]=0;for(e=0;e<=143;)z[2*e+1]=8,e++,s[8]++;for(;e<=255;)z[2*e+1]=9,e++,s[9]++;for(;e<=279;)z[2*e+1]=7,e++,s[7]++;for(;e<=287;)z[2*e+1]=8,e++,s[8]++;for(Z(z,l+1,s),e=0;e<f;e++)C[2*e+1]=5,C[2*e]=j(e,5);O=new D(z,w,u+1,l,g),B=new D(C,k,0,f,g),R=new D(new Array(0),x,0,c,p)}(),q=!0),e.l_desc=new F(e.dyn_ltree,O),e.d_desc=new F(e.dyn_dtree,B),e.bl_desc=new F(e.bl_tree,R),e.bi_buf=0,e.bi_valid=0,W(e)},r._tr_stored_block=J,r._tr_flush_block=function(e,t,r,n){var i,s,a=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return o;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return h;for(t=32;t<u;t++)if(0!==e.dyn_ltree[2*t])return h;return o}(e)),Y(e,e.l_desc),Y(e,e.d_desc),a=function(e){var t;for(X(e,e.dyn_ltree,e.l_desc.max_code),X(e,e.dyn_dtree,e.d_desc.max_code),Y(e,e.bl_desc),t=c-1;3<=t&&0===e.bl_tree[2*S[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(s=e.static_len+3+7>>>3)<=i&&(i=s)):i=s=r+5,r+4<=i&&-1!==t?J(e,t,r,n):4===e.strategy||s===i?(P(e,2+(n?1:0),3),K(e,z,C)):(P(e,4+(n?1:0),3),function(e,t,r,n){var i;for(P(e,t-257,5),P(e,r-1,5),P(e,n-4,4),i=0;i<n;i++)P(e,e.bl_tree[2*S[i]+1],3);V(e,e.dyn_ltree,t-1),V(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),K(e,e.dyn_ltree,e.dyn_dtree)),W(e),n&&M(e)},r._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(A[r]+u+1)]++,e.dyn_dtree[2*N(t)]++),e.last_lit===e.lit_bufsize-1},r._tr_align=function(e){P(e,2,3),L(e,m,z),function(e){16===e.bi_valid?(U(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{\"../utils/common\":41}],53:[function(e,t,r){\"use strict\";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg=\"\",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,r){(function(e){!function(r,n){\"use strict\";if(!r.setImmediate){var i,s,t,a,o=1,h={},u=!1,l=r.document,e=Object.getPrototypeOf&&Object.getPrototypeOf(r);e=e&&e.setTimeout?e:r,i=\"[object process]\"==={}.toString.call(r.process)?function(e){process.nextTick(function(){c(e)})}:function(){if(r.postMessage&&!r.importScripts){var e=!0,t=r.onmessage;return r.onmessage=function(){e=!1},r.postMessage(\"\",\"*\"),r.onmessage=t,e}}()?(a=\"setImmediate$\"+Math.random()+\"$\",r.addEventListener?r.addEventListener(\"message\",d,!1):r.attachEvent(\"onmessage\",d),function(e){r.postMessage(a+e,\"*\")}):r.MessageChannel?((t=new MessageChannel).port1.onmessage=function(e){c(e.data)},function(e){t.port2.postMessage(e)}):l&&\"onreadystatechange\"in l.createElement(\"script\")?(s=l.documentElement,function(e){var t=l.createElement(\"script\");t.onreadystatechange=function(){c(e),t.onreadystatechange=null,s.removeChild(t),t=null},s.appendChild(t)}):function(e){setTimeout(c,0,e)},e.setImmediate=function(e){\"function\"!=typeof e&&(e=new Function(\"\"+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var n={callback:e,args:t};return h[o]=n,i(o),o++},e.clearImmediate=f}function f(e){delete h[e]}function c(e){if(u)setTimeout(c,0,e);else{var t=h[e];if(t){u=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}(t)}finally{f(e),u=!1}}}}function d(e){e.source===r&&\"string\"==typeof e.data&&0===e.data.indexOf(a)&&c(+e.data.slice(a.length))}}(\"undefined\"==typeof self?void 0===e?this:e:self)}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{}]},{},[10])(10)});", "import { css, html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\n/**\n * @example\n * ```ts\n * html`<icon-button class=\"has-tool-tip\" @click=${this.onUnlink}>\n *   ${UnlinkIcon}\n * </icon-button>`\n * ```\n */\n@customElement('icon-button')\nexport class IconButton extends LitElement {\n  static override styles = css`\n    :host {\n      box-sizing: border-box;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      border: none;\n      width: var(--button-width);\n      height: var(--button-height);\n      border-radius: 5px;\n      background: transparent;\n      cursor: pointer;\n      user-select: none;\n      font-family: var(--affine-font-family);\n      fill: var(--affine-icon-color);\n      color: var(--affine-popover-color);\n      pointer-events: auto;\n    }\n\n    :host > span {\n      white-space: nowrap;\n      text-overflow: ellipsis;\n      overflow: hidden;\n    }\n\n    :host(:hover) {\n      background: var(--affine-hover-color);\n      fill: var(--affine-primary-color);\n      color: var(--affine-primary-color);\n    }\n\n    :host(:active) {\n      background: transparent;\n      fill: var(--affine-primary-color);\n      color: var(--affine-primary-color);\n    }\n\n    :host([disabled]),\n    :host(:disabled) {\n      background: transparent;\n      color: var(--affine-text-disable-color);\n      fill: var(--affine-text-disable-color);\n      cursor: not-allowed;\n    }\n\n    /* You can add a 'hover' attribute to the button to show the hover style */\n    :host([hover]) {\n      background: var(--affine-hover-color);\n      fill: var(--affine-primary-color);\n      color: var(--affine-primary-color);\n    }\n\n    /* You can add a 'active' attribute to the button to revert the active style */\n    :host([active]) {\n      fill: var(--affine-primary-color);\n      color: var(--affine-primary-color);\n    }\n\n    :host(:active[active]) {\n      background: transparent;\n      fill: var(--affine-icon-color);\n    }\n  `;\n\n  @property()\n  size: string | number | null = null;\n\n  @property()\n  width: string | number = '28px';\n\n  @property()\n  height: string | number = '28px';\n\n  @property()\n  text: string | null = null;\n\n  @property()\n  disabled: false | '' = false;\n\n  constructor() {\n    super();\n    this.addEventListener('keypress', event => {\n      if (this.disabled) {\n        return;\n      }\n      if (event.key === 'Enter') {\n        this.click();\n      }\n    });\n\n    // Prevent click event when disabled\n    this.addEventListener(\n      'click',\n      event => {\n        if (this.disabled === '') {\n          event.preventDefault();\n          event.stopPropagation();\n        }\n      },\n      { capture: true }\n    );\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.tabIndex = 0;\n\n    if (this.size && (this.width || this.height)) {\n      throw new Error(\n        'Cannot set both size and width/height on an icon-button'\n      );\n    }\n\n    let width = this.width;\n    let height = this.height;\n    if (this.size) {\n      width = this.size;\n      height = this.size;\n    }\n\n    this.style.setProperty(\n      '--button-width',\n      typeof width === 'string' ? width : `${width}px`\n    );\n    this.style.setProperty(\n      '--button-height',\n      typeof height === 'string' ? height : `${height}px`\n    );\n  }\n\n  override render() {\n    return html`<slot></slot>${this.text\n        ? html`<span>${this.text}</span>`\n        : ''}<slot name=\"optional\"></slot> `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'icon-button': IconButton;\n  }\n}\n", "import { DisposableGroup } from '@blocksuite/global/utils';\nimport type { LitElement } from 'lit';\n\n// See https://lit.dev/docs/composition/mixins/#mixins-in-typescript\n// This definition should be exported, see https://github.com/microsoft/TypeScript/issues/30355#issuecomment-839834550\nexport declare class DisposableClass {\n  protected _disposables: DisposableGroup;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype Constructor<T = object> = new (...args: any[]) => T;\n\n/**\n * Mixin that adds a `_disposables: DisposableGroup` property to the class.\n *\n * The `_disposables` property is initialized in `connectedCallback` and disposed in `disconnectedCallback`.\n *\n * see https://lit.dev/docs/composition/mixins/\n *\n * @example\n * ```ts\n * class MyElement extends WithDisposable(ShadowlessElement) {\n *   onClick() {\n *     this._disposables.add(...);\n *   }\n * }\n * ```\n */\nexport function WithDisposable<T extends Constructor<LitElement>>(\n  SuperClass: T\n) {\n  class DerivedClass extends SuperClass {\n    protected _disposables = new DisposableGroup();\n\n    override connectedCallback() {\n      super.connectedCallback();\n      if (this._disposables.disposed) {\n        this._disposables = new DisposableGroup();\n      }\n    }\n\n    override disconnectedCallback() {\n      super.disconnectedCallback();\n      this._disposables.dispose();\n    }\n  }\n  return DerivedClass as unknown as T & Constructor<DisposableClass>;\n}\n", "import type { CSSResultGroup, CSSResultOrNative } from 'lit';\nimport { CSSResult, LitElement } from 'lit';\n\nexport class ShadowlessElement extends LitElement {\n  static disableShadowRoot = true;\n\n  protected static override finalizeStyles(\n    styles?: CSSResultGroup\n  ): CSSResultOrNative[] {\n    let elementStyles = super.finalizeStyles(styles);\n    const styleRoot = document.head;\n    if (this.disableShadowRoot) {\n      // XXX: This breaks component encapsulation and applies styles to the document.\n      // These styles should be manually scoped.\n      elementStyles.forEach((s: CSSResultOrNative) => {\n        if (s instanceof CSSResult) {\n          const style = document.createElement('style');\n          style.textContent = s.cssText;\n          styleRoot.appendChild(style);\n        } else {\n          console.error('unreachable');\n        }\n      });\n      elementStyles = [];\n    }\n    return elementStyles;\n  }\n\n  override createRenderRoot() {\n    return (this.constructor as typeof ShadowlessElement).disableShadowRoot\n      ? this\n      : super.createRenderRoot();\n  }\n}\n", "import type { BaseBlockModel } from '@blocksuite/store';\nimport type { Page } from '@blocksuite/store';\nimport type { TemplateResult } from 'lit';\nimport { property } from 'lit/decorators.js';\n\nimport { WithDisposable } from '../width-disposable.js';\nimport type { BlockSuiteRoot } from './lit-root.js';\nimport { ShadowlessElement } from './shadowless-element.js';\n\nexport class BlockElement<Model extends BaseBlockModel> extends WithDisposable(\n  ShadowlessElement\n) {\n  @property()\n  root!: BlockSuiteRoot;\n\n  @property()\n  model!: Model;\n\n  @property()\n  content!: TemplateResult;\n\n  @property()\n  page!: Page;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\n// Any new exports need to be added to the export statement in\n// `packages/lit/src/index.all.ts`.\n\nimport {html as coreHtml, svg as coreSvg, TemplateResult} from './lit-html.js';\n\nexport interface StaticValue {\n  /** The value to interpolate as-is into the template. */\n  _$litStatic$: string;\n\n  /**\n   * A value that can't be decoded from ordinary JSON, make it harder for\n   * a attacker-controlled data that goes through JSON.parse to produce a valid\n   * StaticValue.\n   */\n  r: typeof brand;\n}\n\n/**\n * Prevents JSON injection attacks.\n *\n * The goals of this brand:\n *   1) fast to check\n *   2) code is small on the wire\n *   3) multiple versions of Lit in a single page will all produce mutually\n *      interoperable StaticValues\n *   4) normal JSON.parse (without an unusual reviver) can not produce a\n *      StaticValue\n *\n * Symbols satisfy (1), (2), and (4). We use Symbol.for to satisfy (3), but\n * we don't care about the key, so we break ties via (2) and use the empty\n * string.\n */\nconst brand = Symbol.for('');\n\n/** Safely extracts the string part of a StaticValue. */\nconst unwrapStaticValue = (value: unknown): string | undefined => {\n  if ((value as Partial<StaticValue>)?.r !== brand) {\n    return undefined;\n  }\n  return (value as Partial<StaticValue>)?.['_$litStatic$'];\n};\n\n/**\n * Wraps a string so that it behaves like part of the static template\n * strings instead of a dynamic value.\n *\n * Users must take care to ensure that adding the static string to the template\n * results in well-formed HTML, or else templates may break unexpectedly.\n *\n * Note that this function is unsafe to use on untrusted content, as it will be\n * directly parsed into HTML. Do not pass user input to this function\n * without sanitizing it.\n *\n * Static values can be changed, but they will cause a complete re-render\n * since they effectively create a new template.\n */\nexport const unsafeStatic = (value: string): StaticValue => ({\n  ['_$litStatic$']: value,\n  r: brand,\n});\n\nconst textFromStatic = (value: StaticValue) => {\n  if (value['_$litStatic$'] !== undefined) {\n    return value['_$litStatic$'];\n  } else {\n    throw new Error(\n      `Value passed to 'literal' function must be a 'literal' result: ${value}. Use 'unsafeStatic' to pass non-literal values, but\n            take care to ensure page security.`\n    );\n  }\n};\n\n/**\n * Tags a string literal so that it behaves like part of the static template\n * strings instead of a dynamic value.\n *\n * The only values that may be used in template expressions are other tagged\n * `literal` results or `unsafeStatic` values (note that untrusted content\n * should never be passed to `unsafeStatic`).\n *\n * Users must take care to ensure that adding the static string to the template\n * results in well-formed HTML, or else templates may break unexpectedly.\n *\n * Static values can be changed, but they will cause a complete re-render since\n * they effectively create a new template.\n */\nexport const literal = (\n  strings: TemplateStringsArray,\n  ...values: unknown[]\n): StaticValue => ({\n  ['_$litStatic$']: values.reduce(\n    (acc, v, idx) => acc + textFromStatic(v as StaticValue) + strings[idx + 1],\n    strings[0]\n  ) as string,\n  r: brand,\n});\n\nconst stringsCache = new Map<string, TemplateStringsArray>();\n\n/**\n * Wraps a lit-html template tag (`html` or `svg`) to add static value support.\n */\nexport const withStatic =\n  (coreTag: typeof coreHtml | typeof coreSvg) =>\n  (strings: TemplateStringsArray, ...values: unknown[]): TemplateResult => {\n    const l = values.length;\n    let staticValue: string | undefined;\n    let dynamicValue: unknown;\n    const staticStrings: Array<string> = [];\n    const dynamicValues: Array<unknown> = [];\n    let i = 0;\n    let hasStatics = false;\n    let s: string;\n\n    while (i < l) {\n      s = strings[i];\n      // Collect any unsafeStatic values, and their following template strings\n      // so that we treat a run of template strings and unsafe static values as\n      // a single template string.\n      while (\n        i < l &&\n        ((dynamicValue = values[i]),\n        (staticValue = unwrapStaticValue(dynamicValue))) !== undefined\n      ) {\n        s += staticValue + strings[++i];\n        hasStatics = true;\n      }\n      // If the last value is static, we don't need to push it.\n      if (i !== l) {\n        dynamicValues.push(dynamicValue);\n      }\n      staticStrings.push(s);\n      i++;\n    }\n    // If the last value isn't static (which would have consumed the last\n    // string), then we need to add the last string.\n    if (i === l) {\n      staticStrings.push(strings[l]);\n    }\n\n    if (hasStatics) {\n      const key = staticStrings.join('$$lit$$');\n      strings = stringsCache.get(key)!;\n      if (strings === undefined) {\n        // Beware: in general this pattern is unsafe, and doing so may bypass\n        // lit's security checks and allow an attacker to execute arbitrary\n        // code and inject arbitrary content.\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (staticStrings as any).raw = staticStrings;\n        stringsCache.set(\n          key,\n          (strings = staticStrings as unknown as TemplateStringsArray)\n        );\n      }\n      values = dynamicValues;\n    }\n    return coreTag(strings, ...values);\n  };\n\n/**\n * Interprets a template literal as an HTML template that can efficiently\n * render to and update a container.\n *\n * Includes static value support from `lit-html/static.js`.\n */\nexport const html = withStatic(coreHtml);\n\n/**\n * Interprets a template literal as an SVG template that can efficiently\n * render to and update a container.\n *\n * Includes static value support from `lit-html/static.js`.\n */\nexport const svg = withStatic(coreSvg);\n", "import { assertExists } from '@blocksuite/global/utils';\n\ntype MatchEvent<T extends string> = T extends UIEventStateType\n  ? BlockSuiteUIEventState[T]\n  : UIEventState;\n\nexport class UIEventState {\n  /** when extends, override it with pattern `xxxState` */\n  type = 'defaultState';\n\n  constructor(public event: Event) {}\n}\n\nexport class UIEventStateContext {\n  private _map: Record<string, UIEventState> = {};\n\n  static from(...states: UIEventState[]) {\n    const context = new UIEventStateContext();\n    states.forEach(state => {\n      context.add(state);\n    });\n    return context;\n  }\n\n  add = <State extends UIEventState = UIEventState>(state: State) => {\n    const name = state.type;\n    if (this._map[name]) {\n      console.warn('UIEventStateContext: state name duplicated', name);\n    }\n\n    this._map[name] = state;\n  };\n\n  has = (type: UIEventStateType) => {\n    return !!this._map[type];\n  };\n\n  get = <Type extends UIEventStateType = UIEventStateType>(\n    type: Type\n  ): MatchEvent<Type> => {\n    const state = this._map[type];\n    assertExists(state, `UIEventStateContext: state ${type} not found`);\n    return state as MatchEvent<Type>;\n  };\n}\n\nexport type UIEventHandler = (\n  context: UIEventStateContext\n) => boolean | null | undefined | void;\n\ndeclare global {\n  interface BlockSuiteUIEventState {\n    defaultState: UIEventState;\n  }\n\n  type UIEventStateType = keyof BlockSuiteUIEventState;\n}\n", "import { UIEventState } from './base.js';\n\ntype PointerEventStateOptions = {\n  event: PointerEvent;\n  rect: DOMRect;\n  startX: number;\n  startY: number;\n  last: PointerEventState | null;\n};\n\ntype Point = { x: number; y: number };\n\nexport class PointerEventState extends UIEventState {\n  override readonly type = 'pointerState';\n\n  raw: PointerEvent;\n  point: Point;\n  containerOffset: Point;\n  start: Point;\n  delta: Point;\n  keys: {\n    shift: boolean;\n    cmd: boolean;\n    alt: boolean;\n  };\n  button: number;\n  dragging: boolean;\n\n  get x() {\n    return this.point.x;\n  }\n\n  get y() {\n    return this.point.y;\n  }\n\n  constructor({ event, rect, startX, startY, last }: PointerEventStateOptions) {\n    super(event as Event);\n\n    const offsetX = event.clientX - rect.left;\n    const offsetY = event.clientY - rect.top;\n\n    this.raw = event;\n    this.point = { x: offsetX, y: offsetY };\n    this.containerOffset = { x: rect.left, y: rect.top };\n    this.start = { x: startX, y: startY };\n    this.delta = last\n      ? { x: offsetX - last.point.x, y: offsetY - last.point.y }\n      : { x: 0, y: 0 };\n    this.keys = {\n      shift: event.shiftKey,\n      cmd: event.metaKey || event.ctrlKey,\n      alt: event.altKey,\n    };\n    this.button = last?.button || event.button;\n    this.dragging = !!last;\n  }\n}\n\ntype KeyboardEventStateOptions = {\n  event: KeyboardEvent;\n};\n\nexport class KeyboardEventState extends UIEventState {\n  override readonly type = 'keyboardState';\n\n  raw: KeyboardEvent;\n\n  constructor({ event }: KeyboardEventStateOptions) {\n    super(event as Event);\n\n    this.raw = event;\n  }\n}\n\ndeclare global {\n  interface BlockSuiteUIEventState {\n    pointerState: PointerEventState;\n  }\n}\n\ndeclare global {\n  interface BlockSuiteUIEventState {\n    keyboardState: KeyboardEventState;\n  }\n}\n", "import { UIEventStateContext } from './base.js';\nimport type { UIEventDispatcher } from './dispatcher.js';\nimport { KeyboardEventState } from './state.js';\n\nexport class KeyboardControl {\n  constructor(private _dispatcher: UIEventDispatcher) {}\n\n  listen() {\n    this._dispatcher.disposables.addFromEvent(document, 'keydown', this._down);\n    this._dispatcher.disposables.addFromEvent(document, 'keyup', this._up);\n  }\n\n  private _down = (event: KeyboardEvent) => {\n    const keyboardEventState = new KeyboardEventState({\n      event,\n    });\n\n    this._dispatcher.run(\n      'keyDown',\n      UIEventStateContext.from(keyboardEventState)\n    );\n  };\n\n  private _up = (event: KeyboardEvent) => {\n    const keyboardEventState = new KeyboardEventState({\n      event,\n    });\n\n    this._dispatcher.run('keyUp', UIEventStateContext.from(keyboardEventState));\n  };\n}\n", "export function isFarEnough(a: PointerEvent, b: PointerEvent) {\n  const dx = a.x - b.x;\n  const dy = a.y - b.y;\n  return Math.pow(dx, 2) + Math.pow(dy, 2) > 4;\n}\n\nexport const toLowerCase = <T extends string>(str: T): Lowercase<T> =>\n  str.toLowerCase() as Lowercase<T>;\n", "import { assertExists } from '@blocksuite/global/utils';\n\nimport { UIEventStateContext } from './base.js';\nimport type { UIEventDispatcher } from './dispatcher.js';\nimport { PointerEventState } from './state.js';\nimport { isFarEnough } from './utils.js';\n\nexport class PointerControl {\n  private _lastPointerDownEvent: PointerEvent | null = null;\n  private _startDragState: PointerEventState | null = null;\n  private _lastDragState: PointerEventState | null = null;\n  private _pointerDownCount = 0;\n  private _dragging = false;\n  private _startX = -Infinity;\n  private _startY = -Infinity;\n\n  constructor(private _dispatcher: UIEventDispatcher) {}\n\n  listen() {\n    this._dispatcher.disposables.addFromEvent(\n      this._dispatcher.root,\n      'pointerdown',\n      this._down\n    );\n    this._dispatcher.disposables.addFromEvent(\n      this._dispatcher.root,\n      'pointermove',\n      this._moveOn\n    );\n    this._dispatcher.disposables.addFromEvent(\n      this._dispatcher.root,\n      'pointerout',\n      this._out\n    );\n  }\n\n  private get _rect() {\n    return this._dispatcher.root.getBoundingClientRect();\n  }\n\n  private _reset = () => {\n    this._startX = -Infinity;\n    this._startY = -Infinity;\n    this._lastDragState = null;\n    this._dragging = false;\n  };\n\n  private _down = (event: PointerEvent) => {\n    if (\n      this._lastPointerDownEvent &&\n      event.timeStamp - this._lastPointerDownEvent.timeStamp < 500 &&\n      !isFarEnough(event, this._lastPointerDownEvent)\n    ) {\n      this._pointerDownCount++;\n    } else {\n      this._pointerDownCount = 1;\n    }\n\n    const pointerEventState = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: this._startX,\n      startY: this._startY,\n      last: null,\n    });\n\n    this._startX = pointerEventState.point.x;\n    this._startY = pointerEventState.point.y;\n    this._startDragState = pointerEventState;\n    this._lastDragState = pointerEventState;\n    this._lastPointerDownEvent = event;\n\n    this._dispatcher.run(\n      'pointerDown',\n      UIEventStateContext.from(pointerEventState)\n    );\n\n    this._dispatcher.disposables.addFromEvent(\n      document,\n      'pointermove',\n      this._move\n    );\n    this._dispatcher.disposables.addFromEvent(document, 'pointerup', this._up);\n  };\n\n  private _up = (event: PointerEvent) => {\n    const pointerEventState = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: this._startX,\n      startY: this._startY,\n      last: this._lastDragState,\n    });\n    const context = UIEventStateContext.from(pointerEventState);\n\n    const run = () => {\n      if (this._dragging) {\n        this._dispatcher.run('dragEnd', context);\n        return;\n      }\n      this._dispatcher.run('click', context);\n      if (this._pointerDownCount === 2) {\n        this._dispatcher.run('doubleClick', context);\n      }\n      if (this._pointerDownCount === 3) {\n        this._dispatcher.run('tripleClick', context);\n      }\n    };\n\n    run();\n    this._dispatcher.run('pointerUp', context);\n\n    this._reset();\n    document.removeEventListener('pointermove', this._move);\n    document.removeEventListener('pointerup', this._up);\n  };\n\n  private _move = (event: PointerEvent) => {\n    const last = this._lastDragState;\n    const state = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: this._startX,\n      startY: this._startY,\n      last,\n    });\n    this._lastDragState = state;\n\n    assertExists(this._startDragState);\n\n    if (!this._dragging && isFarEnough(this._startDragState.raw, state.raw)) {\n      this._dragging = true;\n      this._dispatcher.run(\n        'dragStart',\n        UIEventStateContext.from(this._startDragState)\n      );\n    }\n\n    if (this._dragging) {\n      this._dispatcher.run('dragMove', UIEventStateContext.from(state));\n    }\n  };\n\n  private _moveOn = (event: PointerEvent) => {\n    const state = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: this._startX,\n      startY: this._startY,\n      last: this._lastDragState,\n    });\n\n    this._dispatcher.run('pointerMove', UIEventStateContext.from(state));\n  };\n\n  private _out = (event: PointerEvent) => {\n    const state = new PointerEventState({\n      event,\n      rect: this._rect,\n      startX: -Infinity,\n      startY: -Infinity,\n      last: null,\n    });\n\n    this._dispatcher.run('pointerOut', UIEventStateContext.from(state));\n  };\n}\n", "import { DisposableGroup } from '@blocksuite/global/utils';\n\nimport type { UIEventHandler } from './base.js';\nimport { UIEventStateContext } from './base.js';\nimport { UIEventState } from './base.js';\nimport { KeyboardControl } from './keyboard.js';\nimport { PointerControl } from './pointer.js';\nimport { toLowerCase } from './utils.js';\n\nconst bypassEventNames = [\n  'beforeInput',\n  'compositionStart',\n  'compositionUpdate',\n  'compositionEnd',\n\n  'paste',\n  'copy',\n  'blur',\n  'focus',\n  'drop',\n  'contextMenu',\n  'wheel',\n] as const;\n\nconst globalEventNames = ['selectionChange', 'virgo-vrange-updated'] as const;\n\nconst eventNames = [\n  'click',\n  'doubleClick',\n  'tripleClick',\n\n  'pointerDown',\n  'pointerMove',\n  'pointerUp',\n  'pointerOut',\n\n  'dragStart',\n  'dragMove',\n  'dragEnd',\n\n  'keyDown',\n  'keyUp',\n\n  ...bypassEventNames,\n  ...globalEventNames,\n] as const;\n\nexport type EventName = (typeof eventNames)[number];\n\nexport class UIEventDispatcher {\n  disposables = new DisposableGroup();\n\n  private _handlersMap = Object.fromEntries(\n    eventNames.map((name): [EventName, Array<UIEventHandler>] => [name, []])\n  ) as Record<EventName, Array<UIEventHandler>>;\n\n  private _pointerControl: PointerControl;\n  private _keyboardControl: KeyboardControl;\n\n  constructor(public root: HTMLElement) {\n    this._pointerControl = new PointerControl(this);\n    this._keyboardControl = new KeyboardControl(this);\n  }\n\n  mount() {\n    if (this.disposables.disposed) {\n      this.disposables = new DisposableGroup();\n    }\n    this._bindEvents();\n  }\n\n  unmount() {\n    this.disposables.dispose();\n  }\n\n  run(name: EventName, context: UIEventStateContext) {\n    const handlers = this._handlersMap[name];\n    if (!handlers) return;\n\n    for (const handler of handlers) {\n      const result = handler(context);\n      if (result) {\n        return;\n      }\n    }\n  }\n\n  add(name: EventName, handler: UIEventHandler) {\n    this._handlersMap[name].unshift(handler);\n    return () => {\n      if (this._handlersMap[name].includes(handler)) {\n        this._handlersMap[name] = this._handlersMap[name].filter(\n          f => f !== handler\n        );\n      }\n    };\n  }\n\n  private _bindEvents() {\n    bypassEventNames.forEach(eventName => {\n      this.disposables.addFromEvent(this.root, toLowerCase(eventName), e => {\n        this.run(eventName, UIEventStateContext.from(new UIEventState(e)));\n      });\n    });\n    globalEventNames.forEach(eventName => {\n      this.disposables.addFromEvent(document, toLowerCase(eventName), e => {\n        this.run(eventName, UIEventStateContext.from(new UIEventState(e)));\n      });\n    });\n    this._pointerControl.listen();\n    this._keyboardControl.listen();\n  }\n}\n", "/* eslint-disable lit/binding-positions, lit/no-invalid-html */\n\nimport type { BaseBlockModel, BlockSchemaType, Page } from '@blocksuite/store';\nimport type { TemplateResult } from 'lit';\nimport { nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport type { StaticValue } from 'lit/static-html.js';\nimport { html, unsafeStatic } from 'lit/static-html.js';\n\nimport { UIEventDispatcher } from '../event/index.js';\nimport { ShadowlessElement } from './shadowless-element.js';\n\n@customElement('block-suite-root')\nexport class BlockSuiteRoot extends ShadowlessElement {\n  @property()\n  componentMap!: Map<BlockSchemaType, StaticValue>;\n\n  @property()\n  page!: Page;\n\n  @property()\n  blockIdAttr = 'data-block-id';\n\n  modelSubscribed = new Set<string>();\n\n  uiEventDispatcher = new UIEventDispatcher(this);\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.uiEventDispatcher.mount();\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.uiEventDispatcher.unmount();\n  }\n\n  override render() {\n    const { root } = this.page;\n    if (!root) {\n      return null;\n    }\n\n    return this.renderModel(root);\n  }\n\n  renderModel = (model: BaseBlockModel): TemplateResult => {\n    const { flavour, children } = model;\n    const schema = this.page.schema.flavourSchemaMap.get(flavour);\n    if (!schema) {\n      console.warn(`Cannot find schema for ${flavour}.`);\n      return html`${nothing}`;\n    }\n\n    const tag = this.componentMap.get(schema);\n    if (!tag) {\n      console.warn(`Cannot find tag for ${flavour}.`);\n      return html`${nothing}`;\n    }\n\n    this._onLoadModel(model);\n\n    return html`<${tag}\n      ${unsafeStatic(this.blockIdAttr)}=${model.id}\n      .root=${this}\n      .page=${this.page}\n      .model=${model}\n      .content=${html`${repeat(\n        children,\n        child => child.id,\n        child => this.renderModel(child)\n      )}`}\n    ></${tag}>`;\n  };\n\n  _onLoadModel = (model: BaseBlockModel) => {\n    const { id } = model;\n    if (!this.modelSubscribed.has(id)) {\n      model.propsUpdated.on(() => {\n        this.requestUpdate();\n      });\n      model.childrenUpdated.on(() => {\n        this.requestUpdate();\n      });\n      this.modelSubscribed.add(id);\n    }\n  };\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'block-suite-root': BlockSuiteRoot;\n  }\n}\n", "import { css } from 'lit';\n\n/**\n * @example\n * ```html\n * <icon-button class=\"has-tool-tip\" style=\"${tooltipStyle}\">\n *    Button\n *    <tool-tip inert role=\"tooltip\">Tooltip</tool-tip>\n * </icon-button>\n * ```\n * Reference to https://web.dev/building-a-tooltip-component/\n */\nexport const tooltipStyle = css`\n  tool-tip {\n    font-family: var(--affine-font-family);\n    position: absolute;\n\n    inline-size: max-content;\n    text-align: center;\n    font-size: var(--affine-font-sm);\n    padding: 4px 12px;\n    color: var(--affine-white);\n    background: var(--affine-tooltip);\n    opacity: 0;\n    transition: opacity 0.2s ease, transform 0.2s ease;\n    pointer-events: none;\n    user-select: none;\n\n    /* Default is top-start */\n    left: 0;\n    top: 0;\n    border-radius: 10px 10px 10px 0;\n    transform: translate(0, calc(-100% - 8px));\n  }\n\n  tool-tip:is([tip-position='top']) {\n    left: 50%;\n    border-radius: 10px;\n    transform: translate(-50%, calc(-100% - 8px));\n  }\n  tool-tip:is([tip-position='right']) {\n    left: unset;\n    right: 0;\n    transform: translateX(calc(100% + 8px));\n    border-radius: 0 10px 10px 10px;\n  }\n  tool-tip:is([tip-position='left']) {\n    left: 0;\n    top: 50%;\n    transform: translate(calc(-100% - 8px), -50%);\n    border-radius: 10px 10px 0 10px;\n  }\n  tool-tip:is([tip-position='bottom']) {\n    top: unset;\n    left: 50%;\n    bottom: 0;\n    transform: translate(-50%, calc(100% + 8px));\n    border-radius: 10px;\n  }\n\n  /* work for tip-position='top' */\n  tool-tip:is([arrow]):is([tip-position='top']) {\n    transform: translate(-50%, calc(-100% - 16px));\n  }\n  tool-tip:is([arrow]):is([tip-position='top'])::before {\n    position: absolute;\n    content: '';\n    left: 50%;\n    bottom: 0;\n    transform: translate(-50%, 100%);\n    width: 0;\n    height: 0;\n    border-left: 5px solid transparent;\n    border-right: 5px solid transparent;\n    border-top: 6px solid var(--affine-tooltip);\n  }\n\n  /* work for tip-position='right' */\n  tool-tip:is([arrow]):is([tip-position='right']) {\n    transform: translateX(calc(100% + 16px));\n  }\n  tool-tip:is([arrow]):is([tip-position='right'])::before {\n    position: absolute;\n    content: '';\n    left: 0;\n    bottom: 50%;\n    transform: translate(-100%, 50%);\n    width: 0;\n    height: 0;\n    border-top: 5px solid transparent;\n    border-bottom: 5px solid transparent;\n    border-right: 6px solid var(--affine-tooltip);\n  }\n\n  /* work for tip-position='left' */\n  tool-tip:is([arrow]):is([tip-position='left']) {\n    transform: translate(calc(-100% - 16px), -50%);\n  }\n  tool-tip:is([arrow]):is([tip-position='left'])::before {\n    position: absolute;\n    content: '';\n    right: 0;\n    bottom: 50%;\n    transform: translate(100%, 50%);\n    width: 0;\n    height: 0;\n    border-top: 5px solid transparent;\n    border-bottom: 5px solid transparent;\n    border-left: 6px solid var(--affine-tooltip);\n  }\n\n  /* work for tip-position='bottom' */\n  tool-tip:is([arrow]):is([tip-position='bottom']) {\n    transform: translate(-50%, calc(100% + 16px));\n  }\n  tool-tip:is([arrow]):is([tip-position='bottom'])::before {\n    position: absolute;\n    content: '';\n    left: 50%;\n    top: 0;\n    transform: translate(-50%, -100%);\n    width: 0;\n    height: 0;\n    border-left: 5px solid transparent;\n    border-right: 5px solid transparent;\n    border-bottom: 6px solid var(--affine-tooltip);\n  }\n\n  .has-tool-tip {\n    position: relative;\n  }\n  .has-tool-tip:is(:hover, :focus-visible, :active) > tool-tip {\n    opacity: 1;\n    transition-delay: 200ms;\n  }\n`;\n", "import { html } from 'lit';\n\nexport const DefaultIcon = html`\n  <svg\n    width=\"16\"\n    height=\"16\"\n    viewBox=\"0 0 16 16\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g clip-path=\"url(#clip0_3334_77372)\">\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M2.71294 6.47927C2.9781 6.34125 3.27709 6.21883 3.59925 6.11144C4.18904 5.91485 4.88593 5.759 5.65385 5.65385C5.759 4.88593 5.91485 4.18904 6.11144 3.59925C6.21883 3.27709 6.34125 2.9781 6.47927 2.71294C4.66435 3.23402 3.23402 4.66435 2.71294 6.47927ZM8 1.5C4.41015 1.5 1.5 4.41015 1.5 8C1.5 11.5899 4.41015 14.5 8 14.5C11.5899 14.5 14.5 11.5899 14.5 8C14.5 4.41015 11.5899 1.5 8 1.5ZM8 2.5C7.94272 2.5 7.80858 2.53437 7.61422 2.781C7.42429 3.02199 7.23139 3.4017 7.06013 3.91547C6.90527 4.38004 6.77549 4.9317 6.67997 5.5472C7.10671 5.5162 7.5484 5.5 8 5.5C8.4516 5.5 8.89329 5.5162 9.32003 5.5472C9.22451 4.9317 9.09473 4.38004 8.93987 3.91547C8.76861 3.4017 8.57571 3.02199 8.38579 2.781C8.19142 2.53437 8.05728 2.5 8 2.5ZM10.3461 5.65385C10.241 4.88593 10.0852 4.18904 9.88856 3.59925C9.78117 3.27709 9.65875 2.9781 9.52073 2.71294C11.3357 3.23402 12.766 4.66435 13.2871 6.47927C13.0219 6.34125 12.7229 6.21883 12.4008 6.11144C11.811 5.91485 11.1141 5.759 10.3461 5.65385ZM9.44027 6.55973C8.98158 6.52087 8.49906 6.5 8 6.5C7.50094 6.5 7.01842 6.52087 6.55973 6.55973C6.52087 7.01842 6.5 7.50094 6.5 8C6.5 8.49906 6.52087 8.98158 6.55973 9.44027C7.01842 9.47913 7.50094 9.5 8 9.5C8.49906 9.5 8.98158 9.47913 9.44027 9.44027C9.47913 8.98158 9.5 8.49906 9.5 8C9.5 7.50094 9.47913 7.01842 9.44027 6.55973ZM10.4528 9.32002C10.4838 8.89329 10.5 8.4516 10.5 8C10.5 7.5484 10.4838 7.10671 10.4528 6.67998C11.0683 6.7755 11.62 6.90527 12.0845 7.06013C12.5983 7.23139 12.978 7.42429 13.219 7.61422C13.4656 7.80858 13.5 7.94272 13.5 8C13.5 8.05728 13.4656 8.19142 13.219 8.38579C12.978 8.57571 12.5983 8.76861 12.0845 8.93987C11.62 9.09473 11.0683 9.2245 10.4528 9.32002ZM9.32003 10.4528C8.89329 10.4838 8.4516 10.5 8 10.5C7.5484 10.5 7.10671 10.4838 6.67998 10.4528C6.7755 11.0683 6.90527 11.62 7.06013 12.0845C7.23139 12.5983 7.42429 12.978 7.61422 13.219C7.80858 13.4656 7.94272 13.5 8 13.5C8.05728 13.5 8.19142 13.4656 8.38579 13.219C8.57571 12.978 8.76861 12.5983 8.93987 12.0845C9.09473 11.62 9.22451 11.0683 9.32003 10.4528ZM9.52073 13.2871C9.65875 13.0219 9.78117 12.7229 9.88856 12.4008C10.0852 11.811 10.241 11.1141 10.3461 10.3461C11.1141 10.241 11.811 10.0852 12.4008 9.88856C12.7229 9.78117 13.0219 9.65875 13.2871 9.52073C12.766 11.3357 11.3357 12.766 9.52073 13.2871ZM6.47927 13.2871C4.66435 12.766 3.23402 11.3357 2.71294 9.52073C2.9781 9.65875 3.27709 9.78117 3.59925 9.88856C4.18904 10.0852 4.88593 10.241 5.65385 10.3461C5.759 11.1141 5.91485 11.811 6.11144 12.4008C6.21883 12.7229 6.34125 13.0219 6.47927 13.2871ZM5.5472 9.32003C4.9317 9.22451 4.38004 9.09473 3.91547 8.93987C3.4017 8.76861 3.02199 8.57571 2.781 8.38579C2.53437 8.19142 2.5 8.05728 2.5 8C2.5 7.94272 2.53437 7.80858 2.781 7.61422C3.02199 7.42429 3.4017 7.23139 3.91547 7.06013C4.38004 6.90527 4.9317 6.7755 5.5472 6.67998C5.5162 7.10671 5.5 7.5484 5.5 8C5.5 8.4516 5.5162 8.89329 5.5472 9.32003Z\"\n        fill=\"currentColor\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_3334_77372\">\n        <rect width=\"16\" height=\"16\" fill=\"white\" />\n      </clipPath>\n    </defs>\n  </svg>\n`;\nexport const EdgelessIcon = html`\n  <svg\n    width=\"16\"\n    height=\"16\"\n    viewBox=\"0 0 16 16\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g clip-path=\"url(#clip0_3334_76304)\">\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M4.33341 3.16667C3.68908 3.16667 3.16675 3.68901 3.16675 4.33334C3.16675 4.97767 3.68908 5.5 4.33341 5.5C4.97775 5.5 5.50008 4.97767 5.50008 4.33334C5.50008 3.68901 4.97775 3.16667 4.33341 3.16667ZM2.16675 4.33334C2.16675 3.13672 3.1368 2.16667 4.33341 2.16667C5.53003 2.16667 6.50008 3.13672 6.50008 4.33334C6.50008 5.52995 5.53003 6.5 4.33341 6.5C3.1368 6.5 2.16675 5.52995 2.16675 4.33334Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M4.33341 10.5C3.68908 10.5 3.16675 11.0223 3.16675 11.6667C3.16675 12.311 3.68908 12.8333 4.33341 12.8333C4.97775 12.8333 5.50008 12.311 5.50008 11.6667C5.50008 11.0223 4.97775 10.5 4.33341 10.5ZM2.16675 11.6667C2.16675 10.4701 3.1368 9.5 4.33341 9.5C5.53003 9.5 6.50008 10.4701 6.50008 11.6667C6.50008 12.8633 5.53003 13.8333 4.33341 13.8333C3.1368 13.8333 2.16675 12.8633 2.16675 11.6667Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M6.83341 4.33334C6.83341 4.0572 7.05727 3.83334 7.33341 3.83334H8.00008C8.54726 3.83334 9.08907 3.94111 9.59459 4.15051C10.1001 4.3599 10.5594 4.66682 10.9464 5.05373C11.3333 5.44064 11.6402 5.89997 11.8496 6.40549C12.059 6.91101 12.1667 7.45283 12.1667 8V8.66667C12.1667 8.94281 11.9429 9.16667 11.6667 9.16667C11.3906 9.16667 11.1667 8.94281 11.1667 8.66667V8C11.1667 7.58415 11.0848 7.17237 10.9257 6.78817C10.7666 6.40398 10.5333 6.05489 10.2393 5.76083C9.9452 5.46678 9.59611 5.23353 9.21191 5.07439C8.82772 4.91525 8.41593 4.83334 8.00008 4.83334H7.33341C7.05727 4.83334 6.83341 4.60948 6.83341 4.33334Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M9.50008 10.6667C9.50008 10.0223 10.0224 9.5 10.6667 9.5H12.6667C13.3111 9.5 13.8334 10.0223 13.8334 10.6667V12.6667C13.8334 13.311 13.3111 13.8333 12.6667 13.8333H10.6667C10.0224 13.8333 9.50008 13.311 9.50008 12.6667V10.6667ZM10.6667 10.5C10.5747 10.5 10.5001 10.5746 10.5001 10.6667V12.6667C10.5001 12.7587 10.5747 12.8333 10.6667 12.8333H12.6667C12.7588 12.8333 12.8334 12.7587 12.8334 12.6667V10.6667C12.8334 10.5746 12.7588 10.5 12.6667 10.5H10.6667Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M4.33341 6.83334C4.60956 6.83334 4.83341 7.0572 4.83341 7.33334L4.83341 8.66667C4.83341 8.94281 4.60956 9.16667 4.33341 9.16667C4.05727 9.16667 3.83341 8.94281 3.83341 8.66667L3.83341 7.33334C3.83341 7.0572 4.05727 6.83334 4.33341 6.83334Z\"\n        fill=\"currentColor\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_3334_76304\">\n        <rect width=\"16\" height=\"16\" fill=\"white\" />\n      </clipPath>\n    </defs>\n  </svg>\n`;\nexport const PageIcon = html`<svg\n  width=\"16\"\n  height=\"16\"\n  viewBox=\"0 0 16 16\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_3334_79048)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      fill=\"currentColor\"\n      d=\"M2.16675 3.99999C2.16675 2.98747 2.98756 2.16666 4.00008 2.16666H9.33342C9.60956 2.16666 9.83342 2.39051 9.83342 2.66666C9.83342 2.9428 9.60956 3.16666 9.33342 3.16666H4.00008C3.53984 3.16666 3.16675 3.53975 3.16675 3.99999V13.3333C3.16675 13.6095 2.94289 13.8333 2.66675 13.8333C2.39061 13.8333 2.16675 13.6095 2.16675 13.3333V3.99999Z\"\n    />\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      fill=\"currentColor\"\n      d=\"M13.8334 12C13.8334 13.0125 13.0126 13.8333 12.0001 13.8333H6.66675C6.39061 13.8333 6.16675 13.6095 6.16675 13.3333C6.16675 13.0572 6.39061 12.8333 6.66675 12.8333L12.0001 12.8333C12.4603 12.8333 12.8334 12.4602 12.8334 12L12.8334 2.66666C12.8334 2.39051 13.0573 2.16666 13.3334 2.16666C13.6096 2.16666 13.8334 2.39051 13.8334 2.66666L13.8334 12Z\"\n    />\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      fill=\"currentColor\"\n      d=\"M5.50008 5.99999C5.50008 5.35566 6.02242 4.83332 6.66675 4.83332H9.33342C9.97775 4.83332 10.5001 5.35566 10.5001 5.99999V7.33332C10.5001 7.97765 9.97775 8.49999 9.33342 8.49999H6.66675C6.02242 8.49999 5.50008 7.97765 5.50008 7.33332V5.99999ZM6.66675 5.83332C6.5747 5.83332 6.50008 5.90794 6.50008 5.99999V7.33332C6.50008 7.42537 6.5747 7.49999 6.66675 7.49999H9.33342C9.42546 7.49999 9.50008 7.42537 9.50008 7.33332V5.99999C9.50008 5.90794 9.42546 5.83332 9.33342 5.83332H6.66675Z\"\n    />\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      fill=\"currentColor\"\n      d=\"M5.50008 10.6667C5.50008 10.3905 5.72394 10.1667 6.00008 10.1667H10.0001C10.2762 10.1667 10.5001 10.3905 10.5001 10.6667C10.5001 10.9428 10.2762 11.1667 10.0001 11.1667H6.00008C5.72394 11.1667 5.50008 10.9428 5.50008 10.6667Z\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_3334_79048\">\n      <rect width=\"16\" height=\"16\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg>`;\n\nexport const RefreshIcon = html`\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g clip-path=\"url(#clip0_3409_77646)\">\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M4.70834 12C4.70834 7.97292 7.97293 4.70833 12 4.70833C13.8671 4.70833 15.5717 5.41092 16.8613 6.56516L16.8633 6.56695L18.0417 7.63079V5.33333C18.0417 4.98815 18.3215 4.70833 18.6667 4.70833C19.0119 4.70833 19.2917 4.98815 19.2917 5.33333V9.03704C19.2917 9.38221 19.0119 9.66204 18.6667 9.66204H14.963C14.6178 9.66204 14.338 9.38221 14.338 9.03704C14.338 8.69186 14.6178 8.41204 14.963 8.41204H17.0417L16.0276 7.49658C16.0273 7.49628 16.027 7.49599 16.0266 7.49569C14.9575 6.53917 13.5473 5.95833 12 5.95833C8.66329 5.95833 5.95834 8.66328 5.95834 12C5.95834 15.3367 8.66329 18.0417 12 18.0417C14.8745 18.0417 17.2815 16.0336 17.892 13.3432C17.9684 13.0066 18.3032 12.7956 18.6398 12.872C18.9764 12.9484 19.1874 13.2832 19.111 13.6198C18.3741 16.8671 15.471 19.2917 12 19.2917C7.97293 19.2917 4.70834 16.0271 4.70834 12Z\"\n        fill=\"currentColor\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_3409_77646\">\n        <rect width=\"20\" height=\"20\" fill=\"white\" transform=\"translate(2 2)\" />\n      </clipPath>\n    </defs>\n  </svg>\n`;\n\nexport const DeleteIcon = html`\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g clip-path=\"url(#clip0_3409_77647)\">\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M11.3166 3.87493C11.3513 3.87497 11.3864 3.875 11.422 3.875H12.578C12.6136 3.875 12.6487 3.87497 12.6834 3.87493C13.2704 3.87439 13.7306 3.87396 14.1375 4.03401C14.4945 4.17443 14.8106 4.40223 15.0567 4.69654C15.3372 5.032 15.4824 5.46866 15.6674 6.02568C15.6784 6.05861 15.6895 6.09197 15.7007 6.12575L15.7838 6.375H18.6667C19.0119 6.375 19.2917 6.65482 19.2917 7C19.2917 7.34518 19.0119 7.625 18.6667 7.625H17.625V15.5268C17.625 16.2041 17.625 16.7505 17.5889 17.1929C17.5517 17.6484 17.473 18.0485 17.2844 18.4187C16.9848 19.0067 16.5067 19.4848 15.9187 19.7844C15.5485 19.973 15.1484 20.0516 14.6929 20.0889C14.2505 20.125 13.7041 20.125 13.0268 20.125H10.9732C10.2959 20.125 9.74954 20.125 9.30712 20.0889C8.85159 20.0516 8.45147 19.973 8.08129 19.7844C7.49328 19.4848 7.01522 19.0067 6.71561 18.4187C6.527 18.0485 6.44836 17.6484 6.41115 17.1929C6.375 16.7505 6.375 16.2041 6.37501 15.5268L6.37501 7.625H5.33334C4.98817 7.625 4.70834 7.34518 4.70834 7C4.70834 6.65482 4.98817 6.375 5.33334 6.375H8.2162L8.29929 6.12575C8.31055 6.09197 8.32163 6.05861 8.33257 6.02568C8.51767 5.46866 8.66277 5.032 8.9433 4.69654C9.18942 4.40224 9.50548 4.17443 9.86251 4.03401C10.2695 3.87396 10.7296 3.87439 11.3166 3.87493ZM8.65226 7.625C8.66195 7.62522 8.67162 7.62522 8.68127 7.625H15.3188C15.3284 7.62522 15.3381 7.62522 15.3478 7.625H16.375V15.5C16.375 16.2104 16.3745 16.7056 16.343 17.0911C16.3121 17.4693 16.2545 17.6866 16.1706 17.8512C15.9909 18.204 15.704 18.4909 15.3512 18.6706C15.1866 18.7545 14.9693 18.8121 14.5911 18.843C14.2056 18.8745 13.7104 18.875 13 18.875H11C10.2896 18.875 9.79444 18.8745 9.40891 18.843C9.03068 18.8121 8.81338 18.7545 8.64878 18.6706C8.29597 18.4909 8.00914 18.204 7.82937 17.8512C7.74551 17.6866 7.6879 17.4693 7.657 17.0911C7.6255 16.7056 7.62501 16.2104 7.62501 15.5V7.625H8.65226ZM14.466 6.375H9.53401C9.73142 5.78788 9.8018 5.61848 9.9022 5.49843C10.0141 5.36465 10.1577 5.2611 10.32 5.19728C10.4771 5.1355 10.6776 5.125 11.422 5.125H12.578C13.3225 5.125 13.5229 5.1355 13.68 5.19728C13.8423 5.2611 13.986 5.36465 14.0978 5.49843C14.1982 5.61848 14.2686 5.78788 14.466 6.375ZM10.3333 9.70833C10.6785 9.70833 10.9583 9.98815 10.9583 10.3333V16.1667C10.9583 16.5118 10.6785 16.7917 10.3333 16.7917C9.98817 16.7917 9.70834 16.5118 9.70834 16.1667V10.3333C9.70834 9.98815 9.98817 9.70833 10.3333 9.70833ZM13.6667 9.70833C14.0119 9.70833 14.2917 9.98815 14.2917 10.3333V16.1667C14.2917 16.5118 14.0119 16.7917 13.6667 16.7917C13.3215 16.7917 13.0417 16.5118 13.0417 16.1667V10.3333C13.0417 9.98815 13.3215 9.70833 13.6667 9.70833Z\"\n        fill=\"currentColor\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_3409_77647\">\n        <rect width=\"20\" height=\"20\" fill=\"white\" transform=\"translate(2 2)\" />\n      </clipPath>\n    </defs>\n  </svg>\n`;\n\nexport const EditIcon = html`\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g clip-path=\"url(#clip0_3409_77641)\">\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M15.245 6.43527L14.543 7.16176L16.8382 9.45697L17.5647 8.755C18.2018 8.11415 18.2006 7.07817 17.5612 6.43876C16.9218 5.79935 15.8859 5.79819 15.245 6.43527ZM15.9392 10.3257L13.6743 8.06082L7.13833 14.8251L6.2655 17.7345L9.17493 16.8617L15.9392 10.3257ZM14.3576 5.55488C15.4863 4.42615 17.3164 4.42615 18.4451 5.55488C19.5738 6.68361 19.5738 8.51364 18.4451 9.64238L18.4375 9.64996L9.93429 17.8661C9.86252 17.9355 9.77518 17.9866 9.67959 18.0153L5.51292 19.2653C5.29269 19.3314 5.05397 19.2712 4.89139 19.1086C4.7288 18.946 4.66862 18.7073 4.73469 18.4871L5.98469 14.3204C6.01337 14.2248 6.06452 14.1375 6.13387 14.0657L14.3576 5.55488Z\"\n        fill=\"currentColor\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_3409_77641\">\n        <rect width=\"20\" height=\"20\" fill=\"white\" transform=\"translate(2 2)\" />\n      </clipPath>\n    </defs>\n  </svg>\n`;\n\nexport const LinkIcon = html`\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g clip-path=\"url(#clip0_3409_77679)\">\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M12.7019 5.83896C14.2094 4.33145 16.6535 4.33145 18.161 5.83896C19.6685 7.34646 19.6685 9.79061 18.161 11.2981L16.4453 13.0138C16.2012 13.2579 15.8055 13.2579 15.5614 13.0138C15.3173 12.7698 15.3173 12.374 15.5614 12.13L17.2771 10.4142C18.2965 9.39488 18.2965 7.74219 17.2771 6.72284C16.2578 5.70349 14.6051 5.70349 13.5857 6.72284L11.2981 9.01048C10.2788 10.0298 10.2788 11.6825 11.2981 12.7019C11.4581 12.8619 11.633 12.9963 11.818 13.1055C12.1152 13.281 12.2138 13.6643 12.0383 13.9615C11.8628 14.2587 11.4795 14.3573 11.1823 14.1818C10.9076 14.0196 10.6492 13.8207 10.4142 13.5858C8.90671 12.0782 8.90671 9.6341 10.4142 8.1266L12.7019 5.83896ZM11.9617 10.0385C12.1372 9.74129 12.5204 9.64265 12.8177 9.81819C13.0924 9.98043 13.3508 10.1793 13.5857 10.4142C15.0932 11.9217 15.0932 14.3659 13.5857 15.8734L11.2981 18.161C9.7906 19.6685 7.34645 19.6685 5.83894 18.161C4.33144 16.6535 4.33144 14.2094 5.83894 12.7019L7.55467 10.9861C7.79875 10.7421 8.19448 10.7421 8.43855 10.9861C8.68263 11.2302 8.68263 11.6259 8.43855 11.87L6.72283 13.5858C5.70348 14.6051 5.70348 16.2578 6.72283 17.2771C7.74218 18.2965 9.39487 18.2965 10.4142 17.2771L12.7019 14.9895C13.7212 13.9702 13.7212 12.3175 12.7019 11.2981C12.5418 11.1381 12.367 11.0037 12.182 10.8945C11.8848 10.719 11.7861 10.3357 11.9617 10.0385Z\"\n        fill=\"currentColor\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_3409_77679\">\n        <rect width=\"20\" height=\"20\" fill=\"white\" transform=\"translate(2 2)\" />\n      </clipPath>\n    </defs>\n  </svg>\n`;\n\nexport const CopyIcon = html`\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g clip-path=\"url(#clip0_3409_77644)\">\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M11.308 4.70833H16.0254C16.4705 4.70832 16.842 4.70832 17.1456 4.73312C17.4621 4.75898 17.7594 4.81491 18.0404 4.95811C18.4716 5.17782 18.8222 5.5284 19.0419 5.9596C19.1851 6.24066 19.241 6.53787 19.2669 6.85444C19.2917 7.15797 19.2917 7.5295 19.2917 7.97462V12.692C19.2917 13.1372 19.2917 13.5087 19.2669 13.8122C19.241 14.1288 19.1851 14.426 19.0419 14.7071C18.8222 15.1383 18.4716 15.4888 18.0404 15.7086C17.7594 15.8518 17.4621 15.9077 17.1456 15.9336C16.842 15.9584 16.4705 15.9583 16.0254 15.9583H15.9583V16.0254C15.9584 16.4705 15.9584 16.842 15.9336 17.1456C15.9077 17.4621 15.8518 17.7593 15.7086 18.0404C15.4889 18.4716 15.1383 18.8222 14.7071 19.0419C14.426 19.1851 14.1288 19.241 13.8122 19.2669C13.5087 19.2917 13.1372 19.2917 12.6921 19.2917H7.97463C7.52951 19.2917 7.15798 19.2917 6.85445 19.2669C6.53788 19.241 6.24067 19.1851 5.95962 19.0419C5.52841 18.8222 5.17783 18.4716 4.95812 18.0404C4.81492 17.7593 4.75899 17.4621 4.73313 17.1456C4.70833 16.842 4.70833 16.4705 4.70834 16.0254V11.308C4.70833 10.8628 4.70833 10.4913 4.73313 10.1878C4.75899 9.8712 4.81492 9.57399 4.95812 9.29294C5.17783 8.86173 5.52841 8.51115 5.95962 8.29144C6.24067 8.14824 6.53788 8.09231 6.85445 8.06645C7.15798 8.04165 7.52952 8.04166 7.97465 8.04167L8.04168 8.04167L8.04168 7.97464C8.04167 7.52951 8.04166 7.15797 8.06646 6.85444C8.09233 6.53787 8.14825 6.24066 8.29145 5.9596C8.51116 5.5284 8.86174 5.17782 9.29295 4.95811C9.574 4.81491 9.87122 4.75898 10.1878 4.73312C10.4913 4.70832 10.8629 4.70832 11.308 4.70833ZM8.04168 9.29167H8.00001C7.52299 9.29167 7.20281 9.29215 6.95624 9.3123C6.71697 9.33185 6.60257 9.36675 6.5271 9.4052C6.3311 9.50507 6.17175 9.66442 6.07188 9.86043C6.03343 9.93589 5.99852 10.0503 5.97898 10.2896C5.95883 10.5361 5.95834 10.8563 5.95834 11.3333V16C5.95834 16.477 5.95883 16.7972 5.97898 17.0438C5.99852 17.283 6.03343 17.3974 6.07188 17.4729C6.17175 17.6689 6.3311 17.8283 6.5271 17.9281C6.60257 17.9666 6.71697 18.0015 6.95624 18.021C7.20281 18.0412 7.52299 18.0417 8.00001 18.0417H12.6667C13.1437 18.0417 13.4639 18.0412 13.7104 18.021C13.9497 18.0015 14.0641 17.9666 14.1396 17.9281C14.3356 17.8283 14.4949 17.6689 14.5948 17.4729C14.6333 17.3974 14.6682 17.283 14.6877 17.0438C14.7079 16.7972 14.7083 16.477 14.7083 16V15.9583H11.308C10.8628 15.9583 10.4913 15.9584 10.1878 15.9336C9.87122 15.9077 9.574 15.8518 9.29295 15.7086C8.86174 15.4888 8.51116 15.1383 8.29145 14.7071C8.14825 14.426 8.09233 14.1288 8.06646 13.8122C8.04166 13.5087 8.04167 13.1372 8.04168 12.692L8.04168 9.29167ZM11.3333 14.7083C10.8563 14.7083 10.5361 14.7078 10.2896 14.6877C10.0503 14.6682 9.93591 14.6333 9.86044 14.5948C9.66444 14.4949 9.50508 14.3356 9.40521 14.1396C9.36676 14.0641 9.33186 13.9497 9.31231 13.7104C9.29216 13.4639 9.29168 13.1437 9.29168 12.6667V8C9.29168 7.52298 9.29216 7.2028 9.31231 6.95623C9.33186 6.71696 9.36676 6.60256 9.40521 6.52709C9.50508 6.33109 9.66444 6.17174 9.86044 6.07187C9.93591 6.03342 10.0503 5.99851 10.2896 5.97896C10.5361 5.95882 10.8563 5.95833 11.3333 5.95833H16C16.477 5.95833 16.7972 5.95882 17.0438 5.97896C17.2831 5.99851 17.3975 6.03342 17.4729 6.07187C17.6689 6.17174 17.8283 6.33109 17.9281 6.52709C17.9666 6.60256 18.0015 6.71696 18.021 6.95623C18.0412 7.2028 18.0417 7.52298 18.0417 8V12.6667C18.0417 13.1437 18.0412 13.4639 18.021 13.7104C18.0015 13.9497 17.9666 14.0641 17.9281 14.1396C17.8283 14.3356 17.6689 14.4949 17.4729 14.5948C17.3975 14.6333 17.2831 14.6682 17.0438 14.6877C16.7972 14.7078 16.477 14.7083 16 14.7083H11.3333Z\"\n        fill=\"currentColor\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_3409_77644\">\n        <rect width=\"20\" height=\"20\" fill=\"white\" transform=\"translate(2 2)\" />\n      </clipPath>\n    </defs>\n  </svg>\n`;\n\nexport const CaptionIcon = html`\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g clip-path=\"url(#clip0_3409_77683)\">\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M4.70831 6.16666C4.70831 5.36125 5.36123 4.70833 6.16665 4.70833H9.49998C10.3054 4.70833 10.9583 5.36125 10.9583 6.16666V9.49999C10.9583 10.3054 10.3054 10.9583 9.49998 10.9583H6.16665C5.36123 10.9583 4.70831 10.3054 4.70831 9.49999V6.16666ZM6.16665 5.95833C6.05159 5.95833 5.95831 6.0516 5.95831 6.16666V9.49999C5.95831 9.61505 6.05159 9.70833 6.16665 9.70833H9.49998C9.61504 9.70833 9.70831 9.61505 9.70831 9.49999V6.16666C9.70831 6.0516 9.61504 5.95833 9.49998 5.95833H6.16665Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M4.70831 18.6667C4.70831 18.3215 4.98814 18.0417 5.33331 18.0417L15.3333 18.0417C15.6785 18.0417 15.9583 18.3215 15.9583 18.6667C15.9583 19.0118 15.6785 19.2917 15.3333 19.2917L5.33331 19.2917C4.98813 19.2917 4.70831 19.0118 4.70831 18.6667Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M4.70831 14.5C4.70831 14.1548 4.98814 13.875 5.33331 13.875L18.6666 13.875C19.0118 13.875 19.2916 14.1548 19.2916 14.5C19.2916 14.8452 19.0118 15.125 18.6666 15.125L5.33331 15.125C4.98813 15.125 4.70831 14.8452 4.70831 14.5Z\"\n        fill=\"currentColor\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_3409_77683\">\n        <rect width=\"20\" height=\"20\" fill=\"white\" transform=\"translate(2 2)\" />\n      </clipPath>\n    </defs>\n  </svg>\n`;\n\nexport const DuplicateIcon = html`\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g clip-path=\"url(#clip0_3409_77645)\">\n      <path\n        d=\"M11.375 9.5C11.375 9.84518 11.6548 10.125 12 10.125H12.9911L8.22474 14.8914C7.98066 15.1355 7.98066 15.5312 8.22474 15.7753C8.46881 16.0194 8.86454 16.0194 9.10862 15.7753L13.875 11.0089V12C13.875 12.3452 14.1548 12.625 14.5 12.625C14.8452 12.625 15.125 12.3452 15.125 12V9.58333C15.125 9.56886 15.1246 9.5545 15.1237 9.54024C15.1348 9.36716 15.0742 9.19034 14.942 9.05806C14.8097 8.92578 14.6328 8.86519 14.4598 8.87629C14.4455 8.87543 14.4311 8.875 14.4167 8.875H12C11.6548 8.875 11.375 9.15482 11.375 9.5Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M16.0254 4.70833H11.308C10.8629 4.70832 10.4913 4.70832 10.1878 4.73312C9.87122 4.75898 9.574 4.81491 9.29295 4.95811C8.86174 5.17782 8.51116 5.5284 8.29145 5.9596C8.14825 6.24066 8.09233 6.53787 8.06646 6.85444C8.04166 7.15797 8.04167 7.5295 8.04168 7.97463L8.04168 8.04167L7.97465 8.04167C7.52953 8.04166 7.15798 8.04165 6.85445 8.06645C6.53788 8.09231 6.24067 8.14824 5.95962 8.29144C5.52841 8.51115 5.17783 8.86173 4.95812 9.29294C4.81492 9.57399 4.75899 9.8712 4.73313 10.1878C4.70833 10.4913 4.70834 10.8628 4.70834 11.308V16.0254C4.70834 16.4705 4.70833 16.842 4.73313 17.1456C4.75899 17.4621 4.81492 17.7593 4.95812 18.0404C5.17783 18.4716 5.52841 18.8222 5.95962 19.0419C6.24067 19.1851 6.53788 19.241 6.85445 19.2669C7.15798 19.2917 7.52951 19.2917 7.97463 19.2917H12.6921C13.1372 19.2917 13.5087 19.2917 13.8122 19.2669C14.1288 19.241 14.426 19.1851 14.7071 19.0419C15.1383 18.8222 15.4889 18.4716 15.7086 18.0404C15.8518 17.7593 15.9077 17.4621 15.9336 17.1456C15.9584 16.842 15.9584 16.4705 15.9583 16.0254V15.9583H16.0254C16.4705 15.9583 16.8421 15.9583 17.1456 15.9335C17.4621 15.9077 17.7594 15.8518 18.0404 15.7086C18.4716 15.4888 18.8222 15.1383 19.0419 14.7071C19.1851 14.426 19.241 14.1288 19.2669 13.8122C19.2917 13.5087 19.2917 13.1372 19.2917 12.692V7.97462C19.2917 7.5295 19.2917 7.15797 19.2669 6.85444C19.241 6.53787 19.1851 6.24066 19.0419 5.9596C18.8222 5.5284 18.4716 5.17782 18.0404 4.95811C17.7594 4.81491 17.4621 4.75898 17.1456 4.73312C16.842 4.70832 16.4705 4.70832 16.0254 4.70833ZM8.04168 11.1667V9.29167H8.00001C7.52299 9.29167 7.20281 9.29215 6.95624 9.3123C6.71697 9.33185 6.60257 9.36675 6.5271 9.4052C6.3311 9.50507 6.17175 9.66442 6.07188 9.86043C6.03343 9.93589 5.99852 10.0503 5.97898 10.2896C5.95883 10.5361 5.95834 10.8563 5.95834 11.3333V16C5.95834 16.477 5.95883 16.7972 5.97898 17.0438C5.99852 17.283 6.03343 17.3974 6.07188 17.4729C6.17175 17.6689 6.3311 17.8283 6.5271 17.9281C6.60257 17.9666 6.71697 18.0015 6.95624 18.021C7.20281 18.0412 7.52299 18.0417 8.00001 18.0417H12.6667C13.1437 18.0417 13.4639 18.0412 13.7104 18.021C13.9497 18.0015 14.0641 17.9666 14.1396 17.9281C14.3356 17.8283 14.4949 17.6689 14.5948 17.4729C14.6333 17.3974 14.6682 17.283 14.6877 17.0438C14.7079 16.7972 14.7083 16.477 14.7083 16V15.9583H12.8333C12.4882 15.9583 12.2083 15.6785 12.2083 15.3333C12.2083 14.9882 12.4882 14.7083 12.8333 14.7083H16C16.477 14.7083 16.7972 14.7078 17.0438 14.6877C17.283 14.6682 17.3974 14.6333 17.4729 14.5948C17.6689 14.4949 17.8283 14.3356 17.9281 14.1396C17.9666 14.0641 18.0015 13.9497 18.021 13.7104C18.0412 13.4639 18.0417 13.1437 18.0417 12.6667V8C18.0417 7.52298 18.0412 7.2028 18.021 6.95623C18.0015 6.71696 17.9666 6.60256 17.9281 6.52709C17.8283 6.33109 17.6689 6.17174 17.4729 6.07187C17.3974 6.03342 17.283 5.99851 17.0438 5.97896C16.7972 5.95882 16.477 5.95833 16 5.95833H11.3333C10.8563 5.95833 10.5361 5.95882 10.2896 5.97896C10.0503 5.99851 9.9359 6.03342 9.86044 6.07187C9.66444 6.17174 9.50508 6.33109 9.40521 6.52709C9.36676 6.60256 9.33186 6.71696 9.31231 6.95623C9.29216 7.2028 9.29168 7.52298 9.29168 8V11.1667C9.29168 11.5118 9.01186 11.7917 8.66668 11.7917C8.3215 11.7917 8.04168 11.5118 8.04168 11.1667Z\"\n        fill=\"currentColor\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_3409_77645\">\n        <rect width=\"20\" height=\"20\" fill=\"white\" transform=\"translate(2 2)\" />\n      </clipPath>\n    </defs>\n  </svg>\n`;\n\nexport const CloseIcon = html`\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g clip-path=\"url(#clip0_3409_76820)\">\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M6.34314 6.34314C6.63604 6.05025 7.11091 6.05025 7.4038 6.34314L12 10.9393L16.5962 6.34314C16.8891 6.05025 17.364 6.05025 17.6569 6.34314C17.9497 6.63604 17.9497 7.11091 17.6569 7.4038L13.0607 12L17.6569 16.5962C17.9497 16.8891 17.9497 17.364 17.6569 17.6569C17.364 17.9497 16.8891 17.9497 16.5962 17.6569L12 13.0607L7.4038 17.6569C7.11091 17.9497 6.63604 17.9497 6.34314 17.6569C6.05025 17.364 6.05025 16.8891 6.34314 16.5962L10.9393 12L6.34314 7.4038C6.05025 7.11091 6.05025 6.63604 6.34314 6.34314Z\"\n        fill=\"currentColor\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_3409_76820\">\n        <rect width=\"24\" height=\"24\" fill=\"white\" />\n      </clipPath>\n    </defs>\n  </svg>\n`;\n\nexport const MoreIcon = html`\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g clip-path=\"url(#clip0_3407_76065)\">\n      <path\n        d=\"M12 6.99999C11.5398 6.99999 11.1667 6.6269 11.1667 6.16666C11.1667 5.70642 11.5398 5.33333 12 5.33333C12.4602 5.33333 12.8333 5.70642 12.8333 6.16666C12.8333 6.6269 12.4602 6.99999 12 6.99999Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        d=\"M12 12.8333C11.5398 12.8333 11.1667 12.4602 11.1667 12C11.1667 11.5398 11.5398 11.1667 12 11.1667C12.4602 11.1667 12.8333 11.5398 12.8333 12C12.8333 12.4602 12.4602 12.8333 12 12.8333Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        d=\"M12 18.6667C11.5398 18.6667 11.1667 18.2936 11.1667 17.8333C11.1667 17.3731 11.5398 17 12 17C12.4602 17 12.8333 17.3731 12.8333 17.8333C12.8333 18.2936 12.4602 18.6667 12 18.6667Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M12 5.75001C11.7699 5.75001 11.5833 5.93655 11.5833 6.16667C11.5833 6.39679 11.7699 6.58334 12 6.58334C12.2301 6.58334 12.4167 6.39679 12.4167 6.16667C12.4167 5.93655 12.2301 5.75001 12 5.75001ZM10.75 6.16667C10.75 5.47632 11.3096 4.91667 12 4.91667C12.6904 4.91667 13.25 5.47632 13.25 6.16667C13.25 6.85703 12.6904 7.41667 12 7.41667C11.3096 7.41667 10.75 6.85703 10.75 6.16667ZM12 11.5833C11.7699 11.5833 11.5833 11.7699 11.5833 12C11.5833 12.2301 11.7699 12.4167 12 12.4167C12.2301 12.4167 12.4167 12.2301 12.4167 12C12.4167 11.7699 12.2301 11.5833 12 11.5833ZM10.75 12C10.75 11.3096 11.3096 10.75 12 10.75C12.6904 10.75 13.25 11.3096 13.25 12C13.25 12.6904 12.6904 13.25 12 13.25C11.3096 13.25 10.75 12.6904 10.75 12ZM12 17.4167C11.7699 17.4167 11.5833 17.6032 11.5833 17.8333C11.5833 18.0635 11.7699 18.25 12 18.25C12.2301 18.25 12.4167 18.0635 12.4167 17.8333C12.4167 17.6032 12.2301 17.4167 12 17.4167ZM10.75 17.8333C10.75 17.143 11.3096 16.5833 12 16.5833C12.6904 16.5833 13.25 17.143 13.25 17.8333C13.25 18.5237 12.6904 19.0833 12 19.0833C11.3096 19.0833 10.75 18.5237 10.75 17.8333Z\"\n        fill=\"currentColor\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_3407_76065\">\n        <rect width=\"20\" height=\"20\" fill=\"white\" transform=\"translate(2 2)\" />\n      </clipPath>\n    </defs>\n  </svg>\n`;\n\nexport const LoadingBanner = html`\n  <svg\n    width=\"140\"\n    height=\"96\"\n    viewBox=\"0 0 140 96\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g clip-path=\"url(#clip0_4257_88403)\">\n      <g opacity=\"0.4\">\n        <g clip-path=\"url(#clip1_4257_88403)\">\n          <g clip-path=\"url(#clip2_4257_88403)\">\n            <g opacity=\"0.8\" filter=\"url(#filter0_f_4257_88403)\">\n              <ellipse\n                cx=\"45.5713\"\n                cy=\"61.2938\"\n                rx=\"45.5713\"\n                ry=\"61.2938\"\n                transform=\"matrix(-0.275152 -0.961401 0.994111 -0.108365 23.6692 80.3025)\"\n                fill=\"#C0BFC1\"\n              />\n            </g>\n            <g opacity=\"0.8\" filter=\"url(#filter1_f_4257_88403)\">\n              <ellipse\n                cx=\"49.6555\"\n                cy=\"50.1114\"\n                rx=\"49.6555\"\n                ry=\"50.1114\"\n                transform=\"matrix(-0.517539 -0.855659 0.945307 -0.326182 10.3975 87.9766)\"\n                fill=\"#C0BFC1\"\n              />\n            </g>\n            <g opacity=\"0.8\" filter=\"url(#filter2_f_4257_88403)\">\n              <path\n                d=\"M141.154 3.03247C167.539 22.8936 134.54 99.5878 124.212 92.7915C117.912 88.6456 113.733 60.4772 94.173 45.9086C81.6691 36.5955 56.6586 38.5939 41.1056 37.1878C1.22291 33.5821 114.548 -16.9943 141.154 3.03247Z\"\n                fill=\"#C0BFC1\"\n              />\n            </g>\n            <path\n              d=\"M78.5971 45.1263C77.9794 49.5216 81.121 53.5957 85.6131 54.2271C90.1053 54.8584 94.2481 51.808 94.8658 47.4128C95.4835 43.0175 92.342 38.9434 87.8498 38.312C83.3577 37.6807 79.2149 40.7311 78.5971 45.1263Z\"\n              fill=\"url(#paint0_linear_4257_88403)\"\n            />\n            <path\n              d=\"M120.378 78.3637L119.989 81.1303C119.731 82.9654 119.562 84.15 119.36 85.0413C119.166 85.8959 118.999 86.1992 118.895 86.3451C118.499 86.9002 117.932 87.3171 117.277 87.5363C117.105 87.5938 116.76 87.6677 115.867 87.6141C114.934 87.5582 113.723 87.3905 111.847 87.1268L80.6109 82.7369C78.735 82.4733 77.524 82.3006 76.6125 82.0973C75.7385 81.9024 75.4276 81.7365 75.278 81.6337C74.7087 81.2424 74.2794 80.6856 74.0516 80.0428C73.9917 79.8739 73.9142 79.5361 73.9635 78.6612C74.0149 77.7488 74.1789 76.5635 74.4369 74.7283L75.6584 66.0369C75.8058 65.9369 75.9505 65.8411 76.0924 65.7498C77.1899 65.0437 78.3629 64.4423 79.7464 64.1873C81.8083 63.8072 83.9443 64.0829 85.8427 64.9742C87.1166 65.5723 88.0991 66.452 88.9822 67.4137C89.5619 68.0451 90.1807 68.8058 90.8604 69.6691L94.5285 66.9912C95.9295 65.9684 97.1371 65.0867 98.1922 64.4415C99.3051 63.761 100.491 63.1868 101.879 62.9626C103.947 62.6286 106.075 62.9506 107.951 63.8817C109.21 64.5065 110.172 65.4058 111.033 66.385C111.033 66.385 117.277 74.3919 120.378 78.3637Z\"\n              fill=\"url(#paint1_linear_4257_88403)\"\n            />\n            <path\n              fill-rule=\"evenodd\"\n              clip-rule=\"evenodd\"\n              d=\"M18.0193 52.2289C18.1346 51.4086 18.8931 50.837 19.7134 50.9523L67.2463 57.6326C68.0667 57.7479 68.6382 58.5064 68.5229 59.3268C68.4076 60.1471 67.6491 60.7187 66.8288 60.6034L19.2959 53.9231C18.4755 53.8078 17.904 53.0493 18.0193 52.2289Z\"\n              fill=\"white\"\n              fill-opacity=\"0.8\"\n            />\n            <path\n              fill-rule=\"evenodd\"\n              clip-rule=\"evenodd\"\n              d=\"M21.5681 26.9771C21.7218 25.8833 22.7332 25.1212 23.827 25.2749L47.5934 28.6151C48.6872 28.7688 49.4493 29.7801 49.2956 30.874C49.1419 31.9678 48.1305 32.7299 47.0367 32.5762L23.2703 29.236C22.1765 29.0823 21.4144 28.0709 21.5681 26.9771Z\"\n              fill=\"white\"\n              fill-opacity=\"0.8\"\n            />\n            <path\n              fill-rule=\"evenodd\"\n              clip-rule=\"evenodd\"\n              d=\"M19.55 41.336C19.6653 40.5156 20.4238 39.9441 21.2442 40.0593L68.7771 46.7397C69.5974 46.8549 70.169 47.6135 70.0537 48.4338C69.9384 49.2542 69.1799 49.8258 68.3595 49.7105L20.8267 43.0301C20.0063 42.9149 19.4347 42.1564 19.55 41.336Z\"\n              fill=\"white\"\n              fill-opacity=\"0.8\"\n            />\n            <path\n              fill-rule=\"evenodd\"\n              clip-rule=\"evenodd\"\n              d=\"M16.4883 63.1219C16.6036 62.3015 17.3621 61.7299 18.1824 61.8452L65.7153 68.5255C66.5357 68.6408 67.1072 69.3993 66.9919 70.2197C66.8766 71.0401 66.1181 71.6116 65.2978 71.4963L17.7649 64.816C16.9445 64.7007 16.373 63.9422 16.4883 63.1219Z\"\n              fill=\"white\"\n              fill-opacity=\"0.8\"\n            />\n            <path\n              fill-rule=\"evenodd\"\n              clip-rule=\"evenodd\"\n              d=\"M15.2358 72.0343C15.3511 71.2139 16.1096 70.6424 16.93 70.7576L64.4628 77.438C65.2832 77.5533 65.8548 78.3118 65.7395 79.1321C65.6242 79.9525 64.8657 80.5241 64.0453 80.4088L16.5125 73.7285C15.6921 73.6132 15.1205 72.8547 15.2358 72.0343Z\"\n              fill=\"white\"\n              fill-opacity=\"0.4\"\n            />\n          </g>\n        </g>\n      </g>\n    </g>\n    <defs>\n      <filter\n        id=\"filter0_f_4257_88403\"\n        x=\"-14.1589\"\n        y=\"-38.4709\"\n        width=\"172.444\"\n        height=\"136.638\"\n        filterUnits=\"userSpaceOnUse\"\n        color-interpolation-filters=\"sRGB\"\n      >\n        <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n        <feBlend\n          mode=\"normal\"\n          in=\"SourceGraphic\"\n          in2=\"BackgroundImageFix\"\n          result=\"shape\"\n        />\n        <feGaussianBlur\n          stdDeviation=\"12\"\n          result=\"effect1_foregroundBlur_4257_88403\"\n        />\n      </filter>\n      <filter\n        id=\"filter1_f_4257_88403\"\n        x=\"-45.8333\"\n        y=\"-40.3932\"\n        width=\"155.805\"\n        height=\"139.072\"\n        filterUnits=\"userSpaceOnUse\"\n        color-interpolation-filters=\"sRGB\"\n      >\n        <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n        <feBlend\n          mode=\"normal\"\n          in=\"SourceGraphic\"\n          in2=\"BackgroundImageFix\"\n          result=\"shape\"\n        />\n        <feGaussianBlur\n          stdDeviation=\"12\"\n          result=\"effect1_foregroundBlur_4257_88403\"\n        />\n      </filter>\n      <filter\n        id=\"filter2_f_4257_88403\"\n        x=\"8.68726\"\n        y=\"-25.6425\"\n        width=\"166.468\"\n        height=\"142.859\"\n        filterUnits=\"userSpaceOnUse\"\n        color-interpolation-filters=\"sRGB\"\n      >\n        <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n        <feBlend\n          mode=\"normal\"\n          in=\"SourceGraphic\"\n          in2=\"BackgroundImageFix\"\n          result=\"shape\"\n        />\n        <feGaussianBlur\n          stdDeviation=\"12\"\n          result=\"effect1_foregroundBlur_4257_88403\"\n        />\n      </filter>\n      <linearGradient\n        id=\"paint0_linear_4257_88403\"\n        x1=\"102.492\"\n        y1=\"40.3698\"\n        x2=\"96.2289\"\n        y2=\"84.9319\"\n        gradientUnits=\"userSpaceOnUse\"\n      >\n        <stop offset=\"0.578125\" stop-color=\"white\" />\n        <stop offset=\"1\" stop-color=\"white\" stop-opacity=\"0\" />\n      </linearGradient>\n      <linearGradient\n        id=\"paint1_linear_4257_88403\"\n        x1=\"102.492\"\n        y1=\"40.3698\"\n        x2=\"96.2289\"\n        y2=\"84.9319\"\n        gradientUnits=\"userSpaceOnUse\"\n      >\n        <stop offset=\"0.578125\" stop-color=\"white\" />\n        <stop offset=\"1\" stop-color=\"white\" stop-opacity=\"0\" />\n      </linearGradient>\n      <clipPath id=\"clip0_4257_88403\">\n        <rect width=\"140\" height=\"96\" fill=\"white\" />\n      </clipPath>\n      <clipPath id=\"clip1_4257_88403\">\n        <rect\n          x=\"11.7563\"\n          y=\"3.38196\"\n          width=\"130\"\n          height=\"88\"\n          rx=\"4\"\n          transform=\"rotate(8 11.7563 3.38196)\"\n          fill=\"white\"\n        />\n      </clipPath>\n      <clipPath id=\"clip2_4257_88403\">\n        <rect\n          width=\"130\"\n          height=\"88\"\n          fill=\"white\"\n          transform=\"translate(11.7563 3.38196) rotate(8)\"\n        />\n      </clipPath>\n    </defs>\n  </svg>\n`;\n\nexport const DarkLoadingBanner = html`\n  <svg\n    width=\"140\"\n    height=\"96\"\n    viewBox=\"0 0 140 96\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g clip-path=\"url(#clip0_4391_90250)\">\n      <g opacity=\"0.4\">\n        <g clip-path=\"url(#clip1_4391_90250)\">\n          <g clip-path=\"url(#clip2_4391_90250)\">\n            <g opacity=\"0.8\" filter=\"url(#filter0_f_4391_90250)\">\n              <ellipse\n                cx=\"45.5713\"\n                cy=\"61.2938\"\n                rx=\"45.5713\"\n                ry=\"61.2938\"\n                transform=\"matrix(-0.275152 -0.961401 0.994111 -0.108365 23.6692 80.3025)\"\n                fill=\"#3E3E3F\"\n              />\n            </g>\n            <g opacity=\"0.8\" filter=\"url(#filter1_f_4391_90250)\">\n              <ellipse\n                cx=\"49.6555\"\n                cy=\"50.1114\"\n                rx=\"49.6555\"\n                ry=\"50.1114\"\n                transform=\"matrix(-0.517539 -0.855659 0.945307 -0.326182 10.3975 87.9766)\"\n                fill=\"#3E3E3F\"\n              />\n            </g>\n            <g opacity=\"0.8\" filter=\"url(#filter2_f_4391_90250)\">\n              <path\n                d=\"M141.154 3.03247C167.539 22.8936 134.54 99.5878 124.212 92.7915C117.912 88.6456 113.733 60.4772 94.173 45.9086C81.6691 36.5955 56.6586 38.5939 41.1056 37.1878C1.22291 33.5821 114.548 -16.9943 141.154 3.03247Z\"\n                fill=\"#3E3E3F\"\n              />\n            </g>\n            <path\n              d=\"M78.5971 45.1263C77.9794 49.5216 81.121 53.5957 85.6131 54.2271C90.1053 54.8584 94.2481 51.808 94.8658 47.4128C95.4835 43.0175 92.342 38.9434 87.8498 38.312C83.3577 37.6807 79.2149 40.7311 78.5971 45.1263Z\"\n              fill=\"url(#paint0_linear_4391_90250)\"\n            />\n            <path\n              d=\"M120.378 78.3637L119.989 81.1303C119.731 82.9654 119.562 84.15 119.36 85.0413C119.166 85.8959 118.999 86.1992 118.895 86.3451C118.499 86.9002 117.932 87.3171 117.277 87.5363C117.105 87.5938 116.76 87.6677 115.867 87.6141C114.934 87.5582 113.723 87.3905 111.847 87.1268L80.6109 82.7369C78.735 82.4733 77.524 82.3006 76.6125 82.0973C75.7385 81.9024 75.4276 81.7365 75.278 81.6337C74.7087 81.2424 74.2794 80.6856 74.0516 80.0428C73.9917 79.8739 73.9142 79.5361 73.9635 78.6612C74.0149 77.7488 74.1789 76.5635 74.4369 74.7283L75.6584 66.0369C75.8058 65.9369 75.9505 65.8411 76.0924 65.7498C77.1899 65.0437 78.3629 64.4423 79.7464 64.1873C81.8083 63.8072 83.9443 64.0829 85.8427 64.9742C87.1166 65.5723 88.0991 66.452 88.9822 67.4137C89.5619 68.0451 90.1807 68.8058 90.8604 69.6691L94.5285 66.9912C95.9295 65.9684 97.1371 65.0867 98.1922 64.4415C99.3051 63.761 100.491 63.1868 101.879 62.9626C103.947 62.6286 106.075 62.9506 107.951 63.8817C109.21 64.5065 110.172 65.4058 111.033 66.385C111.033 66.385 117.277 74.3919 120.378 78.3637Z\"\n              fill=\"url(#paint1_linear_4391_90250)\"\n            />\n            <path\n              fill-rule=\"evenodd\"\n              clip-rule=\"evenodd\"\n              d=\"M18.0193 52.2289C18.1346 51.4086 18.8931 50.837 19.7134 50.9523L67.2463 57.6326C68.0667 57.7479 68.6382 58.5064 68.5229 59.3268C68.4076 60.1471 67.6491 60.7187 66.8288 60.6034L19.2959 53.9231C18.4755 53.8078 17.904 53.0493 18.0193 52.2289Z\"\n              fill=\"white\"\n              fill-opacity=\"0.8\"\n            />\n            <path\n              fill-rule=\"evenodd\"\n              clip-rule=\"evenodd\"\n              d=\"M21.5681 26.9771C21.7218 25.8833 22.7332 25.1212 23.827 25.2749L47.5934 28.6151C48.6872 28.7688 49.4493 29.7801 49.2956 30.874C49.1419 31.9678 48.1305 32.7299 47.0367 32.5762L23.2703 29.236C22.1765 29.0823 21.4144 28.0709 21.5681 26.9771Z\"\n              fill=\"white\"\n              fill-opacity=\"0.8\"\n            />\n            <path\n              fill-rule=\"evenodd\"\n              clip-rule=\"evenodd\"\n              d=\"M19.55 41.336C19.6653 40.5156 20.4238 39.9441 21.2442 40.0593L68.7771 46.7397C69.5974 46.8549 70.169 47.6135 70.0537 48.4338C69.9384 49.2542 69.1799 49.8258 68.3595 49.7105L20.8267 43.0301C20.0063 42.9149 19.4347 42.1564 19.55 41.336Z\"\n              fill=\"white\"\n              fill-opacity=\"0.8\"\n            />\n            <path\n              fill-rule=\"evenodd\"\n              clip-rule=\"evenodd\"\n              d=\"M16.4883 63.1219C16.6036 62.3015 17.3621 61.7299 18.1824 61.8452L65.7153 68.5255C66.5357 68.6408 67.1072 69.3993 66.9919 70.2197C66.8766 71.0401 66.1181 71.6116 65.2978 71.4963L17.7649 64.816C16.9445 64.7007 16.373 63.9422 16.4883 63.1219Z\"\n              fill=\"white\"\n              fill-opacity=\"0.8\"\n            />\n            <path\n              fill-rule=\"evenodd\"\n              clip-rule=\"evenodd\"\n              d=\"M15.2358 72.0344C15.3511 71.214 16.1096 70.6424 16.93 70.7577L64.4628 77.438C65.2832 77.5533 65.8548 78.3118 65.7395 79.1322C65.6242 79.9525 64.8657 80.5241 64.0453 80.4088L16.5125 73.7285C15.6921 73.6132 15.1205 72.8547 15.2358 72.0344Z\"\n              fill=\"white\"\n              fill-opacity=\"0.4\"\n            />\n          </g>\n        </g>\n      </g>\n    </g>\n    <defs>\n      <filter\n        id=\"filter0_f_4391_90250\"\n        x=\"-14.1589\"\n        y=\"-38.4709\"\n        width=\"172.444\"\n        height=\"136.638\"\n        filterUnits=\"userSpaceOnUse\"\n        color-interpolation-filters=\"sRGB\"\n      >\n        <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n        <feBlend\n          mode=\"normal\"\n          in=\"SourceGraphic\"\n          in2=\"BackgroundImageFix\"\n          result=\"shape\"\n        />\n        <feGaussianBlur\n          stdDeviation=\"12\"\n          result=\"effect1_foregroundBlur_4391_90250\"\n        />\n      </filter>\n      <filter\n        id=\"filter1_f_4391_90250\"\n        x=\"-45.8333\"\n        y=\"-40.3932\"\n        width=\"155.805\"\n        height=\"139.072\"\n        filterUnits=\"userSpaceOnUse\"\n        color-interpolation-filters=\"sRGB\"\n      >\n        <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n        <feBlend\n          mode=\"normal\"\n          in=\"SourceGraphic\"\n          in2=\"BackgroundImageFix\"\n          result=\"shape\"\n        />\n        <feGaussianBlur\n          stdDeviation=\"12\"\n          result=\"effect1_foregroundBlur_4391_90250\"\n        />\n      </filter>\n      <filter\n        id=\"filter2_f_4391_90250\"\n        x=\"8.68726\"\n        y=\"-25.6425\"\n        width=\"166.468\"\n        height=\"142.859\"\n        filterUnits=\"userSpaceOnUse\"\n        color-interpolation-filters=\"sRGB\"\n      >\n        <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n        <feBlend\n          mode=\"normal\"\n          in=\"SourceGraphic\"\n          in2=\"BackgroundImageFix\"\n          result=\"shape\"\n        />\n        <feGaussianBlur\n          stdDeviation=\"12\"\n          result=\"effect1_foregroundBlur_4391_90250\"\n        />\n      </filter>\n      <linearGradient\n        id=\"paint0_linear_4391_90250\"\n        x1=\"102.492\"\n        y1=\"40.3698\"\n        x2=\"96.2289\"\n        y2=\"84.9319\"\n        gradientUnits=\"userSpaceOnUse\"\n      >\n        <stop offset=\"0.578125\" stop-color=\"white\" />\n        <stop offset=\"1\" stop-color=\"white\" stop-opacity=\"0\" />\n      </linearGradient>\n      <linearGradient\n        id=\"paint1_linear_4391_90250\"\n        x1=\"102.492\"\n        y1=\"40.3698\"\n        x2=\"96.2289\"\n        y2=\"84.9319\"\n        gradientUnits=\"userSpaceOnUse\"\n      >\n        <stop offset=\"0.578125\" stop-color=\"white\" />\n        <stop offset=\"1\" stop-color=\"white\" stop-opacity=\"0\" />\n      </linearGradient>\n      <clipPath id=\"clip0_4391_90250\">\n        <rect width=\"140\" height=\"96\" fill=\"white\" />\n      </clipPath>\n      <clipPath id=\"clip1_4391_90250\">\n        <rect\n          x=\"11.7563\"\n          y=\"3.38196\"\n          width=\"130\"\n          height=\"88\"\n          rx=\"4\"\n          transform=\"rotate(8 11.7563 3.38196)\"\n          fill=\"white\"\n        />\n      </clipPath>\n      <clipPath id=\"clip2_4391_90250\">\n        <rect\n          width=\"130\"\n          height=\"88\"\n          fill=\"white\"\n          transform=\"translate(11.7563 3.38196) rotate(8)\"\n        />\n      </clipPath>\n    </defs>\n  </svg>\n`;\n", "export var top = 'top';\nexport var bottom = 'bottom';\nexport var right = 'right';\nexport var left = 'left';\nexport var auto = 'auto';\nexport var basePlacements = [top, bottom, right, left];\nexport var start = 'start';\nexport var end = 'end';\nexport var clippingParents = 'clippingParents';\nexport var viewport = 'viewport';\nexport var popper = 'popper';\nexport var reference = 'reference';\nexport var variationPlacements = /*#__PURE__*/basePlacements.reduce(function (acc, placement) {\n  return acc.concat([placement + \"-\" + start, placement + \"-\" + end]);\n}, []);\nexport var placements = /*#__PURE__*/[].concat(basePlacements, [auto]).reduce(function (acc, placement) {\n  return acc.concat([placement, placement + \"-\" + start, placement + \"-\" + end]);\n}, []); // modifiers that need to read the DOM\n\nexport var beforeRead = 'beforeRead';\nexport var read = 'read';\nexport var afterRead = 'afterRead'; // pure-logic modifiers\n\nexport var beforeMain = 'beforeMain';\nexport var main = 'main';\nexport var afterMain = 'afterMain'; // modifier with the purpose to write to the DOM (or write into a framework state)\n\nexport var beforeWrite = 'beforeWrite';\nexport var write = 'write';\nexport var afterWrite = 'afterWrite';\nexport var modifierPhases = [beforeRead, read, afterRead, beforeMain, main, afterMain, beforeWrite, write, afterWrite];", "export default function getNodeName(element) {\n  return element ? (element.nodeName || '').toLowerCase() : null;\n}", "export default function getWindow(node) {\n  if (node == null) {\n    return window;\n  }\n\n  if (node.toString() !== '[object Window]') {\n    var ownerDocument = node.ownerDocument;\n    return ownerDocument ? ownerDocument.defaultView || window : window;\n  }\n\n  return node;\n}", "import getWindow from \"./getWindow.js\";\n\nfunction isElement(node) {\n  var OwnElement = getWindow(node).Element;\n  return node instanceof OwnElement || node instanceof Element;\n}\n\nfunction isHTMLElement(node) {\n  var OwnElement = getWindow(node).HTMLElement;\n  return node instanceof OwnElement || node instanceof HTMLElement;\n}\n\nfunction isShadowRoot(node) {\n  // IE 11 has no ShadowRoot\n  if (typeof ShadowRoot === 'undefined') {\n    return false;\n  }\n\n  var OwnElement = getWindow(node).ShadowRoot;\n  return node instanceof OwnElement || node instanceof ShadowRoot;\n}\n\nexport { isElement, isHTMLElement, isShadowRoot };", "import getNodeName from \"../dom-utils/getNodeName.js\";\nimport { isHTMLElement } from \"../dom-utils/instanceOf.js\"; // This modifier takes the styles prepared by the `computeStyles` modifier\n// and applies them to the HTMLElements such as popper and arrow\n\nfunction applyStyles(_ref) {\n  var state = _ref.state;\n  Object.keys(state.elements).forEach(function (name) {\n    var style = state.styles[name] || {};\n    var attributes = state.attributes[name] || {};\n    var element = state.elements[name]; // arrow is optional + virtual elements\n\n    if (!isHTMLElement(element) || !getNodeName(element)) {\n      return;\n    } // Flow doesn't support to extend this property, but it's the most\n    // effective way to apply styles to an HTMLElement\n    // $FlowFixMe[cannot-write]\n\n\n    Object.assign(element.style, style);\n    Object.keys(attributes).forEach(function (name) {\n      var value = attributes[name];\n\n      if (value === false) {\n        element.removeAttribute(name);\n      } else {\n        element.setAttribute(name, value === true ? '' : value);\n      }\n    });\n  });\n}\n\nfunction effect(_ref2) {\n  var state = _ref2.state;\n  var initialStyles = {\n    popper: {\n      position: state.options.strategy,\n      left: '0',\n      top: '0',\n      margin: '0'\n    },\n    arrow: {\n      position: 'absolute'\n    },\n    reference: {}\n  };\n  Object.assign(state.elements.popper.style, initialStyles.popper);\n  state.styles = initialStyles;\n\n  if (state.elements.arrow) {\n    Object.assign(state.elements.arrow.style, initialStyles.arrow);\n  }\n\n  return function () {\n    Object.keys(state.elements).forEach(function (name) {\n      var element = state.elements[name];\n      var attributes = state.attributes[name] || {};\n      var styleProperties = Object.keys(state.styles.hasOwnProperty(name) ? state.styles[name] : initialStyles[name]); // Set all values to an empty string to unset them\n\n      var style = styleProperties.reduce(function (style, property) {\n        style[property] = '';\n        return style;\n      }, {}); // arrow is optional + virtual elements\n\n      if (!isHTMLElement(element) || !getNodeName(element)) {\n        return;\n      }\n\n      Object.assign(element.style, style);\n      Object.keys(attributes).forEach(function (attribute) {\n        element.removeAttribute(attribute);\n      });\n    });\n  };\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'applyStyles',\n  enabled: true,\n  phase: 'write',\n  fn: applyStyles,\n  effect: effect,\n  requires: ['computeStyles']\n};", "import { auto } from \"../enums.js\";\nexport default function getBasePlacement(placement) {\n  return placement.split('-')[0];\n}", "export var max = Math.max;\nexport var min = Math.min;\nexport var round = Math.round;", "export default function getUAString() {\n  var uaData = navigator.userAgentData;\n\n  if (uaData != null && uaData.brands && Array.isArray(uaData.brands)) {\n    return uaData.brands.map(function (item) {\n      return item.brand + \"/\" + item.version;\n    }).join(' ');\n  }\n\n  return navigator.userAgent;\n}", "import getUAString from \"../utils/userAgent.js\";\nexport default function isLayoutViewport() {\n  return !/^((?!chrome|android).)*safari/i.test(getUAString());\n}", "import { isElement, isHTMLElement } from \"./instanceOf.js\";\nimport { round } from \"../utils/math.js\";\nimport getWindow from \"./getWindow.js\";\nimport isLayoutViewport from \"./isLayoutViewport.js\";\nexport default function getBoundingClientRect(element, includeScale, isFixedStrategy) {\n  if (includeScale === void 0) {\n    includeScale = false;\n  }\n\n  if (isFixedStrategy === void 0) {\n    isFixedStrategy = false;\n  }\n\n  var clientRect = element.getBoundingClientRect();\n  var scaleX = 1;\n  var scaleY = 1;\n\n  if (includeScale && isHTMLElement(element)) {\n    scaleX = element.offsetWidth > 0 ? round(clientRect.width) / element.offsetWidth || 1 : 1;\n    scaleY = element.offsetHeight > 0 ? round(clientRect.height) / element.offsetHeight || 1 : 1;\n  }\n\n  var _ref = isElement(element) ? getWindow(element) : window,\n      visualViewport = _ref.visualViewport;\n\n  var addVisualOffsets = !isLayoutViewport() && isFixedStrategy;\n  var x = (clientRect.left + (addVisualOffsets && visualViewport ? visualViewport.offsetLeft : 0)) / scaleX;\n  var y = (clientRect.top + (addVisualOffsets && visualViewport ? visualViewport.offsetTop : 0)) / scaleY;\n  var width = clientRect.width / scaleX;\n  var height = clientRect.height / scaleY;\n  return {\n    width: width,\n    height: height,\n    top: y,\n    right: x + width,\n    bottom: y + height,\n    left: x,\n    x: x,\n    y: y\n  };\n}", "import getBoundingClientRect from \"./getBoundingClientRect.js\"; // Returns the layout rect of an element relative to its offsetParent. Layout\n// means it doesn't take into account transforms.\n\nexport default function getLayoutRect(element) {\n  var clientRect = getBoundingClientRect(element); // Use the clientRect sizes if it's not been transformed.\n  // Fixes https://github.com/popperjs/popper-core/issues/1223\n\n  var width = element.offsetWidth;\n  var height = element.offsetHeight;\n\n  if (Math.abs(clientRect.width - width) <= 1) {\n    width = clientRect.width;\n  }\n\n  if (Math.abs(clientRect.height - height) <= 1) {\n    height = clientRect.height;\n  }\n\n  return {\n    x: element.offsetLeft,\n    y: element.offsetTop,\n    width: width,\n    height: height\n  };\n}", "import { isShadowRoot } from \"./instanceOf.js\";\nexport default function contains(parent, child) {\n  var rootNode = child.getRootNode && child.getRootNode(); // First, attempt with faster native method\n\n  if (parent.contains(child)) {\n    return true;\n  } // then fallback to custom implementation with Shadow DOM support\n  else if (rootNode && isShadowRoot(rootNode)) {\n      var next = child;\n\n      do {\n        if (next && parent.isSameNode(next)) {\n          return true;\n        } // $FlowFixMe[prop-missing]: need a better way to handle this...\n\n\n        next = next.parentNode || next.host;\n      } while (next);\n    } // Give up, the result is false\n\n\n  return false;\n}", "import getWindow from \"./getWindow.js\";\nexport default function getComputedStyle(element) {\n  return getWindow(element).getComputedStyle(element);\n}", "import getNodeName from \"./getNodeName.js\";\nexport default function isTableElement(element) {\n  return ['table', 'td', 'th'].indexOf(getNodeName(element)) >= 0;\n}", "import { isElement } from \"./instanceOf.js\";\nexport default function getDocumentElement(element) {\n  // $FlowFixMe[incompatible-return]: assume body is always available\n  return ((isElement(element) ? element.ownerDocument : // $FlowFixMe[prop-missing]\n  element.document) || window.document).documentElement;\n}", "import getNodeName from \"./getNodeName.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport { isShadowRoot } from \"./instanceOf.js\";\nexport default function getParentNode(element) {\n  if (getNodeName(element) === 'html') {\n    return element;\n  }\n\n  return (// this is a quicker (but less type safe) way to save quite some bytes from the bundle\n    // $FlowFixMe[incompatible-return]\n    // $FlowFixMe[prop-missing]\n    element.assignedSlot || // step into the shadow DOM of the parent of a slotted node\n    element.parentNode || ( // DOM Element detected\n    isShadowRoot(element) ? element.host : null) || // ShadowRoot detected\n    // $FlowFixMe[incompatible-call]: HTMLElement is a Node\n    getDocumentElement(element) // fallback\n\n  );\n}", "import getWindow from \"./getWindow.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport { isHTMLElement, isShadowRoot } from \"./instanceOf.js\";\nimport isTableElement from \"./isTableElement.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport getUAString from \"../utils/userAgent.js\";\n\nfunction getTrueOffsetParent(element) {\n  if (!isHTMLElement(element) || // https://github.com/popperjs/popper-core/issues/837\n  getComputedStyle(element).position === 'fixed') {\n    return null;\n  }\n\n  return element.offsetParent;\n} // `.offsetParent` reports `null` for fixed elements, while absolute elements\n// return the containing block\n\n\nfunction getContainingBlock(element) {\n  var isFirefox = /firefox/i.test(getUAString());\n  var isIE = /Trident/i.test(getUAString());\n\n  if (isIE && isHTMLElement(element)) {\n    // In IE 9, 10 and 11 fixed elements containing block is always established by the viewport\n    var elementCss = getComputedStyle(element);\n\n    if (elementCss.position === 'fixed') {\n      return null;\n    }\n  }\n\n  var currentNode = getParentNode(element);\n\n  if (isShadowRoot(currentNode)) {\n    currentNode = currentNode.host;\n  }\n\n  while (isHTMLElement(currentNode) && ['html', 'body'].indexOf(getNodeName(currentNode)) < 0) {\n    var css = getComputedStyle(currentNode); // This is non-exhaustive but covers the most common CSS properties that\n    // create a containing block.\n    // https://developer.mozilla.org/en-US/docs/Web/CSS/Containing_block#identifying_the_containing_block\n\n    if (css.transform !== 'none' || css.perspective !== 'none' || css.contain === 'paint' || ['transform', 'perspective'].indexOf(css.willChange) !== -1 || isFirefox && css.willChange === 'filter' || isFirefox && css.filter && css.filter !== 'none') {\n      return currentNode;\n    } else {\n      currentNode = currentNode.parentNode;\n    }\n  }\n\n  return null;\n} // Gets the closest ancestor positioned element. Handles some edge cases,\n// such as table ancestors and cross browser bugs.\n\n\nexport default function getOffsetParent(element) {\n  var window = getWindow(element);\n  var offsetParent = getTrueOffsetParent(element);\n\n  while (offsetParent && isTableElement(offsetParent) && getComputedStyle(offsetParent).position === 'static') {\n    offsetParent = getTrueOffsetParent(offsetParent);\n  }\n\n  if (offsetParent && (getNodeName(offsetParent) === 'html' || getNodeName(offsetParent) === 'body' && getComputedStyle(offsetParent).position === 'static')) {\n    return window;\n  }\n\n  return offsetParent || getContainingBlock(element) || window;\n}", "export default function getMainAxisFromPlacement(placement) {\n  return ['top', 'bottom'].indexOf(placement) >= 0 ? 'x' : 'y';\n}", "import { max as mathMax, min as mathMin } from \"./math.js\";\nexport function within(min, value, max) {\n  return mathMax(min, mathMin(value, max));\n}\nexport function withinMaxClamp(min, value, max) {\n  var v = within(min, value, max);\n  return v > max ? max : v;\n}", "export default function getFreshSideObject() {\n  return {\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0\n  };\n}", "import getFreshSideObject from \"./getFreshSideObject.js\";\nexport default function mergePaddingObject(paddingObject) {\n  return Object.assign({}, getFreshSideObject(), paddingObject);\n}", "export default function expandToHashMap(value, keys) {\n  return keys.reduce(function (hashMap, key) {\n    hashMap[key] = value;\n    return hashMap;\n  }, {});\n}", "import getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getLayoutRect from \"../dom-utils/getLayoutRect.js\";\nimport contains from \"../dom-utils/contains.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport getMainAxisFromPlacement from \"../utils/getMainAxisFromPlacement.js\";\nimport { within } from \"../utils/within.js\";\nimport mergePaddingObject from \"../utils/mergePaddingObject.js\";\nimport expandToHashMap from \"../utils/expandToHashMap.js\";\nimport { left, right, basePlacements, top, bottom } from \"../enums.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar toPaddingObject = function toPaddingObject(padding, state) {\n  padding = typeof padding === 'function' ? padding(Object.assign({}, state.rects, {\n    placement: state.placement\n  })) : padding;\n  return mergePaddingObject(typeof padding !== 'number' ? padding : expandToHashMap(padding, basePlacements));\n};\n\nfunction arrow(_ref) {\n  var _state$modifiersData$;\n\n  var state = _ref.state,\n      name = _ref.name,\n      options = _ref.options;\n  var arrowElement = state.elements.arrow;\n  var popperOffsets = state.modifiersData.popperOffsets;\n  var basePlacement = getBasePlacement(state.placement);\n  var axis = getMainAxisFromPlacement(basePlacement);\n  var isVertical = [left, right].indexOf(basePlacement) >= 0;\n  var len = isVertical ? 'height' : 'width';\n\n  if (!arrowElement || !popperOffsets) {\n    return;\n  }\n\n  var paddingObject = toPaddingObject(options.padding, state);\n  var arrowRect = getLayoutRect(arrowElement);\n  var minProp = axis === 'y' ? top : left;\n  var maxProp = axis === 'y' ? bottom : right;\n  var endDiff = state.rects.reference[len] + state.rects.reference[axis] - popperOffsets[axis] - state.rects.popper[len];\n  var startDiff = popperOffsets[axis] - state.rects.reference[axis];\n  var arrowOffsetParent = getOffsetParent(arrowElement);\n  var clientSize = arrowOffsetParent ? axis === 'y' ? arrowOffsetParent.clientHeight || 0 : arrowOffsetParent.clientWidth || 0 : 0;\n  var centerToReference = endDiff / 2 - startDiff / 2; // Make sure the arrow doesn't overflow the popper if the center point is\n  // outside of the popper bounds\n\n  var min = paddingObject[minProp];\n  var max = clientSize - arrowRect[len] - paddingObject[maxProp];\n  var center = clientSize / 2 - arrowRect[len] / 2 + centerToReference;\n  var offset = within(min, center, max); // Prevents breaking syntax highlighting...\n\n  var axisProp = axis;\n  state.modifiersData[name] = (_state$modifiersData$ = {}, _state$modifiersData$[axisProp] = offset, _state$modifiersData$.centerOffset = offset - center, _state$modifiersData$);\n}\n\nfunction effect(_ref2) {\n  var state = _ref2.state,\n      options = _ref2.options;\n  var _options$element = options.element,\n      arrowElement = _options$element === void 0 ? '[data-popper-arrow]' : _options$element;\n\n  if (arrowElement == null) {\n    return;\n  } // CSS selector\n\n\n  if (typeof arrowElement === 'string') {\n    arrowElement = state.elements.popper.querySelector(arrowElement);\n\n    if (!arrowElement) {\n      return;\n    }\n  }\n\n  if (!contains(state.elements.popper, arrowElement)) {\n    return;\n  }\n\n  state.elements.arrow = arrowElement;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'arrow',\n  enabled: true,\n  phase: 'main',\n  fn: arrow,\n  effect: effect,\n  requires: ['popperOffsets'],\n  requiresIfExists: ['preventOverflow']\n};", "export default function getVariation(placement) {\n  return placement.split('-')[1];\n}", "import { top, left, right, bottom, end } from \"../enums.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport getWindow from \"../dom-utils/getWindow.js\";\nimport getDocumentElement from \"../dom-utils/getDocumentElement.js\";\nimport getComputedStyle from \"../dom-utils/getComputedStyle.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getVariation from \"../utils/getVariation.js\";\nimport { round } from \"../utils/math.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar unsetSides = {\n  top: 'auto',\n  right: 'auto',\n  bottom: 'auto',\n  left: 'auto'\n}; // Round the offsets to the nearest suitable subpixel based on the DPR.\n// Zooming can change the DPR, but it seems to report a value that will\n// cleanly divide the values into the appropriate subpixels.\n\nfunction roundOffsetsByDPR(_ref, win) {\n  var x = _ref.x,\n      y = _ref.y;\n  var dpr = win.devicePixelRatio || 1;\n  return {\n    x: round(x * dpr) / dpr || 0,\n    y: round(y * dpr) / dpr || 0\n  };\n}\n\nexport function mapToStyles(_ref2) {\n  var _Object$assign2;\n\n  var popper = _ref2.popper,\n      popperRect = _ref2.popperRect,\n      placement = _ref2.placement,\n      variation = _ref2.variation,\n      offsets = _ref2.offsets,\n      position = _ref2.position,\n      gpuAcceleration = _ref2.gpuAcceleration,\n      adaptive = _ref2.adaptive,\n      roundOffsets = _ref2.roundOffsets,\n      isFixed = _ref2.isFixed;\n  var _offsets$x = offsets.x,\n      x = _offsets$x === void 0 ? 0 : _offsets$x,\n      _offsets$y = offsets.y,\n      y = _offsets$y === void 0 ? 0 : _offsets$y;\n\n  var _ref3 = typeof roundOffsets === 'function' ? roundOffsets({\n    x: x,\n    y: y\n  }) : {\n    x: x,\n    y: y\n  };\n\n  x = _ref3.x;\n  y = _ref3.y;\n  var hasX = offsets.hasOwnProperty('x');\n  var hasY = offsets.hasOwnProperty('y');\n  var sideX = left;\n  var sideY = top;\n  var win = window;\n\n  if (adaptive) {\n    var offsetParent = getOffsetParent(popper);\n    var heightProp = 'clientHeight';\n    var widthProp = 'clientWidth';\n\n    if (offsetParent === getWindow(popper)) {\n      offsetParent = getDocumentElement(popper);\n\n      if (getComputedStyle(offsetParent).position !== 'static' && position === 'absolute') {\n        heightProp = 'scrollHeight';\n        widthProp = 'scrollWidth';\n      }\n    } // $FlowFixMe[incompatible-cast]: force type refinement, we compare offsetParent with window above, but Flow doesn't detect it\n\n\n    offsetParent = offsetParent;\n\n    if (placement === top || (placement === left || placement === right) && variation === end) {\n      sideY = bottom;\n      var offsetY = isFixed && offsetParent === win && win.visualViewport ? win.visualViewport.height : // $FlowFixMe[prop-missing]\n      offsetParent[heightProp];\n      y -= offsetY - popperRect.height;\n      y *= gpuAcceleration ? 1 : -1;\n    }\n\n    if (placement === left || (placement === top || placement === bottom) && variation === end) {\n      sideX = right;\n      var offsetX = isFixed && offsetParent === win && win.visualViewport ? win.visualViewport.width : // $FlowFixMe[prop-missing]\n      offsetParent[widthProp];\n      x -= offsetX - popperRect.width;\n      x *= gpuAcceleration ? 1 : -1;\n    }\n  }\n\n  var commonStyles = Object.assign({\n    position: position\n  }, adaptive && unsetSides);\n\n  var _ref4 = roundOffsets === true ? roundOffsetsByDPR({\n    x: x,\n    y: y\n  }, getWindow(popper)) : {\n    x: x,\n    y: y\n  };\n\n  x = _ref4.x;\n  y = _ref4.y;\n\n  if (gpuAcceleration) {\n    var _Object$assign;\n\n    return Object.assign({}, commonStyles, (_Object$assign = {}, _Object$assign[sideY] = hasY ? '0' : '', _Object$assign[sideX] = hasX ? '0' : '', _Object$assign.transform = (win.devicePixelRatio || 1) <= 1 ? \"translate(\" + x + \"px, \" + y + \"px)\" : \"translate3d(\" + x + \"px, \" + y + \"px, 0)\", _Object$assign));\n  }\n\n  return Object.assign({}, commonStyles, (_Object$assign2 = {}, _Object$assign2[sideY] = hasY ? y + \"px\" : '', _Object$assign2[sideX] = hasX ? x + \"px\" : '', _Object$assign2.transform = '', _Object$assign2));\n}\n\nfunction computeStyles(_ref5) {\n  var state = _ref5.state,\n      options = _ref5.options;\n  var _options$gpuAccelerat = options.gpuAcceleration,\n      gpuAcceleration = _options$gpuAccelerat === void 0 ? true : _options$gpuAccelerat,\n      _options$adaptive = options.adaptive,\n      adaptive = _options$adaptive === void 0 ? true : _options$adaptive,\n      _options$roundOffsets = options.roundOffsets,\n      roundOffsets = _options$roundOffsets === void 0 ? true : _options$roundOffsets;\n  var commonStyles = {\n    placement: getBasePlacement(state.placement),\n    variation: getVariation(state.placement),\n    popper: state.elements.popper,\n    popperRect: state.rects.popper,\n    gpuAcceleration: gpuAcceleration,\n    isFixed: state.options.strategy === 'fixed'\n  };\n\n  if (state.modifiersData.popperOffsets != null) {\n    state.styles.popper = Object.assign({}, state.styles.popper, mapToStyles(Object.assign({}, commonStyles, {\n      offsets: state.modifiersData.popperOffsets,\n      position: state.options.strategy,\n      adaptive: adaptive,\n      roundOffsets: roundOffsets\n    })));\n  }\n\n  if (state.modifiersData.arrow != null) {\n    state.styles.arrow = Object.assign({}, state.styles.arrow, mapToStyles(Object.assign({}, commonStyles, {\n      offsets: state.modifiersData.arrow,\n      position: 'absolute',\n      adaptive: false,\n      roundOffsets: roundOffsets\n    })));\n  }\n\n  state.attributes.popper = Object.assign({}, state.attributes.popper, {\n    'data-popper-placement': state.placement\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'computeStyles',\n  enabled: true,\n  phase: 'beforeWrite',\n  fn: computeStyles,\n  data: {}\n};", "import getWindow from \"../dom-utils/getWindow.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar passive = {\n  passive: true\n};\n\nfunction effect(_ref) {\n  var state = _ref.state,\n      instance = _ref.instance,\n      options = _ref.options;\n  var _options$scroll = options.scroll,\n      scroll = _options$scroll === void 0 ? true : _options$scroll,\n      _options$resize = options.resize,\n      resize = _options$resize === void 0 ? true : _options$resize;\n  var window = getWindow(state.elements.popper);\n  var scrollParents = [].concat(state.scrollParents.reference, state.scrollParents.popper);\n\n  if (scroll) {\n    scrollParents.forEach(function (scrollParent) {\n      scrollParent.addEventListener('scroll', instance.update, passive);\n    });\n  }\n\n  if (resize) {\n    window.addEventListener('resize', instance.update, passive);\n  }\n\n  return function () {\n    if (scroll) {\n      scrollParents.forEach(function (scrollParent) {\n        scrollParent.removeEventListener('scroll', instance.update, passive);\n      });\n    }\n\n    if (resize) {\n      window.removeEventListener('resize', instance.update, passive);\n    }\n  };\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'eventListeners',\n  enabled: true,\n  phase: 'write',\n  fn: function fn() {},\n  effect: effect,\n  data: {}\n};", "var hash = {\n  left: 'right',\n  right: 'left',\n  bottom: 'top',\n  top: 'bottom'\n};\nexport default function getOppositePlacement(placement) {\n  return placement.replace(/left|right|bottom|top/g, function (matched) {\n    return hash[matched];\n  });\n}", "var hash = {\n  start: 'end',\n  end: 'start'\n};\nexport default function getOppositeVariationPlacement(placement) {\n  return placement.replace(/start|end/g, function (matched) {\n    return hash[matched];\n  });\n}", "import getWindow from \"./getWindow.js\";\nexport default function getWindowScroll(node) {\n  var win = getWindow(node);\n  var scrollLeft = win.pageXOffset;\n  var scrollTop = win.pageYOffset;\n  return {\n    scrollLeft: scrollLeft,\n    scrollTop: scrollTop\n  };\n}", "import getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getWindowScroll from \"./getWindowScroll.js\";\nexport default function getWindowScrollBarX(element) {\n  // If <html> has a CSS width greater than the viewport, then this will be\n  // incorrect for RTL.\n  // Popper 1 is broken in this case and never had a bug report so let's assume\n  // it's not an issue. I don't think anyone ever specifies width on <html>\n  // anyway.\n  // Browsers where the left scrollbar doesn't cause an issue report `0` for\n  // this (e.g. Edge 2019, IE11, Safari)\n  return getBoundingClientRect(getDocumentElement(element)).left + getWindowScroll(element).scrollLeft;\n}", "import getWindow from \"./getWindow.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport isLayoutViewport from \"./isLayoutViewport.js\";\nexport default function getViewportRect(element, strategy) {\n  var win = getWindow(element);\n  var html = getDocumentElement(element);\n  var visualViewport = win.visualViewport;\n  var width = html.clientWidth;\n  var height = html.clientHeight;\n  var x = 0;\n  var y = 0;\n\n  if (visualViewport) {\n    width = visualViewport.width;\n    height = visualViewport.height;\n    var layoutViewport = isLayoutViewport();\n\n    if (layoutViewport || !layoutViewport && strategy === 'fixed') {\n      x = visualViewport.offsetLeft;\n      y = visualViewport.offsetTop;\n    }\n  }\n\n  return {\n    width: width,\n    height: height,\n    x: x + getWindowScrollBarX(element),\n    y: y\n  };\n}", "import getDocumentElement from \"./getDocumentElement.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport getWindowScroll from \"./getWindowScroll.js\";\nimport { max } from \"../utils/math.js\"; // Gets the entire size of the scrollable document area, even extending outside\n// of the `<html>` and `<body>` rect bounds if horizontally scrollable\n\nexport default function getDocumentRect(element) {\n  var _element$ownerDocumen;\n\n  var html = getDocumentElement(element);\n  var winScroll = getWindowScroll(element);\n  var body = (_element$ownerDocumen = element.ownerDocument) == null ? void 0 : _element$ownerDocumen.body;\n  var width = max(html.scrollWidth, html.clientWidth, body ? body.scrollWidth : 0, body ? body.clientWidth : 0);\n  var height = max(html.scrollHeight, html.clientHeight, body ? body.scrollHeight : 0, body ? body.clientHeight : 0);\n  var x = -winScroll.scrollLeft + getWindowScrollBarX(element);\n  var y = -winScroll.scrollTop;\n\n  if (getComputedStyle(body || html).direction === 'rtl') {\n    x += max(html.clientWidth, body ? body.clientWidth : 0) - width;\n  }\n\n  return {\n    width: width,\n    height: height,\n    x: x,\n    y: y\n  };\n}", "import getComputedStyle from \"./getComputedStyle.js\";\nexport default function isScrollParent(element) {\n  // Firefox wants us to check `-x` and `-y` variations as well\n  var _getComputedStyle = getComputedStyle(element),\n      overflow = _getComputedStyle.overflow,\n      overflowX = _getComputedStyle.overflowX,\n      overflowY = _getComputedStyle.overflowY;\n\n  return /auto|scroll|overlay|hidden/.test(overflow + overflowY + overflowX);\n}", "import getParentNode from \"./getParentNode.js\";\nimport isScrollParent from \"./isScrollParent.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nexport default function getScrollParent(node) {\n  if (['html', 'body', '#document'].indexOf(getNodeName(node)) >= 0) {\n    // $FlowFixMe[incompatible-return]: assume body is always available\n    return node.ownerDocument.body;\n  }\n\n  if (isHTMLElement(node) && isScrollParent(node)) {\n    return node;\n  }\n\n  return getScrollParent(getParentNode(node));\n}", "import getScrollParent from \"./getScrollParent.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport getWindow from \"./getWindow.js\";\nimport isScrollParent from \"./isScrollParent.js\";\n/*\ngiven a DOM element, return the list of all scroll parents, up the list of ancesors\nuntil we get to the top window object. This list is what we attach scroll listeners\nto, because if any of these parent elements scroll, we'll need to re-calculate the\nreference element's position.\n*/\n\nexport default function listScrollParents(element, list) {\n  var _element$ownerDocumen;\n\n  if (list === void 0) {\n    list = [];\n  }\n\n  var scrollParent = getScrollParent(element);\n  var isBody = scrollParent === ((_element$ownerDocumen = element.ownerDocument) == null ? void 0 : _element$ownerDocumen.body);\n  var win = getWindow(scrollParent);\n  var target = isBody ? [win].concat(win.visualViewport || [], isScrollParent(scrollParent) ? scrollParent : []) : scrollParent;\n  var updatedList = list.concat(target);\n  return isBody ? updatedList : // $FlowFixMe[incompatible-call]: isBody tells us target will be an HTMLElement here\n  updatedList.concat(listScrollParents(getParentNode(target)));\n}", "export default function rectToClientRect(rect) {\n  return Object.assign({}, rect, {\n    left: rect.x,\n    top: rect.y,\n    right: rect.x + rect.width,\n    bottom: rect.y + rect.height\n  });\n}", "import { viewport } from \"../enums.js\";\nimport getViewportRect from \"./getViewportRect.js\";\nimport getDocumentRect from \"./getDocumentRect.js\";\nimport listScrollParents from \"./listScrollParents.js\";\nimport getOffsetParent from \"./getOffsetParent.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport { isElement, isHTMLElement } from \"./instanceOf.js\";\nimport getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport contains from \"./contains.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport rectToClientRect from \"../utils/rectToClientRect.js\";\nimport { max, min } from \"../utils/math.js\";\n\nfunction getInnerBoundingClientRect(element, strategy) {\n  var rect = getBoundingClientRect(element, false, strategy === 'fixed');\n  rect.top = rect.top + element.clientTop;\n  rect.left = rect.left + element.clientLeft;\n  rect.bottom = rect.top + element.clientHeight;\n  rect.right = rect.left + element.clientWidth;\n  rect.width = element.clientWidth;\n  rect.height = element.clientHeight;\n  rect.x = rect.left;\n  rect.y = rect.top;\n  return rect;\n}\n\nfunction getClientRectFromMixedType(element, clippingParent, strategy) {\n  return clippingParent === viewport ? rectToClientRect(getViewportRect(element, strategy)) : isElement(clippingParent) ? getInnerBoundingClientRect(clippingParent, strategy) : rectToClientRect(getDocumentRect(getDocumentElement(element)));\n} // A \"clipping parent\" is an overflowable container with the characteristic of\n// clipping (or hiding) overflowing elements with a position different from\n// `initial`\n\n\nfunction getClippingParents(element) {\n  var clippingParents = listScrollParents(getParentNode(element));\n  var canEscapeClipping = ['absolute', 'fixed'].indexOf(getComputedStyle(element).position) >= 0;\n  var clipperElement = canEscapeClipping && isHTMLElement(element) ? getOffsetParent(element) : element;\n\n  if (!isElement(clipperElement)) {\n    return [];\n  } // $FlowFixMe[incompatible-return]: https://github.com/facebook/flow/issues/1414\n\n\n  return clippingParents.filter(function (clippingParent) {\n    return isElement(clippingParent) && contains(clippingParent, clipperElement) && getNodeName(clippingParent) !== 'body';\n  });\n} // Gets the maximum area that the element is visible in due to any number of\n// clipping parents\n\n\nexport default function getClippingRect(element, boundary, rootBoundary, strategy) {\n  var mainClippingParents = boundary === 'clippingParents' ? getClippingParents(element) : [].concat(boundary);\n  var clippingParents = [].concat(mainClippingParents, [rootBoundary]);\n  var firstClippingParent = clippingParents[0];\n  var clippingRect = clippingParents.reduce(function (accRect, clippingParent) {\n    var rect = getClientRectFromMixedType(element, clippingParent, strategy);\n    accRect.top = max(rect.top, accRect.top);\n    accRect.right = min(rect.right, accRect.right);\n    accRect.bottom = min(rect.bottom, accRect.bottom);\n    accRect.left = max(rect.left, accRect.left);\n    return accRect;\n  }, getClientRectFromMixedType(element, firstClippingParent, strategy));\n  clippingRect.width = clippingRect.right - clippingRect.left;\n  clippingRect.height = clippingRect.bottom - clippingRect.top;\n  clippingRect.x = clippingRect.left;\n  clippingRect.y = clippingRect.top;\n  return clippingRect;\n}", "import getBasePlacement from \"./getBasePlacement.js\";\nimport getVariation from \"./getVariation.js\";\nimport getMainAxisFromPlacement from \"./getMainAxisFromPlacement.js\";\nimport { top, right, bottom, left, start, end } from \"../enums.js\";\nexport default function computeOffsets(_ref) {\n  var reference = _ref.reference,\n      element = _ref.element,\n      placement = _ref.placement;\n  var basePlacement = placement ? getBasePlacement(placement) : null;\n  var variation = placement ? getVariation(placement) : null;\n  var commonX = reference.x + reference.width / 2 - element.width / 2;\n  var commonY = reference.y + reference.height / 2 - element.height / 2;\n  var offsets;\n\n  switch (basePlacement) {\n    case top:\n      offsets = {\n        x: commonX,\n        y: reference.y - element.height\n      };\n      break;\n\n    case bottom:\n      offsets = {\n        x: commonX,\n        y: reference.y + reference.height\n      };\n      break;\n\n    case right:\n      offsets = {\n        x: reference.x + reference.width,\n        y: commonY\n      };\n      break;\n\n    case left:\n      offsets = {\n        x: reference.x - element.width,\n        y: commonY\n      };\n      break;\n\n    default:\n      offsets = {\n        x: reference.x,\n        y: reference.y\n      };\n  }\n\n  var mainAxis = basePlacement ? getMainAxisFromPlacement(basePlacement) : null;\n\n  if (mainAxis != null) {\n    var len = mainAxis === 'y' ? 'height' : 'width';\n\n    switch (variation) {\n      case start:\n        offsets[mainAxis] = offsets[mainAxis] - (reference[len] / 2 - element[len] / 2);\n        break;\n\n      case end:\n        offsets[mainAxis] = offsets[mainAxis] + (reference[len] / 2 - element[len] / 2);\n        break;\n\n      default:\n    }\n  }\n\n  return offsets;\n}", "import getClippingRect from \"../dom-utils/getClippingRect.js\";\nimport getDocumentElement from \"../dom-utils/getDocumentElement.js\";\nimport getBoundingClientRect from \"../dom-utils/getBoundingClientRect.js\";\nimport computeOffsets from \"./computeOffsets.js\";\nimport rectToClientRect from \"./rectToClientRect.js\";\nimport { clippingParents, reference, popper, bottom, top, right, basePlacements, viewport } from \"../enums.js\";\nimport { isElement } from \"../dom-utils/instanceOf.js\";\nimport mergePaddingObject from \"./mergePaddingObject.js\";\nimport expandToHashMap from \"./expandToHashMap.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport default function detectOverflow(state, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _options = options,\n      _options$placement = _options.placement,\n      placement = _options$placement === void 0 ? state.placement : _options$placement,\n      _options$strategy = _options.strategy,\n      strategy = _options$strategy === void 0 ? state.strategy : _options$strategy,\n      _options$boundary = _options.boundary,\n      boundary = _options$boundary === void 0 ? clippingParents : _options$boundary,\n      _options$rootBoundary = _options.rootBoundary,\n      rootBoundary = _options$rootBoundary === void 0 ? viewport : _options$rootBoundary,\n      _options$elementConte = _options.elementContext,\n      elementContext = _options$elementConte === void 0 ? popper : _options$elementConte,\n      _options$altBoundary = _options.altBoundary,\n      altBoundary = _options$altBoundary === void 0 ? false : _options$altBoundary,\n      _options$padding = _options.padding,\n      padding = _options$padding === void 0 ? 0 : _options$padding;\n  var paddingObject = mergePaddingObject(typeof padding !== 'number' ? padding : expandToHashMap(padding, basePlacements));\n  var altContext = elementContext === popper ? reference : popper;\n  var popperRect = state.rects.popper;\n  var element = state.elements[altBoundary ? altContext : elementContext];\n  var clippingClientRect = getClippingRect(isElement(element) ? element : element.contextElement || getDocumentElement(state.elements.popper), boundary, rootBoundary, strategy);\n  var referenceClientRect = getBoundingClientRect(state.elements.reference);\n  var popperOffsets = computeOffsets({\n    reference: referenceClientRect,\n    element: popperRect,\n    strategy: 'absolute',\n    placement: placement\n  });\n  var popperClientRect = rectToClientRect(Object.assign({}, popperRect, popperOffsets));\n  var elementClientRect = elementContext === popper ? popperClientRect : referenceClientRect; // positive = overflowing the clipping rect\n  // 0 or negative = within the clipping rect\n\n  var overflowOffsets = {\n    top: clippingClientRect.top - elementClientRect.top + paddingObject.top,\n    bottom: elementClientRect.bottom - clippingClientRect.bottom + paddingObject.bottom,\n    left: clippingClientRect.left - elementClientRect.left + paddingObject.left,\n    right: elementClientRect.right - clippingClientRect.right + paddingObject.right\n  };\n  var offsetData = state.modifiersData.offset; // Offsets can be applied only to the popper element\n\n  if (elementContext === popper && offsetData) {\n    var offset = offsetData[placement];\n    Object.keys(overflowOffsets).forEach(function (key) {\n      var multiply = [right, bottom].indexOf(key) >= 0 ? 1 : -1;\n      var axis = [top, bottom].indexOf(key) >= 0 ? 'y' : 'x';\n      overflowOffsets[key] += offset[axis] * multiply;\n    });\n  }\n\n  return overflowOffsets;\n}", "import getVariation from \"./getVariation.js\";\nimport { variationPlacements, basePlacements, placements as allPlacements } from \"../enums.js\";\nimport detectOverflow from \"./detectOverflow.js\";\nimport getBasePlacement from \"./getBasePlacement.js\";\nexport default function computeAutoPlacement(state, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _options = options,\n      placement = _options.placement,\n      boundary = _options.boundary,\n      rootBoundary = _options.rootBoundary,\n      padding = _options.padding,\n      flipVariations = _options.flipVariations,\n      _options$allowedAutoP = _options.allowedAutoPlacements,\n      allowedAutoPlacements = _options$allowedAutoP === void 0 ? allPlacements : _options$allowedAutoP;\n  var variation = getVariation(placement);\n  var placements = variation ? flipVariations ? variationPlacements : variationPlacements.filter(function (placement) {\n    return getVariation(placement) === variation;\n  }) : basePlacements;\n  var allowedPlacements = placements.filter(function (placement) {\n    return allowedAutoPlacements.indexOf(placement) >= 0;\n  });\n\n  if (allowedPlacements.length === 0) {\n    allowedPlacements = placements;\n  } // $FlowFixMe[incompatible-type]: Flow seems to have problems with two array unions...\n\n\n  var overflows = allowedPlacements.reduce(function (acc, placement) {\n    acc[placement] = detectOverflow(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      padding: padding\n    })[getBasePlacement(placement)];\n    return acc;\n  }, {});\n  return Object.keys(overflows).sort(function (a, b) {\n    return overflows[a] - overflows[b];\n  });\n}", "import getOppositePlacement from \"../utils/getOppositePlacement.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getOppositeVariationPlacement from \"../utils/getOppositeVariationPlacement.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\nimport computeAutoPlacement from \"../utils/computeAutoPlacement.js\";\nimport { bottom, top, start, right, left, auto } from \"../enums.js\";\nimport getVariation from \"../utils/getVariation.js\"; // eslint-disable-next-line import/no-unused-modules\n\nfunction getExpandedFallbackPlacements(placement) {\n  if (getBasePlacement(placement) === auto) {\n    return [];\n  }\n\n  var oppositePlacement = getOppositePlacement(placement);\n  return [getOppositeVariationPlacement(placement), oppositePlacement, getOppositeVariationPlacement(oppositePlacement)];\n}\n\nfunction flip(_ref) {\n  var state = _ref.state,\n      options = _ref.options,\n      name = _ref.name;\n\n  if (state.modifiersData[name]._skip) {\n    return;\n  }\n\n  var _options$mainAxis = options.mainAxis,\n      checkMainAxis = _options$mainAxis === void 0 ? true : _options$mainAxis,\n      _options$altAxis = options.altAxis,\n      checkAltAxis = _options$altAxis === void 0 ? true : _options$altAxis,\n      specifiedFallbackPlacements = options.fallbackPlacements,\n      padding = options.padding,\n      boundary = options.boundary,\n      rootBoundary = options.rootBoundary,\n      altBoundary = options.altBoundary,\n      _options$flipVariatio = options.flipVariations,\n      flipVariations = _options$flipVariatio === void 0 ? true : _options$flipVariatio,\n      allowedAutoPlacements = options.allowedAutoPlacements;\n  var preferredPlacement = state.options.placement;\n  var basePlacement = getBasePlacement(preferredPlacement);\n  var isBasePlacement = basePlacement === preferredPlacement;\n  var fallbackPlacements = specifiedFallbackPlacements || (isBasePlacement || !flipVariations ? [getOppositePlacement(preferredPlacement)] : getExpandedFallbackPlacements(preferredPlacement));\n  var placements = [preferredPlacement].concat(fallbackPlacements).reduce(function (acc, placement) {\n    return acc.concat(getBasePlacement(placement) === auto ? computeAutoPlacement(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      padding: padding,\n      flipVariations: flipVariations,\n      allowedAutoPlacements: allowedAutoPlacements\n    }) : placement);\n  }, []);\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var checksMap = new Map();\n  var makeFallbackChecks = true;\n  var firstFittingPlacement = placements[0];\n\n  for (var i = 0; i < placements.length; i++) {\n    var placement = placements[i];\n\n    var _basePlacement = getBasePlacement(placement);\n\n    var isStartVariation = getVariation(placement) === start;\n    var isVertical = [top, bottom].indexOf(_basePlacement) >= 0;\n    var len = isVertical ? 'width' : 'height';\n    var overflow = detectOverflow(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      altBoundary: altBoundary,\n      padding: padding\n    });\n    var mainVariationSide = isVertical ? isStartVariation ? right : left : isStartVariation ? bottom : top;\n\n    if (referenceRect[len] > popperRect[len]) {\n      mainVariationSide = getOppositePlacement(mainVariationSide);\n    }\n\n    var altVariationSide = getOppositePlacement(mainVariationSide);\n    var checks = [];\n\n    if (checkMainAxis) {\n      checks.push(overflow[_basePlacement] <= 0);\n    }\n\n    if (checkAltAxis) {\n      checks.push(overflow[mainVariationSide] <= 0, overflow[altVariationSide] <= 0);\n    }\n\n    if (checks.every(function (check) {\n      return check;\n    })) {\n      firstFittingPlacement = placement;\n      makeFallbackChecks = false;\n      break;\n    }\n\n    checksMap.set(placement, checks);\n  }\n\n  if (makeFallbackChecks) {\n    // `2` may be desired in some cases  research later\n    var numberOfChecks = flipVariations ? 3 : 1;\n\n    var _loop = function _loop(_i) {\n      var fittingPlacement = placements.find(function (placement) {\n        var checks = checksMap.get(placement);\n\n        if (checks) {\n          return checks.slice(0, _i).every(function (check) {\n            return check;\n          });\n        }\n      });\n\n      if (fittingPlacement) {\n        firstFittingPlacement = fittingPlacement;\n        return \"break\";\n      }\n    };\n\n    for (var _i = numberOfChecks; _i > 0; _i--) {\n      var _ret = _loop(_i);\n\n      if (_ret === \"break\") break;\n    }\n  }\n\n  if (state.placement !== firstFittingPlacement) {\n    state.modifiersData[name]._skip = true;\n    state.placement = firstFittingPlacement;\n    state.reset = true;\n  }\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'flip',\n  enabled: true,\n  phase: 'main',\n  fn: flip,\n  requiresIfExists: ['offset'],\n  data: {\n    _skip: false\n  }\n};", "import { top, bottom, left, right } from \"../enums.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\n\nfunction getSideOffsets(overflow, rect, preventedOffsets) {\n  if (preventedOffsets === void 0) {\n    preventedOffsets = {\n      x: 0,\n      y: 0\n    };\n  }\n\n  return {\n    top: overflow.top - rect.height - preventedOffsets.y,\n    right: overflow.right - rect.width + preventedOffsets.x,\n    bottom: overflow.bottom - rect.height + preventedOffsets.y,\n    left: overflow.left - rect.width - preventedOffsets.x\n  };\n}\n\nfunction isAnySideFullyClipped(overflow) {\n  return [top, right, bottom, left].some(function (side) {\n    return overflow[side] >= 0;\n  });\n}\n\nfunction hide(_ref) {\n  var state = _ref.state,\n      name = _ref.name;\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var preventedOffsets = state.modifiersData.preventOverflow;\n  var referenceOverflow = detectOverflow(state, {\n    elementContext: 'reference'\n  });\n  var popperAltOverflow = detectOverflow(state, {\n    altBoundary: true\n  });\n  var referenceClippingOffsets = getSideOffsets(referenceOverflow, referenceRect);\n  var popperEscapeOffsets = getSideOffsets(popperAltOverflow, popperRect, preventedOffsets);\n  var isReferenceHidden = isAnySideFullyClipped(referenceClippingOffsets);\n  var hasPopperEscaped = isAnySideFullyClipped(popperEscapeOffsets);\n  state.modifiersData[name] = {\n    referenceClippingOffsets: referenceClippingOffsets,\n    popperEscapeOffsets: popperEscapeOffsets,\n    isReferenceHidden: isReferenceHidden,\n    hasPopperEscaped: hasPopperEscaped\n  };\n  state.attributes.popper = Object.assign({}, state.attributes.popper, {\n    'data-popper-reference-hidden': isReferenceHidden,\n    'data-popper-escaped': hasPopperEscaped\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'hide',\n  enabled: true,\n  phase: 'main',\n  requiresIfExists: ['preventOverflow'],\n  fn: hide\n};", "import getBasePlacement from \"../utils/getBasePlacement.js\";\nimport { top, left, right, placements } from \"../enums.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport function distanceAndSkiddingToXY(placement, rects, offset) {\n  var basePlacement = getBasePlacement(placement);\n  var invertDistance = [left, top].indexOf(basePlacement) >= 0 ? -1 : 1;\n\n  var _ref = typeof offset === 'function' ? offset(Object.assign({}, rects, {\n    placement: placement\n  })) : offset,\n      skidding = _ref[0],\n      distance = _ref[1];\n\n  skidding = skidding || 0;\n  distance = (distance || 0) * invertDistance;\n  return [left, right].indexOf(basePlacement) >= 0 ? {\n    x: distance,\n    y: skidding\n  } : {\n    x: skidding,\n    y: distance\n  };\n}\n\nfunction offset(_ref2) {\n  var state = _ref2.state,\n      options = _ref2.options,\n      name = _ref2.name;\n  var _options$offset = options.offset,\n      offset = _options$offset === void 0 ? [0, 0] : _options$offset;\n  var data = placements.reduce(function (acc, placement) {\n    acc[placement] = distanceAndSkiddingToXY(placement, state.rects, offset);\n    return acc;\n  }, {});\n  var _data$state$placement = data[state.placement],\n      x = _data$state$placement.x,\n      y = _data$state$placement.y;\n\n  if (state.modifiersData.popperOffsets != null) {\n    state.modifiersData.popperOffsets.x += x;\n    state.modifiersData.popperOffsets.y += y;\n  }\n\n  state.modifiersData[name] = data;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'offset',\n  enabled: true,\n  phase: 'main',\n  requires: ['popperOffsets'],\n  fn: offset\n};", "import computeOffsets from \"../utils/computeOffsets.js\";\n\nfunction popperOffsets(_ref) {\n  var state = _ref.state,\n      name = _ref.name;\n  // Offsets are the actual position the popper needs to have to be\n  // properly positioned near its reference element\n  // This is the most basic placement, and will be adjusted by\n  // the modifiers in the next step\n  state.modifiersData[name] = computeOffsets({\n    reference: state.rects.reference,\n    element: state.rects.popper,\n    strategy: 'absolute',\n    placement: state.placement\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'popperOffsets',\n  enabled: true,\n  phase: 'read',\n  fn: popperOffsets,\n  data: {}\n};", "export default function getAltAxis(axis) {\n  return axis === 'x' ? 'y' : 'x';\n}", "import { top, left, right, bottom, start } from \"../enums.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getMainAxisFromPlacement from \"../utils/getMainAxisFromPlacement.js\";\nimport getAltAxis from \"../utils/getAltAxis.js\";\nimport { within, withinMaxClamp } from \"../utils/within.js\";\nimport getLayoutRect from \"../dom-utils/getLayoutRect.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\nimport getVariation from \"../utils/getVariation.js\";\nimport getFreshSideObject from \"../utils/getFreshSideObject.js\";\nimport { min as mathMin, max as mathMax } from \"../utils/math.js\";\n\nfunction preventOverflow(_ref) {\n  var state = _ref.state,\n      options = _ref.options,\n      name = _ref.name;\n  var _options$mainAxis = options.mainAxis,\n      checkMainAxis = _options$mainAxis === void 0 ? true : _options$mainAxis,\n      _options$altAxis = options.altAxis,\n      checkAltAxis = _options$altAxis === void 0 ? false : _options$altAxis,\n      boundary = options.boundary,\n      rootBoundary = options.rootBoundary,\n      altBoundary = options.altBoundary,\n      padding = options.padding,\n      _options$tether = options.tether,\n      tether = _options$tether === void 0 ? true : _options$tether,\n      _options$tetherOffset = options.tetherOffset,\n      tetherOffset = _options$tetherOffset === void 0 ? 0 : _options$tetherOffset;\n  var overflow = detectOverflow(state, {\n    boundary: boundary,\n    rootBoundary: rootBoundary,\n    padding: padding,\n    altBoundary: altBoundary\n  });\n  var basePlacement = getBasePlacement(state.placement);\n  var variation = getVariation(state.placement);\n  var isBasePlacement = !variation;\n  var mainAxis = getMainAxisFromPlacement(basePlacement);\n  var altAxis = getAltAxis(mainAxis);\n  var popperOffsets = state.modifiersData.popperOffsets;\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var tetherOffsetValue = typeof tetherOffset === 'function' ? tetherOffset(Object.assign({}, state.rects, {\n    placement: state.placement\n  })) : tetherOffset;\n  var normalizedTetherOffsetValue = typeof tetherOffsetValue === 'number' ? {\n    mainAxis: tetherOffsetValue,\n    altAxis: tetherOffsetValue\n  } : Object.assign({\n    mainAxis: 0,\n    altAxis: 0\n  }, tetherOffsetValue);\n  var offsetModifierState = state.modifiersData.offset ? state.modifiersData.offset[state.placement] : null;\n  var data = {\n    x: 0,\n    y: 0\n  };\n\n  if (!popperOffsets) {\n    return;\n  }\n\n  if (checkMainAxis) {\n    var _offsetModifierState$;\n\n    var mainSide = mainAxis === 'y' ? top : left;\n    var altSide = mainAxis === 'y' ? bottom : right;\n    var len = mainAxis === 'y' ? 'height' : 'width';\n    var offset = popperOffsets[mainAxis];\n    var min = offset + overflow[mainSide];\n    var max = offset - overflow[altSide];\n    var additive = tether ? -popperRect[len] / 2 : 0;\n    var minLen = variation === start ? referenceRect[len] : popperRect[len];\n    var maxLen = variation === start ? -popperRect[len] : -referenceRect[len]; // We need to include the arrow in the calculation so the arrow doesn't go\n    // outside the reference bounds\n\n    var arrowElement = state.elements.arrow;\n    var arrowRect = tether && arrowElement ? getLayoutRect(arrowElement) : {\n      width: 0,\n      height: 0\n    };\n    var arrowPaddingObject = state.modifiersData['arrow#persistent'] ? state.modifiersData['arrow#persistent'].padding : getFreshSideObject();\n    var arrowPaddingMin = arrowPaddingObject[mainSide];\n    var arrowPaddingMax = arrowPaddingObject[altSide]; // If the reference length is smaller than the arrow length, we don't want\n    // to include its full size in the calculation. If the reference is small\n    // and near the edge of a boundary, the popper can overflow even if the\n    // reference is not overflowing as well (e.g. virtual elements with no\n    // width or height)\n\n    var arrowLen = within(0, referenceRect[len], arrowRect[len]);\n    var minOffset = isBasePlacement ? referenceRect[len] / 2 - additive - arrowLen - arrowPaddingMin - normalizedTetherOffsetValue.mainAxis : minLen - arrowLen - arrowPaddingMin - normalizedTetherOffsetValue.mainAxis;\n    var maxOffset = isBasePlacement ? -referenceRect[len] / 2 + additive + arrowLen + arrowPaddingMax + normalizedTetherOffsetValue.mainAxis : maxLen + arrowLen + arrowPaddingMax + normalizedTetherOffsetValue.mainAxis;\n    var arrowOffsetParent = state.elements.arrow && getOffsetParent(state.elements.arrow);\n    var clientOffset = arrowOffsetParent ? mainAxis === 'y' ? arrowOffsetParent.clientTop || 0 : arrowOffsetParent.clientLeft || 0 : 0;\n    var offsetModifierValue = (_offsetModifierState$ = offsetModifierState == null ? void 0 : offsetModifierState[mainAxis]) != null ? _offsetModifierState$ : 0;\n    var tetherMin = offset + minOffset - offsetModifierValue - clientOffset;\n    var tetherMax = offset + maxOffset - offsetModifierValue;\n    var preventedOffset = within(tether ? mathMin(min, tetherMin) : min, offset, tether ? mathMax(max, tetherMax) : max);\n    popperOffsets[mainAxis] = preventedOffset;\n    data[mainAxis] = preventedOffset - offset;\n  }\n\n  if (checkAltAxis) {\n    var _offsetModifierState$2;\n\n    var _mainSide = mainAxis === 'x' ? top : left;\n\n    var _altSide = mainAxis === 'x' ? bottom : right;\n\n    var _offset = popperOffsets[altAxis];\n\n    var _len = altAxis === 'y' ? 'height' : 'width';\n\n    var _min = _offset + overflow[_mainSide];\n\n    var _max = _offset - overflow[_altSide];\n\n    var isOriginSide = [top, left].indexOf(basePlacement) !== -1;\n\n    var _offsetModifierValue = (_offsetModifierState$2 = offsetModifierState == null ? void 0 : offsetModifierState[altAxis]) != null ? _offsetModifierState$2 : 0;\n\n    var _tetherMin = isOriginSide ? _min : _offset - referenceRect[_len] - popperRect[_len] - _offsetModifierValue + normalizedTetherOffsetValue.altAxis;\n\n    var _tetherMax = isOriginSide ? _offset + referenceRect[_len] + popperRect[_len] - _offsetModifierValue - normalizedTetherOffsetValue.altAxis : _max;\n\n    var _preventedOffset = tether && isOriginSide ? withinMaxClamp(_tetherMin, _offset, _tetherMax) : within(tether ? _tetherMin : _min, _offset, tether ? _tetherMax : _max);\n\n    popperOffsets[altAxis] = _preventedOffset;\n    data[altAxis] = _preventedOffset - _offset;\n  }\n\n  state.modifiersData[name] = data;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'preventOverflow',\n  enabled: true,\n  phase: 'main',\n  fn: preventOverflow,\n  requiresIfExists: ['offset']\n};", "export default function getHTMLElementScroll(element) {\n  return {\n    scrollLeft: element.scrollLeft,\n    scrollTop: element.scrollTop\n  };\n}", "import getWindowScroll from \"./getWindowScroll.js\";\nimport getWindow from \"./getWindow.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nimport getHTMLElementScroll from \"./getHTMLElementScroll.js\";\nexport default function getNodeScroll(node) {\n  if (node === getWindow(node) || !isHTMLElement(node)) {\n    return getWindowScroll(node);\n  } else {\n    return getHTMLElementScroll(node);\n  }\n}", "import getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getNodeScroll from \"./getNodeScroll.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport isScrollParent from \"./isScrollParent.js\";\nimport { round } from \"../utils/math.js\";\n\nfunction isElementScaled(element) {\n  var rect = element.getBoundingClientRect();\n  var scaleX = round(rect.width) / element.offsetWidth || 1;\n  var scaleY = round(rect.height) / element.offsetHeight || 1;\n  return scaleX !== 1 || scaleY !== 1;\n} // Returns the composite rect of an element relative to its offsetParent.\n// Composite means it takes into account transforms as well as layout.\n\n\nexport default function getCompositeRect(elementOrVirtualElement, offsetParent, isFixed) {\n  if (isFixed === void 0) {\n    isFixed = false;\n  }\n\n  var isOffsetParentAnElement = isHTMLElement(offsetParent);\n  var offsetParentIsScaled = isHTMLElement(offsetParent) && isElementScaled(offsetParent);\n  var documentElement = getDocumentElement(offsetParent);\n  var rect = getBoundingClientRect(elementOrVirtualElement, offsetParentIsScaled, isFixed);\n  var scroll = {\n    scrollLeft: 0,\n    scrollTop: 0\n  };\n  var offsets = {\n    x: 0,\n    y: 0\n  };\n\n  if (isOffsetParentAnElement || !isOffsetParentAnElement && !isFixed) {\n    if (getNodeName(offsetParent) !== 'body' || // https://github.com/popperjs/popper-core/issues/1078\n    isScrollParent(documentElement)) {\n      scroll = getNodeScroll(offsetParent);\n    }\n\n    if (isHTMLElement(offsetParent)) {\n      offsets = getBoundingClientRect(offsetParent, true);\n      offsets.x += offsetParent.clientLeft;\n      offsets.y += offsetParent.clientTop;\n    } else if (documentElement) {\n      offsets.x = getWindowScrollBarX(documentElement);\n    }\n  }\n\n  return {\n    x: rect.left + scroll.scrollLeft - offsets.x,\n    y: rect.top + scroll.scrollTop - offsets.y,\n    width: rect.width,\n    height: rect.height\n  };\n}", "import { modifierPhases } from \"../enums.js\"; // source: https://stackoverflow.com/questions/49875255\n\nfunction order(modifiers) {\n  var map = new Map();\n  var visited = new Set();\n  var result = [];\n  modifiers.forEach(function (modifier) {\n    map.set(modifier.name, modifier);\n  }); // On visiting object, check for its dependencies and visit them recursively\n\n  function sort(modifier) {\n    visited.add(modifier.name);\n    var requires = [].concat(modifier.requires || [], modifier.requiresIfExists || []);\n    requires.forEach(function (dep) {\n      if (!visited.has(dep)) {\n        var depModifier = map.get(dep);\n\n        if (depModifier) {\n          sort(depModifier);\n        }\n      }\n    });\n    result.push(modifier);\n  }\n\n  modifiers.forEach(function (modifier) {\n    if (!visited.has(modifier.name)) {\n      // check for visited object\n      sort(modifier);\n    }\n  });\n  return result;\n}\n\nexport default function orderModifiers(modifiers) {\n  // order based on dependencies\n  var orderedModifiers = order(modifiers); // order based on phase\n\n  return modifierPhases.reduce(function (acc, phase) {\n    return acc.concat(orderedModifiers.filter(function (modifier) {\n      return modifier.phase === phase;\n    }));\n  }, []);\n}", "export default function debounce(fn) {\n  var pending;\n  return function () {\n    if (!pending) {\n      pending = new Promise(function (resolve) {\n        Promise.resolve().then(function () {\n          pending = undefined;\n          resolve(fn());\n        });\n      });\n    }\n\n    return pending;\n  };\n}", "export default function mergeByName(modifiers) {\n  var merged = modifiers.reduce(function (merged, current) {\n    var existing = merged[current.name];\n    merged[current.name] = existing ? Object.assign({}, existing, current, {\n      options: Object.assign({}, existing.options, current.options),\n      data: Object.assign({}, existing.data, current.data)\n    }) : current;\n    return merged;\n  }, {}); // IE11 does not support Object.values\n\n  return Object.keys(merged).map(function (key) {\n    return merged[key];\n  });\n}", "import getCompositeRect from \"./dom-utils/getCompositeRect.js\";\nimport getLayoutRect from \"./dom-utils/getLayoutRect.js\";\nimport listScrollParents from \"./dom-utils/listScrollParents.js\";\nimport getOffsetParent from \"./dom-utils/getOffsetParent.js\";\nimport orderModifiers from \"./utils/orderModifiers.js\";\nimport debounce from \"./utils/debounce.js\";\nimport mergeByName from \"./utils/mergeByName.js\";\nimport detectOverflow from \"./utils/detectOverflow.js\";\nimport { isElement } from \"./dom-utils/instanceOf.js\";\nvar DEFAULT_OPTIONS = {\n  placement: 'bottom',\n  modifiers: [],\n  strategy: 'absolute'\n};\n\nfunction areValidElements() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  return !args.some(function (element) {\n    return !(element && typeof element.getBoundingClientRect === 'function');\n  });\n}\n\nexport function popperGenerator(generatorOptions) {\n  if (generatorOptions === void 0) {\n    generatorOptions = {};\n  }\n\n  var _generatorOptions = generatorOptions,\n      _generatorOptions$def = _generatorOptions.defaultModifiers,\n      defaultModifiers = _generatorOptions$def === void 0 ? [] : _generatorOptions$def,\n      _generatorOptions$def2 = _generatorOptions.defaultOptions,\n      defaultOptions = _generatorOptions$def2 === void 0 ? DEFAULT_OPTIONS : _generatorOptions$def2;\n  return function createPopper(reference, popper, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var state = {\n      placement: 'bottom',\n      orderedModifiers: [],\n      options: Object.assign({}, DEFAULT_OPTIONS, defaultOptions),\n      modifiersData: {},\n      elements: {\n        reference: reference,\n        popper: popper\n      },\n      attributes: {},\n      styles: {}\n    };\n    var effectCleanupFns = [];\n    var isDestroyed = false;\n    var instance = {\n      state: state,\n      setOptions: function setOptions(setOptionsAction) {\n        var options = typeof setOptionsAction === 'function' ? setOptionsAction(state.options) : setOptionsAction;\n        cleanupModifierEffects();\n        state.options = Object.assign({}, defaultOptions, state.options, options);\n        state.scrollParents = {\n          reference: isElement(reference) ? listScrollParents(reference) : reference.contextElement ? listScrollParents(reference.contextElement) : [],\n          popper: listScrollParents(popper)\n        }; // Orders the modifiers based on their dependencies and `phase`\n        // properties\n\n        var orderedModifiers = orderModifiers(mergeByName([].concat(defaultModifiers, state.options.modifiers))); // Strip out disabled modifiers\n\n        state.orderedModifiers = orderedModifiers.filter(function (m) {\n          return m.enabled;\n        });\n        runModifierEffects();\n        return instance.update();\n      },\n      // Sync update  it will always be executed, even if not necessary. This\n      // is useful for low frequency updates where sync behavior simplifies the\n      // logic.\n      // For high frequency updates (e.g. `resize` and `scroll` events), always\n      // prefer the async Popper#update method\n      forceUpdate: function forceUpdate() {\n        if (isDestroyed) {\n          return;\n        }\n\n        var _state$elements = state.elements,\n            reference = _state$elements.reference,\n            popper = _state$elements.popper; // Don't proceed if `reference` or `popper` are not valid elements\n        // anymore\n\n        if (!areValidElements(reference, popper)) {\n          return;\n        } // Store the reference and popper rects to be read by modifiers\n\n\n        state.rects = {\n          reference: getCompositeRect(reference, getOffsetParent(popper), state.options.strategy === 'fixed'),\n          popper: getLayoutRect(popper)\n        }; // Modifiers have the ability to reset the current update cycle. The\n        // most common use case for this is the `flip` modifier changing the\n        // placement, which then needs to re-run all the modifiers, because the\n        // logic was previously ran for the previous placement and is therefore\n        // stale/incorrect\n\n        state.reset = false;\n        state.placement = state.options.placement; // On each update cycle, the `modifiersData` property for each modifier\n        // is filled with the initial data specified by the modifier. This means\n        // it doesn't persist and is fresh on each update.\n        // To ensure persistent data, use `${name}#persistent`\n\n        state.orderedModifiers.forEach(function (modifier) {\n          return state.modifiersData[modifier.name] = Object.assign({}, modifier.data);\n        });\n\n        for (var index = 0; index < state.orderedModifiers.length; index++) {\n          if (state.reset === true) {\n            state.reset = false;\n            index = -1;\n            continue;\n          }\n\n          var _state$orderedModifie = state.orderedModifiers[index],\n              fn = _state$orderedModifie.fn,\n              _state$orderedModifie2 = _state$orderedModifie.options,\n              _options = _state$orderedModifie2 === void 0 ? {} : _state$orderedModifie2,\n              name = _state$orderedModifie.name;\n\n          if (typeof fn === 'function') {\n            state = fn({\n              state: state,\n              options: _options,\n              name: name,\n              instance: instance\n            }) || state;\n          }\n        }\n      },\n      // Async and optimistically optimized update  it will not be executed if\n      // not necessary (debounced to run at most once-per-tick)\n      update: debounce(function () {\n        return new Promise(function (resolve) {\n          instance.forceUpdate();\n          resolve(state);\n        });\n      }),\n      destroy: function destroy() {\n        cleanupModifierEffects();\n        isDestroyed = true;\n      }\n    };\n\n    if (!areValidElements(reference, popper)) {\n      return instance;\n    }\n\n    instance.setOptions(options).then(function (state) {\n      if (!isDestroyed && options.onFirstUpdate) {\n        options.onFirstUpdate(state);\n      }\n    }); // Modifiers have the ability to execute arbitrary code before the first\n    // update cycle runs. They will be executed in the same order as the update\n    // cycle. This is useful when a modifier adds some persistent data that\n    // other modifiers need to use, but the modifier is run after the dependent\n    // one.\n\n    function runModifierEffects() {\n      state.orderedModifiers.forEach(function (_ref) {\n        var name = _ref.name,\n            _ref$options = _ref.options,\n            options = _ref$options === void 0 ? {} : _ref$options,\n            effect = _ref.effect;\n\n        if (typeof effect === 'function') {\n          var cleanupFn = effect({\n            state: state,\n            name: name,\n            instance: instance,\n            options: options\n          });\n\n          var noopFn = function noopFn() {};\n\n          effectCleanupFns.push(cleanupFn || noopFn);\n        }\n      });\n    }\n\n    function cleanupModifierEffects() {\n      effectCleanupFns.forEach(function (fn) {\n        return fn();\n      });\n      effectCleanupFns = [];\n    }\n\n    return instance;\n  };\n}\nexport var createPopper = /*#__PURE__*/popperGenerator(); // eslint-disable-next-line import/no-unused-modules\n\nexport { detectOverflow };", "import { popperGenerator, detectOverflow } from \"./createPopper.js\";\nimport eventListeners from \"./modifiers/eventListeners.js\";\nimport popperOffsets from \"./modifiers/popperOffsets.js\";\nimport computeStyles from \"./modifiers/computeStyles.js\";\nimport applyStyles from \"./modifiers/applyStyles.js\";\nvar defaultModifiers = [eventListeners, popperOffsets, computeStyles, applyStyles];\nvar createPopper = /*#__PURE__*/popperGenerator({\n  defaultModifiers: defaultModifiers\n}); // eslint-disable-next-line import/no-unused-modules\n\nexport { createPopper, popperGenerator, defaultModifiers, detectOverflow };", "import { popperGenerator, detectOverflow } from \"./createPopper.js\";\nimport eventListeners from \"./modifiers/eventListeners.js\";\nimport popperOffsets from \"./modifiers/popperOffsets.js\";\nimport computeStyles from \"./modifiers/computeStyles.js\";\nimport applyStyles from \"./modifiers/applyStyles.js\";\nimport offset from \"./modifiers/offset.js\";\nimport flip from \"./modifiers/flip.js\";\nimport preventOverflow from \"./modifiers/preventOverflow.js\";\nimport arrow from \"./modifiers/arrow.js\";\nimport hide from \"./modifiers/hide.js\";\nvar defaultModifiers = [eventListeners, popperOffsets, computeStyles, applyStyles, offset, flip, preventOverflow, arrow, hide];\nvar createPopper = /*#__PURE__*/popperGenerator({\n  defaultModifiers: defaultModifiers\n}); // eslint-disable-next-line import/no-unused-modules\n\nexport { createPopper, popperGenerator, defaultModifiers, detectOverflow }; // eslint-disable-next-line import/no-unused-modules\n\nexport { createPopper as createPopperLite } from \"./popper-lite.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport * from \"./modifiers/index.js\";", "import { css, html, type TemplateResult } from 'lit';\n\nlet ToastContainer: HTMLDivElement | null = null;\n\n/**\n * DO NOT USE FOR USER INPUT\n * See https://stackoverflow.com/questions/494143/creating-a-new-dom-element-from-an-html-string-using-built-in-dom-methods-or-pro/35385518#35385518\n */\nconst htmlToElement = <T extends ChildNode>(html: string | TemplateResult) => {\n  const template = document.createElement('template');\n  if (typeof html === 'string') {\n    html = html.trim(); // Never return a text node of whitespace as the result\n    template.innerHTML = html;\n  } else {\n    const { strings, values } = html;\n    const v = [...values, '']; // + last empty part\n    const htmlString = strings.reduce((acc, cur, i) => acc + cur + v[i], '');\n    template.innerHTML = htmlString;\n  }\n  return template.content.firstChild as T;\n};\n\nconst createToastContainer = () => {\n  const styles = css`\n    position: fixed;\n    z-index: 9999;\n    top: 16px;\n    left: 16px;\n    right: 16px;\n    bottom: 78px;\n    pointer-events: none;\n    display: flex;\n    flex-direction: column-reverse;\n    align-items: center;\n  `;\n  const template = html`<div style=\"${styles}\"></div>`;\n  const element = htmlToElement<HTMLDivElement>(template);\n  document.body.appendChild(element);\n  return element;\n};\n\n/**\n * @example\n * ```ts\n * toast('Hello World');\n * ```\n */\nexport const toast = (message: string, duration = 2500) => {\n  if (!ToastContainer) {\n    ToastContainer = createToastContainer();\n  }\n\n  const styles = css`\n    max-width: 480px;\n    text-align: center;\n    font-family: var(--affine-font-family);\n    font-size: var(--affine-font-sm);\n    padding: 6px 12px;\n    margin: 10px 0 0 0;\n    color: var(--affine-white);\n    background: var(--affine-tooltip);\n    box-shadow: var(--affine-float-button-shadow);\n    border-radius: 10px;\n    transition: all 230ms cubic-bezier(0.21, 1.02, 0.73, 1);\n    opacity: 0;\n  `;\n\n  const template = html`<div style=\"${styles}\"></div>`;\n  const element = htmlToElement<HTMLDivElement>(template);\n  // message is not trusted\n  element.textContent = message;\n  ToastContainer.appendChild(element);\n\n  const fadeIn = [\n    {\n      opacity: 0,\n    },\n    { opacity: 1 },\n  ];\n  const options = {\n    duration: 230,\n    easing: 'cubic-bezier(0.21, 1.02, 0.73, 1)',\n    fill: 'forwards' as const,\n  }; // satisfies KeyframeAnimationOptions;\n  element.animate(fadeIn, options);\n\n  setTimeout(async () => {\n    const fadeOut = fadeIn.reverse();\n    const animation = element.animate(fadeOut, options);\n    await animation.finished;\n    element.style.maxHeight = '0';\n    element.style.margin = '0';\n    element.style.padding = '0';\n    element.addEventListener(\n      'transitionend',\n      () => {\n        element.remove();\n      },\n      {\n        once: true,\n      }\n    );\n  }, duration);\n  return element;\n};\n", "export const ZOOM_MAX = 6.0;\nexport const ZOOM_MIN = 0.1;\nexport const ZOOM_STEP = 0.25;\nexport const GRID_SIZE = 3000;\n\nexport interface IBound {\n  x: number;\n  y: number;\n  w: number;\n  h: number;\n}\n\nexport enum StrokeStyle {\n  Solid = 'solid',\n  Dashed = 'dash',\n  None = 'none',\n}\n", "import type { StrokeStyle } from '../../consts.js';\nimport type { SerializedXYWH } from '../../utils/xywh.js';\n\nexport enum ConnectorMode {\n  Straight,\n  Orthogonal,\n}\n\n// x/y is in range of [0,1] relative to element's left-top\n// real x = element.x + element.w * x\n// real y = element.y + element.h * y\nexport interface AttachedElementPosition {\n  x: number;\n  y: number;\n}\n\nexport interface AttachedElement {\n  id: string;\n  position: AttachedElementPosition;\n}\n\nexport interface Controller {\n  x: number;\n  y: number;\n  // If this value is true, it indicates that the point was generated by the user dragging\n  customized?: boolean;\n}\n\nexport interface IConnector {\n  id: string;\n  type: 'connector';\n  xywh: SerializedXYWH;\n  index: string;\n  seed: number;\n\n  mode: ConnectorMode;\n  lineWidth: number;\n  color: string;\n  strokeStyle: StrokeStyle;\n  // https://github.com/rough-stuff/rough/wiki#roughness\n  roughness?: number;\n\n  startElement?: AttachedElement;\n  endElement?: AttachedElement;\n\n  // relative to element x,y.\n  controllers: Controller[];\n}\n", "/**\n * Compute a radius based on the pressure.\n * @param size\n * @param thinning\n * @param pressure\n * @param easing\n * @internal\n */\nexport function getStrokeRadius(\n  size: number,\n  thinning: number,\n  pressure: number,\n  easing: (t: number) => number = t => t\n) {\n  return size * easing(0.5 - thinning * (0.5 - pressure));\n}\n", "/**\n * Negate a vector.\n * @param A\n * @internal\n */\nexport function neg(A: number[]) {\n  return [-A[0], -A[1]];\n}\n\n/**\n * Add vectors.\n * @param A\n * @param B\n * @internal\n */\nexport function add(A: number[], B: number[]) {\n  return [A[0] + B[0], A[1] + B[1]];\n}\n\n/**\n * Subtract vectors.\n * @param A\n * @param B\n * @internal\n */\nexport function sub(A: number[], B: number[]) {\n  return [A[0] - B[0], A[1] - B[1]];\n}\n\n/**\n * Vector multiplication by scalar\n * @param A\n * @param n\n * @internal\n */\nexport function mul(A: number[], n: number) {\n  return [A[0] * n, A[1] * n];\n}\n\n/**\n * Vector division by scalar.\n * @param A\n * @param n\n * @internal\n */\nexport function div(A: number[], n: number) {\n  return [A[0] / n, A[1] / n];\n}\n\n/**\n * Perpendicular rotation of a vector A\n * @param A\n * @internal\n */\nexport function per(A: number[]) {\n  return [A[1], -A[0]];\n}\n\n/**\n * Dot product\n * @param A\n * @param B\n * @internal\n */\nexport function dpr(A: number[], B: number[]) {\n  return A[0] * B[0] + A[1] * B[1];\n}\n\n/**\n * Get whether two vectors are equal.\n * @param A\n * @param B\n * @internal\n */\nexport function isEqual(A: number[], B: number[]) {\n  return A[0] === B[0] && A[1] === B[1];\n}\n\n/**\n * Length of the vector\n * @param A\n * @internal\n */\nexport function len(A: number[]) {\n  return Math.hypot(A[0], A[1]);\n}\n\n/**\n * Length of the vector squared\n * @param A\n * @internal\n */\nexport function len2(A: number[]) {\n  return A[0] * A[0] + A[1] * A[1];\n}\n\n/**\n * Dist length from A to B squared.\n * @param A\n * @param B\n * @internal\n */\nexport function dist2(A: number[], B: number[]) {\n  return len2(sub(A, B));\n}\n\n/**\n * Get normalized / unit vector.\n * @param A\n * @internal\n */\nexport function uni(A: number[]) {\n  return div(A, len(A));\n}\n\n/**\n * Dist length from A to B\n * @param A\n * @param B\n * @internal\n */\nexport function dist(A: number[], B: number[]) {\n  return Math.hypot(A[1] - B[1], A[0] - B[0]);\n}\n\n/**\n * Mean between two vectors or mid vector between two vectors\n * @param A\n * @param B\n * @internal\n */\nexport function med(A: number[], B: number[]) {\n  return mul(add(A, B), 0.5);\n}\n\n/**\n * Rotate a vector around another vector by r (radians)\n * @param A vector\n * @param C center\n * @param r rotation in radians\n * @internal\n */\nexport function rotAround(A: number[], C: number[], r: number) {\n  const s = Math.sin(r);\n  const c = Math.cos(r);\n\n  const px = A[0] - C[0];\n  const py = A[1] - C[1];\n\n  const nx = px * c - py * s;\n  const ny = px * s + py * c;\n\n  return [nx + C[0], ny + C[1]];\n}\n\n/**\n * Interpolate vector A to B with a scalar t\n * @param A\n * @param B\n * @param t scalar\n * @internal\n */\nexport function lrp(A: number[], B: number[], t: number) {\n  return add(A, mul(sub(B, A), t));\n}\n\n/**\n * Project a point A in the direction B by a scalar c\n * @param A\n * @param B\n * @param c\n * @internal\n */\nexport function prj(A: number[], B: number[], c: number) {\n  return add(A, mul(B, c));\n}\n", "import { getStrokeRadius } from './getStrokeRadius.js';\nimport type { StrokeOptions, StrokePoint } from './types.js';\nimport {\n  add,\n  dist2,\n  dpr,\n  lrp,\n  mul,\n  neg,\n  per,\n  prj,\n  rotAround,\n  sub,\n  uni,\n} from './vec.js';\n\nconst { min, PI } = Math;\n\n// This is the rate of change for simulated pressure. It could be an option.\nconst RATE_OF_PRESSURE_CHANGE = 0.275;\n\n// Browser strokes seem to be off if PI is regular, a tiny offset seems to fix it\nconst FIXED_PI = PI + 0.0001;\n\n/**\n * ## getStrokeOutlinePoints\n * @description Get an array of points (as `[x, y]`) representing the outline of a stroke.\n * @param points An array of StrokePoints as returned from `getStrokePoints`.\n * @param options (optional) An object with options.\n * @param options.size\tThe base size (diameter) of the stroke.\n * @param options.thinning The effect of pressure on the stroke's size.\n * @param options.smoothing\tHow much to soften the stroke's edges.\n * @param options.easing\tAn easing function to apply to each point's pressure.\n * @param options.simulatePressure Whether to simulate pressure based on velocity.\n * @param options.start Cap, taper and easing for the start of the line.\n * @param options.end Cap, taper and easing for the end of the line.\n * @param options.last Whether to handle the points as a completed stroke.\n */\nexport function getStrokeOutlinePoints(\n  points: StrokePoint[],\n  options: Partial<StrokeOptions> = {} as Partial<StrokeOptions>\n): number[][] {\n  const {\n    size = 16,\n    smoothing = 0.5,\n    thinning = 0.5,\n    simulatePressure = true,\n    easing = t => t,\n    start = {},\n    end = {},\n    last: isComplete = false,\n  } = options;\n\n  const { cap: capStart = true, easing: taperStartEase = t => t * (2 - t) } =\n    start;\n\n  const { cap: capEnd = true, easing: taperEndEase = t => --t * t * t + 1 } =\n    end;\n\n  // We can't do anything with an empty array or a stroke with negative size.\n  if (points.length === 0 || size <= 0) {\n    return [];\n  }\n\n  // The total length of the line\n  const totalLength = points[points.length - 1].runningLength;\n\n  const taperStart =\n    start.taper === false\n      ? 0\n      : start.taper === true\n      ? Math.max(size, totalLength)\n      : (start.taper as number);\n\n  const taperEnd =\n    end.taper === false\n      ? 0\n      : end.taper === true\n      ? Math.max(size, totalLength)\n      : (end.taper as number);\n\n  // The minimum allowed distance between points (squared)\n  const minDistance = Math.pow(size * smoothing, 2);\n\n  // Our collected left and right points\n  const leftPts: number[][] = [];\n  const rightPts: number[][] = [];\n\n  // Previous pressure (start with average of first five pressures,\n  // in order to prevent fat starts for every line. Drawn lines\n  // almost always start slow!\n  let prevPressure = points.slice(0, 10).reduce((acc, curr) => {\n    let pressure = curr.pressure;\n\n    if (simulatePressure) {\n      // Speed of change - how fast should the the pressure changing?\n      const sp = min(1, curr.distance / size);\n      // Rate of change - how much of a change is there?\n      const rp = min(1, 1 - sp);\n      // Accelerate the pressure\n      pressure = min(1, acc + (rp - acc) * (sp * RATE_OF_PRESSURE_CHANGE));\n    }\n\n    return (acc + pressure) / 2;\n  }, points[0].pressure);\n\n  // The current radius\n  let radius = getStrokeRadius(\n    size,\n    thinning,\n    points[points.length - 1].pressure,\n    easing\n  );\n\n  // The radius of the first saved point\n  let firstRadius: number | undefined = undefined;\n\n  // Previous vector\n  let prevVector = points[0].vector;\n\n  // Previous left and right points\n  let pl = points[0].point;\n  let pr = pl;\n\n  // Temporary left and right points\n  let tl = pl;\n  let tr = pr;\n\n  // Keep track of whether the previous point is a sharp corner\n  // ... so that we don't detect the same corner twice\n  let isPrevPointSharpCorner = false;\n\n  // let short = true\n\n  /*\n    Find the outline's left and right points\n\n    Iterating through the points and populate the rightPts and leftPts arrays,\n    skipping the first and last pointsm, which will get caps later on.\n  */\n\n  for (let i = 0; i < points.length; i++) {\n    let { pressure } = points[i];\n    const { point, vector, distance, runningLength } = points[i];\n\n    // Removes noise from the end of the line\n    if (i < points.length - 1 && totalLength - runningLength < 3) {\n      continue;\n    }\n\n    /*\n      Calculate the radius\n\n      If not thinning, the current point's radius will be half the size; or\n      otherwise, the size will be based on the current (real or simulated)\n      pressure.\n    */\n\n    if (thinning) {\n      if (simulatePressure) {\n        // If we're simulating pressure, then do so based on the distance\n        // between the current point and the previous point, and the size\n        // of the stroke. Otherwise, use the input pressure.\n        const sp = min(1, distance / size);\n        const rp = min(1, 1 - sp);\n        pressure = min(\n          1,\n          prevPressure + (rp - prevPressure) * (sp * RATE_OF_PRESSURE_CHANGE)\n        );\n      }\n\n      radius = getStrokeRadius(size, thinning, pressure, easing);\n    } else {\n      radius = size / 2;\n    }\n\n    if (firstRadius === undefined) {\n      firstRadius = radius;\n    }\n\n    /*\n      Apply tapering\n\n      If the current length is within the taper distance at either the\n      start or the end, calculate the taper strengths. Apply the smaller\n      of the two taper strengths to the radius.\n    */\n\n    const ts =\n      runningLength < taperStart\n        ? taperStartEase(runningLength / taperStart)\n        : 1;\n\n    const te =\n      totalLength - runningLength < taperEnd\n        ? taperEndEase((totalLength - runningLength) / taperEnd)\n        : 1;\n\n    radius = Math.max(0.01, radius * Math.min(ts, te));\n\n    /* Add points to left and right */\n\n    /*\n      Handle sharp corners\n\n      Find the difference (dot product) between the current and next vector.\n      If the next vector is at more than a right angle to the current vector,\n      draw a cap at the current point.\n    */\n\n    const nextVector = (i < points.length - 1 ? points[i + 1] : points[i])\n      .vector;\n    const nextDpr = i < points.length - 1 ? dpr(vector, nextVector) : 1.0;\n    const prevDpr = dpr(vector, prevVector);\n\n    const isPointSharpCorner = prevDpr < 0 && !isPrevPointSharpCorner;\n    const isNextPointSharpCorner = nextDpr !== null && nextDpr < 0;\n\n    if (isPointSharpCorner || isNextPointSharpCorner) {\n      // It's a sharp corner. Draw a rounded cap and move on to the next point\n      // Considering saving these and drawing them later? So that we can avoid\n      // crossing future points.\n\n      const offset = mul(per(prevVector), radius);\n\n      for (let step = 1 / 13, t = 0; t <= 1; t += step) {\n        tl = rotAround(sub(point, offset), point, FIXED_PI * t);\n        leftPts.push(tl);\n\n        tr = rotAround(add(point, offset), point, FIXED_PI * -t);\n        rightPts.push(tr);\n      }\n\n      pl = tl;\n      pr = tr;\n\n      if (isNextPointSharpCorner) {\n        isPrevPointSharpCorner = true;\n      }\n      continue;\n    }\n\n    isPrevPointSharpCorner = false;\n\n    // Handle the last point\n    if (i === points.length - 1) {\n      const offset = mul(per(vector), radius);\n      leftPts.push(sub(point, offset));\n      rightPts.push(add(point, offset));\n      continue;\n    }\n\n    /*\n      Add regular points\n\n      Project points to either side of the current point, using the\n      calculated size as a distance. If a point's distance to the\n      previous point on that side greater than the minimum distance\n      (or if the corner is kinda sharp), add the points to the side's\n      points array.\n    */\n\n    const offset = mul(per(lrp(nextVector, vector, nextDpr)), radius);\n\n    tl = sub(point, offset);\n\n    if (i <= 1 || dist2(pl, tl) > minDistance) {\n      leftPts.push(tl);\n      pl = tl;\n    }\n\n    tr = add(point, offset);\n\n    if (i <= 1 || dist2(pr, tr) > minDistance) {\n      rightPts.push(tr);\n      pr = tr;\n    }\n\n    // Set variables for next iteration\n    prevPressure = pressure;\n    prevVector = vector;\n  }\n\n  /*\n    Drawing caps\n\n    Now that we have our points on either side of the line, we need to\n    draw caps at the start and end. Tapered lines don't have caps, but\n    may have dots for very short lines.\n  */\n\n  const firstPoint = points[0].point.slice(0, 2);\n\n  const lastPoint =\n    points.length > 1\n      ? points[points.length - 1].point.slice(0, 2)\n      : add(points[0].point, [1, 1]);\n\n  const startCap: number[][] = [];\n\n  const endCap: number[][] = [];\n\n  /*\n    Draw a dot for very short or completed strokes\n\n    If the line is too short to gather left or right points and if the line is\n    not tapered on either side, draw a dot. If the line is tapered, then only\n    draw a dot if the line is both very short and complete. If we draw a dot,\n    we can just return those points.\n  */\n\n  if (points.length === 1) {\n    if (!(taperStart || taperEnd) || isComplete) {\n      const start = prj(\n        firstPoint,\n        uni(per(sub(firstPoint, lastPoint))),\n        -(firstRadius || radius)\n      );\n      const dotPts: number[][] = [];\n      for (let step = 1 / 13, t = step; t <= 1; t += step) {\n        dotPts.push(rotAround(start, firstPoint, FIXED_PI * 2 * t));\n      }\n      return dotPts;\n    }\n  } else {\n    /*\n    Draw a start cap\n\n    Unless the line has a tapered start, or unless the line has a tapered end\n    and the line is very short, draw a start cap around the first point. Use\n    the distance between the second left and right point for the cap's radius.\n    Finally remove the first left and right points. :psyduck:\n  */\n\n    if (taperStart || (taperEnd && points.length === 1)) {\n      // The start point is tapered, noop\n    } else if (capStart) {\n      // Draw the round cap - add thirteen points rotating the right point around the start point to the left point\n      for (let step = 1 / 13, t = step; t <= 1; t += step) {\n        const pt = rotAround(rightPts[0], firstPoint, FIXED_PI * t);\n        startCap.push(pt);\n      }\n    } else {\n      // Draw the flat cap - add a point to the left and right of the start point\n      const cornersVector = sub(leftPts[0], rightPts[0]);\n      const offsetA = mul(cornersVector, 0.5);\n      const offsetB = mul(cornersVector, 0.51);\n\n      startCap.push(\n        sub(firstPoint, offsetA),\n        sub(firstPoint, offsetB),\n        add(firstPoint, offsetB),\n        add(firstPoint, offsetA)\n      );\n    }\n\n    /*\n    Draw an end cap\n\n    If the line does not have a tapered end, and unless the line has a tapered\n    start and the line is very short, draw a cap around the last point. Finally,\n    remove the last left and right points. Otherwise, add the last point. Note\n    that This cap is a full-turn-and-a-half: this prevents incorrect caps on\n    sharp end turns.\n  */\n\n    const direction = per(neg(points[points.length - 1].vector));\n\n    if (taperEnd || (taperStart && points.length === 1)) {\n      // Tapered end - push the last point to the line\n      endCap.push(lastPoint);\n    } else if (capEnd) {\n      // Draw the round end cap\n      const start = prj(lastPoint, direction, radius);\n      for (let step = 1 / 29, t = step; t < 1; t += step) {\n        endCap.push(rotAround(start, lastPoint, FIXED_PI * 3 * t));\n      }\n    } else {\n      // Draw the flat end cap\n\n      endCap.push(\n        add(lastPoint, mul(direction, radius)),\n        add(lastPoint, mul(direction, radius * 0.99)),\n        sub(lastPoint, mul(direction, radius * 0.99)),\n        sub(lastPoint, mul(direction, radius))\n      );\n    }\n  }\n\n  /*\n    Return the points in the correct winding order: begin on the left side, then\n    continue around the end cap, then come back along the right side, and finally\n    complete the start cap.\n  */\n\n  return leftPts.concat(endCap, rightPts.reverse(), startCap);\n}\n", "import type { StrokeOptions, StrokePoint } from './types.js';\nimport { add, dist, isEqual, lrp, sub, uni } from './vec.js';\n\n/**\n * ## getStrokePoints\n * @description Get an array of points as objects with an adjusted point, pressure, vector, distance, and runningLength.\n * @param points An array of points (as `[x, y, pressure]` or `{x, y, pressure}`). Pressure is optional in both cases.\n * @param options (optional) An object with options.\n * @param options.size\tThe base size (diameter) of the stroke.\n * @param options.thinning The effect of pressure on the stroke's size.\n * @param options.smoothing\tHow much to soften the stroke's edges.\n * @param options.easing\tAn easing function to apply to each point's pressure.\n * @param options.simulatePressure Whether to simulate pressure based on velocity.\n * @param options.start Cap, taper and easing for the start of the line.\n * @param options.end Cap, taper and easing for the end of the line.\n * @param options.last Whether to handle the points as a completed stroke.\n */\nexport function getStrokePoints<\n  T extends number[],\n  K extends { x: number; y: number; pressure?: number }\n>(points: (T | K)[], options = {} as StrokeOptions): StrokePoint[] {\n  const { streamline = 0.5, size = 16, last: isComplete = false } = options;\n\n  // If we don't have any points, return an empty array.\n  if (points.length === 0) return [];\n\n  // Find the interpolation level between points.\n  const t = 0.15 + (1 - streamline) * 0.85;\n\n  // Whatever the input is, make sure that the points are in number[][].\n  let pts = Array.isArray(points[0])\n    ? (points as T[])\n    : (points as K[]).map(({ x, y, pressure = 0.5 }) => [x, y, pressure]);\n\n  // Add extra points between the two, to help avoid \"dash\" lines\n  // for strokes with tapered start and ends. Don't mutate the\n  // input array!\n  if (pts.length === 2) {\n    const last = pts[1];\n    pts = pts.slice(0, -1);\n    for (let i = 1; i < 5; i++) {\n      pts.push(lrp(pts[0], last, i / 4));\n    }\n  }\n\n  // If there's only one point, add another point at a 1pt offset.\n  // Don't mutate the input array!\n  if (pts.length === 1) {\n    pts = [...pts, [...add(pts[0], [1, 1]), ...pts[0].slice(2)]];\n  }\n\n  // The strokePoints array will hold the points for the stroke.\n  // Start it out with the first point, which needs no adjustment.\n  const strokePoints: StrokePoint[] = [\n    {\n      point: [pts[0][0], pts[0][1]],\n      pressure: pts[0][2] >= 0 ? pts[0][2] : 0.25,\n      vector: [1, 1],\n      distance: 0,\n      runningLength: 0,\n    },\n  ];\n\n  // A flag to see whether we've already reached out minimum length\n  let hasReachedMinimumLength = false;\n\n  // We use the runningLength to keep track of the total distance\n  let runningLength = 0;\n\n  // We're set this to the latest point, so we can use it to calculate\n  // the distance and vector of the next point.\n  let prev = strokePoints[0];\n\n  const max = pts.length - 1;\n\n  // Iterate through all of the points, creating StrokePoints.\n  for (let i = 1; i < pts.length; i++) {\n    const point =\n      isComplete && i === max\n        ? // If we're at the last point, and `options.last` is true,\n          // then add the actual input point.\n          pts[i].slice(0, 2)\n        : // Otherwise, using the t calculated from the streamline\n          // option, interpolate a new point between the previous\n          // point the current point.\n          lrp(prev.point, pts[i], t);\n\n    // If the new point is the same as the previous point, skip ahead.\n    if (isEqual(prev.point, point)) continue;\n\n    // How far is the new point from the previous point?\n    const distance = dist(point, prev.point);\n\n    // Add this distance to the total \"running length\" of the line.\n    runningLength += distance;\n\n    // At the start of the line, we wait until the new point is a\n    // certain distance away from the original point, to avoid noise\n    if (i < max && !hasReachedMinimumLength) {\n      if (runningLength < size) continue;\n      hasReachedMinimumLength = true;\n      // TODO: Backfill the missing points so that tapering works correctly.\n    }\n    // Create a new strokepoint (it will be the new \"previous\" one).\n    prev = {\n      // The adjusted point\n      point,\n      // The input pressure (or .5 if not specified)\n      pressure: pts[i][2] >= 0 ? pts[i][2] : 0.5,\n      // The vector from the current point to the previous point\n      vector: uni(sub(prev.point, point)),\n      // The distance between the current point and the previous point\n      distance,\n      // The total distance so far\n      runningLength,\n    };\n\n    // Push it to the strokePoints array.\n    strokePoints.push(prev);\n  }\n\n  // Set the vector of the first point to be the same as the second point.\n  strokePoints[0].vector = strokePoints[1]?.vector || [0, 0];\n\n  return strokePoints;\n}\n", "import { getStrokeOutlinePoints } from './getStrokeOutlinePoints.js';\nimport { getStrokePoints } from './getStrokePoints.js';\nimport type { StrokeOptions } from './types.js';\n\n/**\n * ## getStroke\n * @description Get an array of points describing a polygon that surrounds the input points.\n * @param points An array of points (as `[x, y, pressure]` or `{x, y, pressure}`). Pressure is optional in both cases.\n * @param options (optional) An object with options.\n * @param options.size\tThe base size (diameter) of the stroke.\n * @param options.thinning The effect of pressure on the stroke's size.\n * @param options.smoothing\tHow much to soften the stroke's edges.\n * @param options.easing\tAn easing function to apply to each point's pressure.\n * @param options.simulatePressure Whether to simulate pressure based on velocity.\n * @param options.start Cap, taper and easing for the start of the line.\n * @param options.end Cap, taper and easing for the end of the line.\n * @param options.last Whether to handle the points as a completed stroke.\n */\n\nexport function getStroke(\n  points: (number[] | { x: number; y: number; pressure?: number })[],\n  options: StrokeOptions = {} as StrokeOptions\n): number[][] {\n  return getStrokeOutlinePoints(getStrokePoints(points, options), options);\n}\n", "import {\n  assertExists,\n  type BaseBlockModel,\n  type Page,\n} from '@blocksuite/store';\nimport type { VEditor, VRange } from '@blocksuite/virgo';\n\nimport {\n  getDefaultPage,\n  getModelByElement,\n  getModelsByRange,\n  getVirgoByModel,\n  isInsidePageTitle,\n} from './query.js';\nimport {\n  focusTitle,\n  getCurrentNativeRange,\n  hasNativeSelection,\n  resetNativeSelection,\n} from './selection.js';\n\n/**\n * The {@link BlockRange} is designed to make consistency between the browser-native range and the block range.\n *\n * It's different from {@link VRange} since the user can select multiple blocks at a time, and {@link VRange} can't handle range cross blocks.\n */\n\n/**\n * Use {@link getCurrentBlockRange} to get current block range.\n *\n * You can use {@link nativeRangeToBlockRange} and {@link blockRangeToNativeRange} convert between native range and block range.\n */\nexport type BlockRange = {\n  /**\n   * 'Native' for native selection, 'Block' for block selection\n   */\n  type: 'Native' | 'Block';\n  /**\n   * Promise the length of models is greater than 0\n   */\n  models: BaseBlockModel[];\n  startOffset: number;\n  endOffset: number;\n  // collapsed is true when models.length === 1 && startOffset === endOffset\n  // collapsed: true;\n};\n\ntype ExtendBlockRange = {\n  type: 'Title';\n  startOffset: number;\n  endOffset: number;\n  /**\n   * Only one model, the page model\n   */\n  models: [BaseBlockModel];\n};\n\nexport function getCurrentBlockRange(page: Page) {\n  // check exist block selection\n  const pageBlock = getDefaultPage(page);\n  if (pageBlock) {\n    const selectedBlocks = pageBlock.selection.state.selectedBlocks;\n    // Add embeds block to fix click image and delete case\n    const selectedEmbeds = pageBlock.selection.state.selectedEmbeds;\n    // Fix order may be wrong\n    const models = [...selectedBlocks, ...selectedEmbeds]\n      .map(element => getModelByElement(element))\n      .filter(Boolean);\n    if (models.length) {\n      return {\n        type: 'Block' as const,\n        startOffset: 0,\n        endOffset: models[models.length - 1].text?.length ?? 0,\n        models,\n      };\n    }\n  }\n  // check exist native selection\n  if (hasNativeSelection()) {\n    const range = getCurrentNativeRange();\n    const blockRange = nativeRangeToBlockRange(range);\n    if (!blockRange) {\n      return null;\n    }\n    return { ...blockRange, nativeRange: range };\n  }\n  return null;\n}\n\nexport function blockRangeToNativeRange(\n  blockRange: BlockRange | ExtendBlockRange\n) {\n  // special case for title\n  if (blockRange.type === 'Title') {\n    const page = blockRange.models[0].page;\n    const pageElement = getDefaultPage(page);\n    if (!pageElement) {\n      // Maybe in edgeless mode\n      return null;\n    }\n    const titleVEditor = pageElement.titleVEditor;\n    const [startNode, startOffset] = titleVEditor.getTextPoint(\n      blockRange.startOffset\n    );\n    const [endNode, endOffset] = titleVEditor.getTextPoint(\n      blockRange.endOffset\n    );\n    const range = new Range();\n    range.setStart(startNode, startOffset);\n    range.setEnd(endNode, endOffset);\n    return range;\n  }\n\n  const models = blockRange.models.filter(model => model.text);\n  if (!models.length) {\n    // BlockRange may be selected embeds, and it don't have text\n    // so we can't convert it to native range\n    return null;\n  }\n  const [startNode, startOffset] = getTextNodeByModel(\n    models[0],\n    blockRange.startOffset\n  );\n  const [endNode, endOffset] = getTextNodeByModel(\n    models[models.length - 1],\n    blockRange.endOffset\n  );\n  const range = new Range();\n  range.setStart(startNode, startOffset);\n  range.setEnd(endNode, endOffset);\n  return range;\n}\n\nexport function nativeRangeToBlockRange(range: Range) {\n  // TODO check range is in page\n  const models = getModelsByRange(range);\n  if (!models.length) {\n    // NativeRange may be outside of the editor\n    // so we can't convert it to block range\n    return null;\n  }\n\n  const startVRange = getVRangeByNode(range.startContainer);\n  const endVRange = getVRangeByNode(range.endContainer);\n  if (!startVRange || !endVRange) {\n    return null;\n  }\n\n  const startOffset = startVRange.index;\n  const endOffset = endVRange.index + endVRange.length;\n  return {\n    type: 'Native',\n    startOffset,\n    endOffset,\n    models,\n  } satisfies BlockRange;\n}\n\n/**\n * Sometimes, the block in the block range is updated, we need to update the block range manually.\n *\n * Note: it will mutate the `blockRange` object.\n */\nexport function updateBlockRange(\n  blockRange: BlockRange,\n  oldModel: BaseBlockModel,\n  newModel: BaseBlockModel\n) {\n  blockRange.models = blockRange.models.map(model =>\n    model === oldModel ? newModel : model\n  );\n  return blockRange;\n}\n\n/**\n * Restore the block selection.\n * See also {@link resetNativeSelection}\n */\nexport function restoreSelection(blockRange: BlockRange | ExtendBlockRange) {\n  if (!blockRange.models.length) {\n    throw new Error(\"Can't restore selection, blockRange.models is empty\");\n  }\n\n  const page = blockRange.models[0].page;\n  const defaultPageBlock = getDefaultPage(page);\n\n  if (blockRange.type === 'Native') {\n    const range = blockRangeToNativeRange(blockRange);\n    resetNativeSelection(range);\n\n    // In the default mode\n    if (defaultPageBlock) {\n      defaultPageBlock.selection.state.clearBlockSelection();\n      defaultPageBlock.selection.state.type = 'native';\n    }\n    return;\n  }\n\n  if (blockRange.type === 'Block') {\n    // In the default mode\n    if (defaultPageBlock) {\n      defaultPageBlock.selection.state.type = 'block';\n      defaultPageBlock.selection.refreshSelectedBlocksRectsByModels(\n        blockRange.models\n      );\n    }\n    // Try clean native selection\n    resetNativeSelection(null);\n    (document.activeElement as HTMLElement).blur();\n    return;\n  }\n\n  // In the default mode\n  if (defaultPageBlock && blockRange.type === 'Title') {\n    focusTitle(\n      page,\n      blockRange.startOffset,\n      blockRange.endOffset - blockRange.startOffset\n    );\n    return;\n  }\n  throw new Error('Invalid block range type: ' + blockRange.type);\n}\n\n/**\n * Get the block range that includes the title range.\n *\n * In most cases, we should use {@link getCurrentBlockRange} to get current block range.\n *\n */\nexport function getExtendBlockRange(\n  page: Page\n): BlockRange | ExtendBlockRange | null {\n  const basicBlockRange = getCurrentBlockRange(page);\n  if (basicBlockRange) return basicBlockRange;\n  // Check title\n  if (!hasNativeSelection()) {\n    return null;\n  }\n  const range = getCurrentNativeRange();\n  const isTitleRange =\n    isInsidePageTitle(range.startContainer) &&\n    isInsidePageTitle(range.endContainer);\n  if (isTitleRange) {\n    const pageModel = page.root;\n    assertExists(pageModel);\n    return {\n      type: 'Title' as const,\n      startOffset: range.startOffset,\n      endOffset: range.endOffset,\n      models: [pageModel],\n    };\n  }\n\n  return null;\n}\n\nexport function getVRangeByNode(node: Node): VRange | null {\n  if (!node.parentElement) return null;\n\n  const virgoElement: VEditor['_rootElement'] =\n    node.parentElement.closest('[data-virgo-root=\"true\"]') ||\n    (node instanceof HTMLElement\n      ? node.querySelector('[data-virgo-root=\"true\"]')\n      : null);\n  const vEditor = virgoElement?.virgoEditor;\n  if (!vEditor) return null;\n\n  return vEditor.getVRange();\n}\n\n/**\n * Get the specific text node and offset by the selected block.\n * The reverse implementation of {@link getVRangeByNode}\n * See also {@link getVRangeByNode}\n *\n * ```ts\n * const [startNode, startOffset] = getTextNodeBySelectedBlock(startModel, startOffset);\n * const [endNode, endOffset] = getTextNodeBySelectedBlock(endModel, endOffset);\n *\n * const range = new Range();\n * range.setStart(startNode, startOffset);\n * range.setEnd(endNode, endOffset);\n *\n * const selection = window.getSelection();\n * selection.removeAllRanges();\n * selection.addRange(range);\n * ```\n */\nexport function getTextNodeByModel(model: BaseBlockModel, offset = 0) {\n  const text = model.text;\n  if (!text) {\n    throw new Error(\"Failed to get block's text!\");\n  }\n  if (offset > text.length) {\n    offset = text.length;\n    // FIXME enable strict check\n    // console.error(\n    //   'Offset is out of range! model: ',\n    //   model,\n    //   'offset: ',\n    //   offset,\n    //   'text: ',\n    //   text.toString(),\n    //   'text.length: ',\n    //   text.length\n    // );\n  }\n\n  const vEditor = getVirgoByModel(model);\n  // TODO this assert is unreliable\n  assertExists(vEditor);\n  const [leaf, leafOffset] = vEditor.getTextPoint(offset);\n  return [leaf, leafOffset] as const;\n}\n\n// The following section is experimental code.\n// I believe that `BlockRange` is sufficient for our current needs,\n// so we do not plan to enable the following section at this time.\n//\n// However, it can help us understand the design and development direction of `BlockRange`.\n// If it is needed in the future, we may enable it.\n\ntype ExperimentBlockRange = {\n  type: 'Native' | 'Block';\n  range: Range | null;\n  models: BaseBlockModel[];\n  startModel: BaseBlockModel;\n  endModel: BaseBlockModel;\n  betweenModels: BaseBlockModel[];\n  startOffset: number;\n  endOffset: number;\n  collapsed: boolean;\n  apply: () => void;\n};\n\nexport const experimentCreateBlockRange = (\n  rangeOrBlockRange: Range | BlockRange\n): ExperimentBlockRange | null => {\n  let cacheRange: Range | null =\n    rangeOrBlockRange instanceof Range ? rangeOrBlockRange : null;\n  const blockRange =\n    rangeOrBlockRange instanceof Range\n      ? nativeRangeToBlockRange(rangeOrBlockRange)\n      : rangeOrBlockRange;\n\n  if (!blockRange) {\n    return null;\n  }\n  if (!blockRange.models.length) {\n    throw new Error('Block range must have at least one model.');\n  }\n\n  const getRange = () => {\n    // cache range may be expired\n    if (cacheRange) {\n      return cacheRange;\n    }\n    cacheRange = blockRangeToNativeRange(blockRange);\n    return cacheRange;\n  };\n\n  return {\n    ...blockRange,\n    startModel: blockRange.models[0],\n    endModel: blockRange.models[blockRange.models.length - 1],\n    betweenModels: blockRange.models.slice(1, blockRange.models.length - 1),\n    get range() {\n      return getRange();\n    },\n    collapsed:\n      blockRange.models.length === 1 &&\n      blockRange.startOffset === blockRange.endOffset,\n    apply() {\n      restoreSelection(blockRange);\n    },\n  };\n};\n", "import { assertExists, matchFlavours } from '@blocksuite/global/utils';\nimport type { BaseBlockModel } from '@blocksuite/store';\n\nimport {\n  type BlockComponentElement,\n  DropFlags,\n  getClosestBlockElementByElement,\n  getDropRectByPoint,\n  getModelByBlockElement,\n  getRectByBlockElement,\n} from './query.js';\nimport { type Point, Rect } from './rect.js';\nimport { type EditingState } from './types.js';\n\n/**\n * A droppping type.\n */\nexport type DroppingType = 'none' | 'before' | 'after' | 'database';\n\n/**\n * Calculates the drop target.\n */\nexport function calcDropTarget(\n  point: Point,\n  model: BaseBlockModel,\n  element: Element,\n  draggingElements: BlockComponentElement[],\n  scale: number,\n  flavour: string | null = null // for block-hub\n): {\n  type: DroppingType;\n  rect: Rect;\n  modelState: EditingState;\n} | null {\n  const schema = model.page.getSchemaByFlavour('affine:database');\n  assertExists(schema);\n  const children = schema.model.children ?? [];\n\n  let shouldAppendToDatabase = true;\n\n  if (children.length) {\n    if (draggingElements.length) {\n      shouldAppendToDatabase = draggingElements\n        .map(getModelByBlockElement)\n        .every(m => children.includes(m.flavour));\n    } else if (flavour) {\n      shouldAppendToDatabase = children.includes(flavour);\n    }\n  }\n\n  if (!shouldAppendToDatabase && !matchFlavours(model, ['affine:database'])) {\n    const databaseBlockElement = element.closest('affine-database');\n    if (databaseBlockElement) {\n      element = databaseBlockElement;\n      model = getModelByBlockElement(element);\n    }\n  }\n\n  let type: DroppingType = 'none';\n  const height = 3 * scale;\n  const { rect: domRect, flag } = getDropRectByPoint(point, model, element);\n\n  if (flag === DropFlags.EmptyDatabase) {\n    // empty database\n    const rect = Rect.fromDOMRect(domRect);\n    rect.top -= height / 2;\n    rect.height = height;\n    type = 'database';\n\n    return {\n      type,\n      rect,\n      modelState: {\n        model,\n        rect: domRect,\n        element: element as BlockComponentElement,\n      },\n    };\n  } else if (flag === DropFlags.Database) {\n    // not empty database\n    const distanceToTop = Math.abs(domRect.top - point.y);\n    const distanceToBottom = Math.abs(domRect.bottom - point.y);\n    const before = distanceToTop < distanceToBottom;\n    type = before ? 'before' : 'after';\n\n    return {\n      type,\n      rect: Rect.fromLWTH(\n        domRect.left,\n        domRect.width,\n        (before ? domRect.top - 1 : domRect.bottom) - height / 2,\n        height\n      ),\n      modelState: {\n        model,\n        rect: domRect,\n        element: element as BlockComponentElement,\n      },\n    };\n  }\n\n  const distanceToTop = Math.abs(domRect.top - point.y);\n  const distanceToBottom = Math.abs(domRect.bottom - point.y);\n  const before = distanceToTop < distanceToBottom;\n\n  type = before ? 'before' : 'after';\n  let offsetY = 4;\n\n  if (type === 'before') {\n    // before\n    let prev;\n    let prevRect;\n\n    prev = element.previousElementSibling;\n    if (prev) {\n      if (prev === draggingElements[draggingElements.length - 1]) {\n        type = 'none';\n      } else {\n        prevRect = getRectByBlockElement(prev);\n      }\n    } else {\n      prev = element.parentElement?.previousElementSibling;\n      if (prev) {\n        prevRect = prev.getBoundingClientRect();\n      }\n    }\n\n    if (prevRect) {\n      offsetY = (domRect.top - prevRect.bottom) / 2;\n    }\n  } else {\n    // after\n    let next;\n    let nextRect;\n\n    next = element.nextElementSibling;\n    if (next) {\n      if (next === draggingElements[0]) {\n        type = 'none';\n        next = null;\n      }\n    } else {\n      next = getClosestBlockElementByElement(\n        element.parentElement\n      )?.nextElementSibling;\n    }\n\n    if (next) {\n      nextRect = getRectByBlockElement(next);\n      offsetY = (nextRect.top - domRect.bottom) / 2;\n    }\n  }\n\n  if (type === 'none') return null;\n\n  let top = domRect.top;\n  if (type === 'before') {\n    top -= offsetY;\n  } else {\n    top += domRect.height + offsetY;\n  }\n\n  return {\n    type,\n    rect: Rect.fromLWTH(domRect.left, domRect.width, top - height / 2, height),\n    modelState: {\n      model,\n      rect: domRect,\n      element: element as BlockComponentElement,\n    },\n  };\n}\n", "import { IS_IOS, IS_MAC } from '@blocksuite/global/config';\n\nexport function isPinchEvent(e: WheelEvent) {\n  // two finger pinches on touch pad, ctrlKey is always true.\n  // https://bugs.chromium.org/p/chromium/issues/detail?id=397027\n  if (IS_IOS || IS_MAC) {\n    return e.ctrlKey || e.metaKey;\n  }\n  return e.ctrlKey;\n}\n\n/**\n * Returns a `DragEvent` via `MouseEvent`.\n */\nexport function createDragEvent(type: string, event?: MouseEvent) {\n  const options = {\n    dataTransfer: new DataTransfer(),\n  };\n  if (event) {\n    const { clientX, clientY, screenX, screenY } = event;\n    Object.assign(options, {\n      clientX,\n      clientY,\n      screenX,\n      screenY,\n    });\n  }\n  return new DragEvent(type, options);\n}\n", "import { assertExists } from '@blocksuite/global/utils';\nimport type { BaseBlockModel, Page } from '@blocksuite/store';\n\nexport const createImageInputElement = () => {\n  const fileInput: HTMLInputElement = document.createElement('input');\n  fileInput.type = 'file';\n  fileInput.multiple = true;\n  fileInput.accept = 'image/*';\n  fileInput.style.position = 'fixed';\n  fileInput.style.left = '0';\n  fileInput.style.top = '0';\n  fileInput.style.opacity = '0.001';\n  return fileInput;\n};\n\ntype Props = Partial<BaseBlockModel>;\n\nexport const uploadImageFromLocal = async (\n  page: Page,\n  getSize?: (size: { width: number; height: number }) => void\n): Promise<Array<Props>> => {\n  const baseProps: Props = { flavour: 'affine:embed', type: 'image' };\n  const fileInput = createImageInputElement();\n  document.body.appendChild(fileInput);\n\n  let resolvePromise: (value: Array<Props> | PromiseLike<Array<Props>>) => void;\n  const pending = new Promise<Array<Props>>(resolve => {\n    resolvePromise = resolve;\n  });\n  const onChange = async () => {\n    if (!fileInput.files) return;\n    const storage = await page.blobs;\n    assertExists(storage);\n    const files = fileInput.files;\n    if (files.length === 1) {\n      const file = files[0];\n      if (getSize) {\n        getSize(await readImageSize(file));\n      }\n      const id = await storage.set(file);\n      resolvePromise([{ ...baseProps, sourceId: id }]);\n    } else {\n      const res = [];\n      for (let i = 0; i < files.length; i++) {\n        const file = files[i];\n        const id = await storage.set(file);\n        res.push({ ...baseProps, sourceId: id });\n      }\n      resolvePromise(res);\n    }\n\n    fileInput.removeEventListener('change', onChange);\n    fileInput.remove();\n  };\n\n  fileInput.addEventListener('change', onChange);\n  fileInput.click();\n  return await pending;\n};\n\nfunction readImageSize(file: File) {\n  return new Promise<{ width: number; height: number }>(resolve => {\n    let width = 0;\n    let height = 0;\n    let reader: FileReader | null = new FileReader();\n    reader.addEventListener('load', _ => {\n      const img = new Image();\n      img.onload = () => {\n        width = img.width;\n        height = img.height;\n        reader = null;\n        resolve({ width, height });\n      };\n      img.src = reader?.result as string;\n    });\n    reader.addEventListener('error', _ => {\n      reader = null;\n      resolve({ width, height });\n    });\n    reader.readAsDataURL(file);\n  });\n}\n", "/**! \n * hotkeys-js v3.11.1 \n * A simple micro-library for defining and dispatching keyboard shortcuts. It has no dependencies. \n * \n * Copyright (c) 2023 kenny wong <wowohoo@qq.com> \n * https://jaywcjlove.github.io/hotkeys-js \n * Licensed under the MIT license \n */\n\nvar isff = typeof navigator !== 'undefined' ? navigator.userAgent.toLowerCase().indexOf('firefox') > 0 : false; // \n\nfunction addEvent(object, event, method, useCapture) {\n  if (object.addEventListener) {\n    object.addEventListener(event, method, useCapture);\n  } else if (object.attachEvent) {\n    object.attachEvent(\"on\".concat(event), function () {\n      method(window.event);\n    });\n  }\n} // \n\n\nfunction getMods(modifier, key) {\n  var mods = key.slice(0, key.length - 1);\n\n  for (var i = 0; i < mods.length; i++) {\n    mods[i] = modifier[mods[i].toLowerCase()];\n  }\n\n  return mods;\n} // key\n\n\nfunction getKeys(key) {\n  if (typeof key !== 'string') key = '';\n  key = key.replace(/\\s/g, ''); // ,\n\n  var keys = key.split(','); // ','\n\n  var index = keys.lastIndexOf(''); // ','\n\n  for (; index >= 0;) {\n    keys[index - 1] += ',';\n    keys.splice(index, 1);\n    index = keys.lastIndexOf('');\n  }\n\n  return keys;\n} // \n\n\nfunction compareArray(a1, a2) {\n  var arr1 = a1.length >= a2.length ? a1 : a2;\n  var arr2 = a1.length >= a2.length ? a2 : a1;\n  var isIndex = true;\n\n  for (var i = 0; i < arr1.length; i++) {\n    if (arr2.indexOf(arr1[i]) === -1) isIndex = false;\n  }\n\n  return isIndex;\n}\n\nvar _keyMap = {\n  backspace: 8,\n  '': 8,\n  tab: 9,\n  clear: 12,\n  enter: 13,\n  '': 13,\n  return: 13,\n  esc: 27,\n  escape: 27,\n  space: 32,\n  left: 37,\n  up: 38,\n  right: 39,\n  down: 40,\n  del: 46,\n  delete: 46,\n  ins: 45,\n  insert: 45,\n  home: 36,\n  end: 35,\n  pageup: 33,\n  pagedown: 34,\n  capslock: 20,\n  num_0: 96,\n  num_1: 97,\n  num_2: 98,\n  num_3: 99,\n  num_4: 100,\n  num_5: 101,\n  num_6: 102,\n  num_7: 103,\n  num_8: 104,\n  num_9: 105,\n  num_multiply: 106,\n  num_add: 107,\n  num_enter: 108,\n  num_subtract: 109,\n  num_decimal: 110,\n  num_divide: 111,\n  '': 20,\n  ',': 188,\n  '.': 190,\n  '/': 191,\n  '`': 192,\n  '-': isff ? 173 : 189,\n  '=': isff ? 61 : 187,\n  ';': isff ? 59 : 186,\n  '\\'': 222,\n  '[': 219,\n  ']': 221,\n  '\\\\': 220\n}; // Modifier Keys\n\nvar _modifier = {\n  // shiftKey\n  '': 16,\n  shift: 16,\n  // altKey\n  '': 18,\n  alt: 18,\n  option: 18,\n  // ctrlKey\n  '': 17,\n  ctrl: 17,\n  control: 17,\n  // metaKey\n  '': 91,\n  cmd: 91,\n  command: 91\n};\nvar modifierMap = {\n  16: 'shiftKey',\n  18: 'altKey',\n  17: 'ctrlKey',\n  91: 'metaKey',\n  shiftKey: 16,\n  ctrlKey: 17,\n  altKey: 18,\n  metaKey: 91\n};\nvar _mods = {\n  16: false,\n  18: false,\n  17: false,\n  91: false\n};\nvar _handlers = {}; // F1~F12 special key\n\nfor (var k = 1; k < 20; k++) {\n  _keyMap[\"f\".concat(k)] = 111 + k;\n}\n\nvar _downKeys = []; // \n\nvar winListendFocus = false; // windowfocus\n\nvar _scope = 'all'; // \n\nvar elementHasBindEvent = []; // \n// \n\nvar code = function code(x) {\n  return _keyMap[x.toLowerCase()] || _modifier[x.toLowerCase()] || x.toUpperCase().charCodeAt(0);\n};\n\nvar getKey = function getKey(x) {\n  return Object.keys(_keyMap).find(function (k) {\n    return _keyMap[k] === x;\n  });\n};\n\nvar getModifier = function getModifier(x) {\n  return Object.keys(_modifier).find(function (k) {\n    return _modifier[k] === x;\n  });\n}; // ''\n\n\nfunction setScope(scope) {\n  _scope = scope || 'all';\n} // \n\n\nfunction getScope() {\n  return _scope || 'all';\n} // \n\n\nfunction getPressedKeyCodes() {\n  return _downKeys.slice(0);\n}\n\nfunction getPressedKeyString() {\n  return _downKeys.map(function (c) {\n    return getKey(c) || getModifier(c) || String.fromCharCode(c);\n  });\n} //   Boolean\n// hotkey is effective only when filter return true\n\n\nfunction filter(event) {\n  var target = event.target || event.srcElement;\n  var tagName = target.tagName;\n  var flag = true; // ignore: isContentEditable === 'true', <input> and <textarea> when readOnly state is false, <select>\n\n  if (target.isContentEditable || (tagName === 'INPUT' || tagName === 'TEXTAREA' || tagName === 'SELECT') && !target.readOnly) {\n    flag = false;\n  }\n\n  return flag;\n} // truefalse\n\n\nfunction isPressed(keyCode) {\n  if (typeof keyCode === 'string') {\n    keyCode = code(keyCode); // \n  }\n\n  return _downKeys.indexOf(keyCode) !== -1;\n} // handlers scope()\n\n\nfunction deleteScope(scope, newScope) {\n  var handlers;\n  var i; // scopescope\n\n  if (!scope) scope = getScope();\n\n  for (var key in _handlers) {\n    if (Object.prototype.hasOwnProperty.call(_handlers, key)) {\n      handlers = _handlers[key];\n\n      for (i = 0; i < handlers.length;) {\n        if (handlers[i].scope === scope) handlers.splice(i, 1);else i++;\n      }\n    }\n  } // scopescopeall\n\n\n  if (getScope() === scope) setScope(newScope || 'all');\n} // \n\n\nfunction clearModifier(event) {\n  var key = event.keyCode || event.which || event.charCode;\n\n  var i = _downKeys.indexOf(key); // \n\n\n  if (i >= 0) {\n    _downKeys.splice(i, 1);\n  } //  cmmand  cmmand  keyup \n\n\n  if (event.key && event.key.toLowerCase() === 'meta') {\n    _downKeys.splice(0, _downKeys.length);\n  } //  shiftKey altKey ctrlKey (command||metaKey) \n\n\n  if (key === 93 || key === 224) key = 91;\n\n  if (key in _mods) {\n    _mods[key] = false; // false\n\n    for (var k in _modifier) {\n      if (_modifier[k] === key) hotkeys[k] = false;\n    }\n  }\n}\n\nfunction unbind(keysInfo) {\n  // unbind(), unbind all keys\n  if (typeof keysInfo === 'undefined') {\n    Object.keys(_handlers).forEach(function (key) {\n      return delete _handlers[key];\n    });\n  } else if (Array.isArray(keysInfo)) {\n    // support like : unbind([{key: 'ctrl+a', scope: 's1'}, {key: 'ctrl-a', scope: 's2', splitKey: '-'}])\n    keysInfo.forEach(function (info) {\n      if (info.key) eachUnbind(info);\n    });\n  } else if (typeof keysInfo === 'object') {\n    // support like unbind({key: 'ctrl+a, ctrl+b', scope:'abc'})\n    if (keysInfo.key) eachUnbind(keysInfo);\n  } else if (typeof keysInfo === 'string') {\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n\n    // support old method\n    // eslint-disable-line\n    var scope = args[0],\n        method = args[1];\n\n    if (typeof scope === 'function') {\n      method = scope;\n      scope = '';\n    }\n\n    eachUnbind({\n      key: keysInfo,\n      scope: scope,\n      method: method,\n      splitKey: '+'\n    });\n  }\n} // \n\n\nvar eachUnbind = function eachUnbind(_ref) {\n  var key = _ref.key,\n      scope = _ref.scope,\n      method = _ref.method,\n      _ref$splitKey = _ref.splitKey,\n      splitKey = _ref$splitKey === void 0 ? '+' : _ref$splitKey;\n  var multipleKeys = getKeys(key);\n  multipleKeys.forEach(function (originKey) {\n    var unbindKeys = originKey.split(splitKey);\n    var len = unbindKeys.length;\n    var lastKey = unbindKeys[len - 1];\n    var keyCode = lastKey === '*' ? '*' : code(lastKey);\n    if (!_handlers[keyCode]) return; // \n\n    if (!scope) scope = getScope();\n    var mods = len > 1 ? getMods(_modifier, unbindKeys) : [];\n    _handlers[keyCode] = _handlers[keyCode].filter(function (record) {\n      // \n      var isMatchingMethod = method ? record.method === method : true;\n      return !(isMatchingMethod && record.scope === scope && compareArray(record.mods, mods));\n    });\n  });\n}; // \n\n\nfunction eventHandler(event, handler, scope, element) {\n  if (handler.element !== element) {\n    return;\n  }\n\n  var modifiersMatch; // \n\n  if (handler.scope === scope || handler.scope === 'all') {\n    // true\n    modifiersMatch = handler.mods.length > 0;\n\n    for (var y in _mods) {\n      if (Object.prototype.hasOwnProperty.call(_mods, y)) {\n        if (!_mods[y] && handler.mods.indexOf(+y) > -1 || _mods[y] && handler.mods.indexOf(+y) === -1) {\n          modifiersMatch = false;\n        }\n      }\n    } // \n\n\n    if (handler.mods.length === 0 && !_mods[16] && !_mods[18] && !_mods[17] && !_mods[91] || modifiersMatch || handler.shortcut === '*') {\n      handler.keys = [];\n      handler.keys = handler.keys.concat(_downKeys);\n\n      if (handler.method(event, handler) === false) {\n        if (event.preventDefault) event.preventDefault();else event.returnValue = false;\n        if (event.stopPropagation) event.stopPropagation();\n        if (event.cancelBubble) event.cancelBubble = true;\n      }\n    }\n  }\n} // keydown\n\n\nfunction dispatch(event, element) {\n  var asterisk = _handlers['*'];\n  var key = event.keyCode || event.which || event.charCode; //  \n\n  if (!hotkeys.filter.call(this, event)) return; // Gecko(Firefox)command224Webkit(Chrome)\n  // Webkit command \n\n  if (key === 93 || key === 224) key = 91;\n  /**\n   * Collect bound keys\n   * If an Input Method Editor is processing key input and the event is keydown, return 229.\n   * https://stackoverflow.com/questions/25043934/is-it-ok-to-ignore-keydown-events-with-keycode-229\n   * http://lists.w3.org/Archives/Public/www-dom/2010JulSep/att-0182/keyCode-spec.html\n   */\n\n  if (_downKeys.indexOf(key) === -1 && key !== 229) _downKeys.push(key);\n  /**\n   * Jest test cases are required.\n   * ===============================\n   */\n\n  ['ctrlKey', 'altKey', 'shiftKey', 'metaKey'].forEach(function (keyName) {\n    var keyNum = modifierMap[keyName];\n\n    if (event[keyName] && _downKeys.indexOf(keyNum) === -1) {\n      _downKeys.push(keyNum);\n    } else if (!event[keyName] && _downKeys.indexOf(keyNum) > -1) {\n      _downKeys.splice(_downKeys.indexOf(keyNum), 1);\n    } else if (keyName === 'metaKey' && event[keyName] && _downKeys.length === 3) {\n      /**\n       * Fix if Command is pressed:\n       * ===============================\n       */\n      if (!(event.ctrlKey || event.shiftKey || event.altKey)) {\n        _downKeys = _downKeys.slice(_downKeys.indexOf(keyNum));\n      }\n    }\n  });\n  /**\n   * -------------------------------\n   */\n\n  if (key in _mods) {\n    _mods[key] = true; // key hotkeys \n\n    for (var k in _modifier) {\n      if (_modifier[k] === key) hotkeys[k] = true;\n    }\n\n    if (!asterisk) return;\n  } //  modifierMap  event \n\n\n  for (var e in _mods) {\n    if (Object.prototype.hasOwnProperty.call(_mods, e)) {\n      _mods[e] = event[modifierMap[e]];\n    }\n  }\n  /**\n   * https://github.com/jaywcjlove/hotkeys/pull/129\n   * This solves the issue in Firefox on Windows where hotkeys corresponding to special characters would not trigger.\n   * An example of this is ctrl+alt+m on a Swedish keyboard which is used to type .\n   * Browser support: https://caniuse.com/#feat=keyboardevent-getmodifierstate\n   */\n\n\n  if (event.getModifierState && !(event.altKey && !event.ctrlKey) && event.getModifierState('AltGraph')) {\n    if (_downKeys.indexOf(17) === -1) {\n      _downKeys.push(17);\n    }\n\n    if (_downKeys.indexOf(18) === -1) {\n      _downKeys.push(18);\n    }\n\n    _mods[17] = true;\n    _mods[18] = true;\n  } //   `all`\n\n\n  var scope = getScope(); // \n\n  if (asterisk) {\n    for (var i = 0; i < asterisk.length; i++) {\n      if (asterisk[i].scope === scope && (event.type === 'keydown' && asterisk[i].keydown || event.type === 'keyup' && asterisk[i].keyup)) {\n        eventHandler(event, asterisk[i], scope, element);\n      }\n    }\n  } // key  _handlers \n\n\n  if (!(key in _handlers)) return;\n\n  for (var _i = 0; _i < _handlers[key].length; _i++) {\n    if (event.type === 'keydown' && _handlers[key][_i].keydown || event.type === 'keyup' && _handlers[key][_i].keyup) {\n      if (_handlers[key][_i].key && _handlers[key][_i].scope === scope) {\n        var record = _handlers[key][_i];\n        var splitKey = record.splitKey;\n        var keyShortcut = record.key.split(splitKey);\n        var _downKeysCurrent = []; // \n\n        for (var a = 0; a < keyShortcut.length; a++) {\n          _downKeysCurrent.push(code(keyShortcut[a]));\n        }\n\n        if (_downKeysCurrent.sort().join('') === _downKeys.sort().join('')) {\n          // \n          eventHandler(event, record, scope, element);\n        }\n      }\n    }\n  }\n} //  element \n\n\nfunction isElementBind(element) {\n  return elementHasBindEvent.indexOf(element) > -1;\n}\n\nfunction hotkeys(key, option, method) {\n  _downKeys = [];\n  var keys = getKeys(key); // \n\n  var mods = [];\n  var scope = 'all'; // scopeall\n\n  var element = document; // \n\n  var i = 0;\n  var keyup = false;\n  var keydown = true;\n  var splitKey = '+';\n  var capture = false; // \n\n  if (method === undefined && typeof option === 'function') {\n    method = option;\n  }\n\n  if (Object.prototype.toString.call(option) === '[object Object]') {\n    if (option.scope) scope = option.scope; // eslint-disable-line\n\n    if (option.element) element = option.element; // eslint-disable-line\n\n    if (option.keyup) keyup = option.keyup; // eslint-disable-line\n\n    if (option.keydown !== undefined) keydown = option.keydown; // eslint-disable-line\n\n    if (option.capture !== undefined) capture = option.capture; // eslint-disable-line\n\n    if (typeof option.splitKey === 'string') splitKey = option.splitKey; // eslint-disable-line\n  }\n\n  if (typeof option === 'string') scope = option; // \n\n  for (; i < keys.length; i++) {\n    key = keys[i].split(splitKey); // \n\n    mods = []; // \n\n    if (key.length > 1) mods = getMods(_modifier, key); // \n\n    key = key[key.length - 1];\n    key = key === '*' ? '*' : code(key); // *\n    // key_handlers\n\n    if (!(key in _handlers)) _handlers[key] = [];\n\n    _handlers[key].push({\n      keyup: keyup,\n      keydown: keydown,\n      scope: scope,\n      mods: mods,\n      shortcut: keys[i],\n      method: method,\n      key: keys[i],\n      splitKey: splitKey,\n      element: element\n    });\n  } // document\n\n\n  if (typeof element !== 'undefined' && !isElementBind(element) && window) {\n    elementHasBindEvent.push(element);\n    addEvent(element, 'keydown', function (e) {\n      dispatch(e, element);\n    }, capture);\n\n    if (!winListendFocus) {\n      winListendFocus = true;\n      addEvent(window, 'focus', function () {\n        _downKeys = [];\n      }, capture);\n    }\n\n    addEvent(element, 'keyup', function (e) {\n      dispatch(e, element);\n      clearModifier(e);\n    }, capture);\n  }\n}\n\nfunction trigger(shortcut) {\n  var scope = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'all';\n  Object.keys(_handlers).forEach(function (key) {\n    var dataList = _handlers[key].filter(function (item) {\n      return item.scope === scope && item.shortcut === shortcut;\n    });\n\n    dataList.forEach(function (data) {\n      if (data && data.method) {\n        data.method();\n      }\n    });\n  });\n}\n\nvar _api = {\n  getPressedKeyString: getPressedKeyString,\n  setScope: setScope,\n  getScope: getScope,\n  deleteScope: deleteScope,\n  getPressedKeyCodes: getPressedKeyCodes,\n  isPressed: isPressed,\n  filter: filter,\n  trigger: trigger,\n  unbind: unbind,\n  keyMap: _keyMap,\n  modifier: _modifier,\n  modifierMap: modifierMap\n};\n\nfor (var a in _api) {\n  if (Object.prototype.hasOwnProperty.call(_api, a)) {\n    hotkeys[a] = _api[a];\n  }\n}\n\nif (typeof window !== 'undefined') {\n  var _hotkeys = window.hotkeys;\n\n  hotkeys.noConflict = function (deep) {\n    if (deep && window.hotkeys === hotkeys) {\n      window.hotkeys = _hotkeys;\n    }\n\n    return hotkeys;\n  };\n\n  window.hotkeys = hotkeys;\n}\n\nexport { hotkeys as default };\n", "import type { KeyHandler } from 'hotkeys-js';\nimport hotkeys from 'hotkeys-js';\n\nimport {\n  isCaptionElement,\n  isDatabaseInput,\n  isInsideDatabaseTitle,\n  isInsideEdgelessTextEditor,\n  isInsidePageTitle,\n  isInsideRichText,\n} from './query.js';\n\nhotkeys.filter = (event: KeyboardEvent) => {\n  if (shouldFilterHotkey(event)) return false;\n  return true;\n};\n\nfunction isUndoRedo(event: KeyboardEvent) {\n  // If undo or redo: when event.shiftKey is false => undo, when event.shiftKey is true => redo\n  if ((event.ctrlKey || event.metaKey) && !event.altKey && event.key === 'z') {\n    return true;\n  }\n  return false;\n}\n\n/**\n * Return `true` if the event should be ignore.\n */\nfunction shouldFilterHotkey(event: KeyboardEvent) {\n  const target = event.target;\n  // Not sure if this is the right thing to do\n  if (!target) {\n    return true;\n  }\n  // Skip input element\n  // including\n  // - code block language search input\n  // - image caption\n  // - link create/edit popover\n  if (!isInsideRichText(event.target)) {\n    // TODO Remove ad-hoc\n    // This ad-hoc should be moved to the caption input for processing\n    // Enter on caption should jump out of input\n    // See also `hotkey.addListener(ENTER, handler)`\n    if (isCaptionElement(event.target) && event.key === 'Enter') {\n      return false;\n    }\n    // undo/redo should work in page title\n    if (isInsidePageTitle(event.target) && isUndoRedo(event)) {\n      return false;\n    }\n    // undo/redo should work in database title or cell container\n    if (\n      (isInsideDatabaseTitle(event.target) || isDatabaseInput(event.target)) &&\n      isUndoRedo(event)\n    ) {\n      return false;\n    }\n    // undo/redo should work in edgeless text editor\n    if (isInsideEdgelessTextEditor(event.target) && isUndoRedo(event)) {\n      return false;\n    }\n    // Some event dispatch from body\n    // for example, press backspace to remove block-level selection\n    if (event.target === document.body) {\n      // TODO filter arrow key\n      return false;\n    }\n    return true;\n  }\n  // if (\n  //   target instanceof Element &&\n  //   ['INPUT', 'EDIT-LINK-PANEL'].includes(target.tagName)\n  // ) {\n  //   return true;\n  // }\n  return false;\n}\n\nexport const HOTKEY_SCOPE_TYPE = {\n  AFFINE_PAGE: 'affine:page',\n  AFFINE_EDGELESS: 'affine:edgeless',\n} as const;\nexport type HOTKEY_SCOPE_TYPE =\n  (typeof HOTKEY_SCOPE_TYPE)[keyof typeof HOTKEY_SCOPE_TYPE];\nexport type HOTKEY_SCOPE =\n  | `affine:page-${number}`\n  | `affine:edgeless-${number}`;\n\nconst HOTKEY_DISABLED_SCOPE = 'hotkey_disabled';\n\n/**\n * Singleton\n *\n * When rendering a page or an edgeless view,\n * `setScope` is called to set a unique scope for each view.\n * All hotkeys are then bound to this scope.\n * When a page or an edgeless view is disconnected,\n * all hotkeys registered during the view's lifetime are destroyed.\n */\nclass HotkeyManager {\n  private readonly _hotkeys: typeof hotkeys;\n  private _scope: string = HOTKEY_DISABLED_SCOPE;\n  private _disabled = false;\n  private counter = 0;\n\n  constructor() {\n    this._hotkeys = hotkeys;\n  }\n\n  get disabled() {\n    return this._disabled;\n  }\n\n  newScope(type: HOTKEY_SCOPE_TYPE): HOTKEY_SCOPE {\n    return `${type}-${this.counter++}`;\n  }\n\n  setScope(scope: HOTKEY_SCOPE) {\n    this._scope = scope;\n    this._hotkeys.setScope(scope);\n  }\n\n  deleteScope(scope: HOTKEY_SCOPE) {\n    this._hotkeys.deleteScope(scope);\n  }\n\n  addListener(\n    hotkey: string,\n    listener: KeyHandler,\n    options: {\n      keyup?: boolean;\n      keydown?: boolean;\n    } = {}\n  ): void {\n    this._hotkeys(hotkey, { ...options, scope: this._scope }, listener);\n  }\n\n  removeListener(hotkey: string | Array<string>): void {\n    this._hotkeys.unbind(\n      (Array.isArray(hotkey) ? hotkey : [hotkey]).join(','),\n      this._scope\n    );\n  }\n\n  disableHotkey(): void {\n    this._disabled = true;\n    this._hotkeys.setScope(HOTKEY_DISABLED_SCOPE);\n  }\n\n  enableHotkey(): void {\n    this._disabled = false;\n    this._hotkeys.setScope(this._scope);\n  }\n\n  /**\n   * Create a context to shielding against global hotkey.\n   *\n   * The param `fn` will be executed immediately.\n   * @example\n   * ```ts\n   * const ret = await hotkey.withDisableHotkey(async () => {\n   *   const result = await createLink(space);\n   *   return result;\n   * });\n   * ```\n   */\n  async withDisabledHotkey<T = void>(fn: () => Promise<T>) {\n    this.disableHotkey();\n    try {\n      return await fn();\n    } finally {\n      this.enableHotkey();\n    }\n  }\n\n  /**\n   * Similar to {@link withDisableHotkey}, but return a function instead of execute immediately.\n   * @example\n   * ```ts\n   * const createLinkWithoutHotkey = withDisabledHotkeyFn((space) => createLink(space));\n   * await createLinkWithoutHotkey(space);\n   * ```\n   */\n  withDisabledHotkeyFn<\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    T extends (...args: any[]) => Promise<any> = (\n      ...args: unknown[]\n    ) => Promise<unknown>\n  >(fn: T) {\n    return ((...args: Parameters<T>) =>\n      this.withDisabledHotkey<ReturnType<T>>(() =>\n        fn(...args)\n      ) as ReturnType<T>) as unknown as T;\n  }\n\n  withScope(scope: HOTKEY_SCOPE, fn: () => void) {\n    const pre = this._scope;\n    try {\n      this._scope = scope;\n      fn();\n    } finally {\n      this._scope = pre;\n    }\n  }\n}\n\nexport const hotkey = new HotkeyManager();\n", "// Reorders the shapes or frames.\n\nexport type ReorderingType = 'front' | 'forward' | 'backward' | 'back';\n\nexport interface ReorderingAction<T> {\n  type: ReorderingType;\n  elements: T[];\n}\n\nexport interface ReorderingRange {\n  start: number;\n  end: number;\n}\n\n/**\n * Gets indexes of a from b.\n */\nexport function getIndexesWith<T>(a: T[], b: T[]): number[] {\n  return a.map(e => b.findIndex(element => element === e));\n}\n\n/**\n * Generates the ranges via indexes;\n */\nexport function generateRanges(indexes: number[]): ReorderingRange[] {\n  let curr;\n  let i = 1;\n  let start = indexes[0];\n  let end = indexes[0];\n  const ranges = [{ start, end }];\n  const len = indexes.length;\n  for (; i < len; i++) {\n    curr = indexes[i];\n    if (curr - end === 1) {\n      ranges[ranges.length - 1].end = end = curr;\n    } else {\n      start = end = curr;\n      ranges.push({ start, end });\n    }\n  }\n  return ranges;\n}\n\n/**\n * Reorders the elements, moving multiple ranges of child elements to the end.\n */\nexport function bringToFront<T>(ranges: ReorderingRange[], elements: T[]) {\n  let n = 0;\n  let i = ranges.length;\n  const t = elements.length;\n  while (i) {\n    i--;\n    const { start, end } = ranges[i];\n    const temp = elements.splice(start, end + 1 - start);\n    n += temp.length;\n    elements.splice(t - n, 0, ...temp);\n  }\n}\n\n/**\n * Reorders the elements, moving multiple ranges of child elements forward.\n */\nexport function bringForward<T>(ranges: ReorderingRange[], elements: T[]) {\n  let i = ranges.length;\n  while (i) {\n    i--;\n    const { start, end } = ranges[i];\n    const temp = elements.splice(start, end + 1 - start);\n    elements.splice(start + 1, 0, ...temp);\n  }\n}\n\n/**\n * Reorders the elements, moving multiple ranges of child elements backward.\n */\nexport function sendBackward<T>(ranges: ReorderingRange[], elements: T[]) {\n  let i = 0;\n  const len = ranges.length;\n  for (; i < len; i++) {\n    const { start, end } = ranges[i];\n    if (start === 0) continue;\n    const temp = elements.splice(start, end + 1 - start);\n    elements.splice(start - 1, 0, ...temp);\n  }\n}\n\n/**\n * Reorders the elements, moving multiple ranges of child elements to the start.\n */\nexport function sendToBack<T>(ranges: ReorderingRange[], elements: T[]) {\n  let i = 0;\n  let n = 0;\n  const len = ranges.length;\n  for (; i < len; i++) {\n    const { start, end } = ranges[i];\n    const temp = elements.splice(start, end + 1 - start);\n    elements.splice(n, 0, ...temp);\n    n += temp.length;\n  }\n}\n\n/**\n * Brings to front or sends to back.\n */\nexport function reorderTo<T>(\n  elements: T[],\n  compare: (a: T, b: T) => number,\n  getIndexes: (elements: T[]) => {\n    start: string | null;\n    end: string | null;\n  },\n  genKeys: (start: string | null, end: string | null, len: number) => string[],\n  setIndexes: (keys: string[], elements: T[]) => void\n) {\n  if (!elements.length) {\n    return;\n  }\n\n  elements.sort(compare);\n\n  const { start, end } = getIndexes(elements);\n  const keys = genKeys(start, end, elements.length);\n\n  setIndexes(keys, elements);\n}\n\n/**\n * Brings forward or sends backward layer by layer.\n */\nexport function reorder<T>(\n  elements: T[],\n  compare: (a: T, b: T) => number,\n  pick: () => T[],\n  getIndexes: (pickedElements: T[]) => {\n    start: string | null;\n    end: string | null;\n  },\n  order: (ranges: ReorderingRange[], pickedElements: T[]) => void,\n  genKeys: (start: string | null, end: string | null, len: number) => string[],\n  setIndexes: (keys: string[], pickedElements: T[]) => void\n) {\n  if (!elements.length) {\n    return;\n  }\n\n  elements.sort(compare);\n\n  const pickedElements = pick().sort(compare);\n  const { start, end } = getIndexes(pickedElements);\n  const indexes = getIndexesWith(elements, pickedElements);\n  const ranges = generateRanges(indexes);\n\n  order(ranges, pickedElements);\n\n  const keys = genKeys(start, end, pickedElements.length);\n\n  setIndexes(keys, pickedElements);\n}\n\n/**\n * Generates bounds with selected elements.\n */\nexport function generateBounds<T>(\n  elements: T[],\n  getXYWH: (e: T) => {\n    x: number;\n    y: number;\n    h: number;\n    w: number;\n  }\n): {\n  x: number;\n  y: number;\n  h: number;\n  w: number;\n} {\n  const bounds = {\n    x: 0,\n    y: 0,\n    w: 0,\n    h: 0,\n  };\n\n  const len = elements.length;\n\n  if (len) {\n    let i = 0;\n    const { x, y, w, h } = getXYWH(elements[i]);\n    let minX = x;\n    let minY = y;\n    let maxX = x + w;\n    let maxY = y + h;\n\n    for (i++; i < len; i++) {\n      const { x, y, w, h } = getXYWH(elements[i]);\n      minX = Math.min(minX, x);\n      minY = Math.min(minY, y);\n      maxX = Math.max(maxX, x + w);\n      maxY = Math.max(maxY, y + h);\n    }\n\n    bounds.x = minX;\n    bounds.y = minY;\n    bounds.w = maxX - minX;\n    bounds.h = maxY - minY;\n  }\n\n  return bounds;\n}\n", "import {\n  ArrowDownIcon,\n  DualLinkIcon16,\n  LinkedPageIcon,\n  PageIcon,\n} from '@blocksuite/global/config';\nimport { WithDisposable } from '@blocksuite/lit';\nimport { assertExists, type Page } from '@blocksuite/store';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\n\nimport type { AffineTextAttributes } from '../../__internal__/rich-text/virgo/types.js';\nimport { type BlockHost } from '../../std.js';\n\nconst styles = css`\n  :host {\n    position: relative;\n  }\n\n  .btn {\n    box-sizing: border-box;\n    display: inline-flex;\n    align-items: center;\n    border: none;\n    padding: 1px 4px;\n    border-radius: 5px;\n    gap: 4px;\n    background: transparent;\n    cursor: pointer;\n\n    user-select: none;\n    font-family: var(--affine-font-family);\n    fill: var(--affine-text-secondary-color);\n    color: var(--affine-text-secondary-color);\n    pointer-events: auto;\n  }\n\n  .btn > span {\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n  }\n\n  .btn:hover {\n    background: var(--affine-hover-color);\n  }\n\n  .btn:active {\n    background: var(--affine-hover-color);\n  }\n\n  .backlink-popover {\n    position: absolute;\n    left: 0;\n    bottom: -8px;\n\n    display: flex;\n    flex-direction: column;\n    padding: 8px 4px;\n    background: var(--affine-white);\n    box-shadow: var(--affine-menu-shadow);\n    border-radius: 12px;\n    transform: translateY(100%);\n    z-index: 1;\n  }\n\n  .backlink-popover .group-title {\n    color: var(--affine-text-secondary-color);\n    margin: 8px 12px;\n  }\n\n  .backlink-popover icon-button {\n    padding: 8px;\n    justify-content: flex-start;\n    gap: 8px;\n  }\n\n  ::-webkit-scrollbar {\n    -webkit-appearance: none;\n    width: 4px;\n  }\n  ::-webkit-scrollbar-thumb {\n    border-radius: 2px;\n    background-color: #b1b1b1;\n  }\n`;\n\nexport type BackLink = {\n  pageId: string;\n  blockId: string;\n  type: NonNullable<AffineTextAttributes['reference']>['type'];\n};\n\n@customElement('backlink-button')\nexport class BacklinkButton extends WithDisposable(LitElement) {\n  static override styles = styles;\n\n  @property()\n  page?: Page;\n\n  @property()\n  host!: BlockHost;\n\n  @state()\n  private _backlinks: BackLink[] = [];\n\n  @state()\n  private _showPopover = false;\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.tabIndex = 0;\n\n    const page = this.page;\n    assertExists(page);\n    const backlinkIndexer = page.workspace.indexer.backlink;\n    this._backlinks = backlinkIndexer.getBacklink(page.id);\n    backlinkIndexer.slots.indexUpdated.on(() => {\n      this._backlinks = backlinkIndexer.getBacklink(page.id);\n      if (!this._backlinks.length) {\n        this._showPopover = false;\n      }\n    });\n    this._disposables.addFromEvent(window, 'mousedown', this._onClickAway);\n  }\n\n  // Handle click outside\n  private _onClickAway = (e: Event) => {\n    if (e.target === this) return;\n    if (!this._showPopover) return;\n    this._showPopover = false;\n  };\n\n  onClick() {\n    this._showPopover = !this._showPopover;\n  }\n\n  override render() {\n    // Only show linked page backlinks\n    const linkedBacklinks = this._backlinks.filter(\n      ({ type }) => type === 'LinkedPage'\n    );\n    if (!linkedBacklinks.length) {\n      return null;\n    }\n    return html`<div class=\"btn\" @click=${this.onClick}>\n        ${DualLinkIcon16}<span>Backlinks (${linkedBacklinks.length})</span\n        >${ArrowDownIcon}\n      </div>\n      ${this._showPopover\n        ? backlinkPopover(this.host, linkedBacklinks)\n        : null}`;\n  }\n}\n\nconst DEFAULT_PAGE_NAME = 'Untitled';\n\nfunction backlinkPopover(host: BlockHost, backlinks: BackLink[]) {\n  const metas = host.page.workspace.meta.pageMetas;\n  return html`<div class=\"backlink-popover\">\n    <div class=\"group-title\">Linked to this page</div>\n    <div class=\"group\" style=\"overflow-y: scroll; max-height: 372px;\">\n      ${backlinks.map(({ pageId, blockId, type }) => {\n        const icon = type === 'LinkedPage' ? LinkedPageIcon : PageIcon;\n        const pageMeta = metas.find(page => page.id === pageId);\n        if (!pageMeta) {\n          console.warn('Unexpected page meta not found', pageId);\n        }\n        const title = pageMeta?.title || DEFAULT_PAGE_NAME;\n        return html`<icon-button\n          width=\"248px\"\n          height=\"32px\"\n          text=${title}\n          @click=${() => {\n            if (pageId === host.page.id) {\n              // On the current page, no need to jump\n              // TODO jump to block\n              return;\n            }\n            host.slots.pageLinkClicked.emit({ pageId, blockId });\n          }}\n        >\n          ${icon}\n        </icon-button>`;\n      })}\n    </div>\n  </div>`;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'backlink-button': BacklinkButton;\n  }\n}\n", "import type { Page } from '@blocksuite/store';\nimport type { VEditor } from '@blocksuite/virgo';\n\nimport { isPageMode } from './query.js';\n\n// When the user selects a range, check if it matches the previous selection.\n// If it does, apply the marks from the previous selection.\n// If it does not, remove the marks from the previous selection.\nexport function clearMarksOnDiscontinuousInput(vEditor: VEditor): void {\n  let vRange = vEditor.getVRange();\n  const dispose = vEditor.slots.vRangeUpdated.on(([r, t]) => {\n    if (\n      vRange &&\n      r &&\n      ((t === 'native' && r.index === vRange.index) ||\n        (t !== 'native' && r.index === vRange.index + 1))\n    ) {\n      vRange = r;\n    } else {\n      vEditor.resetMarks();\n      dispose.dispose();\n    }\n  });\n}\n\nexport function setupVirgoScroll(page: Page, vEditor: VEditor): void {\n  vEditor.shouldLineScrollIntoView = isPageMode(page);\n}\n", "import { css } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport { IconButton } from '../button.js';\n\n/**\n * @deprecated Use {@link IconButton} instead.\n */\n@customElement('format-bar-button')\nexport class FormatBarButton extends IconButton {\n  static override styles = css`\n    ${IconButton.styles}\n\n    :host {\n      width: var(--button-width);\n      height: var(--button-height);\n      fill: var(--affine-icon-color);\n      white-space: nowrap;\n      user-select: none;\n      gap: 8px;\n    }\n  `;\n\n  @property()\n  override width: string | number = '32px';\n\n  @property()\n  override height: string | number = '32px';\n\n  // TODO update color when active\n  @property()\n  active = false;\n\n  private readonly _mousedown = (e: MouseEvent) => {\n    // prevents catching or bubbling in editor-container\n    e.stopPropagation();\n    // disable default behavior (e.g., change selection focus)\n    e.preventDefault();\n  };\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.addEventListener('mousedown', this._mousedown);\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.removeEventListener('mousedown', this._mousedown);\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'format-bar-button': FormatBarButton;\n  }\n}\n", "import { caretRangeFromPoint } from '@blocksuite/global/utils';\nimport type { PointerEventState } from '@blocksuite/lit';\n\nimport {\n  clamp,\n  getCurrentNativeRange,\n  hasNativeSelection,\n  isMultiLineRange,\n  resetNativeSelection,\n} from '../../__internal__/index.js';\nimport { isAtLineEdge } from '../../__internal__/utils/check-line.js';\nimport type { PageSelectionState } from '../default/selection-manager/index.js';\n\nexport function repairContextMenuRange(e: MouseEvent) {\n  const selection = window.getSelection() as Selection;\n  const currentRange =\n    selection && selection.rangeCount && selection.getRangeAt(0);\n  const pointRange = caretRangeFromPoint(e.x, e.y);\n  // repair browser context menu change selection can not go through blocks\n  if (\n    currentRange &&\n    pointRange &&\n    currentRange.isPointInRange(\n      pointRange.startContainer,\n      pointRange.startOffset\n    ) &&\n    currentRange.isPointInRange(pointRange.endContainer, pointRange.endOffset)\n  ) {\n    requestAnimationFrame(() => {\n      resetNativeSelection(currentRange);\n    });\n  } else {\n    e.preventDefault();\n  }\n}\n\nexport type DragDirection =\n  | 'right-bottom'\n  | 'right-top'\n  | 'left-bottom'\n  | 'left-top'\n  | 'center-bottom'\n  | 'center-top'\n  // no select direction, for example select all by `ctrl + a`\n  | 'directionless';\n\n// XXX The type is not clear enough and needs to be redesigned\n// text can be applied both text and paragraph formatting actions, while others can only be applied paragraph actions\nexport type SelectedBlockType = 'Text' | 'Caret' | 'Other';\n\nexport function getDragDirection(e: PointerEventState): DragDirection {\n  const startX = e.start.x;\n  const startY = e.start.y;\n  const endX = e.point.x;\n  const endY = e.point.y;\n  // selection direction\n  const isForwards = endX > startX;\n  const range = getCurrentNativeRange();\n  const selectedOneLine = !isMultiLineRange(range);\n\n  if (isForwards) {\n    if (selectedOneLine || endY >= startY) {\n      return 'right-bottom';\n    } else {\n      return 'right-top';\n    }\n  } else {\n    // backwards\n    if (selectedOneLine || endY <= startY) {\n      return 'left-top';\n    } else {\n      return 'left-bottom';\n    }\n  }\n}\n\n/**\n * Return a base range for element positioning based on the current selection and selection info\n *\n * @example\n * ```ts\n * const { selectedType, direction } = getNativeSelectionMouseDragInfo(e);\n * if (selectedType === 'Caret') {\n *   return;\n * }\n * ```\n */\nexport function getNativeSelectionMouseDragInfo(e: PointerEventState) {\n  const curRange = getCurrentNativeRange();\n  const direction = getDragDirection(e);\n\n  const isSelectedNothing =\n    curRange.collapsed ||\n    // If you try to drag from back to front on an empty line,\n    // you will get a empty range, but the `range.collapsed` is false,\n    // and the range has different startContainer and endContainer.\n    // So we need to check the length of the range\n    curRange.toString().length === 0;\n  const selectedType: SelectedBlockType = isSelectedNothing ? 'Caret' : 'Text';\n  return { selectedType, direction };\n}\n\nexport function calcPositionPointByRange(\n  range: Range,\n  direction: DragDirection\n) {\n  const { startContainer, startOffset, endContainer, endOffset } = range;\n\n  const isStartAnchor = direction.includes('top');\n  const [targetNode, offset] = isStartAnchor\n    ? [startContainer, startOffset]\n    : [endContainer, endOffset];\n  const lineRange = new Range();\n\n  if (direction.includes('center')) {\n    // Use whole range\n    lineRange.setStart(startContainer, startOffset);\n    lineRange.setEnd(endContainer, endOffset);\n  } else {\n    // Use target node\n    lineRange.setStart(targetNode, offset);\n\n    // Workaround select to empty line will get empty range\n    // If range is empty, range.getBoundingClientRect of range will return the empty value({ x: 0, y: 0 ...})\n    const isTextLikeNode =\n      targetNode.nodeType === Node.TEXT_NODE ||\n      targetNode.nodeType === Node.COMMENT_NODE ||\n      targetNode.nodeType === Node.CDATA_SECTION_NODE;\n    if (!isTextLikeNode) {\n      // Fallback to use whole range\n      lineRange.setStart(startContainer, startOffset);\n      lineRange.setEnd(endContainer, endOffset);\n    }\n\n    // Workaround line edge range\n    // When selecting from left to the end of right, the edge rect is expected\n    // But when selecting from right to the start of left, the edge rect is not expected\n    if (direction.includes('left')) {\n      // Shift the range when the selection is selected to the left edge of the line\n      const maybeShiftRange = isAtLineEdge(lineRange);\n      if (maybeShiftRange) {\n        lineRange.setStart(\n          maybeShiftRange.startContainer,\n          maybeShiftRange.startOffset\n        );\n        lineRange.setEnd(\n          maybeShiftRange.endContainer,\n          maybeShiftRange.endOffset\n        );\n      }\n    }\n  }\n\n  // resetNativeSelection(lineRange);\n\n  const lineRect = lineRange.getBoundingClientRect();\n  const isBottom = direction.includes('bottom');\n  const positioningPoint = {\n    // Use the center of the position rect\n    x: lineRect.x + lineRect.width / 2,\n    // if the direction is bottom, use the bottom of the position rect\n    y: lineRect.y + (isBottom ? lineRect.height : 0),\n  };\n  return positioningPoint;\n}\n/**\n * This function is used to calculate the position of the format bar.\n *\n * After update block type, the native selection may be change to block selection,\n * for example, update block to code block.\n * So we need to get the targe block's rect dynamic.\n */\nexport function calcCurrentSelectionPosition(\n  direction: DragDirection,\n  // Edgeless mode not have pageSelectionState\n  pageSelectionState?: PageSelectionState\n) {\n  if (!pageSelectionState || !pageSelectionState.selectedBlocks.length) {\n    if (!hasNativeSelection()) {\n      throw new Error(\n        \"Failed to get anchor element! There's no block selection or native selection.\"\n      );\n    }\n    // Native selection\n    const range = getCurrentNativeRange();\n    const positioningPoint = calcPositionPointByRange(range, direction);\n    return positioningPoint;\n  }\n  // Block selection\n  const blocks = pageSelectionState.selectedBlocks;\n  const firstBlock = blocks[0];\n  const lastBlock = blocks[blocks.length - 1];\n  const targetBlock = direction.includes('bottom') ? lastBlock : firstBlock;\n  // Block selection always use the center of the block\n  const rect = targetBlock.getBoundingClientRect();\n  const x = rect.x + rect.width / 2;\n  const y = direction.includes('bottom') ? rect.bottom : rect.top;\n  return { x, y };\n}\n\ntype CollisionBox = {\n  /**\n   * The point that the objRect is positioned to.\n   */\n  positioningPoint: { x: number; y: number };\n  /**\n   * The boundary rect of the obj that is being positioned.\n   */\n  objRect?: { height: number; width: number };\n  /**\n   * The boundary rect of the container that the obj is in.\n   */\n  boundaryRect?: DOMRect;\n  offsetX?: number;\n  offsetY?: number;\n  edgeGap?: number;\n};\n\nexport function calcSafeCoordinate({\n  positioningPoint,\n  objRect = { width: 0, height: 0 },\n  boundaryRect = document.body.getBoundingClientRect(),\n  offsetX = 0,\n  offsetY = 0,\n  edgeGap = 20,\n}: CollisionBox) {\n  const safeX = clamp(\n    positioningPoint.x + offsetX,\n    edgeGap,\n    boundaryRect.width - objRect.width - edgeGap\n  );\n  const y = positioningPoint.y + offsetY;\n  // Not use clamp for y coordinate to avoid the quick bar always showing after scrolling\n  // const safeY = clamp(\n  //   positioningPoint.y + offsetY,\n  //   edgeGap,\n  //   boundaryRect.height - objRect.height - edgeGap\n  // );\n  return {\n    x: safeX,\n    y,\n  };\n}\n\n/**\n * Used to compare the space available\n * at the top and bottom of an element within a container.\n *\n * Please give preference to {@link getPopperPosition}\n */\nexport function compareTopAndBottomSpace(\n  obj: { getBoundingClientRect: () => DOMRect },\n  container = document.body,\n  gap = 20\n) {\n  const objRect = obj.getBoundingClientRect();\n  const spaceRect = container.getBoundingClientRect();\n  const topSpace = objRect.top - spaceRect.top;\n  const bottomSpace = spaceRect.bottom - objRect.bottom;\n  const topOrBottom: 'top' | 'bottom' =\n    topSpace > bottomSpace ? 'top' : 'bottom';\n  return {\n    placement: topOrBottom,\n    // the height is the available space.\n    height: (topOrBottom === 'top' ? topSpace : bottomSpace) - gap,\n  };\n}\n\n/**\n * Get the position of the popper element with flip.\n */\nexport function getPopperPosition(\n  popper: {\n    getBoundingClientRect: () => DOMRect;\n  },\n  reference: {\n    getBoundingClientRect: () => DOMRect;\n  },\n  { gap = 12, offsetY = 5 }: { gap?: number; offsetY?: number } = {}\n) {\n  if (!popper) {\n    // foolproof, someone may use element with non-null assertion\n    console.warn(\n      'The popper element is not exist. Popper position maybe incorrect'\n    );\n  }\n  const { placement, height } = compareTopAndBottomSpace(\n    reference,\n    document.body,\n    gap + offsetY\n  );\n\n  const referenceRect = reference.getBoundingClientRect();\n  const positioningPoint = {\n    x: referenceRect.x,\n    y: referenceRect.y + (placement === 'bottom' ? referenceRect.height : 0),\n  };\n\n  // TODO maybe use the editor container as the boundary rect to avoid the format bar being covered by other elements\n  const boundaryRect = document.body.getBoundingClientRect();\n  // Note: the popperRect.height maybe incorrect\n  // because we are calculated its correct height\n  const popperRect = popper?.getBoundingClientRect();\n\n  const safeCoordinate = calcSafeCoordinate({\n    positioningPoint,\n    objRect: popperRect,\n    boundaryRect,\n    offsetY: placement === 'bottom' ? offsetY : -offsetY,\n  });\n\n  return {\n    placement,\n    /**\n     * The height is the available space height.\n     *\n     * Note: it's a max height, not the real height,\n     * because sometimes the popper's height is smaller than the available space.\n     */\n    height,\n    x: `${safeCoordinate.x}px`,\n    y:\n      placement === 'bottom'\n        ? `${safeCoordinate.y}px`\n        : // We need to use `calc(-100%)` since the height of popper maybe incorrect\n          `calc(${safeCoordinate.y}px - 100%)`,\n  };\n}\n", "type ScoreFunction<T> = (element: T) => number;\n\nexport class BinaryHeap<T> {\n  private _content: T[] = [];\n  private _scoreFunction: ScoreFunction<T>;\n\n  constructor(scoreFunction: ScoreFunction<T>) {\n    this._scoreFunction = scoreFunction;\n  }\n\n  push(element: T) {\n    // Add the new element to the end of the array.\n    this._content.push(element);\n\n    // Allow it to sink down.\n    this.sinkDown(this._content.length - 1);\n  }\n\n  pop() {\n    const { _content } = this;\n    // Store the first element so we can return it later.\n    const result = _content[0];\n    // Get the element at the end of the array.\n    const end = _content.pop();\n    // If there are any elements left, put the end element at the\n    // start, and let it bubble up.\n    if (_content.length > 0) {\n      _content[0] = end as T;\n      this.bubbleUp(0);\n    }\n    return result;\n  }\n\n  remove(element: T) {\n    const { _content, _scoreFunction } = this;\n    const i = _content.indexOf(element);\n\n    // When it is found, the process seen in 'pop' is repeated\n    // to fill up the hole.\n    const end = _content.pop();\n\n    if (i !== _content.length - 1) {\n      _content[i] = end as T;\n\n      if (_scoreFunction(end as T) < _scoreFunction(element)) {\n        this.sinkDown(i);\n      } else {\n        this.bubbleUp(i);\n      }\n    }\n  }\n\n  size() {\n    return this._content.length;\n  }\n\n  rescoreElement(element: T) {\n    this.sinkDown(this._content.indexOf(element));\n  }\n\n  sinkDown(n: number) {\n    const { _content, _scoreFunction } = this;\n    // Fetch the element that has to be sunk.\n    const element = this._content[n];\n\n    // When at 0, an element can not sink any further.\n    while (n > 0) {\n      // Compute the parent element's index, and fetch it.\n      const parentN = ((n + 1) >> 1) - 1;\n      const parent = _content[parentN];\n      // Swap the elements if the parent is greater.\n      if (_scoreFunction(element) < _scoreFunction(parent)) {\n        _content[parentN] = element;\n        _content[n] = parent;\n        // Update 'n' to continue at the new position.\n        n = parentN;\n      }\n      // Found a parent that is less, no need to sink any further.\n      else {\n        break;\n      }\n    }\n  }\n\n  bubbleUp(n: number) {\n    const { _content, _scoreFunction } = this;\n    // Look up the target element and its score.\n    const length = _content.length;\n    const element = _content[n];\n    const elemScore = _scoreFunction(element);\n\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      // Compute the indices of the child elements.\n      const child2N = (n + 1) << 1;\n      const child1N = child2N - 1;\n      // This is used to store the new position of the element, if any.\n      let swap: number | null = null;\n      let child1Score: number | null = null;\n      // If the first child exists (is inside the array)...\n      if (child1N < length) {\n        // Look it up and compute its score.\n        const child1 = _content[child1N];\n        child1Score = _scoreFunction(child1);\n\n        // If the score is less than our element's, we need to swap.\n        if (child1Score < elemScore) {\n          swap = child1N;\n        }\n      }\n\n      // Do the same checks for the other child.\n      if (child2N < length) {\n        const child2 = _content[child2N];\n        const child2Score = _scoreFunction(child2);\n        if (\n          child2Score < (swap === null ? elemScore : (child1Score as number))\n        ) {\n          swap = child2N;\n        }\n      }\n\n      // If the element needs to be moved, swap it, and continue.\n      if (swap !== null) {\n        _content[n] = _content[swap];\n        _content[swap] = element;\n        n = swap;\n      }\n      // Otherwise, we are done.\n      else {\n        break;\n      }\n    }\n  }\n}\n", "import type { Graph, GraphNode } from './graph.js';\nimport { BinaryHeap } from './heap.js';\nimport type { Point } from './simplify-path.js';\n\ntype HeuristicFunction = (start: Point, end: Point) => number;\n\nfunction manhattan(start: Point, end: Point) {\n  return Math.abs(start.x - end.x) + Math.abs(start.y - end.y);\n}\n\nfunction pathTo(element: GraphNode) {\n  let curr = element;\n  const path = [];\n  while (curr.parent) {\n    path.unshift(curr);\n    curr = curr.parent;\n  }\n  path.unshift(curr);\n  return path;\n}\n\nexport function aStarRoute(\n  graph: Pick<Graph, 'neighbors'>,\n  start: GraphNode,\n  end: GraphNode,\n  heuristic: HeuristicFunction = manhattan\n) {\n  const openHeap = new BinaryHeap<GraphNode>(element => element.f);\n\n  start.h = heuristic(start, end);\n\n  openHeap.push(start);\n\n  while (openHeap.size() > 0) {\n    // Grab the lowest f(x) to process next.  Heap keeps this sorted for us.\n    const currentNode = openHeap.pop();\n\n    // End case -- result has been found, return the traced path.\n    if (currentNode === end) {\n      return pathTo(currentNode);\n    }\n\n    // Normal case -- move currentNode from open to closed, process each of its neighbors.\n    currentNode.closed = true;\n\n    // Find all neighbors for the current node.\n    const neighbors = graph.neighbors(currentNode);\n\n    for (let i = 0, il = neighbors.length; i < il; ++i) {\n      const neighbor = neighbors[i];\n\n      if (neighbor.closed) {\n        // Not a valid node to process, skip to next neighbor.\n        continue;\n      }\n\n      // The g score is the shortest distance from start to current node.\n      // We need to check if the path we have arrived at this neighbor is the shortest one we have seen yet.\n      const gScore = currentNode.g + neighbor.cost(currentNode);\n      const beenVisited = neighbor.visited;\n\n      if (!beenVisited || gScore < neighbor.g) {\n        // Found an optimal (so far) path to this node.  Take score for node to see how good it is.\n        neighbor.visited = true;\n        neighbor.parent = currentNode;\n        neighbor.h = neighbor.h || heuristic(neighbor, end);\n        neighbor.g = gScore;\n        neighbor.f = neighbor.g + neighbor.h;\n\n        if (!beenVisited) {\n          // Pushing to heap will put it in proper place based on the 'f' value.\n          openHeap.push(neighbor);\n        } else {\n          // Already seen the node, but since it has been rescored we need to reorder it in the heap\n          openHeap.rescoreElement(neighbor);\n        }\n      }\n    }\n  }\n\n  // No result was found - empty array signifies failure to find path.\n  return [];\n}\n", "import type { Point } from './simplify-path.js';\n\nexport interface GraphNode {\n  x: number;\n  y: number;\n  parent: GraphNode | null;\n  cost(fromElement: GraphNode): number;\n\n  f: number;\n  h: number;\n  g: number;\n  closed?: boolean;\n  visited?: boolean;\n}\n\nfunction isDirectionChanged(p: Point, fromNode: GraphNode) {\n  if (fromNode.parent) {\n    if (\n      (fromNode.x === fromNode.parent.x && fromNode.x !== p.x) ||\n      (fromNode.y === fromNode.parent.y && fromNode.y !== p.y)\n    ) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport class Graph {\n  nodes: Record<string, GraphNode> = {};\n  edges: Record<string, Set<string>> = {};\n  connections: Array<GraphNode[]> = [];\n\n  gridX: number[] = [];\n  gridY: number[] = [];\n\n  constructor(points: Point[]) {\n    this._init(points);\n  }\n\n  private _init(points: Point[]) {\n    this._addGraphNodesAndInitGrid(points);\n    this._linkGraphNodes();\n  }\n\n  private _createGraphNode(p: Point): GraphNode {\n    return {\n      x: p.x,\n      y: p.y,\n      parent: null,\n      cost: (fromNode: GraphNode) => {\n        const basic = Math.abs(p.x - fromNode.x) + Math.abs(p.y - fromNode.y);\n        const directionChanged = isDirectionChanged(p, fromNode);\n        return basic + (directionChanged ? 10 : 0);\n      },\n      f: 0,\n      h: 0,\n      g: 0,\n    };\n  }\n\n  private _addGraphNodesAndInitGrid(points: Point[]) {\n    const xs = new Set<number>();\n    const ys = new Set<number>();\n\n    points.forEach(p => {\n      const node = this._createGraphNode(p);\n      xs.add(p.x);\n      ys.add(p.y);\n      const key = Graph.getKey(p);\n      this.nodes[key] = node;\n      this.edges[key] = new Set();\n    });\n\n    this.gridX = [...xs.values()].sort((a, b) => a - b);\n    this.gridY = [...ys.values()].sort((a, b) => a - b);\n  }\n\n  private _linkGraphNodes() {\n    const { gridX, gridY } = this;\n    for (let i = 0; i < gridX.length; i++) {\n      for (let j = 0; j < gridY.length; j++) {\n        const key = Graph.getKey({ x: gridX[i], y: gridY[j] });\n        if (!this.nodes[key]) {\n          continue;\n        }\n        if (j > 0) {\n          const topKey = Graph.getKey({ x: gridX[i], y: gridY[j - 1] });\n          if (this.nodes[topKey]) {\n            this.edges[key].add(topKey);\n            this.edges[topKey].add(key);\n            this.connections.push([this.nodes[key], this.nodes[topKey]]);\n          }\n        }\n        if (i > 0) {\n          const leftKey = Graph.getKey({ x: gridX[i - 1], y: gridY[j] });\n          if (this.nodes[leftKey]) {\n            this.edges[key].add(leftKey);\n            this.edges[leftKey].add(key);\n            this.connections.push([this.nodes[key], this.nodes[leftKey]]);\n          }\n        }\n      }\n    }\n  }\n\n  neighbors(node: GraphNode) {\n    const key = Graph.getKey(node);\n    const n: GraphNode[] = [];\n    this.edges[key].forEach(k => {\n      n.push(this.nodes[k]);\n    });\n    return n;\n  }\n\n  getNode(p: Point) {\n    const k = Graph.getKey(p);\n    return this.nodes[k];\n  }\n\n  static getKey({ x, y }: Point) {\n    return `${x}:${y}`;\n  }\n\n  static parseKey(key: string): Point {\n    const [x, y] = key.split(':').map(n => Number(n));\n    return { x, y };\n  }\n}\n", "import { Graph } from '../graph.js';\nimport type { Rectangle } from '../rectangle.js';\nimport type { Point } from '../simplify-path.js';\nimport type { Rulers } from './types.js';\n\ntype FindPointInRect = (x: number, y: number) => Rectangle | undefined;\ntype AddPoint = (x: number, y: number, force?: boolean) => void;\ntype HasPoint = (x: number, y: number) => boolean;\n\nfunction createValidNodesAndGrid(findPointInRect: FindPointInRect) {\n  const nodes: Point[] = [];\n  const cache: Set<string> = new Set();\n  const gridX: Set<number> = new Set();\n  const gridY: Set<number> = new Set();\n\n  const addPoint: AddPoint = (x: number, y: number, force = false) => {\n    if (!force && findPointInRect(x, y)) {\n      return;\n    }\n    const p = { x, y };\n    const key = Graph.getKey(p);\n    if (cache.has(key)) {\n      return;\n    }\n    cache.add(key);\n    gridX.add(x);\n    gridY.add(y);\n    nodes.push(p);\n  };\n\n  const hasPoint: HasPoint = (x: number, y: number) => {\n    const key = Graph.getKey({ x, y });\n    return cache.has(key);\n  };\n\n  return {\n    nodes,\n    getGrid: () => {\n      const sortedGridX = [...gridX.values()].sort((a, b) => a - b);\n      const sortedGridY = [...gridY.values()].sort((a, b) => a - b);\n      return {\n        gridX: sortedGridX,\n        gridY: sortedGridY,\n      };\n    },\n    addPoint,\n    hasPoint,\n  };\n}\n\nfunction addRulersPoints(rulers: Rulers, addPoint: AddPoint) {\n  const { rows, columns } = rulers;\n  for (let i = 0; i < rows.length; i++) {\n    const isRowEdge = i === 0 || i === rows.length - 2;\n    for (let j = 0; j < columns.length; j++) {\n      const isColumnEdge = j === 0 || j === columns.length - 2;\n\n      const currentX = columns[j];\n      const currentY = rows[i];\n      addPoint(currentX, currentY);\n\n      const nextX = isColumnEdge ? undefined : columns[j + 1];\n      const nextY = isRowEdge ? undefined : rows[i + 1];\n\n      if (nextX) {\n        addPoint((currentX + nextX) / 2, currentY);\n      }\n      if (nextY) {\n        addPoint(currentX, (currentY + nextY) / 2);\n      }\n      if (nextX && nextY) {\n        addPoint((currentX + nextX) / 2, (currentY + nextY) / 2);\n      }\n    }\n  }\n}\n\nfunction forceAddPointsAsNodes(\n  points: Point[],\n  gridX: number[],\n  gridY: number[],\n  addPoint: AddPoint,\n  hasPoint: HasPoint,\n  findPointInRect: FindPointInRect\n) {\n  points.forEach(p => {\n    const rect = findPointInRect(p.x, p.y);\n    if (rect) {\n      const direction = rect.relativeDirection(p.x, p.y);\n      switch (direction) {\n        case 'left': {\n          let index = gridX.indexOf(p.x);\n          while (index > -1) {\n            const columnsValue = gridX[index];\n            if (hasPoint(columnsValue, p.y)) {\n              break;\n            }\n            addPoint(columnsValue, p.y, true);\n            index--;\n          }\n          break;\n        }\n        case 'right': {\n          let index = gridX.indexOf(p.x);\n          while (index < gridX.length) {\n            const columnsValue = gridX[index];\n            if (hasPoint(columnsValue, p.y)) {\n              break;\n            }\n            addPoint(columnsValue, p.y, true);\n            index++;\n          }\n          break;\n        }\n        case 'top': {\n          let index = gridY.indexOf(p.y);\n          while (index > -1) {\n            const rowsValue = gridY[index];\n            if (hasPoint(p.x, rowsValue)) {\n              break;\n            }\n            addPoint(p.x, rowsValue, true);\n            index--;\n          }\n          break;\n        }\n        case 'bottom': {\n          let index = gridY.indexOf(p.y);\n          while (index < gridY.length) {\n            const rowsValue = gridY[index];\n            if (hasPoint(p.x, rowsValue)) {\n              break;\n            }\n            addPoint(p.x, rowsValue, true);\n            index++;\n          }\n          break;\n        }\n      }\n    }\n  });\n}\n\nexport function createNodes(\n  rulers: Rulers,\n  rectangles: Rectangle[],\n  points: Point[]\n): Point[] {\n  const findPointInRect: FindPointInRect = (x, y) =>\n    rectangles.find(r => r.contains(x, y));\n  const { nodes, addPoint, hasPoint, getGrid } =\n    createValidNodesAndGrid(findPointInRect);\n\n  addRulersPoints(rulers, addPoint);\n  const { gridX, gridY } = getGrid();\n  forceAddPointsAsNodes(\n    points,\n    gridX,\n    gridY,\n    addPoint,\n    hasPoint,\n    findPointInRect\n  );\n\n  return nodes;\n}\n", "import type { Rectangle } from '../rectangle.js';\nimport type { Point } from '../simplify-path.js';\nimport type { Rulers } from './types.js';\n\n/**\n * Generating a set of horizontal and vertical rulers based on the provided rectangles, points, and margin\n * @param rectangles\n * @param points\n * @param margin [horizontal, vertical]\n * @returns\n */\nexport function createRulers(\n  rectangles: Rectangle[],\n  points: Point[],\n  margin: number[]\n): Rulers {\n  const columns = new Set<number>();\n  const rows = new Set<number>();\n\n  rectangles.forEach(rect => {\n    columns.add(rect.minX);\n    columns.add(rect.maxX);\n    rows.add(rect.minY);\n    rows.add(rect.maxY);\n  });\n\n  points.forEach(p => {\n    columns.add(p.x);\n    rows.add(p.y);\n  });\n  const sortedColumns = [...columns.values()].sort((a, b) => a - b);\n  const sortedRows = [...rows.values()].sort((a, b) => a - b);\n  return {\n    columns: [\n      sortedColumns[0] - margin[0],\n      ...sortedColumns,\n      sortedColumns[sortedColumns.length - 1] + margin[0],\n    ],\n    rows: [\n      sortedRows[0] - margin[1],\n      ...sortedRows,\n      sortedRows[sortedRows.length - 1] + margin[1],\n    ],\n  };\n}\n", "import { Graph } from '../graph.js';\nimport type { Rectangle } from '../rectangle.js';\nimport type { Point } from '../simplify-path.js';\nimport type { CreateGraphReturned } from './types.js';\n\n/**\n * The function checks if manual node generation is applicable under the following conditions:\n * 1. There are no rectangles.\n * 2. There is only one rectangle and two points, and:\n *    - Both points are on the left, right, top, or bottom of the rectangle.\n *    - At least one point is inside the rectangle.\n */\nexport function shouldManualGenerateGraph(\n  rectangles: Rectangle[],\n  points: Point[]\n) {\n  if (!rectangles.length) {\n    return true;\n  }\n  if (rectangles.length !== 1 || points.length !== 2) {\n    return false;\n  }\n  const p0x = points[0].x;\n  const p0y = points[0].y;\n  const p1x = points[1].x;\n  const p1y = points[1].y;\n\n  const rect = rectangles[0];\n  const { x, y, maxX, maxY } = rect;\n\n  const pointsBothOnLeft = p0x <= x && p1x <= rect.x;\n  const pointsBothOnRight = p0x >= maxX && p1x >= maxX;\n  const pointsBothOnTop = p0y <= y && p1y <= y;\n  const pointsBothOnBottom = p0y >= maxY && p1y >= maxY;\n\n  if (\n    pointsBothOnLeft ||\n    pointsBothOnRight ||\n    pointsBothOnTop ||\n    pointsBothOnBottom\n  ) {\n    return true;\n  }\n  return false;\n}\n\n// Generates a set of nodes manually given a set of rectangles and points.\n// This is useful for simpler cases where path-finding generation is not required.\nexport function manualGenerateGraph(\n  rectangles: Rectangle[],\n  points: Point[]\n): CreateGraphReturned {\n  // Determine if the rectangles and points are aligned vertically.\n  const isVertical =\n    rectangles.length === 1 &&\n    ((points[0].y <= rectangles[0].y && points[1].y <= rectangles[0].y) ||\n      (points[0].y >= rectangles[0].maxY && points[1].y >= rectangles[0].maxY));\n\n  // Calculate the edge centers based on whether the alignment is vertical or horizontal.\n  const edgeCenters = isVertical\n    ? [\n        { x: points[0].x, y: (points[0].y + points[1].y) / 2 },\n        { x: points[1].x, y: (points[0].y + points[1].y) / 2 },\n      ]\n    : [\n        { x: (points[0].x + points[1].x) / 2, y: points[0].y },\n        { x: (points[0].x + points[1].x) / 2, y: points[1].y },\n      ];\n\n  // Create an array of nodes that include the provided points, edge centers,\n  // and the center of the two points.\n  const nodes = [\n    ...points,\n    ...edgeCenters,\n    {\n      x: (points[0].x + points[1].x) / 2,\n      y: (points[0].y + points[1].y) / 2,\n    },\n  ];\n\n  const graph = new Graph(nodes);\n\n  return {\n    rectangles,\n    points,\n    inflatedRectangles: [],\n    rulers: { rows: [], columns: [] },\n    nodes,\n    graph,\n  };\n}\n", "import { Graph } from '../graph.js';\nimport type { Rectangle } from '../rectangle.js';\nimport type { Point } from '../simplify-path.js';\nimport { createNodes } from './create-nodes.js';\nimport { createRulers } from './create-rulers.js';\nimport {\n  manualGenerateGraph,\n  shouldManualGenerateGraph,\n} from './manual-generate-graph.js';\nimport type { CreateGraphReturned } from './types.js';\n\nexport function createGraph(\n  rectangles: Rectangle[],\n  points: Point[],\n  margin = [10, 10]\n): CreateGraphReturned {\n  if (shouldManualGenerateGraph(rectangles, points)) {\n    return manualGenerateGraph(rectangles, points);\n  }\n\n  const inflatedRects = rectangles.map(r => r.inflate(margin[0], margin[1]));\n  const rulers = createRulers(inflatedRects, points, margin);\n  const nodes = createNodes(rulers, inflatedRects, points);\n  const graph = new Graph(nodes);\n  return {\n    rectangles,\n    points,\n    inflatedRectangles: inflatedRects,\n    rulers,\n    nodes,\n    graph,\n  };\n}\n", "export type Direction = 'left' | 'top' | 'right' | 'bottom';\n\nexport class Rectangle {\n  readonly id = Math.random().toString(16).slice(2);\n  x: number;\n  y: number;\n  w: number;\n  h: number;\n\n  constructor(x: number, y: number, w: number, h: number) {\n    this.x = x;\n    this.y = y;\n    this.w = w;\n    this.h = h;\n  }\n\n  get minX() {\n    return this.x;\n  }\n\n  get maxX() {\n    return this.x + this.w;\n  }\n\n  get minY() {\n    return this.y;\n  }\n\n  get maxY() {\n    return this.y + this.h;\n  }\n\n  inflate(horizontal: number, vertical: number) {\n    return new Rectangle(\n      this.x - horizontal,\n      this.y - vertical,\n      this.w + horizontal * 2,\n      this.h + vertical * 2\n    );\n  }\n\n  contains(x: number, y: number) {\n    return x >= this.minX && x <= this.maxX && y >= this.minY && y <= this.maxY;\n  }\n\n  relativeDirection(x: number, y: number) {\n    const directionValues: Record<Direction, number> = {\n      left: Math.abs(x - this.x),\n      right: Math.abs(x - this.x - this.w),\n      top: Math.abs(y - this.y),\n      bottom: Math.abs(y - this.y - this.h),\n    };\n\n    let min!: number;\n    let d = 'top' as Direction;\n    (Object.entries(directionValues) as [Direction, number][]).forEach(\n      ([k, v]) => {\n        if (min === undefined) {\n          min = v;\n          d = k;\n        } else {\n          if (v < min) {\n            min = v;\n            d = k;\n          }\n        }\n      }\n    );\n    return d;\n  }\n}\n", "/**\n * From https://github.com/mourner/simplify-js/blob/master/simplify.js\n */\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\n// square distance between 2 points\nfunction getSqDist(p1: Point, p2: Point) {\n  const dx = p1.x - p2.x,\n    dy = p1.y - p2.y;\n\n  return dx * dx + dy * dy;\n}\n\n// square distance from a point to a segment\nfunction getSqSegDist(p: Point, p1: Point, p2: Point) {\n  let x = p1.x,\n    y = p1.y,\n    dx = p2.x - x,\n    dy = p2.y - y;\n\n  if (dx !== 0 || dy !== 0) {\n    const t = ((p.x - x) * dx + (p.y - y) * dy) / (dx * dx + dy * dy);\n\n    if (t > 1) {\n      x = p2.x;\n      y = p2.y;\n    } else if (t > 0) {\n      x += dx * t;\n      y += dy * t;\n    }\n  }\n\n  dx = p.x - x;\n  dy = p.y - y;\n\n  return dx * dx + dy * dy;\n}\n\n// basic distance-based simplification\nfunction simplifyRadialDist(points: Point[], sqTolerance: number) {\n  let prevPoint = points[0];\n  const newPoints = [prevPoint];\n  let point!: Point;\n\n  for (let i = 1, len = points.length; i < len; i++) {\n    point = points[i];\n\n    if (getSqDist(point, prevPoint) > sqTolerance) {\n      newPoints.push(point);\n      prevPoint = point;\n    }\n  }\n\n  if (prevPoint !== point) newPoints.push(point);\n\n  return newPoints;\n}\n\nfunction simplifyDPStep(\n  points: Point[],\n  first: number,\n  last: number,\n  sqTolerance: number,\n  simplified: Point[]\n) {\n  let maxSqDist = sqTolerance;\n  let index = -1;\n\n  for (let i = first + 1; i < last; i++) {\n    const sqDist = getSqSegDist(points[i], points[first], points[last]);\n\n    if (sqDist > maxSqDist) {\n      index = i;\n      maxSqDist = sqDist;\n    }\n  }\n\n  if (maxSqDist > sqTolerance) {\n    if (index - first > 1)\n      simplifyDPStep(points, first, index, sqTolerance, simplified);\n    simplified.push(points[index]);\n    if (last - index > 1)\n      simplifyDPStep(points, index, last, sqTolerance, simplified);\n  }\n}\n\n// simplification using Ramer-Douglas-Peucker algorithm\nfunction simplifyDouglasPeucker(points: Point[], sqTolerance: number) {\n  const last = points.length - 1;\n\n  const simplified = [points[0]];\n  simplifyDPStep(points, 0, last, sqTolerance, simplified);\n  simplified.push(points[last]);\n\n  return simplified;\n}\n\n// both algorithms combined for awesome performance\nexport function simplifyPath(\n  points: Point[],\n  tolerance = 0,\n  highestQuality?: boolean\n) {\n  if (points.length <= 2) return points;\n\n  const sqTolerance = tolerance !== undefined ? tolerance * tolerance : 1;\n\n  points = highestQuality ? points : simplifyRadialDist(points, sqTolerance);\n  points = simplifyDouglasPeucker(points, sqTolerance);\n\n  return points;\n}\n", "import { aStarRoute } from './a-star.js';\nimport { createGraph } from './create-graph/create-graph.js';\nimport type { GraphNode } from './graph.js';\nimport type { Rectangle } from './rectangle.js';\nimport type { Point } from './simplify-path.js';\nimport { simplifyPath } from './simplify-path.js';\n\nexport function route(rectangles: Rectangle[], points: Point[]) {\n  const { graph } = createGraph(rectangles, points);\n  const start = graph.getNode(points[0]);\n  const end = graph.getNode(points[1]);\n  const routed = aStarRoute(graph, start, end);\n  const simplifiedRoute = simplifyPath(routed) as GraphNode[];\n  return simplifiedRoute;\n}\n", "import {\n  AlighLeftIcon,\n  AlignCenterIcon,\n  AlignRightIcon,\n} from '@blocksuite/global/config';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\n@customElement('edgeless-align-panel')\nexport class EdgelessAlignPanel extends LitElement {\n  static override styles = css`\n    :host {\n      display: block;\n      z-index: 2;\n    }\n    .align-panel-container {\n      display: flex;\n      flex-direction: row;\n      align-items: flex-start;\n      background: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-shadow-2);\n      border-radius: 8px;\n      fill: none;\n      stroke: currentColor;\n    }\n  `;\n\n  @property()\n  value: 'left' | 'center' | 'right' = 'left';\n\n  private _onSelect(value: EdgelessAlignPanel['value']) {\n    this.value = value;\n    if (this.onSelect) {\n      this.onSelect(value);\n    }\n  }\n  @property()\n  onSelect?: (value: EdgelessAlignPanel['value']) => void;\n\n  override render() {\n    return html`\n      <div class=\"align-panel-container\">\n        <edgeless-tool-icon-button\n          .tooltip=${'Left'}\n          .active=${this.value === 'left'}\n          @click=${() => {\n            this._onSelect('left');\n          }}\n        >\n          ${AlighLeftIcon}\n        </edgeless-tool-icon-button>\n        <edgeless-tool-icon-button\n          .tooltip=${'Center'}\n          .active=${this.value === 'center'}\n          @click=${() => {\n            this._onSelect('center');\n          }}\n        >\n          ${AlignCenterIcon}\n        </edgeless-tool-icon-button>\n        <edgeless-tool-icon-button\n          .tooltip=${'Right'}\n          .active=${this.value === 'right'}\n          @click=${() => {\n            this._onSelect('right');\n          }}\n        >\n          ${AlignRightIcon}\n        </edgeless-tool-icon-button>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-align-panel': EdgelessAlignPanel;\n  }\n}\n", "import { TransparentIcon } from '@blocksuite/global/config';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { CssVariableName } from '../../../__internal__/theme/css-variables.js';\n\nexport class ColorEvent extends Event {\n  detail: CssVariableName;\n\n  constructor(\n    type: string,\n    {\n      detail,\n      composed,\n      bubbles,\n    }: { detail: CssVariableName; composed: boolean; bubbles: boolean }\n  ) {\n    super(type, { bubbles, composed });\n    this.detail = detail;\n  }\n}\n\n// export class ColorEvent extends CustomEvent<RawCssVariableNames> {}\n\nconst DEFAULT_COLORS: CssVariableName[] = [\n  '--affine-palette-line-yellow',\n  '--affine-palette-line-orange',\n  '--affine-palette-line-tangerine',\n  '--affine-palette-line-red',\n  '--affine-palette-line-magenta',\n  '--affine-palette-line-purple',\n  '--affine-palette-line-green',\n  '--affine-palette-line-blue',\n  '--affine-palette-line-navy',\n  '--affine-palette-line-black',\n  '--affine-palette-line-grey',\n  '--affine-palette-line-white',\n];\nexport const DEFAULT_SELECTED_COLOR = DEFAULT_COLORS[9];\n\nexport function isTransparent(color: CssVariableName) {\n  return color.toLowerCase() === '--affine-palette-transparent';\n}\n\nfunction isSameColorWithBackground(color: CssVariableName) {\n  return [\n    '--affine-palette-line-white',\n    '--affine-palette-shape-white',\n  ].includes(color.toLowerCase());\n}\n\nfunction TransparentColor(hollowCircle = false) {\n  const containerStyle = {\n    position: 'relative',\n    width: '16px',\n    height: '16px',\n    stroke: 'none',\n  };\n  const maskStyle = {\n    position: 'absolute',\n    width: '10px',\n    height: '10px',\n    left: '3px',\n    top: '3.5px',\n    borderRadius: '50%',\n    background: 'var(--affine-popover-background)',\n  };\n\n  const mask = hollowCircle\n    ? html`<div style=${styleMap(maskStyle)}></div>`\n    : nothing;\n\n  return html`<div style=${styleMap(containerStyle)}>\n    ${TransparentIcon} ${mask}\n  </div>`;\n}\n\nfunction BorderedHollowCircle(color: CssVariableName) {\n  const strokeWidth = isSameColorWithBackground(color) ? 1 : 0;\n  const style = {\n    fill: `var(${color})`,\n    stroke: 'var(--affine-border-color)',\n  };\n  return html`<svg\n    width=\"16\"\n    height=\"16\"\n    viewBox=\"0 0 16 16\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      d=\"M12.3125 8C12.3125 10.3817 10.3817 12.3125 8 12.3125C5.61827 12.3125 3.6875 10.3817 3.6875 8C3.6875 5.61827 5.61827 3.6875 8 3.6875C10.3817 3.6875 12.3125 5.61827 12.3125 8ZM8 15.5C12.1421 15.5 15.5 12.1421 15.5 8C15.5 3.85786 12.1421 0.5 8 0.5C3.85786 0.5 0.5 3.85786 0.5 8C0.5 12.1421 3.85786 15.5 8 15.5Z\"\n      stroke-width=\"${strokeWidth}\"\n      style=${styleMap(style)}\n    />\n  </svg> `;\n}\n\nfunction AdditionIcon(color: CssVariableName, hollowCircle: boolean) {\n  if (isTransparent(color)) {\n    return TransparentColor(hollowCircle);\n  }\n  if (hollowCircle) {\n    return BorderedHollowCircle(color);\n  }\n  return nothing;\n}\n\nexport function ColorUnit(\n  color: CssVariableName,\n  {\n    hollowCircle,\n    letter,\n  }: {\n    hollowCircle?: boolean;\n    letter?: boolean;\n  } = {}\n) {\n  const additionIcon = AdditionIcon(color, !!hollowCircle);\n\n  const colorStyle = !hollowCircle ? { background: `var(${color})` } : {};\n\n  const borderStyle =\n    isSameColorWithBackground(color) && !hollowCircle\n      ? {\n          border: '1px solid var(--affine-border-color)',\n        }\n      : {};\n\n  const style = {\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    width: '16px',\n    height: '16px',\n    borderRadius: '50%',\n    boxSizing: 'border-box',\n    overflow: 'hidden',\n    ...borderStyle,\n    ...colorStyle,\n  };\n\n  return html`<div\n    class=\"color-unit\"\n    style=${styleMap(style)}\n    aria-label=${color.toLowerCase()}\n    data-letter=${letter ? 'A' : ''}\n  >\n    ${additionIcon}\n  </div>`;\n}\n\n@customElement('edgeless-color-panel')\nexport class EdgelessColorPanel extends LitElement {\n  static override styles = css`\n    :host {\n      display: flex;\n      width: 204px;\n      padding: 8px 12px;\n      flex-direction: row;\n      flex-wrap: wrap;\n      gap: 12px;\n      box-sizing: border-box;\n      background: var(--affine-popover-background);\n    }\n\n    .color-container {\n      display: flex;\n      width: 20px;\n      height: 20px;\n      border-radius: 50%;\n      box-sizing: border-box;\n      align-items: center;\n      justify-content: center;\n      overflow: hidden;\n      cursor: pointer;\n    }\n\n    .color-container[active] {\n      border: 1px solid var(--affine-primary-color);\n    }\n\n    .color-unit::before {\n      content: attr(data-letter);\n      display: block;\n      font-size: 12px;\n    }\n  `;\n\n  @property()\n  value?: CssVariableName;\n\n  @property()\n  options: CssVariableName[] = DEFAULT_COLORS;\n\n  @property()\n  showLetterMark = false;\n\n  @property()\n  hollowCircle = false;\n\n  private _onSelect(value: CssVariableName) {\n    this.dispatchEvent(\n      new ColorEvent('select', {\n        detail: value,\n        composed: true,\n        bubbles: true,\n      })\n    );\n    this.value = value;\n  }\n\n  override render() {\n    return repeat(\n      this.options,\n      color => color,\n      color => {\n        const unit = ColorUnit(color, {\n          hollowCircle: this.hollowCircle,\n          letter: this.showLetterMark,\n        });\n\n        return html`\n          <div\n            class=\"color-container\"\n            ?active=${color === this.value}\n            @click=${() => this._onSelect(color)}\n          >\n            ${unit}\n          </div>\n        `;\n      }\n    );\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-color-panel': EdgelessColorPanel;\n  }\n}\n", "import type { SurfaceViewport } from '@blocksuite/phasor';\nimport { Bound, getCommonBound } from '@blocksuite/phasor';\nimport type { Disposable } from '@blocksuite/store';\nimport { createPopper } from '@popperjs/core';\nimport { html } from 'lit';\n\nimport type { Selectable } from '../selection-manager.js';\nimport { getSelectionBoxBound, getXYWH, isTopLevelBlock } from '../utils.js';\n\nexport function getCommonRectStyle(\n  rect: DOMRect,\n  active = false,\n  selected = false\n) {\n  return {\n    '--affine-border-width': `${active ? 2 : 1}px`,\n    left: rect.x + 'px',\n    top: rect.y + 'px',\n    width: rect.width + 'px',\n    height: rect.height + 'px',\n    backgroundColor: !active && selected ? 'var(--affine-hover-color)' : '',\n  };\n}\n\nexport function getSelectedRect(\n  selected: Selectable[],\n  viewport: SurfaceViewport\n): DOMRect {\n  if (selected.length === 0) {\n    return new DOMRect(0, 0, 0, 0);\n  }\n  const rects = selected.map(selectable => {\n    const { x, y, width, height } = getSelectionBoxBound(\n      viewport,\n      getXYWH(selectable)\n    );\n\n    return {\n      x,\n      y,\n      w: width,\n      h: height,\n    };\n  });\n\n  const commonBound = getCommonBound(rects);\n  return new DOMRect(\n    commonBound?.x,\n    commonBound?.y,\n    commonBound?.w,\n    commonBound?.h\n  );\n}\n\nexport function getSelectableBounds(\n  selected: Selectable[]\n): Map<string, Bound> {\n  const bounds = new Map<string, Bound>();\n  for (const s of selected) {\n    let bound: Bound;\n    if (isTopLevelBlock(s)) {\n      bound = Bound.deserialize(getXYWH(s));\n    } else {\n      bound = new Bound(s.x, s.y, s.w, s.h);\n    }\n    bounds.set(s.id, bound);\n  }\n  return bounds;\n}\n\nexport function listenClickAway(\n  element: HTMLElement,\n  onClickAway: () => void\n): Disposable {\n  const callback = (event: MouseEvent) => {\n    const inside = event.composedPath().includes(element);\n    if (!inside) {\n      onClickAway();\n    }\n  };\n\n  document.addEventListener('click', callback);\n\n  return {\n    dispose: () => {\n      document.removeEventListener('click', callback);\n    },\n  };\n}\n\nconst ATTR_SHOW = 'data-show';\n/**\n * Using attribute 'data-show' to control popper visibility.\n *\n * ```css\n * selector {\n *   display: none;\n * }\n * selector[data-show] {\n *   display: block;\n * }\n * ```\n */\nexport function createButtonPopper(\n  reference: HTMLElement,\n  popperElement: HTMLElement,\n  stateUpdated: (state: { display: 'show' | 'hidden' }) => void = () => {\n    /** DEFAULT EMPTY FUNCTION */\n  }\n) {\n  const popper = createPopper(reference, popperElement, {\n    placement: 'top',\n    modifiers: [\n      {\n        name: 'offset',\n        options: {\n          offset: [0, 12],\n        },\n      },\n    ],\n  });\n\n  const show = () => {\n    popperElement.setAttribute(ATTR_SHOW, '');\n    popper.setOptions(options => ({\n      ...options,\n      modifiers: [\n        ...(options.modifiers ?? []),\n        { name: 'eventListeners', enabled: false },\n      ],\n    }));\n    popper.update();\n    stateUpdated({ display: 'show' });\n  };\n\n  const hide = () => {\n    popperElement.removeAttribute(ATTR_SHOW);\n\n    popper.setOptions(options => ({\n      ...options,\n      modifiers: [\n        ...(options.modifiers ?? []),\n        { name: 'eventListeners', enabled: false },\n      ],\n    }));\n    stateUpdated({ display: 'hidden' });\n  };\n\n  const toggle = () => {\n    if (popperElement.hasAttribute(ATTR_SHOW)) {\n      hide();\n    } else {\n      show();\n    }\n  };\n\n  const clickAway = listenClickAway(reference, () => hide());\n\n  return {\n    popper,\n    show,\n    hide,\n    toggle,\n    dispose: () => {\n      popper.destroy();\n      clickAway.dispose();\n    },\n  };\n}\n\nexport function getTooltipWithShortcut(tip: string, shortcut: string) {\n  return html`<span>${tip}</span\n    ><span style=\"margin-left: 10px;\">(${shortcut})</span>`;\n}\n", "import '../align-panel.js';\n\nimport {\n  AlighLeftIcon,\n  AlignCenterIcon,\n  AlignRightIcon,\n} from '@blocksuite/global/config';\nimport { WithDisposable } from '@blocksuite/lit';\nimport type { SurfaceManager, TextElement } from '@blocksuite/phasor';\nimport type { Page } from '@blocksuite/store';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\n\nimport type { CssVariableName } from '../../../../__internal__/theme/css-variables.js';\nimport { countBy, maxBy } from '../../../../__internal__/utils/std.js';\nimport type { EdgelessSelectionSlots } from '../../edgeless-page-block.js';\nimport type { EdgelessSelectionState } from '../../selection-manager.js';\nimport type { EdgelessAlignPanel } from '../align-panel.js';\nimport { type ColorEvent, ColorUnit } from '../color-panel.js';\nimport { createButtonPopper } from '../utils.js';\n\nfunction getMostCommonColor(texts: TextElement[]): TextElement['color'] | null {\n  const colors = countBy(texts, (text: TextElement) => text.color);\n  const max = maxBy(Object.entries(colors), ([k, count]) => count);\n  return max ? (max[0] as TextElement['color']) : null;\n}\n\nfunction getMostCommonAlign(texts: TextElement[]): TextElement['textAlign'] {\n  const aligns = countBy(texts, (text: TextElement) => text.textAlign);\n  const max = maxBy(Object.entries(aligns), ([k, count]) => count);\n  return max ? (max[0] as TextElement['textAlign']) : 'left';\n}\n\nconst TEXT_COLORS: CssVariableName[] = [\n  '--affine-palette-line-yellow',\n  '--affine-palette-line-orange',\n  '--affine-palette-line-tangerine',\n  '--affine-palette-line-red',\n  '--affine-palette-line-magenta',\n  '--affine-palette-line-purple',\n  '--affine-palette-line-navy',\n  '--affine-palette-line-blue',\n  '--affine-palette-line-green',\n  '--affine-palette-line-white',\n  '--affine-palette-line-black',\n  '--affine-palette-line-grey',\n];\nexport const DEFAULT_TEXT_COLOR = TEXT_COLORS[10];\n\n@customElement('edgeless-change-text-button')\nexport class EdgelessChangeTextButton extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n      justify-content: center;\n      color: var(--affine-text-primary-color);\n      stroke: none;\n      fill: currentColor;\n    }\n\n    .color-panel-container,\n    .align-panel-container {\n      display: none;\n      padding: 4px;\n      justify-content: center;\n      align-items: center;\n      background: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-shadow-2);\n      border-radius: 8px;\n    }\n\n    .color-panel-container[data-show],\n    .align-panel-container[data-show] {\n      display: block;\n    }\n  `;\n\n  @property()\n  texts: TextElement[] = [];\n\n  @property()\n  page!: Page;\n\n  @property()\n  surface!: SurfaceManager;\n\n  @property()\n  selectionState!: EdgelessSelectionState;\n\n  @property()\n  slots!: EdgelessSelectionSlots;\n\n  @state()\n  private _popperShow = false;\n\n  @query('.text-color-button')\n  private _textColorButton!: HTMLButtonElement;\n  @query('.color-panel-container.text-color')\n  private _textColorMenu!: HTMLDivElement;\n  private _colorSelectorPopper: ReturnType<typeof createButtonPopper> | null =\n    null;\n\n  @query('.text-align-button')\n  private _textAlignButton!: HTMLButtonElement;\n  @query('.align-panel-container.text-align')\n  private _textAlignMenu!: HTMLDivElement;\n  private _textAlignPopper: ReturnType<typeof createButtonPopper> | null = null;\n\n  private _setTextColor(color: CssVariableName) {\n    this.texts.forEach(text => {\n      this.surface.updateElement<'text'>(text.id, {\n        color,\n      });\n    });\n    this.slots.selectionUpdated.emit({ ...this.selectionState });\n  }\n\n  private _setTextAlign(align: TextElement['textAlign']) {\n    this.texts.forEach(text => {\n      this.surface.updateElement<'text'>(text.id, {\n        textAlign: align,\n      });\n    });\n    this.slots.selectionUpdated.emit({ ...this.selectionState });\n  }\n\n  override firstUpdated(changedProperties: Map<string, unknown>) {\n    const _disposables = this._disposables;\n\n    this._colorSelectorPopper = createButtonPopper(\n      this._textColorButton,\n      this._textColorMenu,\n      ({ display }) => {\n        this._popperShow = display === 'show';\n      }\n    );\n    _disposables.add(this._colorSelectorPopper);\n\n    this._textAlignPopper = createButtonPopper(\n      this._textAlignButton,\n      this._textAlignMenu,\n      ({ display }) => {\n        this._popperShow = display === 'show';\n      }\n    );\n    _disposables.add(this._textAlignPopper);\n\n    super.firstUpdated(changedProperties);\n  }\n\n  override render() {\n    const selectedColor = getMostCommonColor(this.texts) ?? TEXT_COLORS[0];\n    const selectedAlign = getMostCommonAlign(this.texts);\n\n    return html`\n      <edgeless-tool-icon-button\n        class=\"text-color-button\"\n        .tooltip=${this._popperShow ? '' : 'Text Color'}\n        .tipPosition=${'bottom'}\n        .active=${false}\n        @click=${() => this._colorSelectorPopper?.toggle()}\n      >\n        ${ColorUnit(selectedColor)}\n      </edgeless-tool-icon-button>\n      <div class=\"color-panel-container text-color\">\n        <edgeless-color-panel\n          .value=${selectedColor}\n          .options=${TEXT_COLORS}\n          @select=${(event: ColorEvent) => {\n            this._setTextColor(event.detail);\n          }}\n        ></edgeless-color-panel>\n      </div>\n\n      <menu-divider .vertical=${true}></menu-divider>\n\n      <edgeless-tool-icon-button\n        class=\"text-align-button\"\n        .tooltip=${this._popperShow ? '' : 'Alignment'}\n        .tipPosition=${'bottom'}\n        .active=${false}\n        @click=${() => this._textAlignPopper?.toggle()}\n      >\n        ${selectedAlign === 'left'\n          ? AlighLeftIcon\n          : selectedAlign === 'center'\n          ? AlignCenterIcon\n          : AlignRightIcon}\n      </edgeless-tool-icon-button>\n      <div class=\"align-panel-container text-align\">\n        <edgeless-align-panel\n          .value=${selectedAlign}\n          .onSelect=${(value: EdgelessAlignPanel['value']) => {\n            this._setTextAlign(value);\n          }}\n        ></edgeless-align-panel>\n      </div>\n    `;\n  }\n}\n", "/* CSS variables. You need to handle all places where `CSS variables` are marked. */\nexport const COLOR_VARIABLES = [\n  '--affine-brand-color',\n  '--affine-primary-color',\n  '--affine-secondary-color',\n  '--affine-tertiary-color',\n  '--affine-hover-color',\n  '--affine-icon-color',\n  '--affine-icon-secondary',\n  '--affine-border-color',\n  '--affine-divider-color',\n  '--affine-placeholder-color',\n  '--affine-quote-color',\n  '--affine-link-color',\n  '--affine-edgeless-grid-color',\n  '--affine-success-color',\n  '--affine-warning-color',\n  '--affine-error-color',\n  '--affine-processing-color',\n  '--affine-text-emphasis-color',\n  '--affine-text-primary-color',\n  '--affine-text-secondary-color',\n  '--affine-text-disable-color',\n  '--affine-black-10',\n  '--affine-black-30',\n  '--affine-black-50',\n  '--affine-black-60',\n  '--affine-black-80',\n  '--affine-black-90',\n  '--affine-black',\n  '--affine-white-10',\n  '--affine-white-30',\n  '--affine-white-50',\n  '--affine-white-60',\n  '--affine-white-80',\n  '--affine-white-90',\n  '--affine-white',\n  '--affine-background-code-block',\n  '--affine-background-tertiary-color',\n  '--affine-background-processing-color',\n  '--affine-background-error-color',\n  '--affine-background-warning-color',\n  '--affine-background-success-color',\n  '--affine-background-primary-color',\n  '--affine-background-secondary-color',\n  '--affine-background-modal-color',\n  '--affine-background-overlay-panel-color',\n  '--affine-tag-blue',\n  '--affine-tag-green',\n  '--affine-tag-teal',\n  '--affine-tag-white',\n  '--affine-tag-purple',\n  '--affine-tag-red',\n  '--affine-tag-pink',\n  '--affine-tag-yellow',\n  '--affine-tag-orange',\n  '--affine-tag-gray',\n  '--affine-palette-line-yellow',\n  '--affine-palette-line-orange',\n  '--affine-palette-line-tangerine',\n  '--affine-palette-line-red',\n  '--affine-palette-line-magenta',\n  '--affine-palette-line-purple',\n  '--affine-palette-line-navy',\n  '--affine-palette-line-blue',\n  '--affine-palette-line-green',\n  '--affine-palette-line-white',\n  '--affine-palette-line-black',\n  '--affine-palette-line-grey',\n  '--affine-palette-shape-yellow',\n  '--affine-palette-shape-orange',\n  '--affine-palette-shape-tangerine',\n  '--affine-palette-shape-red',\n  '--affine-palette-shape-magenta',\n  '--affine-palette-shape-purple',\n  '--affine-palette-shape-navy',\n  '--affine-palette-shape-blue',\n  '--affine-palette-shape-green',\n  '--affine-palette-shape-white',\n  '--affine-palette-shape-black',\n  '--affine-palette-shape-grey',\n  '--affine-tooltip',\n];\n\nexport const SIZE_VARIABLES = [\n  '--affine-font-h-1',\n  '--affine-font-h-2',\n  '--affine-font-h-3',\n  '--affine-font-h-4',\n  '--affine-font-h-5',\n  '--affine-font-h-6',\n  '--affine-font-base',\n  '--affine-font-sm',\n  '--affine-font-xs',\n  '--affine-line-height',\n  '--affine-z-index-modal',\n  '--affine-z-index-popover',\n];\n\nexport const FONT_FAMILY_VARIABLES = [\n  '--affine-font-family',\n  '--affine-font-number-family',\n  '--affine-font-code-family',\n];\n\nexport const VARIABLES = [\n  '--affine-editor-width',\n\n  '--affine-theme-mode',\n  '--affine-editor-mode',\n  /* --affine-palette-transparent: special values added for the sake of logical consistency. */\n  '--affine-palette-transparent',\n\n  '--affine-popover-shadow',\n  '--affine-menu-shadow',\n  '--affine-float-button-shadow',\n  '--affine-shadow-1',\n  '--affine-shadow-2',\n  '--affine-shadow-3',\n\n  '--affine-paragraph-space',\n  '--affine-popover-radius',\n  '--affine-zoom',\n  '--affine-scale',\n  ...SIZE_VARIABLES,\n  ...COLOR_VARIABLES,\n  ...FONT_FAMILY_VARIABLES,\n] as const;\n\ntype VariablesType = typeof VARIABLES;\nexport type CssVariableName = Extract<\n  VariablesType[keyof VariablesType],\n  string\n>;\n\nexport type CssVariablesMap = Record<CssVariableName, string>;\n\nexport function isCssVariable(name: string): name is CssVariableName {\n  return VARIABLES.includes(name as CssVariableName);\n}\n", "import { ShadowlessElement, WithDisposable } from '@blocksuite/lit';\nimport { Bound, type TextElement } from '@blocksuite/phasor';\nimport { assertExists } from '@blocksuite/store';\nimport { VEditor } from '@blocksuite/virgo';\nimport { html } from 'lit';\nimport { customElement, query } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { isCssVariable } from '../../../__internal__/theme/css-variables.js';\nimport type { EdgelessPageBlockComponent } from '../edgeless-page-block.js';\nimport { getSelectedRect } from './utils.js';\n\n@customElement('surface-text-editor')\nexport class SurfaceTextEditor extends WithDisposable(ShadowlessElement) {\n  @query('.virgo-container')\n  private _virgoContainer!: HTMLDivElement;\n\n  private _vEditor: VEditor | null = null;\n\n  private _element: TextElement | null = null;\n  private _edgeless: EdgelessPageBlockComponent | null = null;\n  private _keeping = false;\n\n  get vEditor() {\n    return this._vEditor;\n  }\n\n  setKeeping(keeping: boolean) {\n    this._keeping = keeping;\n  }\n\n  private _syncRect() {\n    const edgeless = this._edgeless;\n    const element = this._element;\n    if (edgeless && element) {\n      const rect = this._virgoContainer.getBoundingClientRect();\n      const vLines = Array.from(\n        this._virgoContainer.querySelectorAll('v-line')\n      );\n      const lineHeight = vLines[0].getBoundingClientRect().height;\n      edgeless.surface.updateElement(element.id, {\n        xywh: new Bound(\n          element.x,\n          element.y,\n          rect.width / edgeless.surface.viewport.zoom,\n          (vLines.length / edgeless.surface.viewport.zoom) * lineHeight\n        ).serialize(),\n      });\n      edgeless.slots.selectionUpdated.emit({\n        selected: [element],\n        active: true,\n      });\n    }\n  }\n\n  mount(element: TextElement, edgeless: EdgelessPageBlockComponent) {\n    this._element = element;\n    this._edgeless = edgeless;\n    this._vEditor = new VEditor(element.text);\n\n    this._vEditor.slots.updated.on(() => {\n      this._syncRect();\n    });\n\n    this._disposables.add(\n      edgeless.slots.viewportUpdated.on(() => {\n        this.requestUpdate();\n        requestAnimationFrame(() => {\n          this._syncRect();\n        });\n      })\n    );\n\n    this.requestUpdate();\n    requestAnimationFrame(() => {\n      assertExists(this._vEditor);\n      this._element?.setDisplay(false);\n      this._vEditor.mount(this._virgoContainer);\n\n      this._virgoContainer.addEventListener(\n        'blur',\n        () => {\n          if (this._keeping) return;\n          this._unmount();\n        },\n        {\n          once: true,\n        }\n      );\n    });\n  }\n\n  private _unmount() {\n    this.vEditor?.unmount();\n    this._element?.setDisplay(true);\n\n    if (this._element?.text.length === 0) {\n      this._edgeless?.surface.removeElement(this._element?.id);\n    }\n\n    this.remove();\n    assertExists(this._edgeless);\n    this._edgeless.slots.selectionUpdated.emit({\n      selected: [],\n      active: false,\n    });\n  }\n\n  override render() {\n    const viewport = this._edgeless?.surface.viewport;\n    let virgoStyle = styleMap({});\n    if (viewport && this._element && this._edgeless) {\n      const zoom = viewport.zoom;\n      const rect = getSelectedRect(\n        [this._element],\n        this._edgeless.surface.viewport\n      );\n\n      virgoStyle = styleMap({\n        position: 'absolute',\n        left: rect.x + 'px',\n        top: rect.y + 'px',\n        fontSize: this._element.fontSize + 'px',\n        fontFamily: this._element.fontFamily,\n        lineHeight: 'initial',\n        outline: 'none',\n        transform: `scale(${zoom}, ${zoom})`,\n        transformOrigin: 'top left',\n        color: isCssVariable(this._element.color)\n          ? `var(${this._element.color})`\n          : this._element.color,\n      });\n    }\n\n    return html`<div style=${virgoStyle} class=\"virgo-container\"></div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'surface-text-editor': SurfaceTextEditor;\n  }\n}\n", "import type { Point as ConnectorPoint } from '@blocksuite/connector';\nimport type { Direction } from '@blocksuite/connector';\nimport { Rectangle, route, simplifyPath } from '@blocksuite/connector';\nimport type { PointerEventState } from '@blocksuite/lit';\nimport {\n  Bound,\n  type Controller,\n  type PhasorElement,\n  type SurfaceManager,\n  type SurfaceViewport,\n  TextElement,\n} from '@blocksuite/phasor';\nimport { ConnectorElement, ConnectorMode } from '@blocksuite/phasor';\nimport {\n  contains,\n  deserializeXYWH,\n  intersects,\n  isPointIn as isPointInFromPhasor,\n  normalizeWheelDeltaY,\n  serializeXYWH,\n} from '@blocksuite/phasor';\nimport { assertExists, type Page } from '@blocksuite/store';\nimport * as Y from 'yjs';\n\nimport {\n  handleNativeRangeAtPoint,\n  type MouseMode,\n  Point,\n  type TopLevelBlockModel,\n} from '../../__internal__/index.js';\nimport { isPinchEvent } from '../../__internal__/utils/index.js';\nimport { DEFAULT_TEXT_COLOR } from './components/component-toolbar/change-text-button.js';\nimport { SurfaceTextEditor } from './components/surface-text-editor.js';\nimport type {\n  EdgelessContainer,\n  EdgelessPageBlockComponent,\n} from './edgeless-page-block.js';\nimport type { Selectable } from './selection-manager.js';\n\nexport const FRAME_MIN_WIDTH = 200;\nexport const FRAME_MIN_HEIGHT = 20;\n\nexport const DEFAULT_FRAME_WIDTH = 448;\nexport const DEFAULT_FRAME_HEIGHT = 72;\nexport const DEFAULT_FRAME_OFFSET_X = 30;\nexport const DEFAULT_FRAME_OFFSET_Y = 40;\n\nconst ATTACHED_DISTANCE = 20;\n\nexport function isTopLevelBlock(\n  selectable: Selectable | null\n): selectable is TopLevelBlockModel {\n  return !!selectable && 'flavour' in selectable;\n}\n\nexport function isPhasorElement(\n  selectable: Selectable | null\n): selectable is PhasorElement {\n  return !isTopLevelBlock(selectable);\n}\n\nfunction isPointIn(\n  block: { xywh: string },\n  pointX: number,\n  pointY: number\n): boolean {\n  const [x, y, w, h] = deserializeXYWH(block.xywh);\n  return isPointInFromPhasor({ x, y, w, h }, pointX, pointY);\n}\n\nexport function pickTopBlock(\n  blocks: TopLevelBlockModel[],\n  modelX: number,\n  modelY: number\n): TopLevelBlockModel | null {\n  for (let i = blocks.length - 1; i >= 0; i--) {\n    const block = blocks[i];\n    if (isPointIn(block, modelX, modelY)) {\n      return block;\n    }\n  }\n  return null;\n}\n\nexport function pickBlocksByBound(\n  blocks: TopLevelBlockModel[],\n  bound: Omit<Bound, 'serialize'>\n) {\n  return blocks.filter(block => {\n    const [x, y, w, h] = deserializeXYWH(block.xywh);\n    const blockBound = { x, y, w, h };\n    return contains(bound, blockBound) || intersects(bound, blockBound);\n  });\n}\n\nexport function getSelectionBoxBound(viewport: SurfaceViewport, xywh: string) {\n  const [modelX, modelY, modelW, modelH] = deserializeXYWH(xywh);\n  const [x, y] = viewport.toViewCoord(modelX, modelY);\n  return new DOMRect(x, y, modelW * viewport.zoom, modelH * viewport.zoom);\n}\n\nexport function initWheelEventHandlers(container: EdgelessContainer) {\n  const wheelHandler = (e: WheelEvent) => {\n    e.preventDefault();\n\n    const { viewport } = container.surface;\n    // pan\n    if (!isPinchEvent(e)) {\n      const dx = e.deltaX / viewport.zoom;\n      const dy = e.deltaY / viewport.zoom;\n      viewport.applyDeltaCenter(dx, dy);\n      container.slots.viewportUpdated.emit();\n    }\n    // zoom\n    else {\n      const { centerX, centerY } = viewport;\n      const prevZoom = viewport.zoom;\n\n      const rect = container.getBoundingClientRect();\n      // Perform zooming relative to the mouse position\n      const [baseX, baseY] = container.surface.toModelCoord(\n        e.clientX - rect.x,\n        e.clientY - rect.y\n      );\n\n      const zoom = normalizeWheelDeltaY(e.deltaY, viewport.zoom);\n      viewport.setZoom(zoom);\n      const newZoom = viewport.zoom;\n\n      const offsetX = centerX - baseX;\n      const offsetY = centerY - baseY;\n      const newCenterX = baseX + offsetX * (prevZoom / newZoom);\n      const newCenterY = baseY + offsetY * (prevZoom / newZoom);\n      viewport.setCenter(newCenterX, newCenterY);\n\n      container.slots.viewportUpdated.emit();\n    }\n  };\n\n  container.addEventListener('wheel', wheelHandler);\n  const dispose = () => container.removeEventListener('wheel', wheelHandler);\n  return dispose;\n}\n\nexport function getXYWH(element: Selectable) {\n  return isTopLevelBlock(element)\n    ? element.xywh\n    : serializeXYWH(element.x, element.y, element.w, element.h);\n}\n\nexport function stopPropagation(event: Event) {\n  event.stopPropagation();\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/CSS/cursor\nexport function getCursorMode(mouseMode: MouseMode) {\n  switch (mouseMode.type) {\n    case 'default':\n      return 'default';\n    case 'pan':\n      return mouseMode.panning ? 'grabbing' : 'grab';\n    case 'brush':\n    case 'shape':\n    case 'connector':\n      return 'crosshair';\n    case 'text':\n      return 'text';\n    default:\n      return 'default';\n  }\n}\n\nexport function pickBy(\n  surface: SurfaceManager,\n  page: Page,\n  x: number,\n  y: number,\n  filter: (element: Selectable) => boolean\n): Selectable | null {\n  const [modelX, modelY] = surface.viewport.toModelCoord(x, y);\n  const selectedShapes = surface.pickByPoint(modelX, modelY).filter(filter);\n\n  return selectedShapes.length\n    ? selectedShapes[selectedShapes.length - 1]\n    : pickTopBlock(\n        (page.root?.children as TopLevelBlockModel[]).filter(\n          child => child.flavour === 'affine:frame'\n        ) ?? [],\n        modelX,\n        modelY\n      );\n}\n\nfunction pickById(surface: SurfaceManager, page: Page, id: string) {\n  const blocks =\n    (page.root?.children.filter(\n      child => child.flavour === 'affine:frame'\n    ) as TopLevelBlockModel[]) ?? [];\n  const element = surface.pickById(id) || blocks.find(b => b.id === id);\n  return element;\n}\n\nexport function generateConnectorPath(\n  startRect: Rectangle | null,\n  endRect: Rectangle | null,\n  startPoint: ConnectorPoint,\n  endPoint: ConnectorPoint,\n  originControllers: Controller[],\n  mode: ConnectorMode = ConnectorMode.Orthogonal,\n  // this indicating which part of the path is fixed when there are customized control points\n  fixed?: 'start' | 'end'\n) {\n  if (mode !== ConnectorMode.Orthogonal) {\n    return [startPoint, endPoint];\n  }\n  let customizedStart = Infinity;\n  let customizedEnd = -1;\n  originControllers.forEach((c, index) => {\n    if (c.customized) {\n      customizedStart = Math.min(customizedStart, index);\n      customizedEnd = Math.max(customizedEnd, index);\n    }\n  });\n\n  let path: ConnectorPoint[] = [];\n  if (fixed && customizedEnd > -1) {\n    const part0EndPoint = originControllers[customizedStart];\n    const part0 =\n      fixed === 'start'\n        ? originControllers.slice(0, customizedStart + 1)\n        : route(startRect ? [startRect] : [], [startPoint, part0EndPoint]);\n\n    const part1 = originControllers.slice(customizedStart, customizedEnd + 1);\n\n    const part2StartPoint = originControllers[customizedEnd];\n    const part2 =\n      fixed === 'end'\n        ? originControllers.slice(customizedEnd)\n        : route(endRect ? [endRect] : [], [part2StartPoint, endPoint]);\n\n    path = simplifyPath([...part0.slice(0, -1), ...part1, ...part2.slice(1)]);\n  } else {\n    path = route([startRect, endRect].filter(r => !!r) as Rectangle[], [\n      startPoint,\n      endPoint,\n    ]);\n  }\n\n  if (path.length < 3) {\n    path = [startPoint, endPoint];\n  }\n\n  return path;\n}\n\nfunction getAttachedPointByDirection(\n  { x, y, w, h }: Rectangle,\n  direction: Direction\n): ConnectorPoint {\n  switch (direction) {\n    case 'top': {\n      return { x: x + w / 2, y };\n    }\n    case 'right': {\n      return { x: x + w, y: y + h / 2 };\n    }\n    case 'bottom': {\n      return { x: x + w / 2, y: y + h };\n    }\n    case 'left': {\n      return { x, y: y + h / 2 };\n    }\n    default: {\n      throw new Error(`Unknown direction: ${direction}`);\n    }\n  }\n}\n\nexport function getAttachedPoint(\n  x: number,\n  y: number,\n  rect?: Rectangle | null\n): { point: ConnectorPoint; position: ConnectorPoint | null } {\n  if (!rect || !rect.contains(x, y)) {\n    return { point: { x, y }, position: null };\n  }\n  const direction = rect.relativeDirection(x, y);\n  const position = {\n    x: (x - rect.x) / rect.w,\n    y: (y - rect.y) / rect.h,\n  };\n\n  const attachedPoint = getAttachedPointByDirection(rect, direction);\n  const distance = Math.sqrt(\n    Math.pow(x - attachedPoint.x, 2) + Math.pow(y - attachedPoint.y, 2)\n  );\n  if (distance < ATTACHED_DISTANCE) {\n    return {\n      point: attachedPoint,\n      position: {\n        x: (attachedPoint.x - rect.x) / rect.w,\n        y: (attachedPoint.y - rect.y) / rect.h,\n      },\n    };\n  }\n\n  return { point: { x, y }, position };\n}\n\nfunction getAttachedPointByPosition(rect: Rectangle, position: ConnectorPoint) {\n  const x = rect.x + rect.w * position.x;\n  const y = rect.y + rect.h * position.y;\n\n  const direction = rect.relativeDirection(x, y);\n  const attachedPoint = getAttachedPointByDirection(rect, direction);\n  const distance = Math.sqrt(\n    Math.pow(x - attachedPoint.x, 2) + Math.pow(y - attachedPoint.y, 2)\n  );\n  if (distance < ATTACHED_DISTANCE) {\n    return attachedPoint;\n  }\n\n  return { x, y };\n}\n\nexport function getConnectorAttachedInfo(\n  element: ConnectorElement,\n  surface: SurfaceManager,\n  page: Page\n) {\n  const { startElement, endElement } = element;\n  const start = startElement?.id\n    ? pickById(surface, page, startElement.id)\n    : null;\n  const startRect = start\n    ? new Rectangle(...deserializeXYWH(getXYWH(start)))\n    : null;\n  const startPoint =\n    startRect && startElement\n      ? getAttachedPointByPosition(startRect, startElement.position)\n      : {\n          x: element.x + element.controllers[0].x,\n          y: element.y + element.controllers[0].y,\n        };\n\n  const end = endElement?.id ? pickById(surface, page, endElement.id) : null;\n  const endRect = end ? new Rectangle(...deserializeXYWH(getXYWH(end))) : null;\n  const endPoint =\n    endRect && endElement\n      ? getAttachedPointByPosition(endRect, endElement.position)\n      : {\n          x: element.x + element.controllers[element.controllers.length - 1].x,\n          y: element.y + element.controllers[element.controllers.length - 1].y,\n        };\n\n  return {\n    start: {\n      element: startElement,\n      rect: startRect,\n      point: startPoint,\n    },\n    end: {\n      element: endElement,\n      rect: endRect,\n      point: endPoint,\n    },\n  };\n}\n\nexport function isConnectorAndBindingsAllSelected(\n  connector: ConnectorElement,\n  selected: Selectable[]\n) {\n  const connectorSelected = selected.find(s => s.id === connector.id);\n  if (!connectorSelected) {\n    return false;\n  }\n  const { startElement, endElement } = connector;\n  const startSelected = selected.find(s => s.id === startElement?.id);\n  const endSelected = selected.find(s => s.id === endElement?.id);\n  if (!startElement && !endElement) {\n    return true;\n  }\n  if (!startElement && endSelected) {\n    return true;\n  }\n  if (!endElement && startSelected) {\n    return true;\n  }\n  if (startSelected && endSelected) {\n    return true;\n  }\n  return false;\n}\n\nexport function handleElementChangedEffectForConnector(\n  element: Selectable,\n  selected: Selectable[],\n  surface: SurfaceManager,\n  page: Page\n) {\n  if (element.type !== 'connector') {\n    const bindingElements = surface.getBindingElements(element.id);\n    bindingElements.forEach(bindingElement => {\n      if (bindingElement instanceof ConnectorElement) {\n        // if all connector and binding element are selected, they will process in common method.\n        // like:\n        // mode-controllers/default-mode: _handleSurfaceDragMove\n        // components/edgeless-selected-rect: _onDragMove\n        if (isConnectorAndBindingsAllSelected(bindingElement, selected)) {\n          return;\n        }\n        const { startElement, endElement, id, x, y, controllers, mode } =\n          bindingElement;\n        const { start, end } = getConnectorAttachedInfo(\n          bindingElement,\n          surface,\n          page\n        );\n        const fixed =\n          startElement?.id === element.id\n            ? 'end'\n            : endElement?.id === element.id\n            ? 'start'\n            : undefined;\n\n        const routes = generateConnectorPath(\n          start.rect,\n          end.rect,\n          start.point,\n          end.point,\n          controllers.map(c => ({ ...c, x: c.x + x, y: c.y + y })),\n          mode,\n          fixed\n        );\n\n        surface.updateElement<'connector'>(id, {\n          controllers: routes,\n        });\n      }\n    });\n  }\n}\n\nexport function getBackgroundGrid(\n  viewportX: number,\n  viewportY: number,\n  zoom: number,\n  showGrid: boolean\n) {\n  const step = zoom < 0.5 ? 2 : 1 / (Math.floor(zoom) || 1);\n  const gap = 20 * step * zoom;\n  const translateX = -viewportX * zoom;\n  const translateY = -viewportY * zoom;\n\n  return {\n    gap,\n    translateX,\n    translateY,\n    grid: showGrid\n      ? 'radial-gradient(var(--affine-edgeless-grid-color) 1px, var(--affine-background-primary-color) 1px)'\n      : 'unset',\n  };\n}\n\nexport function addNote(\n  edgeless: EdgelessPageBlockComponent,\n  page: Page,\n  event: PointerEventState,\n  width = DEFAULT_FRAME_WIDTH\n) {\n  const frameId = edgeless.addFrameWithPoint(\n    new Point(event.point.x, event.point.y),\n    {\n      width,\n    }\n  );\n  page.addBlock('affine:paragraph', {}, frameId);\n  edgeless.slots.mouseModeUpdated.emit({ type: 'default' });\n\n  // Wait for mouseMode updated\n  requestAnimationFrame(() => {\n    const blocks =\n      (page.root?.children.filter(\n        child => child.flavour === 'affine:frame'\n      ) as TopLevelBlockModel[]) ?? [];\n    const element = blocks.find(b => b.id === frameId);\n    if (element) {\n      edgeless.slots.selectionUpdated.emit({\n        selected: [element],\n        active: true,\n      });\n\n      // Waiting dom updated, `frame mask` is removed\n      edgeless.updateComplete.then(() => {\n        // Cannot reuse `handleNativeRangeClick` directly here,\n        // since `retargetClick` will re-target to pervious editor\n        handleNativeRangeAtPoint(event.raw.clientX, event.raw.clientY);\n      });\n    }\n  });\n}\n\nexport function mountTextEditor(\n  textElement: TextElement,\n  edgeless: EdgelessPageBlockComponent\n) {\n  const textEditor = new SurfaceTextEditor();\n  const pageBlockContainer = edgeless.pageBlockContainer;\n\n  pageBlockContainer.appendChild(textEditor);\n  textEditor.mount(textElement, edgeless);\n  textEditor.vEditor?.focusEnd();\n  edgeless.selection.switchToDefaultMode({\n    selected: [textElement],\n    active: true,\n  });\n}\n\nexport function addText(\n  edgeless: EdgelessPageBlockComponent,\n  event: PointerEventState\n) {\n  const selected = edgeless.surface.pickTop(event.x, event.y);\n  if (!selected) {\n    const [modelX, modelY] = edgeless.surface.viewport.toModelCoord(\n      event.x,\n      event.y\n    );\n    const id = edgeless.surface.addElement('text', {\n      xywh: new Bound(modelX, modelY, 32, 32).serialize(),\n      text: new Y.Text(),\n      textAlign: 'left',\n      fontSize: 24,\n      color: DEFAULT_TEXT_COLOR,\n    });\n    edgeless.page.captureSync();\n    const textElement = edgeless.surface.pickById(id);\n    assertExists(textElement);\n    if (textElement instanceof TextElement) {\n      mountTextEditor(textElement, edgeless);\n    }\n  }\n}\n\nexport function xywhArrayToObject(element: TopLevelBlockModel) {\n  const [x, y, w, h] = deserializeXYWH(element.xywh);\n  return {\n    x,\n    y,\n    w,\n    h,\n  };\n}\n", "import type { Options } from './types'\n\nexport function resolveUrl(url: string, baseUrl: string | null): string {\n  // url is absolute already\n  if (url.match(/^[a-z]+:\\/\\//i)) {\n    return url\n  }\n\n  // url is absolute already, without protocol\n  if (url.match(/^\\/\\//)) {\n    return window.location.protocol + url\n  }\n\n  // dataURI, mailto:, tel:, etc.\n  if (url.match(/^[a-z]+:/i)) {\n    return url\n  }\n\n  const doc = document.implementation.createHTMLDocument()\n  const base = doc.createElement('base')\n  const a = doc.createElement('a')\n\n  doc.head.appendChild(base)\n  doc.body.appendChild(a)\n\n  if (baseUrl) {\n    base.href = baseUrl\n  }\n\n  a.href = url\n\n  return a.href\n}\n\nexport const uuid = (() => {\n  // generate uuid for className of pseudo elements.\n  // We should not use GUIDs, otherwise pseudo elements sometimes cannot be captured.\n  let counter = 0\n\n  // ref: http://stackoverflow.com/a/6248722/2519373\n  const random = () =>\n    // eslint-disable-next-line no-bitwise\n    `0000${((Math.random() * 36 ** 4) << 0).toString(36)}`.slice(-4)\n\n  return () => {\n    counter += 1\n    return `u${random()}${counter}`\n  }\n})()\n\nexport function delay<T>(ms: number) {\n  return (args: T) =>\n    new Promise<T>((resolve) => {\n      setTimeout(() => resolve(args), ms)\n    })\n}\n\nexport function toArray<T>(arrayLike: any): T[] {\n  const arr: T[] = []\n\n  for (let i = 0, l = arrayLike.length; i < l; i++) {\n    arr.push(arrayLike[i])\n  }\n\n  return arr\n}\n\nfunction px(node: HTMLElement, styleProperty: string) {\n  const win = node.ownerDocument.defaultView || window\n  const val = win.getComputedStyle(node).getPropertyValue(styleProperty)\n  return val ? parseFloat(val.replace('px', '')) : 0\n}\n\nfunction getNodeWidth(node: HTMLElement) {\n  const leftBorder = px(node, 'border-left-width')\n  const rightBorder = px(node, 'border-right-width')\n  return node.clientWidth + leftBorder + rightBorder\n}\n\nfunction getNodeHeight(node: HTMLElement) {\n  const topBorder = px(node, 'border-top-width')\n  const bottomBorder = px(node, 'border-bottom-width')\n  return node.clientHeight + topBorder + bottomBorder\n}\n\nexport function getImageSize(targetNode: HTMLElement, options: Options = {}) {\n  const width = options.width || getNodeWidth(targetNode)\n  const height = options.height || getNodeHeight(targetNode)\n\n  return { width, height }\n}\n\nexport function getPixelRatio() {\n  let ratio\n\n  let FINAL_PROCESS\n  try {\n    FINAL_PROCESS = process\n  } catch (e) {\n    // pass\n  }\n\n  const val =\n    FINAL_PROCESS && FINAL_PROCESS.env\n      ? FINAL_PROCESS.env.devicePixelRatio\n      : null\n  if (val) {\n    ratio = parseInt(val, 10)\n    if (Number.isNaN(ratio)) {\n      ratio = 1\n    }\n  }\n  return ratio || window.devicePixelRatio || 1\n}\n\n// @see https://developer.mozilla.org/en-US/docs/Web/HTML/Element/canvas#maximum_canvas_size\nconst canvasDimensionLimit = 16384\n\nexport function checkCanvasDimensions(canvas: HTMLCanvasElement) {\n  if (\n    canvas.width > canvasDimensionLimit ||\n    canvas.height > canvasDimensionLimit\n  ) {\n    if (\n      canvas.width > canvasDimensionLimit &&\n      canvas.height > canvasDimensionLimit\n    ) {\n      if (canvas.width > canvas.height) {\n        canvas.height *= canvasDimensionLimit / canvas.width\n        canvas.width = canvasDimensionLimit\n      } else {\n        canvas.width *= canvasDimensionLimit / canvas.height\n        canvas.height = canvasDimensionLimit\n      }\n    } else if (canvas.width > canvasDimensionLimit) {\n      canvas.height *= canvasDimensionLimit / canvas.width\n      canvas.width = canvasDimensionLimit\n    } else {\n      canvas.width *= canvasDimensionLimit / canvas.height\n      canvas.height = canvasDimensionLimit\n    }\n  }\n}\n\nexport function canvasToBlob(\n  canvas: HTMLCanvasElement,\n  options: Options = {},\n): Promise<Blob | null> {\n  if (canvas.toBlob) {\n    return new Promise((resolve) => {\n      canvas.toBlob(\n        resolve,\n        options.type ? options.type : 'image/png',\n        options.quality ? options.quality : 1,\n      )\n    })\n  }\n\n  return new Promise((resolve) => {\n    const binaryString = window.atob(\n      canvas\n        .toDataURL(\n          options.type ? options.type : undefined,\n          options.quality ? options.quality : undefined,\n        )\n        .split(',')[1],\n    )\n    const len = binaryString.length\n    const binaryArray = new Uint8Array(len)\n\n    for (let i = 0; i < len; i += 1) {\n      binaryArray[i] = binaryString.charCodeAt(i)\n    }\n\n    resolve(\n      new Blob([binaryArray], {\n        type: options.type ? options.type : 'image/png',\n      }),\n    )\n  })\n}\n\nexport function createImage(url: string): Promise<HTMLImageElement> {\n  return new Promise((resolve, reject) => {\n    const img = new Image()\n    img.decode = () => resolve(img) as any\n    img.onload = () => resolve(img)\n    img.onerror = reject\n    img.crossOrigin = 'anonymous'\n    img.decoding = 'async'\n    img.src = url\n  })\n}\n\nexport async function svgToDataURL(svg: SVGElement): Promise<string> {\n  return Promise.resolve()\n    .then(() => new XMLSerializer().serializeToString(svg))\n    .then(encodeURIComponent)\n    .then((html) => `data:image/svg+xml;charset=utf-8,${html}`)\n}\n\nexport async function nodeToDataURL(\n  node: HTMLElement,\n  width: number,\n  height: number,\n): Promise<string> {\n  const xmlns = 'http://www.w3.org/2000/svg'\n  const svg = document.createElementNS(xmlns, 'svg')\n  const foreignObject = document.createElementNS(xmlns, 'foreignObject')\n\n  svg.setAttribute('width', `${width}`)\n  svg.setAttribute('height', `${height}`)\n  svg.setAttribute('viewBox', `0 0 ${width} ${height}`)\n\n  foreignObject.setAttribute('width', '100%')\n  foreignObject.setAttribute('height', '100%')\n  foreignObject.setAttribute('x', '0')\n  foreignObject.setAttribute('y', '0')\n  foreignObject.setAttribute('externalResourcesRequired', 'true')\n\n  svg.appendChild(foreignObject)\n  foreignObject.appendChild(node)\n  return svgToDataURL(svg)\n}\n\nexport const isInstanceOfElement = <\n  T extends typeof Element | typeof HTMLElement | typeof SVGImageElement,\n>(\n  node: Element | HTMLElement | SVGImageElement,\n  instance: T,\n): node is T['prototype'] => {\n  if (node instanceof instance) return true\n\n  const nodePrototype = Object.getPrototypeOf(node)\n\n  if (nodePrototype === null) return false\n\n  return (\n    nodePrototype.constructor.name === instance.name ||\n    isInstanceOfElement(nodePrototype, instance)\n  )\n}\n", "import { uuid, toArray } from './util'\n\ntype Pseudo = ':before' | ':after'\n\nfunction formatCSSText(style: CSSStyleDeclaration) {\n  const content = style.getPropertyValue('content')\n  return `${style.cssText} content: '${content.replace(/'|\"/g, '')}';`\n}\n\nfunction formatCSSProperties(style: CSSStyleDeclaration) {\n  return toArray<string>(style)\n    .map((name) => {\n      const value = style.getPropertyValue(name)\n      const priority = style.getPropertyPriority(name)\n\n      return `${name}: ${value}${priority ? ' !important' : ''};`\n    })\n    .join(' ')\n}\n\nfunction getPseudoElementStyle(\n  className: string,\n  pseudo: Pseudo,\n  style: CSSStyleDeclaration,\n): Text {\n  const selector = `.${className}:${pseudo}`\n  const cssText = style.cssText\n    ? formatCSSText(style)\n    : formatCSSProperties(style)\n\n  return document.createTextNode(`${selector}{${cssText}}`)\n}\n\nfunction clonePseudoElement<T extends HTMLElement>(\n  nativeNode: T,\n  clonedNode: T,\n  pseudo: Pseudo,\n) {\n  const style = window.getComputedStyle(nativeNode, pseudo)\n  const content = style.getPropertyValue('content')\n  if (content === '' || content === 'none') {\n    return\n  }\n\n  const className = uuid()\n  try {\n    clonedNode.className = `${clonedNode.className} ${className}`\n  } catch (err) {\n    return\n  }\n\n  const styleElement = document.createElement('style')\n  styleElement.appendChild(getPseudoElementStyle(className, pseudo, style))\n  clonedNode.appendChild(styleElement)\n}\n\nexport function clonePseudoElements<T extends HTMLElement>(\n  nativeNode: T,\n  clonedNode: T,\n) {\n  clonePseudoElement(nativeNode, clonedNode, ':before')\n  clonePseudoElement(nativeNode, clonedNode, ':after')\n}\n", "const WOFF = 'application/font-woff'\nconst JPEG = 'image/jpeg'\nconst mimes: { [key: string]: string } = {\n  woff: WOFF,\n  woff2: WOFF,\n  ttf: 'application/font-truetype',\n  eot: 'application/vnd.ms-fontobject',\n  png: 'image/png',\n  jpg: JPEG,\n  jpeg: JPEG,\n  gif: 'image/gif',\n  tiff: 'image/tiff',\n  svg: 'image/svg+xml',\n  webp: 'image/webp',\n}\n\nfunction getExtension(url: string): string {\n  const match = /\\.([^./]*?)$/g.exec(url)\n  return match ? match[1] : ''\n}\n\nexport function getMimeType(url: string): string {\n  const extension = getExtension(url).toLowerCase()\n  return mimes[extension] || ''\n}\n", "import { Options } from './types'\n\nfunction getContentFromDataUrl(dataURL: string) {\n  return dataURL.split(/,/)[1]\n}\n\nexport function isDataUrl(url: string) {\n  return url.search(/^(data:)/) !== -1\n}\n\nexport function makeDataUrl(content: string, mimeType: string) {\n  return `data:${mimeType};base64,${content}`\n}\n\nexport async function fetchAsDataURL<T>(\n  url: string,\n  init: RequestInit | undefined,\n  process: (data: { result: string; res: Response }) => T,\n): Promise<T> {\n  const res = await fetch(url, init)\n  if (res.status === 404) {\n    throw new Error(`Resource \"${res.url}\" not found`)\n  }\n  const blob = await res.blob()\n  return new Promise<T>((resolve, reject) => {\n    const reader = new FileReader()\n    reader.onerror = reject\n    reader.onloadend = () => {\n      try {\n        resolve(process({ res, result: reader.result as string }))\n      } catch (error) {\n        reject(error)\n      }\n    }\n\n    reader.readAsDataURL(blob)\n  })\n}\n\nconst cache: { [url: string]: string } = {}\n\nfunction getCacheKey(\n  url: string,\n  contentType: string | undefined,\n  includeQueryParams: boolean | undefined,\n) {\n  let key = url.replace(/\\?.*/, '')\n\n  if (includeQueryParams) {\n    key = url\n  }\n\n  // font resource\n  if (/ttf|otf|eot|woff2?/i.test(key)) {\n    key = key.replace(/.*\\//, '')\n  }\n\n  return contentType ? `[${contentType}]${key}` : key\n}\n\nexport async function resourceToDataURL(\n  resourceUrl: string,\n  contentType: string | undefined,\n  options: Options,\n) {\n  const cacheKey = getCacheKey(\n    resourceUrl,\n    contentType,\n    options.includeQueryParams,\n  )\n\n  if (cache[cacheKey] != null) {\n    return cache[cacheKey]\n  }\n\n  // ref: https://developer.mozilla.org/en/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest#Bypassing_the_cache\n  if (options.cacheBust) {\n    // eslint-disable-next-line no-param-reassign\n    resourceUrl += (/\\?/.test(resourceUrl) ? '&' : '?') + new Date().getTime()\n  }\n\n  let dataURL: string\n  try {\n    const content = await fetchAsDataURL(\n      resourceUrl,\n      options.fetchRequestInit,\n      ({ res, result }) => {\n        if (!contentType) {\n          // eslint-disable-next-line no-param-reassign\n          contentType = res.headers.get('Content-Type') || ''\n        }\n        return getContentFromDataUrl(result)\n      },\n    )\n    dataURL = makeDataUrl(content, contentType!)\n  } catch (error) {\n    dataURL = options.imagePlaceholder || ''\n\n    let msg = `Failed to fetch resource: ${resourceUrl}`\n    if (error) {\n      msg = typeof error === 'string' ? error : error.message\n    }\n\n    if (msg) {\n      console.warn(msg)\n    }\n  }\n\n  cache[cacheKey] = dataURL\n  return dataURL\n}\n", "import type { Options } from './types'\nimport { clonePseudoElements } from './clone-pseudos'\nimport { createImage, toArray, isInstanceOfElement } from './util'\nimport { getMimeType } from './mimes'\nimport { resourceToDataURL } from './dataurl'\n\nasync function cloneCanvasElement(canvas: HTMLCanvasElement) {\n  const dataURL = canvas.toDataURL()\n  if (dataURL === 'data:,') {\n    return canvas.cloneNode(false) as HTMLCanvasElement\n  }\n  return createImage(dataURL)\n}\n\nasync function cloneVideoElement(video: HTMLVideoElement, options: Options) {\n  if (video.currentSrc) {\n    const canvas = document.createElement('canvas')\n    const ctx = canvas.getContext('2d')\n    canvas.width = video.clientWidth\n    canvas.height = video.clientHeight\n    ctx?.drawImage(video, 0, 0, canvas.width, canvas.height)\n    const dataURL = canvas.toDataURL()\n    return createImage(dataURL)\n  }\n\n  const poster = video.poster\n  const contentType = getMimeType(poster)\n  const dataURL = await resourceToDataURL(poster, contentType, options)\n  return createImage(dataURL)\n}\n\nasync function cloneIFrameElement(iframe: HTMLIFrameElement) {\n  try {\n    if (iframe?.contentDocument?.body) {\n      return (await cloneNode(\n        iframe.contentDocument.body,\n        {},\n        true,\n      )) as HTMLBodyElement\n    }\n  } catch {\n    // Failed to clone iframe\n  }\n\n  return iframe.cloneNode(false) as HTMLIFrameElement\n}\n\nasync function cloneSingleNode<T extends HTMLElement>(\n  node: T,\n  options: Options,\n): Promise<HTMLElement> {\n  if (isInstanceOfElement(node, HTMLCanvasElement)) {\n    return cloneCanvasElement(node)\n  }\n\n  if (isInstanceOfElement(node, HTMLVideoElement)) {\n    return cloneVideoElement(node, options)\n  }\n\n  if (isInstanceOfElement(node, HTMLIFrameElement)) {\n    return cloneIFrameElement(node)\n  }\n\n  return node.cloneNode(false) as T\n}\n\nconst isSlotElement = (node: HTMLElement): node is HTMLSlotElement =>\n  node.tagName != null && node.tagName.toUpperCase() === 'SLOT'\n\nasync function cloneChildren<T extends HTMLElement>(\n  nativeNode: T,\n  clonedNode: T,\n  options: Options,\n): Promise<T> {\n  let children: T[] = []\n\n  if (isSlotElement(nativeNode) && nativeNode.assignedNodes) {\n    children = toArray<T>(nativeNode.assignedNodes())\n  } else if (\n    isInstanceOfElement(nativeNode, HTMLIFrameElement) &&\n    nativeNode.contentDocument?.body\n  ) {\n    children = toArray<T>(nativeNode.contentDocument.body.childNodes)\n  } else {\n    children = toArray<T>((nativeNode.shadowRoot ?? nativeNode).childNodes)\n  }\n\n  if (\n    children.length === 0 ||\n    isInstanceOfElement(nativeNode, HTMLVideoElement)\n  ) {\n    return clonedNode\n  }\n\n  await children.reduce(\n    (deferred, child) =>\n      deferred\n        .then(() => cloneNode(child, options))\n        .then((clonedChild: HTMLElement | null) => {\n          if (clonedChild) {\n            clonedNode.appendChild(clonedChild)\n          }\n        }),\n    Promise.resolve(),\n  )\n\n  return clonedNode\n}\n\nfunction cloneCSSStyle<T extends HTMLElement>(nativeNode: T, clonedNode: T) {\n  const targetStyle = clonedNode.style\n  if (!targetStyle) {\n    return\n  }\n\n  const sourceStyle = window.getComputedStyle(nativeNode)\n  if (sourceStyle.cssText) {\n    targetStyle.cssText = sourceStyle.cssText\n    targetStyle.transformOrigin = sourceStyle.transformOrigin\n  } else {\n    toArray<string>(sourceStyle).forEach((name) => {\n      let value = sourceStyle.getPropertyValue(name)\n      if (name === 'font-size' && value.endsWith('px')) {\n        const reducedFont =\n          Math.floor(parseFloat(value.substring(0, value.length - 2))) - 0.1\n        value = `${reducedFont}px`\n      }\n\n      if (\n        isInstanceOfElement(nativeNode, HTMLIFrameElement) &&\n        name === 'display' &&\n        value === 'inline'\n      ) {\n        value = 'block'\n      }\n      \n      if (name === 'd' && clonedNode.getAttribute('d')) {\n        value = `path(${clonedNode.getAttribute('d')})`\n      }\n      \n      targetStyle.setProperty(\n        name,\n        value,\n        sourceStyle.getPropertyPriority(name),\n      )\n    })\n  }\n}\n\nfunction cloneInputValue<T extends HTMLElement>(nativeNode: T, clonedNode: T) {\n  if (isInstanceOfElement(nativeNode, HTMLTextAreaElement)) {\n    clonedNode.innerHTML = nativeNode.value\n  }\n\n  if (isInstanceOfElement(nativeNode, HTMLInputElement)) {\n    clonedNode.setAttribute('value', nativeNode.value)\n  }\n}\n\nfunction cloneSelectValue<T extends HTMLElement>(nativeNode: T, clonedNode: T) {\n  if (isInstanceOfElement(nativeNode, HTMLSelectElement)) {\n    const clonedSelect = clonedNode as any as HTMLSelectElement\n    const selectedOption = Array.from(clonedSelect.children).find(\n      (child) => nativeNode.value === child.getAttribute('value'),\n    )\n\n    if (selectedOption) {\n      selectedOption.setAttribute('selected', '')\n    }\n  }\n}\n\nfunction decorate<T extends HTMLElement>(nativeNode: T, clonedNode: T): T {\n  if (isInstanceOfElement(clonedNode, Element)) {\n    cloneCSSStyle(nativeNode, clonedNode)\n    clonePseudoElements(nativeNode, clonedNode)\n    cloneInputValue(nativeNode, clonedNode)\n    cloneSelectValue(nativeNode, clonedNode)\n  }\n\n  return clonedNode\n}\n\nasync function ensureSVGSymbols<T extends HTMLElement>(\n  clone: T,\n  options: Options,\n) {\n  const uses = clone.querySelectorAll ? clone.querySelectorAll('use') : []\n  if (uses.length === 0) {\n    return clone\n  }\n\n  const processedDefs: { [key: string]: HTMLElement } = {}\n  for (let i = 0; i < uses.length; i++) {\n    const use = uses[i]\n    const id = use.getAttribute('xlink:href')\n    if (id) {\n      const exist = clone.querySelector(id)\n      const definition = document.querySelector(id) as HTMLElement\n      if (!exist && definition && !processedDefs[id]) {\n        // eslint-disable-next-line no-await-in-loop\n        processedDefs[id] = (await cloneNode(definition, options, true))!\n      }\n    }\n  }\n\n  const nodes = Object.values(processedDefs)\n  if (nodes.length) {\n    const ns = 'http://www.w3.org/1999/xhtml'\n    const svg = document.createElementNS(ns, 'svg')\n    svg.setAttribute('xmlns', ns)\n    svg.style.position = 'absolute'\n    svg.style.width = '0'\n    svg.style.height = '0'\n    svg.style.overflow = 'hidden'\n    svg.style.display = 'none'\n\n    const defs = document.createElementNS(ns, 'defs')\n    svg.appendChild(defs)\n\n    for (let i = 0; i < nodes.length; i++) {\n      defs.appendChild(nodes[i])\n    }\n\n    clone.appendChild(svg)\n  }\n\n  return clone\n}\n\nexport async function cloneNode<T extends HTMLElement>(\n  node: T,\n  options: Options,\n  isRoot?: boolean,\n): Promise<T | null> {\n  if (!isRoot && options.filter && !options.filter(node)) {\n    return null\n  }\n\n  return Promise.resolve(node)\n    .then((clonedNode) => cloneSingleNode(clonedNode, options) as Promise<T>)\n    .then((clonedNode) => cloneChildren(node, clonedNode, options))\n    .then((clonedNode) => decorate(node, clonedNode))\n    .then((clonedNode) => ensureSVGSymbols(clonedNode, options))\n}\n", "import { Options } from './types'\nimport { resolveUrl } from './util'\nimport { getMimeType } from './mimes'\nimport { isDataUrl, makeDataUrl, resourceToDataURL } from './dataurl'\n\nconst URL_REGEX = /url\\((['\"]?)([^'\"]+?)\\1\\)/g\nconst URL_WITH_FORMAT_REGEX = /url\\([^)]+\\)\\s*format\\(([\"']?)([^\"']+)\\1\\)/g\nconst FONT_SRC_REGEX = /src:\\s*(?:url\\([^)]+\\)\\s*format\\([^)]+\\)[,;]\\s*)+/g\n\nfunction toRegex(url: string): RegExp {\n  // eslint-disable-next-line no-useless-escape\n  const escaped = url.replace(/([.*+?^${}()|\\[\\]\\/\\\\])/g, '\\\\$1')\n  return new RegExp(`(url\\\\(['\"]?)(${escaped})(['\"]?\\\\))`, 'g')\n}\n\nexport function parseURLs(cssText: string): string[] {\n  const urls: string[] = []\n\n  cssText.replace(URL_REGEX, (raw, quotation, url) => {\n    urls.push(url)\n    return raw\n  })\n\n  return urls.filter((url) => !isDataUrl(url))\n}\n\nexport async function embed(\n  cssText: string,\n  resourceURL: string,\n  baseURL: string | null,\n  options: Options,\n  getContentFromUrl?: (url: string) => Promise<string>,\n): Promise<string> {\n  try {\n    const resolvedURL = baseURL ? resolveUrl(resourceURL, baseURL) : resourceURL\n    const contentType = getMimeType(resourceURL)\n    let dataURL: string\n    if (getContentFromUrl) {\n      const content = await getContentFromUrl(resolvedURL)\n      dataURL = makeDataUrl(content, contentType)\n    } else {\n      dataURL = await resourceToDataURL(resolvedURL, contentType, options)\n    }\n    return cssText.replace(toRegex(resourceURL), `$1${dataURL}$3`)\n  } catch (error) {\n    // pass\n  }\n  return cssText\n}\n\nfunction filterPreferredFontFormat(\n  str: string,\n  { preferredFontFormat }: Options,\n): string {\n  return !preferredFontFormat\n    ? str\n    : str.replace(FONT_SRC_REGEX, (match: string) => {\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n          const [src, , format] = URL_WITH_FORMAT_REGEX.exec(match) || []\n          if (!format) {\n            return ''\n          }\n\n          if (format === preferredFontFormat) {\n            return `src: ${src};`\n          }\n        }\n      })\n}\n\nexport function shouldEmbed(url: string): boolean {\n  return url.search(URL_REGEX) !== -1\n}\n\nexport async function embedResources(\n  cssText: string,\n  baseUrl: string | null,\n  options: Options,\n): Promise<string> {\n  if (!shouldEmbed(cssText)) {\n    return cssText\n  }\n\n  const filteredCSSText = filterPreferredFontFormat(cssText, options)\n  const urls = parseURLs(filteredCSSText)\n  return urls.reduce(\n    (deferred, url) =>\n      deferred.then((css) => embed(css, url, baseUrl, options)),\n    Promise.resolve(filteredCSSText),\n  )\n}\n", "import { Options } from './types'\nimport { embedResources } from './embed-resources'\nimport { toArray, isInstanceOfElement } from './util'\nimport { isDataUrl, resourceToDataURL } from './dataurl'\nimport { getMimeType } from './mimes'\n\nasync function embedProp(\n  propName: string,\n  node: HTMLElement,\n  options: Options,\n) {\n  const propValue = node.style?.getPropertyValue(propName)\n  if (propValue) {\n    const cssString = await embedResources(propValue, null, options)\n    node.style.setProperty(\n      propName,\n      cssString,\n      node.style.getPropertyPriority(propName),\n    )\n    return true\n  }\n  return false\n}\n\nasync function embedBackground<T extends HTMLElement>(\n  clonedNode: T,\n  options: Options,\n) {\n  if (!(await embedProp('background', clonedNode, options))) {\n    await embedProp('background-image', clonedNode, options)\n  }\n  if (!(await embedProp('mask', clonedNode, options))) {\n    await embedProp('mask-image', clonedNode, options)\n  }\n}\n\nasync function embedImageNode<T extends HTMLElement | SVGImageElement>(\n  clonedNode: T,\n  options: Options,\n) {\n  const isImageElement = isInstanceOfElement(clonedNode, HTMLImageElement)\n\n  if (\n    !(isImageElement && !isDataUrl(clonedNode.src)) &&\n    !(\n      isInstanceOfElement(clonedNode, SVGImageElement) &&\n      !isDataUrl(clonedNode.href.baseVal)\n    )\n  ) {\n    return\n  }\n\n  const url = isImageElement ? clonedNode.src : clonedNode.href.baseVal\n\n  const dataURL = await resourceToDataURL(url, getMimeType(url), options)\n  await new Promise((resolve, reject) => {\n    clonedNode.onload = resolve\n    clonedNode.onerror = reject\n\n    const image = clonedNode as HTMLImageElement\n    if (image.decode) {\n      image.decode = resolve as any\n    }\n\n    if (image.loading === 'lazy') {\n      image.loading = 'eager'\n    }\n\n    if (isImageElement) {\n      clonedNode.srcset = ''\n      clonedNode.src = dataURL\n    } else {\n      clonedNode.href.baseVal = dataURL\n    }\n  })\n}\n\nasync function embedChildren<T extends HTMLElement>(\n  clonedNode: T,\n  options: Options,\n) {\n  const children = toArray<HTMLElement>(clonedNode.childNodes)\n  const deferreds = children.map((child) => embedImages(child, options))\n  await Promise.all(deferreds).then(() => clonedNode)\n}\n\nexport async function embedImages<T extends HTMLElement>(\n  clonedNode: T,\n  options: Options,\n) {\n  if (isInstanceOfElement(clonedNode, Element)) {\n    await embedBackground(clonedNode, options)\n    await embedImageNode(clonedNode, options)\n    await embedChildren(clonedNode, options)\n  }\n}\n", "import { Options } from './types'\n\nexport function applyStyle<T extends HTMLElement>(\n  node: T,\n  options: Options,\n): T {\n  const { style } = node\n\n  if (options.backgroundColor) {\n    style.backgroundColor = options.backgroundColor\n  }\n\n  if (options.width) {\n    style.width = `${options.width}px`\n  }\n\n  if (options.height) {\n    style.height = `${options.height}px`\n  }\n\n  const manual = options.style\n  if (manual != null) {\n    Object.keys(manual).forEach((key: any) => {\n      style[key] = manual[key] as string\n    })\n  }\n\n  return node\n}\n", "import type { Options } from './types'\nimport { toArray } from './util'\nimport { fetchAsDataURL } from './dataurl'\nimport { shouldEmbed, embedResources } from './embed-resources'\n\ninterface Metadata {\n  url: string\n  cssText: string\n}\n\nconst cssFetchCache: { [href: string]: Metadata } = {}\n\nasync function fetchCSS(url: string) {\n  let cache = cssFetchCache[url]\n  if (cache != null) {\n    return cache\n  }\n\n  const res = await fetch(url)\n  const cssText = await res.text()\n  cache = { url, cssText }\n\n  cssFetchCache[url] = cache\n\n  return cache\n}\n\nasync function embedFonts(data: Metadata, options: Options): Promise<string> {\n  let cssText = data.cssText\n  const regexUrl = /url\\([\"']?([^\"')]+)[\"']?\\)/g\n  const fontLocs = cssText.match(/url\\([^)]+\\)/g) || []\n  const loadFonts = fontLocs.map(async (loc: string) => {\n    let url = loc.replace(regexUrl, '$1')\n    if (!url.startsWith('https://')) {\n      url = new URL(url, data.url).href\n    }\n\n    return fetchAsDataURL<[string, string]>(\n      url,\n      options.fetchRequestInit,\n      ({ result }) => {\n        cssText = cssText.replace(loc, `url(${result})`)\n        return [loc, result]\n      },\n    )\n  })\n\n  return Promise.all(loadFonts).then(() => cssText)\n}\n\nfunction parseCSS(source: string) {\n  if (source == null) {\n    return []\n  }\n\n  const result: string[] = []\n  const commentsRegex = /(\\/\\*[\\s\\S]*?\\*\\/)/gi\n  // strip out comments\n  let cssText = source.replace(commentsRegex, '')\n\n  // eslint-disable-next-line prefer-regex-literals\n  const keyframesRegex = new RegExp(\n    '((@.*?keyframes [\\\\s\\\\S]*?){([\\\\s\\\\S]*?}\\\\s*?)})',\n    'gi',\n  )\n\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    const matches = keyframesRegex.exec(cssText)\n    if (matches === null) {\n      break\n    }\n    result.push(matches[0])\n  }\n  cssText = cssText.replace(keyframesRegex, '')\n\n  const importRegex = /@import[\\s\\S]*?url\\([^)]*\\)[\\s\\S]*?;/gi\n  // to match css & media queries together\n  const combinedCSSRegex =\n    '((\\\\s*?(?:\\\\/\\\\*[\\\\s\\\\S]*?\\\\*\\\\/)?\\\\s*?@media[\\\\s\\\\S]' +\n    '*?){([\\\\s\\\\S]*?)}\\\\s*?})|(([\\\\s\\\\S]*?){([\\\\s\\\\S]*?)})'\n  // unified regex\n  const unifiedRegex = new RegExp(combinedCSSRegex, 'gi')\n\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    let matches = importRegex.exec(cssText)\n    if (matches === null) {\n      matches = unifiedRegex.exec(cssText)\n      if (matches === null) {\n        break\n      } else {\n        importRegex.lastIndex = unifiedRegex.lastIndex\n      }\n    } else {\n      unifiedRegex.lastIndex = importRegex.lastIndex\n    }\n    result.push(matches[0])\n  }\n\n  return result\n}\n\nasync function getCSSRules(\n  styleSheets: CSSStyleSheet[],\n  options: Options,\n): Promise<CSSStyleRule[]> {\n  const ret: CSSStyleRule[] = []\n  const deferreds: Promise<number | void>[] = []\n\n  // First loop inlines imports\n  styleSheets.forEach((sheet) => {\n    if ('cssRules' in sheet) {\n      try {\n        toArray<CSSRule>(sheet.cssRules || []).forEach((item, index) => {\n          if (item.type === CSSRule.IMPORT_RULE) {\n            let importIndex = index + 1\n            const url = (item as CSSImportRule).href\n            const deferred = fetchCSS(url)\n              .then((metadata) => embedFonts(metadata, options))\n              .then((cssText) =>\n                parseCSS(cssText).forEach((rule) => {\n                  try {\n                    sheet.insertRule(\n                      rule,\n                      rule.startsWith('@import')\n                        ? (importIndex += 1)\n                        : sheet.cssRules.length,\n                    )\n                  } catch (error) {\n                    console.error('Error inserting rule from remote css', {\n                      rule,\n                      error,\n                    })\n                  }\n                }),\n              )\n              .catch((e) => {\n                console.error('Error loading remote css', e.toString())\n              })\n\n            deferreds.push(deferred)\n          }\n        })\n      } catch (e) {\n        const inline =\n          styleSheets.find((a) => a.href == null) || document.styleSheets[0]\n        if (sheet.href != null) {\n          deferreds.push(\n            fetchCSS(sheet.href)\n              .then((metadata) => embedFonts(metadata, options))\n              .then((cssText) =>\n                parseCSS(cssText).forEach((rule) => {\n                  inline.insertRule(rule, sheet.cssRules.length)\n                }),\n              )\n              .catch((err: unknown) => {\n                console.error('Error loading remote stylesheet', err)\n              }),\n          )\n        }\n        console.error('Error inlining remote css file', e)\n      }\n    }\n  })\n\n  return Promise.all(deferreds).then(() => {\n    // Second loop parses rules\n    styleSheets.forEach((sheet) => {\n      if ('cssRules' in sheet) {\n        try {\n          toArray<CSSStyleRule>(sheet.cssRules || []).forEach((item) => {\n            ret.push(item)\n          })\n        } catch (e) {\n          console.error(`Error while reading CSS rules from ${sheet.href}`, e)\n        }\n      }\n    })\n\n    return ret\n  })\n}\n\nfunction getWebFontRules(cssRules: CSSStyleRule[]): CSSStyleRule[] {\n  return cssRules\n    .filter((rule) => rule.type === CSSRule.FONT_FACE_RULE)\n    .filter((rule) => shouldEmbed(rule.style.getPropertyValue('src')))\n}\n\nasync function parseWebFontRules<T extends HTMLElement>(\n  node: T,\n  options: Options,\n) {\n  if (node.ownerDocument == null) {\n    throw new Error('Provided element is not within a Document')\n  }\n\n  const styleSheets = toArray<CSSStyleSheet>(node.ownerDocument.styleSheets)\n  const cssRules = await getCSSRules(styleSheets, options)\n\n  return getWebFontRules(cssRules)\n}\n\nexport async function getWebFontCSS<T extends HTMLElement>(\n  node: T,\n  options: Options,\n): Promise<string> {\n  const rules = await parseWebFontRules(node, options)\n  const cssTexts = await Promise.all(\n    rules.map((rule) => {\n      const baseUrl = rule.parentStyleSheet ? rule.parentStyleSheet.href : null\n      return embedResources(rule.cssText, baseUrl, options)\n    }),\n  )\n\n  return cssTexts.join('\\n')\n}\n\nexport async function embedWebFonts<T extends HTMLElement>(\n  clonedNode: T,\n  options: Options,\n) {\n  const cssText =\n    options.fontEmbedCSS != null\n      ? options.fontEmbedCSS\n      : options.skipFonts\n      ? null\n      : await getWebFontCSS(clonedNode, options)\n\n  if (cssText) {\n    const styleNode = document.createElement('style')\n    const sytleContent = document.createTextNode(cssText)\n\n    styleNode.appendChild(sytleContent)\n\n    if (clonedNode.firstChild) {\n      clonedNode.insertBefore(styleNode, clonedNode.firstChild)\n    } else {\n      clonedNode.appendChild(styleNode)\n    }\n  }\n}\n", "import { Options } from './types'\nimport { cloneNode } from './clone-node'\nimport { embedImages } from './embed-images'\nimport { applyStyle } from './apply-style'\nimport { embedWebFonts, getWebFontCSS } from './embed-webfonts'\nimport {\n  getImageSize,\n  getPixelRatio,\n  createImage,\n  canvasToBlob,\n  nodeToDataURL,\n  checkCanvasDimensions,\n} from './util'\n\nexport async function toSvg<T extends HTMLElement>(\n  node: T,\n  options: Options = {},\n): Promise<string> {\n  const { width, height } = getImageSize(node, options)\n  const clonedNode = (await cloneNode(node, options, true)) as HTMLElement\n  await embedWebFonts(clonedNode, options)\n  await embedImages(clonedNode, options)\n  applyStyle(clonedNode, options)\n  const datauri = await nodeToDataURL(clonedNode, width, height)\n  return datauri\n}\n\nexport async function toCanvas<T extends HTMLElement>(\n  node: T,\n  options: Options = {},\n): Promise<HTMLCanvasElement> {\n  const { width, height } = getImageSize(node, options)\n  const svg = await toSvg(node, options)\n  const img = await createImage(svg)\n\n  const canvas = document.createElement('canvas')\n  const context = canvas.getContext('2d')!\n  const ratio = options.pixelRatio || getPixelRatio()\n  const canvasWidth = options.canvasWidth || width\n  const canvasHeight = options.canvasHeight || height\n\n  canvas.width = canvasWidth * ratio\n  canvas.height = canvasHeight * ratio\n\n  if (!options.skipAutoScale) {\n    checkCanvasDimensions(canvas)\n  }\n  canvas.style.width = `${canvasWidth}`\n  canvas.style.height = `${canvasHeight}`\n\n  if (options.backgroundColor) {\n    context.fillStyle = options.backgroundColor\n    context.fillRect(0, 0, canvas.width, canvas.height)\n  }\n\n  context.drawImage(img, 0, 0, canvas.width, canvas.height)\n\n  return canvas\n}\n\nexport async function toPixelData<T extends HTMLElement>(\n  node: T,\n  options: Options = {},\n): Promise<Uint8ClampedArray> {\n  const { width, height } = getImageSize(node, options)\n  const canvas = await toCanvas(node, options)\n  const ctx = canvas.getContext('2d')!\n  return ctx.getImageData(0, 0, width, height).data\n}\n\nexport async function toPng<T extends HTMLElement>(\n  node: T,\n  options: Options = {},\n): Promise<string> {\n  const canvas = await toCanvas(node, options)\n  return canvas.toDataURL()\n}\n\nexport async function toJpeg<T extends HTMLElement>(\n  node: T,\n  options: Options = {},\n): Promise<string> {\n  const canvas = await toCanvas(node, options)\n  return canvas.toDataURL('image/jpeg', options.quality || 1)\n}\n\nexport async function toBlob<T extends HTMLElement>(\n  node: T,\n  options: Options = {},\n): Promise<Blob | null> {\n  const canvas = await toCanvas(node, options)\n  const blob = await canvasToBlob(canvas)\n  return blob\n}\n\nexport async function getFontEmbedCSS<T extends HTMLElement>(\n  node: T,\n  options: Options = {},\n): Promise<string> {\n  return getWebFontCSS(node, options)\n}\n", "/**\n * marked v4.3.0 - a markdown parser\n * Copyright (c) 2011-2023, Christopher Jeffrey. (MIT Licensed)\n * https://github.com/markedjs/marked\n */\n\n/**\n * DO NOT EDIT THIS FILE\n * The code in this file is generated from files in ./src/\n */\n\nfunction getDefaults() {\n  return {\n    async: false,\n    baseUrl: null,\n    breaks: false,\n    extensions: null,\n    gfm: true,\n    headerIds: true,\n    headerPrefix: '',\n    highlight: null,\n    hooks: null,\n    langPrefix: 'language-',\n    mangle: true,\n    pedantic: false,\n    renderer: null,\n    sanitize: false,\n    sanitizer: null,\n    silent: false,\n    smartypants: false,\n    tokenizer: null,\n    walkTokens: null,\n    xhtml: false\n  };\n}\n\nlet defaults = getDefaults();\n\nfunction changeDefaults(newDefaults) {\n  defaults = newDefaults;\n}\n\n/**\n * Helpers\n */\nconst escapeTest = /[&<>\"']/;\nconst escapeReplace = new RegExp(escapeTest.source, 'g');\nconst escapeTestNoEncode = /[<>\"']|&(?!(#\\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\\w+);)/;\nconst escapeReplaceNoEncode = new RegExp(escapeTestNoEncode.source, 'g');\nconst escapeReplacements = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#39;'\n};\nconst getEscapeReplacement = (ch) => escapeReplacements[ch];\nfunction escape(html, encode) {\n  if (encode) {\n    if (escapeTest.test(html)) {\n      return html.replace(escapeReplace, getEscapeReplacement);\n    }\n  } else {\n    if (escapeTestNoEncode.test(html)) {\n      return html.replace(escapeReplaceNoEncode, getEscapeReplacement);\n    }\n  }\n\n  return html;\n}\n\nconst unescapeTest = /&(#(?:\\d+)|(?:#x[0-9A-Fa-f]+)|(?:\\w+));?/ig;\n\n/**\n * @param {string} html\n */\nfunction unescape(html) {\n  // explicitly match decimal, hex, and named HTML entities\n  return html.replace(unescapeTest, (_, n) => {\n    n = n.toLowerCase();\n    if (n === 'colon') return ':';\n    if (n.charAt(0) === '#') {\n      return n.charAt(1) === 'x'\n        ? String.fromCharCode(parseInt(n.substring(2), 16))\n        : String.fromCharCode(+n.substring(1));\n    }\n    return '';\n  });\n}\n\nconst caret = /(^|[^\\[])\\^/g;\n\n/**\n * @param {string | RegExp} regex\n * @param {string} opt\n */\nfunction edit(regex, opt) {\n  regex = typeof regex === 'string' ? regex : regex.source;\n  opt = opt || '';\n  const obj = {\n    replace: (name, val) => {\n      val = val.source || val;\n      val = val.replace(caret, '$1');\n      regex = regex.replace(name, val);\n      return obj;\n    },\n    getRegex: () => {\n      return new RegExp(regex, opt);\n    }\n  };\n  return obj;\n}\n\nconst nonWordAndColonTest = /[^\\w:]/g;\nconst originIndependentUrl = /^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;\n\n/**\n * @param {boolean} sanitize\n * @param {string} base\n * @param {string} href\n */\nfunction cleanUrl(sanitize, base, href) {\n  if (sanitize) {\n    let prot;\n    try {\n      prot = decodeURIComponent(unescape(href))\n        .replace(nonWordAndColonTest, '')\n        .toLowerCase();\n    } catch (e) {\n      return null;\n    }\n    if (prot.indexOf('javascript:') === 0 || prot.indexOf('vbscript:') === 0 || prot.indexOf('data:') === 0) {\n      return null;\n    }\n  }\n  if (base && !originIndependentUrl.test(href)) {\n    href = resolveUrl(base, href);\n  }\n  try {\n    href = encodeURI(href).replace(/%25/g, '%');\n  } catch (e) {\n    return null;\n  }\n  return href;\n}\n\nconst baseUrls = {};\nconst justDomain = /^[^:]+:\\/*[^/]*$/;\nconst protocol = /^([^:]+:)[\\s\\S]*$/;\nconst domain = /^([^:]+:\\/*[^/]*)[\\s\\S]*$/;\n\n/**\n * @param {string} base\n * @param {string} href\n */\nfunction resolveUrl(base, href) {\n  if (!baseUrls[' ' + base]) {\n    // we can ignore everything in base after the last slash of its path component,\n    // but we might need to add _that_\n    // https://tools.ietf.org/html/rfc3986#section-3\n    if (justDomain.test(base)) {\n      baseUrls[' ' + base] = base + '/';\n    } else {\n      baseUrls[' ' + base] = rtrim(base, '/', true);\n    }\n  }\n  base = baseUrls[' ' + base];\n  const relativeBase = base.indexOf(':') === -1;\n\n  if (href.substring(0, 2) === '//') {\n    if (relativeBase) {\n      return href;\n    }\n    return base.replace(protocol, '$1') + href;\n  } else if (href.charAt(0) === '/') {\n    if (relativeBase) {\n      return href;\n    }\n    return base.replace(domain, '$1') + href;\n  } else {\n    return base + href;\n  }\n}\n\nconst noopTest = { exec: function noopTest() {} };\n\nfunction splitCells(tableRow, count) {\n  // ensure that every cell-delimiting pipe has a space\n  // before it to distinguish it from an escaped pipe\n  const row = tableRow.replace(/\\|/g, (match, offset, str) => {\n      let escaped = false,\n        curr = offset;\n      while (--curr >= 0 && str[curr] === '\\\\') escaped = !escaped;\n      if (escaped) {\n        // odd number of slashes means | is escaped\n        // so we leave it alone\n        return '|';\n      } else {\n        // add space before unescaped |\n        return ' |';\n      }\n    }),\n    cells = row.split(/ \\|/);\n  let i = 0;\n\n  // First/last cell in a row cannot be empty if it has no leading/trailing pipe\n  if (!cells[0].trim()) { cells.shift(); }\n  if (cells.length > 0 && !cells[cells.length - 1].trim()) { cells.pop(); }\n\n  if (cells.length > count) {\n    cells.splice(count);\n  } else {\n    while (cells.length < count) cells.push('');\n  }\n\n  for (; i < cells.length; i++) {\n    // leading or trailing whitespace is ignored per the gfm spec\n    cells[i] = cells[i].trim().replace(/\\\\\\|/g, '|');\n  }\n  return cells;\n}\n\n/**\n * Remove trailing 'c's. Equivalent to str.replace(/c*$/, '').\n * /c*$/ is vulnerable to REDOS.\n *\n * @param {string} str\n * @param {string} c\n * @param {boolean} invert Remove suffix of non-c chars instead. Default falsey.\n */\nfunction rtrim(str, c, invert) {\n  const l = str.length;\n  if (l === 0) {\n    return '';\n  }\n\n  // Length of suffix matching the invert condition.\n  let suffLen = 0;\n\n  // Step left until we fail to match the invert condition.\n  while (suffLen < l) {\n    const currChar = str.charAt(l - suffLen - 1);\n    if (currChar === c && !invert) {\n      suffLen++;\n    } else if (currChar !== c && invert) {\n      suffLen++;\n    } else {\n      break;\n    }\n  }\n\n  return str.slice(0, l - suffLen);\n}\n\nfunction findClosingBracket(str, b) {\n  if (str.indexOf(b[1]) === -1) {\n    return -1;\n  }\n  const l = str.length;\n  let level = 0,\n    i = 0;\n  for (; i < l; i++) {\n    if (str[i] === '\\\\') {\n      i++;\n    } else if (str[i] === b[0]) {\n      level++;\n    } else if (str[i] === b[1]) {\n      level--;\n      if (level < 0) {\n        return i;\n      }\n    }\n  }\n  return -1;\n}\n\nfunction checkSanitizeDeprecation(opt) {\n  if (opt && opt.sanitize && !opt.silent) {\n    console.warn('marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options');\n  }\n}\n\n// copied from https://stackoverflow.com/a/5450113/806777\n/**\n * @param {string} pattern\n * @param {number} count\n */\nfunction repeatString(pattern, count) {\n  if (count < 1) {\n    return '';\n  }\n  let result = '';\n  while (count > 1) {\n    if (count & 1) {\n      result += pattern;\n    }\n    count >>= 1;\n    pattern += pattern;\n  }\n  return result + pattern;\n}\n\nfunction outputLink(cap, link, raw, lexer) {\n  const href = link.href;\n  const title = link.title ? escape(link.title) : null;\n  const text = cap[1].replace(/\\\\([\\[\\]])/g, '$1');\n\n  if (cap[0].charAt(0) !== '!') {\n    lexer.state.inLink = true;\n    const token = {\n      type: 'link',\n      raw,\n      href,\n      title,\n      text,\n      tokens: lexer.inlineTokens(text)\n    };\n    lexer.state.inLink = false;\n    return token;\n  }\n  return {\n    type: 'image',\n    raw,\n    href,\n    title,\n    text: escape(text)\n  };\n}\n\nfunction indentCodeCompensation(raw, text) {\n  const matchIndentToCode = raw.match(/^(\\s+)(?:```)/);\n\n  if (matchIndentToCode === null) {\n    return text;\n  }\n\n  const indentToCode = matchIndentToCode[1];\n\n  return text\n    .split('\\n')\n    .map(node => {\n      const matchIndentInNode = node.match(/^\\s+/);\n      if (matchIndentInNode === null) {\n        return node;\n      }\n\n      const [indentInNode] = matchIndentInNode;\n\n      if (indentInNode.length >= indentToCode.length) {\n        return node.slice(indentToCode.length);\n      }\n\n      return node;\n    })\n    .join('\\n');\n}\n\n/**\n * Tokenizer\n */\nclass Tokenizer {\n  constructor(options) {\n    this.options = options || defaults;\n  }\n\n  space(src) {\n    const cap = this.rules.block.newline.exec(src);\n    if (cap && cap[0].length > 0) {\n      return {\n        type: 'space',\n        raw: cap[0]\n      };\n    }\n  }\n\n  code(src) {\n    const cap = this.rules.block.code.exec(src);\n    if (cap) {\n      const text = cap[0].replace(/^ {1,4}/gm, '');\n      return {\n        type: 'code',\n        raw: cap[0],\n        codeBlockStyle: 'indented',\n        text: !this.options.pedantic\n          ? rtrim(text, '\\n')\n          : text\n      };\n    }\n  }\n\n  fences(src) {\n    const cap = this.rules.block.fences.exec(src);\n    if (cap) {\n      const raw = cap[0];\n      const text = indentCodeCompensation(raw, cap[3] || '');\n\n      return {\n        type: 'code',\n        raw,\n        lang: cap[2] ? cap[2].trim().replace(this.rules.inline._escapes, '$1') : cap[2],\n        text\n      };\n    }\n  }\n\n  heading(src) {\n    const cap = this.rules.block.heading.exec(src);\n    if (cap) {\n      let text = cap[2].trim();\n\n      // remove trailing #s\n      if (/#$/.test(text)) {\n        const trimmed = rtrim(text, '#');\n        if (this.options.pedantic) {\n          text = trimmed.trim();\n        } else if (!trimmed || / $/.test(trimmed)) {\n          // CommonMark requires space before trailing #s\n          text = trimmed.trim();\n        }\n      }\n\n      return {\n        type: 'heading',\n        raw: cap[0],\n        depth: cap[1].length,\n        text,\n        tokens: this.lexer.inline(text)\n      };\n    }\n  }\n\n  hr(src) {\n    const cap = this.rules.block.hr.exec(src);\n    if (cap) {\n      return {\n        type: 'hr',\n        raw: cap[0]\n      };\n    }\n  }\n\n  blockquote(src) {\n    const cap = this.rules.block.blockquote.exec(src);\n    if (cap) {\n      const text = cap[0].replace(/^ *>[ \\t]?/gm, '');\n      const top = this.lexer.state.top;\n      this.lexer.state.top = true;\n      const tokens = this.lexer.blockTokens(text);\n      this.lexer.state.top = top;\n      return {\n        type: 'blockquote',\n        raw: cap[0],\n        tokens,\n        text\n      };\n    }\n  }\n\n  list(src) {\n    let cap = this.rules.block.list.exec(src);\n    if (cap) {\n      let raw, istask, ischecked, indent, i, blankLine, endsWithBlankLine,\n        line, nextLine, rawLine, itemContents, endEarly;\n\n      let bull = cap[1].trim();\n      const isordered = bull.length > 1;\n\n      const list = {\n        type: 'list',\n        raw: '',\n        ordered: isordered,\n        start: isordered ? +bull.slice(0, -1) : '',\n        loose: false,\n        items: []\n      };\n\n      bull = isordered ? `\\\\d{1,9}\\\\${bull.slice(-1)}` : `\\\\${bull}`;\n\n      if (this.options.pedantic) {\n        bull = isordered ? bull : '[*+-]';\n      }\n\n      // Get next list item\n      const itemRegex = new RegExp(`^( {0,3}${bull})((?:[\\t ][^\\\\n]*)?(?:\\\\n|$))`);\n\n      // Check if current bullet point can start a new List Item\n      while (src) {\n        endEarly = false;\n        if (!(cap = itemRegex.exec(src))) {\n          break;\n        }\n\n        if (this.rules.block.hr.test(src)) { // End list if bullet was actually HR (possibly move into itemRegex?)\n          break;\n        }\n\n        raw = cap[0];\n        src = src.substring(raw.length);\n\n        line = cap[2].split('\\n', 1)[0].replace(/^\\t+/, (t) => ' '.repeat(3 * t.length));\n        nextLine = src.split('\\n', 1)[0];\n\n        if (this.options.pedantic) {\n          indent = 2;\n          itemContents = line.trimLeft();\n        } else {\n          indent = cap[2].search(/[^ ]/); // Find first non-space char\n          indent = indent > 4 ? 1 : indent; // Treat indented code blocks (> 4 spaces) as having only 1 indent\n          itemContents = line.slice(indent);\n          indent += cap[1].length;\n        }\n\n        blankLine = false;\n\n        if (!line && /^ *$/.test(nextLine)) { // Items begin with at most one blank line\n          raw += nextLine + '\\n';\n          src = src.substring(nextLine.length + 1);\n          endEarly = true;\n        }\n\n        if (!endEarly) {\n          const nextBulletRegex = new RegExp(`^ {0,${Math.min(3, indent - 1)}}(?:[*+-]|\\\\d{1,9}[.)])((?:[ \\t][^\\\\n]*)?(?:\\\\n|$))`);\n          const hrRegex = new RegExp(`^ {0,${Math.min(3, indent - 1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\\\* *){3,})(?:\\\\n+|$)`);\n          const fencesBeginRegex = new RegExp(`^ {0,${Math.min(3, indent - 1)}}(?:\\`\\`\\`|~~~)`);\n          const headingBeginRegex = new RegExp(`^ {0,${Math.min(3, indent - 1)}}#`);\n\n          // Check if following lines should be included in List Item\n          while (src) {\n            rawLine = src.split('\\n', 1)[0];\n            nextLine = rawLine;\n\n            // Re-align to follow commonmark nesting rules\n            if (this.options.pedantic) {\n              nextLine = nextLine.replace(/^ {1,4}(?=( {4})*[^ ])/g, '  ');\n            }\n\n            // End list item if found code fences\n            if (fencesBeginRegex.test(nextLine)) {\n              break;\n            }\n\n            // End list item if found start of new heading\n            if (headingBeginRegex.test(nextLine)) {\n              break;\n            }\n\n            // End list item if found start of new bullet\n            if (nextBulletRegex.test(nextLine)) {\n              break;\n            }\n\n            // Horizontal rule found\n            if (hrRegex.test(src)) {\n              break;\n            }\n\n            if (nextLine.search(/[^ ]/) >= indent || !nextLine.trim()) { // Dedent if possible\n              itemContents += '\\n' + nextLine.slice(indent);\n            } else {\n              // not enough indentation\n              if (blankLine) {\n                break;\n              }\n\n              // paragraph continuation unless last line was a different block level element\n              if (line.search(/[^ ]/) >= 4) { // indented code block\n                break;\n              }\n              if (fencesBeginRegex.test(line)) {\n                break;\n              }\n              if (headingBeginRegex.test(line)) {\n                break;\n              }\n              if (hrRegex.test(line)) {\n                break;\n              }\n\n              itemContents += '\\n' + nextLine;\n            }\n\n            if (!blankLine && !nextLine.trim()) { // Check if current line is blank\n              blankLine = true;\n            }\n\n            raw += rawLine + '\\n';\n            src = src.substring(rawLine.length + 1);\n            line = nextLine.slice(indent);\n          }\n        }\n\n        if (!list.loose) {\n          // If the previous item ended with a blank line, the list is loose\n          if (endsWithBlankLine) {\n            list.loose = true;\n          } else if (/\\n *\\n *$/.test(raw)) {\n            endsWithBlankLine = true;\n          }\n        }\n\n        // Check for task list items\n        if (this.options.gfm) {\n          istask = /^\\[[ xX]\\] /.exec(itemContents);\n          if (istask) {\n            ischecked = istask[0] !== '[ ] ';\n            itemContents = itemContents.replace(/^\\[[ xX]\\] +/, '');\n          }\n        }\n\n        list.items.push({\n          type: 'list_item',\n          raw,\n          task: !!istask,\n          checked: ischecked,\n          loose: false,\n          text: itemContents\n        });\n\n        list.raw += raw;\n      }\n\n      // Do not consume newlines at end of final item. Alternatively, make itemRegex *start* with any newlines to simplify/speed up endsWithBlankLine logic\n      list.items[list.items.length - 1].raw = raw.trimRight();\n      list.items[list.items.length - 1].text = itemContents.trimRight();\n      list.raw = list.raw.trimRight();\n\n      const l = list.items.length;\n\n      // Item child tokens handled here at end because we needed to have the final item to trim it first\n      for (i = 0; i < l; i++) {\n        this.lexer.state.top = false;\n        list.items[i].tokens = this.lexer.blockTokens(list.items[i].text, []);\n\n        if (!list.loose) {\n          // Check if list should be loose\n          const spacers = list.items[i].tokens.filter(t => t.type === 'space');\n          const hasMultipleLineBreaks = spacers.length > 0 && spacers.some(t => /\\n.*\\n/.test(t.raw));\n\n          list.loose = hasMultipleLineBreaks;\n        }\n      }\n\n      // Set all items to loose if list is loose\n      if (list.loose) {\n        for (i = 0; i < l; i++) {\n          list.items[i].loose = true;\n        }\n      }\n\n      return list;\n    }\n  }\n\n  html(src) {\n    const cap = this.rules.block.html.exec(src);\n    if (cap) {\n      const token = {\n        type: 'html',\n        raw: cap[0],\n        pre: !this.options.sanitizer\n          && (cap[1] === 'pre' || cap[1] === 'script' || cap[1] === 'style'),\n        text: cap[0]\n      };\n      if (this.options.sanitize) {\n        const text = this.options.sanitizer ? this.options.sanitizer(cap[0]) : escape(cap[0]);\n        token.type = 'paragraph';\n        token.text = text;\n        token.tokens = this.lexer.inline(text);\n      }\n      return token;\n    }\n  }\n\n  def(src) {\n    const cap = this.rules.block.def.exec(src);\n    if (cap) {\n      const tag = cap[1].toLowerCase().replace(/\\s+/g, ' ');\n      const href = cap[2] ? cap[2].replace(/^<(.*)>$/, '$1').replace(this.rules.inline._escapes, '$1') : '';\n      const title = cap[3] ? cap[3].substring(1, cap[3].length - 1).replace(this.rules.inline._escapes, '$1') : cap[3];\n      return {\n        type: 'def',\n        tag,\n        raw: cap[0],\n        href,\n        title\n      };\n    }\n  }\n\n  table(src) {\n    const cap = this.rules.block.table.exec(src);\n    if (cap) {\n      const item = {\n        type: 'table',\n        header: splitCells(cap[1]).map(c => { return { text: c }; }),\n        align: cap[2].replace(/^ *|\\| *$/g, '').split(/ *\\| */),\n        rows: cap[3] && cap[3].trim() ? cap[3].replace(/\\n[ \\t]*$/, '').split('\\n') : []\n      };\n\n      if (item.header.length === item.align.length) {\n        item.raw = cap[0];\n\n        let l = item.align.length;\n        let i, j, k, row;\n        for (i = 0; i < l; i++) {\n          if (/^ *-+: *$/.test(item.align[i])) {\n            item.align[i] = 'right';\n          } else if (/^ *:-+: *$/.test(item.align[i])) {\n            item.align[i] = 'center';\n          } else if (/^ *:-+ *$/.test(item.align[i])) {\n            item.align[i] = 'left';\n          } else {\n            item.align[i] = null;\n          }\n        }\n\n        l = item.rows.length;\n        for (i = 0; i < l; i++) {\n          item.rows[i] = splitCells(item.rows[i], item.header.length).map(c => { return { text: c }; });\n        }\n\n        // parse child tokens inside headers and cells\n\n        // header child tokens\n        l = item.header.length;\n        for (j = 0; j < l; j++) {\n          item.header[j].tokens = this.lexer.inline(item.header[j].text);\n        }\n\n        // cell child tokens\n        l = item.rows.length;\n        for (j = 0; j < l; j++) {\n          row = item.rows[j];\n          for (k = 0; k < row.length; k++) {\n            row[k].tokens = this.lexer.inline(row[k].text);\n          }\n        }\n\n        return item;\n      }\n    }\n  }\n\n  lheading(src) {\n    const cap = this.rules.block.lheading.exec(src);\n    if (cap) {\n      return {\n        type: 'heading',\n        raw: cap[0],\n        depth: cap[2].charAt(0) === '=' ? 1 : 2,\n        text: cap[1],\n        tokens: this.lexer.inline(cap[1])\n      };\n    }\n  }\n\n  paragraph(src) {\n    const cap = this.rules.block.paragraph.exec(src);\n    if (cap) {\n      const text = cap[1].charAt(cap[1].length - 1) === '\\n'\n        ? cap[1].slice(0, -1)\n        : cap[1];\n      return {\n        type: 'paragraph',\n        raw: cap[0],\n        text,\n        tokens: this.lexer.inline(text)\n      };\n    }\n  }\n\n  text(src) {\n    const cap = this.rules.block.text.exec(src);\n    if (cap) {\n      return {\n        type: 'text',\n        raw: cap[0],\n        text: cap[0],\n        tokens: this.lexer.inline(cap[0])\n      };\n    }\n  }\n\n  escape(src) {\n    const cap = this.rules.inline.escape.exec(src);\n    if (cap) {\n      return {\n        type: 'escape',\n        raw: cap[0],\n        text: escape(cap[1])\n      };\n    }\n  }\n\n  tag(src) {\n    const cap = this.rules.inline.tag.exec(src);\n    if (cap) {\n      if (!this.lexer.state.inLink && /^<a /i.test(cap[0])) {\n        this.lexer.state.inLink = true;\n      } else if (this.lexer.state.inLink && /^<\\/a>/i.test(cap[0])) {\n        this.lexer.state.inLink = false;\n      }\n      if (!this.lexer.state.inRawBlock && /^<(pre|code|kbd|script)(\\s|>)/i.test(cap[0])) {\n        this.lexer.state.inRawBlock = true;\n      } else if (this.lexer.state.inRawBlock && /^<\\/(pre|code|kbd|script)(\\s|>)/i.test(cap[0])) {\n        this.lexer.state.inRawBlock = false;\n      }\n\n      return {\n        type: this.options.sanitize\n          ? 'text'\n          : 'html',\n        raw: cap[0],\n        inLink: this.lexer.state.inLink,\n        inRawBlock: this.lexer.state.inRawBlock,\n        text: this.options.sanitize\n          ? (this.options.sanitizer\n            ? this.options.sanitizer(cap[0])\n            : escape(cap[0]))\n          : cap[0]\n      };\n    }\n  }\n\n  link(src) {\n    const cap = this.rules.inline.link.exec(src);\n    if (cap) {\n      const trimmedUrl = cap[2].trim();\n      if (!this.options.pedantic && /^</.test(trimmedUrl)) {\n        // commonmark requires matching angle brackets\n        if (!(/>$/.test(trimmedUrl))) {\n          return;\n        }\n\n        // ending angle bracket cannot be escaped\n        const rtrimSlash = rtrim(trimmedUrl.slice(0, -1), '\\\\');\n        if ((trimmedUrl.length - rtrimSlash.length) % 2 === 0) {\n          return;\n        }\n      } else {\n        // find closing parenthesis\n        const lastParenIndex = findClosingBracket(cap[2], '()');\n        if (lastParenIndex > -1) {\n          const start = cap[0].indexOf('!') === 0 ? 5 : 4;\n          const linkLen = start + cap[1].length + lastParenIndex;\n          cap[2] = cap[2].substring(0, lastParenIndex);\n          cap[0] = cap[0].substring(0, linkLen).trim();\n          cap[3] = '';\n        }\n      }\n      let href = cap[2];\n      let title = '';\n      if (this.options.pedantic) {\n        // split pedantic href and title\n        const link = /^([^'\"]*[^\\s])\\s+(['\"])(.*)\\2/.exec(href);\n\n        if (link) {\n          href = link[1];\n          title = link[3];\n        }\n      } else {\n        title = cap[3] ? cap[3].slice(1, -1) : '';\n      }\n\n      href = href.trim();\n      if (/^</.test(href)) {\n        if (this.options.pedantic && !(/>$/.test(trimmedUrl))) {\n          // pedantic allows starting angle bracket without ending angle bracket\n          href = href.slice(1);\n        } else {\n          href = href.slice(1, -1);\n        }\n      }\n      return outputLink(cap, {\n        href: href ? href.replace(this.rules.inline._escapes, '$1') : href,\n        title: title ? title.replace(this.rules.inline._escapes, '$1') : title\n      }, cap[0], this.lexer);\n    }\n  }\n\n  reflink(src, links) {\n    let cap;\n    if ((cap = this.rules.inline.reflink.exec(src))\n        || (cap = this.rules.inline.nolink.exec(src))) {\n      let link = (cap[2] || cap[1]).replace(/\\s+/g, ' ');\n      link = links[link.toLowerCase()];\n      if (!link) {\n        const text = cap[0].charAt(0);\n        return {\n          type: 'text',\n          raw: text,\n          text\n        };\n      }\n      return outputLink(cap, link, cap[0], this.lexer);\n    }\n  }\n\n  emStrong(src, maskedSrc, prevChar = '') {\n    let match = this.rules.inline.emStrong.lDelim.exec(src);\n    if (!match) return;\n\n    // _ can't be between two alphanumerics. \\p{L}\\p{N} includes non-english alphabet/numbers as well\n    if (match[3] && prevChar.match(/[\\p{L}\\p{N}]/u)) return;\n\n    const nextChar = match[1] || match[2] || '';\n\n    if (!nextChar || (nextChar && (prevChar === '' || this.rules.inline.punctuation.exec(prevChar)))) {\n      const lLength = match[0].length - 1;\n      let rDelim, rLength, delimTotal = lLength, midDelimTotal = 0;\n\n      const endReg = match[0][0] === '*' ? this.rules.inline.emStrong.rDelimAst : this.rules.inline.emStrong.rDelimUnd;\n      endReg.lastIndex = 0;\n\n      // Clip maskedSrc to same section of string as src (move to lexer?)\n      maskedSrc = maskedSrc.slice(-1 * src.length + lLength);\n\n      while ((match = endReg.exec(maskedSrc)) != null) {\n        rDelim = match[1] || match[2] || match[3] || match[4] || match[5] || match[6];\n\n        if (!rDelim) continue; // skip single * in __abc*abc__\n\n        rLength = rDelim.length;\n\n        if (match[3] || match[4]) { // found another Left Delim\n          delimTotal += rLength;\n          continue;\n        } else if (match[5] || match[6]) { // either Left or Right Delim\n          if (lLength % 3 && !((lLength + rLength) % 3)) {\n            midDelimTotal += rLength;\n            continue; // CommonMark Emphasis Rules 9-10\n          }\n        }\n\n        delimTotal -= rLength;\n\n        if (delimTotal > 0) continue; // Haven't found enough closing delimiters\n\n        // Remove extra characters. *a*** -> *a*\n        rLength = Math.min(rLength, rLength + delimTotal + midDelimTotal);\n\n        const raw = src.slice(0, lLength + match.index + (match[0].length - rDelim.length) + rLength);\n\n        // Create `em` if smallest delimiter has odd char count. *a***\n        if (Math.min(lLength, rLength) % 2) {\n          const text = raw.slice(1, -1);\n          return {\n            type: 'em',\n            raw,\n            text,\n            tokens: this.lexer.inlineTokens(text)\n          };\n        }\n\n        // Create 'strong' if smallest delimiter has even char count. **a***\n        const text = raw.slice(2, -2);\n        return {\n          type: 'strong',\n          raw,\n          text,\n          tokens: this.lexer.inlineTokens(text)\n        };\n      }\n    }\n  }\n\n  codespan(src) {\n    const cap = this.rules.inline.code.exec(src);\n    if (cap) {\n      let text = cap[2].replace(/\\n/g, ' ');\n      const hasNonSpaceChars = /[^ ]/.test(text);\n      const hasSpaceCharsOnBothEnds = /^ /.test(text) && / $/.test(text);\n      if (hasNonSpaceChars && hasSpaceCharsOnBothEnds) {\n        text = text.substring(1, text.length - 1);\n      }\n      text = escape(text, true);\n      return {\n        type: 'codespan',\n        raw: cap[0],\n        text\n      };\n    }\n  }\n\n  br(src) {\n    const cap = this.rules.inline.br.exec(src);\n    if (cap) {\n      return {\n        type: 'br',\n        raw: cap[0]\n      };\n    }\n  }\n\n  del(src) {\n    const cap = this.rules.inline.del.exec(src);\n    if (cap) {\n      return {\n        type: 'del',\n        raw: cap[0],\n        text: cap[2],\n        tokens: this.lexer.inlineTokens(cap[2])\n      };\n    }\n  }\n\n  autolink(src, mangle) {\n    const cap = this.rules.inline.autolink.exec(src);\n    if (cap) {\n      let text, href;\n      if (cap[2] === '@') {\n        text = escape(this.options.mangle ? mangle(cap[1]) : cap[1]);\n        href = 'mailto:' + text;\n      } else {\n        text = escape(cap[1]);\n        href = text;\n      }\n\n      return {\n        type: 'link',\n        raw: cap[0],\n        text,\n        href,\n        tokens: [\n          {\n            type: 'text',\n            raw: text,\n            text\n          }\n        ]\n      };\n    }\n  }\n\n  url(src, mangle) {\n    let cap;\n    if (cap = this.rules.inline.url.exec(src)) {\n      let text, href;\n      if (cap[2] === '@') {\n        text = escape(this.options.mangle ? mangle(cap[0]) : cap[0]);\n        href = 'mailto:' + text;\n      } else {\n        // do extended autolink path validation\n        let prevCapZero;\n        do {\n          prevCapZero = cap[0];\n          cap[0] = this.rules.inline._backpedal.exec(cap[0])[0];\n        } while (prevCapZero !== cap[0]);\n        text = escape(cap[0]);\n        if (cap[1] === 'www.') {\n          href = 'http://' + cap[0];\n        } else {\n          href = cap[0];\n        }\n      }\n      return {\n        type: 'link',\n        raw: cap[0],\n        text,\n        href,\n        tokens: [\n          {\n            type: 'text',\n            raw: text,\n            text\n          }\n        ]\n      };\n    }\n  }\n\n  inlineText(src, smartypants) {\n    const cap = this.rules.inline.text.exec(src);\n    if (cap) {\n      let text;\n      if (this.lexer.state.inRawBlock) {\n        text = this.options.sanitize ? (this.options.sanitizer ? this.options.sanitizer(cap[0]) : escape(cap[0])) : cap[0];\n      } else {\n        text = escape(this.options.smartypants ? smartypants(cap[0]) : cap[0]);\n      }\n      return {\n        type: 'text',\n        raw: cap[0],\n        text\n      };\n    }\n  }\n}\n\n/**\n * Block-Level Grammar\n */\nconst block = {\n  newline: /^(?: *(?:\\n|$))+/,\n  code: /^( {4}[^\\n]+(?:\\n(?: *(?:\\n|$))*)?)+/,\n  fences: /^ {0,3}(`{3,}(?=[^`\\n]*(?:\\n|$))|~{3,})([^\\n]*)(?:\\n|$)(?:|([\\s\\S]*?)(?:\\n|$))(?: {0,3}\\1[~`]* *(?=\\n|$)|$)/,\n  hr: /^ {0,3}((?:-[\\t ]*){3,}|(?:_[ \\t]*){3,}|(?:\\*[ \\t]*){3,})(?:\\n+|$)/,\n  heading: /^ {0,3}(#{1,6})(?=\\s|$)(.*)(?:\\n+|$)/,\n  blockquote: /^( {0,3}> ?(paragraph|[^\\n]*)(?:\\n|$))+/,\n  list: /^( {0,3}bull)([ \\t][^\\n]+?)?(?:\\n|$)/,\n  html: '^ {0,3}(?:' // optional indentation\n    + '<(script|pre|style|textarea)[\\\\s>][\\\\s\\\\S]*?(?:</\\\\1>[^\\\\n]*\\\\n+|$)' // (1)\n    + '|comment[^\\\\n]*(\\\\n+|$)' // (2)\n    + '|<\\\\?[\\\\s\\\\S]*?(?:\\\\?>\\\\n*|$)' // (3)\n    + '|<![A-Z][\\\\s\\\\S]*?(?:>\\\\n*|$)' // (4)\n    + '|<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?(?:\\\\]\\\\]>\\\\n*|$)' // (5)\n    + '|</?(tag)(?: +|\\\\n|/?>)[\\\\s\\\\S]*?(?:(?:\\\\n *)+\\\\n|$)' // (6)\n    + '|<(?!script|pre|style|textarea)([a-z][\\\\w-]*)(?:attribute)*? */?>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n *)+\\\\n|$)' // (7) open tag\n    + '|</(?!script|pre|style|textarea)[a-z][\\\\w-]*\\\\s*>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n *)+\\\\n|$)' // (7) closing tag\n    + ')',\n  def: /^ {0,3}\\[(label)\\]: *(?:\\n *)?([^<\\s][^\\s]*|<.*?>)(?:(?: +(?:\\n *)?| *\\n *)(title))? *(?:\\n+|$)/,\n  table: noopTest,\n  lheading: /^((?:.|\\n(?!\\n))+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/,\n  // regex template, placeholders will be replaced according to different paragraph\n  // interruption rules of commonmark and the original markdown spec:\n  _paragraph: /^([^\\n]+(?:\\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\\n)[^\\n]+)*)/,\n  text: /^[^\\n]+/\n};\n\nblock._label = /(?!\\s*\\])(?:\\\\.|[^\\[\\]\\\\])+/;\nblock._title = /(?:\"(?:\\\\\"?|[^\"\\\\])*\"|'[^'\\n]*(?:\\n[^'\\n]+)*\\n?'|\\([^()]*\\))/;\nblock.def = edit(block.def)\n  .replace('label', block._label)\n  .replace('title', block._title)\n  .getRegex();\n\nblock.bullet = /(?:[*+-]|\\d{1,9}[.)])/;\nblock.listItemStart = edit(/^( *)(bull) */)\n  .replace('bull', block.bullet)\n  .getRegex();\n\nblock.list = edit(block.list)\n  .replace(/bull/g, block.bullet)\n  .replace('hr', '\\\\n+(?=\\\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\\\* *){3,})(?:\\\\n+|$))')\n  .replace('def', '\\\\n+(?=' + block.def.source + ')')\n  .getRegex();\n\nblock._tag = 'address|article|aside|base|basefont|blockquote|body|caption'\n  + '|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption'\n  + '|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe'\n  + '|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option'\n  + '|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr'\n  + '|track|ul';\nblock._comment = /<!--(?!-?>)[\\s\\S]*?(?:-->|$)/;\nblock.html = edit(block.html, 'i')\n  .replace('comment', block._comment)\n  .replace('tag', block._tag)\n  .replace('attribute', / +[a-zA-Z:_][\\w.:-]*(?: *= *\"[^\"\\n]*\"| *= *'[^'\\n]*'| *= *[^\\s\"'=<>`]+)?/)\n  .getRegex();\n\nblock.paragraph = edit(block._paragraph)\n  .replace('hr', block.hr)\n  .replace('heading', ' {0,3}#{1,6} ')\n  .replace('|lheading', '') // setex headings don't interrupt commonmark paragraphs\n  .replace('|table', '')\n  .replace('blockquote', ' {0,3}>')\n  .replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n')\n  .replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n  .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)')\n  .replace('tag', block._tag) // pars can be interrupted by type (6) html blocks\n  .getRegex();\n\nblock.blockquote = edit(block.blockquote)\n  .replace('paragraph', block.paragraph)\n  .getRegex();\n\n/**\n * Normal Block Grammar\n */\n\nblock.normal = { ...block };\n\n/**\n * GFM Block Grammar\n */\n\nblock.gfm = {\n  ...block.normal,\n  table: '^ *([^\\\\n ].*\\\\|.*)\\\\n' // Header\n    + ' {0,3}(?:\\\\| *)?(:?-+:? *(?:\\\\| *:?-+:? *)*)(?:\\\\| *)?' // Align\n    + '(?:\\\\n((?:(?! *\\\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\\\n|$))*)\\\\n*|$)' // Cells\n};\n\nblock.gfm.table = edit(block.gfm.table)\n  .replace('hr', block.hr)\n  .replace('heading', ' {0,3}#{1,6} ')\n  .replace('blockquote', ' {0,3}>')\n  .replace('code', ' {4}[^\\\\n]')\n  .replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n')\n  .replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n  .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)')\n  .replace('tag', block._tag) // tables can be interrupted by type (6) html blocks\n  .getRegex();\n\nblock.gfm.paragraph = edit(block._paragraph)\n  .replace('hr', block.hr)\n  .replace('heading', ' {0,3}#{1,6} ')\n  .replace('|lheading', '') // setex headings don't interrupt commonmark paragraphs\n  .replace('table', block.gfm.table) // interrupt paragraphs with table\n  .replace('blockquote', ' {0,3}>')\n  .replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n')\n  .replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n  .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)')\n  .replace('tag', block._tag) // pars can be interrupted by type (6) html blocks\n  .getRegex();\n/**\n * Pedantic grammar (original John Gruber's loose markdown specification)\n */\n\nblock.pedantic = {\n  ...block.normal,\n  html: edit(\n    '^ *(?:comment *(?:\\\\n|\\\\s*$)'\n    + '|<(tag)[\\\\s\\\\S]+?</\\\\1> *(?:\\\\n{2,}|\\\\s*$)' // closed tag\n    + '|<tag(?:\"[^\"]*\"|\\'[^\\']*\\'|\\\\s[^\\'\"/>\\\\s]*)*?/?> *(?:\\\\n{2,}|\\\\s*$))')\n    .replace('comment', block._comment)\n    .replace(/tag/g, '(?!(?:'\n      + 'a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub'\n      + '|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)'\n      + '\\\\b)\\\\w+(?!:|[^\\\\w\\\\s@]*@)\\\\b')\n    .getRegex(),\n  def: /^ *\\[([^\\]]+)\\]: *<?([^\\s>]+)>?(?: +([\"(][^\\n]+[\")]))? *(?:\\n+|$)/,\n  heading: /^(#{1,6})(.*)(?:\\n+|$)/,\n  fences: noopTest, // fences not supported\n  lheading: /^(.+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/,\n  paragraph: edit(block.normal._paragraph)\n    .replace('hr', block.hr)\n    .replace('heading', ' *#{1,6} *[^\\n]')\n    .replace('lheading', block.lheading)\n    .replace('blockquote', ' {0,3}>')\n    .replace('|fences', '')\n    .replace('|list', '')\n    .replace('|html', '')\n    .getRegex()\n};\n\n/**\n * Inline-Level Grammar\n */\nconst inline = {\n  escape: /^\\\\([!\"#$%&'()*+,\\-./:;<=>?@\\[\\]\\\\^_`{|}~])/,\n  autolink: /^<(scheme:[^\\s\\x00-\\x1f<>]*|email)>/,\n  url: noopTest,\n  tag: '^comment'\n    + '|^</[a-zA-Z][\\\\w:-]*\\\\s*>' // self-closing tag\n    + '|^<[a-zA-Z][\\\\w-]*(?:attribute)*?\\\\s*/?>' // open tag\n    + '|^<\\\\?[\\\\s\\\\S]*?\\\\?>' // processing instruction, e.g. <?php ?>\n    + '|^<![a-zA-Z]+\\\\s[\\\\s\\\\S]*?>' // declaration, e.g. <!DOCTYPE html>\n    + '|^<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?\\\\]\\\\]>', // CDATA section\n  link: /^!?\\[(label)\\]\\(\\s*(href)(?:\\s+(title))?\\s*\\)/,\n  reflink: /^!?\\[(label)\\]\\[(ref)\\]/,\n  nolink: /^!?\\[(ref)\\](?:\\[\\])?/,\n  reflinkSearch: 'reflink|nolink(?!\\\\()',\n  emStrong: {\n    lDelim: /^(?:\\*+(?:([punct_])|[^\\s*]))|^_+(?:([punct*])|([^\\s_]))/,\n    //        (1) and (2) can only be a Right Delimiter. (3) and (4) can only be Left.  (5) and (6) can be either Left or Right.\n    //          () Skip orphan inside strong                                      () Consume to delim     (1) #***                (2) a***#, a***                             (3) #***a, ***a                 (4) ***#              (5) #***#                 (6) a***a\n    rDelimAst: /^(?:[^_*\\\\]|\\\\.)*?\\_\\_(?:[^_*\\\\]|\\\\.)*?\\*(?:[^_*\\\\]|\\\\.)*?(?=\\_\\_)|(?:[^*\\\\]|\\\\.)+(?=[^*])|[punct_](\\*+)(?=[\\s]|$)|(?:[^punct*_\\s\\\\]|\\\\.)(\\*+)(?=[punct_\\s]|$)|[punct_\\s](\\*+)(?=[^punct*_\\s])|[\\s](\\*+)(?=[punct_])|[punct_](\\*+)(?=[punct_])|(?:[^punct*_\\s\\\\]|\\\\.)(\\*+)(?=[^punct*_\\s])/,\n    rDelimUnd: /^(?:[^_*\\\\]|\\\\.)*?\\*\\*(?:[^_*\\\\]|\\\\.)*?\\_(?:[^_*\\\\]|\\\\.)*?(?=\\*\\*)|(?:[^_\\\\]|\\\\.)+(?=[^_])|[punct*](\\_+)(?=[\\s]|$)|(?:[^punct*_\\s\\\\]|\\\\.)(\\_+)(?=[punct*\\s]|$)|[punct*\\s](\\_+)(?=[^punct*_\\s])|[\\s](\\_+)(?=[punct*])|[punct*](\\_+)(?=[punct*])/ // ^- Not allowed for _\n  },\n  code: /^(`+)([^`]|[^`][\\s\\S]*?[^`])\\1(?!`)/,\n  br: /^( {2,}|\\\\)\\n(?!\\s*$)/,\n  del: noopTest,\n  text: /^(`+|[^`])(?:(?= {2,}\\n)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*_]|\\b_|$)|[^ ](?= {2,}\\n)))/,\n  punctuation: /^([\\spunctuation])/\n};\n\n// list of punctuation marks from CommonMark spec\n// without * and _ to handle the different emphasis markers * and _\ninline._punctuation = '!\"#$%&\\'()+\\\\-.,/:;<=>?@\\\\[\\\\]`^{|}~';\ninline.punctuation = edit(inline.punctuation).replace(/punctuation/g, inline._punctuation).getRegex();\n\n// sequences em should skip over [title](link), `code`, <html>\ninline.blockSkip = /\\[[^\\]]*?\\]\\([^\\)]*?\\)|`[^`]*?`|<[^>]*?>/g;\n// lookbehind is not available on Safari as of version 16\n// inline.escapedEmSt = /(?<=(?:^|[^\\\\)(?:\\\\[^])*)\\\\[*_]/g;\ninline.escapedEmSt = /(?:^|[^\\\\])(?:\\\\\\\\)*\\\\[*_]/g;\n\ninline._comment = edit(block._comment).replace('(?:-->|$)', '-->').getRegex();\n\ninline.emStrong.lDelim = edit(inline.emStrong.lDelim)\n  .replace(/punct/g, inline._punctuation)\n  .getRegex();\n\ninline.emStrong.rDelimAst = edit(inline.emStrong.rDelimAst, 'g')\n  .replace(/punct/g, inline._punctuation)\n  .getRegex();\n\ninline.emStrong.rDelimUnd = edit(inline.emStrong.rDelimUnd, 'g')\n  .replace(/punct/g, inline._punctuation)\n  .getRegex();\n\ninline._escapes = /\\\\([!\"#$%&'()*+,\\-./:;<=>?@\\[\\]\\\\^_`{|}~])/g;\n\ninline._scheme = /[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;\ninline._email = /[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;\ninline.autolink = edit(inline.autolink)\n  .replace('scheme', inline._scheme)\n  .replace('email', inline._email)\n  .getRegex();\n\ninline._attribute = /\\s+[a-zA-Z:_][\\w.:-]*(?:\\s*=\\s*\"[^\"]*\"|\\s*=\\s*'[^']*'|\\s*=\\s*[^\\s\"'=<>`]+)?/;\n\ninline.tag = edit(inline.tag)\n  .replace('comment', inline._comment)\n  .replace('attribute', inline._attribute)\n  .getRegex();\n\ninline._label = /(?:\\[(?:\\\\.|[^\\[\\]\\\\])*\\]|\\\\.|`[^`]*`|[^\\[\\]\\\\`])*?/;\ninline._href = /<(?:\\\\.|[^\\n<>\\\\])+>|[^\\s\\x00-\\x1f]*/;\ninline._title = /\"(?:\\\\\"?|[^\"\\\\])*\"|'(?:\\\\'?|[^'\\\\])*'|\\((?:\\\\\\)?|[^)\\\\])*\\)/;\n\ninline.link = edit(inline.link)\n  .replace('label', inline._label)\n  .replace('href', inline._href)\n  .replace('title', inline._title)\n  .getRegex();\n\ninline.reflink = edit(inline.reflink)\n  .replace('label', inline._label)\n  .replace('ref', block._label)\n  .getRegex();\n\ninline.nolink = edit(inline.nolink)\n  .replace('ref', block._label)\n  .getRegex();\n\ninline.reflinkSearch = edit(inline.reflinkSearch, 'g')\n  .replace('reflink', inline.reflink)\n  .replace('nolink', inline.nolink)\n  .getRegex();\n\n/**\n * Normal Inline Grammar\n */\n\ninline.normal = { ...inline };\n\n/**\n * Pedantic Inline Grammar\n */\n\ninline.pedantic = {\n  ...inline.normal,\n  strong: {\n    start: /^__|\\*\\*/,\n    middle: /^__(?=\\S)([\\s\\S]*?\\S)__(?!_)|^\\*\\*(?=\\S)([\\s\\S]*?\\S)\\*\\*(?!\\*)/,\n    endAst: /\\*\\*(?!\\*)/g,\n    endUnd: /__(?!_)/g\n  },\n  em: {\n    start: /^_|\\*/,\n    middle: /^()\\*(?=\\S)([\\s\\S]*?\\S)\\*(?!\\*)|^_(?=\\S)([\\s\\S]*?\\S)_(?!_)/,\n    endAst: /\\*(?!\\*)/g,\n    endUnd: /_(?!_)/g\n  },\n  link: edit(/^!?\\[(label)\\]\\((.*?)\\)/)\n    .replace('label', inline._label)\n    .getRegex(),\n  reflink: edit(/^!?\\[(label)\\]\\s*\\[([^\\]]*)\\]/)\n    .replace('label', inline._label)\n    .getRegex()\n};\n\n/**\n * GFM Inline Grammar\n */\n\ninline.gfm = {\n  ...inline.normal,\n  escape: edit(inline.escape).replace('])', '~|])').getRegex(),\n  _extended_email: /[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,\n  url: /^((?:ftp|https?):\\/\\/|www\\.)(?:[a-zA-Z0-9\\-]+\\.?)+[^\\s<]*|^email/,\n  _backpedal: /(?:[^?!.,:;*_'\"~()&]+|\\([^)]*\\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'\"~)]+(?!$))+/,\n  del: /^(~~?)(?=[^\\s~])([\\s\\S]*?[^\\s~])\\1(?=[^~]|$)/,\n  text: /^([`~]+|[^`~])(?:(?= {2,}\\n)|(?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*~_]|\\b_|https?:\\/\\/|ftp:\\/\\/|www\\.|$)|[^ ](?= {2,}\\n)|[^a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-](?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)))/\n};\n\ninline.gfm.url = edit(inline.gfm.url, 'i')\n  .replace('email', inline.gfm._extended_email)\n  .getRegex();\n/**\n * GFM + Line Breaks Inline Grammar\n */\n\ninline.breaks = {\n  ...inline.gfm,\n  br: edit(inline.br).replace('{2,}', '*').getRegex(),\n  text: edit(inline.gfm.text)\n    .replace('\\\\b_', '\\\\b_| {2,}\\\\n')\n    .replace(/\\{2,\\}/g, '*')\n    .getRegex()\n};\n\n/**\n * smartypants text replacement\n * @param {string} text\n */\nfunction smartypants(text) {\n  return text\n    // em-dashes\n    .replace(/---/g, '\\u2014')\n    // en-dashes\n    .replace(/--/g, '\\u2013')\n    // opening singles\n    .replace(/(^|[-\\u2014/(\\[{\"\\s])'/g, '$1\\u2018')\n    // closing singles & apostrophes\n    .replace(/'/g, '\\u2019')\n    // opening doubles\n    .replace(/(^|[-\\u2014/(\\[{\\u2018\\s])\"/g, '$1\\u201c')\n    // closing doubles\n    .replace(/\"/g, '\\u201d')\n    // ellipses\n    .replace(/\\.{3}/g, '\\u2026');\n}\n\n/**\n * mangle email addresses\n * @param {string} text\n */\nfunction mangle(text) {\n  let out = '',\n    i,\n    ch;\n\n  const l = text.length;\n  for (i = 0; i < l; i++) {\n    ch = text.charCodeAt(i);\n    if (Math.random() > 0.5) {\n      ch = 'x' + ch.toString(16);\n    }\n    out += '&#' + ch + ';';\n  }\n\n  return out;\n}\n\n/**\n * Block Lexer\n */\nclass Lexer {\n  constructor(options) {\n    this.tokens = [];\n    this.tokens.links = Object.create(null);\n    this.options = options || defaults;\n    this.options.tokenizer = this.options.tokenizer || new Tokenizer();\n    this.tokenizer = this.options.tokenizer;\n    this.tokenizer.options = this.options;\n    this.tokenizer.lexer = this;\n    this.inlineQueue = [];\n    this.state = {\n      inLink: false,\n      inRawBlock: false,\n      top: true\n    };\n\n    const rules = {\n      block: block.normal,\n      inline: inline.normal\n    };\n\n    if (this.options.pedantic) {\n      rules.block = block.pedantic;\n      rules.inline = inline.pedantic;\n    } else if (this.options.gfm) {\n      rules.block = block.gfm;\n      if (this.options.breaks) {\n        rules.inline = inline.breaks;\n      } else {\n        rules.inline = inline.gfm;\n      }\n    }\n    this.tokenizer.rules = rules;\n  }\n\n  /**\n   * Expose Rules\n   */\n  static get rules() {\n    return {\n      block,\n      inline\n    };\n  }\n\n  /**\n   * Static Lex Method\n   */\n  static lex(src, options) {\n    const lexer = new Lexer(options);\n    return lexer.lex(src);\n  }\n\n  /**\n   * Static Lex Inline Method\n   */\n  static lexInline(src, options) {\n    const lexer = new Lexer(options);\n    return lexer.inlineTokens(src);\n  }\n\n  /**\n   * Preprocessing\n   */\n  lex(src) {\n    src = src\n      .replace(/\\r\\n|\\r/g, '\\n');\n\n    this.blockTokens(src, this.tokens);\n\n    let next;\n    while (next = this.inlineQueue.shift()) {\n      this.inlineTokens(next.src, next.tokens);\n    }\n\n    return this.tokens;\n  }\n\n  /**\n   * Lexing\n   */\n  blockTokens(src, tokens = []) {\n    if (this.options.pedantic) {\n      src = src.replace(/\\t/g, '    ').replace(/^ +$/gm, '');\n    } else {\n      src = src.replace(/^( *)(\\t+)/gm, (_, leading, tabs) => {\n        return leading + '    '.repeat(tabs.length);\n      });\n    }\n\n    let token, lastToken, cutSrc, lastParagraphClipped;\n\n    while (src) {\n      if (this.options.extensions\n        && this.options.extensions.block\n        && this.options.extensions.block.some((extTokenizer) => {\n          if (token = extTokenizer.call({ lexer: this }, src, tokens)) {\n            src = src.substring(token.raw.length);\n            tokens.push(token);\n            return true;\n          }\n          return false;\n        })) {\n        continue;\n      }\n\n      // newline\n      if (token = this.tokenizer.space(src)) {\n        src = src.substring(token.raw.length);\n        if (token.raw.length === 1 && tokens.length > 0) {\n          // if there's a single \\n as a spacer, it's terminating the last line,\n          // so move it there so that we don't get unecessary paragraph tags\n          tokens[tokens.length - 1].raw += '\\n';\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      // code\n      if (token = this.tokenizer.code(src)) {\n        src = src.substring(token.raw.length);\n        lastToken = tokens[tokens.length - 1];\n        // An indented code block cannot interrupt a paragraph.\n        if (lastToken && (lastToken.type === 'paragraph' || lastToken.type === 'text')) {\n          lastToken.raw += '\\n' + token.raw;\n          lastToken.text += '\\n' + token.text;\n          this.inlineQueue[this.inlineQueue.length - 1].src = lastToken.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      // fences\n      if (token = this.tokenizer.fences(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // heading\n      if (token = this.tokenizer.heading(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // hr\n      if (token = this.tokenizer.hr(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // blockquote\n      if (token = this.tokenizer.blockquote(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // list\n      if (token = this.tokenizer.list(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // html\n      if (token = this.tokenizer.html(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // def\n      if (token = this.tokenizer.def(src)) {\n        src = src.substring(token.raw.length);\n        lastToken = tokens[tokens.length - 1];\n        if (lastToken && (lastToken.type === 'paragraph' || lastToken.type === 'text')) {\n          lastToken.raw += '\\n' + token.raw;\n          lastToken.text += '\\n' + token.raw;\n          this.inlineQueue[this.inlineQueue.length - 1].src = lastToken.text;\n        } else if (!this.tokens.links[token.tag]) {\n          this.tokens.links[token.tag] = {\n            href: token.href,\n            title: token.title\n          };\n        }\n        continue;\n      }\n\n      // table (gfm)\n      if (token = this.tokenizer.table(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // lheading\n      if (token = this.tokenizer.lheading(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // top-level paragraph\n      // prevent paragraph consuming extensions by clipping 'src' to extension start\n      cutSrc = src;\n      if (this.options.extensions && this.options.extensions.startBlock) {\n        let startIndex = Infinity;\n        const tempSrc = src.slice(1);\n        let tempStart;\n        this.options.extensions.startBlock.forEach(function(getStartIndex) {\n          tempStart = getStartIndex.call({ lexer: this }, tempSrc);\n          if (typeof tempStart === 'number' && tempStart >= 0) { startIndex = Math.min(startIndex, tempStart); }\n        });\n        if (startIndex < Infinity && startIndex >= 0) {\n          cutSrc = src.substring(0, startIndex + 1);\n        }\n      }\n      if (this.state.top && (token = this.tokenizer.paragraph(cutSrc))) {\n        lastToken = tokens[tokens.length - 1];\n        if (lastParagraphClipped && lastToken.type === 'paragraph') {\n          lastToken.raw += '\\n' + token.raw;\n          lastToken.text += '\\n' + token.text;\n          this.inlineQueue.pop();\n          this.inlineQueue[this.inlineQueue.length - 1].src = lastToken.text;\n        } else {\n          tokens.push(token);\n        }\n        lastParagraphClipped = (cutSrc.length !== src.length);\n        src = src.substring(token.raw.length);\n        continue;\n      }\n\n      // text\n      if (token = this.tokenizer.text(src)) {\n        src = src.substring(token.raw.length);\n        lastToken = tokens[tokens.length - 1];\n        if (lastToken && lastToken.type === 'text') {\n          lastToken.raw += '\\n' + token.raw;\n          lastToken.text += '\\n' + token.text;\n          this.inlineQueue.pop();\n          this.inlineQueue[this.inlineQueue.length - 1].src = lastToken.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      if (src) {\n        const errMsg = 'Infinite loop on byte: ' + src.charCodeAt(0);\n        if (this.options.silent) {\n          console.error(errMsg);\n          break;\n        } else {\n          throw new Error(errMsg);\n        }\n      }\n    }\n\n    this.state.top = true;\n    return tokens;\n  }\n\n  inline(src, tokens = []) {\n    this.inlineQueue.push({ src, tokens });\n    return tokens;\n  }\n\n  /**\n   * Lexing/Compiling\n   */\n  inlineTokens(src, tokens = []) {\n    let token, lastToken, cutSrc;\n\n    // String with links masked to avoid interference with em and strong\n    let maskedSrc = src;\n    let match;\n    let keepPrevChar, prevChar;\n\n    // Mask out reflinks\n    if (this.tokens.links) {\n      const links = Object.keys(this.tokens.links);\n      if (links.length > 0) {\n        while ((match = this.tokenizer.rules.inline.reflinkSearch.exec(maskedSrc)) != null) {\n          if (links.includes(match[0].slice(match[0].lastIndexOf('[') + 1, -1))) {\n            maskedSrc = maskedSrc.slice(0, match.index) + '[' + repeatString('a', match[0].length - 2) + ']' + maskedSrc.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex);\n          }\n        }\n      }\n    }\n    // Mask out other blocks\n    while ((match = this.tokenizer.rules.inline.blockSkip.exec(maskedSrc)) != null) {\n      maskedSrc = maskedSrc.slice(0, match.index) + '[' + repeatString('a', match[0].length - 2) + ']' + maskedSrc.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);\n    }\n\n    // Mask out escaped em & strong delimiters\n    while ((match = this.tokenizer.rules.inline.escapedEmSt.exec(maskedSrc)) != null) {\n      maskedSrc = maskedSrc.slice(0, match.index + match[0].length - 2) + '++' + maskedSrc.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex);\n      this.tokenizer.rules.inline.escapedEmSt.lastIndex--;\n    }\n\n    while (src) {\n      if (!keepPrevChar) {\n        prevChar = '';\n      }\n      keepPrevChar = false;\n\n      // extensions\n      if (this.options.extensions\n        && this.options.extensions.inline\n        && this.options.extensions.inline.some((extTokenizer) => {\n          if (token = extTokenizer.call({ lexer: this }, src, tokens)) {\n            src = src.substring(token.raw.length);\n            tokens.push(token);\n            return true;\n          }\n          return false;\n        })) {\n        continue;\n      }\n\n      // escape\n      if (token = this.tokenizer.escape(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // tag\n      if (token = this.tokenizer.tag(src)) {\n        src = src.substring(token.raw.length);\n        lastToken = tokens[tokens.length - 1];\n        if (lastToken && token.type === 'text' && lastToken.type === 'text') {\n          lastToken.raw += token.raw;\n          lastToken.text += token.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      // link\n      if (token = this.tokenizer.link(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // reflink, nolink\n      if (token = this.tokenizer.reflink(src, this.tokens.links)) {\n        src = src.substring(token.raw.length);\n        lastToken = tokens[tokens.length - 1];\n        if (lastToken && token.type === 'text' && lastToken.type === 'text') {\n          lastToken.raw += token.raw;\n          lastToken.text += token.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      // em & strong\n      if (token = this.tokenizer.emStrong(src, maskedSrc, prevChar)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // code\n      if (token = this.tokenizer.codespan(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // br\n      if (token = this.tokenizer.br(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // del (gfm)\n      if (token = this.tokenizer.del(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // autolink\n      if (token = this.tokenizer.autolink(src, mangle)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // url (gfm)\n      if (!this.state.inLink && (token = this.tokenizer.url(src, mangle))) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // text\n      // prevent inlineText consuming extensions by clipping 'src' to extension start\n      cutSrc = src;\n      if (this.options.extensions && this.options.extensions.startInline) {\n        let startIndex = Infinity;\n        const tempSrc = src.slice(1);\n        let tempStart;\n        this.options.extensions.startInline.forEach(function(getStartIndex) {\n          tempStart = getStartIndex.call({ lexer: this }, tempSrc);\n          if (typeof tempStart === 'number' && tempStart >= 0) { startIndex = Math.min(startIndex, tempStart); }\n        });\n        if (startIndex < Infinity && startIndex >= 0) {\n          cutSrc = src.substring(0, startIndex + 1);\n        }\n      }\n      if (token = this.tokenizer.inlineText(cutSrc, smartypants)) {\n        src = src.substring(token.raw.length);\n        if (token.raw.slice(-1) !== '_') { // Track prevChar before string of ____ started\n          prevChar = token.raw.slice(-1);\n        }\n        keepPrevChar = true;\n        lastToken = tokens[tokens.length - 1];\n        if (lastToken && lastToken.type === 'text') {\n          lastToken.raw += token.raw;\n          lastToken.text += token.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      if (src) {\n        const errMsg = 'Infinite loop on byte: ' + src.charCodeAt(0);\n        if (this.options.silent) {\n          console.error(errMsg);\n          break;\n        } else {\n          throw new Error(errMsg);\n        }\n      }\n    }\n\n    return tokens;\n  }\n}\n\n/**\n * Renderer\n */\nclass Renderer {\n  constructor(options) {\n    this.options = options || defaults;\n  }\n\n  code(code, infostring, escaped) {\n    const lang = (infostring || '').match(/\\S*/)[0];\n    if (this.options.highlight) {\n      const out = this.options.highlight(code, lang);\n      if (out != null && out !== code) {\n        escaped = true;\n        code = out;\n      }\n    }\n\n    code = code.replace(/\\n$/, '') + '\\n';\n\n    if (!lang) {\n      return '<pre><code>'\n        + (escaped ? code : escape(code, true))\n        + '</code></pre>\\n';\n    }\n\n    return '<pre><code class=\"'\n      + this.options.langPrefix\n      + escape(lang)\n      + '\">'\n      + (escaped ? code : escape(code, true))\n      + '</code></pre>\\n';\n  }\n\n  /**\n   * @param {string} quote\n   */\n  blockquote(quote) {\n    return `<blockquote>\\n${quote}</blockquote>\\n`;\n  }\n\n  html(html) {\n    return html;\n  }\n\n  /**\n   * @param {string} text\n   * @param {string} level\n   * @param {string} raw\n   * @param {any} slugger\n   */\n  heading(text, level, raw, slugger) {\n    if (this.options.headerIds) {\n      const id = this.options.headerPrefix + slugger.slug(raw);\n      return `<h${level} id=\"${id}\">${text}</h${level}>\\n`;\n    }\n\n    // ignore IDs\n    return `<h${level}>${text}</h${level}>\\n`;\n  }\n\n  hr() {\n    return this.options.xhtml ? '<hr/>\\n' : '<hr>\\n';\n  }\n\n  list(body, ordered, start) {\n    const type = ordered ? 'ol' : 'ul',\n      startatt = (ordered && start !== 1) ? (' start=\"' + start + '\"') : '';\n    return '<' + type + startatt + '>\\n' + body + '</' + type + '>\\n';\n  }\n\n  /**\n   * @param {string} text\n   */\n  listitem(text) {\n    return `<li>${text}</li>\\n`;\n  }\n\n  checkbox(checked) {\n    return '<input '\n      + (checked ? 'checked=\"\" ' : '')\n      + 'disabled=\"\" type=\"checkbox\"'\n      + (this.options.xhtml ? ' /' : '')\n      + '> ';\n  }\n\n  /**\n   * @param {string} text\n   */\n  paragraph(text) {\n    return `<p>${text}</p>\\n`;\n  }\n\n  /**\n   * @param {string} header\n   * @param {string} body\n   */\n  table(header, body) {\n    if (body) body = `<tbody>${body}</tbody>`;\n\n    return '<table>\\n'\n      + '<thead>\\n'\n      + header\n      + '</thead>\\n'\n      + body\n      + '</table>\\n';\n  }\n\n  /**\n   * @param {string} content\n   */\n  tablerow(content) {\n    return `<tr>\\n${content}</tr>\\n`;\n  }\n\n  tablecell(content, flags) {\n    const type = flags.header ? 'th' : 'td';\n    const tag = flags.align\n      ? `<${type} align=\"${flags.align}\">`\n      : `<${type}>`;\n    return tag + content + `</${type}>\\n`;\n  }\n\n  /**\n   * span level renderer\n   * @param {string} text\n   */\n  strong(text) {\n    return `<strong>${text}</strong>`;\n  }\n\n  /**\n   * @param {string} text\n   */\n  em(text) {\n    return `<em>${text}</em>`;\n  }\n\n  /**\n   * @param {string} text\n   */\n  codespan(text) {\n    return `<code>${text}</code>`;\n  }\n\n  br() {\n    return this.options.xhtml ? '<br/>' : '<br>';\n  }\n\n  /**\n   * @param {string} text\n   */\n  del(text) {\n    return `<del>${text}</del>`;\n  }\n\n  /**\n   * @param {string} href\n   * @param {string} title\n   * @param {string} text\n   */\n  link(href, title, text) {\n    href = cleanUrl(this.options.sanitize, this.options.baseUrl, href);\n    if (href === null) {\n      return text;\n    }\n    let out = '<a href=\"' + href + '\"';\n    if (title) {\n      out += ' title=\"' + title + '\"';\n    }\n    out += '>' + text + '</a>';\n    return out;\n  }\n\n  /**\n   * @param {string} href\n   * @param {string} title\n   * @param {string} text\n   */\n  image(href, title, text) {\n    href = cleanUrl(this.options.sanitize, this.options.baseUrl, href);\n    if (href === null) {\n      return text;\n    }\n\n    let out = `<img src=\"${href}\" alt=\"${text}\"`;\n    if (title) {\n      out += ` title=\"${title}\"`;\n    }\n    out += this.options.xhtml ? '/>' : '>';\n    return out;\n  }\n\n  text(text) {\n    return text;\n  }\n}\n\n/**\n * TextRenderer\n * returns only the textual part of the token\n */\nclass TextRenderer {\n  // no need for block level renderers\n  strong(text) {\n    return text;\n  }\n\n  em(text) {\n    return text;\n  }\n\n  codespan(text) {\n    return text;\n  }\n\n  del(text) {\n    return text;\n  }\n\n  html(text) {\n    return text;\n  }\n\n  text(text) {\n    return text;\n  }\n\n  link(href, title, text) {\n    return '' + text;\n  }\n\n  image(href, title, text) {\n    return '' + text;\n  }\n\n  br() {\n    return '';\n  }\n}\n\n/**\n * Slugger generates header id\n */\nclass Slugger {\n  constructor() {\n    this.seen = {};\n  }\n\n  /**\n   * @param {string} value\n   */\n  serialize(value) {\n    return value\n      .toLowerCase()\n      .trim()\n      // remove html tags\n      .replace(/<[!\\/a-z].*?>/ig, '')\n      // remove unwanted chars\n      .replace(/[\\u2000-\\u206F\\u2E00-\\u2E7F\\\\'!\"#$%&()*+,./:;<=>?@[\\]^`{|}~]/g, '')\n      .replace(/\\s/g, '-');\n  }\n\n  /**\n   * Finds the next safe (unique) slug to use\n   * @param {string} originalSlug\n   * @param {boolean} isDryRun\n   */\n  getNextSafeSlug(originalSlug, isDryRun) {\n    let slug = originalSlug;\n    let occurenceAccumulator = 0;\n    if (this.seen.hasOwnProperty(slug)) {\n      occurenceAccumulator = this.seen[originalSlug];\n      do {\n        occurenceAccumulator++;\n        slug = originalSlug + '-' + occurenceAccumulator;\n      } while (this.seen.hasOwnProperty(slug));\n    }\n    if (!isDryRun) {\n      this.seen[originalSlug] = occurenceAccumulator;\n      this.seen[slug] = 0;\n    }\n    return slug;\n  }\n\n  /**\n   * Convert string to unique id\n   * @param {object} [options]\n   * @param {boolean} [options.dryrun] Generates the next unique slug without\n   * updating the internal accumulator.\n   */\n  slug(value, options = {}) {\n    const slug = this.serialize(value);\n    return this.getNextSafeSlug(slug, options.dryrun);\n  }\n}\n\n/**\n * Parsing & Compiling\n */\nclass Parser {\n  constructor(options) {\n    this.options = options || defaults;\n    this.options.renderer = this.options.renderer || new Renderer();\n    this.renderer = this.options.renderer;\n    this.renderer.options = this.options;\n    this.textRenderer = new TextRenderer();\n    this.slugger = new Slugger();\n  }\n\n  /**\n   * Static Parse Method\n   */\n  static parse(tokens, options) {\n    const parser = new Parser(options);\n    return parser.parse(tokens);\n  }\n\n  /**\n   * Static Parse Inline Method\n   */\n  static parseInline(tokens, options) {\n    const parser = new Parser(options);\n    return parser.parseInline(tokens);\n  }\n\n  /**\n   * Parse Loop\n   */\n  parse(tokens, top = true) {\n    let out = '',\n      i,\n      j,\n      k,\n      l2,\n      l3,\n      row,\n      cell,\n      header,\n      body,\n      token,\n      ordered,\n      start,\n      loose,\n      itemBody,\n      item,\n      checked,\n      task,\n      checkbox,\n      ret;\n\n    const l = tokens.length;\n    for (i = 0; i < l; i++) {\n      token = tokens[i];\n\n      // Run any renderer extensions\n      if (this.options.extensions && this.options.extensions.renderers && this.options.extensions.renderers[token.type]) {\n        ret = this.options.extensions.renderers[token.type].call({ parser: this }, token);\n        if (ret !== false || !['space', 'hr', 'heading', 'code', 'table', 'blockquote', 'list', 'html', 'paragraph', 'text'].includes(token.type)) {\n          out += ret || '';\n          continue;\n        }\n      }\n\n      switch (token.type) {\n        case 'space': {\n          continue;\n        }\n        case 'hr': {\n          out += this.renderer.hr();\n          continue;\n        }\n        case 'heading': {\n          out += this.renderer.heading(\n            this.parseInline(token.tokens),\n            token.depth,\n            unescape(this.parseInline(token.tokens, this.textRenderer)),\n            this.slugger);\n          continue;\n        }\n        case 'code': {\n          out += this.renderer.code(token.text,\n            token.lang,\n            token.escaped);\n          continue;\n        }\n        case 'table': {\n          header = '';\n\n          // header\n          cell = '';\n          l2 = token.header.length;\n          for (j = 0; j < l2; j++) {\n            cell += this.renderer.tablecell(\n              this.parseInline(token.header[j].tokens),\n              { header: true, align: token.align[j] }\n            );\n          }\n          header += this.renderer.tablerow(cell);\n\n          body = '';\n          l2 = token.rows.length;\n          for (j = 0; j < l2; j++) {\n            row = token.rows[j];\n\n            cell = '';\n            l3 = row.length;\n            for (k = 0; k < l3; k++) {\n              cell += this.renderer.tablecell(\n                this.parseInline(row[k].tokens),\n                { header: false, align: token.align[k] }\n              );\n            }\n\n            body += this.renderer.tablerow(cell);\n          }\n          out += this.renderer.table(header, body);\n          continue;\n        }\n        case 'blockquote': {\n          body = this.parse(token.tokens);\n          out += this.renderer.blockquote(body);\n          continue;\n        }\n        case 'list': {\n          ordered = token.ordered;\n          start = token.start;\n          loose = token.loose;\n          l2 = token.items.length;\n\n          body = '';\n          for (j = 0; j < l2; j++) {\n            item = token.items[j];\n            checked = item.checked;\n            task = item.task;\n\n            itemBody = '';\n            if (item.task) {\n              checkbox = this.renderer.checkbox(checked);\n              if (loose) {\n                if (item.tokens.length > 0 && item.tokens[0].type === 'paragraph') {\n                  item.tokens[0].text = checkbox + ' ' + item.tokens[0].text;\n                  if (item.tokens[0].tokens && item.tokens[0].tokens.length > 0 && item.tokens[0].tokens[0].type === 'text') {\n                    item.tokens[0].tokens[0].text = checkbox + ' ' + item.tokens[0].tokens[0].text;\n                  }\n                } else {\n                  item.tokens.unshift({\n                    type: 'text',\n                    text: checkbox\n                  });\n                }\n              } else {\n                itemBody += checkbox;\n              }\n            }\n\n            itemBody += this.parse(item.tokens, loose);\n            body += this.renderer.listitem(itemBody, task, checked);\n          }\n\n          out += this.renderer.list(body, ordered, start);\n          continue;\n        }\n        case 'html': {\n          // TODO parse inline content if parameter markdown=1\n          out += this.renderer.html(token.text);\n          continue;\n        }\n        case 'paragraph': {\n          out += this.renderer.paragraph(this.parseInline(token.tokens));\n          continue;\n        }\n        case 'text': {\n          body = token.tokens ? this.parseInline(token.tokens) : token.text;\n          while (i + 1 < l && tokens[i + 1].type === 'text') {\n            token = tokens[++i];\n            body += '\\n' + (token.tokens ? this.parseInline(token.tokens) : token.text);\n          }\n          out += top ? this.renderer.paragraph(body) : body;\n          continue;\n        }\n\n        default: {\n          const errMsg = 'Token with \"' + token.type + '\" type was not found.';\n          if (this.options.silent) {\n            console.error(errMsg);\n            return;\n          } else {\n            throw new Error(errMsg);\n          }\n        }\n      }\n    }\n\n    return out;\n  }\n\n  /**\n   * Parse Inline Tokens\n   */\n  parseInline(tokens, renderer) {\n    renderer = renderer || this.renderer;\n    let out = '',\n      i,\n      token,\n      ret;\n\n    const l = tokens.length;\n    for (i = 0; i < l; i++) {\n      token = tokens[i];\n\n      // Run any renderer extensions\n      if (this.options.extensions && this.options.extensions.renderers && this.options.extensions.renderers[token.type]) {\n        ret = this.options.extensions.renderers[token.type].call({ parser: this }, token);\n        if (ret !== false || !['escape', 'html', 'link', 'image', 'strong', 'em', 'codespan', 'br', 'del', 'text'].includes(token.type)) {\n          out += ret || '';\n          continue;\n        }\n      }\n\n      switch (token.type) {\n        case 'escape': {\n          out += renderer.text(token.text);\n          break;\n        }\n        case 'html': {\n          out += renderer.html(token.text);\n          break;\n        }\n        case 'link': {\n          out += renderer.link(token.href, token.title, this.parseInline(token.tokens, renderer));\n          break;\n        }\n        case 'image': {\n          out += renderer.image(token.href, token.title, token.text);\n          break;\n        }\n        case 'strong': {\n          out += renderer.strong(this.parseInline(token.tokens, renderer));\n          break;\n        }\n        case 'em': {\n          out += renderer.em(this.parseInline(token.tokens, renderer));\n          break;\n        }\n        case 'codespan': {\n          out += renderer.codespan(token.text);\n          break;\n        }\n        case 'br': {\n          out += renderer.br();\n          break;\n        }\n        case 'del': {\n          out += renderer.del(this.parseInline(token.tokens, renderer));\n          break;\n        }\n        case 'text': {\n          out += renderer.text(token.text);\n          break;\n        }\n        default: {\n          const errMsg = 'Token with \"' + token.type + '\" type was not found.';\n          if (this.options.silent) {\n            console.error(errMsg);\n            return;\n          } else {\n            throw new Error(errMsg);\n          }\n        }\n      }\n    }\n    return out;\n  }\n}\n\nclass Hooks {\n  constructor(options) {\n    this.options = options || defaults;\n  }\n\n  static passThroughHooks = new Set([\n    'preprocess',\n    'postprocess'\n  ]);\n\n  /**\n   * Process markdown before marked\n   */\n  preprocess(markdown) {\n    return markdown;\n  }\n\n  /**\n   * Process HTML after marked is finished\n   */\n  postprocess(html) {\n    return html;\n  }\n}\n\nfunction onError(silent, async, callback) {\n  return (e) => {\n    e.message += '\\nPlease report this to https://github.com/markedjs/marked.';\n\n    if (silent) {\n      const msg = '<p>An error occurred:</p><pre>'\n        + escape(e.message + '', true)\n        + '</pre>';\n      if (async) {\n        return Promise.resolve(msg);\n      }\n      if (callback) {\n        callback(null, msg);\n        return;\n      }\n      return msg;\n    }\n\n    if (async) {\n      return Promise.reject(e);\n    }\n    if (callback) {\n      callback(e);\n      return;\n    }\n    throw e;\n  };\n}\n\nfunction parseMarkdown(lexer, parser) {\n  return (src, opt, callback) => {\n    if (typeof opt === 'function') {\n      callback = opt;\n      opt = null;\n    }\n\n    const origOpt = { ...opt };\n    opt = { ...marked.defaults, ...origOpt };\n    const throwError = onError(opt.silent, opt.async, callback);\n\n    // throw error in case of non string input\n    if (typeof src === 'undefined' || src === null) {\n      return throwError(new Error('marked(): input parameter is undefined or null'));\n    }\n    if (typeof src !== 'string') {\n      return throwError(new Error('marked(): input parameter is of type '\n        + Object.prototype.toString.call(src) + ', string expected'));\n    }\n\n    checkSanitizeDeprecation(opt);\n\n    if (opt.hooks) {\n      opt.hooks.options = opt;\n    }\n\n    if (callback) {\n      const highlight = opt.highlight;\n      let tokens;\n\n      try {\n        if (opt.hooks) {\n          src = opt.hooks.preprocess(src);\n        }\n        tokens = lexer(src, opt);\n      } catch (e) {\n        return throwError(e);\n      }\n\n      const done = function(err) {\n        let out;\n\n        if (!err) {\n          try {\n            if (opt.walkTokens) {\n              marked.walkTokens(tokens, opt.walkTokens);\n            }\n            out = parser(tokens, opt);\n            if (opt.hooks) {\n              out = opt.hooks.postprocess(out);\n            }\n          } catch (e) {\n            err = e;\n          }\n        }\n\n        opt.highlight = highlight;\n\n        return err\n          ? throwError(err)\n          : callback(null, out);\n      };\n\n      if (!highlight || highlight.length < 3) {\n        return done();\n      }\n\n      delete opt.highlight;\n\n      if (!tokens.length) return done();\n\n      let pending = 0;\n      marked.walkTokens(tokens, function(token) {\n        if (token.type === 'code') {\n          pending++;\n          setTimeout(() => {\n            highlight(token.text, token.lang, function(err, code) {\n              if (err) {\n                return done(err);\n              }\n              if (code != null && code !== token.text) {\n                token.text = code;\n                token.escaped = true;\n              }\n\n              pending--;\n              if (pending === 0) {\n                done();\n              }\n            });\n          }, 0);\n        }\n      });\n\n      if (pending === 0) {\n        done();\n      }\n\n      return;\n    }\n\n    if (opt.async) {\n      return Promise.resolve(opt.hooks ? opt.hooks.preprocess(src) : src)\n        .then(src => lexer(src, opt))\n        .then(tokens => opt.walkTokens ? Promise.all(marked.walkTokens(tokens, opt.walkTokens)).then(() => tokens) : tokens)\n        .then(tokens => parser(tokens, opt))\n        .then(html => opt.hooks ? opt.hooks.postprocess(html) : html)\n        .catch(throwError);\n    }\n\n    try {\n      if (opt.hooks) {\n        src = opt.hooks.preprocess(src);\n      }\n      const tokens = lexer(src, opt);\n      if (opt.walkTokens) {\n        marked.walkTokens(tokens, opt.walkTokens);\n      }\n      let html = parser(tokens, opt);\n      if (opt.hooks) {\n        html = opt.hooks.postprocess(html);\n      }\n      return html;\n    } catch (e) {\n      return throwError(e);\n    }\n  };\n}\n\n/**\n * Marked\n */\nfunction marked(src, opt, callback) {\n  return parseMarkdown(Lexer.lex, Parser.parse)(src, opt, callback);\n}\n\n/**\n * Options\n */\n\nmarked.options =\nmarked.setOptions = function(opt) {\n  marked.defaults = { ...marked.defaults, ...opt };\n  changeDefaults(marked.defaults);\n  return marked;\n};\n\nmarked.getDefaults = getDefaults;\n\nmarked.defaults = defaults;\n\n/**\n * Use Extension\n */\n\nmarked.use = function(...args) {\n  const extensions = marked.defaults.extensions || { renderers: {}, childTokens: {} };\n\n  args.forEach((pack) => {\n    // copy options to new object\n    const opts = { ...pack };\n\n    // set async to true if it was set to true before\n    opts.async = marked.defaults.async || opts.async || false;\n\n    // ==-- Parse \"addon\" extensions --== //\n    if (pack.extensions) {\n      pack.extensions.forEach((ext) => {\n        if (!ext.name) {\n          throw new Error('extension name required');\n        }\n        if (ext.renderer) { // Renderer extensions\n          const prevRenderer = extensions.renderers[ext.name];\n          if (prevRenderer) {\n            // Replace extension with func to run new extension but fall back if false\n            extensions.renderers[ext.name] = function(...args) {\n              let ret = ext.renderer.apply(this, args);\n              if (ret === false) {\n                ret = prevRenderer.apply(this, args);\n              }\n              return ret;\n            };\n          } else {\n            extensions.renderers[ext.name] = ext.renderer;\n          }\n        }\n        if (ext.tokenizer) { // Tokenizer Extensions\n          if (!ext.level || (ext.level !== 'block' && ext.level !== 'inline')) {\n            throw new Error(\"extension level must be 'block' or 'inline'\");\n          }\n          if (extensions[ext.level]) {\n            extensions[ext.level].unshift(ext.tokenizer);\n          } else {\n            extensions[ext.level] = [ext.tokenizer];\n          }\n          if (ext.start) { // Function to check for start of token\n            if (ext.level === 'block') {\n              if (extensions.startBlock) {\n                extensions.startBlock.push(ext.start);\n              } else {\n                extensions.startBlock = [ext.start];\n              }\n            } else if (ext.level === 'inline') {\n              if (extensions.startInline) {\n                extensions.startInline.push(ext.start);\n              } else {\n                extensions.startInline = [ext.start];\n              }\n            }\n          }\n        }\n        if (ext.childTokens) { // Child tokens to be visited by walkTokens\n          extensions.childTokens[ext.name] = ext.childTokens;\n        }\n      });\n      opts.extensions = extensions;\n    }\n\n    // ==-- Parse \"overwrite\" extensions --== //\n    if (pack.renderer) {\n      const renderer = marked.defaults.renderer || new Renderer();\n      for (const prop in pack.renderer) {\n        const prevRenderer = renderer[prop];\n        // Replace renderer with func to run extension, but fall back if false\n        renderer[prop] = (...args) => {\n          let ret = pack.renderer[prop].apply(renderer, args);\n          if (ret === false) {\n            ret = prevRenderer.apply(renderer, args);\n          }\n          return ret;\n        };\n      }\n      opts.renderer = renderer;\n    }\n    if (pack.tokenizer) {\n      const tokenizer = marked.defaults.tokenizer || new Tokenizer();\n      for (const prop in pack.tokenizer) {\n        const prevTokenizer = tokenizer[prop];\n        // Replace tokenizer with func to run extension, but fall back if false\n        tokenizer[prop] = (...args) => {\n          let ret = pack.tokenizer[prop].apply(tokenizer, args);\n          if (ret === false) {\n            ret = prevTokenizer.apply(tokenizer, args);\n          }\n          return ret;\n        };\n      }\n      opts.tokenizer = tokenizer;\n    }\n\n    // ==-- Parse Hooks extensions --== //\n    if (pack.hooks) {\n      const hooks = marked.defaults.hooks || new Hooks();\n      for (const prop in pack.hooks) {\n        const prevHook = hooks[prop];\n        if (Hooks.passThroughHooks.has(prop)) {\n          hooks[prop] = (arg) => {\n            if (marked.defaults.async) {\n              return Promise.resolve(pack.hooks[prop].call(hooks, arg)).then(ret => {\n                return prevHook.call(hooks, ret);\n              });\n            }\n\n            const ret = pack.hooks[prop].call(hooks, arg);\n            return prevHook.call(hooks, ret);\n          };\n        } else {\n          hooks[prop] = (...args) => {\n            let ret = pack.hooks[prop].apply(hooks, args);\n            if (ret === false) {\n              ret = prevHook.apply(hooks, args);\n            }\n            return ret;\n          };\n        }\n      }\n      opts.hooks = hooks;\n    }\n\n    // ==-- Parse WalkTokens extensions --== //\n    if (pack.walkTokens) {\n      const walkTokens = marked.defaults.walkTokens;\n      opts.walkTokens = function(token) {\n        let values = [];\n        values.push(pack.walkTokens.call(this, token));\n        if (walkTokens) {\n          values = values.concat(walkTokens.call(this, token));\n        }\n        return values;\n      };\n    }\n\n    marked.setOptions(opts);\n  });\n};\n\n/**\n * Run callback for every token\n */\n\nmarked.walkTokens = function(tokens, callback) {\n  let values = [];\n  for (const token of tokens) {\n    values = values.concat(callback.call(marked, token));\n    switch (token.type) {\n      case 'table': {\n        for (const cell of token.header) {\n          values = values.concat(marked.walkTokens(cell.tokens, callback));\n        }\n        for (const row of token.rows) {\n          for (const cell of row) {\n            values = values.concat(marked.walkTokens(cell.tokens, callback));\n          }\n        }\n        break;\n      }\n      case 'list': {\n        values = values.concat(marked.walkTokens(token.items, callback));\n        break;\n      }\n      default: {\n        if (marked.defaults.extensions && marked.defaults.extensions.childTokens && marked.defaults.extensions.childTokens[token.type]) { // Walk any extensions\n          marked.defaults.extensions.childTokens[token.type].forEach(function(childTokens) {\n            values = values.concat(marked.walkTokens(token[childTokens], callback));\n          });\n        } else if (token.tokens) {\n          values = values.concat(marked.walkTokens(token.tokens, callback));\n        }\n      }\n    }\n  }\n  return values;\n};\n\n/**\n * Parse Inline\n * @param {string} src\n */\nmarked.parseInline = parseMarkdown(Lexer.lexInline, Parser.parseInline);\n\n/**\n * Expose\n */\nmarked.Parser = Parser;\nmarked.parser = Parser.parse;\nmarked.Renderer = Renderer;\nmarked.TextRenderer = TextRenderer;\nmarked.Lexer = Lexer;\nmarked.lexer = Lexer.lex;\nmarked.Tokenizer = Tokenizer;\nmarked.Slugger = Slugger;\nmarked.Hooks = Hooks;\nmarked.parse = marked;\n\nconst options = marked.options;\nconst setOptions = marked.setOptions;\nconst use = marked.use;\nconst walkTokens = marked.walkTokens;\nconst parseInline = marked.parseInline;\nconst parse = marked;\nconst parser = Parser.parse;\nconst lexer = Lexer.lex;\n\nexport { Hooks, Lexer, Parser, Renderer, Slugger, TextRenderer, Tokenizer, defaults, getDefaults, lexer, marked, options, parse, parseInline, parser, setOptions, use, walkTokens };\n", "export class ClipboardItem {\n  constructor(public readonly mimeType: string, public readonly data: string) {}\n\n  hasData() {\n    return this.data !== null && this.data !== undefined;\n  }\n}\n", "/**\n * Try keeping this file pure, don't rely on other package or module.\n */\nimport { ClipboardItem } from '../clipboard-item.js';\n\nexport enum CLIPBOARD_MIMETYPE {\n  HTML = 'text/html',\n  TEXT = 'text/plain',\n  BLOCKSUITE_PAGE = 'blocksuite/page',\n  BLOCKSUITE_SURFACE = 'blocksuite/surface',\n  // IMAGE_BMP = 'image/bmp',\n  // IMAGE_GIF = 'image/gif',\n  // IMAGE_JPEG = 'image/jpeg',\n  // IMAGE_JPG = 'image/jpg',\n  // IMAGE_PNG = 'image/png',\n  // IMAGE_SVG = 'image/svg',\n  // IMAGE_WEBP = 'image/webp',\n}\n\nexport function extractCustomDataFromHTMLString(\n  type: CLIPBOARD_MIMETYPE,\n  html: string\n) {\n  const dom = new DOMParser().parseFromString(html, 'text/html');\n  const ele = dom.querySelector(`blocksuite[data-type=\"${type}\"]`);\n  return ele?.getAttribute('data-clipboard');\n}\n\nexport function getSurfaceClipboardData(e: ClipboardEvent) {\n  const clipboardData = e.clipboardData;\n  if (!clipboardData) {\n    return;\n  }\n\n  // TODO:\n  // Because the edgeless mode does not support inserting images separately,\n  // the files in the clipboard have not been processed here.\n  // if (isPureFileInClipboard(clipboardData) {}\n\n  const data = clipboardData.getData(CLIPBOARD_MIMETYPE.BLOCKSUITE_SURFACE);\n  if (data) {\n    return JSON.parse(data);\n  }\n\n  const HTMLClipboardData = clipboardData.getData(CLIPBOARD_MIMETYPE.HTML);\n  const parsedHtmlData = extractCustomDataFromHTMLString(\n    CLIPBOARD_MIMETYPE.BLOCKSUITE_SURFACE,\n    HTMLClipboardData\n  );\n  if (parsedHtmlData) {\n    return JSON.parse(parsedHtmlData);\n  }\n}\n\nexport function isPureFileInClipboard(clipboardData: DataTransfer) {\n  const types = clipboardData.types;\n  return (\n    (types.length === 1 && types[0] === 'Files') ||\n    (types.length === 2 &&\n      (types.includes('text/plain') || types.includes('text/html')) &&\n      types.includes('Files'))\n  );\n}\n\n// TODO: support more file types, now is just image\nexport function getFileFromClipboard(clipboardData: DataTransfer) {\n  const files = clipboardData.files;\n  if (files && files[0] && files[0].type.indexOf('image') > -1) {\n    return files[0];\n  }\n  return;\n}\n\nexport function performNativeCopy(items: ClipboardItem[]): boolean {\n  let success = false;\n  const tempElem = document.createElement('textarea');\n  tempElem.value = 'temp';\n  document.body.appendChild(tempElem);\n  tempElem.select();\n  tempElem.setSelectionRange(0, tempElem.value.length);\n  const listener = (e: ClipboardEvent) => {\n    const clipboardData = e.clipboardData;\n\n    if (clipboardData) {\n      items.forEach((item: ClipboardItem) =>\n        clipboardData.setData(item.mimeType, item.data)\n      );\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n    tempElem.removeEventListener('copy', listener);\n  };\n\n  tempElem.addEventListener('copy', listener);\n  try {\n    success = document.execCommand('copy');\n  } finally {\n    tempElem.removeEventListener('copy', listener);\n    document.body.removeChild(tempElem);\n  }\n  return success;\n}\n\nexport function createSurfaceClipboardItems(data: unknown) {\n  const stringifiedData = JSON.stringify(data);\n\n  const surfaceItem = new ClipboardItem(\n    CLIPBOARD_MIMETYPE.BLOCKSUITE_SURFACE,\n    stringifiedData\n  );\n\n  const htmlFallback = new ClipboardItem(\n    CLIPBOARD_MIMETYPE.HTML,\n    createHTMLStringForCustomData(\n      stringifiedData,\n      CLIPBOARD_MIMETYPE.BLOCKSUITE_SURFACE\n    )\n  );\n\n  return [surfaceItem, htmlFallback];\n}\n\nexport function createHTMLStringForCustomData(\n  data: string,\n  type: CLIPBOARD_MIMETYPE\n) {\n  return `<blocksuite style=\"display: none\" data-type=\"${type}\" data-clipboard=\"${data.replace(\n    /\"/g,\n    '&quot;'\n  )}\"></blocksuite>`;\n}\n", "function extend (destination) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      if (source.hasOwnProperty(key)) destination[key] = source[key];\n    }\n  }\n  return destination\n}\n\nfunction repeat (character, count) {\n  return Array(count + 1).join(character)\n}\n\nfunction trimLeadingNewlines (string) {\n  return string.replace(/^\\n*/, '')\n}\n\nfunction trimTrailingNewlines (string) {\n  // avoid match-at-end regexp bottleneck, see #370\n  var indexEnd = string.length;\n  while (indexEnd > 0 && string[indexEnd - 1] === '\\n') indexEnd--;\n  return string.substring(0, indexEnd)\n}\n\nvar blockElements = [\n  'ADDRESS', 'ARTICLE', 'ASIDE', 'AUDIO', 'BLOCKQUOTE', 'BODY', 'CANVAS',\n  'CENTER', 'DD', 'DIR', 'DIV', 'DL', 'DT', 'FIELDSET', 'FIGCAPTION', 'FIGURE',\n  'FOOTER', 'FORM', 'FRAMESET', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'HEADER',\n  'HGROUP', 'HR', 'HTML', 'ISINDEX', 'LI', 'MAIN', 'MENU', 'NAV', 'NOFRAMES',\n  'NOSCRIPT', 'OL', 'OUTPUT', 'P', 'PRE', 'SECTION', 'TABLE', 'TBODY', 'TD',\n  'TFOOT', 'TH', 'THEAD', 'TR', 'UL'\n];\n\nfunction isBlock (node) {\n  return is(node, blockElements)\n}\n\nvar voidElements = [\n  'AREA', 'BASE', 'BR', 'COL', 'COMMAND', 'EMBED', 'HR', 'IMG', 'INPUT',\n  'KEYGEN', 'LINK', 'META', 'PARAM', 'SOURCE', 'TRACK', 'WBR'\n];\n\nfunction isVoid (node) {\n  return is(node, voidElements)\n}\n\nfunction hasVoid (node) {\n  return has(node, voidElements)\n}\n\nvar meaningfulWhenBlankElements = [\n  'A', 'TABLE', 'THEAD', 'TBODY', 'TFOOT', 'TH', 'TD', 'IFRAME', 'SCRIPT',\n  'AUDIO', 'VIDEO'\n];\n\nfunction isMeaningfulWhenBlank (node) {\n  return is(node, meaningfulWhenBlankElements)\n}\n\nfunction hasMeaningfulWhenBlank (node) {\n  return has(node, meaningfulWhenBlankElements)\n}\n\nfunction is (node, tagNames) {\n  return tagNames.indexOf(node.nodeName) >= 0\n}\n\nfunction has (node, tagNames) {\n  return (\n    node.getElementsByTagName &&\n    tagNames.some(function (tagName) {\n      return node.getElementsByTagName(tagName).length\n    })\n  )\n}\n\nvar rules = {};\n\nrules.paragraph = {\n  filter: 'p',\n\n  replacement: function (content) {\n    return '\\n\\n' + content + '\\n\\n'\n  }\n};\n\nrules.lineBreak = {\n  filter: 'br',\n\n  replacement: function (content, node, options) {\n    return options.br + '\\n'\n  }\n};\n\nrules.heading = {\n  filter: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n\n  replacement: function (content, node, options) {\n    var hLevel = Number(node.nodeName.charAt(1));\n\n    if (options.headingStyle === 'setext' && hLevel < 3) {\n      var underline = repeat((hLevel === 1 ? '=' : '-'), content.length);\n      return (\n        '\\n\\n' + content + '\\n' + underline + '\\n\\n'\n      )\n    } else {\n      return '\\n\\n' + repeat('#', hLevel) + ' ' + content + '\\n\\n'\n    }\n  }\n};\n\nrules.blockquote = {\n  filter: 'blockquote',\n\n  replacement: function (content) {\n    content = content.replace(/^\\n+|\\n+$/g, '');\n    content = content.replace(/^/gm, '> ');\n    return '\\n\\n' + content + '\\n\\n'\n  }\n};\n\nrules.list = {\n  filter: ['ul', 'ol'],\n\n  replacement: function (content, node) {\n    var parent = node.parentNode;\n    if (parent.nodeName === 'LI' && parent.lastElementChild === node) {\n      return '\\n' + content\n    } else {\n      return '\\n\\n' + content + '\\n\\n'\n    }\n  }\n};\n\nrules.listItem = {\n  filter: 'li',\n\n  replacement: function (content, node, options) {\n    content = content\n      .replace(/^\\n+/, '') // remove leading newlines\n      .replace(/\\n+$/, '\\n') // replace trailing newlines with just a single one\n      .replace(/\\n/gm, '\\n    '); // indent\n    var prefix = options.bulletListMarker + '   ';\n    var parent = node.parentNode;\n    if (parent.nodeName === 'OL') {\n      var start = parent.getAttribute('start');\n      var index = Array.prototype.indexOf.call(parent.children, node);\n      prefix = (start ? Number(start) + index : index + 1) + '.  ';\n    }\n    return (\n      prefix + content + (node.nextSibling && !/\\n$/.test(content) ? '\\n' : '')\n    )\n  }\n};\n\nrules.indentedCodeBlock = {\n  filter: function (node, options) {\n    return (\n      options.codeBlockStyle === 'indented' &&\n      node.nodeName === 'PRE' &&\n      node.firstChild &&\n      node.firstChild.nodeName === 'CODE'\n    )\n  },\n\n  replacement: function (content, node, options) {\n    return (\n      '\\n\\n    ' +\n      node.firstChild.textContent.replace(/\\n/g, '\\n    ') +\n      '\\n\\n'\n    )\n  }\n};\n\nrules.fencedCodeBlock = {\n  filter: function (node, options) {\n    return (\n      options.codeBlockStyle === 'fenced' &&\n      node.nodeName === 'PRE' &&\n      node.firstChild &&\n      node.firstChild.nodeName === 'CODE'\n    )\n  },\n\n  replacement: function (content, node, options) {\n    var className = node.firstChild.getAttribute('class') || '';\n    var language = (className.match(/language-(\\S+)/) || [null, ''])[1];\n    var code = node.firstChild.textContent;\n\n    var fenceChar = options.fence.charAt(0);\n    var fenceSize = 3;\n    var fenceInCodeRegex = new RegExp('^' + fenceChar + '{3,}', 'gm');\n\n    var match;\n    while ((match = fenceInCodeRegex.exec(code))) {\n      if (match[0].length >= fenceSize) {\n        fenceSize = match[0].length + 1;\n      }\n    }\n\n    var fence = repeat(fenceChar, fenceSize);\n\n    return (\n      '\\n\\n' + fence + language + '\\n' +\n      code.replace(/\\n$/, '') +\n      '\\n' + fence + '\\n\\n'\n    )\n  }\n};\n\nrules.horizontalRule = {\n  filter: 'hr',\n\n  replacement: function (content, node, options) {\n    return '\\n\\n' + options.hr + '\\n\\n'\n  }\n};\n\nrules.inlineLink = {\n  filter: function (node, options) {\n    return (\n      options.linkStyle === 'inlined' &&\n      node.nodeName === 'A' &&\n      node.getAttribute('href')\n    )\n  },\n\n  replacement: function (content, node) {\n    var href = node.getAttribute('href');\n    var title = cleanAttribute(node.getAttribute('title'));\n    if (title) title = ' \"' + title + '\"';\n    return '[' + content + '](' + href + title + ')'\n  }\n};\n\nrules.referenceLink = {\n  filter: function (node, options) {\n    return (\n      options.linkStyle === 'referenced' &&\n      node.nodeName === 'A' &&\n      node.getAttribute('href')\n    )\n  },\n\n  replacement: function (content, node, options) {\n    var href = node.getAttribute('href');\n    var title = cleanAttribute(node.getAttribute('title'));\n    if (title) title = ' \"' + title + '\"';\n    var replacement;\n    var reference;\n\n    switch (options.linkReferenceStyle) {\n      case 'collapsed':\n        replacement = '[' + content + '][]';\n        reference = '[' + content + ']: ' + href + title;\n        break\n      case 'shortcut':\n        replacement = '[' + content + ']';\n        reference = '[' + content + ']: ' + href + title;\n        break\n      default:\n        var id = this.references.length + 1;\n        replacement = '[' + content + '][' + id + ']';\n        reference = '[' + id + ']: ' + href + title;\n    }\n\n    this.references.push(reference);\n    return replacement\n  },\n\n  references: [],\n\n  append: function (options) {\n    var references = '';\n    if (this.references.length) {\n      references = '\\n\\n' + this.references.join('\\n') + '\\n\\n';\n      this.references = []; // Reset references\n    }\n    return references\n  }\n};\n\nrules.emphasis = {\n  filter: ['em', 'i'],\n\n  replacement: function (content, node, options) {\n    if (!content.trim()) return ''\n    return options.emDelimiter + content + options.emDelimiter\n  }\n};\n\nrules.strong = {\n  filter: ['strong', 'b'],\n\n  replacement: function (content, node, options) {\n    if (!content.trim()) return ''\n    return options.strongDelimiter + content + options.strongDelimiter\n  }\n};\n\nrules.code = {\n  filter: function (node) {\n    var hasSiblings = node.previousSibling || node.nextSibling;\n    var isCodeBlock = node.parentNode.nodeName === 'PRE' && !hasSiblings;\n\n    return node.nodeName === 'CODE' && !isCodeBlock\n  },\n\n  replacement: function (content) {\n    if (!content) return ''\n    content = content.replace(/\\r?\\n|\\r/g, ' ');\n\n    var extraSpace = /^`|^ .*?[^ ].* $|`$/.test(content) ? ' ' : '';\n    var delimiter = '`';\n    var matches = content.match(/`+/gm) || [];\n    while (matches.indexOf(delimiter) !== -1) delimiter = delimiter + '`';\n\n    return delimiter + extraSpace + content + extraSpace + delimiter\n  }\n};\n\nrules.image = {\n  filter: 'img',\n\n  replacement: function (content, node) {\n    var alt = cleanAttribute(node.getAttribute('alt'));\n    var src = node.getAttribute('src') || '';\n    var title = cleanAttribute(node.getAttribute('title'));\n    var titlePart = title ? ' \"' + title + '\"' : '';\n    return src ? '![' + alt + ']' + '(' + src + titlePart + ')' : ''\n  }\n};\n\nfunction cleanAttribute (attribute) {\n  return attribute ? attribute.replace(/(\\n+\\s*)+/g, '\\n') : ''\n}\n\n/**\n * Manages a collection of rules used to convert HTML to Markdown\n */\n\nfunction Rules (options) {\n  this.options = options;\n  this._keep = [];\n  this._remove = [];\n\n  this.blankRule = {\n    replacement: options.blankReplacement\n  };\n\n  this.keepReplacement = options.keepReplacement;\n\n  this.defaultRule = {\n    replacement: options.defaultReplacement\n  };\n\n  this.array = [];\n  for (var key in options.rules) this.array.push(options.rules[key]);\n}\n\nRules.prototype = {\n  add: function (key, rule) {\n    this.array.unshift(rule);\n  },\n\n  keep: function (filter) {\n    this._keep.unshift({\n      filter: filter,\n      replacement: this.keepReplacement\n    });\n  },\n\n  remove: function (filter) {\n    this._remove.unshift({\n      filter: filter,\n      replacement: function () {\n        return ''\n      }\n    });\n  },\n\n  forNode: function (node) {\n    if (node.isBlank) return this.blankRule\n    var rule;\n\n    if ((rule = findRule(this.array, node, this.options))) return rule\n    if ((rule = findRule(this._keep, node, this.options))) return rule\n    if ((rule = findRule(this._remove, node, this.options))) return rule\n\n    return this.defaultRule\n  },\n\n  forEach: function (fn) {\n    for (var i = 0; i < this.array.length; i++) fn(this.array[i], i);\n  }\n};\n\nfunction findRule (rules, node, options) {\n  for (var i = 0; i < rules.length; i++) {\n    var rule = rules[i];\n    if (filterValue(rule, node, options)) return rule\n  }\n  return void 0\n}\n\nfunction filterValue (rule, node, options) {\n  var filter = rule.filter;\n  if (typeof filter === 'string') {\n    if (filter === node.nodeName.toLowerCase()) return true\n  } else if (Array.isArray(filter)) {\n    if (filter.indexOf(node.nodeName.toLowerCase()) > -1) return true\n  } else if (typeof filter === 'function') {\n    if (filter.call(rule, node, options)) return true\n  } else {\n    throw new TypeError('`filter` needs to be a string, array, or function')\n  }\n}\n\n/**\n * The collapseWhitespace function is adapted from collapse-whitespace\n * by Luc Thevenard.\n *\n * The MIT License (MIT)\n *\n * Copyright (c) 2014 Luc Thevenard <lucthevenard@gmail.com>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * collapseWhitespace(options) removes extraneous whitespace from an the given element.\n *\n * @param {Object} options\n */\nfunction collapseWhitespace (options) {\n  var element = options.element;\n  var isBlock = options.isBlock;\n  var isVoid = options.isVoid;\n  var isPre = options.isPre || function (node) {\n    return node.nodeName === 'PRE'\n  };\n\n  if (!element.firstChild || isPre(element)) return\n\n  var prevText = null;\n  var keepLeadingWs = false;\n\n  var prev = null;\n  var node = next(prev, element, isPre);\n\n  while (node !== element) {\n    if (node.nodeType === 3 || node.nodeType === 4) { // Node.TEXT_NODE or Node.CDATA_SECTION_NODE\n      var text = node.data.replace(/[ \\r\\n\\t]+/g, ' ');\n\n      if ((!prevText || / $/.test(prevText.data)) &&\n          !keepLeadingWs && text[0] === ' ') {\n        text = text.substr(1);\n      }\n\n      // `text` might be empty at this point.\n      if (!text) {\n        node = remove(node);\n        continue\n      }\n\n      node.data = text;\n\n      prevText = node;\n    } else if (node.nodeType === 1) { // Node.ELEMENT_NODE\n      if (isBlock(node) || node.nodeName === 'BR') {\n        if (prevText) {\n          prevText.data = prevText.data.replace(/ $/, '');\n        }\n\n        prevText = null;\n        keepLeadingWs = false;\n      } else if (isVoid(node) || isPre(node)) {\n        // Avoid trimming space around non-block, non-BR void elements and inline PRE.\n        prevText = null;\n        keepLeadingWs = true;\n      } else if (prevText) {\n        // Drop protection if set previously.\n        keepLeadingWs = false;\n      }\n    } else {\n      node = remove(node);\n      continue\n    }\n\n    var nextNode = next(prev, node, isPre);\n    prev = node;\n    node = nextNode;\n  }\n\n  if (prevText) {\n    prevText.data = prevText.data.replace(/ $/, '');\n    if (!prevText.data) {\n      remove(prevText);\n    }\n  }\n}\n\n/**\n * remove(node) removes the given node from the DOM and returns the\n * next node in the sequence.\n *\n * @param {Node} node\n * @return {Node} node\n */\nfunction remove (node) {\n  var next = node.nextSibling || node.parentNode;\n\n  node.parentNode.removeChild(node);\n\n  return next\n}\n\n/**\n * next(prev, current, isPre) returns the next node in the sequence, given the\n * current and previous nodes.\n *\n * @param {Node} prev\n * @param {Node} current\n * @param {Function} isPre\n * @return {Node}\n */\nfunction next (prev, current, isPre) {\n  if ((prev && prev.parentNode === current) || isPre(current)) {\n    return current.nextSibling || current.parentNode\n  }\n\n  return current.firstChild || current.nextSibling || current.parentNode\n}\n\n/*\n * Set up window for Node.js\n */\n\nvar root = (typeof window !== 'undefined' ? window : {});\n\n/*\n * Parsing HTML strings\n */\n\nfunction canParseHTMLNatively () {\n  var Parser = root.DOMParser;\n  var canParse = false;\n\n  // Adapted from https://gist.github.com/1129031\n  // Firefox/Opera/IE throw errors on unsupported types\n  try {\n    // WebKit returns null on unsupported types\n    if (new Parser().parseFromString('', 'text/html')) {\n      canParse = true;\n    }\n  } catch (e) {}\n\n  return canParse\n}\n\nfunction createHTMLParser () {\n  var Parser = function () {};\n\n  {\n    if (shouldUseActiveX()) {\n      Parser.prototype.parseFromString = function (string) {\n        var doc = new window.ActiveXObject('htmlfile');\n        doc.designMode = 'on'; // disable on-page scripts\n        doc.open();\n        doc.write(string);\n        doc.close();\n        return doc\n      };\n    } else {\n      Parser.prototype.parseFromString = function (string) {\n        var doc = document.implementation.createHTMLDocument('');\n        doc.open();\n        doc.write(string);\n        doc.close();\n        return doc\n      };\n    }\n  }\n  return Parser\n}\n\nfunction shouldUseActiveX () {\n  var useActiveX = false;\n  try {\n    document.implementation.createHTMLDocument('').open();\n  } catch (e) {\n    if (window.ActiveXObject) useActiveX = true;\n  }\n  return useActiveX\n}\n\nvar HTMLParser = canParseHTMLNatively() ? root.DOMParser : createHTMLParser();\n\nfunction RootNode (input, options) {\n  var root;\n  if (typeof input === 'string') {\n    var doc = htmlParser().parseFromString(\n      // DOM parsers arrange elements in the <head> and <body>.\n      // Wrapping in a custom element ensures elements are reliably arranged in\n      // a single element.\n      '<x-turndown id=\"turndown-root\">' + input + '</x-turndown>',\n      'text/html'\n    );\n    root = doc.getElementById('turndown-root');\n  } else {\n    root = input.cloneNode(true);\n  }\n  collapseWhitespace({\n    element: root,\n    isBlock: isBlock,\n    isVoid: isVoid,\n    isPre: options.preformattedCode ? isPreOrCode : null\n  });\n\n  return root\n}\n\nvar _htmlParser;\nfunction htmlParser () {\n  _htmlParser = _htmlParser || new HTMLParser();\n  return _htmlParser\n}\n\nfunction isPreOrCode (node) {\n  return node.nodeName === 'PRE' || node.nodeName === 'CODE'\n}\n\nfunction Node (node, options) {\n  node.isBlock = isBlock(node);\n  node.isCode = node.nodeName === 'CODE' || node.parentNode.isCode;\n  node.isBlank = isBlank(node);\n  node.flankingWhitespace = flankingWhitespace(node, options);\n  return node\n}\n\nfunction isBlank (node) {\n  return (\n    !isVoid(node) &&\n    !isMeaningfulWhenBlank(node) &&\n    /^\\s*$/i.test(node.textContent) &&\n    !hasVoid(node) &&\n    !hasMeaningfulWhenBlank(node)\n  )\n}\n\nfunction flankingWhitespace (node, options) {\n  if (node.isBlock || (options.preformattedCode && node.isCode)) {\n    return { leading: '', trailing: '' }\n  }\n\n  var edges = edgeWhitespace(node.textContent);\n\n  // abandon leading ASCII WS if left-flanked by ASCII WS\n  if (edges.leadingAscii && isFlankedByWhitespace('left', node, options)) {\n    edges.leading = edges.leadingNonAscii;\n  }\n\n  // abandon trailing ASCII WS if right-flanked by ASCII WS\n  if (edges.trailingAscii && isFlankedByWhitespace('right', node, options)) {\n    edges.trailing = edges.trailingNonAscii;\n  }\n\n  return { leading: edges.leading, trailing: edges.trailing }\n}\n\nfunction edgeWhitespace (string) {\n  var m = string.match(/^(([ \\t\\r\\n]*)(\\s*))(?:(?=\\S)[\\s\\S]*\\S)?((\\s*?)([ \\t\\r\\n]*))$/);\n  return {\n    leading: m[1], // whole string for whitespace-only strings\n    leadingAscii: m[2],\n    leadingNonAscii: m[3],\n    trailing: m[4], // empty for whitespace-only strings\n    trailingNonAscii: m[5],\n    trailingAscii: m[6]\n  }\n}\n\nfunction isFlankedByWhitespace (side, node, options) {\n  var sibling;\n  var regExp;\n  var isFlanked;\n\n  if (side === 'left') {\n    sibling = node.previousSibling;\n    regExp = / $/;\n  } else {\n    sibling = node.nextSibling;\n    regExp = /^ /;\n  }\n\n  if (sibling) {\n    if (sibling.nodeType === 3) {\n      isFlanked = regExp.test(sibling.nodeValue);\n    } else if (options.preformattedCode && sibling.nodeName === 'CODE') {\n      isFlanked = false;\n    } else if (sibling.nodeType === 1 && !isBlock(sibling)) {\n      isFlanked = regExp.test(sibling.textContent);\n    }\n  }\n  return isFlanked\n}\n\nvar reduce = Array.prototype.reduce;\nvar escapes = [\n  [/\\\\/g, '\\\\\\\\'],\n  [/\\*/g, '\\\\*'],\n  [/^-/g, '\\\\-'],\n  [/^\\+ /g, '\\\\+ '],\n  [/^(=+)/g, '\\\\$1'],\n  [/^(#{1,6}) /g, '\\\\$1 '],\n  [/`/g, '\\\\`'],\n  [/^~~~/g, '\\\\~~~'],\n  [/\\[/g, '\\\\['],\n  [/\\]/g, '\\\\]'],\n  [/^>/g, '\\\\>'],\n  [/_/g, '\\\\_'],\n  [/^(\\d+)\\. /g, '$1\\\\. ']\n];\n\nfunction TurndownService (options) {\n  if (!(this instanceof TurndownService)) return new TurndownService(options)\n\n  var defaults = {\n    rules: rules,\n    headingStyle: 'setext',\n    hr: '* * *',\n    bulletListMarker: '*',\n    codeBlockStyle: 'indented',\n    fence: '```',\n    emDelimiter: '_',\n    strongDelimiter: '**',\n    linkStyle: 'inlined',\n    linkReferenceStyle: 'full',\n    br: '  ',\n    preformattedCode: false,\n    blankReplacement: function (content, node) {\n      return node.isBlock ? '\\n\\n' : ''\n    },\n    keepReplacement: function (content, node) {\n      return node.isBlock ? '\\n\\n' + node.outerHTML + '\\n\\n' : node.outerHTML\n    },\n    defaultReplacement: function (content, node) {\n      return node.isBlock ? '\\n\\n' + content + '\\n\\n' : content\n    }\n  };\n  this.options = extend({}, defaults, options);\n  this.rules = new Rules(this.options);\n}\n\nTurndownService.prototype = {\n  /**\n   * The entry point for converting a string or DOM node to Markdown\n   * @public\n   * @param {String|HTMLElement} input The string or DOM node to convert\n   * @returns A Markdown representation of the input\n   * @type String\n   */\n\n  turndown: function (input) {\n    if (!canConvert(input)) {\n      throw new TypeError(\n        input + ' is not a string, or an element/document/fragment node.'\n      )\n    }\n\n    if (input === '') return ''\n\n    var output = process.call(this, new RootNode(input, this.options));\n    return postProcess.call(this, output)\n  },\n\n  /**\n   * Add one or more plugins\n   * @public\n   * @param {Function|Array} plugin The plugin or array of plugins to add\n   * @returns The Turndown instance for chaining\n   * @type Object\n   */\n\n  use: function (plugin) {\n    if (Array.isArray(plugin)) {\n      for (var i = 0; i < plugin.length; i++) this.use(plugin[i]);\n    } else if (typeof plugin === 'function') {\n      plugin(this);\n    } else {\n      throw new TypeError('plugin must be a Function or an Array of Functions')\n    }\n    return this\n  },\n\n  /**\n   * Adds a rule\n   * @public\n   * @param {String} key The unique key of the rule\n   * @param {Object} rule The rule\n   * @returns The Turndown instance for chaining\n   * @type Object\n   */\n\n  addRule: function (key, rule) {\n    this.rules.add(key, rule);\n    return this\n  },\n\n  /**\n   * Keep a node (as HTML) that matches the filter\n   * @public\n   * @param {String|Array|Function} filter The unique key of the rule\n   * @returns The Turndown instance for chaining\n   * @type Object\n   */\n\n  keep: function (filter) {\n    this.rules.keep(filter);\n    return this\n  },\n\n  /**\n   * Remove a node that matches the filter\n   * @public\n   * @param {String|Array|Function} filter The unique key of the rule\n   * @returns The Turndown instance for chaining\n   * @type Object\n   */\n\n  remove: function (filter) {\n    this.rules.remove(filter);\n    return this\n  },\n\n  /**\n   * Escapes Markdown syntax\n   * @public\n   * @param {String} string The string to escape\n   * @returns A string with Markdown syntax escaped\n   * @type String\n   */\n\n  escape: function (string) {\n    return escapes.reduce(function (accumulator, escape) {\n      return accumulator.replace(escape[0], escape[1])\n    }, string)\n  }\n};\n\n/**\n * Reduces a DOM node down to its Markdown string equivalent\n * @private\n * @param {HTMLElement} parentNode The node to convert\n * @returns A Markdown representation of the node\n * @type String\n */\n\nfunction process (parentNode) {\n  var self = this;\n  return reduce.call(parentNode.childNodes, function (output, node) {\n    node = new Node(node, self.options);\n\n    var replacement = '';\n    if (node.nodeType === 3) {\n      replacement = node.isCode ? node.nodeValue : self.escape(node.nodeValue);\n    } else if (node.nodeType === 1) {\n      replacement = replacementForNode.call(self, node);\n    }\n\n    return join(output, replacement)\n  }, '')\n}\n\n/**\n * Appends strings as each rule requires and trims the output\n * @private\n * @param {String} output The conversion output\n * @returns A trimmed version of the ouput\n * @type String\n */\n\nfunction postProcess (output) {\n  var self = this;\n  this.rules.forEach(function (rule) {\n    if (typeof rule.append === 'function') {\n      output = join(output, rule.append(self.options));\n    }\n  });\n\n  return output.replace(/^[\\t\\r\\n]+/, '').replace(/[\\t\\r\\n\\s]+$/, '')\n}\n\n/**\n * Converts an element node to its Markdown equivalent\n * @private\n * @param {HTMLElement} node The node to convert\n * @returns A Markdown representation of the node\n * @type String\n */\n\nfunction replacementForNode (node) {\n  var rule = this.rules.forNode(node);\n  var content = process.call(this, node);\n  var whitespace = node.flankingWhitespace;\n  if (whitespace.leading || whitespace.trailing) content = content.trim();\n  return (\n    whitespace.leading +\n    rule.replacement(content, node, this.options) +\n    whitespace.trailing\n  )\n}\n\n/**\n * Joins replacement to the current output with appropriate number of new lines\n * @private\n * @param {String} output The current conversion output\n * @param {String} replacement The string to append to the output\n * @returns Joined output\n * @type String\n */\n\nfunction join (output, replacement) {\n  var s1 = trimTrailingNewlines(output);\n  var s2 = trimLeadingNewlines(replacement);\n  var nls = Math.max(output.length - s1.length, replacement.length - s2.length);\n  var separator = '\\n\\n'.substring(0, nls);\n\n  return s1 + separator + s2\n}\n\n/**\n * Determines whether an input can be converted\n * @private\n * @param {String|HTMLElement} input Describe this parameter\n * @returns Describe what it returns\n * @type String|Object|Array|Boolean|Number\n */\n\nfunction canConvert (input) {\n  return (\n    input != null && (\n      typeof input === 'string' ||\n      (input.nodeType && (\n        input.nodeType === 1 || input.nodeType === 9 || input.nodeType === 11\n      ))\n    )\n  )\n}\n\nexport default TurndownService;\n", "import { EDITOR_WIDTH } from '@blocksuite/global/config';\nimport { css } from 'lit';\n\nexport const globalCSS = css`\n  :root {\n    --affine-editor-width: ${EDITOR_WIDTH}px;\n\n    --affine-theme-mode: light;\n    --affine-editor-mode: page;\n    /* --affine-palette-transparent: special values added for the sake of logical consistency. */\n    --affine-palette-transparent: #00000000;\n\n    --affine-popover-shadow: 0px 1px 10px -6px rgba(24, 39, 75, 0.08),\n      0px 3px 16px -6px rgba(24, 39, 75, 0.04);\n    --affine-font-family: Avenir Next, Poppins, apple-system, BlinkMacSystemFont,\n      Helvetica Neue, Tahoma, PingFang SC, Microsoft Yahei, Arial,\n      Hiragino Sans GB, sans-serif, Apple Color Emoji, Segoe UI Emoji,\n      Segoe UI Symbol, Noto Color Emoji;\n    --affine-font-number-family: Roboto Mono, apple-system, BlinkMacSystemFont,\n      Helvetica Neue, Tahoma, PingFang SC, Microsoft Yahei, Arial,\n      Hiragino Sans GB, sans-serif, Apple Color Emoji, Segoe UI Emoji,\n      Segoe UI Symbol, Noto Color Emoji;\n    --affine-font-code-family: Space Mono, Consolas, Menlo, Monaco, Courier,\n      monospace, apple-system, BlinkMacSystemFont, Helvetica Neue, Tahoma,\n      PingFang SC, Microsoft Yahei, Arial, Hiragino Sans GB, sans-serif,\n      Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;\n    --affine-font-h-1: 28px;\n    --affine-font-h-2: 26px;\n    --affine-font-h-3: 24px;\n    --affine-font-h-4: 22px;\n    --affine-font-h-5: 20px;\n    --affine-font-h-6: 18px;\n    --affine-font-base: 16px;\n    --affine-font-sm: 14px;\n    --affine-font-xs: 12px;\n    --affine-line-height: calc(1em + 8px);\n    --affine-z-index-modal: 1000;\n    --affine-z-index-popover: 1000;\n    --affine-paragraph-space: 8px;\n    --affine-popover-radius: 10px;\n    --affine-zoom: 1;\n    --affine-scale: calc(1 / var(--affine-zoom));\n\n    --affine-brand-color: #5438ff;\n    --affine-tertiary-color: #f3f0ff;\n    --affine-primary-color: #5438ff;\n    --affine-secondary-color: #7d91ff;\n    --affine-background-success-color: #fff;\n    --affine-background-error-color: hsla(0, 0%, 100%, 0.2);\n    --affine-background-processing-color: #fff;\n    --affine-background-warning-color: #fff;\n    --affine-background-primary-color: #fff;\n    --affine-background-overlay-panel-color: #fbfbfc;\n    --affine-background-secondary-color: #fbfafc;\n    --affine-background-tertiary-color: #e9e9ec;\n    --affine-background-code-block: #fafbfd;\n    --affine-background-modal-color: rgba(0, 0, 0, 0.6);\n    --affine-text-primary-color: #424149;\n    --affine-text-secondary-color: #8e8d91;\n    --affine-text-disable-color: #a9a9ad;\n    --affine-text-emphasis-color: #5438ff;\n    --affine-hover-color: rgba(0, 0, 0, 0.04);\n    --affine-link-color: #7d91ff;\n    --affine-quote-color: #645f82;\n    --affine-icon-color: #77757d;\n    --affine-icon-secondary: hsla(255, 3%, 47%, 0.6);\n    --affine-border-color: #e3e2e4;\n    --affine-divider-color: #e3e2e4;\n    --affine-placeholder-color: #c0bfc1;\n    --affine-edgeless-grid-color: #e6e6e6;\n    --affine-success-color: #10cb86;\n    --affine-warning-color: #ff631f;\n    --affine-error-color: #eb4335;\n    --affine-processing-color: #2776ff;\n    --affine-black-10: rgba(0, 0, 0, 0.1);\n    --affine-black-30: rgba(0, 0, 0, 0.3);\n    --affine-black-50: rgba(0, 0, 0, 0.5);\n    --affine-black-60: rgba(0, 0, 0, 0.6);\n    --affine-black-80: rgba(0, 0, 0, 0.8);\n    --affine-black-90: rgba(0, 0, 0, 0.9);\n    --affine-black: #000;\n    --affine-white-10: hsla(0, 0%, 100%, 0.1);\n    --affine-white-30: hsla(0, 0%, 100%, 0.3);\n    --affine-white-50: hsla(0, 0%, 100%, 0.5);\n    --affine-white-60: hsla(0, 0%, 100%, 0.6);\n    --affine-white-80: hsla(0, 0%, 100%, 0.8);\n    --affine-white-90: hsla(0, 0%, 100%, 0.9);\n    --affine-white: #fff;\n    --affine-tag-white: #f5f5f5;\n    --affine-tag-gray: #e3e2e0;\n    --affine-tag-red: #ffe1e1;\n    --affine-tag-orange: #ffeaca;\n    --affine-tag-yellow: #fff4d8;\n    --affine-tag-green: #dff4e8;\n    --affine-tag-teal: #dff4f3;\n    --affine-tag-blue: #e1efff;\n    --affine-tag-purple: #f3f0ff;\n    --affine-tag-pink: #fce8ff;\n    --affine-palette-line-yellow: #3874ff;\n    --affine-palette-line-orange: #ffaf38;\n    --affine-palette-line-tangerine: #ff631f;\n    --affine-palette-line-red: #fc3f55;\n    --affine-palette-line-magenta: #ff38b3;\n    --affine-palette-line-purple: #b638ff;\n    --affine-palette-line-navy: #3b25cc;\n    --affine-palette-line-blue: #4f90ff;\n    --affine-palette-line-green: #10cb86;\n    --affine-palette-line-white: #fff;\n    --affine-palette-line-black: #000;\n    --affine-palette-line-grey: #999;\n    --affine-palette-shape-yellow: #fff188;\n    --affine-palette-shape-orange: #ffcf88;\n    --affine-palette-shape-tangerine: #ffa179;\n    --affine-palette-shape-red: #fd8c99;\n    --affine-palette-shape-magenta: #ff88d1;\n    --affine-palette-shape-purple: #d388ff;\n    --affine-palette-shape-navy: #897ce0;\n    --affine-palette-shape-blue: #95bcff;\n    --affine-palette-shape-green: #70e0b6;\n    --affine-palette-shape-white: #fff;\n    --affine-palette-shape-black: #000;\n    --affine-palette-shape-grey: #c2c2c2;\n    --affine-tooltip: #424149;\n  }\n  body {\n    font-family: var(--affine-font-family);\n    color: var(--affine-text-primary-color);\n  }\n`;\n", "/* eslint-disable no-control-regex */\nimport { EDITOR_WIDTH } from '@blocksuite/global/config';\nimport TurndownService from 'turndown';\n\nimport { globalCSS } from './exporter-style.js';\n\n// Context: Lean towards breaking out any localizable content into constants so it's\n// easier to track content we may need to localize in the future. (i18n)\nconst UNTITLED_PAGE_NAME = 'Untitled';\n\n/** Tools for exporting files to device. For example, via browser download. */\nexport const FileExporter = {\n  /**\n   * Create a download for the user's browser.\n   *\n   * @param filename\n   * @param text\n   * @param mimeType like `\"text/plain\"`, `\"text/html\"`, `\"application/javascript\"`, etc. See {@link https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types mdn docs List of MIME types}.\n   *\n   * @remarks\n   * Only accepts data in utf-8 encoding (html files, javascript source, text files, etc).\n   *\n   * @example\n   * const todoMDText = `# Todo items\n   * [ ] Item 1\n   * [ ] Item 2\n   * `\n   * FileExporter.exportFile(\"Todo list.md\", todoMDText, \"text/plain\")\n   *\n   * @example\n   * const stateJsonContent = JSON.stringify({ a: 1, b: 2, c: 3 })\n   * FileExporter.exportFile(\"state.json\", jsonContent, \"application/json\")\n   */\n  exportFile(filename: string, dataURL: string) {\n    const element = document.createElement('a');\n    element.setAttribute('href', dataURL);\n    const safeFilename = getSafeFileName(filename);\n    element.setAttribute('download', safeFilename);\n\n    element.style.display = 'none';\n    document.body.appendChild(element);\n\n    element.click();\n\n    document.body.removeChild(element);\n  },\n  exportTextFile(filename: string, text: string, mimeType: string) {\n    FileExporter.exportFile(\n      filename,\n      'data:' + mimeType + ';charset=utf-8,' + encodeURIComponent(text)\n    );\n  },\n  exportHtml(pageTitle: string | undefined, htmlContent: string) {\n    const title = pageTitle?.trim() || UNTITLED_PAGE_NAME;\n    FileExporter.exportTextFile(\n      title + '.html',\n      wrapHtmlWithHtmlDocumentText(title, htmlContent),\n      'text/html'\n    );\n  },\n  exportHtmlAsMarkdown(pageTitle: string | undefined, htmlContent: string) {\n    const turndownService = new TurndownService();\n    turndownService.addRule('input', {\n      //@ts-ignore\n      [Symbol.iterator](): IterableIterator<string> {\n        //@ts-ignore\n        return undefined;\n      },\n      anchor(name: string): string {\n        return '';\n      },\n      big(): string {\n        return '';\n      },\n      blink(): string {\n        return '';\n      },\n      bold(): string {\n        return '';\n      },\n      charAt(pos: number): string {\n        return '';\n      },\n      charCodeAt(index: number): number {\n        return 0;\n      },\n      codePointAt(pos: number): number | undefined {\n        return undefined;\n      },\n      concat(strings: string): string {\n        return '';\n      },\n      endsWith(searchString: string, endPosition: number | undefined): boolean {\n        return false;\n      },\n      fixed(): string {\n        return '';\n      },\n      fontcolor(color: string): string {\n        return '';\n      },\n      includes(searchString: string, position: number | undefined): boolean {\n        return false;\n      },\n      indexOf(searchString: string, position: number | undefined): number {\n        return 0;\n      },\n      italics(): string {\n        return '';\n      },\n      lastIndexOf(searchString: string, position: number | undefined): number {\n        return 0;\n      },\n      length: 0,\n      link(url: string): string {\n        return '';\n      },\n      repeat(count: number): string {\n        return '';\n      },\n      slice(start: number | undefined, end: number | undefined): string {\n        return '';\n      },\n      small(): string {\n        return '';\n      },\n      startsWith(searchString: string, position: number | undefined): boolean {\n        return false;\n      },\n      strike(): string {\n        return '';\n      },\n      sub(): string {\n        return '';\n      },\n      substr(from: number, length: number | undefined): string {\n        return '';\n      },\n      substring(start: number, end: number | undefined): string {\n        return '';\n      },\n      sup(): string {\n        return '';\n      },\n      toLocaleLowerCase(locales: string | string[] | undefined): string {\n        return '';\n      },\n      toLocaleUpperCase(locales: string | string[] | undefined): string {\n        return '';\n      },\n      toLowerCase(): string {\n        return '';\n      },\n      toString(): string {\n        return '';\n      },\n      toUpperCase(): string {\n        return '';\n      },\n      trim(): string {\n        return '';\n      },\n      valueOf(): string {\n        return '';\n      },\n      fontsize(size: string | number): string {\n        return '';\n      },\n      localeCompare(\n        that: string,\n        locales?: string | string[],\n        options?: Intl.CollatorOptions\n      ): number {\n        return 0;\n      },\n      match(\n        matcher:\n          | { [Symbol.match](string: string): RegExpMatchArray | null }\n          | string\n          | RegExp\n      ): RegExpMatchArray | null {\n        //@ts-ignore\n        return undefined;\n      },\n      normalize(form?: 'NFC' | 'NFD' | 'NFKC' | 'NFKD' | string): string {\n        return '';\n      },\n      replace(\n        searchValue:\n          | {\n              [Symbol.replace](\n                string: string,\n                replacer: (substring: string, ...args: unknown[]) => string\n              ): string;\n            }\n          | string\n          | RegExp\n          | { [Symbol.replace](string: string, replaceValue: string): string },\n        replacer: ((substring: string, ...args: unknown[]) => string) | string\n      ): string {\n        return '';\n      },\n      search(\n        regexp: string | RegExp | { [Symbol.search](string: string): number }\n      ): number {\n        return 0;\n      },\n      split(\n        separator:\n          | string\n          | RegExp\n          | { [Symbol.split](string: string, limit?: number): string[] },\n        limit?: number\n      ): string[] {\n        return [];\n      },\n      filter: ['input'],\n      //@ts-ignore\n      replacement: function (content, node) {\n        return (node as HTMLElement).getAttribute('checked') === null\n          ? '[ ] '\n          : '[x] ';\n      },\n    });\n    turndownService.addRule('codeBlock', {\n      filter: ['pre'],\n      //@ts-ignore\n      replacement: function (content, node: Node) {\n        const element = node as Element;\n        return (\n          '```' +\n          element.getAttribute('code-lang') +\n          '\\n' +\n          node.textContent +\n          '```\\n'\n        );\n      },\n    });\n    turndownService.keep(['del', 'u']);\n    const markdown = turndownService.turndown(htmlContent);\n    const title = pageTitle?.trim() || UNTITLED_PAGE_NAME;\n    FileExporter.exportTextFile(title + '.md', markdown, 'text/plain');\n  },\n  exportPng(pageTitle: string | undefined, dataURL: string) {\n    const title = pageTitle?.trim() || UNTITLED_PAGE_NAME;\n    FileExporter.exportFile(title + '.png', dataURL);\n  },\n};\n\n/** @internal surround plain html content in a document with head and basic styles */\nfunction wrapHtmlWithHtmlDocumentText(pageTitle: string, htmlContent: string) {\n  // Question: Why not embed css directly into html?\n  const htmlCss = `<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css\">\n<style>\n  ${globalCSS}\n</style>`;\n  // Question: Do we really need the extra div container?\n  return `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>${pageTitle}</title>\n  ${htmlCss}\n</head>\n<body>\n<div style=\"margin:0 auto;padding:1rem;max-width:${EDITOR_WIDTH}px\">\n${htmlContent}\n</div>\n</body>\n</html>\n`;\n}\n\nfunction getSafeFileName(string: string) {\n  const replacement = ' ';\n  const filenameReservedRegex = /[<>:\"/\\\\|?*\\u0000-\\u001F]/g;\n  const windowsReservedNameRegex = /^(con|prn|aux|nul|com\\d|lpt\\d)$/i;\n  const reControlChars = /[\\u0000-\\u001F\\u0080-\\u009F]/g;\n  const reTrailingPeriods = /\\.+$/;\n  const allowedLength = 50;\n\n  function trimRepeated(string: string, target: string) {\n    const escapeStringRegexp = target\n      .replace(/[|\\\\{}()[\\]^$+*?.]/g, '\\\\$&')\n      .replace(/-/g, '\\\\x2d');\n    const regex = new RegExp(`(?:${escapeStringRegexp}){2,}`, 'g');\n    return string.replace(regex, target);\n  }\n\n  string = string\n    .normalize('NFD')\n    .replace(filenameReservedRegex, replacement)\n    .replace(reControlChars, replacement)\n    .replace(reTrailingPeriods, '');\n\n  string = trimRepeated(string, replacement);\n  string = windowsReservedNameRegex.test(string)\n    ? string + replacement\n    : string;\n  const extIndex = string.lastIndexOf('.');\n  const filename = string.slice(0, extIndex).trim();\n  const extension = string.slice(extIndex);\n  string =\n    filename.slice(0, Math.max(1, allowedLength - extension.length)) +\n    extension;\n  return string;\n}\n", "import { loadWASM, createOnigScanner, createOnigString } from 'vscode-oniguruma';\nimport { INITIAL, Registry as Registry$1 } from 'vscode-textmate';\n\nconst themes = [\n  \"css-variables\",\n  \"dark-plus\",\n  \"dracula-soft\",\n  \"dracula\",\n  \"github-dark-dimmed\",\n  \"github-dark\",\n  \"github-light\",\n  \"hc_light\",\n  \"light-plus\",\n  \"material-theme-darker\",\n  \"material-theme-lighter\",\n  \"material-theme-ocean\",\n  \"material-theme-palenight\",\n  \"material-theme\",\n  \"min-dark\",\n  \"min-light\",\n  \"monokai\",\n  \"nord\",\n  \"one-dark-pro\",\n  \"poimandres\",\n  \"rose-pine-dawn\",\n  \"rose-pine-moon\",\n  \"rose-pine\",\n  \"slack-dark\",\n  \"slack-ochin\",\n  \"solarized-dark\",\n  \"solarized-light\",\n  \"vitesse-dark\",\n  \"vitesse-light\"\n];\n\nconst languages = [\n  {\n    id: \"abap\",\n    scopeName: \"source.abap\",\n    path: \"abap.tmLanguage.json\",\n    displayName: \"ABAP\",\n    samplePath: \"abap.sample\"\n  },\n  {\n    id: \"actionscript-3\",\n    scopeName: \"source.actionscript.3\",\n    path: \"actionscript-3.tmLanguage.json\",\n    displayName: \"ActionScript\",\n    samplePath: \"actionscript-3.sample\"\n  },\n  {\n    id: \"ada\",\n    scopeName: \"source.ada\",\n    path: \"ada.tmLanguage.json\",\n    displayName: \"Ada\",\n    samplePath: \"ada.sample\"\n  },\n  {\n    id: \"apache\",\n    scopeName: \"source.apacheconf\",\n    path: \"apache.tmLanguage.json\",\n    displayName: \"Apache Conf\"\n  },\n  {\n    id: \"apex\",\n    scopeName: \"source.apex\",\n    path: \"apex.tmLanguage.json\",\n    displayName: \"Apex\",\n    samplePath: \"apex.sample\"\n  },\n  {\n    id: \"apl\",\n    scopeName: \"source.apl\",\n    path: \"apl.tmLanguage.json\",\n    displayName: \"APL\",\n    embeddedLangs: [\"html\", \"xml\", \"css\", \"javascript\", \"json\"]\n  },\n  {\n    id: \"applescript\",\n    scopeName: \"source.applescript\",\n    path: \"applescript.tmLanguage.json\",\n    displayName: \"AppleScript\",\n    samplePath: \"applescript.sample\"\n  },\n  {\n    id: \"ara\",\n    scopeName: \"source.ara\",\n    path: \"ara.tmLanguage.json\",\n    displayName: \"Ara\",\n    samplePath: \"ara.sample\"\n  },\n  {\n    id: \"asm\",\n    scopeName: \"source.asm.x86_64\",\n    path: \"asm.tmLanguage.json\",\n    displayName: \"Assembly\",\n    samplePath: \"asm.sample\"\n  },\n  {\n    id: \"astro\",\n    scopeName: \"source.astro\",\n    path: \"astro.tmLanguage.json\",\n    displayName: \"Astro\",\n    samplePath: \"astro.sample\",\n    embeddedLangs: [\"json\", \"javascript\", \"typescript\", \"stylus\", \"sass\", \"css\", \"scss\", \"less\", \"postcss\", \"tsx\"]\n  },\n  {\n    id: \"awk\",\n    scopeName: \"source.awk\",\n    path: \"awk.tmLanguage.json\",\n    displayName: \"AWK\",\n    samplePath: \"awk.sample\"\n  },\n  {\n    id: \"ballerina\",\n    scopeName: \"source.ballerina\",\n    path: \"ballerina.tmLanguage.json\",\n    displayName: \"Ballerina\",\n    samplePath: \"ballerina.sample\"\n  },\n  {\n    id: \"bat\",\n    scopeName: \"source.batchfile\",\n    path: \"bat.tmLanguage.json\",\n    displayName: \"Batch\",\n    samplePath: \"bat.sample\",\n    aliases: [\"batch\"]\n  },\n  {\n    id: \"beancount\",\n    scopeName: \"text.beancount\",\n    path: \"beancount.tmLanguage.json\",\n    displayName: \"Beancount\",\n    samplePath: \"beancount.sample\"\n  },\n  {\n    id: \"berry\",\n    scopeName: \"source.berry\",\n    path: \"berry.tmLanguage.json\",\n    displayName: \"Berry\",\n    samplePath: \"berry.sample\",\n    aliases: [\"be\"]\n  },\n  {\n    id: \"bibtex\",\n    scopeName: \"text.bibtex\",\n    path: \"bibtex.tmLanguage.json\",\n    displayName: \"BibTeX\"\n  },\n  {\n    id: \"bicep\",\n    scopeName: \"source.bicep\",\n    path: \"bicep.tmLanguage.json\",\n    displayName: \"Bicep\",\n    samplePath: \"bicep.sample\"\n  },\n  {\n    id: \"blade\",\n    scopeName: \"text.html.php.blade\",\n    path: \"blade.tmLanguage.json\",\n    displayName: \"Blade\",\n    samplePath: \"blade.sample\",\n    embeddedLangs: [\"html\", \"xml\", \"sql\", \"javascript\", \"json\", \"css\"]\n  },\n  {\n    id: \"c\",\n    scopeName: \"source.c\",\n    path: \"c.tmLanguage.json\",\n    displayName: \"C\",\n    samplePath: \"c.sample\"\n  },\n  {\n    id: \"cadence\",\n    scopeName: \"source.cadence\",\n    path: \"cadence.tmLanguage.json\",\n    displayName: \"Cadence\",\n    samplePath: \"cadence.sample\",\n    aliases: [\"cdc\"]\n  },\n  {\n    id: \"clarity\",\n    scopeName: \"source.clar\",\n    path: \"clarity.tmLanguage.json\",\n    displayName: \"Clarity\",\n    samplePath: \"clarity.sample\"\n  },\n  {\n    id: \"clojure\",\n    scopeName: \"source.clojure\",\n    path: \"clojure.tmLanguage.json\",\n    displayName: \"Clojure\",\n    samplePath: \"clojure.sample\",\n    aliases: [\"clj\"]\n  },\n  {\n    id: \"cmake\",\n    scopeName: \"source.cmake\",\n    path: \"cmake.tmLanguage.json\",\n    displayName: \"CMake\",\n    samplePath: \"cmake.sample\"\n  },\n  {\n    id: \"cobol\",\n    scopeName: \"source.cobol\",\n    path: \"cobol.tmLanguage.json\",\n    displayName: \"COBOL\",\n    samplePath: \"cobol.sample\",\n    embeddedLangs: [\"sql\", \"html\", \"java\"]\n  },\n  {\n    id: \"codeql\",\n    scopeName: \"source.ql\",\n    path: \"codeql.tmLanguage.json\",\n    displayName: \"CodeQL\",\n    samplePath: \"codeql.sample\",\n    aliases: [\"ql\"],\n    embeddedLangs: [\"markdown\"]\n  },\n  {\n    id: \"coffee\",\n    scopeName: \"source.coffee\",\n    path: \"coffee.tmLanguage.json\",\n    displayName: \"CoffeeScript\",\n    samplePath: \"coffee.sample\",\n    embeddedLangs: [\"javascript\"]\n  },\n  {\n    id: \"cpp\",\n    scopeName: \"source.cpp\",\n    path: \"cpp.tmLanguage.json\",\n    displayName: \"C++\",\n    samplePath: \"cpp.sample\",\n    embeddedLangs: [\"glsl\", \"sql\"]\n  },\n  {\n    id: \"crystal\",\n    scopeName: \"source.crystal\",\n    path: \"crystal.tmLanguage.json\",\n    displayName: \"Crystal\",\n    samplePath: \"crystal.sample\",\n    embeddedLangs: [\"html\", \"sql\", \"css\", \"c\", \"javascript\", \"shellscript\"]\n  },\n  {\n    id: \"csharp\",\n    scopeName: \"source.cs\",\n    path: \"csharp.tmLanguage.json\",\n    displayName: \"C#\",\n    samplePath: \"csharp.sample\",\n    aliases: [\"c#\", \"cs\"]\n  },\n  {\n    id: \"css\",\n    scopeName: \"source.css\",\n    path: \"css.tmLanguage.json\",\n    displayName: \"CSS\",\n    samplePath: \"css.sample\"\n  },\n  {\n    id: \"cue\",\n    scopeName: \"source.cue\",\n    path: \"cue.tmLanguage.json\",\n    displayName: \"CUE\",\n    samplePath: \"cue.sample\"\n  },\n  {\n    id: \"cypher\",\n    scopeName: \"source.cypher\",\n    path: \"cypher.tmLanguage.json\",\n    displayName: \"Cypher\",\n    samplePath: \"cypher.sample\",\n    aliases: [\"cql\"]\n  },\n  {\n    id: \"d\",\n    scopeName: \"source.d\",\n    path: \"d.tmLanguage.json\",\n    displayName: \"D\",\n    samplePath: \"d.sample\"\n  },\n  {\n    id: \"dart\",\n    scopeName: \"source.dart\",\n    path: \"dart.tmLanguage.json\",\n    displayName: \"Dart\",\n    samplePath: \"dart.sample\"\n  },\n  {\n    id: \"dax\",\n    scopeName: \"source.dax\",\n    path: \"dax.tmLanguage.json\",\n    displayName: \"DAX\",\n    samplePath: \"dax.sample\"\n  },\n  {\n    id: \"diff\",\n    scopeName: \"source.diff\",\n    path: \"diff.tmLanguage.json\",\n    displayName: \"Diff\",\n    samplePath: \"diff.sample\"\n  },\n  {\n    id: \"docker\",\n    scopeName: \"source.dockerfile\",\n    path: \"docker.tmLanguage.json\",\n    displayName: \"Docker\",\n    samplePath: \"docker.sample\",\n    aliases: [\"dockerfile\"]\n  },\n  {\n    id: \"dream-maker\",\n    scopeName: \"source.dm\",\n    path: \"dream-maker.tmLanguage.json\",\n    displayName: \"Dream Maker\"\n  },\n  {\n    id: \"elixir\",\n    scopeName: \"source.elixir\",\n    path: \"elixir.tmLanguage.json\",\n    displayName: \"Elixir\",\n    samplePath: \"elixir.sample\",\n    embeddedLangs: [\"html\"]\n  },\n  {\n    id: \"elm\",\n    scopeName: \"source.elm\",\n    path: \"elm.tmLanguage.json\",\n    displayName: \"Elm\",\n    samplePath: \"elm.sample\",\n    embeddedLangs: [\"glsl\"]\n  },\n  {\n    id: \"erb\",\n    scopeName: \"text.html.erb\",\n    path: \"erb.tmLanguage.json\",\n    displayName: \"ERB\",\n    samplePath: \"erb.sample\",\n    embeddedLangs: [\"html\", \"ruby\"]\n  },\n  {\n    id: \"erlang\",\n    scopeName: \"source.erlang\",\n    path: \"erlang.tmLanguage.json\",\n    displayName: \"Erlang\",\n    samplePath: \"erlang.sample\",\n    aliases: [\"erl\"]\n  },\n  {\n    id: \"fish\",\n    scopeName: \"source.fish\",\n    path: \"fish.tmLanguage.json\",\n    displayName: \"Fish\",\n    samplePath: \"fish.sample\"\n  },\n  {\n    id: \"fsharp\",\n    scopeName: \"source.fsharp\",\n    path: \"fsharp.tmLanguage.json\",\n    displayName: \"F#\",\n    samplePath: \"fsharp.sample\",\n    aliases: [\"f#\", \"fs\"],\n    embeddedLangs: [\"markdown\"]\n  },\n  {\n    id: \"gdresource\",\n    scopeName: \"source.gdresource\",\n    path: \"gdresource.tmLanguage.json\",\n    displayName: \"GDResource\",\n    samplePath: \"gdresource.sample\",\n    embeddedLangs: [\"gdshader\", \"gdscript\"]\n  },\n  {\n    id: \"gdscript\",\n    scopeName: \"source.gdscript\",\n    path: \"gdscript.tmLanguage.json\",\n    displayName: \"GDScript\",\n    samplePath: \"gdscript.sample\"\n  },\n  {\n    id: \"gdshader\",\n    scopeName: \"source.gdshader\",\n    path: \"gdshader.tmLanguage.json\",\n    displayName: \"GDShader\",\n    samplePath: \"gdshader.sample\"\n  },\n  {\n    id: \"gherkin\",\n    scopeName: \"text.gherkin.feature\",\n    path: \"gherkin.tmLanguage.json\",\n    displayName: \"Gherkin\"\n  },\n  {\n    id: \"git-commit\",\n    scopeName: \"text.git-commit\",\n    path: \"git-commit.tmLanguage.json\",\n    displayName: \"Git Commit Message\",\n    embeddedLangs: [\"diff\"]\n  },\n  {\n    id: \"git-rebase\",\n    scopeName: \"text.git-rebase\",\n    path: \"git-rebase.tmLanguage.json\",\n    displayName: \"Git Rebase Message\",\n    embeddedLangs: [\"shellscript\"]\n  },\n  {\n    id: \"glimmer-js\",\n    scopeName: \"source.gjs\",\n    path: \"glimmer-js.tmLanguage.json\",\n    displayName: \"Glimmer JS\",\n    aliases: [\"gjs\"],\n    embeddedLangs: [\"javascript\", \"handlebars\"]\n  },\n  {\n    id: \"glimmer-ts\",\n    scopeName: \"source.gts\",\n    path: \"glimmer-ts.tmLanguage.json\",\n    displayName: \"Glimmer TS\",\n    aliases: [\"gts\"],\n    embeddedLangs: [\"typescript\", \"handlebars\"]\n  },\n  {\n    id: \"glsl\",\n    scopeName: \"source.glsl\",\n    path: \"glsl.tmLanguage.json\",\n    displayName: \"GLSL\",\n    samplePath: \"glsl.sample\",\n    embeddedLangs: [\"c\"]\n  },\n  {\n    id: \"gnuplot\",\n    scopeName: \"source.gnuplot\",\n    path: \"gnuplot.tmLanguage.json\",\n    displayName: \"Gnuplot\"\n  },\n  {\n    id: \"go\",\n    scopeName: \"source.go\",\n    path: \"go.tmLanguage.json\",\n    displayName: \"Go\",\n    samplePath: \"go.sample\"\n  },\n  {\n    id: \"graphql\",\n    scopeName: \"source.graphql\",\n    path: \"graphql.tmLanguage.json\",\n    displayName: \"GraphQL\",\n    embeddedLangs: [\"javascript\", \"typescript\", \"jsx\", \"tsx\"]\n  },\n  {\n    id: \"groovy\",\n    scopeName: \"source.groovy\",\n    path: \"groovy.tmLanguage.json\",\n    displayName: \"Groovy\"\n  },\n  {\n    id: \"hack\",\n    scopeName: \"source.hack\",\n    path: \"hack.tmLanguage.json\",\n    displayName: \"Hack\",\n    embeddedLangs: [\"html\", \"sql\"]\n  },\n  {\n    id: \"haml\",\n    scopeName: \"text.haml\",\n    path: \"haml.tmLanguage.json\",\n    displayName: \"Ruby Haml\",\n    embeddedLangs: [\"ruby\", \"javascript\", \"sass\", \"coffee\", \"markdown\", \"css\"]\n  },\n  {\n    id: \"handlebars\",\n    scopeName: \"text.html.handlebars\",\n    path: \"handlebars.tmLanguage.json\",\n    displayName: \"Handlebars\",\n    aliases: [\"hbs\"],\n    embeddedLangs: [\"html\", \"css\", \"javascript\", \"yaml\"]\n  },\n  {\n    id: \"haskell\",\n    scopeName: \"source.haskell\",\n    path: \"haskell.tmLanguage.json\",\n    displayName: \"Haskell\",\n    aliases: [\"hs\"]\n  },\n  {\n    id: \"hcl\",\n    scopeName: \"source.hcl\",\n    path: \"hcl.tmLanguage.json\",\n    displayName: \"HashiCorp HCL\",\n    samplePath: \"hcl.sample\"\n  },\n  {\n    id: \"hjson\",\n    scopeName: \"source.hjson\",\n    path: \"hjson.tmLanguage.json\",\n    displayName: \"Hjson\",\n    samplePath: \"hjson.sample\"\n  },\n  {\n    id: \"hlsl\",\n    scopeName: \"source.hlsl\",\n    path: \"hlsl.tmLanguage.json\",\n    displayName: \"HLSL\"\n  },\n  {\n    id: \"html\",\n    scopeName: \"text.html.basic\",\n    path: \"html.tmLanguage.json\",\n    displayName: \"HTML\",\n    samplePath: \"html.sample\",\n    embeddedLangs: [\"javascript\", \"css\"]\n  },\n  {\n    id: \"http\",\n    scopeName: \"source.http\",\n    path: \"http.tmLanguage.json\",\n    displayName: \"HTTP\",\n    samplePath: \"http.sample\",\n    embeddedLangs: [\"shellscript\", \"json\", \"xml\", \"graphql\"]\n  },\n  {\n    id: \"imba\",\n    scopeName: \"source.imba\",\n    path: \"imba.tmLanguage.json\",\n    displayName: \"Imba\",\n    samplePath: \"imba.sample\"\n  },\n  {\n    id: \"ini\",\n    scopeName: \"source.ini\",\n    path: \"ini.tmLanguage.json\",\n    displayName: \"INI\",\n    aliases: [\"properties\"]\n  },\n  {\n    id: \"java\",\n    scopeName: \"source.java\",\n    path: \"java.tmLanguage.json\",\n    displayName: \"Java\",\n    samplePath: \"java.sample\"\n  },\n  {\n    id: \"javascript\",\n    scopeName: \"source.js\",\n    path: \"javascript.tmLanguage.json\",\n    displayName: \"JavaScript\",\n    samplePath: \"javascript.sample\",\n    aliases: [\"js\"]\n  },\n  {\n    id: \"jinja-html\",\n    scopeName: \"text.html.jinja\",\n    path: \"jinja-html.tmLanguage.json\",\n    displayName: \"Jinja\",\n    embeddedLangs: [\"html\"]\n  },\n  {\n    id: \"jison\",\n    scopeName: \"source.jison\",\n    path: \"jison.tmLanguage.json\",\n    displayName: \"Jison\",\n    samplePath: \"jison.sample\",\n    embeddedLangs: [\"javascript\"]\n  },\n  {\n    id: \"json\",\n    scopeName: \"source.json\",\n    path: \"json.tmLanguage.json\",\n    displayName: \"JSON\"\n  },\n  {\n    id: \"json5\",\n    scopeName: \"source.json5\",\n    path: \"json5.tmLanguage.json\",\n    displayName: \"JSON5\",\n    samplePath: \"json5.sample\"\n  },\n  {\n    id: \"jsonc\",\n    scopeName: \"source.json.comments\",\n    path: \"jsonc.tmLanguage.json\",\n    displayName: \"JSON with Comments\"\n  },\n  {\n    id: \"jsonl\",\n    scopeName: \"source.json.lines\",\n    path: \"jsonl.tmLanguage.json\",\n    displayName: \"JSON Lines\"\n  },\n  {\n    id: \"jsonnet\",\n    scopeName: \"source.jsonnet\",\n    path: \"jsonnet.tmLanguage.json\",\n    displayName: \"Jsonnet\"\n  },\n  {\n    id: \"jssm\",\n    scopeName: \"source.jssm\",\n    path: \"jssm.tmLanguage.json\",\n    displayName: \"JSSM\",\n    samplePath: \"jssm.sample\",\n    aliases: [\"fsl\"]\n  },\n  {\n    id: \"jsx\",\n    scopeName: \"source.js.jsx\",\n    path: \"jsx.tmLanguage.json\",\n    displayName: \"JSX\"\n  },\n  {\n    id: \"julia\",\n    scopeName: \"source.julia\",\n    path: \"julia.tmLanguage.json\",\n    displayName: \"Julia\",\n    embeddedLangs: [\"cpp\", \"python\", \"javascript\", \"r\", \"sql\"]\n  },\n  {\n    id: \"kotlin\",\n    scopeName: \"source.kotlin\",\n    path: \"kotlin.tmLanguage.json\",\n    displayName: \"Kotlin\",\n    samplePath: \"kotlin.sample\"\n  },\n  {\n    id: \"kusto\",\n    scopeName: \"source.kusto\",\n    path: \"kusto.tmLanguage.json\",\n    displayName: \"Kusto\",\n    samplePath: \"kusto.sample\",\n    aliases: [\"kql\"]\n  },\n  {\n    id: \"latex\",\n    scopeName: \"text.tex.latex\",\n    path: \"latex.tmLanguage.json\",\n    displayName: \"LaTeX\",\n    embeddedLangs: [\"tex\", \"css\", \"haskell\", \"html\", \"xml\", \"java\", \"lua\", \"julia\", \"ruby\", \"javascript\", \"typescript\", \"python\", \"yaml\", \"rust\", \"scala\", \"gnuplot\"]\n  },\n  {\n    id: \"less\",\n    scopeName: \"source.css.less\",\n    path: \"less.tmLanguage.json\",\n    displayName: \"Less\",\n    embeddedLangs: [\"css\"]\n  },\n  {\n    id: \"liquid\",\n    scopeName: \"text.html.liquid\",\n    path: \"liquid.tmLanguage.json\",\n    displayName: \"Liquid\",\n    samplePath: \"liquid.sample\",\n    embeddedLangs: [\"html\", \"css\", \"json\", \"javascript\"]\n  },\n  {\n    id: \"lisp\",\n    scopeName: \"source.lisp\",\n    path: \"lisp.tmLanguage.json\",\n    displayName: \"Lisp\"\n  },\n  {\n    id: \"logo\",\n    scopeName: \"source.logo\",\n    path: \"logo.tmLanguage.json\",\n    displayName: \"Logo\"\n  },\n  {\n    id: \"lua\",\n    scopeName: \"source.lua\",\n    path: \"lua.tmLanguage.json\",\n    displayName: \"Lua\",\n    embeddedLangs: [\"c\"]\n  },\n  {\n    id: \"make\",\n    scopeName: \"source.makefile\",\n    path: \"make.tmLanguage.json\",\n    displayName: \"Makefile\",\n    aliases: [\"makefile\"]\n  },\n  {\n    id: \"markdown\",\n    scopeName: \"text.html.markdown\",\n    path: \"markdown.tmLanguage.json\",\n    displayName: \"Markdown\",\n    aliases: [\"md\"],\n    embeddedLangs: [\"css\", \"html\", \"ini\", \"java\", \"lua\", \"make\", \"perl\", \"r\", \"ruby\", \"php\", \"sql\", \"vb\", \"xml\", \"xsl\", \"yaml\", \"bat\", \"clojure\", \"coffee\", \"c\", \"cpp\", \"diff\", \"docker\", \"git-commit\", \"git-rebase\", \"go\", \"groovy\", \"pug\", \"javascript\", \"json\", \"jsonc\", \"less\", \"objective-c\", \"swift\", \"scss\", \"raku\", \"powershell\", \"python\", \"julia\", \"rust\", \"scala\", \"shellscript\", \"typescript\", \"tsx\", \"csharp\", \"fsharp\", \"dart\", \"handlebars\", \"erlang\", \"elixir\", \"latex\", \"bibtex\"]\n  },\n  {\n    id: \"marko\",\n    scopeName: \"text.marko\",\n    path: \"marko.tmLanguage.json\",\n    displayName: \"Marko\",\n    embeddedLangs: [\"css\", \"less\", \"scss\", \"javascript\"]\n  },\n  {\n    id: \"matlab\",\n    scopeName: \"source.matlab\",\n    path: \"matlab.tmLanguage.json\",\n    displayName: \"MATLAB\"\n  },\n  {\n    id: \"mdx\",\n    scopeName: \"source.mdx\",\n    path: \"mdx.tmLanguage.json\",\n    displayName: \"MDX\",\n    embeddedLangs: [\"tsx\", \"toml\", \"yaml\", \"c\", \"clojure\", \"coffee\", \"cpp\", \"csharp\", \"css\", \"diff\", \"docker\", \"elixir\", \"elm\", \"erlang\", \"go\", \"graphql\", \"haskell\", \"html\", \"ini\", \"java\", \"javascript\", \"json\", \"julia\", \"kotlin\", \"less\", \"lua\", \"make\", \"markdown\", \"objective-c\", \"perl\", \"python\", \"r\", \"ruby\", \"rust\", \"scala\", \"scss\", \"shellscript\", \"sql\", \"xml\", \"swift\", \"typescript\"]\n  },\n  {\n    id: \"mermaid\",\n    scopeName: \"source.mermaid\",\n    path: \"mermaid.tmLanguage.json\",\n    displayName: \"Mermaid\"\n  },\n  {\n    id: \"narrat\",\n    scopeName: \"source.narrat\",\n    path: \"narrat.tmLanguage.json\",\n    displayName: \"Narrat Language\",\n    samplePath: \"narrat.sample\",\n    aliases: [\"nar\"]\n  },\n  {\n    id: \"nextflow\",\n    scopeName: \"source.nextflow\",\n    path: \"nextflow.tmLanguage.json\",\n    displayName: \"Nextflow\",\n    samplePath: \"nextflow.sample\",\n    aliases: [\"nf\"]\n  },\n  {\n    id: \"nginx\",\n    scopeName: \"source.nginx\",\n    path: \"nginx.tmLanguage.json\",\n    displayName: \"Nginx\",\n    embeddedLangs: [\"lua\"]\n  },\n  {\n    id: \"nim\",\n    scopeName: \"source.nim\",\n    path: \"nim.tmLanguage.json\",\n    displayName: \"Nim\",\n    embeddedLangs: [\"c\", \"html\", \"xml\", \"javascript\", \"css\", \"glsl\", \"markdown\"]\n  },\n  {\n    id: \"nix\",\n    scopeName: \"source.nix\",\n    path: \"nix.tmLanguage.json\",\n    displayName: \"Nix\"\n  },\n  {\n    id: \"objective-c\",\n    scopeName: \"source.objc\",\n    path: \"objective-c.tmLanguage.json\",\n    displayName: \"Objective-C\",\n    aliases: [\"objc\"]\n  },\n  {\n    id: \"objective-cpp\",\n    scopeName: \"source.objcpp\",\n    path: \"objective-cpp.tmLanguage.json\",\n    displayName: \"Objective-C++\"\n  },\n  {\n    id: \"ocaml\",\n    scopeName: \"source.ocaml\",\n    path: \"ocaml.tmLanguage.json\",\n    displayName: \"OCaml\"\n  },\n  {\n    id: \"pascal\",\n    scopeName: \"source.pascal\",\n    path: \"pascal.tmLanguage.json\",\n    displayName: \"Pascal\"\n  },\n  {\n    id: \"perl\",\n    scopeName: \"source.perl\",\n    path: \"perl.tmLanguage.json\",\n    displayName: \"Perl\",\n    embeddedLangs: [\"html\", \"xml\", \"css\", \"javascript\", \"sql\"]\n  },\n  {\n    id: \"php\",\n    scopeName: \"source.php\",\n    path: \"php.tmLanguage.json\",\n    displayName: \"PHP\",\n    embeddedLangs: [\"html\", \"xml\", \"sql\", \"javascript\", \"json\", \"css\"]\n  },\n  {\n    id: \"plsql\",\n    scopeName: \"source.plsql.oracle\",\n    path: \"plsql.tmLanguage.json\",\n    displayName: \"PL/SQL\"\n  },\n  {\n    id: \"postcss\",\n    scopeName: \"source.css.postcss\",\n    path: \"postcss.tmLanguage.json\",\n    displayName: \"PostCSS\"\n  },\n  {\n    id: \"powerquery\",\n    scopeName: \"source.powerquery\",\n    path: \"powerquery.tmLanguage.json\",\n    displayName: \"PowerQuery\",\n    samplePath: \"powerquery.sample\"\n  },\n  {\n    id: \"powershell\",\n    scopeName: \"source.powershell\",\n    path: \"powershell.tmLanguage.json\",\n    displayName: \"PowerShell\",\n    aliases: [\"ps\", \"ps1\"]\n  },\n  {\n    id: \"prisma\",\n    scopeName: \"source.prisma\",\n    path: \"prisma.tmLanguage.json\",\n    displayName: \"Prisma\",\n    samplePath: \"prisma.sample\"\n  },\n  {\n    id: \"prolog\",\n    scopeName: \"source.prolog\",\n    path: \"prolog.tmLanguage.json\",\n    displayName: \"Prolog\"\n  },\n  {\n    id: \"proto\",\n    scopeName: \"source.proto\",\n    path: \"proto.tmLanguage.json\",\n    displayName: \"Protocol Buffer 3\",\n    samplePath: \"proto.sample\"\n  },\n  {\n    id: \"pug\",\n    scopeName: \"text.pug\",\n    path: \"pug.tmLanguage.json\",\n    displayName: \"Pug\",\n    aliases: [\"jade\"],\n    embeddedLangs: [\"javascript\", \"css\", \"sass\", \"scss\", \"stylus\", \"coffee\", \"html\"]\n  },\n  {\n    id: \"puppet\",\n    scopeName: \"source.puppet\",\n    path: \"puppet.tmLanguage.json\",\n    displayName: \"Puppet\"\n  },\n  {\n    id: \"purescript\",\n    scopeName: \"source.purescript\",\n    path: \"purescript.tmLanguage.json\",\n    displayName: \"PureScript\"\n  },\n  {\n    id: \"python\",\n    scopeName: \"source.python\",\n    path: \"python.tmLanguage.json\",\n    displayName: \"Python\",\n    samplePath: \"python.sample\",\n    aliases: [\"py\"]\n  },\n  {\n    id: \"r\",\n    scopeName: \"source.r\",\n    path: \"r.tmLanguage.json\",\n    displayName: \"R\"\n  },\n  {\n    id: \"raku\",\n    scopeName: \"source.perl.6\",\n    path: \"raku.tmLanguage.json\",\n    displayName: \"Perl 6\",\n    aliases: [\"perl6\"]\n  },\n  {\n    id: \"razor\",\n    scopeName: \"text.aspnetcorerazor\",\n    path: \"razor.tmLanguage.json\",\n    displayName: \"ASP.NET Razor\",\n    embeddedLangs: [\"html\", \"csharp\"]\n  },\n  {\n    id: \"reg\",\n    scopeName: \"source.reg\",\n    path: \"reg.tmLanguage.json\",\n    displayName: \"Windows Registry Script\",\n    samplePath: \"reg.sample\"\n  },\n  {\n    id: \"rel\",\n    scopeName: \"source.rel\",\n    path: \"rel.tmLanguage.json\",\n    displayName: \"Rel\",\n    samplePath: \"rel.sample\"\n  },\n  {\n    id: \"riscv\",\n    scopeName: \"source.riscv\",\n    path: \"riscv.tmLanguage.json\",\n    displayName: \"RISC-V\"\n  },\n  {\n    id: \"rst\",\n    scopeName: \"source.rst\",\n    path: \"rst.tmLanguage.json\",\n    displayName: \"reStructuredText\",\n    embeddedLangs: [\"cpp\", \"python\", \"javascript\", \"shellscript\", \"yaml\", \"cmake\", \"ruby\"]\n  },\n  {\n    id: \"ruby\",\n    scopeName: \"source.ruby\",\n    path: \"ruby.tmLanguage.json\",\n    displayName: \"Ruby\",\n    samplePath: \"ruby.sample\",\n    aliases: [\"rb\"],\n    embeddedLangs: [\"html\", \"xml\", \"sql\", \"css\", \"c\", \"javascript\", \"shellscript\", \"lua\"]\n  },\n  {\n    id: \"rust\",\n    scopeName: \"source.rust\",\n    path: \"rust.tmLanguage.json\",\n    displayName: \"Rust\",\n    aliases: [\"rs\"]\n  },\n  {\n    id: \"sas\",\n    scopeName: \"source.sas\",\n    path: \"sas.tmLanguage.json\",\n    displayName: \"SAS\",\n    embeddedLangs: [\"sql\"]\n  },\n  {\n    id: \"sass\",\n    scopeName: \"source.sass\",\n    path: \"sass.tmLanguage.json\",\n    displayName: \"Sass\"\n  },\n  {\n    id: \"scala\",\n    scopeName: \"source.scala\",\n    path: \"scala.tmLanguage.json\",\n    displayName: \"Scala\"\n  },\n  {\n    id: \"scheme\",\n    scopeName: \"source.scheme\",\n    path: \"scheme.tmLanguage.json\",\n    displayName: \"Scheme\"\n  },\n  {\n    id: \"scss\",\n    scopeName: \"source.css.scss\",\n    path: \"scss.tmLanguage.json\",\n    displayName: \"SCSS\",\n    embeddedLangs: [\"css\"]\n  },\n  {\n    id: \"shaderlab\",\n    scopeName: \"source.shaderlab\",\n    path: \"shaderlab.tmLanguage.json\",\n    displayName: \"ShaderLab\",\n    aliases: [\"shader\"],\n    embeddedLangs: [\"hlsl\"]\n  },\n  {\n    id: \"shellscript\",\n    scopeName: \"source.shell\",\n    path: \"shellscript.tmLanguage.json\",\n    displayName: \"Shell\",\n    aliases: [\"bash\", \"console\", \"sh\", \"shell\", \"zsh\"]\n  },\n  {\n    id: \"smalltalk\",\n    scopeName: \"source.smalltalk\",\n    path: \"smalltalk.tmLanguage.json\",\n    displayName: \"Smalltalk\"\n  },\n  {\n    id: \"solidity\",\n    scopeName: \"source.solidity\",\n    path: \"solidity.tmLanguage.json\",\n    displayName: \"Solidity\"\n  },\n  {\n    id: \"sparql\",\n    scopeName: \"source.sparql\",\n    path: \"sparql.tmLanguage.json\",\n    displayName: \"SPARQL\",\n    samplePath: \"sparql.sample\",\n    embeddedLangs: [\"turtle\"]\n  },\n  {\n    id: \"sql\",\n    scopeName: \"source.sql\",\n    path: \"sql.tmLanguage.json\",\n    displayName: \"SQL\"\n  },\n  {\n    id: \"ssh-config\",\n    scopeName: \"source.ssh-config\",\n    path: \"ssh-config.tmLanguage.json\",\n    displayName: \"SSH Config\"\n  },\n  {\n    id: \"stata\",\n    scopeName: \"source.stata\",\n    path: \"stata.tmLanguage.json\",\n    displayName: \"Stata\",\n    samplePath: \"stata.sample\",\n    embeddedLangs: [\"sql\"]\n  },\n  {\n    id: \"stylus\",\n    scopeName: \"source.stylus\",\n    path: \"stylus.tmLanguage.json\",\n    displayName: \"Stylus\",\n    aliases: [\"styl\"]\n  },\n  {\n    id: \"svelte\",\n    scopeName: \"source.svelte\",\n    path: \"svelte.tmLanguage.json\",\n    displayName: \"Svelte\",\n    embeddedLangs: [\"javascript\", \"typescript\", \"coffee\", \"stylus\", \"sass\", \"css\", \"scss\", \"less\", \"postcss\", \"pug\", \"markdown\"]\n  },\n  {\n    id: \"swift\",\n    scopeName: \"source.swift\",\n    path: \"swift.tmLanguage.json\",\n    displayName: \"Swift\"\n  },\n  {\n    id: \"system-verilog\",\n    scopeName: \"source.systemverilog\",\n    path: \"system-verilog.tmLanguage.json\",\n    displayName: \"SystemVerilog\"\n  },\n  {\n    id: \"tasl\",\n    scopeName: \"source.tasl\",\n    path: \"tasl.tmLanguage.json\",\n    displayName: \"Tasl\",\n    samplePath: \"tasl.sample\"\n  },\n  {\n    id: \"tcl\",\n    scopeName: \"source.tcl\",\n    path: \"tcl.tmLanguage.json\",\n    displayName: \"Tcl\"\n  },\n  {\n    id: \"tex\",\n    scopeName: \"text.tex\",\n    path: \"tex.tmLanguage.json\",\n    displayName: \"TeX\",\n    embeddedLangs: [\"r\"]\n  },\n  {\n    id: \"toml\",\n    scopeName: \"source.toml\",\n    path: \"toml.tmLanguage.json\",\n    displayName: \"TOML\"\n  },\n  {\n    id: \"tsx\",\n    scopeName: \"source.tsx\",\n    path: \"tsx.tmLanguage.json\",\n    displayName: \"TSX\",\n    samplePath: \"tsx.sample\"\n  },\n  {\n    id: \"turtle\",\n    scopeName: \"source.turtle\",\n    path: \"turtle.tmLanguage.json\",\n    displayName: \"Turtle\",\n    samplePath: \"turtle.sample\"\n  },\n  {\n    id: \"twig\",\n    scopeName: \"text.html.twig\",\n    path: \"twig.tmLanguage.json\",\n    displayName: \"Twig\",\n    embeddedLangs: [\"css\", \"javascript\", \"php\", \"python\", \"ruby\"]\n  },\n  {\n    id: \"typescript\",\n    scopeName: \"source.ts\",\n    path: \"typescript.tmLanguage.json\",\n    displayName: \"TypeScript\",\n    aliases: [\"ts\"]\n  },\n  {\n    id: \"v\",\n    scopeName: \"source.v\",\n    path: \"v.tmLanguage.json\",\n    displayName: \"V\",\n    samplePath: \"v.sample\"\n  },\n  {\n    id: \"vb\",\n    scopeName: \"source.asp.vb.net\",\n    path: \"vb.tmLanguage.json\",\n    displayName: \"Visual Basic\",\n    aliases: [\"cmd\"]\n  },\n  {\n    id: \"verilog\",\n    scopeName: \"source.verilog\",\n    path: \"verilog.tmLanguage.json\",\n    displayName: \"Verilog\"\n  },\n  {\n    id: \"vhdl\",\n    scopeName: \"source.vhdl\",\n    path: \"vhdl.tmLanguage.json\",\n    displayName: \"VHDL\"\n  },\n  {\n    id: \"viml\",\n    scopeName: \"source.viml\",\n    path: \"viml.tmLanguage.json\",\n    displayName: \"Vim Script\",\n    aliases: [\"vim\", \"vimscript\"]\n  },\n  {\n    id: \"vue-html\",\n    scopeName: \"text.html.vue-html\",\n    path: \"vue-html.tmLanguage.json\",\n    displayName: \"Vue HTML\",\n    embeddedLangs: [\"vue\", \"javascript\"]\n  },\n  {\n    id: \"vue\",\n    scopeName: \"source.vue\",\n    path: \"vue.tmLanguage.json\",\n    displayName: \"Vue\",\n    embeddedLangs: [\"html\", \"markdown\", \"pug\", \"stylus\", \"sass\", \"css\", \"scss\", \"less\", \"javascript\", \"typescript\", \"jsx\", \"tsx\", \"json\", \"jsonc\", \"json5\", \"yaml\", \"toml\", \"graphql\"]\n  },\n  {\n    id: \"vyper\",\n    scopeName: \"source.vyper\",\n    path: \"vyper.tmLanguage.json\",\n    displayName: \"Vyper\",\n    samplePath: \"vyper.sample\",\n    aliases: [\"vy\"]\n  },\n  {\n    id: \"wasm\",\n    scopeName: \"source.wat\",\n    path: \"wasm.tmLanguage.json\",\n    displayName: \"WebAssembly\"\n  },\n  {\n    id: \"wenyan\",\n    scopeName: \"source.wenyan\",\n    path: \"wenyan.tmLanguage.json\",\n    displayName: \"Wenyan\",\n    aliases: [\"\\u6587\\u8A00\"]\n  },\n  {\n    id: \"wgsl\",\n    scopeName: \"source.wgsl\",\n    path: \"wgsl.tmLanguage.json\",\n    displayName: \"WGSL\",\n    samplePath: \"wgsl.sample\"\n  },\n  {\n    id: \"wolfram\",\n    scopeName: \"source.wolfram\",\n    path: \"wolfram.tmLanguage.json\",\n    displayName: \"Wolfram\",\n    samplePath: \"wolfram.sample\"\n  },\n  {\n    id: \"xml\",\n    scopeName: \"text.xml\",\n    path: \"xml.tmLanguage.json\",\n    displayName: \"XML\",\n    embeddedLangs: [\"java\"]\n  },\n  {\n    id: \"xsl\",\n    scopeName: \"text.xml.xsl\",\n    path: \"xsl.tmLanguage.json\",\n    displayName: \"XSL\",\n    embeddedLangs: [\"xml\"]\n  },\n  {\n    id: \"yaml\",\n    scopeName: \"source.yaml\",\n    path: \"yaml.tmLanguage.json\",\n    displayName: \"YAML\",\n    aliases: [\"yml\"]\n  },\n  {\n    id: \"zenscript\",\n    scopeName: \"source.zenscript\",\n    path: \"zenscript.tmLanguage.json\",\n    displayName: \"ZenScript\",\n    samplePath: \"zenscript.sample\"\n  }\n];\n\nvar FontStyle = /* @__PURE__ */ ((FontStyle2) => {\n  FontStyle2[FontStyle2[\"NotSet\"] = -1] = \"NotSet\";\n  FontStyle2[FontStyle2[\"None\"] = 0] = \"None\";\n  FontStyle2[FontStyle2[\"Italic\"] = 1] = \"Italic\";\n  FontStyle2[FontStyle2[\"Bold\"] = 2] = \"Bold\";\n  FontStyle2[FontStyle2[\"Underline\"] = 4] = \"Underline\";\n  return FontStyle2;\n})(FontStyle || {});\nclass StackElementMetadata {\n  static toBinaryStr(metadata) {\n    let r = metadata.toString(2);\n    while (r.length < 32) {\n      r = \"0\" + r;\n    }\n    return r;\n  }\n  static printMetadata(metadata) {\n    let languageId = StackElementMetadata.getLanguageId(metadata);\n    let tokenType = StackElementMetadata.getTokenType(metadata);\n    let fontStyle = StackElementMetadata.getFontStyle(metadata);\n    let foreground = StackElementMetadata.getForeground(metadata);\n    let background = StackElementMetadata.getBackground(metadata);\n    console.log({\n      languageId,\n      tokenType,\n      fontStyle,\n      foreground,\n      background\n    });\n  }\n  static getLanguageId(metadata) {\n    return (metadata & 255 /* LANGUAGEID_MASK */) >>> 0 /* LANGUAGEID_OFFSET */;\n  }\n  static getTokenType(metadata) {\n    return (metadata & 768 /* TOKEN_TYPE_MASK */) >>> 8 /* TOKEN_TYPE_OFFSET */;\n  }\n  static getFontStyle(metadata) {\n    return (metadata & 14336 /* FONT_STYLE_MASK */) >>> 11 /* FONT_STYLE_OFFSET */;\n  }\n  static getForeground(metadata) {\n    return (metadata & 8372224 /* FOREGROUND_MASK */) >>> 15 /* FOREGROUND_OFFSET */;\n  }\n  static getBackground(metadata) {\n    return (metadata & 4286578688 /* BACKGROUND_MASK */) >>> 24 /* BACKGROUND_OFFSET */;\n  }\n  static containsBalancedBrackets(metadata) {\n    return (metadata & 1024 /* BALANCED_BRACKETS_MASK */) !== 0;\n  }\n  static set(metadata, languageId, tokenType, fontStyle, foreground, background) {\n    let _languageId = StackElementMetadata.getLanguageId(metadata);\n    let _tokenType = StackElementMetadata.getTokenType(metadata);\n    let _fontStyle = StackElementMetadata.getFontStyle(metadata);\n    let _foreground = StackElementMetadata.getForeground(metadata);\n    let _background = StackElementMetadata.getBackground(metadata);\n    let _containsBalancedBracketsBit = StackElementMetadata.containsBalancedBrackets(\n      metadata\n    ) ? 1 : 0;\n    if (languageId !== 0) {\n      _languageId = languageId;\n    }\n    if (tokenType !== 0 /* Other */) {\n      _tokenType = tokenType === 8 /* MetaEmbedded */ ? 0 /* Other */ : tokenType;\n    }\n    if (fontStyle !== -1 /* NotSet */) {\n      _fontStyle = fontStyle;\n    }\n    if (foreground !== 0) {\n      _foreground = foreground;\n    }\n    if (background !== 0) {\n      _background = background;\n    }\n    return (_languageId << 0 /* LANGUAGEID_OFFSET */ | _tokenType << 8 /* TOKEN_TYPE_OFFSET */ | _fontStyle << 11 /* FONT_STYLE_OFFSET */ | _containsBalancedBracketsBit << 10 /* BALANCED_BRACKETS_OFFSET */ | _foreground << 15 /* FOREGROUND_OFFSET */ | _background << 24 /* BACKGROUND_OFFSET */) >>> 0;\n  }\n}\n\nfunction trimEndSlash(str) {\n  if (str.endsWith(\"/\") || str.endsWith(\"\\\\\"))\n    return str.slice(0, -1);\n  return str;\n}\nfunction trimStartDot(str) {\n  if (str.startsWith(\"./\"))\n    return str.slice(2);\n  return str;\n}\nfunction dirpathparts(str) {\n  const parts = str.split(/[\\/\\\\]/g);\n  return parts.slice(0, parts.length - 1);\n}\nfunction join(...parts) {\n  return parts.map(trimEndSlash).map(trimStartDot).join(\"/\");\n}\nfunction groupBy(elements, keyGetter) {\n  const map = /* @__PURE__ */ new Map();\n  for (const element of elements) {\n    const key = keyGetter(element);\n    if (map.has(key)) {\n      const group = map.get(key);\n      group.push(element);\n    } else {\n      map.set(key, [element]);\n    }\n  }\n  return map;\n}\n\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n/**\n * Creates a JSON scanner on the given text.\n * If ignoreTrivia is set, whitespaces or comments are ignored.\n */\nfunction createScanner(text, ignoreTrivia = false) {\n    const len = text.length;\n    let pos = 0, value = '', tokenOffset = 0, token = 16 /* SyntaxKind.Unknown */, lineNumber = 0, lineStartOffset = 0, tokenLineStartOffset = 0, prevTokenLineStartOffset = 0, scanError = 0 /* ScanError.None */;\n    function scanHexDigits(count, exact) {\n        let digits = 0;\n        let value = 0;\n        while (digits < count || !exact) {\n            let ch = text.charCodeAt(pos);\n            if (ch >= 48 /* CharacterCodes._0 */ && ch <= 57 /* CharacterCodes._9 */) {\n                value = value * 16 + ch - 48 /* CharacterCodes._0 */;\n            }\n            else if (ch >= 65 /* CharacterCodes.A */ && ch <= 70 /* CharacterCodes.F */) {\n                value = value * 16 + ch - 65 /* CharacterCodes.A */ + 10;\n            }\n            else if (ch >= 97 /* CharacterCodes.a */ && ch <= 102 /* CharacterCodes.f */) {\n                value = value * 16 + ch - 97 /* CharacterCodes.a */ + 10;\n            }\n            else {\n                break;\n            }\n            pos++;\n            digits++;\n        }\n        if (digits < count) {\n            value = -1;\n        }\n        return value;\n    }\n    function setPosition(newPosition) {\n        pos = newPosition;\n        value = '';\n        tokenOffset = 0;\n        token = 16 /* SyntaxKind.Unknown */;\n        scanError = 0 /* ScanError.None */;\n    }\n    function scanNumber() {\n        let start = pos;\n        if (text.charCodeAt(pos) === 48 /* CharacterCodes._0 */) {\n            pos++;\n        }\n        else {\n            pos++;\n            while (pos < text.length && isDigit(text.charCodeAt(pos))) {\n                pos++;\n            }\n        }\n        if (pos < text.length && text.charCodeAt(pos) === 46 /* CharacterCodes.dot */) {\n            pos++;\n            if (pos < text.length && isDigit(text.charCodeAt(pos))) {\n                pos++;\n                while (pos < text.length && isDigit(text.charCodeAt(pos))) {\n                    pos++;\n                }\n            }\n            else {\n                scanError = 3 /* ScanError.UnexpectedEndOfNumber */;\n                return text.substring(start, pos);\n            }\n        }\n        let end = pos;\n        if (pos < text.length && (text.charCodeAt(pos) === 69 /* CharacterCodes.E */ || text.charCodeAt(pos) === 101 /* CharacterCodes.e */)) {\n            pos++;\n            if (pos < text.length && text.charCodeAt(pos) === 43 /* CharacterCodes.plus */ || text.charCodeAt(pos) === 45 /* CharacterCodes.minus */) {\n                pos++;\n            }\n            if (pos < text.length && isDigit(text.charCodeAt(pos))) {\n                pos++;\n                while (pos < text.length && isDigit(text.charCodeAt(pos))) {\n                    pos++;\n                }\n                end = pos;\n            }\n            else {\n                scanError = 3 /* ScanError.UnexpectedEndOfNumber */;\n            }\n        }\n        return text.substring(start, end);\n    }\n    function scanString() {\n        let result = '', start = pos;\n        while (true) {\n            if (pos >= len) {\n                result += text.substring(start, pos);\n                scanError = 2 /* ScanError.UnexpectedEndOfString */;\n                break;\n            }\n            const ch = text.charCodeAt(pos);\n            if (ch === 34 /* CharacterCodes.doubleQuote */) {\n                result += text.substring(start, pos);\n                pos++;\n                break;\n            }\n            if (ch === 92 /* CharacterCodes.backslash */) {\n                result += text.substring(start, pos);\n                pos++;\n                if (pos >= len) {\n                    scanError = 2 /* ScanError.UnexpectedEndOfString */;\n                    break;\n                }\n                const ch2 = text.charCodeAt(pos++);\n                switch (ch2) {\n                    case 34 /* CharacterCodes.doubleQuote */:\n                        result += '\\\"';\n                        break;\n                    case 92 /* CharacterCodes.backslash */:\n                        result += '\\\\';\n                        break;\n                    case 47 /* CharacterCodes.slash */:\n                        result += '/';\n                        break;\n                    case 98 /* CharacterCodes.b */:\n                        result += '\\b';\n                        break;\n                    case 102 /* CharacterCodes.f */:\n                        result += '\\f';\n                        break;\n                    case 110 /* CharacterCodes.n */:\n                        result += '\\n';\n                        break;\n                    case 114 /* CharacterCodes.r */:\n                        result += '\\r';\n                        break;\n                    case 116 /* CharacterCodes.t */:\n                        result += '\\t';\n                        break;\n                    case 117 /* CharacterCodes.u */:\n                        const ch3 = scanHexDigits(4, true);\n                        if (ch3 >= 0) {\n                            result += String.fromCharCode(ch3);\n                        }\n                        else {\n                            scanError = 4 /* ScanError.InvalidUnicode */;\n                        }\n                        break;\n                    default:\n                        scanError = 5 /* ScanError.InvalidEscapeCharacter */;\n                }\n                start = pos;\n                continue;\n            }\n            if (ch >= 0 && ch <= 0x1f) {\n                if (isLineBreak(ch)) {\n                    result += text.substring(start, pos);\n                    scanError = 2 /* ScanError.UnexpectedEndOfString */;\n                    break;\n                }\n                else {\n                    scanError = 6 /* ScanError.InvalidCharacter */;\n                    // mark as error but continue with string\n                }\n            }\n            pos++;\n        }\n        return result;\n    }\n    function scanNext() {\n        value = '';\n        scanError = 0 /* ScanError.None */;\n        tokenOffset = pos;\n        lineStartOffset = lineNumber;\n        prevTokenLineStartOffset = tokenLineStartOffset;\n        if (pos >= len) {\n            // at the end\n            tokenOffset = len;\n            return token = 17 /* SyntaxKind.EOF */;\n        }\n        let code = text.charCodeAt(pos);\n        // trivia: whitespace\n        if (isWhiteSpace(code)) {\n            do {\n                pos++;\n                value += String.fromCharCode(code);\n                code = text.charCodeAt(pos);\n            } while (isWhiteSpace(code));\n            return token = 15 /* SyntaxKind.Trivia */;\n        }\n        // trivia: newlines\n        if (isLineBreak(code)) {\n            pos++;\n            value += String.fromCharCode(code);\n            if (code === 13 /* CharacterCodes.carriageReturn */ && text.charCodeAt(pos) === 10 /* CharacterCodes.lineFeed */) {\n                pos++;\n                value += '\\n';\n            }\n            lineNumber++;\n            tokenLineStartOffset = pos;\n            return token = 14 /* SyntaxKind.LineBreakTrivia */;\n        }\n        switch (code) {\n            // tokens: []{}:,\n            case 123 /* CharacterCodes.openBrace */:\n                pos++;\n                return token = 1 /* SyntaxKind.OpenBraceToken */;\n            case 125 /* CharacterCodes.closeBrace */:\n                pos++;\n                return token = 2 /* SyntaxKind.CloseBraceToken */;\n            case 91 /* CharacterCodes.openBracket */:\n                pos++;\n                return token = 3 /* SyntaxKind.OpenBracketToken */;\n            case 93 /* CharacterCodes.closeBracket */:\n                pos++;\n                return token = 4 /* SyntaxKind.CloseBracketToken */;\n            case 58 /* CharacterCodes.colon */:\n                pos++;\n                return token = 6 /* SyntaxKind.ColonToken */;\n            case 44 /* CharacterCodes.comma */:\n                pos++;\n                return token = 5 /* SyntaxKind.CommaToken */;\n            // strings\n            case 34 /* CharacterCodes.doubleQuote */:\n                pos++;\n                value = scanString();\n                return token = 10 /* SyntaxKind.StringLiteral */;\n            // comments\n            case 47 /* CharacterCodes.slash */:\n                const start = pos - 1;\n                // Single-line comment\n                if (text.charCodeAt(pos + 1) === 47 /* CharacterCodes.slash */) {\n                    pos += 2;\n                    while (pos < len) {\n                        if (isLineBreak(text.charCodeAt(pos))) {\n                            break;\n                        }\n                        pos++;\n                    }\n                    value = text.substring(start, pos);\n                    return token = 12 /* SyntaxKind.LineCommentTrivia */;\n                }\n                // Multi-line comment\n                if (text.charCodeAt(pos + 1) === 42 /* CharacterCodes.asterisk */) {\n                    pos += 2;\n                    const safeLength = len - 1; // For lookahead.\n                    let commentClosed = false;\n                    while (pos < safeLength) {\n                        const ch = text.charCodeAt(pos);\n                        if (ch === 42 /* CharacterCodes.asterisk */ && text.charCodeAt(pos + 1) === 47 /* CharacterCodes.slash */) {\n                            pos += 2;\n                            commentClosed = true;\n                            break;\n                        }\n                        pos++;\n                        if (isLineBreak(ch)) {\n                            if (ch === 13 /* CharacterCodes.carriageReturn */ && text.charCodeAt(pos) === 10 /* CharacterCodes.lineFeed */) {\n                                pos++;\n                            }\n                            lineNumber++;\n                            tokenLineStartOffset = pos;\n                        }\n                    }\n                    if (!commentClosed) {\n                        pos++;\n                        scanError = 1 /* ScanError.UnexpectedEndOfComment */;\n                    }\n                    value = text.substring(start, pos);\n                    return token = 13 /* SyntaxKind.BlockCommentTrivia */;\n                }\n                // just a single slash\n                value += String.fromCharCode(code);\n                pos++;\n                return token = 16 /* SyntaxKind.Unknown */;\n            // numbers\n            case 45 /* CharacterCodes.minus */:\n                value += String.fromCharCode(code);\n                pos++;\n                if (pos === len || !isDigit(text.charCodeAt(pos))) {\n                    return token = 16 /* SyntaxKind.Unknown */;\n                }\n            // found a minus, followed by a number so\n            // we fall through to proceed with scanning\n            // numbers\n            case 48 /* CharacterCodes._0 */:\n            case 49 /* CharacterCodes._1 */:\n            case 50 /* CharacterCodes._2 */:\n            case 51 /* CharacterCodes._3 */:\n            case 52 /* CharacterCodes._4 */:\n            case 53 /* CharacterCodes._5 */:\n            case 54 /* CharacterCodes._6 */:\n            case 55 /* CharacterCodes._7 */:\n            case 56 /* CharacterCodes._8 */:\n            case 57 /* CharacterCodes._9 */:\n                value += scanNumber();\n                return token = 11 /* SyntaxKind.NumericLiteral */;\n            // literals and unknown symbols\n            default:\n                // is a literal? Read the full word.\n                while (pos < len && isUnknownContentCharacter(code)) {\n                    pos++;\n                    code = text.charCodeAt(pos);\n                }\n                if (tokenOffset !== pos) {\n                    value = text.substring(tokenOffset, pos);\n                    // keywords: true, false, null\n                    switch (value) {\n                        case 'true': return token = 8 /* SyntaxKind.TrueKeyword */;\n                        case 'false': return token = 9 /* SyntaxKind.FalseKeyword */;\n                        case 'null': return token = 7 /* SyntaxKind.NullKeyword */;\n                    }\n                    return token = 16 /* SyntaxKind.Unknown */;\n                }\n                // some\n                value += String.fromCharCode(code);\n                pos++;\n                return token = 16 /* SyntaxKind.Unknown */;\n        }\n    }\n    function isUnknownContentCharacter(code) {\n        if (isWhiteSpace(code) || isLineBreak(code)) {\n            return false;\n        }\n        switch (code) {\n            case 125 /* CharacterCodes.closeBrace */:\n            case 93 /* CharacterCodes.closeBracket */:\n            case 123 /* CharacterCodes.openBrace */:\n            case 91 /* CharacterCodes.openBracket */:\n            case 34 /* CharacterCodes.doubleQuote */:\n            case 58 /* CharacterCodes.colon */:\n            case 44 /* CharacterCodes.comma */:\n            case 47 /* CharacterCodes.slash */:\n                return false;\n        }\n        return true;\n    }\n    function scanNextNonTrivia() {\n        let result;\n        do {\n            result = scanNext();\n        } while (result >= 12 /* SyntaxKind.LineCommentTrivia */ && result <= 15 /* SyntaxKind.Trivia */);\n        return result;\n    }\n    return {\n        setPosition: setPosition,\n        getPosition: () => pos,\n        scan: ignoreTrivia ? scanNextNonTrivia : scanNext,\n        getToken: () => token,\n        getTokenValue: () => value,\n        getTokenOffset: () => tokenOffset,\n        getTokenLength: () => pos - tokenOffset,\n        getTokenStartLine: () => lineStartOffset,\n        getTokenStartCharacter: () => tokenOffset - prevTokenLineStartOffset,\n        getTokenError: () => scanError,\n    };\n}\nfunction isWhiteSpace(ch) {\n    return ch === 32 /* CharacterCodes.space */ || ch === 9 /* CharacterCodes.tab */;\n}\nfunction isLineBreak(ch) {\n    return ch === 10 /* CharacterCodes.lineFeed */ || ch === 13 /* CharacterCodes.carriageReturn */;\n}\nfunction isDigit(ch) {\n    return ch >= 48 /* CharacterCodes._0 */ && ch <= 57 /* CharacterCodes._9 */;\n}\nvar CharacterCodes;\n(function (CharacterCodes) {\n    CharacterCodes[CharacterCodes[\"lineFeed\"] = 10] = \"lineFeed\";\n    CharacterCodes[CharacterCodes[\"carriageReturn\"] = 13] = \"carriageReturn\";\n    CharacterCodes[CharacterCodes[\"space\"] = 32] = \"space\";\n    CharacterCodes[CharacterCodes[\"_0\"] = 48] = \"_0\";\n    CharacterCodes[CharacterCodes[\"_1\"] = 49] = \"_1\";\n    CharacterCodes[CharacterCodes[\"_2\"] = 50] = \"_2\";\n    CharacterCodes[CharacterCodes[\"_3\"] = 51] = \"_3\";\n    CharacterCodes[CharacterCodes[\"_4\"] = 52] = \"_4\";\n    CharacterCodes[CharacterCodes[\"_5\"] = 53] = \"_5\";\n    CharacterCodes[CharacterCodes[\"_6\"] = 54] = \"_6\";\n    CharacterCodes[CharacterCodes[\"_7\"] = 55] = \"_7\";\n    CharacterCodes[CharacterCodes[\"_8\"] = 56] = \"_8\";\n    CharacterCodes[CharacterCodes[\"_9\"] = 57] = \"_9\";\n    CharacterCodes[CharacterCodes[\"a\"] = 97] = \"a\";\n    CharacterCodes[CharacterCodes[\"b\"] = 98] = \"b\";\n    CharacterCodes[CharacterCodes[\"c\"] = 99] = \"c\";\n    CharacterCodes[CharacterCodes[\"d\"] = 100] = \"d\";\n    CharacterCodes[CharacterCodes[\"e\"] = 101] = \"e\";\n    CharacterCodes[CharacterCodes[\"f\"] = 102] = \"f\";\n    CharacterCodes[CharacterCodes[\"g\"] = 103] = \"g\";\n    CharacterCodes[CharacterCodes[\"h\"] = 104] = \"h\";\n    CharacterCodes[CharacterCodes[\"i\"] = 105] = \"i\";\n    CharacterCodes[CharacterCodes[\"j\"] = 106] = \"j\";\n    CharacterCodes[CharacterCodes[\"k\"] = 107] = \"k\";\n    CharacterCodes[CharacterCodes[\"l\"] = 108] = \"l\";\n    CharacterCodes[CharacterCodes[\"m\"] = 109] = \"m\";\n    CharacterCodes[CharacterCodes[\"n\"] = 110] = \"n\";\n    CharacterCodes[CharacterCodes[\"o\"] = 111] = \"o\";\n    CharacterCodes[CharacterCodes[\"p\"] = 112] = \"p\";\n    CharacterCodes[CharacterCodes[\"q\"] = 113] = \"q\";\n    CharacterCodes[CharacterCodes[\"r\"] = 114] = \"r\";\n    CharacterCodes[CharacterCodes[\"s\"] = 115] = \"s\";\n    CharacterCodes[CharacterCodes[\"t\"] = 116] = \"t\";\n    CharacterCodes[CharacterCodes[\"u\"] = 117] = \"u\";\n    CharacterCodes[CharacterCodes[\"v\"] = 118] = \"v\";\n    CharacterCodes[CharacterCodes[\"w\"] = 119] = \"w\";\n    CharacterCodes[CharacterCodes[\"x\"] = 120] = \"x\";\n    CharacterCodes[CharacterCodes[\"y\"] = 121] = \"y\";\n    CharacterCodes[CharacterCodes[\"z\"] = 122] = \"z\";\n    CharacterCodes[CharacterCodes[\"A\"] = 65] = \"A\";\n    CharacterCodes[CharacterCodes[\"B\"] = 66] = \"B\";\n    CharacterCodes[CharacterCodes[\"C\"] = 67] = \"C\";\n    CharacterCodes[CharacterCodes[\"D\"] = 68] = \"D\";\n    CharacterCodes[CharacterCodes[\"E\"] = 69] = \"E\";\n    CharacterCodes[CharacterCodes[\"F\"] = 70] = \"F\";\n    CharacterCodes[CharacterCodes[\"G\"] = 71] = \"G\";\n    CharacterCodes[CharacterCodes[\"H\"] = 72] = \"H\";\n    CharacterCodes[CharacterCodes[\"I\"] = 73] = \"I\";\n    CharacterCodes[CharacterCodes[\"J\"] = 74] = \"J\";\n    CharacterCodes[CharacterCodes[\"K\"] = 75] = \"K\";\n    CharacterCodes[CharacterCodes[\"L\"] = 76] = \"L\";\n    CharacterCodes[CharacterCodes[\"M\"] = 77] = \"M\";\n    CharacterCodes[CharacterCodes[\"N\"] = 78] = \"N\";\n    CharacterCodes[CharacterCodes[\"O\"] = 79] = \"O\";\n    CharacterCodes[CharacterCodes[\"P\"] = 80] = \"P\";\n    CharacterCodes[CharacterCodes[\"Q\"] = 81] = \"Q\";\n    CharacterCodes[CharacterCodes[\"R\"] = 82] = \"R\";\n    CharacterCodes[CharacterCodes[\"S\"] = 83] = \"S\";\n    CharacterCodes[CharacterCodes[\"T\"] = 84] = \"T\";\n    CharacterCodes[CharacterCodes[\"U\"] = 85] = \"U\";\n    CharacterCodes[CharacterCodes[\"V\"] = 86] = \"V\";\n    CharacterCodes[CharacterCodes[\"W\"] = 87] = \"W\";\n    CharacterCodes[CharacterCodes[\"X\"] = 88] = \"X\";\n    CharacterCodes[CharacterCodes[\"Y\"] = 89] = \"Y\";\n    CharacterCodes[CharacterCodes[\"Z\"] = 90] = \"Z\";\n    CharacterCodes[CharacterCodes[\"asterisk\"] = 42] = \"asterisk\";\n    CharacterCodes[CharacterCodes[\"backslash\"] = 92] = \"backslash\";\n    CharacterCodes[CharacterCodes[\"closeBrace\"] = 125] = \"closeBrace\";\n    CharacterCodes[CharacterCodes[\"closeBracket\"] = 93] = \"closeBracket\";\n    CharacterCodes[CharacterCodes[\"colon\"] = 58] = \"colon\";\n    CharacterCodes[CharacterCodes[\"comma\"] = 44] = \"comma\";\n    CharacterCodes[CharacterCodes[\"dot\"] = 46] = \"dot\";\n    CharacterCodes[CharacterCodes[\"doubleQuote\"] = 34] = \"doubleQuote\";\n    CharacterCodes[CharacterCodes[\"minus\"] = 45] = \"minus\";\n    CharacterCodes[CharacterCodes[\"openBrace\"] = 123] = \"openBrace\";\n    CharacterCodes[CharacterCodes[\"openBracket\"] = 91] = \"openBracket\";\n    CharacterCodes[CharacterCodes[\"plus\"] = 43] = \"plus\";\n    CharacterCodes[CharacterCodes[\"slash\"] = 47] = \"slash\";\n    CharacterCodes[CharacterCodes[\"formFeed\"] = 12] = \"formFeed\";\n    CharacterCodes[CharacterCodes[\"tab\"] = 9] = \"tab\";\n})(CharacterCodes || (CharacterCodes = {}));\n\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar ParseOptions;\n(function (ParseOptions) {\n    ParseOptions.DEFAULT = {\n        allowTrailingComma: false\n    };\n})(ParseOptions || (ParseOptions = {}));\n/**\n * Parses the given text and returns the object the JSON content represents. On invalid input, the parser tries to be as fault tolerant as possible, but still return a result.\n * Therefore always check the errors list to find out if the input was valid.\n */\nfunction parse$1(text, errors = [], options = ParseOptions.DEFAULT) {\n    let currentProperty = null;\n    let currentParent = [];\n    const previousParents = [];\n    function onValue(value) {\n        if (Array.isArray(currentParent)) {\n            currentParent.push(value);\n        }\n        else if (currentProperty !== null) {\n            currentParent[currentProperty] = value;\n        }\n    }\n    const visitor = {\n        onObjectBegin: () => {\n            const object = {};\n            onValue(object);\n            previousParents.push(currentParent);\n            currentParent = object;\n            currentProperty = null;\n        },\n        onObjectProperty: (name) => {\n            currentProperty = name;\n        },\n        onObjectEnd: () => {\n            currentParent = previousParents.pop();\n        },\n        onArrayBegin: () => {\n            const array = [];\n            onValue(array);\n            previousParents.push(currentParent);\n            currentParent = array;\n            currentProperty = null;\n        },\n        onArrayEnd: () => {\n            currentParent = previousParents.pop();\n        },\n        onLiteralValue: onValue,\n        onError: (error, offset, length) => {\n            errors.push({ error, offset, length });\n        }\n    };\n    visit(text, visitor, options);\n    return currentParent[0];\n}\n/**\n * Parses the given text and invokes the visitor functions for each object, array and literal reached.\n */\nfunction visit(text, visitor, options = ParseOptions.DEFAULT) {\n    const _scanner = createScanner(text, false);\n    // Important: Only pass copies of this to visitor functions to prevent accidental modification, and\n    // to not affect visitor functions which stored a reference to a previous JSONPath\n    const _jsonPath = [];\n    function toNoArgVisit(visitFunction) {\n        return visitFunction ? () => visitFunction(_scanner.getTokenOffset(), _scanner.getTokenLength(), _scanner.getTokenStartLine(), _scanner.getTokenStartCharacter()) : () => true;\n    }\n    function toNoArgVisitWithPath(visitFunction) {\n        return visitFunction ? () => visitFunction(_scanner.getTokenOffset(), _scanner.getTokenLength(), _scanner.getTokenStartLine(), _scanner.getTokenStartCharacter(), () => _jsonPath.slice()) : () => true;\n    }\n    function toOneArgVisit(visitFunction) {\n        return visitFunction ? (arg) => visitFunction(arg, _scanner.getTokenOffset(), _scanner.getTokenLength(), _scanner.getTokenStartLine(), _scanner.getTokenStartCharacter()) : () => true;\n    }\n    function toOneArgVisitWithPath(visitFunction) {\n        return visitFunction ? (arg) => visitFunction(arg, _scanner.getTokenOffset(), _scanner.getTokenLength(), _scanner.getTokenStartLine(), _scanner.getTokenStartCharacter(), () => _jsonPath.slice()) : () => true;\n    }\n    const onObjectBegin = toNoArgVisitWithPath(visitor.onObjectBegin), onObjectProperty = toOneArgVisitWithPath(visitor.onObjectProperty), onObjectEnd = toNoArgVisit(visitor.onObjectEnd), onArrayBegin = toNoArgVisitWithPath(visitor.onArrayBegin), onArrayEnd = toNoArgVisit(visitor.onArrayEnd), onLiteralValue = toOneArgVisitWithPath(visitor.onLiteralValue), onSeparator = toOneArgVisit(visitor.onSeparator), onComment = toNoArgVisit(visitor.onComment), onError = toOneArgVisit(visitor.onError);\n    const disallowComments = options && options.disallowComments;\n    const allowTrailingComma = options && options.allowTrailingComma;\n    function scanNext() {\n        while (true) {\n            const token = _scanner.scan();\n            switch (_scanner.getTokenError()) {\n                case 4 /* ScanError.InvalidUnicode */:\n                    handleError(14 /* ParseErrorCode.InvalidUnicode */);\n                    break;\n                case 5 /* ScanError.InvalidEscapeCharacter */:\n                    handleError(15 /* ParseErrorCode.InvalidEscapeCharacter */);\n                    break;\n                case 3 /* ScanError.UnexpectedEndOfNumber */:\n                    handleError(13 /* ParseErrorCode.UnexpectedEndOfNumber */);\n                    break;\n                case 1 /* ScanError.UnexpectedEndOfComment */:\n                    if (!disallowComments) {\n                        handleError(11 /* ParseErrorCode.UnexpectedEndOfComment */);\n                    }\n                    break;\n                case 2 /* ScanError.UnexpectedEndOfString */:\n                    handleError(12 /* ParseErrorCode.UnexpectedEndOfString */);\n                    break;\n                case 6 /* ScanError.InvalidCharacter */:\n                    handleError(16 /* ParseErrorCode.InvalidCharacter */);\n                    break;\n            }\n            switch (token) {\n                case 12 /* SyntaxKind.LineCommentTrivia */:\n                case 13 /* SyntaxKind.BlockCommentTrivia */:\n                    if (disallowComments) {\n                        handleError(10 /* ParseErrorCode.InvalidCommentToken */);\n                    }\n                    else {\n                        onComment();\n                    }\n                    break;\n                case 16 /* SyntaxKind.Unknown */:\n                    handleError(1 /* ParseErrorCode.InvalidSymbol */);\n                    break;\n                case 15 /* SyntaxKind.Trivia */:\n                case 14 /* SyntaxKind.LineBreakTrivia */:\n                    break;\n                default:\n                    return token;\n            }\n        }\n    }\n    function handleError(error, skipUntilAfter = [], skipUntil = []) {\n        onError(error);\n        if (skipUntilAfter.length + skipUntil.length > 0) {\n            let token = _scanner.getToken();\n            while (token !== 17 /* SyntaxKind.EOF */) {\n                if (skipUntilAfter.indexOf(token) !== -1) {\n                    scanNext();\n                    break;\n                }\n                else if (skipUntil.indexOf(token) !== -1) {\n                    break;\n                }\n                token = scanNext();\n            }\n        }\n    }\n    function parseString(isValue) {\n        const value = _scanner.getTokenValue();\n        if (isValue) {\n            onLiteralValue(value);\n        }\n        else {\n            onObjectProperty(value);\n            // add property name afterwards\n            _jsonPath.push(value);\n        }\n        scanNext();\n        return true;\n    }\n    function parseLiteral() {\n        switch (_scanner.getToken()) {\n            case 11 /* SyntaxKind.NumericLiteral */:\n                const tokenValue = _scanner.getTokenValue();\n                let value = Number(tokenValue);\n                if (isNaN(value)) {\n                    handleError(2 /* ParseErrorCode.InvalidNumberFormat */);\n                    value = 0;\n                }\n                onLiteralValue(value);\n                break;\n            case 7 /* SyntaxKind.NullKeyword */:\n                onLiteralValue(null);\n                break;\n            case 8 /* SyntaxKind.TrueKeyword */:\n                onLiteralValue(true);\n                break;\n            case 9 /* SyntaxKind.FalseKeyword */:\n                onLiteralValue(false);\n                break;\n            default:\n                return false;\n        }\n        scanNext();\n        return true;\n    }\n    function parseProperty() {\n        if (_scanner.getToken() !== 10 /* SyntaxKind.StringLiteral */) {\n            handleError(3 /* ParseErrorCode.PropertyNameExpected */, [], [2 /* SyntaxKind.CloseBraceToken */, 5 /* SyntaxKind.CommaToken */]);\n            return false;\n        }\n        parseString(false);\n        if (_scanner.getToken() === 6 /* SyntaxKind.ColonToken */) {\n            onSeparator(':');\n            scanNext(); // consume colon\n            if (!parseValue()) {\n                handleError(4 /* ParseErrorCode.ValueExpected */, [], [2 /* SyntaxKind.CloseBraceToken */, 5 /* SyntaxKind.CommaToken */]);\n            }\n        }\n        else {\n            handleError(5 /* ParseErrorCode.ColonExpected */, [], [2 /* SyntaxKind.CloseBraceToken */, 5 /* SyntaxKind.CommaToken */]);\n        }\n        _jsonPath.pop(); // remove processed property name\n        return true;\n    }\n    function parseObject() {\n        onObjectBegin();\n        scanNext(); // consume open brace\n        let needsComma = false;\n        while (_scanner.getToken() !== 2 /* SyntaxKind.CloseBraceToken */ && _scanner.getToken() !== 17 /* SyntaxKind.EOF */) {\n            if (_scanner.getToken() === 5 /* SyntaxKind.CommaToken */) {\n                if (!needsComma) {\n                    handleError(4 /* ParseErrorCode.ValueExpected */, [], []);\n                }\n                onSeparator(',');\n                scanNext(); // consume comma\n                if (_scanner.getToken() === 2 /* SyntaxKind.CloseBraceToken */ && allowTrailingComma) {\n                    break;\n                }\n            }\n            else if (needsComma) {\n                handleError(6 /* ParseErrorCode.CommaExpected */, [], []);\n            }\n            if (!parseProperty()) {\n                handleError(4 /* ParseErrorCode.ValueExpected */, [], [2 /* SyntaxKind.CloseBraceToken */, 5 /* SyntaxKind.CommaToken */]);\n            }\n            needsComma = true;\n        }\n        onObjectEnd();\n        if (_scanner.getToken() !== 2 /* SyntaxKind.CloseBraceToken */) {\n            handleError(7 /* ParseErrorCode.CloseBraceExpected */, [2 /* SyntaxKind.CloseBraceToken */], []);\n        }\n        else {\n            scanNext(); // consume close brace\n        }\n        return true;\n    }\n    function parseArray() {\n        onArrayBegin();\n        scanNext(); // consume open bracket\n        let isFirstElement = true;\n        let needsComma = false;\n        while (_scanner.getToken() !== 4 /* SyntaxKind.CloseBracketToken */ && _scanner.getToken() !== 17 /* SyntaxKind.EOF */) {\n            if (_scanner.getToken() === 5 /* SyntaxKind.CommaToken */) {\n                if (!needsComma) {\n                    handleError(4 /* ParseErrorCode.ValueExpected */, [], []);\n                }\n                onSeparator(',');\n                scanNext(); // consume comma\n                if (_scanner.getToken() === 4 /* SyntaxKind.CloseBracketToken */ && allowTrailingComma) {\n                    break;\n                }\n            }\n            else if (needsComma) {\n                handleError(6 /* ParseErrorCode.CommaExpected */, [], []);\n            }\n            if (isFirstElement) {\n                _jsonPath.push(0);\n                isFirstElement = false;\n            }\n            else {\n                _jsonPath[_jsonPath.length - 1]++;\n            }\n            if (!parseValue()) {\n                handleError(4 /* ParseErrorCode.ValueExpected */, [], [4 /* SyntaxKind.CloseBracketToken */, 5 /* SyntaxKind.CommaToken */]);\n            }\n            needsComma = true;\n        }\n        onArrayEnd();\n        if (!isFirstElement) {\n            _jsonPath.pop(); // remove array index\n        }\n        if (_scanner.getToken() !== 4 /* SyntaxKind.CloseBracketToken */) {\n            handleError(8 /* ParseErrorCode.CloseBracketExpected */, [4 /* SyntaxKind.CloseBracketToken */], []);\n        }\n        else {\n            scanNext(); // consume close bracket\n        }\n        return true;\n    }\n    function parseValue() {\n        switch (_scanner.getToken()) {\n            case 3 /* SyntaxKind.OpenBracketToken */:\n                return parseArray();\n            case 1 /* SyntaxKind.OpenBraceToken */:\n                return parseObject();\n            case 10 /* SyntaxKind.StringLiteral */:\n                return parseString(true);\n            default:\n                return parseLiteral();\n        }\n    }\n    scanNext();\n    if (_scanner.getToken() === 17 /* SyntaxKind.EOF */) {\n        if (options.allowEmptyContent) {\n            return true;\n        }\n        handleError(4 /* ParseErrorCode.ValueExpected */, [], []);\n        return false;\n    }\n    if (!parseValue()) {\n        handleError(4 /* ParseErrorCode.ValueExpected */, [], []);\n        return false;\n    }\n    if (_scanner.getToken() !== 17 /* SyntaxKind.EOF */) {\n        handleError(9 /* ParseErrorCode.EndOfFileExpected */, [], []);\n    }\n    return true;\n}\n\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar ScanError;\n(function (ScanError) {\n    ScanError[ScanError[\"None\"] = 0] = \"None\";\n    ScanError[ScanError[\"UnexpectedEndOfComment\"] = 1] = \"UnexpectedEndOfComment\";\n    ScanError[ScanError[\"UnexpectedEndOfString\"] = 2] = \"UnexpectedEndOfString\";\n    ScanError[ScanError[\"UnexpectedEndOfNumber\"] = 3] = \"UnexpectedEndOfNumber\";\n    ScanError[ScanError[\"InvalidUnicode\"] = 4] = \"InvalidUnicode\";\n    ScanError[ScanError[\"InvalidEscapeCharacter\"] = 5] = \"InvalidEscapeCharacter\";\n    ScanError[ScanError[\"InvalidCharacter\"] = 6] = \"InvalidCharacter\";\n})(ScanError || (ScanError = {}));\nvar SyntaxKind;\n(function (SyntaxKind) {\n    SyntaxKind[SyntaxKind[\"OpenBraceToken\"] = 1] = \"OpenBraceToken\";\n    SyntaxKind[SyntaxKind[\"CloseBraceToken\"] = 2] = \"CloseBraceToken\";\n    SyntaxKind[SyntaxKind[\"OpenBracketToken\"] = 3] = \"OpenBracketToken\";\n    SyntaxKind[SyntaxKind[\"CloseBracketToken\"] = 4] = \"CloseBracketToken\";\n    SyntaxKind[SyntaxKind[\"CommaToken\"] = 5] = \"CommaToken\";\n    SyntaxKind[SyntaxKind[\"ColonToken\"] = 6] = \"ColonToken\";\n    SyntaxKind[SyntaxKind[\"NullKeyword\"] = 7] = \"NullKeyword\";\n    SyntaxKind[SyntaxKind[\"TrueKeyword\"] = 8] = \"TrueKeyword\";\n    SyntaxKind[SyntaxKind[\"FalseKeyword\"] = 9] = \"FalseKeyword\";\n    SyntaxKind[SyntaxKind[\"StringLiteral\"] = 10] = \"StringLiteral\";\n    SyntaxKind[SyntaxKind[\"NumericLiteral\"] = 11] = \"NumericLiteral\";\n    SyntaxKind[SyntaxKind[\"LineCommentTrivia\"] = 12] = \"LineCommentTrivia\";\n    SyntaxKind[SyntaxKind[\"BlockCommentTrivia\"] = 13] = \"BlockCommentTrivia\";\n    SyntaxKind[SyntaxKind[\"LineBreakTrivia\"] = 14] = \"LineBreakTrivia\";\n    SyntaxKind[SyntaxKind[\"Trivia\"] = 15] = \"Trivia\";\n    SyntaxKind[SyntaxKind[\"Unknown\"] = 16] = \"Unknown\";\n    SyntaxKind[SyntaxKind[\"EOF\"] = 17] = \"EOF\";\n})(SyntaxKind || (SyntaxKind = {}));\n/**\n * Parses the given text and returns the object the JSON content represents. On invalid input, the parser tries to be as fault tolerant as possible, but still return a result.\n * Therefore, always check the errors list to find out if the input was valid.\n */\nconst parse = parse$1;\nvar ParseErrorCode;\n(function (ParseErrorCode) {\n    ParseErrorCode[ParseErrorCode[\"InvalidSymbol\"] = 1] = \"InvalidSymbol\";\n    ParseErrorCode[ParseErrorCode[\"InvalidNumberFormat\"] = 2] = \"InvalidNumberFormat\";\n    ParseErrorCode[ParseErrorCode[\"PropertyNameExpected\"] = 3] = \"PropertyNameExpected\";\n    ParseErrorCode[ParseErrorCode[\"ValueExpected\"] = 4] = \"ValueExpected\";\n    ParseErrorCode[ParseErrorCode[\"ColonExpected\"] = 5] = \"ColonExpected\";\n    ParseErrorCode[ParseErrorCode[\"CommaExpected\"] = 6] = \"CommaExpected\";\n    ParseErrorCode[ParseErrorCode[\"CloseBraceExpected\"] = 7] = \"CloseBraceExpected\";\n    ParseErrorCode[ParseErrorCode[\"CloseBracketExpected\"] = 8] = \"CloseBracketExpected\";\n    ParseErrorCode[ParseErrorCode[\"EndOfFileExpected\"] = 9] = \"EndOfFileExpected\";\n    ParseErrorCode[ParseErrorCode[\"InvalidCommentToken\"] = 10] = \"InvalidCommentToken\";\n    ParseErrorCode[ParseErrorCode[\"UnexpectedEndOfComment\"] = 11] = \"UnexpectedEndOfComment\";\n    ParseErrorCode[ParseErrorCode[\"UnexpectedEndOfString\"] = 12] = \"UnexpectedEndOfString\";\n    ParseErrorCode[ParseErrorCode[\"UnexpectedEndOfNumber\"] = 13] = \"UnexpectedEndOfNumber\";\n    ParseErrorCode[ParseErrorCode[\"InvalidUnicode\"] = 14] = \"InvalidUnicode\";\n    ParseErrorCode[ParseErrorCode[\"InvalidEscapeCharacter\"] = 15] = \"InvalidEscapeCharacter\";\n    ParseErrorCode[ParseErrorCode[\"InvalidCharacter\"] = 16] = \"InvalidCharacter\";\n})(ParseErrorCode || (ParseErrorCode = {}));\n\nconst isWebWorker = typeof self !== \"undefined\" && typeof self.WorkerGlobalScope !== \"undefined\";\nconst isNode = \"process\" in globalThis && typeof process !== \"undefined\" && typeof process.release !== \"undefined\" && process.release.name === \"node\";\nconst isBrowser = isWebWorker || !isNode;\nlet CDN_ROOT = \"\";\nlet WASM = \"\";\nconst WASM_PATH = \"dist/\";\nfunction setCDN(root) {\n  CDN_ROOT = root.endsWith(\"/\") ? root : root + \"/\";\n}\nfunction setWasm(data) {\n  WASM = data;\n}\nlet _onigurumaPromise = null;\nasync function getOniguruma(wasmPath) {\n  if (!_onigurumaPromise) {\n    let loader;\n    if (isBrowser) {\n      if (typeof WASM === \"string\") {\n        loader = loadWASM({\n          data: await fetch(_resolvePath(join(...dirpathparts(wasmPath), \"onig.wasm\")))\n        });\n      } else {\n        loader = loadWASM({\n          data: WASM\n        });\n      }\n    } else {\n      const path = require(\"path\");\n      const wasmPath2 = path.join(require.resolve(\"vscode-oniguruma\"), \"../onig.wasm\");\n      const fs = require(\"fs\");\n      const wasmBin = fs.readFileSync(wasmPath2).buffer;\n      loader = loadWASM(wasmBin);\n    }\n    _onigurumaPromise = loader.then(() => {\n      return {\n        createOnigScanner(patterns) {\n          return createOnigScanner(patterns);\n        },\n        createOnigString(s) {\n          return createOnigString(s);\n        }\n      };\n    });\n  }\n  return _onigurumaPromise;\n}\nfunction _resolvePath(filepath) {\n  if (isBrowser) {\n    return `${CDN_ROOT}${filepath}`;\n  } else {\n    const path = require(\"path\");\n    if (path.isAbsolute(filepath)) {\n      return filepath;\n    } else {\n      return path.resolve(__dirname, \"..\", filepath);\n    }\n  }\n}\nasync function _fetchAssets(filepath) {\n  const path = _resolvePath(filepath);\n  if (isBrowser) {\n    return await fetch(path).then((r) => r.text());\n  } else {\n    const fs = require(\"fs\");\n    return await fs.promises.readFile(path, \"utf-8\");\n  }\n}\nasync function _fetchJSONAssets(filepath) {\n  const errors = [];\n  const assetString = await _fetchAssets(filepath);\n  let rawAsset;\n  try {\n    rawAsset = JSON.parse(assetString);\n  } catch (e) {\n    rawAsset = parse(assetString, errors, {\n      allowTrailingComma: true\n    });\n    if (errors.length) {\n      throw errors[0];\n    }\n  }\n  return rawAsset;\n}\nasync function fetchTheme(themePath) {\n  let theme = await _fetchJSONAssets(themePath);\n  const shikiTheme = toShikiTheme(theme);\n  if (shikiTheme.include) {\n    const includedTheme = await fetchTheme(join(...dirpathparts(themePath), shikiTheme.include));\n    if (includedTheme.settings) {\n      shikiTheme.settings = includedTheme.settings.concat(shikiTheme.settings);\n    }\n    if (includedTheme.bg && !shikiTheme.bg) {\n      shikiTheme.bg = includedTheme.bg;\n    }\n    if (includedTheme.colors) {\n      shikiTheme.colors = { ...includedTheme.colors, ...shikiTheme.colors };\n    }\n    delete shikiTheme.include;\n  }\n  return shikiTheme;\n}\nasync function fetchGrammar(filepath) {\n  return await _fetchJSONAssets(filepath);\n}\nfunction repairTheme(theme) {\n  if (!theme.settings)\n    theme.settings = [];\n  if (theme.settings[0] && theme.settings[0].settings && !theme.settings[0].scope) {\n    return;\n  }\n  theme.settings.unshift({\n    settings: {\n      foreground: theme.fg,\n      background: theme.bg\n    }\n  });\n}\nfunction toShikiTheme(rawTheme) {\n  const type = rawTheme.type || \"dark\";\n  const shikiTheme = {\n    name: rawTheme.name,\n    type,\n    ...rawTheme,\n    ...getThemeDefaultColors(rawTheme)\n  };\n  if (rawTheme.include) {\n    shikiTheme.include = rawTheme.include;\n  }\n  if (rawTheme.tokenColors) {\n    shikiTheme.settings = rawTheme.tokenColors;\n    delete shikiTheme.tokenColors;\n  }\n  repairTheme(shikiTheme);\n  return shikiTheme;\n}\nconst VSCODE_FALLBACK_EDITOR_FG = { light: \"#333333\", dark: \"#bbbbbb\" };\nconst VSCODE_FALLBACK_EDITOR_BG = { light: \"#fffffe\", dark: \"#1e1e1e\" };\nfunction getThemeDefaultColors(theme) {\n  let fg, bg;\n  let settings = theme.settings ? theme.settings : theme.tokenColors;\n  const globalSetting = settings ? settings.find((s) => {\n    return !s.name && !s.scope;\n  }) : void 0;\n  if (globalSetting?.settings?.foreground) {\n    fg = globalSetting.settings.foreground;\n  }\n  if (globalSetting?.settings?.background) {\n    bg = globalSetting.settings.background;\n  }\n  if (!fg && theme?.colors?.[\"editor.foreground\"]) {\n    fg = theme.colors[\"editor.foreground\"];\n  }\n  if (!bg && theme?.colors?.[\"editor.background\"]) {\n    bg = theme.colors[\"editor.background\"];\n  }\n  if (!fg) {\n    fg = theme.type === \"light\" ? VSCODE_FALLBACK_EDITOR_FG.light : VSCODE_FALLBACK_EDITOR_FG.dark;\n  }\n  if (!bg) {\n    bg = theme.type === \"light\" ? VSCODE_FALLBACK_EDITOR_BG.light : VSCODE_FALLBACK_EDITOR_BG.dark;\n  }\n  return {\n    fg,\n    bg\n  };\n}\n\nclass Resolver {\n  constructor(onigLibPromise, onigLibName) {\n    this.languagesPath = \"languages/\";\n    this.languageMap = {};\n    this.scopeToLangMap = {};\n    this._onigLibPromise = onigLibPromise;\n    this._onigLibName = onigLibName;\n  }\n  get onigLib() {\n    return this._onigLibPromise;\n  }\n  getOnigLibName() {\n    return this._onigLibName;\n  }\n  getLangRegistration(langIdOrAlias) {\n    return this.languageMap[langIdOrAlias];\n  }\n  async loadGrammar(scopeName) {\n    const lang = this.scopeToLangMap[scopeName];\n    if (!lang) {\n      return null;\n    }\n    if (lang.grammar) {\n      return lang.grammar;\n    }\n    const g = await fetchGrammar(\n      languages.includes(lang) ? `${this.languagesPath}${lang.path}` : lang.path\n    );\n    lang.grammar = g;\n    return g;\n  }\n  addLanguage(l) {\n    this.languageMap[l.id] = l;\n    if (l.aliases) {\n      l.aliases.forEach((a) => {\n        this.languageMap[a] = l;\n      });\n    }\n    this.scopeToLangMap[l.scopeName] = l;\n  }\n}\n\nfunction tokenizeWithTheme(theme, colorMap, fileContents, grammar, options) {\n  let lines = fileContents.split(/\\r\\n|\\r|\\n/);\n  let ruleStack = INITIAL;\n  let actual = [];\n  let final = [];\n  for (let i = 0, len = lines.length; i < len; i++) {\n    let line = lines[i];\n    if (line === \"\") {\n      actual = [];\n      final.push([]);\n      continue;\n    }\n    let resultWithScopes;\n    let tokensWithScopes;\n    let tokensWithScopesIndex;\n    if (options.includeExplanation) {\n      resultWithScopes = grammar.tokenizeLine(line, ruleStack);\n      tokensWithScopes = resultWithScopes.tokens;\n      tokensWithScopesIndex = 0;\n    }\n    let result = grammar.tokenizeLine2(line, ruleStack);\n    let tokensLength = result.tokens.length / 2;\n    for (let j = 0; j < tokensLength; j++) {\n      let startIndex = result.tokens[2 * j];\n      let nextStartIndex = j + 1 < tokensLength ? result.tokens[2 * j + 2] : line.length;\n      if (startIndex === nextStartIndex) {\n        continue;\n      }\n      let metadata = result.tokens[2 * j + 1];\n      let foreground = StackElementMetadata.getForeground(metadata);\n      let foregroundColor = colorMap[foreground];\n      let fontStyle = StackElementMetadata.getFontStyle(metadata);\n      let explanation = [];\n      if (options.includeExplanation) {\n        let offset = 0;\n        while (startIndex + offset < nextStartIndex) {\n          let tokenWithScopes = tokensWithScopes[tokensWithScopesIndex];\n          let tokenWithScopesText = line.substring(\n            tokenWithScopes.startIndex,\n            tokenWithScopes.endIndex\n          );\n          offset += tokenWithScopesText.length;\n          explanation.push({\n            content: tokenWithScopesText,\n            scopes: explainThemeScopes(theme, tokenWithScopes.scopes)\n          });\n          tokensWithScopesIndex++;\n        }\n      }\n      actual.push({\n        content: line.substring(startIndex, nextStartIndex),\n        color: foregroundColor,\n        fontStyle,\n        explanation\n      });\n    }\n    final.push(actual);\n    actual = [];\n    ruleStack = result.ruleStack;\n  }\n  return final;\n}\nfunction explainThemeScopes(theme, scopes) {\n  let result = [];\n  for (let i = 0, len = scopes.length; i < len; i++) {\n    let parentScopes = scopes.slice(0, i);\n    let scope = scopes[i];\n    result[i] = {\n      scopeName: scope,\n      themeMatches: explainThemeScope(theme, scope, parentScopes)\n    };\n  }\n  return result;\n}\nfunction matchesOne(selector, scope) {\n  let selectorPrefix = selector + \".\";\n  if (selector === scope || scope.substring(0, selectorPrefix.length) === selectorPrefix) {\n    return true;\n  }\n  return false;\n}\nfunction matches(selector, selectorParentScopes, scope, parentScopes) {\n  if (!matchesOne(selector, scope)) {\n    return false;\n  }\n  let selectorParentIndex = selectorParentScopes.length - 1;\n  let parentIndex = parentScopes.length - 1;\n  while (selectorParentIndex >= 0 && parentIndex >= 0) {\n    if (matchesOne(selectorParentScopes[selectorParentIndex], parentScopes[parentIndex])) {\n      selectorParentIndex--;\n    }\n    parentIndex--;\n  }\n  if (selectorParentIndex === -1) {\n    return true;\n  }\n  return false;\n}\nfunction explainThemeScope(theme, scope, parentScopes) {\n  let result = [], resultLen = 0;\n  for (let i = 0, len = theme.settings.length; i < len; i++) {\n    let setting = theme.settings[i];\n    let selectors;\n    if (typeof setting.scope === \"string\") {\n      selectors = setting.scope.split(/,/).map((scope2) => scope2.trim());\n    } else if (Array.isArray(setting.scope)) {\n      selectors = setting.scope;\n    } else {\n      continue;\n    }\n    for (let j = 0, lenJ = selectors.length; j < lenJ; j++) {\n      let rawSelector = selectors[j];\n      let rawSelectorPieces = rawSelector.split(/ /);\n      let selector = rawSelectorPieces[rawSelectorPieces.length - 1];\n      let selectorParentScopes = rawSelectorPieces.slice(0, rawSelectorPieces.length - 1);\n      if (matches(selector, selectorParentScopes, scope, parentScopes)) {\n        result[resultLen++] = setting;\n        j = lenJ;\n      }\n    }\n  }\n  return result;\n}\n\n// src/colors.ts\nvar namedColors = [\n  \"black\",\n  \"red\",\n  \"green\",\n  \"yellow\",\n  \"blue\",\n  \"magenta\",\n  \"cyan\",\n  \"white\",\n  \"brightBlack\",\n  \"brightRed\",\n  \"brightGreen\",\n  \"brightYellow\",\n  \"brightBlue\",\n  \"brightMagenta\",\n  \"brightCyan\",\n  \"brightWhite\"\n];\n\n// src/decorations.ts\nvar decorations = {\n  1: \"bold\",\n  2: \"dim\",\n  3: \"italic\",\n  4: \"underline\",\n  7: \"reverse\",\n  9: \"strikethrough\"\n};\n\n// src/parser.ts\nfunction findSequence(value, position) {\n  const nextEscape = value.indexOf(\"\\x1B\", position);\n  if (nextEscape !== -1) {\n    if (value[nextEscape + 1] === \"[\") {\n      const nextClose = value.indexOf(\"m\", nextEscape);\n      return {\n        sequence: value.substring(nextEscape + 2, nextClose).split(\";\"),\n        startPosition: nextEscape,\n        position: nextClose + 1\n      };\n    }\n  }\n  return {\n    position: value.length\n  };\n}\nfunction parseColor(sequence) {\n  const colorMode = sequence.shift();\n  if (colorMode === \"2\") {\n    const rgb = sequence.splice(0, 3).map((x) => Number.parseInt(x));\n    if (rgb.length !== 3 || rgb.some((x) => Number.isNaN(x)))\n      return;\n    return {\n      type: \"rgb\",\n      rgb\n    };\n  } else if (colorMode === \"5\") {\n    const index = sequence.shift();\n    if (index) {\n      return { type: \"table\", index: Number(index) };\n    }\n  }\n}\nfunction parseSequence(sequence) {\n  const commands = [];\n  while (sequence.length > 0) {\n    const code = sequence.shift();\n    if (!code)\n      continue;\n    const codeInt = Number.parseInt(code);\n    if (Number.isNaN(codeInt))\n      continue;\n    if (codeInt === 0) {\n      commands.push({ type: \"resetAll\" });\n    } else if (codeInt <= 9) {\n      const decoration = decorations[codeInt];\n      if (decoration) {\n        commands.push({\n          type: \"setDecoration\",\n          value: decorations[codeInt]\n        });\n      }\n    } else if (codeInt <= 29) {\n      const decoration = decorations[codeInt - 20];\n      if (decoration) {\n        commands.push({\n          type: \"resetDecoration\",\n          value: decoration\n        });\n      }\n    } else if (codeInt <= 37) {\n      commands.push({\n        type: \"setForegroundColor\",\n        value: { type: \"named\", name: namedColors[codeInt - 30] }\n      });\n    } else if (codeInt === 38) {\n      const color = parseColor(sequence);\n      if (color) {\n        commands.push({\n          type: \"setForegroundColor\",\n          value: color\n        });\n      }\n    } else if (codeInt === 39) {\n      commands.push({\n        type: \"resetForegroundColor\"\n      });\n    } else if (codeInt <= 47) {\n      commands.push({\n        type: \"setBackgroundColor\",\n        value: { type: \"named\", name: namedColors[codeInt - 40] }\n      });\n    } else if (codeInt === 48) {\n      const color = parseColor(sequence);\n      if (color) {\n        commands.push({\n          type: \"setBackgroundColor\",\n          value: color\n        });\n      }\n    } else if (codeInt === 49) {\n      commands.push({\n        type: \"resetBackgroundColor\"\n      });\n    } else if (codeInt >= 90 && codeInt <= 97) {\n      commands.push({\n        type: \"setForegroundColor\",\n        value: { type: \"named\", name: namedColors[codeInt - 90 + 8] }\n      });\n    } else if (codeInt >= 100 && codeInt <= 107) {\n      commands.push({\n        type: \"setBackgroundColor\",\n        value: { type: \"named\", name: namedColors[codeInt - 100 + 8] }\n      });\n    }\n  }\n  return commands;\n}\nfunction createAnsiSequenceParser() {\n  let foreground = null;\n  let background = null;\n  let decorations2 = /* @__PURE__ */ new Set();\n  return {\n    parse(value) {\n      const tokens = [];\n      let position = 0;\n      do {\n        const findResult = findSequence(value, position);\n        const text = findResult.sequence ? value.substring(position, findResult.startPosition) : value.substring(position);\n        if (text.length > 0) {\n          tokens.push({\n            value: text,\n            foreground,\n            background,\n            decorations: new Set(decorations2)\n          });\n        }\n        if (findResult.sequence) {\n          const commands = parseSequence(findResult.sequence);\n          for (const styleToken of commands) {\n            if (styleToken.type === \"resetAll\") {\n              foreground = null;\n              background = null;\n              decorations2.clear();\n            } else if (styleToken.type === \"resetForegroundColor\") {\n              foreground = null;\n            } else if (styleToken.type === \"resetBackgroundColor\") {\n              background = null;\n            } else if (styleToken.type === \"resetDecoration\") {\n              decorations2.delete(styleToken.value);\n            }\n          }\n          for (const styleToken of commands) {\n            if (styleToken.type === \"setForegroundColor\") {\n              foreground = styleToken.value;\n            } else if (styleToken.type === \"setBackgroundColor\") {\n              background = styleToken.value;\n            } else if (styleToken.type === \"setDecoration\") {\n              decorations2.add(styleToken.value);\n            }\n          }\n        }\n        position = findResult.position;\n      } while (position < value.length);\n      return tokens;\n    }\n  };\n}\n\n// src/palette.ts\nvar defaultNamedColorsMap = {\n  black: \"#000000\",\n  red: \"#bb0000\",\n  green: \"#00bb00\",\n  yellow: \"#bbbb00\",\n  blue: \"#0000bb\",\n  magenta: \"#ff00ff\",\n  cyan: \"#00bbbb\",\n  white: \"#eeeeee\",\n  brightBlack: \"#555555\",\n  brightRed: \"#ff5555\",\n  brightGreen: \"#00ff00\",\n  brightYellow: \"#ffff55\",\n  brightBlue: \"#5555ff\",\n  brightMagenta: \"#ff55ff\",\n  brightCyan: \"#55ffff\",\n  brightWhite: \"#ffffff\"\n};\nfunction createColorPalette(namedColorsMap = defaultNamedColorsMap) {\n  function namedColor(name) {\n    return namedColorsMap[name];\n  }\n  function rgbColor(rgb) {\n    return `#${rgb.map((x) => Math.max(0, Math.min(x, 255)).toString(16).padStart(2, \"0\")).join(\"\")}`;\n  }\n  let colorTable;\n  function getColorTable() {\n    if (colorTable) {\n      return colorTable;\n    }\n    colorTable = [];\n    for (let i = 0; i < namedColors.length; i++) {\n      colorTable.push(namedColor(namedColors[i]));\n    }\n    let levels = [0, 95, 135, 175, 215, 255];\n    for (let r = 0; r < 6; r++) {\n      for (let g = 0; g < 6; g++) {\n        for (let b = 0; b < 6; b++) {\n          colorTable.push(rgbColor([levels[r], levels[g], levels[b]]));\n        }\n      }\n    }\n    let level = 8;\n    for (let i = 0; i < 24; i++, level += 10) {\n      colorTable.push(rgbColor([level, level, level]));\n    }\n    return colorTable;\n  }\n  function tableColor(index) {\n    return getColorTable()[index];\n  }\n  function value(color) {\n    switch (color.type) {\n      case \"named\":\n        return namedColor(color.name);\n      case \"rgb\":\n        return rgbColor(color.rgb);\n      case \"table\":\n        return tableColor(color.index);\n    }\n  }\n  return {\n    value\n  };\n}\n\nfunction tokenizeAnsiWithTheme(theme, fileContents) {\n  const lines = fileContents.split(/\\r?\\n/);\n  const colorPalette = createColorPalette(\n    Object.fromEntries(\n      namedColors.map((name) => [\n        name,\n        theme.colors[`terminal.ansi${name[0].toUpperCase()}${name.substring(1)}`]\n      ])\n    )\n  );\n  const parser = createAnsiSequenceParser();\n  return lines.map(\n    (line) => parser.parse(line).map((token) => {\n      let color;\n      if (token.decorations.has(\"reverse\")) {\n        color = token.background ? colorPalette.value(token.background) : theme.bg;\n      } else {\n        color = token.foreground ? colorPalette.value(token.foreground) : theme.fg;\n      }\n      if (token.decorations.has(\"dim\")) {\n        color = dimColor(color);\n      }\n      let fontStyle = FontStyle.None;\n      if (token.decorations.has(\"bold\")) {\n        fontStyle |= FontStyle.Bold;\n      }\n      if (token.decorations.has(\"italic\")) {\n        fontStyle |= FontStyle.Italic;\n      }\n      if (token.decorations.has(\"underline\")) {\n        fontStyle |= FontStyle.Underline;\n      }\n      return {\n        content: token.value,\n        color,\n        fontStyle\n      };\n    })\n  );\n}\nfunction dimColor(color) {\n  const hexMatch = color.match(/#([0-9a-f]{3})([0-9a-f]{3})?([0-9a-f]{2})?/);\n  if (hexMatch) {\n    if (hexMatch[3]) {\n      const alpha = Math.round(Number.parseInt(hexMatch[3], 16) / 2).toString(16).padStart(2, \"0\");\n      return `#${hexMatch[1]}${hexMatch[2]}${alpha}`;\n    } else if (hexMatch[2]) {\n      return `#${hexMatch[1]}${hexMatch[2]}80`;\n    } else {\n      return `#${Array.from(hexMatch[1]).map((x) => `${x}${x}`).join(\"\")}80`;\n    }\n  }\n  const cssVarMatch = color.match(/var\\((--shiki-color-ansi-[\\w-]+)\\)/);\n  if (cssVarMatch) {\n    return `var(${cssVarMatch[1]}-dim)`;\n  }\n  return color;\n}\n\nconst defaultElements = {\n  pre({ className, style, children }) {\n    return `<pre class=\"${className}\" style=\"${style}\" tabindex=\"0\">${children}</pre>`;\n  },\n  code({ children }) {\n    return `<code>${children}</code>`;\n  },\n  line({ className, children }) {\n    return `<span class=\"${className}\">${children}</span>`;\n  },\n  token({ style, children }) {\n    return `<span style=\"${style}\">${children}</span>`;\n  }\n};\nfunction renderToHtml(lines, options = {}) {\n  const bg = options.bg || \"#fff\";\n  const optionsByLineNumber = groupBy(options.lineOptions ?? [], (option) => option.line);\n  const userElements = options.elements || {};\n  function h(type = \"\", props = {}, children) {\n    const element = userElements[type] || defaultElements[type];\n    if (element) {\n      children = children.filter(Boolean);\n      return element({\n        ...props,\n        children: type === \"code\" ? children.join(\"\\n\") : children.join(\"\")\n      });\n    }\n    return \"\";\n  }\n  return h(\n    \"pre\",\n    { className: \"shiki \" + (options.themeName || \"\"), style: `background-color: ${bg}` },\n    [\n      options.langId ? `<div class=\"language-id\">${options.langId}</div>` : \"\",\n      h(\n        \"code\",\n        {},\n        lines.map((line, index) => {\n          const lineNumber = index + 1;\n          const lineOptions = optionsByLineNumber.get(lineNumber) ?? [];\n          const lineClasses = getLineClasses(lineOptions).join(\" \");\n          return h(\n            \"line\",\n            {\n              className: lineClasses,\n              lines,\n              line,\n              index\n            },\n            line.map((token, index2) => {\n              const cssDeclarations = [`color: ${token.color || options.fg}`];\n              if (token.fontStyle & FontStyle.Italic) {\n                cssDeclarations.push(\"font-style: italic\");\n              }\n              if (token.fontStyle & FontStyle.Bold) {\n                cssDeclarations.push(\"font-weight: bold\");\n              }\n              if (token.fontStyle & FontStyle.Underline) {\n                cssDeclarations.push(\"text-decoration: underline\");\n              }\n              return h(\n                \"token\",\n                {\n                  style: cssDeclarations.join(\"; \"),\n                  tokens: line,\n                  token,\n                  index: index2\n                },\n                [escapeHtml(token.content)]\n              );\n            })\n          );\n        })\n      )\n    ]\n  );\n}\nconst htmlEscapes = {\n  \"&\": \"&amp;\",\n  \"<\": \"&lt;\",\n  \">\": \"&gt;\",\n  '\"': \"&quot;\",\n  \"'\": \"&#39;\"\n};\nfunction escapeHtml(html) {\n  return html.replace(/[&<>\"']/g, (chr) => htmlEscapes[chr]);\n}\nfunction getLineClasses(lineOptions) {\n  const lineClasses = /* @__PURE__ */ new Set([\"line\"]);\n  for (const lineOption of lineOptions) {\n    for (const lineClass of lineOption.classes ?? []) {\n      lineClasses.add(lineClass);\n    }\n  }\n  return Array.from(lineClasses);\n}\n\nclass Registry extends Registry$1 {\n  constructor(_resolver) {\n    super(_resolver);\n    this._resolver = _resolver;\n    this.themesPath = \"themes/\";\n    this._resolvedThemes = {};\n    this._resolvedGrammars = {};\n    this._langGraph = /* @__PURE__ */ new Map();\n    this._langMap = languages.reduce((acc, lang) => {\n      acc[lang.id] = lang;\n      return acc;\n    }, {});\n  }\n  getTheme(theme) {\n    if (typeof theme === \"string\") {\n      return this._resolvedThemes[theme];\n    } else {\n      return theme;\n    }\n  }\n  async loadTheme(theme) {\n    if (typeof theme === \"string\") {\n      if (!this._resolvedThemes[theme]) {\n        this._resolvedThemes[theme] = await fetchTheme(`${this.themesPath}${theme}.json`);\n      }\n      return this._resolvedThemes[theme];\n    } else {\n      theme = toShikiTheme(theme);\n      if (theme.name) {\n        this._resolvedThemes[theme.name] = theme;\n      }\n      return theme;\n    }\n  }\n  async loadThemes(themes) {\n    return await Promise.all(themes.map((theme) => this.loadTheme(theme)));\n  }\n  getLoadedThemes() {\n    return Object.keys(this._resolvedThemes);\n  }\n  getGrammar(name) {\n    return this._resolvedGrammars[name];\n  }\n  async loadLanguage(lang) {\n    const embeddedLanguages = lang.embeddedLangs?.reduce(async (acc, l, idx) => {\n      if (!this.getLoadedLanguages().includes(l) && this._resolver.getLangRegistration(l)) {\n        await this._resolver.loadGrammar(this._resolver.getLangRegistration(l).scopeName);\n        acc[this._resolver.getLangRegistration(l).scopeName] = idx + 2;\n        return acc;\n      }\n    }, {});\n    const grammarConfig = {\n      embeddedLanguages,\n      balancedBracketSelectors: lang.balancedBracketSelectors || [\"*\"],\n      unbalancedBracketSelectors: lang.unbalancedBracketSelectors || []\n    };\n    const g = await this.loadGrammarWithConfiguration(lang.scopeName, 1, grammarConfig);\n    this._resolvedGrammars[lang.id] = g;\n    if (lang.aliases) {\n      lang.aliases.forEach((la) => {\n        this._resolvedGrammars[la] = g;\n      });\n    }\n  }\n  async loadLanguages(langs) {\n    for (const lang of langs) {\n      this.resolveEmbeddedLanguages(lang);\n    }\n    const langsGraphArray = Array.from(this._langGraph.values());\n    for (const lang of langsGraphArray) {\n      this._resolver.addLanguage(lang);\n    }\n    for (const lang of langsGraphArray) {\n      await this.loadLanguage(lang);\n    }\n  }\n  getLoadedLanguages() {\n    return Object.keys(this._resolvedGrammars);\n  }\n  resolveEmbeddedLanguages(lang) {\n    if (!this._langGraph.has(lang.id)) {\n      this._langGraph.set(lang.id, lang);\n    }\n    if (lang.embeddedLangs) {\n      for (const embeddedLang of lang.embeddedLangs) {\n        this._langGraph.set(embeddedLang, this._langMap[embeddedLang]);\n      }\n    }\n  }\n}\n\nfunction resolveLang(lang) {\n  return typeof lang === \"string\" ? languages.find((l) => l.id === lang || l.aliases?.includes(lang)) : lang;\n}\nfunction resolveOptions(options) {\n  let _languages = languages;\n  let _themes = options.themes || [];\n  let _wasmPath = options.paths?.wasm ? options.paths.wasm.endsWith(\"/\") ? options.paths.wasm : options.paths.wasm + \"/\" : WASM_PATH;\n  if (options.langs) {\n    _languages = options.langs.map(resolveLang);\n  }\n  if (options.theme) {\n    _themes.unshift(options.theme);\n  }\n  if (!_themes.length) {\n    _themes = [\"nord\"];\n  }\n  return { _languages, _themes, _wasmPath };\n}\nfunction generateDefaultColorReplacements() {\n  const replacements = {\n    \"#000001\": \"var(--shiki-color-text)\",\n    \"#000002\": \"var(--shiki-color-background)\",\n    \"#000004\": \"var(--shiki-token-constant)\",\n    \"#000005\": \"var(--shiki-token-string)\",\n    \"#000006\": \"var(--shiki-token-comment)\",\n    \"#000007\": \"var(--shiki-token-keyword)\",\n    \"#000008\": \"var(--shiki-token-parameter)\",\n    \"#000009\": \"var(--shiki-token-function)\",\n    \"#000010\": \"var(--shiki-token-string-expression)\",\n    \"#000011\": \"var(--shiki-token-punctuation)\",\n    \"#000012\": \"var(--shiki-token-link)\"\n  };\n  for (let i = 0; i < namedColors.length; i++) {\n    const code = `#A${i.toString().padStart(5, \"0\")}`;\n    const colorNameKebab = namedColors[i].replace(/([a-z])([A-Z])/g, \"$1-$2\").toLowerCase();\n    replacements[code] = `var(--shiki-color-ansi-${colorNameKebab})`;\n  }\n  return replacements;\n}\nasync function getHighlighter(options) {\n  const { _languages, _themes, _wasmPath } = resolveOptions(options);\n  const _resolver = new Resolver(getOniguruma(_wasmPath), \"vscode-oniguruma\");\n  const _registry = new Registry(_resolver);\n  if (options.paths?.themes) {\n    _registry.themesPath = options.paths.themes.endsWith(\"/\") ? options.paths.themes : options.paths.themes + \"/\";\n  }\n  if (options.paths?.languages) {\n    _resolver.languagesPath = options.paths.languages.endsWith(\"/\") ? options.paths.languages : options.paths.languages + \"/\";\n  }\n  const themes = await _registry.loadThemes(_themes);\n  const _defaultTheme = themes[0];\n  let _currentTheme;\n  await _registry.loadLanguages(_languages);\n  let COLOR_REPLACEMENTS = generateDefaultColorReplacements();\n  function setColorReplacements(map) {\n    COLOR_REPLACEMENTS = map;\n  }\n  function fixCssVariablesTheme(theme, colorMap) {\n    theme.bg = COLOR_REPLACEMENTS[theme.bg] || theme.bg;\n    theme.fg = COLOR_REPLACEMENTS[theme.fg] || theme.fg;\n    Object.entries(theme.colors).forEach(([key, value]) => {\n      theme.colors[key] = COLOR_REPLACEMENTS[value] || value;\n    });\n    colorMap.forEach((val, i) => {\n      colorMap[i] = COLOR_REPLACEMENTS[val] || val;\n    });\n  }\n  function getTheme(theme) {\n    const _theme = theme ? _registry.getTheme(theme) : _defaultTheme;\n    if (!_theme) {\n      throw Error(`No theme registration for ${theme}`);\n    }\n    if (!_currentTheme || _currentTheme.name !== _theme.name) {\n      _registry.setTheme(_theme);\n      _currentTheme = _theme;\n    }\n    const _colorMap = _registry.getColorMap();\n    if (_theme.type === \"css\") {\n      fixCssVariablesTheme(_theme, _colorMap);\n    }\n    return { _theme, _colorMap };\n  }\n  function getGrammar(lang) {\n    const _grammar = _registry.getGrammar(lang);\n    if (!_grammar) {\n      throw Error(`No language registration for ${lang}`);\n    }\n    return { _grammar };\n  }\n  function codeToThemedTokens(code, lang = \"text\", theme, options2 = { includeExplanation: true }) {\n    if (isPlaintext(lang)) {\n      const lines = code.split(/\\r\\n|\\r|\\n/);\n      return [...lines.map((line) => [{ content: line }])];\n    }\n    const { _grammar } = getGrammar(lang);\n    const { _theme, _colorMap } = getTheme(theme);\n    return tokenizeWithTheme(_theme, _colorMap, code, _grammar, options2);\n  }\n  function ansiToThemedTokens(ansi, theme) {\n    const { _theme } = getTheme(theme);\n    return tokenizeAnsiWithTheme(_theme, ansi);\n  }\n  function codeToHtml(code, arg1 = \"text\", arg2) {\n    let options2;\n    if (typeof arg1 === \"object\") {\n      options2 = arg1;\n    } else {\n      options2 = {\n        lang: arg1,\n        theme: arg2\n      };\n    }\n    const tokens = codeToThemedTokens(code, options2.lang, options2.theme, {\n      includeExplanation: false\n    });\n    const { _theme } = getTheme(options2.theme);\n    return renderToHtml(tokens, {\n      fg: _theme.fg,\n      bg: _theme.bg,\n      lineOptions: options2?.lineOptions,\n      themeName: _theme.name\n    });\n  }\n  function ansiToHtml(ansi, options2) {\n    const tokens = ansiToThemedTokens(ansi, options2?.theme);\n    const { _theme } = getTheme(options2?.theme);\n    return renderToHtml(tokens, {\n      fg: _theme.fg,\n      bg: _theme.bg,\n      lineOptions: options2?.lineOptions,\n      themeName: _theme.name\n    });\n  }\n  async function loadTheme(theme) {\n    await _registry.loadTheme(theme);\n  }\n  async function loadLanguage(lang) {\n    const _lang = resolveLang(lang);\n    _resolver.addLanguage(_lang);\n    await _registry.loadLanguage(_lang);\n  }\n  function getLoadedThemes() {\n    return _registry.getLoadedThemes();\n  }\n  function getLoadedLanguages() {\n    return _registry.getLoadedLanguages();\n  }\n  function getBackgroundColor(theme) {\n    const { _theme } = getTheme(theme);\n    return _theme.bg;\n  }\n  function getForegroundColor(theme) {\n    const { _theme } = getTheme(theme);\n    return _theme.fg;\n  }\n  return {\n    codeToThemedTokens,\n    codeToHtml,\n    ansiToThemedTokens,\n    ansiToHtml,\n    getTheme: (theme) => {\n      return getTheme(theme)._theme;\n    },\n    loadTheme,\n    loadLanguage,\n    getBackgroundColor,\n    getForegroundColor,\n    getLoadedThemes,\n    getLoadedLanguages,\n    setColorReplacements\n  };\n}\nfunction isPlaintext(lang) {\n  return !lang || [\"plaintext\", \"txt\", \"text\"].includes(lang);\n}\n\nfunction setOnigasmWASM(path) {\n  setWasm(path);\n}\n\nexport { languages as BUNDLED_LANGUAGES, themes as BUNDLED_THEMES, FontStyle, getHighlighter, fetchTheme as loadTheme, renderToHtml, setCDN, setOnigasmWASM, setWasm, toShikiTheme };\n", "import type { ILanguageRegistration } from 'shiki';\n\nexport const DARK_THEME = 'gh/fisheva/Eva-Theme@master/themes/Eva-Dark';\nexport const LIGHT_THEME = 'npm/shiki@0.14.1/themes/github-light';\nexport const FALLBACK_LANG = 'Plain Text';\n\n/**\n * Note: Use it carefully because it is not a valid language registration.\n */\nexport const PLAIN_TEXT_REGISTRATION = {\n  id: FALLBACK_LANG,\n  scopeName: 'source.plaintext',\n  /**\n   * Do not use this path. It is only used to match the type of `ILanguageRegistration`\n   *\n   * @deprecated\n   */\n  path: 'PLEASE-DO-NOT-USE-THIS' as const,\n  aliases: ['plaintext', 'txt', 'text'],\n} satisfies ILanguageRegistration;\n", "import type { ILanguageRegistration, Lang } from 'shiki';\nimport { BUNDLED_LANGUAGES } from 'shiki';\n\nimport { PLAIN_TEXT_REGISTRATION } from './consts.js';\n\n// TIOBE Index for May 2023\n// ref https://www.tiobe.com/tiobe-index/\nconst PopularLanguages: Lang[] = [\n  // 1-20\n  'python',\n  'c',\n  'java',\n  'cpp',\n  'csharp',\n  'vb',\n  'javascript',\n  'php',\n  'sql',\n  'asm',\n  'pascal',\n  'go',\n  // 'scratch',\n  'swift',\n  'matlab',\n  'r',\n  'rust',\n  'ruby',\n  // 'fortran',\n  // 'classic-visual-basic',\n\n  // 21-50\n  'sas',\n  // '(Visual) FoxPro',\n  'ada',\n  'perl',\n  'objective-c',\n  'cobol',\n  'lisp',\n  'dart',\n  'lua',\n  'julia',\n  // 'transact-SQL',\n  'd',\n  'kotlin',\n  'logo',\n  'scala',\n  'haskell',\n  'fsharp',\n  'scheme',\n  // 'cfml',\n  'typescript',\n  'groovy',\n  'abap',\n  'prolog',\n  'plsql',\n  // 'ml',\n  // 'bourne shell',\n  // 'forth',\n  // 'crystal',\n  'bash',\n  'apex',\n  //  50\n\n  // Other\n  'markdown',\n  'json',\n  'html',\n  'css',\n  'diff',\n  'jsx',\n  'tsx',\n  'vue',\n];\n\nexport const POPULAR_LANGUAGES_MAP: Partial<Record<Lang, number>> =\n  PopularLanguages.reduce((acc, lang, i) => {\n    return {\n      [lang]: i,\n      ...acc,\n    };\n  }, {});\n\nfunction isPlaintext(lang: string) {\n  return [\n    PLAIN_TEXT_REGISTRATION.id,\n    ...PLAIN_TEXT_REGISTRATION.aliases,\n  ].includes(lang.toLowerCase());\n}\n\nexport const getStandardLanguage = (\n  languageName: string | null\n): ILanguageRegistration | null => {\n  if (!languageName) return null;\n  if (isPlaintext(languageName)) {\n    return null;\n  }\n\n  const language = BUNDLED_LANGUAGES.find(\n    codeLanguage =>\n      codeLanguage.id.toLowerCase() === languageName.toLowerCase() ||\n      codeLanguage.aliases?.includes(languageName.toLowerCase())\n  );\n  return language ?? null;\n};\n", "import type { BlockSchemas } from '@blocksuite/global/types';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { DeltaOperation, Page } from '@blocksuite/store';\n\nimport { getStandardLanguage } from '../../code-block/utils/code-languages.js';\nimport { FALLBACK_LANG } from '../../code-block/utils/consts.js';\nimport type { Cell, Column } from '../../index.js';\nimport type { SerializedBlock } from '../utils/index.js';\nimport type { ContentParser } from './index.js';\n\nexport type FetchFileHandler = (\n  fileName: string\n) => Promise<Blob | null | undefined>;\n\nexport type TextStyleHandler = (\n  element: HTMLElement,\n  styles: Record<string, unknown>\n) => void;\n\nexport type TableParserHandler = (\n  element: Element\n) => Promise<SerializedBlock[] | null>;\n\n// There are these uncommon in-line tags that have not been added\n// tt, acronym, dfn, kbd, samp, var, bdo, br, img, map, object, q, script, sub, sup, button, select, TEXTAREA\nconst INLINE_TAGS = [\n  'DEL',\n  'STRONG',\n  'B',\n  'EM',\n  'I',\n  'U',\n  'S',\n  'SPAN',\n  'A',\n  'INPUT',\n  'MARK',\n  'CODE',\n  'LABEL',\n  'BIG',\n  'SMALL',\n  'ABBR',\n  'CITE',\n  'BDI',\n  'TIME',\n];\n\nexport class HtmlParser {\n  private _contentParser: ContentParser;\n  private _page: Page;\n  private _customFetchFileHandler?: FetchFileHandler;\n  private _customTextStyleHandler?: TextStyleHandler;\n  private _customTableParserHandler?: TableParserHandler;\n\n  constructor(\n    contentParser: ContentParser,\n    page: Page,\n    fetchFileHandler?: FetchFileHandler,\n    textStyleHandler?: TextStyleHandler,\n    tableParserHandler?: TableParserHandler\n  ) {\n    this._contentParser = contentParser;\n    this._page = page;\n    this._customFetchFileHandler = fetchFileHandler;\n    this._customTextStyleHandler = textStyleHandler;\n    this._customTableParserHandler = tableParserHandler;\n  }\n\n  private _fetchFileHandler = async (\n    fileName: string\n  ): Promise<Blob | null | undefined> => {\n    if (this._customFetchFileHandler) {\n      const customBlob = await this._customFetchFileHandler(fileName);\n      if (customBlob && customBlob.size > 0) {\n        return customBlob;\n      }\n    }\n\n    let resp;\n    try {\n      resp = await fetch(fileName, {\n        cache: 'no-cache',\n        mode: 'cors',\n        headers: {\n          Origin: window.location.origin,\n        },\n      });\n    } catch (error) {\n      console.error(error);\n      return null;\n    }\n    const imgBlob = await resp.blob();\n    if (!imgBlob.type.startsWith('image/')) {\n      return null;\n    }\n    return imgBlob;\n  };\n\n  public registerParsers() {\n    this._contentParser.registerParserHtmlText2Block(\n      'nodeParser',\n      this._nodeParser\n    );\n    this._contentParser.registerParserHtmlText2Block(\n      'commonParser',\n      this._commonParser\n    );\n    this._contentParser.registerParserHtmlText2Block(\n      'listItemParser',\n      this._listItemParser\n    );\n    this._contentParser.registerParserHtmlText2Block(\n      'blockQuoteParser',\n      this._blockQuoteParser\n    );\n    this._contentParser.registerParserHtmlText2Block(\n      'codeBlockParser',\n      this._codeBlockParser\n    );\n    this._contentParser.registerParserHtmlText2Block(\n      'embedItemParser',\n      this._embedItemParser\n    );\n\n    this._contentParser.registerParserHtmlText2Block(\n      'tableParser',\n      this._tableParser\n    );\n\n    this._contentParser.registerParserHtmlText2Block(\n      'headerParser',\n      this._headerParser\n    );\n  }\n\n  // TODO parse children block\n  private _nodeParser = async (\n    node: Element\n  ): Promise<SerializedBlock[] | null> => {\n    let result;\n    // custom parser\n    result = await this._contentParser.getParserHtmlText2Block(\n      'customNodeParser'\n    )?.(node);\n    if (result && result.length > 0) {\n      return result;\n    }\n\n    const tagName = node.tagName;\n    const isInlineOrLeaf =\n      node instanceof Text || INLINE_TAGS.includes(tagName);\n    if (isInlineOrLeaf && node.textContent?.length) {\n      result = await this._contentParser.getParserHtmlText2Block(\n        'commonParser'\n      )?.({\n        element: node,\n        flavour: 'affine:paragraph',\n        type: 'text',\n      });\n    } else {\n      switch (tagName) {\n        case 'H1':\n        case 'H2':\n        case 'H3':\n        case 'H4':\n        case 'H5':\n        case 'H6':\n          result = await this._contentParser.getParserHtmlText2Block(\n            'commonParser'\n          )?.({\n            element: node,\n            flavour: 'affine:paragraph',\n            type: tagName.toLowerCase(),\n          });\n          break;\n        case 'BLOCKQUOTE':\n          result = await this._contentParser.getParserHtmlText2Block(\n            'blockQuoteParser'\n          )?.(node);\n          break;\n        case 'P':\n          if (\n            node.firstChild instanceof Text &&\n            (node.firstChild.textContent?.startsWith('[] ') ||\n              node.firstChild.textContent?.startsWith('[ ] ') ||\n              node.firstChild.textContent?.startsWith('[x] '))\n          ) {\n            result = await this._contentParser.getParserHtmlText2Block(\n              'listItemParser'\n            )?.(node);\n          } else if (node.firstChild instanceof HTMLImageElement) {\n            result = await this._contentParser.getParserHtmlText2Block(\n              'embedItemParser'\n            )?.(node.firstChild);\n          } else if (\n            node.firstElementChild?.tagName === 'A' ||\n            node.firstElementChild?.getAttribute('href')?.endsWith('.csv')\n          ) {\n            result = await this._contentParser.getParserHtmlText2Block(\n              'tableParser'\n            )?.(node.firstChild);\n          } else {\n            result = await this._contentParser.getParserHtmlText2Block(\n              'commonParser'\n            )?.({\n              element: node,\n              flavour: 'affine:paragraph',\n              type: 'text',\n            });\n          }\n          break;\n        case 'LI':\n          result = await this._contentParser.getParserHtmlText2Block(\n            'listItemParser'\n          )?.(node);\n          break;\n        case 'HR':\n          result = await this._contentParser.getParserHtmlText2Block(\n            'commonParser'\n          )?.({\n            element: node,\n            flavour: 'affine:divider',\n          });\n          break;\n        case 'PRE':\n          result = await this._contentParser.getParserHtmlText2Block(\n            'codeBlockParser'\n          )?.(node);\n          break;\n        case 'FIGURE':\n        case 'IMG':\n          {\n            result = await this._contentParser.getParserHtmlText2Block(\n              'embedItemParser'\n            )?.(node);\n          }\n          break;\n        case 'HEADER':\n          result = await this._contentParser.getParserHtmlText2Block(\n            'headerParser'\n          )?.(node);\n          break;\n        case 'TABLE':\n          result = await this._contentParser.getParserHtmlText2Block(\n            'tableParser'\n          )?.(node);\n          break;\n        default:\n          break;\n      }\n    }\n\n    if (result && result.length > 0) {\n      return result;\n    }\n\n    // If node.childNodes are all inline elements or text nodes, merge them into one paragraph.\n    if (node.childNodes.length > 0) {\n      const hasNonInlineOrNonLeaf = Array.from(node.childNodes).some(child => {\n        if (child.nodeType === Node.TEXT_NODE) {\n          return false;\n        }\n\n        if (child.nodeType === Node.ELEMENT_NODE) {\n          const childElement = child as Element;\n          const isInlineElement =\n            INLINE_TAGS.includes(childElement.tagName) ||\n            (childElement.tagName.includes('-') &&\n              checkWebComponentIfInline(childElement));\n          return !isInlineElement;\n        }\n\n        return true;\n      });\n\n      if (!hasNonInlineOrNonLeaf) {\n        const allInlineResult = await this._commonHTML2Block(\n          node,\n          'affine:paragraph',\n          'text'\n        );\n        if (allInlineResult) {\n          return [allInlineResult];\n        }\n      }\n    }\n\n    const openBlockPromises = Array.from(node.children).map(\n      async childElement => {\n        const clipBlockInfos =\n          (await this._contentParser.getParserHtmlText2Block('nodeParser')?.(\n            childElement\n          )) || [];\n        return clipBlockInfos;\n      }\n    );\n\n    const results: Array<SerializedBlock[]> = [];\n    for (const item of openBlockPromises) {\n      results.push(await item);\n    }\n    return results.flat().filter(v => v);\n  };\n\n  private _commonParser = async ({\n    element,\n    flavour,\n    type,\n    checked,\n    ignoreEmptyElement = true,\n  }: {\n    element: Element;\n    flavour: string;\n    type: string;\n    checked?: boolean;\n    ignoreEmptyElement?: boolean;\n  }): Promise<SerializedBlock[] | null> => {\n    const res = await this._commonHTML2Block(\n      element,\n      flavour,\n      type,\n      checked,\n      ignoreEmptyElement\n    );\n    return res ? [res] : null;\n  };\n\n  private async _commonHTML2Block(\n    element: Element,\n    flavour: string,\n    type: string,\n    checked?: boolean,\n    ignoreEmptyElement = true\n  ): Promise<SerializedBlock | null> {\n    const childNodes = element.childNodes;\n    let isChildNode = false;\n    const textValues: DeltaOperation[] = [];\n    const children = [];\n    for (let i = 0; i < childNodes.length; i++) {\n      const node = childNodes.item(i);\n      if (!node) continue;\n      if (node.nodeName === '#comment') continue;\n      if (node.nodeName === 'STYLE') continue;\n      if (!isChildNode) {\n        if (node instanceof Text) {\n          textValues.push(\n            ...this._commonHTML2Text(node, {}, ignoreEmptyElement)\n          );\n          continue;\n        }\n        const htmlElement = node as HTMLElement;\n        if (\n          INLINE_TAGS.includes(htmlElement.tagName) ||\n          (htmlElement.tagName.includes('-') &&\n            checkWebComponentIfInline(htmlElement))\n        ) {\n          textValues.push(\n            ...this._commonHTML2Text(node, {}, ignoreEmptyElement)\n          );\n          continue;\n        }\n      }\n      if (node instanceof Element) {\n        const childNode = await this._nodeParser(node);\n        childNode && children.push(...childNode);\n      }\n      isChildNode = true;\n    }\n\n    if (textValues.length === 0 && children.length === 1) {\n      return {\n        flavour: flavour as keyof BlockSchemas,\n        type: type,\n        checked: checked,\n        text: children[0].text,\n        children: children[0].children,\n      };\n    }\n\n    if (\n      textValues.length === 0 &&\n      children.length > 0 &&\n      flavour === 'affine:list'\n    ) {\n      return {\n        flavour: flavour as keyof BlockSchemas,\n        type: type,\n        checked: checked,\n        text: children[0].text,\n        children: children.slice(1),\n      };\n    }\n\n    return {\n      flavour: flavour as keyof BlockSchemas,\n      type: type,\n      checked: checked,\n      text: textValues,\n      children: children,\n    };\n  }\n\n  private _commonHTML2Text(\n    element: Element | Node,\n    textStyle: { [key: string]: unknown } = {},\n    ignoreEmptyText = true\n  ): DeltaOperation[] {\n    if (element instanceof Text) {\n      let isLinkPage = false;\n      if (textStyle.reference) {\n        isLinkPage =\n          (textStyle.reference as Record<string, unknown>).type ===\n          'LinkedPage';\n      }\n      return (element.textContent || '').split('\\n').map(text => {\n        return {\n          insert: isLinkPage ? ' ' : text,\n          attributes: textStyle,\n        };\n      });\n    }\n    const htmlElement = element as HTMLElement;\n    if (htmlElement.classList.contains('katex-mathml')) {\n      return [];\n    }\n    const childNodes = Array.from(htmlElement.childNodes);\n    const currentTextStyle = getTextStyle(htmlElement);\n    this._customTextStyleHandler &&\n      this._customTextStyleHandler(htmlElement, currentTextStyle);\n\n    if (!childNodes.length) {\n      return ignoreEmptyText\n        ? []\n        : [\n            {\n              insert: '',\n              attributes: currentTextStyle,\n            },\n          ];\n    }\n\n    return childNodes\n      .reduce((result, childNode) => {\n        const textBlocks = this._commonHTML2Text(\n          childNode,\n          {\n            ...textStyle,\n            ...currentTextStyle,\n          },\n          ignoreEmptyText\n        );\n        result.push(...textBlocks);\n        return result;\n      }, [] as DeltaOperation[])\n      .filter(v => v);\n  }\n\n  private _listItemParser = async (\n    element: Element\n  ): Promise<SerializedBlock[] | null> => {\n    const tagName = element.parentElement?.tagName;\n    let type = tagName === 'OL' ? 'numbered' : 'bulleted';\n    if (\n      element.firstElementChild?.tagName === 'DETAIL' ||\n      element.firstElementChild?.firstElementChild?.tagName === 'SUMMARY'\n    ) {\n      const summary = await this._contentParser.getParserHtmlText2Block(\n        'commonParser'\n      )?.({\n        element: element.firstElementChild.firstElementChild,\n        flavour: 'affine:list',\n        type: type,\n      });\n      const childNodes = element.firstElementChild.childNodes;\n      const children = [];\n      for (let i = 1; i < childNodes.length; i++) {\n        const node = childNodes.item(i);\n        if (!node) continue;\n        if (node instanceof Element) {\n          const childNode = await this._nodeParser(node);\n          childNode && children.push(...childNode);\n        }\n      }\n      if (summary && summary.length > 0) {\n        summary[0].children = [...(summary[0].children || []), ...children];\n      }\n      return summary;\n    }\n    let checked;\n    let inputEl;\n    if (\n      (inputEl = element.firstElementChild)?.tagName === 'INPUT' ||\n      (inputEl = element.firstElementChild?.firstElementChild)?.tagName ===\n        'INPUT'\n    ) {\n      type = 'todo';\n      checked = inputEl?.getAttribute('checked') !== null;\n    }\n    if (element.firstChild instanceof Text) {\n      if (element.firstChild.textContent?.startsWith('[] ')) {\n        element.firstChild.textContent =\n          element.firstChild.textContent.slice(3);\n        type = 'todo';\n        checked = false;\n      } else if (element.firstChild.textContent?.startsWith('[ ] ')) {\n        element.firstChild.textContent =\n          element.firstChild.textContent.slice(4);\n        type = 'todo';\n        checked = false;\n      } else if (element.firstChild.textContent?.startsWith('[x] ')) {\n        element.firstChild.textContent =\n          element.firstChild.textContent.slice(4);\n        type = 'todo';\n        checked = true;\n      }\n    }\n    return this._contentParser.getParserHtmlText2Block('commonParser')?.({\n      element: element,\n      flavour: 'affine:list',\n      type: type,\n      checked: checked,\n    });\n  };\n\n  private _blockQuoteParser = async (\n    element: Element\n  ): Promise<SerializedBlock[] | null> => {\n    const getText = (list: SerializedBlock[]): SerializedBlock['text'] => {\n      const result: SerializedBlock['text'] = [];\n      list.forEach(item => {\n        const texts = item.text?.filter(textItem => textItem.insert) || [];\n        if (result.length > 0 && texts.length > 0) {\n          result.push({ insert: '\\n' });\n        }\n        result.push(...texts);\n\n        const childTexts = getText(item.children || []) || [];\n        if (result.length > 0 && childTexts.length > 0) {\n          result.push({ insert: '\\n' });\n        }\n        result.push(...childTexts);\n      });\n      return result;\n    };\n\n    const commonResult = await this._contentParser.getParserHtmlText2Block(\n      'commonParser'\n    )?.({\n      element: element,\n      flavour: 'affine:paragraph',\n      type: 'text',\n    });\n    if (!commonResult) {\n      return null;\n    }\n\n    return [\n      {\n        flavour: 'affine:paragraph',\n        type: 'quote',\n        text: getText(commonResult),\n        children: [],\n      },\n    ];\n  };\n\n  private _codeBlockParser = async (\n    element: Element\n  ): Promise<SerializedBlock[] | null> => {\n    // code block doesn't parse other nested Markdown syntax, thus is always one layer deep, example:\n    // <pre><code class=\"language-typescript\">code content</code></pre>\n    const firstChild = element.children[0];\n    const languageTag = firstChild?.getAttribute('class')?.split('-');\n    const isNormalMarkdown =\n      firstChild.tagName === 'Code' && languageTag?.[0] === 'language';\n    let content = '';\n    let language = FALLBACK_LANG;\n    if (isNormalMarkdown) {\n      content = element.firstChild?.textContent || '';\n      language = getStandardLanguage(languageTag?.[1])?.id || FALLBACK_LANG;\n    } else {\n      content = element.textContent || '';\n    }\n    return [\n      {\n        flavour: 'affine:code',\n        text: [\n          {\n            insert: content,\n          },\n        ],\n        children: [],\n        language,\n      },\n    ];\n  };\n\n  private _embedItemParser = async (\n    element: Element\n  ): Promise<SerializedBlock[] | null> => {\n    let result: SerializedBlock[] | null = [];\n    let imgElement = null;\n    const texts = [];\n    if (element.tagName === 'FIGURE') {\n      imgElement = element.querySelector('img');\n      const figcaptionElement = element.querySelector('figcaption');\n      if (figcaptionElement) {\n        const captionResult = await this._contentParser.getParserHtmlText2Block(\n          'commonParser'\n        )?.({\n          element: figcaptionElement,\n          flavour: 'affine:paragraph',\n          type: 'text',\n        });\n        if (captionResult && captionResult.length > 0) {\n          texts.push(...(captionResult[0].text || []));\n        }\n      }\n    } else if (element instanceof HTMLImageElement) {\n      imgElement = element;\n      texts.push({ insert: '' });\n    }\n    if (imgElement) {\n      const imgUrl = imgElement.getAttribute('src') || '';\n      const imgBlob = await this._fetchFileHandler(imgUrl);\n      if (!imgBlob || imgBlob.size === 0) {\n        const texts = [\n          {\n            insert: imgUrl,\n            attributes: {\n              link: imgUrl,\n            },\n          },\n        ];\n        result = [\n          {\n            flavour: 'affine:paragraph',\n            type: 'text',\n            children: [],\n            text: texts,\n          },\n        ];\n      } else {\n        const storage = this._page.blobs;\n        assertExists(storage);\n        const id = await storage.set(imgBlob);\n        result = [\n          {\n            flavour: 'affine:embed',\n            type: 'image',\n            sourceId: id,\n            children: [],\n            text: texts,\n          },\n        ];\n      }\n    }\n\n    return result;\n  };\n\n  // TODO parse children block, this is temporary solution\n  private _tableParser = async (\n    element: Element\n  ): Promise<SerializedBlock[] | null> => {\n    let result: SerializedBlock[] | null = [];\n    if (this._customTableParserHandler) {\n      result = await this._customTableParserHandler(element);\n      if (result && result.length > 0) {\n        return result;\n      }\n    }\n    if (element.tagName === 'TABLE') {\n      const theadElement = element.querySelector('thead');\n      const tbodyElement = element.querySelector('tbody');\n      const titleTrEle = theadElement?.querySelector('tr');\n      let id = 1;\n      const titles: string[] = [];\n      titleTrEle?.querySelectorAll('th').forEach(ele => {\n        titles.push(ele.textContent || '');\n      });\n      const rows: string[][] = [];\n      tbodyElement?.querySelectorAll('tr').forEach(ele => {\n        const row: string[] = [];\n        ele.querySelectorAll('td').forEach(ele => {\n          row.push(ele.textContent || '');\n        });\n        rows.push(row);\n      });\n      const columns: Column[] = titles.slice(1).map((value, index) => {\n        return {\n          name: value,\n          type: 'rich-text',\n          width: 200,\n          hide: false,\n          id: '' + id++,\n        };\n      });\n      if (rows.length > 0) {\n        let maxLen = rows[0].length;\n        for (let i = 1; i < rows.length; i++) {\n          maxLen = Math.max(maxLen, rows[i].length);\n        }\n        const addNum = maxLen - columns.length;\n        for (let i = 0; i < addNum; i++) {\n          columns.push({\n            name: '',\n            type: 'rich-text',\n            width: 200,\n            hide: false,\n            id: '' + id++,\n          });\n        }\n      }\n      const databasePropsId = id++;\n      const cells: Record<string, Record<string, Cell>> = {};\n      const children: SerializedBlock[] = [];\n      rows.forEach(row => {\n        children.push({\n          flavour: 'affine:paragraph',\n          type: 'text',\n          text: [{ insert: row[0] }],\n          children: [],\n        });\n        const rowId = '' + id++;\n        cells[rowId] = {};\n        row.slice(1).forEach((value, index) => {\n          cells[rowId][columns[index].id] = {\n            columnId: columns[index].id,\n            value,\n          };\n        });\n      });\n\n      result = [\n        {\n          flavour: 'affine:database',\n          databaseProps: {\n            id: '' + databasePropsId,\n            title: 'Database',\n            titleColumnName: titles[0],\n            titleColumnWidth: 432,\n            rowIds: Object.keys(cells),\n            cells: cells,\n            columns: columns,\n          },\n          children: children,\n        },\n      ];\n    }\n    return result;\n  };\n\n  private _headerParser = async (\n    element: Element\n  ): Promise<SerializedBlock[] | null> => {\n    let node = element;\n    if (element.getElementsByClassName('page-title').length > 0) {\n      node = element.getElementsByClassName('page-title')[0];\n    }\n\n    const tagName = node.tagName;\n    const result = await this._contentParser.getParserHtmlText2Block(\n      'commonParser'\n    )?.({\n      element: node,\n      flavour: 'affine:page',\n      type: tagName.toLowerCase(),\n    });\n    return result;\n  };\n}\n\nconst getIsLink = (htmlElement: HTMLElement) => {\n  return ['A'].includes(htmlElement.tagName);\n};\n\nconst getTextStyle = (htmlElement: HTMLElement) => {\n  const tagName = htmlElement.tagName;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const textStyle: { [key: string]: any } = {};\n\n  const style = (htmlElement.getAttribute('style') || '')\n    .split(';')\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    .reduce((style: { [key: string]: any }, styleString) => {\n      const [key, value] = styleString.split(':');\n      if (key && value) {\n        style[key] = value;\n      }\n      return style;\n    }, {});\n\n  if (\n    style['font-weight'] === 'bold' ||\n    Number(style['font-weight']) > 400 ||\n    ['STRONG', 'B', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6'].includes(\n      htmlElement.tagName\n    )\n  ) {\n    textStyle['bold'] = true;\n  }\n  if (getIsLink(htmlElement)) {\n    const linkUrl =\n      htmlElement.getAttribute('href') || htmlElement.getAttribute('src');\n    textStyle['link'] = linkUrl;\n  }\n\n  if (tagName === 'EM' || style['fontStyle'] === 'italic') {\n    textStyle['italic'] = true;\n  }\n  if (\n    tagName === 'U' ||\n    (style['text-decoration'] &&\n      style['text-decoration'].indexOf('underline') !== -1) ||\n    style['border-bottom']\n  ) {\n    textStyle['underline'] = true;\n  }\n  if (tagName === 'CODE') {\n    textStyle['code'] = true;\n  }\n  if (\n    tagName === 'S' ||\n    tagName === 'DEL' ||\n    (style['text-decoration'] &&\n      style['text-decoration'].indexOf('line-through') !== -1)\n  ) {\n    textStyle['strike'] = true;\n  }\n  if (tagName === 'MARK') {\n    textStyle['background'] = 'yellow';\n  }\n\n  return textStyle;\n};\n\nconst checkWebComponentIfInline = (element: Element) => {\n  const style = window.getComputedStyle(element);\n\n  return (\n    style.display.includes('inline') ||\n    (element as HTMLElement).style.display.includes('inline')\n  );\n};\n", "import { assertExists } from '@blocksuite/global/utils';\nimport type { BaseBlockModel, Page } from '@blocksuite/store';\nimport { Slot } from '@blocksuite/store';\nimport { toPng } from 'html-to-image';\nimport { marked } from 'marked';\n\nimport type { PageBlockModel } from '../../models.js';\nimport { getFileFromClipboard } from '../clipboard/utils/pure.js';\nimport { getEditorContainer, type SerializedBlock } from '../utils/index.js';\nimport { FileExporter } from './file-exporter/file-exporter.js';\nimport type {\n  FetchFileHandler,\n  TableParserHandler,\n  TextStyleHandler,\n} from './parse-html.js';\nimport { HtmlParser } from './parse-html.js';\nimport type { SelectedBlock } from './types.js';\n\ntype ParseHtml2BlockHandler = (\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ...args: any[]\n) => Promise<SerializedBlock[] | null>;\n\nexport class ContentParser {\n  private _page: Page;\n  readonly slots = {\n    beforeHtml2Block: new Slot<Element>(),\n  };\n  private _parsers: Record<string, ParseHtml2BlockHandler> = {};\n  private _htmlParser: HtmlParser;\n  private urlPattern =\n    /(?<=\\s|^)https?:\\/\\/(?:www\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b(?:[-a-zA-Z0-9()@:%_+.~#?&/=]*)(?=\\s|$)/g;\n  constructor(\n    page: Page,\n    fetchFileHandler?: FetchFileHandler,\n    textStyleHandler?: TextStyleHandler,\n    tableParserHandler?: TableParserHandler\n  ) {\n    this._page = page;\n    this._htmlParser = new HtmlParser(\n      this,\n      page,\n      fetchFileHandler,\n      textStyleHandler,\n      tableParserHandler\n    );\n    this._htmlParser.registerParsers();\n  }\n\n  public async exportHtml() {\n    const root = this._page.root;\n    if (!root) return;\n    const htmlContent = await this.block2Html(\n      this._getSelectedBlock(root).children[1].children\n    );\n    FileExporter.exportHtml(\n      (root as PageBlockModel).title.toString(),\n      htmlContent\n    );\n  }\n\n  public async exportMarkdown() {\n    const root = this._page.root;\n    if (!root) return;\n    const htmlContent = await this.block2Html(\n      this._getSelectedBlock(root).children[1].children\n    );\n    FileExporter.exportHtmlAsMarkdown(\n      (root as PageBlockModel).title.toString(),\n      htmlContent\n    );\n  }\n\n  public async exportPng() {\n    const root = this._page.root;\n    if (!root) return;\n    const editorContainer = getEditorContainer(this._page);\n    const styleElement = document.createElement('style');\n    styleElement.textContent =\n      'editor-container,.affine-editor-container {height: auto;}';\n    editorContainer.appendChild(styleElement);\n\n    FileExporter.exportPng(\n      (root as PageBlockModel).title.toString(),\n      await toPng(editorContainer, {\n        cacheBust: true,\n      })\n    );\n\n    editorContainer.removeChild(styleElement);\n  }\n\n  public async exportPdf() {\n    const root = this._page.root;\n    if (!root) return;\n    window.print();\n  }\n\n  public async block2Html(blocks: SelectedBlock[]): Promise<string> {\n    let htmlText = '';\n    for (let currentIndex = 0; currentIndex < blocks.length; currentIndex++) {\n      htmlText =\n        htmlText +\n        (await this._getHtmlInfoBySelectionInfo(blocks[currentIndex]));\n    }\n    return htmlText;\n  }\n\n  public async block2Text(blocks: SelectedBlock[]): Promise<string> {\n    return (\n      await Promise.all(\n        blocks.map(block => this._getTextInfoBySelectionInfo(block))\n      )\n    ).reduce((text, block) => text + block, '');\n  }\n\n  public async htmlText2Block(html: string): Promise<SerializedBlock[]> {\n    const htmlEl = document.createElement('html');\n    htmlEl.innerHTML = html;\n    htmlEl.querySelector('head')?.remove();\n    this.slots.beforeHtml2Block.emit(htmlEl);\n    return this._convertHtml2Blocks(htmlEl);\n  }\n\n  async file2Blocks(clipboardData: DataTransfer): Promise<SerializedBlock[]> {\n    const file = getFileFromClipboard(clipboardData);\n    if (file) {\n      if (file.type.includes('image')) {\n        // TODO: upload file to file server\n        // XXX: should use blob storage here?\n        const storage = this._page.blobs;\n        assertExists(storage);\n        const id = await storage.set(file);\n        return [\n          {\n            flavour: 'affine:embed',\n            type: 'image',\n            sourceId: id,\n            children: [],\n          },\n        ];\n      }\n    }\n    return [];\n  }\n\n  public async markdown2Block(text: string): Promise<SerializedBlock[]> {\n    const underline = {\n      name: 'underline',\n      level: 'inline',\n      start(src: string) {\n        return src.indexOf('~');\n      },\n      tokenizer(src: string) {\n        const rule = /^~([^~]+)~/;\n        const match = rule.exec(src);\n        if (match) {\n          return {\n            type: 'underline',\n            raw: match[0], // This is the text that you want your token to consume from the source\n            text: match[1].trim(), // You can add additional properties to your tokens to pass along to the renderer\n          };\n        }\n        return;\n      },\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      renderer(token: any) {\n        return `<u>${token.text}</u>`;\n      },\n    };\n    const inlineCode = {\n      name: 'inlineCode',\n      level: 'inline',\n      start(src: string) {\n        return src.indexOf('`');\n      },\n      tokenizer(src: string) {\n        const rule = /^(?:`)(`{2,}?|[^`]+)(?:`)$/g;\n        const match = rule.exec(src);\n        if (match) {\n          return {\n            type: 'inlineCode',\n            raw: match[0], // This is the text that you want your token to consume from the source\n            text: match[1].trim(), // You can add additional properties to your tokens to pass along to the renderer\n          };\n        }\n        return;\n      },\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      renderer(token: any) {\n        return `<code>${token.text}</code>`;\n      },\n    };\n    marked.use({ extensions: [underline, inlineCode] });\n    const md2html = marked.parse(text);\n    return this.htmlText2Block(md2html);\n  }\n\n  public async importMarkdown(text: string, insertPositionId: string) {\n    const blocks = await this.markdown2Block(text);\n    const insertBlockModel = this._page.getBlockById(insertPositionId);\n\n    assertExists(insertBlockModel);\n    const { getServiceOrRegister } = await import('../service.js');\n    const service = await getServiceOrRegister(insertBlockModel.flavour);\n\n    service.json2Block(insertBlockModel, blocks);\n  }\n\n  public async importHtml(text: string, insertPositionId: string) {\n    const blocks = await this.htmlText2Block(text);\n    const insertBlockModel = this._page.getBlockById(insertPositionId);\n\n    assertExists(insertBlockModel);\n    const { getServiceOrRegister } = await import('../service.js');\n    const service = await getServiceOrRegister(insertBlockModel.flavour);\n\n    service.json2Block(insertBlockModel, blocks);\n  }\n\n  public registerParserHtmlText2Block(\n    name: string,\n    handler: ParseHtml2BlockHandler\n  ) {\n    this._parsers[name] = handler;\n  }\n\n  public getParserHtmlText2Block(name: string): ParseHtml2BlockHandler {\n    return this._parsers[name] || null;\n  }\n\n  public text2blocks(text: string): SerializedBlock[] {\n    return text.split('\\n').map((str: string) => {\n      const splitText = str.split(this.urlPattern);\n      const urls = str.match(this.urlPattern);\n      const result = [];\n\n      for (let i = 0; i < splitText.length; i++) {\n        if (splitText[i]) {\n          result.push({ insert: splitText[i] });\n        }\n        if (urls && urls[i]) {\n          result.push({ insert: urls[i], attributes: { link: urls[i] } });\n        }\n      }\n\n      return {\n        flavour: 'affine:paragraph',\n        type: 'text',\n        text: result,\n        children: [],\n      };\n    });\n  }\n\n  private _getSelectedBlock(model: BaseBlockModel): SelectedBlock {\n    return {\n      id: model.id,\n      children: model.children.map(child => this._getSelectedBlock(child)),\n    };\n  }\n\n  private async _getHtmlInfoBySelectionInfo(\n    block: SelectedBlock\n  ): Promise<string> {\n    const model = this._page.getBlockById(block.id);\n    if (!model) {\n      return '';\n    }\n\n    const children: string[] = [];\n    for (\n      let currentIndex = 0;\n      currentIndex < block.children.length;\n      currentIndex++\n    ) {\n      const childText = await this._getHtmlInfoBySelectionInfo(\n        block.children[currentIndex]\n      );\n      childText && children.push(childText);\n    }\n    const { getServiceOrRegister } = await import('../service.js');\n    const service = await getServiceOrRegister(model.flavour);\n\n    return service.block2html(model, {\n      childText: children.join(''),\n      begin: block.startPos,\n      end: block.endPos,\n    });\n  }\n\n  private async _getTextInfoBySelectionInfo(\n    selectedBlock: SelectedBlock\n  ): Promise<string> {\n    const model = this._page.getBlockById(selectedBlock.id);\n    if (!model) {\n      return '';\n    }\n\n    const children: string[] = [];\n    for (const child of selectedBlock.children) {\n      const childText = await this._getTextInfoBySelectionInfo(child);\n      childText && children.push(childText);\n    }\n\n    const { getServiceOrRegister } = await import('../service.js');\n    const service = await getServiceOrRegister(model.flavour);\n\n    return service.block2Text(model, {\n      childText: children.join(''),\n      begin: selectedBlock.startPos,\n      end: selectedBlock.endPos,\n    });\n  }\n\n  private async _convertHtml2Blocks(\n    element: Element\n  ): Promise<SerializedBlock[]> {\n    const openBlockPromises = Array.from(element.children).map(\n      async childElement => {\n        return (\n          (await this.getParserHtmlText2Block('nodeParser')?.(childElement)) ||\n          []\n        );\n      }\n    );\n\n    const results: Array<SerializedBlock[]> = [];\n    for (const item of openBlockPromises) {\n      results.push(await item);\n    }\n\n    return results.flat().filter(v => v);\n  }\n}\n", "export class MarkdownUtils {\n  private static _checkRegArr: RegExp[] = [\n    /^(#{1,6})[ \\t]*(.+?)[ \\t]*#*\\n+/gm, // header\n    /^ {0,3}\\|?.+\\|.+\\n {0,3}\\|?[ \\t]*:?[ \\t]*(?:[-=]){2,}[ \\t]*:?[ \\t]*\\|[ \\t]*:?[ \\t]*(?:[-=]){2,}[\\s\\S]+?(?:\\n\\n|0)/gm, // table\n    /(?:^|\\n)(?: {0,3})(```+|~~~+)(?: *)([^\\s`~]*)\\n([\\s\\S]*?)\\n(?: {0,3})\\1/g, // codeBlock\n    /(\\n\\n|^\\n?)(( {0,3}([*+-]|\\d+[.])[ \\t]+)[^\\r]+?(0|\\n{2,}(?=\\S)(?![ \\t]*(?:[*+-]|\\d+[.])[ \\t]+)))/gm, // list\n    /!\\[([^\\]]*?)] ?(?:\\n *)?\\[([\\s\\S]*?)]()()()()()/g, // referenceImage\n    /!\\[([^\\]]*?)][ \\t]*()\\([ \\t]?<?([\\S]+?(?:\\([\\S]*?\\)[\\S]*?)?)>?(?: =([*\\d]+[A-Za-z%]{0,4})x([*\\d]+[A-Za-z%]{0,4}))?[ \\t]*(?:([\"'])([^\"]*?)\\6)?[ \\t]?\\)/g, // inlineImage\n    /!\\[([^\\]]*?)][ \\t]*()\\([ \\t]?<([^>]*)>(?: =([*\\d]+[A-Za-z%]{0,4})x([*\\d]+[A-Za-z%]{0,4}))?[ \\t]*(?:(?:([\"'])([^\"]*?)\\6))?[ \\t]?\\)/g, // crazyImage\n    /!\\[([^\\]]*?)][ \\t]*()\\([ \\t]?<?(data:.+?\\/.+?;base64,[A-Za-z0-9+/=\\n]+?)>?(?: =([*\\d]+[A-Za-z%]{0,4})x([*\\d]+[A-Za-z%]{0,4}))?[ \\t]*(?:([\"'])([^\"]*?)\\6)?[ \\t]?\\)/g, // base64Image\n    // eslint-disable-next-line\n    /!\\[([^\\[\\]]+)]()()()()()/g, // referShortcutImage\n    // eslint-disable-next-line\n    /\\[((?:\\[[^\\]]*]|[^\\[\\]])*)]()[ \\t]*\\([ \\t]?<?([\\S]+?(?:\\([\\S]*?\\)[\\S]*?)?)>?(?:[ \\t]*(([\"'])([^\"]*?)\\5))?[ \\t]?\\)/g, // Generallink\n    // eslint-disable-next-line\n    /\\[((?:\\[[^\\]]*]|[^\\[\\]])*)] ?(?:\\n *)?\\[(.*?)]()()()()/g, // inlineLink\n    // eslint-disable-next-line\n    /\\[((?:\\[[^\\]]*]|[^\\[\\]])*)]()[ \\t]*\\([ \\t]?<([^>]*)>(?:[ \\t]*(([\"'])([^\"]*?)\\5))?[ \\t]?\\)/g, // special link\n    // eslint-disable-next-line\n    /\\[([^\\[\\]]+)]()()()()()/g, // abbreviationlink\n  ];\n\n  /** Extract some grammar rules to check whether a piece of text contains markdown grammar */\n  checkIfTextContainsMd(text: string) {\n    text = text.replace(//g, 'T');\n    text = text.replace(/\\$/g, 'D'); // replace $ with D\n    // Standardize the line position (unify mac, dos)\n    text = text.replace(/\\r\\n/g, '\\n'); // dos\n    text = text.replace(/\\r/g, '\\n'); // mac\n    text = text.replace(/\\u00A0/g, '&nbsp;'); // normalize spaces\n    // 2. Due to the grammatical characteristics of markdown (one \\n is not counted as a newline, two are counted), let the start and end of the text be a pair of newlines, so as to ensure that the first and last lines of the pasted content can be recognized normally\n    text = `\\n\\n${text}\\n\\n`; // 3. Convert tab to space\n    text = MarkdownUtils._detab(text); // 4. Delete lines consisting only of space and tab\n\n    for (let i = 0; i < MarkdownUtils._checkRegArr.length; i++) {\n      const text1 = i === 3 ? `${text}0` : text;\n      if (MarkdownUtils._checkRegArr[i].test(text1)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  private static _detab(text: string) {\n    text = text.replace(/\\t(?=\\t)/g, ' '); // 1 tab === 4 space\n    // turn \\t into a placeholder\n    text = text.replace(/\\t/g, 'AB');\n    // Use placeholders to mark tabs to prevent regular backtracking\n    text = text.replace(/B(.+?)A/g, (_wholeMatch, m1) => {\n      let leadingText = m1;\n      const numSpaces = 4 - (leadingText.length % 4);\n\n      for (let i = 0; i < numSpaces; i++) {\n        leadingText += ' ';\n      }\n\n      return leadingText;\n    });\n    // Convert placeholder to space\n    text = text.replace(/A/g, ' ');\n    text = text.replace(/B/g, '');\n    return text;\n  }\n}\n\nexport default new MarkdownUtils();\n", "import {\n  assertExists,\n  type BaseBlockModel,\n  type DeltaOperation,\n  type Page,\n} from '@blocksuite/store';\n\nimport type { EdgelessPageBlockComponent } from '../../../page-block/edgeless/edgeless-page-block.js';\nimport { ContentParser } from '../../content-parser/index.js';\nimport type { AffineTextAttributes } from '../../rich-text/virgo/types.js';\nimport { getService } from '../../service.js';\nimport {\n  type BlockRange,\n  getCurrentNativeRange,\n  hasNativeSelection,\n  resetNativeSelection,\n  type SerializedBlock,\n} from '../../utils/index.js';\nimport { ClipboardItem } from '../clipboard-item.js';\nimport markdownUtils from './markdown.js';\nimport {\n  CLIPBOARD_MIMETYPE,\n  createHTMLStringForCustomData,\n  extractCustomDataFromHTMLString,\n  isPureFileInClipboard,\n  performNativeCopy,\n} from './pure.js';\n\nexport function getBlockClipboardInfo(\n  model: BaseBlockModel,\n  begin?: number,\n  end?: number\n) {\n  const service = getService(model.flavour);\n  const html = service.block2html(model, { begin, end });\n  const text = service.block2Text(model, { begin, end });\n  // FIXME: the presence of children is not considered\n  // Children json info is collected by its parent, but getCurrentBlockRange.models return parent and children at same time, it should be separated\n  const json = service.block2Json(model, begin, end);\n\n  return {\n    html,\n    text,\n    json,\n    model,\n  };\n}\n\nfunction createPageClipboardItems(range: BlockRange) {\n  const clipGroups = range.models.map((model, index) => {\n    if (index === 0) {\n      return getBlockClipboardInfo(\n        model,\n        range.startOffset,\n        index === range.models.length - 1 ? range.endOffset : undefined\n      );\n    }\n    if (index === range.models.length - 1) {\n      return getBlockClipboardInfo(model, undefined, range.endOffset);\n    }\n    return getBlockClipboardInfo(model);\n  });\n\n  const stringifiesData = JSON.stringify(\n    clipGroups\n      .filter(group => {\n        if (!group.json) {\n          return false;\n        }\n        // XXX: should handle this issue here?\n        // Children json info is collected by its parent,\n        // but getCurrentBlockRange.models return parent and children at same time,\n        // children should be deleted from group\n        return !isChildBlock(range.models, group.model);\n      })\n      .map(group => group.json)\n  );\n\n  // Compatibility handling: In some environments, browsers do not support clipboard mime type other than `text/html` and `text/plain`, so need to store the copied json information in html\n  // Playwright issue: https://github.com/microsoft/playwright/issues/18013\n  const customClipboardFragment = createHTMLStringForCustomData(\n    stringifiesData,\n    CLIPBOARD_MIMETYPE.BLOCKSUITE_PAGE\n  );\n\n  const textClipboardItem = new ClipboardItem(\n    CLIPBOARD_MIMETYPE.TEXT,\n    clipGroups.reduce((text, group, index) => {\n      return `${text}${group.text}${\n        index === clipGroups.length - 1 ? '' : '\\n'\n      }`;\n    }, '')\n  );\n  const htmlClipboardItem = new ClipboardItem(\n    CLIPBOARD_MIMETYPE.HTML,\n    `${clipGroups.map(group => group.html).join('')}${customClipboardFragment}`\n  );\n  const pageClipboardItem = new ClipboardItem(\n    CLIPBOARD_MIMETYPE.BLOCKSUITE_PAGE,\n    stringifiesData\n  );\n\n  return [textClipboardItem, htmlClipboardItem, pageClipboardItem];\n}\n\nexport function copyBlocks(range: BlockRange) {\n  const clipboardItems = createPageClipboardItems(range);\n\n  const savedRange = hasNativeSelection() ? getCurrentNativeRange() : null;\n\n  performNativeCopy(clipboardItems);\n\n  if (savedRange) {\n    resetNativeSelection(savedRange);\n  }\n}\n\nfunction isChildBlock(blocks: BaseBlockModel[], block: BaseBlockModel) {\n  for (let i = 0; i < blocks.length; i++) {\n    const parentBlock = blocks[i];\n    if (parentBlock.children) {\n      if (\n        parentBlock.children.findIndex(\n          childBlock => childBlock.id === block.id\n        ) > -1\n      ) {\n        return true;\n      }\n      if (isChildBlock(parentBlock.children, block)) {\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\nexport async function clipboardData2Blocks(\n  page: Page,\n  clipboardData: ClipboardEvent['clipboardData']\n) {\n  if (!clipboardData) {\n    return [];\n  }\n\n  const contentParser = new ContentParser(page);\n  if (isPureFileInClipboard(clipboardData)) {\n    return contentParser.file2Blocks(clipboardData);\n  }\n\n  const HTMLClipboardData = clipboardData.getData(CLIPBOARD_MIMETYPE.HTML);\n  if (HTMLClipboardData) {\n    const blockSuiteClipboardData = extractCustomDataFromHTMLString(\n      CLIPBOARD_MIMETYPE.BLOCKSUITE_PAGE,\n      clipboardData.getData(CLIPBOARD_MIMETYPE.HTML)\n    );\n\n    if (blockSuiteClipboardData) {\n      return JSON.parse(blockSuiteClipboardData) as SerializedBlock[];\n    }\n  }\n\n  const textClipData = clipboardData.getData(CLIPBOARD_MIMETYPE.TEXT);\n  const shouldConvertMarkdown =\n    markdownUtils.checkIfTextContainsMd(textClipData);\n  if (HTMLClipboardData && !shouldConvertMarkdown) {\n    return await contentParser.htmlText2Block(HTMLClipboardData);\n  }\n\n  if (shouldConvertMarkdown) {\n    return await contentParser.markdown2Block(textClipData);\n  }\n\n  return contentParser.text2blocks(textClipData);\n}\n\n/**\n * Note: This function will modify the deltas **in place**\n */\nexport function normalizeDelta(page: Page, deltas: DeltaOperation[]) {\n  const backlinkIndexer = page.workspace.indexer.backlink;\n  deltas.forEach(delta => {\n    if (\n      !(\n        delta &&\n        delta.attributes &&\n        delta.attributes.reference &&\n        delta.attributes.reference.type === 'Subpage'\n      )\n    ) {\n      return;\n    }\n\n    const refNode: NonNullable<AffineTextAttributes['reference']> =\n      delta.attributes.reference;\n    const parentPage = backlinkIndexer.getParentPage(refNode.pageId);\n    if (!parentPage) {\n      return;\n    }\n    // Each subpage can only be referenced once in a workspace\n    delta.attributes = {\n      ...delta.attributes,\n      reference: {\n        ...refNode,\n        type: 'LinkedPage',\n      },\n    };\n  });\n  return deltas;\n}\n\n/**\n * Replace Subpage reference to LinkedPage reference when try to paste duplicated subpage\n */\nexport function normalizePasteBlocks(page: Page, blocks: SerializedBlock[]) {\n  blocks\n    .filter(block => block.text)\n    .forEach(block => {\n      normalizeDelta(page, block.text as DeltaOperation[]);\n    });\n\n  return blocks;\n}\n\nexport function copySurfaceText(edgeless: EdgelessPageBlockComponent) {\n  const surfaceTextEditor = edgeless.querySelector('surface-text-editor');\n  if (surfaceTextEditor) {\n    const vEditor = surfaceTextEditor.vEditor;\n    assertExists(vEditor);\n    const vRange = vEditor.getVRange();\n    if (vRange) {\n      const text = vEditor.yText\n        .toString()\n        .slice(vRange.index, vRange.index + vRange.length);\n      const clipboardItem = new ClipboardItem(CLIPBOARD_MIMETYPE.TEXT, text);\n\n      surfaceTextEditor.setKeeping(true);\n      // this function will make virgo editor lose focus\n      performNativeCopy([clipboardItem]);\n      surfaceTextEditor.setKeeping(false);\n\n      // restore focus and selection\n      vEditor.rootElement.focus();\n      vEditor.setVRange(vRange);\n    }\n  }\n}\n", "import { css } from 'lit';\n\nexport const styles = css`\n  :host {\n    font-family: var(--affine-font-family);\n  }\n  :host * {\n    box-sizing: border-box;\n  }\n  .overlay-mask {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    background: rgba(0, 0, 0, 0.6);\n    z-index: var(--affine-z-index-modal);\n  }\n  .modal-container {\n    position: absolute;\n    z-index: var(--affine-z-index-modal);\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    width: 720px;\n    padding: 24px 40px;\n    border-radius: 24px;\n    background: var(--affine-background-overlay-panel-color);\n  }\n  .modal-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n  .modal-header-title {\n    color: var(--affine-text-primary-color);\n    font-size: 20px;\n    font-weight: 600;\n  }\n  .modal-header-close-icon {\n    display: flex;\n    align-items: center;\n    color: var(--affine-icon-color);\n    cursor: pointer;\n  }\n  .modal-header-close-icon svg {\n    width: 24px;\n    height: 24px;\n  }\n  .modal-footer {\n    color: var(--affine-text-secondary-color);\n    font-size: 14px;\n    text-align: center;\n  }\n  .modal-body {\n    padding: 24px 0;\n  }\n  .modal-desc {\n    margin-bottom: 38px;\n    color: var(--affine-text-primary-color);\n    font-size: 14px;\n  }\n  .modal-view-container {\n    display: flex;\n    justify-content: center;\n    gap: 18px;\n  }\n  .modal-view-item {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    cursor: pointer;\n  }\n  .modal-view-item.coming-soon {\n    cursor: not-allowed;\n  }\n  .modal-view-item.coming-soon .modal-view-item-content {\n    pointer-events: none;\n  }\n  .modal-view-item-content:hover {\n    background: var(--affine-hover-color);\n  }\n  .modal-view-item-content:hover .modal-view-item-text,\n  .modal-view-item-content:hover svg {\n    fill: var(--affine-primary-color);\n    color: var(--affine-primary-color);\n  }\n  .modal-view-item-content {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: 18px 0;\n    gap: 6px;\n    width: 108px;\n    height: 108px;\n    border: 2px solid var(--affine-border-color);\n    border-radius: 8px;\n  }\n  .modal-view-item-icon {\n    width: 42px;\n    height: 42px;\n  }\n  .modal-view-item-icon svg {\n    width: 42px;\n    height: 42px;\n    fill: var(--affine-black-50);\n  }\n  .modal-view-item-text {\n    font-size: 14px;\n    color: var(--affine-black-50);\n  }\n  .modal-view-item-description {\n    font-size: 12px;\n    color: var(--affine-text-secondary-color);\n    text-align: center;\n  }\n`;\n", "import {\n  DatabaseKanbanViewIcon,\n  DatabaseSearchClose,\n  DatabaseTableViewIcon,\n} from '@blocksuite/global/config';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { Page } from '@blocksuite/store';\nimport { html, LitElement, type TemplateResult } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\n\nimport {\n  getCurrentBlockRange,\n  getDefaultPage,\n} from '../../__internal__/index.js';\nimport type { DatabaseBlockModel } from '../../database-block/index.js';\nimport { styles } from './styles.js';\n\ntype DatabaseViewName = 'table' | 'kanban';\n\ntype DatabaseView = {\n  type: DatabaseViewName;\n  text: string;\n  icon: TemplateResult;\n  description?: string;\n  isComingSoon?: boolean;\n};\n\nconst databaseViews: DatabaseView[] = [\n  {\n    type: 'table',\n    text: 'Table view',\n    icon: DatabaseTableViewIcon,\n  },\n  {\n    type: 'kanban',\n    text: 'Kanban view',\n    icon: DatabaseKanbanViewIcon,\n    description: 'Coming soon',\n    isComingSoon: true,\n  },\n];\n\n@customElement('affine-database-modal')\nexport class DatabaseModal extends LitElement {\n  static override styles = styles;\n\n  @property()\n  page!: Page;\n\n  @state()\n  private _selectedView: DatabaseViewName = 'table';\n\n  @property()\n  abortController!: AbortController;\n\n  private _convertToDatabase(viewType: DatabaseViewName) {\n    if (viewType !== 'table') return;\n    this._hide();\n    this.page.captureSync();\n\n    const range = getCurrentBlockRange(this.page);\n    assertExists(range);\n    const models = range.models;\n\n    const parentModel = this.page.getParent(models[0]);\n    assertExists(parentModel);\n\n    const id = this.page.addBlock(\n      'affine:database',\n      {\n        columns: [],\n        titleColumnName: 'Title',\n      },\n      parentModel,\n      parentModel.children.indexOf(models[0])\n    );\n\n    const databaseModel = this.page.getBlockById(id) as DatabaseBlockModel;\n    assertExists(databaseModel);\n\n    // default column\n    databaseModel.updateColumn({\n      name: 'Tag',\n      type: 'multi-select',\n      width: 200,\n      hide: false,\n      selection: [],\n    });\n    databaseModel.applyColumnUpdate();\n\n    this.page.moveBlocks(models, databaseModel);\n\n    // Try clean block selection\n    const defaultPageBlock = getDefaultPage(this.page);\n    assertExists(defaultPageBlock);\n    if (!defaultPageBlock.selection) {\n      // In the edgeless mode\n      return;\n    }\n    defaultPageBlock.selection.clear();\n  }\n\n  private _hide() {\n    this.abortController.abort();\n  }\n\n  override render() {\n    return html`<div class=\"overlay-root\">\n      <div class=\"overlay-mask\" @click=${this._hide}></div>\n      <div class=\"modal-container\">\n        <div class=\"modal-header\">\n          <div class=\"modal-header-title\">Select Database View</div>\n          <div class=\"modal-header-close-icon\" @click=${this._hide}>\n            ${DatabaseSearchClose}\n          </div>\n        </div>\n        <div class=\"modal-body\">\n          <div class=\"modal-desc\">\n            Group as Database can quickly convert selected blocks into Database\n            for easy structuring of data.\n          </div>\n          <div class=\"modal-view-container\">\n            ${databaseViews.map(view => {\n              const isSelected = view.type === this._selectedView;\n              return html`\n                <div\n                  class=\"modal-view-item ${view.type} ${view.isComingSoon\n                    ? 'coming-soon'\n                    : ''}\"\n                  @click=${() => this._convertToDatabase(view.type)}\n                >\n                  <div\n                    class=\"modal-view-item-content ${isSelected\n                      ? 'selected'\n                      : ''}\"\n                  >\n                    <div class=\"modal-view-item-icon\">${view.icon}</div>\n                    <div class=\"modal-view-item-text\">${view.text}</div>\n                  </div>\n                  <div class=\"modal-view-item-description\">\n                    ${view.description}\n                  </div>\n                </div>\n              `;\n            })}\n          </div>\n        </div>\n        <div class=\"modal-footer\">More views are on the way.</div>\n      </div>\n    </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-database-modal': DatabaseModal;\n  }\n}\n", "import type { Page } from '@blocksuite/store';\nimport { DisposableGroup } from '@blocksuite/store';\n\nimport { DatabaseModal } from './database-modal.js';\n\nexport function showDatabaseModal({\n  page,\n  container = document.body,\n  abortController = new AbortController(),\n}: {\n  page: Page;\n  container?: HTMLElement;\n  abortController?: AbortController;\n}) {\n  const disposables = new DisposableGroup();\n  abortController.signal.addEventListener('abort', () => disposables.dispose());\n\n  const databaseModal = new DatabaseModal();\n  databaseModal.page = page;\n  databaseModal.abortController = abortController;\n  // Mount\n  container.appendChild(databaseModal);\n  disposables.add(() => databaseModal.remove());\n\n  return databaseModal;\n}\n", "import {\n  CopyIcon,\n  DatabaseTableViewIcon,\n  SHORT_KEY,\n} from '@blocksuite/global/config';\nimport { type BaseBlockModel, matchFlavours } from '@blocksuite/store';\nimport { assertExists, type Page } from '@blocksuite/store';\n\nimport { copyBlocks } from '../../__internal__/clipboard/utils/commons.js';\nimport type { AffineTextAttributes } from '../../__internal__/rich-text/virgo/types.js';\nimport { showDatabaseModal } from '../../components/database-modal/index.js';\nimport { toast } from '../../components/toast.js';\nimport { getCurrentBlockRange } from '../../std.js';\n\nexport type ActionProps = {\n  page: Page;\n  abortController?: AbortController;\n  /**\n   * The current format of the selected text\n   */\n  format?: AffineTextAttributes;\n};\n\nconst DATABASE_WHITE_LIST = ['affine:list', 'affine:paragraph'];\n\nexport const actionConfig = [\n  {\n    id: 'copy',\n    name: 'Copy',\n    disabledToolTip: undefined,\n    icon: CopyIcon,\n    hotkey: undefined,\n    showWhen: () => true,\n    enabledWhen: () => true,\n    action: ({ page }: ActionProps) => {\n      const range = getCurrentBlockRange(page);\n      assertExists(range);\n      copyBlocks(range);\n      toast('Copied to clipboard');\n    },\n  },\n  {\n    id: 'convert-to-database',\n    name: 'Group as Database',\n    disabledToolTip:\n      'Contains Block types that cannot be converted to Database. Learn more',\n    icon: DatabaseTableViewIcon,\n    hotkey: `${SHORT_KEY}+g`,\n    showWhen: (page: Page, models: BaseBlockModel[]) => {\n      if (\n        models.length === 1 &&\n        matchFlavours(models[0], ['affine:database'])\n      ) {\n        return false;\n      }\n      const range = getCurrentBlockRange(page);\n      const isShow = range?.type === 'Block';\n      return isShow;\n    },\n    enabledWhen: (page: Page) => {\n      const range = getCurrentBlockRange(page);\n      if (!range) return false;\n      return range.models.every(model =>\n        DATABASE_WHITE_LIST.includes(model.flavour)\n      );\n    },\n    action: ({ page }: ActionProps) => {\n      showDatabaseModal({\n        page,\n      });\n    },\n  },\n];\n", "import { css } from 'lit';\n\nimport { tooltipStyle } from '../tooltip/tooltip.js';\n\nexport const editLinkStyle = css`\n  .affine-link-edit-popover {\n    box-sizing: border-box;\n    width: 404px;\n    height: 112px;\n    padding: 12px;\n    box-shadow: var(--affine-shadow-2);\n    background: var(--affine-background-overlay-panel-color);\n    border-radius: 8px;\n    display: grid;\n    grid-template-columns: auto auto auto;\n    grid-template-rows: repeat(2, 1fr);\n    gap: 12px;\n    grid-template-areas:\n      'text-area .'\n      'link-area btn';\n    justify-items: center;\n    align-items: center;\n    /* breaks 'basic link' test in chromium */\n    /* user-select: none; */\n  }\n\n  .affine-edit-text-area {\n    grid-area: text-area;\n    width: 338px;\n    display: grid;\n    gap: 6px;\n    grid-template-columns: auto auto auto;\n    grid-template-rows: repeat(1, 1fr);\n    grid-template-areas: 'text span text-input';\n    justify-items: center;\n    align-items: center;\n    user-select: none;\n  }\n\n  .affine-edit-link-area {\n    grid-area: link-area;\n    width: 338px;\n    display: grid;\n    gap: 6px;\n    grid-template-columns: auto auto auto;\n    grid-template-rows: repeat(1, 1fr);\n    grid-template-areas: 'link span link-input';\n    justify-items: center;\n    align-items: center;\n  }\n\n  .affine-link-popover-dividing-line {\n    grid-area: span;\n  }\n  .affine-edit-text-text {\n    grid-area: text;\n  }\n\n  .affine-edit-text-input {\n    grid-area: text-input;\n  }\n\n  .affine-edit-link-text {\n    grid-area: link;\n  }\n\n  .affine-edit-link-input {\n    grid-area: link-input;\n  }\n\n  .affine-confirm-button {\n    grid-area: btn;\n    user-select: none;\n    fill: var(--affine-icon-color);\n  }\n  .affine-confirm-button[disabled],\n  .affine-confirm-button:disabled {\n    fill: var(--affine-icon-color);\n  }\n`;\n\nexport const linkPopoverStyle = css`\n  .popover-container {\n    font-family: var(--affine-font-family);\n    font-size: var(--affine-font-base);\n    font-style: normal;\n    line-height: 24px;\n    color: var(--affine-popover-color);\n    z-index: var(--affine-z-index-popover);\n    animation: affine-popover-fade-in 0.2s ease;\n  }\n\n  @keyframes affine-popover-fade-in {\n    from {\n      opacity: 0;\n      transform: translateY(-3px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n\n  .overlay-mask {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    z-index: var(--affine-z-index-popover);\n  }\n  .affine-edit-text-area {\n    border: 1px solid var(--affine-border-color);\n    outline: none;\n    border-radius: 10px;\n    background: transparent;\n  }\n  .affine-edit-text-area:focus-within {\n    border: 1px solid var(--affine-primary-color);\n  }\n  .affine-edit-link-area {\n    border: 1px solid var(--affine-border-color);\n    outline: none;\n    border-radius: 10px;\n    background: transparent;\n  }\n  .affine-edit-link-area:focus-within {\n    border: 1px solid var(--affine-primary-color);\n  }\n\n  label {\n    font-family: var(--affine-font-family);\n    font-size: var(--affine-font-sm);\n    box-sizing: border-box;\n    padding: 6px 0 6px 12px;\n    color: var(--affine-icon-color);\n  }\n\n  input {\n    font-family: var(--affine-font-family);\n    font-size: var(--affine-font-base);\n    box-sizing: border-box;\n    padding: 6px 12px 6px 0;\n    width: 260px;\n    height: 34px;\n    color: inherit;\n    border: none;\n    background: transparent;\n  }\n  input::placeholder {\n    color: var(--affine-placeholder-color);\n  }\n  input:focus {\n    outline: none;\n  }\n  input:focus ~ label,\n  input:active ~ label {\n    color: var(--affine-primary-color);\n  }\n\n  .affine-link-popover {\n    display: flex;\n    align-items: center;\n    height: 40px;\n    padding: 0 12px;\n\n    background: var(--affine-background-overlay-panel-color);\n    box-shadow: var(--affine-shadow-2);\n    border-radius: 8px;\n  }\n\n  .affine-link-popover-input {\n    border: none;\n  }\n  .affine-link-popover-input::placeholder {\n    color: var(--affine-placeholder-color);\n  }\n  .affine-link-popover-input:focus {\n    border: none;\n  }\n\n  .affine-link-preview {\n    width: 260px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    user-select: none;\n    cursor: pointer;\n    white-space: nowrap;\n  }\n\n  .affine-link-popover-dividing-line {\n    margin: 0 6px;\n    width: 1px;\n    height: 20px;\n    background-color: var(--affine-border-color);\n  }\n\n  ${editLinkStyle}\n  ${tooltipStyle}\n`;\n", "import {\n  ConfirmIcon,\n  EditIcon,\n  LinkToCardIcon,\n  UnlinkIcon,\n} from '@blocksuite/global/config';\nimport { html, LitElement, type PropertyValues } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\n\nimport { createEvent } from '../../__internal__/utils/index.js';\nimport { toast } from '../toast.js';\nimport { linkPopoverStyle } from './styles.js';\n\nexport const ALLOWED_SCHEMES = [\n  'http',\n  'https',\n  'ftp',\n  'sftp',\n  'mailto',\n  'tel',\n  // may need support other schemes\n];\n// I guess you don't want to use the regex base the RFC 5322 Official Standard\n// For more detail see https://stackoverflow.com/questions/201323/how-can-i-validate-an-email-address-using-a-regular-expression/1917982#1917982\nconst MAIL_REGEX =\n  /^[a-zA-Z0-9.!#$%&*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$/;\n\n// For more detail see https://stackoverflow.com/questions/8667070/javascript-regular-expression-to-validate-url\nconst URL_REGEX = new RegExp(\n  '^' +\n    // protocol identifier (optional)\n    // short syntax // still required\n    '(?:(?:(?:https?|ftp):)?\\\\/\\\\/)' +\n    // user:pass BasicAuth (optional)\n    '(?:\\\\S+(?::\\\\S*)?@)?' +\n    '(?:' +\n    // IP address exclusion\n    // private & local networks\n    '(?!(?:10|127)(?:\\\\.\\\\d{1,3}){3})' +\n    '(?!(?:169\\\\.254|192\\\\.168)(?:\\\\.\\\\d{1,3}){2})' +\n    '(?!172\\\\.(?:1[6-9]|2\\\\d|3[0-1])(?:\\\\.\\\\d{1,3}){2})' +\n    // IP address dotted notation octets\n    // excludes loopback network 0.0.0.0\n    // excludes reserved space >= 224.0.0.0\n    // excludes network & broadcast addresses\n    // (first & last IP address of each class)\n    '(?:[1-9]\\\\d?|1\\\\d\\\\d|2[01]\\\\d|22[0-3])' +\n    '(?:\\\\.(?:1?\\\\d{1,2}|2[0-4]\\\\d|25[0-5])){2}' +\n    '(?:\\\\.(?:[1-9]\\\\d?|1\\\\d\\\\d|2[0-4]\\\\d|25[0-4]))' +\n    '|' +\n    // host & domain names, may end with dot\n    // can be replaced by a shortest alternative\n    // (?![-_])(?:[-\\\\w\\\\u00a1-\\\\uffff]{0,63}[^-_]\\\\.)+\n    '(?:' +\n    '(?:' +\n    '[a-z0-9\\\\u00a1-\\\\uffff]' +\n    '[a-z0-9\\\\u00a1-\\\\uffff_-]{0,62}' +\n    ')?' +\n    '[a-z0-9\\\\u00a1-\\\\uffff]\\\\.' +\n    ')+' +\n    // TLD identifier name, may end with dot\n    '(?:[a-z\\\\u00a1-\\\\uffff]{2,}\\\\.?)' +\n    ')' +\n    // port number (optional)\n    '(?::\\\\d{2,5})?' +\n    // resource path (optional)\n    '(?:[/?#]\\\\S*)?' +\n    '$',\n  'i'\n);\n\nfunction normalizeUrl(url: string) {\n  const hasScheme = ALLOWED_SCHEMES.some(scheme =>\n    url.startsWith(scheme + ':')\n  );\n  if (hasScheme) {\n    return url;\n  }\n  const isEmail = MAIL_REGEX.test(url);\n  if (isEmail) {\n    return 'mailto:' + url;\n  }\n  return 'http://' + url;\n}\n\n/**\n * For more detail see https://www.ietf.org/rfc/rfc1738.txt\n */\nconst isValidLink = (str: string) => {\n  if (!str) {\n    return false;\n  }\n  const url = normalizeUrl(str);\n  if (url === str) {\n    // Skip check if user input scheme manually\n    return true;\n  }\n  return URL_REGEX.test(url);\n};\n\n@customElement('edit-link-panel')\nexport class LinkPopover extends LitElement {\n  static override styles = linkPopoverStyle;\n\n  @property()\n  left = '0';\n\n  @property()\n  top = '0';\n\n  @property()\n  type: 'create' | 'edit' = 'create';\n\n  @property()\n  showMask = true;\n\n  @property()\n  text = '';\n\n  @property()\n  previewLink = '';\n\n  @property()\n  showBookmarkOperation = false;\n\n  @state()\n  private _bodyOverflowStyle = '';\n\n  @state()\n  private _disableConfirm = true;\n\n  @query('#text-input')\n  textInput: HTMLInputElement | undefined;\n\n  @query('#link-input')\n  linkInput: HTMLInputElement | undefined;\n\n  @query('.popover-container')\n  popoverContainer: HTMLDivElement | undefined;\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    if (this.showMask) {\n      // Disable body scroll\n      this._bodyOverflowStyle = document.body.style.overflow;\n      document.body.style.overflow = 'hidden';\n    }\n  }\n\n  protected override firstUpdated(_changedProperties: PropertyValues): void {\n    super.firstUpdated(_changedProperties);\n\n    if (this.linkInput) {\n      this.linkInput.focus();\n    }\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n\n    if (this.showMask) {\n      // Restore body scroll style\n      document.body.style.overflow = this._bodyOverflowStyle;\n    }\n  }\n\n  private _hide() {\n    this.dispatchEvent(\n      new CustomEvent<LinkDetail>('updateLink', {\n        detail: { type: 'cancel' },\n      })\n    );\n  }\n\n  private _onConfirm() {\n    if (this._disableConfirm) {\n      return;\n    }\n    if (!this.linkInput) {\n      throw new Error('Failed to update link! Link input not found!');\n    }\n    const link = normalizeUrl(this.linkInput.value);\n    const text = this.textInput?.value ?? undefined;\n    if (!link) {\n      return;\n    }\n\n    this.dispatchEvent(\n      createEvent('updateLink', {\n        type: 'confirm',\n        link,\n        text,\n      })\n    );\n    return;\n  }\n\n  private _onCopy(e: MouseEvent) {\n    navigator.clipboard.writeText(this.previewLink);\n    toast('Copied link to clipboard');\n  }\n\n  private _onUnlink(e: MouseEvent) {\n    this.dispatchEvent(createEvent('updateLink', { type: 'remove' }));\n  }\n\n  private _onLinkToCard(e: MouseEvent) {\n    this.dispatchEvent(\n      new CustomEvent<LinkDetail>('updateLink', {\n        detail: { type: 'toBookmark' },\n      })\n    );\n  }\n\n  private _onEdit(e: MouseEvent) {\n    this.dispatchEvent(createEvent('editLink', null));\n    this._disableConfirm = false;\n  }\n\n  private _onInput(e: InputEvent) {\n    if (!this.linkInput) {\n      throw new Error('Failed to update link! Link input not found!');\n    }\n    const isValid = isValidLink(this.linkInput.value);\n    this._disableConfirm = isValid ? false : true;\n  }\n\n  private _onKeydown(e: KeyboardEvent) {\n    if (e.key === 'Enter' && !e.isComposing) {\n      e.preventDefault();\n      this._onConfirm();\n    }\n    return;\n  }\n\n  confirmBtnTemplate() {\n    return html`<icon-button\n      class=\"affine-confirm-button\"\n      ?disabled=${this._disableConfirm}\n      @click=${this._onConfirm}\n      >${ConfirmIcon}</icon-button\n    >`;\n  }\n\n  createLinkTemplate() {\n    return html`<div class=\"affine-link-popover\">\n      <input\n        id=\"link-input\"\n        class=\"affine-link-popover-input\"\n        type=\"text\"\n        spellcheck=\"false\"\n        placeholder=\"Paste or type a link\"\n        value=${this.previewLink}\n        @keydown=${this._onKeydown}\n        @input=${this._onInput}\n      />\n      <span class=\"affine-link-popover-dividing-line\"></span>\n      ${this.confirmBtnTemplate()}\n    </div>`;\n  }\n\n  previewTemplate() {\n    return html`<div class=\"affine-link-popover\">\n      <div class=\"affine-link-preview has-tool-tip\" @click=${this._onCopy}>\n        <tool-tip inert role=\"tooltip\">Click to copy link</tool-tip>\n        <span style=\"overflow: hidden;\">${this.previewLink}</span>\n      </div>\n      <span class=\"affine-link-popover-dividing-line\"></span>\n      ${this.showBookmarkOperation\n        ? html`<icon-button\n              class=\"has-tool-tip\"\n              data-testid=\"unlink\"\n              @click=${this._onLinkToCard}\n            >\n              ${LinkToCardIcon}\n              <tool-tip inert role=\"tooltip\">Turn into Card view</tool-tip>\n            </icon-button>\n            <span class=\"affine-link-popover-dividing-line\"></span>`\n        : ''}\n      <icon-button\n        class=\"has-tool-tip\"\n        data-testid=\"unlink\"\n        @click=${this._onUnlink}\n      >\n        ${UnlinkIcon}\n        <tool-tip inert role=\"tooltip\">Remove</tool-tip>\n      </icon-button>\n\n      <icon-button\n        class=\"has-tool-tip\"\n        data-testid=\"edit\"\n        @click=${this._onEdit}\n      >\n        ${EditIcon}\n        <tool-tip inert role=\"tooltip\">Edit</tool-tip>\n      </icon-button>\n    </div>`;\n  }\n\n  simpleTemplate() {\n    const isCreateLink = !this.previewLink;\n    return isCreateLink ? this.createLinkTemplate() : this.previewTemplate();\n  }\n\n  /**\n   * ```\n   * \n   *      \n   *  Text          \n   *      \n   *      \n   *  Link       X  \n   *      \n   * \n   * ```\n   */\n  editTemplate() {\n    return html`<div class=\"affine-link-edit-popover\">\n      <div class=\"affine-edit-text-area\">\n        <input\n          class=\"affine-edit-text-input\"\n          id=\"text-input\"\n          type=\"text\"\n          placeholder=\"Enter text\"\n          value=${this.text}\n          @keydown=${this._onKeydown}\n        />\n        <span class=\"affine-link-popover-dividing-line\"></span>\n        <label class=\"affine-edit-text-text\" for=\"text-input\">Text</label>\n      </div>\n      <div class=\"affine-edit-link-area\">\n        <input\n          id=\"link-input\"\n          class=\"affine-edit-link-input\"\n          type=\"text\"\n          spellcheck=\"false\"\n          placeholder=\"Paste or type a link\"\n          value=${this.previewLink}\n          @keydown=${this._onKeydown}\n        />\n        <span class=\"affine-link-popover-dividing-line\"></span>\n        <label class=\"affine-edit-link-text\" for=\"link-input\">Link</label>\n      </div>\n      ${this.confirmBtnTemplate()}\n    </div>`;\n  }\n\n  override render() {\n    const mask = this.showMask\n      ? html`<div class=\"overlay-mask\" @click=\"${this._hide}\"></div>`\n      : html``;\n\n    const popover =\n      this.type === 'create' ? this.simpleTemplate() : this.editTemplate();\n\n    return html`\n      <div class=\"overlay-root\">\n        ${mask}\n        <div\n          class=\"popover-container\"\n          style=\"position: absolute; left: ${this.left}; top: ${this.top};${this\n            .style.cssText}\"\n        >\n          ${popover}\n        </div>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edit-link-panel': LinkPopover;\n  }\n  interface HTMLElementEventMap {\n    updateLink: CustomEvent<LinkDetail>;\n    editLink: CustomEvent<null>;\n  }\n}\n\nexport type LinkDetail =\n  | { type: 'toBookmark' }\n  | { type: 'cancel' }\n  | { type: 'confirm'; link: string; text?: string }\n  | { type: 'remove' };\n", "import { assertExists } from '@blocksuite/global/utils';\nimport type { Page } from '@blocksuite/store';\n\nimport {\n  getDefaultPage,\n  getModelByElement,\n  noop,\n} from '../../__internal__/utils/index.js';\nimport { calcSafeCoordinate } from '../../page-block/utils/position.js';\nimport type { LinkDetail, LinkPopover } from './link-popover.js';\n\nfunction updatePosition(element: LinkPopover, anchorEl: HTMLElement) {\n  const rect = anchorEl.getBoundingClientRect();\n  const offsetY = 5;\n  const safeCoordinate = calcSafeCoordinate({\n    positioningPoint: { x: rect.x, y: rect.top + rect.height + offsetY },\n    objRect: element.popoverContainer?.getBoundingClientRect(),\n    offsetY,\n  });\n  element.left = `${safeCoordinate.x}px`;\n  element.top = `${safeCoordinate.y}px`;\n}\n\nfunction createEditLinkElement(\n  anchorEl: HTMLElement,\n  container: HTMLElement,\n  {\n    showMask,\n    previewLink,\n    page,\n  }: { showMask: boolean; previewLink: string; page: Page }\n) {\n  const linkPanel = document.createElement('edit-link-panel');\n  linkPanel.showMask = showMask;\n  linkPanel.previewLink = previewLink;\n  linkPanel.showBookmarkOperation = !!page.awarenessStore.getFlag(\n    'enable_bookmark_operation'\n  );\n  container.appendChild(linkPanel);\n\n  requestAnimationFrame(() => {\n    updatePosition(linkPanel, anchorEl);\n  });\n  return linkPanel;\n}\n\nfunction bindHoverState(\n  target: HTMLElement,\n  popover: HTMLElement,\n  controller: AbortController\n) {\n  // TODO export as options\n  const hoverCloseDelay = 300;\n  let timer: number | undefined;\n\n  const handleMouseEnter = (e: MouseEvent) => {\n    clearTimeout(timer);\n  };\n\n  const handleMouseLeave = (e: MouseEvent) => {\n    // we want to leave the popover open\n    // if the mouse entered the popover immediately\n    // after leaving the target (or vice versa).\n    timer = window.setTimeout(() => {\n      controller.abort();\n    }, hoverCloseDelay);\n  };\n\n  const abortHandler = () => {\n    controller.abort();\n  };\n\n  target.addEventListener('mouseover', handleMouseEnter);\n  target.addEventListener('mouseout', handleMouseLeave);\n\n  popover.addEventListener('mouseover', handleMouseEnter);\n  popover.addEventListener('mouseout', handleMouseLeave);\n\n  const model = getModelByElement(target);\n  const pageBlock = getDefaultPage(model.page);\n  const viewport = pageBlock?.viewportElement;\n  viewport?.addEventListener('scroll', abortHandler);\n  return () => {\n    target.removeEventListener('mouseover', handleMouseEnter);\n    target.removeEventListener('mouseout', handleMouseLeave);\n\n    popover.removeEventListener('mouseover', handleMouseEnter);\n    popover.removeEventListener('mouseout', handleMouseLeave);\n    viewport?.removeEventListener('scroll', abortHandler);\n  };\n}\n\ninterface LinkPopoverOptions {\n  anchorEl: HTMLElement;\n  page: Page;\n  container?: HTMLElement;\n  text?: string;\n  link?: string;\n  showMask?: boolean;\n  interactionKind?: 'always' | 'hover';\n  abortController?: AbortController;\n}\n\nexport async function showLinkPopover({\n  anchorEl,\n  page,\n  container = document.body,\n  text = '',\n  link = '',\n  showMask = true,\n  interactionKind = 'always',\n  abortController = new AbortController(),\n}: LinkPopoverOptions): Promise<LinkDetail> {\n  assertExists(anchorEl, \"Can't show tooltip without anchor element!\");\n\n  if (abortController.signal.aborted) {\n    return Promise.resolve({ type: 'cancel' });\n  }\n\n  const editLinkEle = createEditLinkElement(anchorEl, container, {\n    showMask,\n    previewLink: link,\n    page,\n  });\n\n  const unsubscribeHoverAbort =\n    interactionKind === 'hover'\n      ? bindHoverState(anchorEl, editLinkEle, abortController)\n      : noop;\n\n  return new Promise(res => {\n    abortController.signal.addEventListener('abort', () => {\n      editLinkEle.remove();\n      res({ type: 'cancel' });\n    });\n\n    editLinkEle.addEventListener('editLink', e => {\n      if (abortController.signal.aborted) {\n        return;\n      }\n\n      editLinkEle.type = 'edit';\n      editLinkEle.showMask = true;\n      editLinkEle.text = text;\n      unsubscribeHoverAbort();\n      requestAnimationFrame(() => {\n        updatePosition(editLinkEle, anchorEl);\n      });\n    });\n\n    editLinkEle.addEventListener('updateLink', e => {\n      if (abortController.signal.aborted) {\n        return;\n      }\n      editLinkEle.remove();\n      res(e.detail);\n    });\n  });\n}\n", "import { ShadowlessElement } from '@blocksuite/lit';\nimport { type DeltaInsert, ZERO_WIDTH_SPACE } from '@blocksuite/virgo';\nimport { css, html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { type StyleInfo, styleMap } from 'lit/directives/style-map.js';\n\nimport type { AffineTextAttributes } from './types.js';\n\nexport function affineTextStyles(\n  props: AffineTextAttributes,\n  override?: Readonly<StyleInfo>\n): ReturnType<typeof styleMap> {\n  let textDecorations = '';\n  if (props.underline) {\n    textDecorations += 'underline';\n  }\n  if (props.strike) {\n    textDecorations += ' line-through';\n  }\n\n  let inlineCodeStyle = {};\n  if (props.code) {\n    inlineCodeStyle = {\n      'font-family': 'var(--affine-font-code-family)',\n      background: 'var(--affine-background-code-block)',\n      color: 'var(--affine-text-primary-color)',\n      'border-radius': '4px',\n      padding: '3px 6px',\n      'font-size': 'calc(var(--affine-font-base) - 4px)',\n      'font-variant-ligatures': 'none',\n      'line-height': 'var(--affine-font-base)',\n      border: '1px solid var(--affine-border-color)',\n    };\n  }\n\n  return styleMap({\n    'font-weight': props.bold ? 'bold' : 'normal',\n    'font-style': props.italic ? 'italic' : 'normal',\n    'text-decoration': textDecorations.length > 0 ? textDecorations : 'none',\n    ...inlineCodeStyle,\n    ...override,\n  });\n}\n\n@customElement('affine-text')\nexport class AffineText extends ShadowlessElement {\n  static override styles = css`\n    affine-text {\n      white-space: break-spaces;\n      word-break: break-word;\n    }\n  `;\n\n  @property({ type: Object })\n  delta: DeltaInsert<AffineTextAttributes> = {\n    insert: ZERO_WIDTH_SPACE,\n  };\n\n  override render() {\n    const style = this.delta.attributes\n      ? affineTextStyles(this.delta.attributes)\n      : styleMap({});\n    // we need to avoid \\n appearing before and after the span element, which will\n    // cause the unexpected space\n    return html`<span style=${style}\n      ><v-text .str=${this.delta.insert}></v-text\n    ></span>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-text': AffineText;\n  }\n}\n", "import { FontLinkIcon } from '@blocksuite/global/config';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { ShadowlessElement } from '@blocksuite/lit';\nimport { type DeltaInsert, VEditor, ZERO_WIDTH_SPACE } from '@blocksuite/virgo';\nimport { css, html } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { showLinkPopover } from '../../../components/link-popover/index.js';\nimport { getModelByElement } from '../../utils/index.js';\nimport { affineTextStyles } from '../virgo/affine-text.js';\nimport type { AffineTextAttributes } from '../virgo/types.js';\n\n@customElement('affine-link')\nexport class AffineLink extends ShadowlessElement {\n  @property({ type: Object })\n  delta: DeltaInsert<AffineTextAttributes> = {\n    insert: ZERO_WIDTH_SPACE,\n  };\n\n  get link() {\n    const link = this.delta.attributes?.link;\n    if (!link) {\n      return '';\n    }\n    return link;\n  }\n\n  @property()\n  popoverHoverOpenDelay = 150;\n\n  @state()\n  private _popoverTimer = 0;\n\n  private _isHovering = false;\n\n  static override styles = css`\n    affine-link > a {\n      white-space: nowrap;\n      word-break: break-word;\n      color: var(--affine-link-color);\n      fill: var(--affine-link-color);\n      text-decoration: none;\n      cursor: pointer;\n    }\n\n    affine-link > a:hover [data-virgo-text='true'] {\n      text-decoration: underline;\n    }\n\n    affine-link > a > v-text {\n      white-space: break-spaces;\n    }\n  `;\n\n  constructor() {\n    super();\n    this.addEventListener('mouseenter', this.onHover);\n    this.addEventListener('mouseleave', this._onHoverEnd);\n  }\n\n  onHover(e: MouseEvent) {\n    if (this._isHovering) {\n      return;\n    } else {\n      this._isHovering = true;\n    }\n\n    const model = getModelByElement(this);\n    if (model.page.readonly) return;\n\n    this._popoverTimer = window.setTimeout(() => {\n      this.onDelayHover(e);\n    }, this.popoverHoverOpenDelay);\n  }\n\n  async onDelayHover(e: MouseEvent) {\n    if (!(e.target instanceof HTMLElement) || !document.contains(e.target)) {\n      return;\n    }\n    const model = getModelByElement(this);\n\n    const text = this.delta.insert;\n    const linkState = await showLinkPopover({\n      anchorEl: e.target as HTMLElement,\n      page: model.page,\n      text,\n      link: this.link,\n      showMask: false,\n      interactionKind: 'hover',\n    });\n    if (linkState.type === 'confirm') {\n      const link = linkState.link;\n      const newText = linkState.text;\n      const isUpdateText = newText !== text;\n      this._updateLink(link, isUpdateText ? newText : undefined);\n      return;\n    }\n    if (linkState.type === 'remove') {\n      this._updateLink();\n      return;\n    }\n    if (linkState.type === 'toBookmark') {\n      this._onConvertToBookmark();\n      return;\n    }\n  }\n\n  /**\n   * If no pass text, use the original text\n   */\n  private _updateLink(link?: string, text?: string) {\n    const model = getModelByElement(this);\n    const { page } = model;\n    const oldStr = this.delta.insert;\n    const oldTextAttributes = this.delta.attributes;\n\n    const textElement = this.querySelector('[data-virgo-text=\"true\"]');\n    assertExists(textElement);\n    const textNode = Array.from(textElement.childNodes).find(\n      (node): node is Text => node instanceof Text\n    );\n    assertExists(textNode);\n    const richText = this.closest('rich-text');\n    assertExists(richText);\n    const domPoint = VEditor.textPointToDomPoint(\n      textNode,\n      0,\n      richText.virgoContainer\n    );\n    assertExists(domPoint);\n    const vEditor = richText.vEditor;\n    assertExists(vEditor);\n\n    if (link) {\n      if (text) {\n        page.captureSync();\n        vEditor.deleteText({\n          index: domPoint.index,\n          length: textNode.length,\n        });\n        vEditor.insertText({ index: domPoint.index, length: 0 }, text);\n        vEditor.formatText(\n          {\n            index: domPoint.index,\n            length: text.length,\n          },\n          { link }\n        );\n      } else {\n        page.captureSync();\n        vEditor.formatText(\n          {\n            index: domPoint.index,\n            length: oldStr.length,\n          },\n          { link }\n        );\n      }\n    } else {\n      page.captureSync();\n      const newAttributes = { ...oldTextAttributes };\n      delete newAttributes.link;\n      vEditor.formatText(\n        {\n          index: domPoint.index,\n          length: oldStr.length,\n        },\n        newAttributes,\n        {\n          mode: 'replace',\n        }\n      );\n    }\n  }\n  private _onConvertToBookmark() {\n    const model = getModelByElement(this);\n    const { page } = model;\n\n    const textElement = this.querySelector('[data-virgo-text=\"true\"]');\n    assertExists(textElement);\n    const textNode = Array.from(textElement.childNodes).find(\n      (node): node is Text => node instanceof Text\n    );\n    assertExists(textNode);\n    const richText = this.closest('rich-text');\n    assertExists(richText);\n    const domPoint = VEditor.textPointToDomPoint(\n      textNode,\n      0,\n      richText.virgoContainer\n    );\n    assertExists(domPoint);\n    const vEditor = richText.vEditor;\n    assertExists(vEditor);\n\n    const parent = page.getParent(model);\n    assertExists(parent);\n    const index = parent.children.indexOf(model);\n\n    page.addBlock(\n      'affine:bookmark',\n      { url: this.link, title: this.delta.insert },\n      parent,\n      index + 1\n    );\n    vEditor.deleteText({\n      index: domPoint.index,\n      length: textNode.length,\n    });\n  }\n\n  private _onHoverEnd(e: Event) {\n    this._isHovering = false;\n    clearTimeout(this._popoverTimer);\n  }\n\n  // Workaround for links not working in contenteditable div\n  // see also https://stackoverflow.com/questions/12059211/how-to-make-clickable-anchor-in-contenteditable-div\n  //\n  // Note: We cannot use JS to directly open a new page as this may be blocked by the browser.\n  //\n  // Please also note that when readonly mode active,\n  // this workaround is not necessary and links work normally.\n  // see https://github.com/toeverything/AFFiNE/issues/1540\n  private _onMouseUp(e: MouseEvent) {\n    const anchorElement = this.querySelector('a');\n    assertExists(anchorElement);\n    if (!anchorElement.isContentEditable) return;\n    anchorElement.contentEditable = 'false';\n    setTimeout(() => {\n      anchorElement.removeAttribute('contenteditable');\n    }, 0);\n  }\n\n  override render() {\n    const style = this.delta.attributes\n      ? affineTextStyles(this.delta.attributes)\n      : styleMap({});\n\n    return html`<a\n      href=${this.link}\n      rel=\"noopener noreferrer\"\n      target=\"_blank\"\n      style=${style}\n      @mouseup=${this._onMouseUp}\n      >${FontLinkIcon}<v-text .str=${this.delta.insert}></v-text\n    ></a>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-link': AffineLink;\n  }\n}\n", "import { html, LitElement } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\n@customElement('link-mock-selection')\nexport class LinkMockSelection extends LitElement {\n  rects: DOMRect[];\n\n  constructor(rects: DOMRect[]) {\n    super();\n    this.rects = rects;\n  }\n\n  override render() {\n    return html`\n      ${this.rects.map(\n        rect => html`<div\n          style=\"${styleMap({\n            position: 'absolute',\n            width: `${rect.width}px`,\n            height: `${rect.height}px`,\n            top: `${rect.top}px`,\n            left: `${rect.left}px`,\n            backgroundColor: 'rgba(35, 131, 226, 0.28)',\n          })}\"\n        ></div>`\n      )}\n    `;\n  }\n}\n", "import './affine-link.js';\n\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { Page } from '@blocksuite/store';\n\nimport { showLinkPopover } from '../../../components/link-popover/index.js';\nimport {\n  blockRangeToNativeRange,\n  getCurrentBlockRange,\n} from '../../utils/block-range.js';\nimport { getEditorContainer, getVirgoByModel } from '../../utils/index.js';\nimport { LinkMockSelection } from './mock-selection.js';\n\nexport function createLink(page: Page) {\n  const blockRange = getCurrentBlockRange(page);\n  if (!blockRange) return;\n  if (blockRange.models.length > 1) {\n    throw new Error(\"Can't create link with multiple blocks for now\");\n  }\n  const startModel = blockRange.models[0];\n  if (!startModel) return;\n  const vEditor = getVirgoByModel(startModel);\n  assertExists(vEditor);\n  const vRange = {\n    index: blockRange.startOffset,\n    length: blockRange.endOffset - blockRange.startOffset,\n  };\n  if (vRange.length === 0) {\n    return;\n  }\n\n  // User can cancel link by pressing shortcut again\n  const format = vEditor.getFormat(vRange);\n  if (format.link) {\n    page.captureSync();\n    vEditor.formatText(vRange, { link: null });\n    vEditor.setVRange(vRange);\n    // recreate link\n    // setTimeout(() => {\n    //   createLink(page);\n    // });\n    return;\n  }\n\n  // mock a selection style\n  const range = blockRangeToNativeRange(blockRange);\n  assertExists(range);\n  const rects = Array.from(range.getClientRects());\n\n  const container = getEditorContainer(page);\n  assertExists(container);\n  const containerRect = container.getBoundingClientRect();\n\n  const mockSelection = new LinkMockSelection(\n    rects.map(\n      rect =>\n        new DOMRect(\n          rect.left - containerRect.left,\n          rect.top - containerRect.top,\n          rect.width,\n          rect.height\n        )\n    )\n  );\n  const affineEditorContainer = getEditorContainer(page);\n  assertExists(affineEditorContainer);\n  affineEditorContainer.appendChild(mockSelection);\n\n  setTimeout(async () => {\n    const linkState = await showLinkPopover({\n      anchorEl: mockSelection.shadowRoot?.querySelector('div') as HTMLElement,\n      page,\n    });\n\n    mockSelection.remove();\n    if (linkState.type !== 'confirm') return;\n\n    const link = linkState.link;\n\n    page.captureSync();\n    vEditor.formatText(vRange, { link });\n    vEditor.setVRange(vRange);\n  });\n}\n", "import {\n  BoldIcon,\n  InlineCodeIcon,\n  ItalicIcon,\n  LinkIcon,\n  SHORT_KEY,\n  StrikethroughIcon,\n  UnderlineIcon,\n} from '@blocksuite/global/config';\nimport type { BaseBlockModel } from '@blocksuite/store';\n\nimport { createLink } from '../../__internal__/rich-text/link-node/index.js';\nimport type { AffineTextAttributes } from '../../__internal__/rich-text/virgo/types.js';\nimport type { ActionProps } from './const.js';\nimport {\n  getCurrentCombinedFormat,\n  handleFormat,\n} from './container-operations.js';\n\nexport const formatConfig = [\n  {\n    id: 'bold',\n    name: 'Bold',\n    icon: BoldIcon,\n    hotkey: `${SHORT_KEY}+b`,\n    activeWhen: (format: AffineTextAttributes) => 'bold' in format,\n    showWhen: (models: BaseBlockModel[]) => noneCodeBlockSelected(models),\n    action: ({ page }: ActionProps) => {\n      handleFormat(page, 'bold');\n    },\n  },\n  {\n    id: 'italic',\n    name: 'Italic',\n    icon: ItalicIcon,\n    hotkey: `${SHORT_KEY}+i`,\n    activeWhen: (format: AffineTextAttributes) => 'italic' in format,\n    showWhen: (models: BaseBlockModel[]) => noneCodeBlockSelected(models),\n    action: ({ page }: ActionProps) => {\n      handleFormat(page, 'italic');\n    },\n  },\n  {\n    id: 'underline',\n    name: 'Underline',\n    icon: UnderlineIcon,\n    hotkey: `${SHORT_KEY}+u`,\n    activeWhen: (format: AffineTextAttributes) => 'underline' in format,\n    showWhen: (models: BaseBlockModel[]) => noneCodeBlockSelected(models),\n    action: ({ page }: ActionProps) => {\n      handleFormat(page, 'underline');\n    },\n  },\n  {\n    id: 'strike',\n    name: 'Strikethrough',\n    icon: StrikethroughIcon,\n    hotkey: `${SHORT_KEY}+shift+s`,\n    activeWhen: (format: AffineTextAttributes) => 'strike' in format,\n    showWhen: (models: BaseBlockModel[]) => noneCodeBlockSelected(models),\n    action: ({ page }: ActionProps) => {\n      handleFormat(page, 'strike');\n    },\n  },\n  {\n    id: 'code',\n    name: 'Code',\n    icon: InlineCodeIcon,\n    hotkey: `${SHORT_KEY}+e`,\n    activeWhen: (format: AffineTextAttributes) => 'code' in format,\n    showWhen: (models: BaseBlockModel[]) => noneCodeBlockSelected(models),\n    action: ({ page }: ActionProps) => {\n      handleFormat(page, 'code');\n    },\n  },\n  {\n    id: 'link',\n    name: 'Link',\n    icon: LinkIcon,\n    hotkey: `${SHORT_KEY}+k`,\n    activeWhen: (format: AffineTextAttributes) => 'link' in format,\n    // Only can show link button when selection is in one line paragraph\n    showWhen: (models: BaseBlockModel[]) =>\n      models.length === 1 &&\n      noneCodeBlockSelected(models) &&\n      // can't create link when selection includes reference node\n      // XXX get loose format at here is not a good practice\n      !getCurrentCombinedFormat(models[0].page, true).reference,\n    action: ({ page, abortController, format }: ActionProps) => {\n      createLink(page);\n      if (format && abortController && !('link' in format)) {\n        abortController.abort();\n      }\n    },\n  },\n];\n\nfunction noneCodeBlockSelected(models: BaseBlockModel[]) {\n  return !models.every(model => model.flavour === 'affine:code');\n}\n", "import { css } from 'lit';\n\nimport { tooltipStyle } from '../tooltip/tooltip.js';\n\nconst paragraphPanelStyle = css`\n  .paragraph-button > svg:nth-child(2) {\n    transition-duration: 0.3s;\n  }\n  .paragraph-button:is(:hover, :focus-visible, :active) > svg:nth-child(2) {\n    transform: rotate(180deg);\n  }\n\n  .paragraph-panel {\n    font-size: var(--affine-font-sm);\n    box-sizing: border-box;\n    position: absolute;\n    min-width: 173px;\n    padding: 8px 4px;\n    overflow-y: auto;\n\n    background: var(--affine-background-overlay-panel-color);\n    box-shadow: var(--affine-shadow-2);\n    border-radius: 8px;\n    z-index: var(--affine-z-index-popover);\n  }\n`;\n\nexport const formatQuickBarStyle = css`\n  .format-quick-bar {\n    box-sizing: border-box;\n    position: fixed;\n    display: flex;\n    align-items: center;\n    padding: 4px 8px;\n    gap: 4px;\n    height: 40px;\n\n    border-radius: 8px;\n    background: var(--affine-background-overlay-panel-color);\n    box-shadow: var(--affine-shadow-2);\n    z-index: var(--affine-z-index-popover);\n    user-select: none;\n  }\n\n  .divider {\n    width: 1px;\n    height: 24px;\n    background-color: var(--affine-border-color);\n  }\n\n  format-bar-button svg {\n    width: 20px;\n    height: 20px;\n  }\n\n  ${paragraphPanelStyle}\n  ${tooltipStyle}\n`;\n", "import './button.js';\n\nimport {\n  ArrowDownIcon,\n  type BlockConfig,\n  paragraphConfig,\n} from '@blocksuite/global/config';\nimport { WithDisposable } from '@blocksuite/lit';\nimport {\n  assertExists,\n  type BaseBlockModel,\n  matchFlavours,\n  type Page,\n} from '@blocksuite/store';\nimport { Slot } from '@blocksuite/store';\nimport type { PropertyValues } from 'lit';\nimport { html, LitElement } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { AffineTextAttributes } from '../../__internal__/rich-text/virgo/types.js';\nimport {\n  getCurrentBlockRange,\n  restoreSelection,\n} from '../../__internal__/utils/block-range.js';\nimport { getRichTextByModel } from '../../__internal__/utils/index.js';\nimport { stopPropagation } from '../../page-block/edgeless/utils.js';\nimport { actionConfig } from '../../page-block/utils/const.js';\nimport { formatConfig } from '../../page-block/utils/format-config.js';\nimport {\n  getCurrentCombinedFormat,\n  onModelElementUpdated,\n  updateBlockType,\n} from '../../page-block/utils/index.js';\nimport { compareTopAndBottomSpace } from '../../page-block/utils/position.js';\nimport { formatQuickBarStyle } from './styles.js';\n\ntype ParagraphType = `${string}/${string}`;\ntype ParagraphPanelType = 'top' | 'bottom' | 'hidden';\n\nfunction ParagraphPanel(\n  showParagraphPanel: ParagraphPanelType,\n  paragraphPanelMaxHeight: string | null,\n  paragraphType: ParagraphType,\n  models: BaseBlockModel[],\n  positionUpdated: Slot,\n  onHover: () => void,\n  onHoverEnd: () => void,\n  onUpdateModels: (models: BaseBlockModel[]) => void,\n  onParagraphTypeChange: (type: ParagraphType) => void\n) {\n  if (showParagraphPanel === 'hidden') {\n    return html``;\n  }\n  const page = models[0].page;\n  assertExists(page);\n  const styles = styleMap({\n    left: '0',\n    top: showParagraphPanel === 'bottom' ? 'calc(100% + 4px)' : null,\n    bottom: showParagraphPanel === 'top' ? 'calc(100% + 4px)' : null,\n    maxHeight: paragraphPanelMaxHeight,\n  });\n  const updateParagraphType = (\n    flavour: BlockConfig['flavour'],\n    type?: string\n  ) => {\n    // Already in the target format, should convert back to text\n    const alreadyTargetType = paragraphType === `${flavour}/${type}`;\n    const { flavour: defaultFlavour, type: defaultType } = paragraphConfig[0];\n    const targetFlavour = alreadyTargetType ? defaultFlavour : flavour;\n    const targetType = alreadyTargetType ? defaultType : type;\n    const newModels = updateBlockType(models, targetFlavour, targetType);\n\n    // Reset selection if the target is code block\n    if (targetFlavour === 'affine:code') {\n      if (newModels.length !== 1) {\n        throw new Error(\"Failed to reset selection! New model length isn't 1\");\n      }\n      const codeModel = newModels[0];\n      onModelElementUpdated(codeModel, () => {\n        restoreSelection({\n          type: 'Block',\n          startOffset: 0,\n          endOffset: codeModel.text?.length ?? 0,\n          models: [codeModel],\n        });\n      });\n    }\n    onUpdateModels(newModels);\n    onParagraphTypeChange(`${targetFlavour}/${targetType}`);\n    positionUpdated.emit();\n  };\n\n  return html` <div\n    class=\"paragraph-panel\"\n    style=\"${styles}\"\n    @mouseover=\"${onHover}\"\n    @mouseout=\"${onHoverEnd}\"\n  >\n    ${paragraphConfig\n      .filter(({ flavour }) => flavour !== 'affine:divider')\n      .filter(({ flavour }) => page.schema.flavourSchemaMap.has(flavour))\n      .map(\n        ({ flavour, type, name, icon }) => html`<format-bar-button\n          width=\"100%\"\n          style=\"padding-left: 12px; justify-content: flex-start;\"\n          text=\"${name}\"\n          data-testid=\"${flavour}/${type}\"\n          @click=\"${() => updateParagraphType(flavour, type)}\"\n        >\n          ${icon}\n        </format-bar-button>`\n      )}\n  </div>`;\n}\n\ntype CustomElementCreator = (\n  page: Page,\n  // todo(himself65): support get current block range\n  getBlockRange: () => ReturnType<typeof getCurrentBlockRange>\n) => HTMLDivElement;\n\n@customElement('format-quick-bar')\nexport class FormatQuickBar extends WithDisposable(LitElement) {\n  static override styles = formatQuickBarStyle;\n  static customElements: CustomElementCreator[] = [];\n\n  @property()\n  page!: Page;\n\n  @property()\n  left: string | null = null;\n\n  @property()\n  top: string | null = null;\n\n  @property()\n  abortController = new AbortController();\n\n  // Sometimes the quick bar need to update position\n  @property()\n  positionUpdated = new Slot();\n\n  @property()\n  models: BaseBlockModel[] = [];\n\n  @state()\n  private _paragraphType: ParagraphType = `${paragraphConfig[0].flavour}/${paragraphConfig[0].type}`;\n\n  @state()\n  private _paragraphPanelHoverDelay = 150;\n\n  @state()\n  private _paragraphPanelTimer = 0;\n\n  @state()\n  private _showParagraphPanel: ParagraphPanelType = 'hidden';\n\n  paragraphPanelMaxHeight: string | null = null;\n\n  @state()\n  private _format: AffineTextAttributes = {};\n\n  @query('.format-quick-bar')\n  formatQuickBarElement!: HTMLElement;\n\n  @query('.custom-items')\n  customItemsElement!: HTMLElement;\n\n  private _customElements: HTMLDivElement[] = [];\n\n  protected override update(changedProperties: PropertyValues) {\n    super.update(changedProperties);\n    if (\n      this._customElements.length === 0 &&\n      FormatQuickBar.customElements.length !== 0\n    ) {\n      this._customElements = FormatQuickBar.customElements.map(element =>\n        element(this.page, () => getCurrentBlockRange(this.page))\n      );\n      this.customItemsElement.append(...this._customElements);\n      this._disposables.add(() => {\n        this._customElements.forEach(element => {\n          element.remove();\n        });\n        this._customElements = [];\n        this.customItemsElement.innerHTML = '';\n      });\n    }\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    const startModel = this.models[0];\n    this._paragraphType = `${startModel.flavour}/${startModel.type}`;\n    this._format = getCurrentCombinedFormat(this.page);\n\n    this.addEventListener('pointerdown', (e: MouseEvent) => {\n      // Prevent click event from making selection lost\n      e.preventDefault();\n      e.stopPropagation();\n    });\n    this.abortController.signal.addEventListener('abort', () => {\n      this.remove();\n    });\n\n    document.addEventListener('selectionchange', this._selectionChangeHandler);\n\n    const mutationObserver = new MutationObserver(() => {\n      if (!this.page) {\n        return;\n      }\n      this._format = getCurrentCombinedFormat(this.page);\n    });\n    this.models.forEach(model => {\n      const richText = getRichTextByModel(model);\n      if (!richText) {\n        console.warn(\n          'Format quick bar may not work properly! Cannot find rich text node by model. model:',\n          model\n        );\n        return;\n      }\n      mutationObserver.observe(richText, {\n        // One or more children have been added to and/or removed\n        // from the tree.\n        childList: true,\n        // Omit (or set to false) to observe only changes to the parent node\n        subtree: true,\n      });\n    });\n    this._disposables.add(() => mutationObserver.disconnect());\n    this._disposables.add(() =>\n      document.removeEventListener(\n        'selectionchange',\n        this._selectionChangeHandler\n      )\n    );\n  }\n\n  private _onHover() {\n    if (this._showParagraphPanel !== 'hidden') {\n      clearTimeout(this._paragraphPanelTimer);\n      return;\n    }\n\n    this._paragraphPanelTimer = window.setTimeout(async () => {\n      const { placement, height } = compareTopAndBottomSpace(\n        this.formatQuickBarElement,\n        document.body,\n        10\n      );\n      this._showParagraphPanel = placement;\n      this.paragraphPanelMaxHeight = height + 'px';\n    }, this._paragraphPanelHoverDelay);\n  }\n\n  private _onHoverEnd() {\n    if (this._showParagraphPanel !== 'hidden') {\n      // Prepare to disappear\n      this._paragraphPanelTimer = window.setTimeout(async () => {\n        this._showParagraphPanel = 'hidden';\n      }, this._paragraphPanelHoverDelay * 2);\n      return;\n    }\n    clearTimeout(this._paragraphPanelTimer);\n  }\n\n  private _selectionChangeHandler = () => {\n    const blockRange = getCurrentBlockRange(this.page);\n    if (!blockRange) {\n      this.abortController.abort();\n      return;\n    }\n    // If the selection is collapsed, abort the format quick bar\n    if (\n      blockRange.type === 'Native' &&\n      blockRange.models.length === 1 &&\n      blockRange.startOffset === blockRange.endOffset\n    ) {\n      this.abortController.abort();\n      return;\n    }\n    this._format = getCurrentCombinedFormat(this.page);\n    this.positionUpdated.emit();\n  };\n\n  override render() {\n    const page = this.page;\n\n    if (!this.models.length || !page) {\n      console.error(\n        'Failed to render format-quick-bar! no model or page not found!',\n        this.models,\n        page\n      );\n      return html``;\n    }\n\n    const styles = styleMap({\n      left: this.left,\n      top: this.top,\n    });\n\n    const actionItems = actionConfig\n      .filter(({ showWhen = () => true }) => showWhen(page, this.models))\n      .map(({ id, name, icon, action, enabledWhen, disabledToolTip }) => {\n        const enabled = enabledWhen(page);\n        const toolTip = enabled\n          ? html`<tool-tip inert role=\"tooltip\">${name}</tool-tip>`\n          : html`<tool-tip tip-position=\"top\" inert role=\"tooltip\"\n              >${disabledToolTip}</tool-tip\n            >`;\n        return html`<format-bar-button\n          class=\"has-tool-tip\"\n          data-testid=${id}\n          ?disabled=${!enabled}\n          @click=${() => enabled && action({ page })}\n        >\n          ${icon}${toolTip}\n        </format-bar-button>`;\n      });\n\n    if (\n      this.models.length === 1 &&\n      matchFlavours(this.models[0], ['affine:database'])\n    ) {\n      return html`<div\n        class=\"format-quick-bar\"\n        style=\"${styles}\"\n        @pointerdown=${stopPropagation}\n      >\n        ${actionItems}\n      </div>`;\n    }\n\n    const paragraphIcon =\n      paragraphConfig.find(\n        ({ flavour, type }) => `${flavour}/${type}` === this._paragraphType\n      )?.icon ?? paragraphConfig[0].icon;\n    const paragraphItems = html` <format-bar-button\n      class=\"paragraph-button\"\n      width=\"52px\"\n      @mouseover=\"${this._onHover}\"\n      @mouseout=\"${this._onHoverEnd}\"\n    >\n      ${paragraphIcon} ${ArrowDownIcon}\n    </format-bar-button>`;\n\n    const paragraphPanel = ParagraphPanel(\n      this._showParagraphPanel,\n      this.paragraphPanelMaxHeight,\n      this._paragraphType,\n      this.models,\n      this.positionUpdated,\n      this._onHover,\n      this._onHoverEnd,\n      newModels => (this.models = newModels),\n      paragraphType => (this._paragraphType = paragraphType)\n    );\n    const formatItems = formatConfig\n      .filter(({ showWhen = () => true }) => showWhen(this.models))\n      .map(\n        ({ id, name, icon, action, activeWhen }) => html` <format-bar-button\n          class=\"has-tool-tip\"\n          data-testid=${id}\n          ?active=${activeWhen(this._format)}\n          @click=${() => {\n            action({\n              page,\n              abortController: this.abortController,\n              format: this._format,\n            });\n            // format state need to update after format\n            this._format = getCurrentCombinedFormat(page);\n            this.positionUpdated.emit();\n          }}\n        >\n          ${icon}\n          <tool-tip inert role=\"tooltip\">${name}</tool-tip>\n        </format-bar-button>`\n      );\n\n    return html` <div\n      class=\"format-quick-bar\"\n      style=\"${styles}\"\n      @pointerdown=${stopPropagation}\n    >\n      <div class=\"custom-items\"></div>\n      ${this._customElements.length > 0\n        ? html`<div class=\"divider\"></div>`\n        : null}\n      ${paragraphItems}\n      <div class=\"divider\"></div>\n      ${formatItems}\n      ${formatItems.length ? html` <div class=\"divider\"></div>` : ''}\n      ${actionItems} ${paragraphPanel}\n    </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'format-quick-bar': FormatQuickBar;\n  }\n}\n", "import './button.js';\n\nimport type { Page } from '@blocksuite/store';\nimport { matchFlavours, Slot } from '@blocksuite/store';\n\nimport { getCurrentBlockRange } from '../../__internal__/utils/block-range.js';\nimport { getViewportElement } from '../../__internal__/utils/query.js';\nimport { throttle } from '../../__internal__/utils/std.js';\nimport { onModelElementUpdated } from '../../page-block/index.js';\nimport {\n  calcPositionPointByRange,\n  calcSafeCoordinate,\n  type DragDirection,\n} from '../../page-block/utils/position.js';\nimport { FormatQuickBar } from './format-bar-node.js';\n\nlet formatQuickBarInstance: FormatQuickBar | null = null;\n\nexport const showFormatQuickBar = async ({\n  page,\n  anchorEl,\n  direction = 'right-bottom',\n  container = document.body,\n  abortController = new AbortController(),\n}: {\n  page: Page;\n  anchorEl: {\n    getBoundingClientRect: () => {\n      x: number;\n      y: number;\n    };\n    // contextElement?: Element;\n  };\n  direction?: DragDirection;\n  container?: HTMLElement;\n  abortController?: AbortController;\n}) => {\n  // Reuse previous format quick bar\n  if (formatQuickBarInstance) {\n    return;\n  }\n\n  // Init format quick bar\n\n  const blockRange = getCurrentBlockRange(page);\n  if (!blockRange) {\n    return;\n  }\n  blockRange.models = blockRange.models.filter(model =>\n    matchFlavours(model, [\n      'affine:paragraph',\n      'affine:list',\n      'affine:code',\n      'affine:database',\n    ])\n  );\n  const models = blockRange.models;\n\n  if (models.length === 0) {\n    return;\n  }\n  if (\n    matchFlavours(models[0], ['affine:database']) &&\n    blockRange.type === 'Native'\n  ) {\n    return;\n  }\n\n  const formatQuickBar = new FormatQuickBar();\n  formatQuickBar.page = page;\n  formatQuickBar.models = models;\n  formatQuickBar.abortController = abortController;\n  const positionUpdatedSlot = new Slot();\n  formatQuickBar.positionUpdated = positionUpdatedSlot;\n\n  formatQuickBarInstance = formatQuickBar;\n  abortController.signal.addEventListener('abort', () => {\n    formatQuickBarInstance = null;\n  });\n\n  // Handle Scroll\n\n  // Once performance problems occur, it can be mitigated increasing throttle limit\n  const updatePos = throttle(() => {\n    if (abortController.signal.aborted) {\n      return;\n    }\n    const positioningPoint =\n      anchorEl instanceof Range\n        ? calcPositionPointByRange(anchorEl, direction)\n        : anchorEl.getBoundingClientRect();\n\n    // TODO maybe use the editor container as the boundary rect to avoid the format bar being covered by other elements\n    const boundaryRect = document.body.getBoundingClientRect();\n    const formatBarRect =\n      formatQuickBar.formatQuickBarElement.getBoundingClientRect();\n    // Add offset to avoid the quick bar being covered by the window border\n    const gapY = 5;\n    const isBottom = direction.includes('bottom');\n    const safeCoordinate = calcSafeCoordinate({\n      positioningPoint,\n      objRect: formatBarRect,\n      boundaryRect,\n      // place the format bar in the center of the position point\n      offsetX: -formatBarRect.width / 2,\n      offsetY: isBottom ? gapY : -formatBarRect.height - gapY,\n    });\n\n    formatQuickBar.left = `${safeCoordinate.x}px`;\n    formatQuickBar.top = `${safeCoordinate.y}px`;\n  }, 10);\n\n  if (!page.root) {\n    throw new Error(\"Failed to get page's root element\");\n  }\n  const scrollContainer = getViewportElement(page);\n  if (scrollContainer) {\n    // Note: in edgeless mode, the scroll container is not exist!\n    scrollContainer.addEventListener('scroll', updatePos, { passive: true });\n  }\n  positionUpdatedSlot.on(updatePos);\n  window.addEventListener('resize', updatePos, { passive: true });\n\n  // Mount\n  container.appendChild(formatQuickBar);\n\n  // Handle selection change\n\n  const pointerDownHandler = (e: MouseEvent) => {\n    if (e.target === formatQuickBar) {\n      return;\n    }\n    abortController.abort();\n  };\n\n  const popstateHandler = () => {\n    abortController.abort();\n  };\n  document.addEventListener('pointerdown', pointerDownHandler);\n  // Fix https://github.com/toeverything/AFFiNE/issues/855\n  window.addEventListener('popstate', popstateHandler);\n\n  onModelElementUpdated(blockRange.models[0], updatePos);\n\n  abortController.signal.addEventListener('abort', () => {\n    scrollContainer?.removeEventListener('scroll', updatePos);\n    window.removeEventListener('resize', updatePos);\n    document.removeEventListener('pointerdown', pointerDownHandler);\n    window.removeEventListener('popstate', popstateHandler);\n    positionUpdatedSlot.dispose();\n  });\n  return formatQuickBar;\n};\n", "import { assertExists, sleep } from '@blocksuite/global/utils';\n\nimport type { RichText } from '../__internal__/rich-text/rich-text.js';\nimport { isControlledKeyboardEvent } from '../__internal__/utils/std.js';\nimport { getCurrentNativeRange } from '../std.js';\n\nexport const createKeydownObserver = ({\n  target,\n  onUpdateQuery,\n  onMove,\n  onConfirm,\n  onEsc,\n  interceptor = (e, next) => next(),\n  abortController,\n}: {\n  target: RichText;\n  onUpdateQuery: (val: string) => void;\n  onMove: (step: 1 | -1) => void;\n  onConfirm: () => void;\n  onEsc?: () => void;\n  interceptor?: (e: KeyboardEvent, next: () => void) => void;\n  abortController: AbortController;\n}) => {\n  let query = '';\n  const vEditor = target.vEditor;\n  assertExists(\n    vEditor,\n    'Failed to observer keyboard! virgo editor is not exist.'\n  );\n  const startIndex = vEditor?.getVRange()?.index ?? 0;\n\n  const updateQuery = async () => {\n    // Wait for text update\n    await sleep(0);\n    const range = getCurrentNativeRange();\n    if (range.startContainer !== range.endContainer) {\n      console.warn(\n        'Failed to parse query! Current range is not collapsed.',\n        range\n      );\n      abortController.abort();\n      return;\n    }\n    const textNode = range.startContainer;\n    if (textNode.nodeType !== Node.TEXT_NODE) {\n      console.warn(\n        'Failed to parse query! Current range is not a text node.',\n        range\n      );\n      abortController.abort();\n      return;\n    }\n    const curIndex = vEditor.getVRange()?.index ?? 0;\n    const text = vEditor.yText.toString();\n    const previousQuery = query;\n    query = text.slice(startIndex, curIndex);\n\n    if (query !== previousQuery) {\n      onUpdateQuery(query);\n    }\n  };\n\n  const keyDownListener = (e: KeyboardEvent) => {\n    e.stopPropagation();\n\n    if (e.defaultPrevented) return;\n\n    if (isControlledKeyboardEvent(e)) {\n      const isOnlyCmd = (e.ctrlKey || e.metaKey) && !e.altKey && !e.shiftKey;\n      // Ctrl/Cmd + alphabet key\n      if (isOnlyCmd && e.key.length === 1) {\n        switch (e.key) {\n          // Previous command\n          case 'P':\n          case 'p': {\n            onMove(-1);\n            e.preventDefault();\n            return;\n          }\n          // Next command\n          case 'N':\n          case 'n': {\n            onMove(1);\n            e.preventDefault();\n            return;\n          }\n        }\n      }\n\n      // Pressing **only** modifier key is allowed and will be ignored\n      // Because we don't know the user's intention\n      // Aborting here will cause the above hotkeys to not work\n      if (e.key === 'Control' || e.key === 'Meta' || e.key === 'Alt') {\n        return;\n      }\n\n      // Abort when press modifier key + any other key to avoid weird behavior\n      // e.g. press ctrl + a to select all or press ctrl + v to paste\n      abortController.abort();\n      return;\n    }\n\n    if (isControlledKeyboardEvent(e) || e.key.length !== 1) {\n      switch (e.key) {\n        case 'Escape': {\n          abortController.abort();\n          return;\n        }\n        case 'Backspace': {\n          if (!query.length) {\n            abortController.abort();\n          }\n          updateQuery();\n          return;\n        }\n        case 'Enter': {\n          if (e.isComposing) {\n            return;\n          }\n          if (e.shiftKey) {\n            abortController.abort();\n            return;\n          }\n          onConfirm();\n          e.preventDefault();\n          return;\n        }\n        case 'Tab': {\n          if (e.shiftKey) {\n            onMove(-1);\n          } else {\n            onMove(1);\n          }\n          e.preventDefault();\n          return;\n        }\n        case 'ArrowUp': {\n          if (e.shiftKey) {\n            abortController.abort();\n            return;\n          }\n          onMove(-1);\n          e.preventDefault();\n          return;\n        }\n        case 'ArrowDown': {\n          if (e.shiftKey) {\n            abortController.abort();\n            return;\n          }\n          onMove(1);\n          e.preventDefault();\n          return;\n        }\n        case 'ArrowLeft':\n        case 'ArrowRight': {\n          abortController.abort();\n          return;\n        }\n        default:\n          // Other control keys\n          return;\n      }\n    }\n    updateQuery();\n  };\n\n  target.addEventListener(\n    'keydown',\n    (e: KeyboardEvent) => interceptor(e, () => keyDownListener(e)),\n    {\n      // Workaround: Use capture to prevent the event from triggering the keyboard bindings action\n      capture: true,\n      signal: abortController.signal,\n    }\n  );\n\n  // Fix composition input\n  target.addEventListener('input', updateQuery, {\n    signal: abortController.signal,\n  });\n\n  if (onEsc) {\n    const escListener = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        onEsc();\n      }\n    };\n    window.addEventListener('keydown', escListener, {\n      signal: abortController.signal,\n    });\n  }\n};\n", "import { FontLinkedPageIcon, FontPageIcon } from '@blocksuite/global/config';\nimport type { Slot } from '@blocksuite/global/utils';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/lit';\nimport type { Page, PageMeta } from '@blocksuite/store';\nimport {\n  type DeltaInsert,\n  ZERO_WIDTH_NON_JOINER,\n  ZERO_WIDTH_SPACE,\n} from '@blocksuite/virgo';\nimport { css, html } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\n\nimport type { DefaultPageBlockComponent } from '../../page-block/default/default-page-block.js';\nimport { getBlockElementById, getModelByElement } from '../utils/index.js';\nimport { affineTextStyles } from './virgo/affine-text.js';\nimport type { AffineTextAttributes } from './virgo/types.js';\n\nexport const REFERENCE_NODE = ' ';\nconst DEFAULT_PAGE_NAME = 'Untitled';\n\nexport type RefNodeSlots = {\n  pageLinkClicked: Slot<{ pageId: string; blockId?: string }>;\n};\n\n@customElement('affine-reference')\nexport class AffineReference extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    .affine-reference {\n      white-space: nowrap;\n      word-break: break-word;\n      color: var(--affine-link-color);\n      fill: var(--affine-link-color);\n      border-radius: 2px;\n      text-decoration: none;\n      cursor: pointer;\n      user-select: none;\n      padding: 0 2px;\n      margin: 0 2px;\n    }\n    .affine-reference:hover {\n      background: var(--affine-hover-color);\n    }\n\n    .affine-reference > svg {\n      margin-right: 4px;\n    }\n\n    .affine-reference > span {\n      white-space: break-spaces;\n    }\n\n    .affine-reference-title {\n      color: var(--affine-text-primary-color);\n    }\n    .affine-reference-title::before {\n      content: attr(data-title);\n      color: var(--affine-link-color);\n    }\n  `;\n\n  @property({ type: Object })\n  delta: DeltaInsert<AffineTextAttributes> = {\n    insert: ZERO_WIDTH_SPACE,\n    attributes: {},\n  };\n\n  // Since the linked page may be deleted, the `_refMeta` could be undefined.\n  @state()\n  private _refMeta?: PageMeta;\n\n  private _refAttribute: NonNullable<AffineTextAttributes['reference']> = {\n    type: 'LinkedPage',\n    pageId: '0',\n  };\n\n  override connectedCallback() {\n    super.connectedCallback();\n    if (this.delta.insert !== REFERENCE_NODE) {\n      console.error(\n        `Reference node must be initialized with '${REFERENCE_NODE}', but got '${this.delta.insert}'`\n      );\n    }\n    const model = getModelByElement(this);\n    const page = model.page;\n\n    this._updateRefMeta(page);\n    this._disposables.add(\n      model.page.workspace.slots.pagesUpdated.on(() =>\n        this._updateRefMeta(page)\n      )\n    );\n\n    // TODO fix User may create a subpage ref node by paste or undo/redo.\n  }\n\n  private _updateRefMeta = (page: Page) => {\n    const refAttribute = this.delta.attributes?.reference;\n    assertExists(refAttribute, 'Failed to get reference attribute!');\n    this._refAttribute = refAttribute;\n    this._refMeta = page.workspace.meta.pageMetas.find(\n      page => page.id === refAttribute.pageId\n    );\n  };\n\n  private _onClick(e: MouseEvent) {\n    const refMeta = this._refMeta;\n    const model = getModelByElement(this);\n    if (!refMeta) {\n      // The page is deleted\n      console.warn('The page is deleted', this._refAttribute.pageId);\n      return;\n    }\n    if (refMeta.id === model.page.id) {\n      // the page is the current page.\n      return;\n    }\n    const targetPageId = refMeta.id;\n    const root = model.page.root;\n    assertExists(root);\n    const element = getBlockElementById(root?.id) as DefaultPageBlockComponent;\n    assertExists(element);\n    element.slots.pageLinkClicked.emit({ pageId: targetPageId });\n  }\n\n  override render() {\n    const refMeta = this._refMeta;\n    const unavailable = !refMeta;\n    const title = unavailable\n      ? // Maybe the page is deleted\n        'Deleted page'\n      : refMeta.title;\n    const attributes = this.delta.attributes;\n    assertExists(attributes, 'Failed to get attributes!');\n    const type = attributes.reference?.type;\n    assertExists(type, 'Unable to get reference type!');\n\n    const style = affineTextStyles(\n      attributes,\n      unavailable\n        ? {\n            color: 'var(--affine-text-disable-color)',\n            fill: 'var(--affine-text-disable-color)',\n          }\n        : {}\n    );\n\n    // Sine reference title should not be edit by user,\n    // we set it into the `::before` pseudo element.\n    //\n    // There are some issues if you try to turn off the `contenteditable` attribute in the title node:\n    //   - the cursor may invisible when trying to move across the reference node using the keyboard\n    //\n    // see also [HTML contenteditable with non-editable islands](https://stackoverflow.com/questions/14615551/html-contenteditable-with-non-editable-islands)\n    //\n    // The virgo will skip the zero-width space when calculating the cursor position,\n    // so we use a other zero-width symbol to make the cursor work correctly.\n\n    // This node is under contenteditable=\"true\",\n    // so we should not add any extra white space between HTML tags\n\n    return html`<span\n      class=\"affine-reference\"\n      style=${style}\n      @click=${this._onClick}\n      >${type === 'LinkedPage' ? FontLinkedPageIcon : FontPageIcon}<span\n        class=\"affine-reference-title\"\n        data-title=${title || DEFAULT_PAGE_NAME}\n        data-virgo-text=\"true\"\n        data-virgo-text-value=${ZERO_WIDTH_NON_JOINER}\n        >${ZERO_WIDTH_NON_JOINER}</span\n      ></span\n    >`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-reference': AffineReference;\n  }\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport {AttributePart, noChange} from '../lit-html.js';\nimport {\n  directive,\n  Directive,\n  DirectiveParameters,\n  PartInfo,\n  PartType,\n} from '../directive.js';\n\n/**\n * A key-value set of class names to truthy values.\n */\nexport interface ClassInfo {\n  readonly [name: string]: string | boolean | number;\n}\n\nclass ClassMapDirective extends Directive {\n  /**\n   * Stores the ClassInfo object applied to a given AttributePart.\n   * Used to unset existing values when a new ClassInfo object is applied.\n   */\n  private _previousClasses?: Set<string>;\n  private _staticClasses?: Set<string>;\n\n  constructor(partInfo: PartInfo) {\n    super(partInfo);\n    if (\n      partInfo.type !== PartType.ATTRIBUTE ||\n      partInfo.name !== 'class' ||\n      (partInfo.strings?.length as number) > 2\n    ) {\n      throw new Error(\n        '`classMap()` can only be used in the `class` attribute ' +\n          'and must be the only part in the attribute.'\n      );\n    }\n  }\n\n  render(classInfo: ClassInfo) {\n    // Add spaces to ensure separation from static classes\n    return (\n      ' ' +\n      Object.keys(classInfo)\n        .filter((key) => classInfo[key])\n        .join(' ') +\n      ' '\n    );\n  }\n\n  override update(part: AttributePart, [classInfo]: DirectiveParameters<this>) {\n    // Remember dynamic classes on the first render\n    if (this._previousClasses === undefined) {\n      this._previousClasses = new Set();\n      if (part.strings !== undefined) {\n        this._staticClasses = new Set(\n          part.strings\n            .join(' ')\n            .split(/\\s/)\n            .filter((s) => s !== '')\n        );\n      }\n      for (const name in classInfo) {\n        if (classInfo[name] && !this._staticClasses?.has(name)) {\n          this._previousClasses.add(name);\n        }\n      }\n      return this.render(classInfo);\n    }\n\n    const classList = part.element.classList;\n\n    // Remove old classes that no longer apply\n    // We use forEach() instead of for-of so that we don't require down-level\n    // iteration.\n    this._previousClasses.forEach((name) => {\n      if (!(name in classInfo)) {\n        classList.remove(name);\n        this._previousClasses!.delete(name);\n      }\n    });\n\n    // Add or remove classes based on their classMap value\n    for (const name in classInfo) {\n      // We explicitly want a loose truthy check of `value` because it seems\n      // more convenient that '' and 0 are skipped.\n      const value = !!classInfo[name];\n      if (\n        value !== this._previousClasses.has(name) &&\n        !this._staticClasses?.has(name)\n      ) {\n        if (value) {\n          classList.add(name);\n          this._previousClasses.add(name);\n        } else {\n          classList.remove(name);\n          this._previousClasses.delete(name);\n        }\n      }\n    }\n    return noChange;\n  }\n}\n\n/**\n * A directive that applies dynamic CSS classes.\n *\n * This must be used in the `class` attribute and must be the only part used in\n * the attribute. It takes each property in the `classInfo` argument and adds\n * the property name to the element's `classList` if the property value is\n * truthy; if the property value is falsey, the property name is removed from\n * the element's `class`.\n *\n * For example `{foo: bar}` applies the class `foo` if the value of `bar` is\n * truthy.\n *\n * @param classInfo\n */\nexport const classMap = directive(ClassMapDirective);\n\n/**\n * The type of the class that powers this directive. Necessary for naming the\n * directive's return type.\n */\nexport type {ClassMapDirective};\n", "import { DRAG_HANDLE_OFFSET_LEFT } from '@blocksuite/global/config';\nimport {\n  assertExists,\n  type Disposable,\n  isFirefox,\n} from '@blocksuite/global/utils';\nimport type { PointerEventState } from '@blocksuite/lit';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/lit';\nimport type { BaseBlockModel } from '@blocksuite/store';\nimport { css, html, LitElement, render } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport {\n  type BlockComponentElement,\n  calcDropTarget,\n  type DroppingType,\n  type EditingState,\n  getBlockElementsExcludeSubtrees,\n  getModelByBlockElement,\n  getRectByBlockElement,\n  isContainedIn,\n  Point,\n  type Rect,\n} from '../__internal__/index.js';\n\nconst handlePreventDocumentDragOverDelay = (event: MouseEvent) => {\n  // Refs: https://stackoverflow.com/a/65910078\n  event.preventDefault();\n};\n\n@customElement('affine-drag-indicator')\nexport class DragIndicator extends LitElement {\n  static override styles = css`\n    .affine-drag-indicator {\n      position: absolute;\n      top: 0;\n      left: 0;\n      background: var(--affine-primary-color);\n      transition-property: width, height, transform;\n      transition-duration: 100ms;\n      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n      transition-delay: 0s;\n      transform-origin: 0 0;\n      pointer-events: none;\n      z-index: 1;\n    }\n  `;\n\n  @property()\n  rect: Rect | null = null;\n\n  override render() {\n    if (!this.rect) {\n      return null;\n    }\n    const { left, top, width, height } = this.rect;\n    const style = styleMap({\n      width: `${width}px`,\n      height: `${height}px`,\n      transform: `translate(${left}px, ${top}px)`,\n    });\n    return html`<div class=\"affine-drag-indicator\" style=${style}></div>`;\n  }\n}\n\n@customElement('affine-drag-preview')\nexport class DragPreview extends ShadowlessElement {\n  @property()\n  offset = { x: 0, y: 0 };\n\n  override render() {\n    return html`<style>\n      affine-drag-preview {\n        --x: 0px;\n        --y: 0px;\n        height: auto;\n        display: block;\n        position: absolute;\n        box-sizing: border-box;\n        font-family: var(--affine-font-family);\n        font-size: var(--affine-font-base);\n        line-height: var(--affine-line-height);\n        color: var(--affine-text-primary-color);\n        font-weight: 400;\n        top: 0;\n        left: 0;\n        opacity: 0.843;\n        cursor: none;\n        user-select: none;\n        pointer-events: none;\n        caret-color: transparent;\n        transform-origin: 0 0;\n        z-index: 2;\n      }\n\n      affine-drag-preview > .affine-block-element {\n        pointer-events: none;\n      }\n\n      affine-drag-preview > .affine-block-element:first-child > *:first-child {\n        margin-top: 0;\n      }\n\n      affine-drag-preview .affine-rich-text {\n        user-modify: read-only;\n        -webkit-user-modify: read-only;\n      }\n\n      affine-drag-preview.grabbing {\n        cursor: grabbing;\n        pointer-events: auto;\n      }\n\n      affine-drag-preview.grabbing:after {\n        content: '';\n        display: block;\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 24px;\n        height: 24px;\n        transform: translate(var(--x), var(--y));\n      }\n    </style>`;\n  }\n}\n\nconst DRAG_HANDLE_HEIGHT = 16; // px FIXME\nconst DRAG_HANDLE_WIDTH = 24; // px\n\n@customElement('affine-drag-handle')\nexport class DragHandle extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      top: 0;\n      left: 0;\n      overflow: hidden;\n      width: ${DRAG_HANDLE_WIDTH + 8}px;\n      transform-origin: 0 0;\n      pointer-events: none;\n      user-select: none;\n    }\n\n    :host(:hover) > .affine-drag-handle-line {\n      opacity: 1;\n    }\n\n    .affine-drag-handle-line {\n      opacity: 0;\n      width: 1px;\n      height: 100%;\n      position: absolute;\n      left: ${(DRAG_HANDLE_WIDTH - 1) / 2}px;\n      background-color: var(--affine-icon-color);\n      transition: opacity ease-in-out 300ms;\n      pointer-events: none;\n    }\n\n    .affine-drag-handle {\n      position: absolute;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      width: ${DRAG_HANDLE_WIDTH}px;\n      height: ${DRAG_HANDLE_HEIGHT}px;\n      /* background-color: var(--affine-white-90); */\n      pointer-events: auto;\n      color: var(--affine-icon-color);\n    }\n\n    @media print {\n      .affine-drag-handle-line {\n        display: none;\n      }\n\n      .affine-drag-handle {\n        display: none;\n      }\n    }\n\n    .affine-drag-handle-normal {\n      display: flex;\n      stroke: currentcolor;\n    }\n\n    .affine-drag-handle-hover {\n      fill: currentcolor;\n      transition: opacity ease-in-out 300ms;\n    }\n\n    .affine-drag-handle-hover path.ok {\n      stroke: var(--affine-white-90);\n    }\n\n    .affine-drag-handle-hover {\n      display: none;\n    }\n\n    :host(:hover) .affine-drag-handle-normal,\n    :host([data-selected]) .affine-drag-handle-normal {\n      display: none !important;\n    }\n\n    :host(:hover) .affine-drag-handle-hover,\n    :host([data-selected]) .affine-drag-handle-hover {\n      display: flex !important;\n      /* padding-top: 5px !important; FIXME */\n    }\n  `;\n\n  constructor(options: {\n    container: HTMLElement;\n    onDropCallback: (\n      point: Point,\n      draggingBlockElements: BlockComponentElement[],\n      lastModelState: EditingState | null,\n      lastType: DroppingType\n    ) => void;\n    setDragType: (dragging: boolean) => void;\n    setSelectedBlock: (\n      selectedBlock: EditingState | null,\n      element?: Element\n    ) => void;\n    getSelectedBlocks: () => BlockComponentElement[] | null;\n    getClosestBlockElement: (point: Point) => Element | null;\n  }) {\n    super();\n    this.getDropAllowedBlocks = () => {\n      console.warn('you may forget to set `getAllowedBlocks`');\n      return [];\n    };\n    this.addEventListener('beforeprint', () => this.hide(true));\n    this.onDropCallback = options?.onDropCallback;\n    this.setDragType = options?.setDragType;\n    this.setSelectedBlock = options?.setSelectedBlock;\n    this._getSelectedBlocks = options?.getSelectedBlocks;\n    this._getClosestBlockElement = options?.getClosestBlockElement;\n    options?.container.appendChild(this);\n    this._container = options?.container;\n  }\n\n  /**\n   * A function that returns all blocks that are allowed to be moved to\n   *\n   * If there is `draggingBlock`, the user is dragging a block to another place\n   *\n   */\n  public getDropAllowedBlocks: (\n    draggingBlockIds: string[] | null\n  ) => BaseBlockModel[];\n\n  public onDropCallback: (\n    point: Point,\n    draggingBlockElements: BlockComponentElement[],\n    lastModelState: EditingState | null,\n    lastType: DroppingType\n  ) => void;\n\n  public setDragType: (dragging: boolean) => void;\n\n  public setSelectedBlock: (\n    selectedBlock: EditingState | null,\n    element?: Element\n  ) => void;\n\n  private _getSelectedBlocks: () => BlockComponentElement[] | null;\n\n  private _getClosestBlockElement: (point: Point) => Element | null;\n\n  @query('.affine-drag-handle')\n  private _dragHandle!: HTMLDivElement;\n\n  private _draggingElements: BlockComponentElement[] = [];\n\n  private _scale = 1;\n  private _currentClientX = 0;\n  private _currentClientY = 0;\n  private _stopPropagation = false;\n\n  /**\n   * Current drag handle model state\n   */\n  private _handleAnchorState: EditingState | null = null;\n  private _handleAnchorDisposable: Disposable | null = null;\n\n  /**\n   * Last drag handle dropping target state\n   */\n  private _lastDroppingTarget: EditingState | null = null;\n  private _lastDroppingType: DroppingType = 'none';\n  private _indicator: DragIndicator | null = null;\n  private _container: HTMLElement;\n  private _dragPreview: DragPreview | null = null;\n\n  protected get selectedBlocks() {\n    return this._getSelectedBlocks() ?? [];\n  }\n\n  onContainerMouseMove(\n    event: PointerEventState,\n    modelState: EditingState | null\n  ) {\n    const frameBlock = this._container.querySelector(\n      '.affine-frame-block-container'\n    );\n    assertExists(frameBlock);\n    const frameBlockRect = frameBlock.getBoundingClientRect();\n    // See https://github.com/toeverything/blocksuite/issues/1611\n    if (event.raw.clientY < frameBlockRect.y) {\n      this.hide();\n    }\n\n    if (modelState) {\n      const { rect, element } = modelState;\n      let startX = rect.left;\n      let startY = rect.top;\n      let height = rect.height;\n      let selected = false;\n      const selectedBlocks = this.selectedBlocks;\n      if (selectedBlocks.includes(element)) {\n        selected = true;\n\n        if (selectedBlocks.length > 1) {\n          const tempSelectedBlocks =\n            getBlockElementsExcludeSubtrees(selectedBlocks);\n          const first = getRectByBlockElement(tempSelectedBlocks[0]);\n          const last = getRectByBlockElement(\n            tempSelectedBlocks[tempSelectedBlocks.length - 1]\n          );\n          startX = first.left;\n          startY = first.top;\n          height = last.bottom - first.top;\n        }\n      }\n      this.toggleAttribute('data-selected', selected);\n      this._handleAnchorState = modelState;\n      this.style.display = 'block';\n      this.style.height = `${height / this._scale}px`;\n      this.style.width = `${DRAG_HANDLE_WIDTH}px`;\n\n      const containerRect = this._container.getBoundingClientRect();\n      const posX =\n        startX -\n        containerRect.left -\n        (DRAG_HANDLE_WIDTH + DRAG_HANDLE_OFFSET_LEFT) * this._scale;\n      const posY = startY - containerRect.top;\n\n      this.style.transform = `translate(${posX}px, ${posY}px) scale(${this._scale})`;\n      this.style.opacity = `${(\n        1 -\n        (event.raw.clientX - startX) / rect.width\n      ).toFixed(2)}`;\n\n      const top = this._calcDragHandleY(\n        event.raw.clientY,\n        startY,\n        height,\n        this._scale\n      );\n      this._dragHandle.style.transform = `translateY(${top}px)`;\n\n      if (this._handleAnchorDisposable) {\n        this._handleAnchorDisposable.dispose();\n      }\n\n      this._handleAnchorDisposable = modelState.model.propsUpdated.on(() => {\n        this.hide();\n      });\n\n      return;\n    }\n\n    this.hide();\n  }\n\n  hide(force = false) {\n    this.style.display = 'none';\n    if (force) this.reset();\n  }\n\n  reset() {\n    this._handleAnchorState = null;\n    this._lastDroppingType = 'none';\n    this._lastDroppingTarget = null;\n\n    if (this._indicator) {\n      this._indicator.rect = null;\n    }\n\n    this._draggingElements.forEach(e => {\n      e.style.opacity = '1';\n    });\n\n    this._draggingElements = [];\n  }\n\n  setPointerEvents(value: 'auto' | 'none') {\n    this.style.pointerEvents = value;\n  }\n\n  setScale(value = 1) {\n    this._scale = value;\n  }\n\n  override firstUpdated() {\n    this.style.display = 'none';\n    this.style.position = 'absolute';\n    this._indicator = <DragIndicator>(\n      document.querySelector('affine-drag-indicator')\n    );\n    if (!this._indicator) {\n      this._indicator = <DragIndicator>(\n        document.createElement('affine-drag-indicator')\n      );\n      document.body.appendChild(this._indicator);\n    }\n\n    const disposables = this._disposables;\n\n    // event bindings\n\n    // document\n    if (isFirefox) {\n      disposables.addFromEvent(\n        this._container,\n        'dragover',\n        this._onDragOverDocument\n      );\n    }\n\n    // document.body\n    disposables.addFromEvent(\n      document.body,\n      'dragover',\n      handlePreventDocumentDragOverDelay,\n      false\n    );\n\n    // host\n    disposables.addFromEvent(this, 'mousemove', this._onMouseMoveOnHost);\n\n    // drag handle\n    disposables.addFromEvent(this._dragHandle, 'click', this._onClick);\n    // 1. In edgeless, native DnD will work fine.\n    // 2. In page, hosted with editor-container mouse events and scroll wheel support.\n    disposables.addFromEvent(this._dragHandle, 'dragstart', this.onDragStart);\n    disposables.addFromEvent(this._dragHandle, 'drag', this.onDrag);\n    disposables.addFromEvent(this._dragHandle, 'dragend', this.onDragEnd);\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n\n    // cleanup\n    this.hide(true);\n\n    this._handleAnchorDisposable?.dispose();\n  }\n\n  private _onMouseMoveOnHost(e: MouseEvent) {\n    if (isFirefox) {\n      this._currentClientX = e.clientX;\n      this._currentClientY = e.clientY;\n    }\n\n    if (this._stopPropagation) {\n      e.stopPropagation();\n    }\n\n    if (!this._handleAnchorState) {\n      return;\n    }\n\n    const { rect, element } = this._handleAnchorState;\n    const selectedBlocks = this.selectedBlocks;\n    let startY = rect.top;\n    let height = rect.height;\n\n    if (selectedBlocks.includes(element) && selectedBlocks.length > 1) {\n      const tempSelectedBlocks =\n        getBlockElementsExcludeSubtrees(selectedBlocks);\n      const first = getRectByBlockElement(tempSelectedBlocks[0]);\n      const last = getRectByBlockElement(\n        tempSelectedBlocks[tempSelectedBlocks.length - 1]\n      );\n      startY = first.top;\n      height = last.bottom - first.top;\n    }\n\n    const top = this._calcDragHandleY(e.clientY, startY, height, this._scale);\n\n    this._dragHandle.style.cursor = 'grab';\n    this._dragHandle.style.transform = `translateY(${top}px)`;\n  }\n\n  private _calcDragHandleY(\n    clientY: number,\n    startY: number,\n    height: number,\n    scale: number\n  ) {\n    return (\n      Math.max(\n        0,\n        Math.min(\n          clientY - startY - (DRAG_HANDLE_HEIGHT * scale) / 2,\n          height - DRAG_HANDLE_HEIGHT * scale\n        )\n      ) / scale\n    );\n  }\n\n  private _createDragPreview(\n    e: DragEvent,\n    blockElements: BlockComponentElement[],\n    grabbing = false\n  ) {\n    const dragPreview = (this._dragPreview = new DragPreview());\n    const containerRect = this._container.getBoundingClientRect();\n    const rect = blockElements[0].getBoundingClientRect();\n    const { clientX, clientY } = e;\n    const s = this._scale;\n\n    const l = rect.left - containerRect.left;\n    const t = rect.top - containerRect.top;\n    dragPreview.offset.x = l - clientX;\n    dragPreview.offset.y = t - clientY;\n    dragPreview.style.width = `${rect.width / s}px`;\n    dragPreview.style.transform = `translate(${l}px, ${t}px) scale(${s})`;\n    const x = -dragPreview.offset.x - containerRect.left - 24 / 2;\n    const y = -dragPreview.offset.y - containerRect.top - 24 / 2;\n    dragPreview.style.setProperty('--x', `${x}px`);\n    dragPreview.style.setProperty('--y', `${y}px`);\n\n    const fragment = document.createDocumentFragment();\n\n    blockElements.forEach(e => {\n      const c = document.createElement('div');\n      c.classList.add('affine-block-element');\n      render(e.render(), c);\n      fragment.appendChild(c);\n    });\n\n    dragPreview.appendChild(fragment);\n    this._container.appendChild(dragPreview);\n\n    if (grabbing) {\n      dragPreview.classList.add('grabbing');\n    }\n\n    requestAnimationFrame(() => {\n      dragPreview.querySelector('rich-text')?.vEditor?.rootElement.blur();\n    });\n  }\n\n  private _removeDragPreview() {\n    if (this._dragPreview) {\n      this._dragPreview.remove();\n      this._dragPreview = null;\n    }\n  }\n\n  // - select current block\n  // - trigger slash menu\n  private _onClick = (e: MouseEvent) => {\n    const { selectedBlocks } = this;\n    let { _handleAnchorState: modelState } = this;\n    const element = modelState?.element;\n    if (modelState && selectedBlocks.length && element === selectedBlocks[0]) {\n      modelState = null;\n    }\n    this.setSelectedBlock(modelState, element);\n    this.toggleAttribute('data-selected', Boolean(modelState));\n    e.stopPropagation();\n  };\n\n  private _onDragOverDocument = (e: DragEvent) => {\n    if (!isFirefox) {\n      throw new Error('FireFox only');\n    }\n    this._currentClientX = e.clientX;\n    this._currentClientY = e.clientY;\n  };\n\n  onDragStart = (e: DragEvent, draggable = false) => {\n    if (this._dragPreview || !e.dataTransfer) return;\n\n    e.dataTransfer.effectAllowed = 'move';\n\n    const modelState = this._handleAnchorState;\n    let draggingBlockElements = this.selectedBlocks;\n\n    if (modelState && !draggingBlockElements.includes(modelState.element)) {\n      draggingBlockElements = [modelState.element];\n      // select current block\n      this.setSelectedBlock(modelState);\n    }\n\n    this._draggingElements = draggingBlockElements;\n\n    this._createDragPreview(\n      e,\n      getBlockElementsExcludeSubtrees(\n        draggingBlockElements\n      ) as BlockComponentElement[],\n      draggable\n    );\n\n    this.setDragType(true);\n  };\n\n  onDrag = (e: DragEvent, passed?: boolean, isScrolling?: boolean) => {\n    this._dragHandle.style.cursor = 'grabbing';\n    let x = e.clientX;\n    let y = e.clientY;\n    if (!passed && isFirefox) {\n      // In Firefox, `pageX` and `pageY` are always set to 0.\n      // Refs: https://stackoverflow.com/questions/13110349/pagex-and-pagey-are-always-set-to-0-in-firefox-during-the-ondrag-event.\n      x = this._currentClientX;\n      y = this._currentClientY;\n    }\n\n    if (\n      !this._indicator ||\n      (!passed &&\n        this._indicator.rect &&\n        this._indicator.rect.left === x &&\n        this._indicator.rect.top === y)\n    ) {\n      return;\n    }\n\n    if (this._dragPreview && e.screenY) {\n      const { x: offsetX, y: offsetY } = this._dragPreview.offset;\n      const l = x + offsetX;\n      const t = y + offsetY;\n      const s = this._scale;\n      this._dragPreview.style.transform = `translate(${l}px, ${t}px) scale(${s})`;\n    }\n\n    if (isScrolling) return;\n\n    const point = new Point(x, y);\n    const element = this._getClosestBlockElement(point.clone());\n    let type: DroppingType = 'none';\n    let rect = null;\n    let lastModelState = null;\n\n    if (element) {\n      // Array: array does not contains the target\n      // DOM: elements does not contains the target\n      if (\n        !this._draggingElements.includes(element as BlockComponentElement) &&\n        !isContainedIn(this._draggingElements, element)\n      ) {\n        const model = getModelByBlockElement(element);\n        const result = calcDropTarget(\n          point,\n          model,\n          element,\n          this._draggingElements,\n          this._scale\n        );\n\n        if (result) {\n          type = result.type;\n          rect = result.rect;\n          lastModelState = result.modelState;\n        }\n      }\n    }\n\n    this._indicator.rect = rect;\n    this._lastDroppingType = type;\n    this._lastDroppingTarget = lastModelState;\n  };\n\n  onDragEnd = (e: DragEvent, passed?: boolean) => {\n    this._stopPropagation = false;\n\n    const dropEffect = e.dataTransfer?.dropEffect ?? 'none';\n\n    this._removeDragPreview();\n\n    this.setDragType(false);\n\n    // `Esc`\n    if (!passed && dropEffect === 'none') {\n      this.hide(true);\n      return;\n    }\n\n    assertExists(this._draggingElements);\n\n    // `drag.clientY` !== `dragend.clientY` in chrome.\n    this.onDropCallback?.(\n      this._indicator?.rect?.min ?? new Point(e.clientX, e.clientY),\n      // blockElements include subtrees\n      this._draggingElements,\n      this._lastDroppingTarget,\n      this._lastDroppingType\n    );\n\n    this.hide(true);\n  };\n\n  override render() {\n    return html`\n      <div class=\"affine-drag-handle-line\"></div>\n      <div class=\"affine-drag-handle\" draggable=\"true\">\n        <svg\n          class=\"affine-drag-handle-normal\"\n          width=\"16\"\n          height=\"18\"\n          viewBox=\"0 0 16 12\"\n          fill=\"none\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n        >\n          <rect\n            x=\"7.7782\"\n            y=\"0.707107\"\n            width=\"10\"\n            height=\"10\"\n            rx=\"2.5\"\n            transform=\"rotate(45 7.7782 0.707107)\"\n          />\n        </svg>\n\n        <svg\n          class=\"affine-drag-handle-hover\"\n          width=\"16\"\n          height=\"18\"\n          viewBox=\"0 0 16 12\"\n          fill=\"none\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n        >\n          <path\n            d=\"M2.41421 6.58579L6.58579 2.41421C7.36684 1.63317 8.63316 1.63316 9.41421 2.41421L13.5858 6.58579C14.3668 7.36684 14.3668 8.63316 13.5858 9.41421L9.41421 13.5858C8.63316 14.3668 7.36684 14.3668 6.58579 13.5858L2.41421 9.41421C1.63317 8.63316 1.63316 7.36684 2.41421 6.58579Z\"\n            stroke-width=\"1.5\"\n          />\n          <path\n            class=\"ok\"\n            d=\"M5 8.5L7.5 10.5L10.5 7\"\n            stroke-width=\"1.5\"\n            stroke-linecap=\"round\"\n            stroke-linejoin=\"round\"\n          />\n        </svg>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-drag-handle': DragHandle;\n    'affine-drag-indicator': DragIndicator;\n    'affine-drag-preview': DragPreview;\n  }\n}\n", "import {\n  BLOCKHUB_FILE_ITEMS,\n  BLOCKHUB_LIST_ITEMS,\n  BLOCKHUB_TEXT_ITEMS,\n  BlockHubIcon,\n  BlockHubRoundedRectangleIcon,\n  CrossIcon,\n  DatabaseTableViewIcon,\n  EmbedIcon,\n  NumberedListIconLarge,\n  TextIconLarge,\n} from '@blocksuite/global/config';\nimport { assertExists, isFirefox } from '@blocksuite/global/utils';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/lit';\nimport type { BaseBlockModel, Page } from '@blocksuite/store';\nimport { css, html } from 'lit';\nimport {\n  customElement,\n  property,\n  query,\n  queryAll,\n  state,\n} from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type {\n  AbstractEditor,\n  EditingState,\n  Rect,\n} from '../__internal__/index.js';\nimport {\n  calcDropTarget,\n  type DroppingType,\n  getClosestBlockElementByPoint,\n  getModelByBlockElement,\n  Point,\n} from '../__internal__/index.js';\nimport { type DragIndicator } from './drag-handle.js';\nimport { tooltipStyle } from './tooltip/tooltip.js';\n\nconst styles = css`\n  affine-block-hub {\n    position: absolute;\n    z-index: 1;\n    user-select: none;\n  }\n\n  @media print {\n    affine-block-hub {\n      display: none;\n    }\n  }\n\n  .affine-block-hub-container {\n    width: 274px;\n    position: absolute;\n    right: calc(100% + 8px);\n    overflow-y: unset;\n    display: none;\n    justify-content: center;\n    fill: var(--affine-icon-color);\n    color: var(--affine-icon-color);\n    font-size: var(--affine-font-sm);\n    background: var(--affine-background-overlay-panel-color);\n    box-shadow: var(--affine-menu-shadow);\n    border-radius: 8px;\n  }\n\n  .affine-block-hub-container[type='text'] {\n    top: unset;\n    bottom: 0;\n    transform: unset;\n    right: calc(100% + 4px);\n  }\n\n  .visible {\n    display: block;\n  }\n\n  .invisible {\n    display: none;\n  }\n\n  .card-container-wrapper {\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    position: relative;\n  }\n\n  .card-container {\n    display: flex;\n    position: relative;\n    align-items: center;\n    width: 250px;\n    height: 54px;\n    background: var(--affine-white-80);\n    box-shadow: var(--affine-shadow-1);\n    border-radius: 8px;\n    margin-bottom: 12px;\n    cursor: grab;\n    top: 0;\n    left: 0;\n    transition: all 0.1s ease-in-out;\n  }\n\n  .card-icon-container {\n    display: flex;\n    align-items: center;\n    position: absolute;\n    right: 12px;\n  }\n\n  .card-icon-container > svg {\n    width: 20px;\n    height: 20px;\n  }\n\n  .card-container-inner:hover .card-container {\n    background: var(--affine-hover-color);\n    top: -2px;\n    left: -2px;\n  }\n\n  .card-container-inner:hover .card-container.grabbing {\n    top: unset;\n    left: unset;\n    box-shadow: var(--affine-shadow-2);\n  }\n\n  .card-description-container {\n    display: block;\n    width: 190px;\n    color: var(--affine-text-primary-color);\n    font-size: var(--affine-font-base);\n    line-height: var(--affine-line-height);\n    margin: 8px 0 8px 12px;\n    text-align: justify;\n  }\n\n  .affine-block-hub-container .description {\n    font-size: var(--affine-font-sm);\n    line-height: var(--affine-line-height);\n    color: var(--affine-text-secondary-color);\n    white-space: pre;\n  }\n\n  .grabbing {\n    cursor: grabbing;\n  }\n\n  .grab {\n    cursor: grab;\n  }\n\n  .affine-block-hub-title-container {\n    margin: 16px 0 20px 12px;\n    color: var(--affine-text-secondary-color);\n    font-size: var(--affine-font-base);\n    user-select: none;\n  }\n\n  .prominent {\n    z-index: 1;\n  }\n\n  .block-hub-menu-container {\n    display: flex;\n    font-family: var(--affine-font-family);\n    flex-flow: column;\n    justify-content: center;\n    align-items: center;\n    position: fixed;\n    width: 44px;\n    background: var(--affine-background-primary-color);\n    border-radius: 8px;\n  }\n\n  .block-hub-menu-container[expanded] {\n    box-shadow: var(--affine-menu-shadow);\n    background: var(--affine-background-overlay-panel-color);\n  }\n\n  .block-hub-icon-container {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    margin-bottom: 8px;\n    position: relative;\n    border-radius: 4px;\n    fill: var(--affine-icon-color);\n    color: var(--affine-icon-color);\n    height: 36px;\n  }\n  .block-hub-icon-container svg {\n    width: 24px;\n    height: 24px;\n  }\n\n  .block-hub-icon-container[selected='true'] {\n    background: var(--affine-hover-color);\n  }\n\n  .block-hub-icon-container:hover {\n    background: var(--affine-hover-color);\n    border-radius: 4px;\n  }\n\n  .new-icon {\n    width: 44px;\n    height: 44px;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    border-radius: 8px;\n    fill: var(--affine-icon-color);\n  }\n\n  .new-icon-in-edgeless {\n    box-shadow: var(--affine-menu-shadow);\n  }\n  .block-hub-menu-container[expanded] .new-icon {\n    border-radius: 4px;\n    box-shadow: unset;\n  }\n\n  .new-icon:hover {\n    box-shadow: var(--affine-menu-shadow);\n    background: var(--affine-white);\n  }\n\n  .icon-expanded {\n    width: 36px;\n    height: 36px;\n  }\n\n  .icon-expanded:hover {\n    background: var(--affine-hover-color);\n  }\n\n  .divider {\n    height: 1px;\n    width: 36px;\n    background: var(--affine-border-color);\n    margin: 4px 0;\n  }\n\n  [role='menuitem'] tool-tip {\n    font-size: var(--affine-font-sm);\n  }\n\n  .block-hub-icons-container {\n    overflow: hidden;\n    transition: all 0.2s cubic-bezier(0, 0, 0.55, 1.6);\n  }\n\n  ${tooltipStyle}\n`;\n\ntype BlockHubItem = {\n  flavour: string;\n  type: string | null;\n  name: string;\n  description: string;\n  icon: unknown;\n  tooltip: string;\n};\n\ntype CardListType = 'blank' | 'list' | 'text' | 'database' | 'file';\n\nconst TRANSITION_DELAY = 200;\nconst BOTTOM_OFFSET = 70;\nconst RIGHT_OFFSET = 24;\nconst TOP_DISTANCE = 24;\n\nfunction shouldDisplayCard(\n  type: CardListType | null,\n  expanded: boolean,\n  isCardListVisible: boolean,\n  visibleCardType: CardListType | null\n) {\n  return expanded && isCardListVisible && visibleCardType === type;\n}\n\nfunction BlockHubCards(\n  blockHubItems: BlockHubItem[],\n  type: string,\n  title: string,\n  maxHeight: number,\n  shouldDisplayCard: boolean,\n  isGrabbing: boolean,\n  showTooltip: boolean\n) {\n  const shouldScroll = maxHeight < 800;\n  const styles = styleMap({\n    maxHeight: `${maxHeight}px`,\n    overflowY: shouldScroll ? 'scroll' : 'unset',\n  });\n  return html`\n    <div\n      class=\"affine-block-hub-container ${shouldDisplayCard ? 'visible' : ''}\"\n      style=\"${styles}\"\n      type=${type}\n    >\n      <div class=\"affine-block-hub-title-container\">${title}</div>\n      ${blockHubItems.map(\n        ({ flavour, type, name, description, icon, tooltip }, index) => {\n          return html`\n            <div class=\"card-container-wrapper\">\n              <div class=\"card-container-inner\">\n                <div\n                  class=\"card-container has-tool-tip ${isGrabbing\n                    ? 'grabbing'\n                    : ''}\"\n                  draggable=\"true\"\n                  affine-flavour=${flavour}\n                  affine-type=${type ?? ''}\n                >\n                  <div class=\"card-description-container\">\n                    <div>${name}</div>\n                    <div class=\"description\">${description}</div>\n                  </div>\n                  <div class=\"card-icon-container\">${icon}</div>\n                  <tool-tip\n                    tip-position=${shouldScroll &&\n                    index === blockHubItems.length - 1\n                      ? 'top'\n                      : 'bottom'}\n                    style=\"${showTooltip\n                      ? ''\n                      : 'display: none'}; z-index: ${blockHubItems.length -\n                    index}\"\n                    >${tooltip}</tool-tip\n                  >\n                </div>\n              </div>\n            </div>\n          `;\n        }\n      )}\n    </div>\n  `;\n}\n\nfunction BlockHubMenu(\n  enableDatabase: boolean,\n  expanded: boolean,\n  isGrabbing: boolean,\n  visibleCardType: CardListType | null,\n  isCardListVisible: boolean,\n  showTooltip: boolean,\n  maxHeight: number,\n  page: Page\n) {\n  const menuNum = enableDatabase ? 5 : 4;\n  const height = menuNum * 44 + 10;\n\n  const blockHubListCards = BlockHubCards(\n    BLOCKHUB_LIST_ITEMS,\n    'list',\n    'List',\n    maxHeight,\n    shouldDisplayCard('list', expanded, isCardListVisible, visibleCardType),\n    isGrabbing,\n    showTooltip\n  );\n\n  const blockHubFileCards = BlockHubCards(\n    BLOCKHUB_FILE_ITEMS.filter(({ flavour }) => {\n      if (flavour === 'affine:bookmark') {\n        return page.awarenessStore.getFlag('enable_bookmark_operation');\n      }\n      return true;\n    }),\n    'file',\n    'Content & Media',\n    maxHeight,\n    shouldDisplayCard('file', expanded, isCardListVisible, visibleCardType),\n    isGrabbing,\n    showTooltip\n  );\n\n  return html`\n    <div\n      class=\"block-hub-icons-container\"\n      ?transition=${expanded}\n      style=\"height: ${expanded ? `${height}px` : '0'};\"\n    >\n      <div\n        class=\"block-hub-icon-container has-tool-tip ${isGrabbing\n          ? 'grabbing'\n          : 'grab'}\"\n        selected=${visibleCardType === 'blank' ? 'true' : 'false'}\n        type=\"blank\"\n        draggable=\"true\"\n        affine-flavour=\"affine:paragraph\"\n        affine-type=\"text\"\n      >\n        ${BlockHubRoundedRectangleIcon}\n        <tool-tip\n          inert\n          role=\"tooltip\"\n          tip-position=\"left\"\n          ?hidden=${!showTooltip}\n          >Drag to insert blank line\n        </tool-tip>\n      </div>\n      <div\n        class=\"block-hub-icon-container\"\n        type=\"text\"\n        selected=${visibleCardType === 'text' ? 'true' : 'false'}\n      >\n        ${TextIconLarge}\n      </div>\n      <div\n        class=\"block-hub-icon-container\"\n        type=\"list\"\n        selected=${visibleCardType === 'list' ? 'true' : 'false'}\n      >\n        ${blockHubListCards} ${NumberedListIconLarge}\n      </div>\n      <div\n        class=\"block-hub-icon-container\"\n        type=\"file\"\n        selected=${visibleCardType === 'file' ? 'true' : 'false'}\n      >\n        ${blockHubFileCards} ${EmbedIcon}\n      </div>\n      ${enableDatabase\n        ? html`\n            <div\n              class=\"block-hub-icon-container has-tool-tip\"\n              type=\"database\"\n              draggable=\"true\"\n              affine-flavour=\"affine:database\"\n              selected=${visibleCardType === 'database' ? 'true' : 'false'}\n            >\n              ${DatabaseTableViewIcon}\n              <tool-tip\n                inert\n                role=\"tooltip\"\n                tip-position=\"left\"\n                ?hidden=${!showTooltip}\n              >\n                Drag to create a database\n              </tool-tip>\n            </div>\n          `\n        : null}\n      <div class=\"divider\"></div>\n    </div>\n  `;\n}\n\n@customElement('affine-block-hub')\nexport class BlockHub extends WithDisposable(ShadowlessElement) {\n  /**\n   * A function that returns all blocks that are allowed to be moved to\n   */\n  @property()\n  public getAllowedBlocks: () => BaseBlockModel[];\n\n  @property()\n  public getHoveringFrameState: (point: Point) => {\n    container?: Element;\n    rect?: Rect;\n    scale: number;\n  };\n\n  @state()\n  private _expanded = false;\n\n  @state()\n  private _isGrabbing = false;\n\n  @state()\n  private _visibleCardType: CardListType | null = null;\n\n  @state()\n  private _showTooltip = true;\n  @state()\n  private _inEdgelessMode = false;\n\n  @state()\n  private _maxHeight = 2000;\n\n  @queryAll('.card-container')\n  private _blockHubCards!: HTMLElement[];\n\n  @queryAll('.block-hub-icon-container[type]')\n  private _blockHubMenus!: HTMLElement[];\n\n  @query('.new-icon')\n  private _blockHubButton!: HTMLElement;\n\n  @query('.block-hub-icons-container')\n  private _blockHubIconsContainer!: HTMLElement;\n\n  @query('.block-hub-menu-container')\n  private _blockHubMenuContainer!: HTMLElement;\n\n  @query('[role=\"menuitem\"]')\n  private _blockHubMenuEntry!: HTMLElement;\n\n  private _page: Page;\n\n  private readonly _onDragStartCallback: () => void;\n\n  private readonly _onDropCallback: (\n    e: DragEvent,\n    point: Point,\n    lastModelState: EditingState | null,\n    lastType: DroppingType\n  ) => Promise<void>;\n\n  private readonly _onClickCardCallback: (data: {\n    flavour: string;\n    type?: string;\n  }) => Promise<void>;\n\n  private _currentClientX = 0;\n  private _currentClientY = 0;\n  private _isCardListVisible = false;\n  private _indicator!: DragIndicator;\n  private _lastDroppingTarget: EditingState | null = null;\n  private _lastDroppingType: DroppingType = 'none';\n  private _lastDraggingFlavour: string | null = null;\n  private _timer: number | null = null;\n  private readonly _enableDatabase: boolean;\n  private _mouseRoot: AbstractEditor;\n\n  static override styles = styles;\n\n  constructor(options: {\n    mouseRoot: AbstractEditor;\n    enableDatabase: boolean;\n    getAllowedBlocks: () => BaseBlockModel[];\n    getHoveringFrameState: (point: Point) => {\n      container?: Element;\n      rect?: Rect;\n      scale: number;\n    };\n    onDragStart: () => void;\n    onDrop: (\n      e: DragEvent,\n      point: Point,\n      lastModelState: EditingState | null,\n      lastType: DroppingType\n    ) => Promise<void>;\n    onClickCard: (data: { flavour: string; type?: string }) => Promise<void>;\n    page: Page;\n  }) {\n    super();\n    this._page = options.page;\n    this._mouseRoot = options.mouseRoot;\n    this._enableDatabase = options.enableDatabase;\n    this.getAllowedBlocks = options.getAllowedBlocks;\n    this.getHoveringFrameState = options.getHoveringFrameState;\n\n    this._onDragStartCallback = options.onDragStart;\n    this._onDropCallback = options.onDrop;\n    this._onClickCardCallback = options.onClickCard;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    const disposables = this._disposables;\n    disposables.addFromEvent(this, 'dragstart', this._onDragStart);\n    disposables.addFromEvent(this, 'drag', this._onDrag);\n    disposables.addFromEvent(this, 'dragend', this._onDragEnd);\n\n    disposables.addFromEvent(this._mouseRoot, 'dragover', this._onDragOver);\n    disposables.addFromEvent(this._mouseRoot, 'drop', this._onDrop);\n    disposables.addFromEvent(this, 'mousedown', this._onMouseDown);\n    disposables.add(\n      this._mouseRoot.slots.pageModeSwitched.on(mode => {\n        this._inEdgelessMode = mode === 'edgeless';\n      })\n    );\n    if (isFirefox) {\n      disposables.addFromEvent(\n        this._mouseRoot,\n        'dragover',\n        this._onDragOverDocument\n      );\n    }\n\n    this._onResize();\n  }\n\n  override firstUpdated() {\n    const disposables = this._disposables;\n    this._blockHubCards.forEach(card => {\n      disposables.addFromEvent(card, 'mousedown', this._onCardMouseDown);\n      disposables.addFromEvent(card, 'mouseup', this._onCardMouseUp);\n      disposables.addFromEvent(card, 'click', e => this._onClickCard(e, card));\n    });\n    for (const blockHubMenu of this._blockHubMenus) {\n      disposables.addFromEvent(\n        blockHubMenu,\n        'mouseover',\n        this._onBlockHubMenuMouseOver\n      );\n      if (blockHubMenu.getAttribute('type') === 'blank') {\n        disposables.addFromEvent(\n          blockHubMenu,\n          'mousedown',\n          this._onBlankMenuMouseDown\n        );\n        disposables.addFromEvent(\n          blockHubMenu,\n          'mouseup',\n          this._onBlankMenuMouseUp\n        );\n      }\n    }\n    disposables.addFromEvent(\n      this._blockHubMenuEntry,\n      'mouseover',\n      this._onBlockHubEntryMouseOver\n    );\n    disposables.addFromEvent(document, 'click', this._onClickOutside);\n    disposables.addFromEvent(\n      this._blockHubButton,\n      'click',\n      this._onBlockHubButtonClick\n    );\n    disposables.addFromEvent(this._blockHubButton, 'mousedown', e => {\n      // Prevent input from losing focus\n      e.preventDefault();\n    });\n    disposables.addFromEvent(\n      this._blockHubIconsContainer,\n      'transitionstart',\n      this._onTransitionStart\n    );\n    disposables.addFromEvent(window, 'resize', this._onResize);\n    this._indicator = <DragIndicator>(\n      document.createElement('affine-drag-indicator')\n    );\n    document.body.appendChild(this._indicator);\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this._disposables.dispose();\n  }\n\n  /**\n   * This is currently a workaround, as the height of the _blockHubIconsContainer is determined by the height of its\n   * content, and if its child's opacity is set to 0 during a transition, its height won't change, causing the background\n   * to exceeds its actual visual height. So currently we manually set the height of those whose opacity is 0 to 0px.\n   */\n  private _onTransitionStart = (_: TransitionEvent) => {\n    if (this._timer) {\n      clearTimeout(this._timer);\n    }\n    if (!this._expanded) {\n      // when the _blockHubMenuContainer is unexpanded, should cancel the vertical padding making it a square\n      this._blockHubMenuContainer.style.padding = '0 4px';\n      this._timer = window.setTimeout(() => {\n        this._blockHubIconsContainer.style.overflow = 'hidden';\n      }, TRANSITION_DELAY);\n    } else {\n      this._blockHubMenuContainer.style.padding = '4px';\n      this._timer = window.setTimeout(() => {\n        this._blockHubIconsContainer.style.overflow = 'unset';\n      }, TRANSITION_DELAY);\n    }\n  };\n\n  private _onClickOutside = (e: MouseEvent) => {\n    const target = e.target;\n    if (target instanceof HTMLElement && !target.closest('affine-block-hub')) {\n      this._hideCardList();\n    }\n  };\n\n  private _onClickCard = (e: MouseEvent, blockHubElement: HTMLElement) => {\n    const affineType = blockHubElement.getAttribute('affine-type');\n    assertExists(affineType);\n    const data: {\n      flavour: string;\n      type?: string;\n    } = {\n      flavour: blockHubElement.getAttribute('affine-flavour') ?? '',\n    };\n    if (affineType) {\n      data.type = affineType;\n    }\n    this._onClickCardCallback(data);\n  };\n\n  public toggleMenu() {\n    this._expanded = !this._expanded;\n    if (!this._expanded) this._hideCardList();\n  }\n\n  private _onBlockHubButtonClick = (_: MouseEvent) => {\n    this._expanded = !this._expanded;\n    if (!this._expanded) {\n      this._hideCardList();\n    }\n  };\n\n  private _hideCardList() {\n    if (this._visibleCardType) {\n      this._visibleCardType = null;\n      this._isCardListVisible = false;\n    }\n  }\n\n  private _onDragStart = (event: DragEvent) => {\n    this._showTooltip = false;\n    // DragEvent that doesn't dispatch manually, is expected to have dataTransfer property\n    assertExists(event.dataTransfer);\n    event.dataTransfer.effectAllowed = 'move';\n    const blockHubElement = event.target as HTMLElement;\n    const affineType = blockHubElement.getAttribute('affine-type');\n    const data: {\n      flavour: string | null;\n      type?: string;\n    } = {\n      flavour: blockHubElement.getAttribute('affine-flavour'),\n    };\n    if (affineType) {\n      data.type = affineType;\n    }\n    event.dataTransfer.setData('affine/block-hub', JSON.stringify(data));\n    this._lastDraggingFlavour = data.flavour;\n    this._onDragStartCallback();\n  };\n\n  private _onMouseDown = (e: MouseEvent) => {\n    if (isFirefox) {\n      this._currentClientX = e.clientX;\n      this._currentClientY = e.clientY;\n    }\n  };\n\n  private _onDrag = (e: DragEvent) => {\n    this._hideCardList();\n    let x = e.clientX;\n    let y = e.clientY;\n    if (isFirefox) {\n      // In Firefox, `pageX` and `pageY` are always set to 0.\n      // Refs: https://stackoverflow.com/questions/13110349/pagex-and-pagey-are-always-set-to-0-in-firefox-during-the-ondrag-event.\n      x = this._currentClientX;\n      y = this._currentClientY;\n    }\n\n    if (\n      !this._indicator ||\n      (this._indicator.rect &&\n        this._indicator.rect.left === x &&\n        this._indicator.rect.top === y)\n    ) {\n      return;\n    }\n\n    const point = new Point(x, y);\n    const {\n      container,\n      rect: frameRect,\n      scale,\n    } = this.getHoveringFrameState(point.clone());\n    if (!frameRect) {\n      this._resetDropState();\n      return;\n    }\n    const element = getClosestBlockElementByPoint(\n      point,\n      { container, rect: frameRect, snapToEdge: { x: false, y: true } },\n      scale\n    );\n    if (!element) {\n      // if (this._mouseRoot.mode === 'page') {\n      //   return;\n      // }\n      this._resetDropState();\n      return;\n    }\n\n    let type: DroppingType = 'none';\n    let rect = null;\n    let lastModelState = null;\n    const model = getModelByBlockElement(element);\n    const result = calcDropTarget(\n      point,\n      model,\n      element,\n      [],\n      scale,\n      this._lastDraggingFlavour\n    );\n\n    if (result) {\n      type = result.type;\n      rect = result.rect;\n      lastModelState = result.modelState;\n    }\n\n    this._lastDroppingType = type;\n    this._indicator.rect = rect;\n    this._lastDroppingTarget = lastModelState;\n  };\n\n  private _onDragOver = (e: DragEvent) => {\n    e.preventDefault();\n  };\n\n  private _onDragOverDocument = (e: DragEvent) => {\n    if (!isFirefox) {\n      throw new Error('FireFox only');\n    }\n    this._currentClientX = e.clientX;\n    this._currentClientY = e.clientY;\n  };\n\n  private _onDragEnd = (_: DragEvent) => {\n    this._showTooltip = true;\n    this._isGrabbing = false;\n    this._lastDraggingFlavour = null;\n    this._resetDropState();\n  };\n\n  private _resetDropState = () => {\n    this._lastDroppingType = 'none';\n    this._indicator.rect = null;\n    this._lastDroppingTarget = null;\n  };\n\n  private _onDrop = (e: DragEvent) => {\n    assertExists(e.dataTransfer);\n    if (!e.dataTransfer.getData('affine/block-hub')) return;\n\n    this._onDropCallback(\n      e,\n      // `drag.clientY` !== `dragend.clientY` in chrome.\n      this._indicator?.rect?.min ?? new Point(e.clientX, e.clientY),\n      this._lastDroppingTarget,\n      this._lastDroppingType\n    );\n  };\n\n  private _onCardMouseDown = (_: Event) => {\n    this._isGrabbing = true;\n  };\n\n  private _onCardMouseUp = (_: Event) => {\n    this._isGrabbing = false;\n  };\n\n  private _onBlankMenuMouseDown = () => {\n    this._isGrabbing = true;\n  };\n\n  private _onBlankMenuMouseUp = () => {\n    this._isGrabbing = false;\n  };\n\n  private _onBlockHubMenuMouseOver = (e: Event) => {\n    const menu = e.currentTarget as HTMLElement;\n    const cardType = menu.getAttribute('type');\n    assertExists(cardType);\n    this._isCardListVisible = true;\n    this._visibleCardType = cardType as CardListType;\n  };\n\n  private _onBlockHubEntryMouseOver = () => {\n    this._isCardListVisible = false;\n  };\n\n  private _onResize = () => {\n    const boundingClientRect = document.body.getBoundingClientRect();\n    this._maxHeight = boundingClientRect.height - TOP_DISTANCE - BOTTOM_OFFSET;\n  };\n\n  override render() {\n    const blockHubMenu = BlockHubMenu(\n      this._enableDatabase,\n      this._expanded,\n      this._isGrabbing,\n      this._visibleCardType,\n      this._isCardListVisible,\n      this._showTooltip,\n      this._maxHeight,\n      this._page\n    );\n\n    const blockHubCards = BlockHubCards(\n      BLOCKHUB_TEXT_ITEMS,\n      'text',\n      'Text block',\n      this._maxHeight,\n      shouldDisplayCard(\n        'text',\n        this._expanded,\n        this._isCardListVisible,\n        this._visibleCardType\n      ),\n      this._isGrabbing,\n      this._showTooltip\n    );\n    const classes = classMap({\n      'icon-expanded': this._expanded,\n      'new-icon-in-edgeless': this._inEdgelessMode && !this._expanded,\n      'has-tool-tip': true,\n      'new-icon': true,\n    });\n    return html`\n      <div\n        class=\"block-hub-menu-container\"\n        ?expanded=${this._expanded}\n        style=\"bottom: ${BOTTOM_OFFSET}px; right: ${RIGHT_OFFSET}px;\"\n      >\n        ${blockHubMenu}\n        <div class=${classes} role=\"menuitem\" style=\"cursor:pointer;\">\n          ${this._expanded ? CrossIcon : BlockHubIcon}\n          <tool-tip\n            class=${this._expanded ? 'invisible' : ''}\n            inert\n            tip-position=\"left\"\n            role=\"tooltip\"\n            >Insert blocks\n          </tool-tip>\n        </div>\n        ${blockHubCards}\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-block-hub': BlockHub;\n  }\n}\n", "import {\n  BLOCK_ID_ATTR,\n  BLOCK_SERVICE_LOADING_ATTR,\n} from '@blocksuite/global/config';\nimport type { BaseBlockModel } from '@blocksuite/store';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\n@customElement('loader-element')\nexport class Loader extends LitElement {\n  static override styles = css`\n    .load-container {\n      margin: 10px auto;\n      width: var(--loader-width);\n      text-align: center;\n    }\n\n    .load-container .load {\n      width: 8px;\n      height: 8px;\n      background-color: var(--affine-text-primary-color);\n\n      border-radius: 100%;\n      display: inline-block;\n      -webkit-animation: bouncedelay 1.4s infinite ease-in-out;\n      animation: bouncedelay 1.4s infinite ease-in-out;\n      /* Prevent first frame from flickering when animation starts */\n      -webkit-animation-fill-mode: both;\n      animation-fill-mode: both;\n    }\n    .load-container .load1 {\n      -webkit-animation-delay: -0.32s;\n      animation-delay: -0.32s;\n    }\n    .load-container .load2 {\n      -webkit-animation-delay: -0.16s;\n      animation-delay: -0.16s;\n    }\n\n    @-webkit-keyframes bouncedelay {\n      0%,\n      80%,\n      100% {\n        -webkit-transform: scale(0.625);\n      }\n      40% {\n        -webkit-transform: scale(1);\n      }\n    }\n\n    @keyframes bouncedelay {\n      0%,\n      80%,\n      100% {\n        transform: scale(0);\n        -webkit-transform: scale(0.625);\n      }\n      40% {\n        transform: scale(1);\n        -webkit-transform: scale(1);\n      }\n    }\n  `;\n\n  @property()\n  hostModel: BaseBlockModel | null = null;\n\n  @property()\n  radius: string | number = '8px';\n\n  @property()\n  width: string | number = '150px';\n\n  constructor() {\n    super();\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    if (this.hostModel) {\n      this.setAttribute(BLOCK_ID_ATTR, this.hostModel.id);\n      this.setAttribute(BLOCK_SERVICE_LOADING_ATTR, 'true');\n    }\n\n    const width = this.width;\n    this.style.setProperty(\n      '--loader-width',\n      typeof width === 'string' ? width : `${width}px`\n    );\n  }\n\n  override render() {\n    return html`\n      <div class=\"load-container\">\n        <div class=\"load load1\"></div>\n        <div class=\"load load2\"></div>\n        <div class=\"load\"></div>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'loader-element': Loader;\n  }\n}\n", "import '../loader.js';\n\nimport {\n  CloseIcon,\n  ExportToHTMLIcon,\n  ExportToMarkdownIcon,\n  HelpIcon,\n  NewIcon,\n  NotionIcon,\n} from '@blocksuite/global/config';\nimport { WithDisposable } from '@blocksuite/lit';\nimport type { Page, Workspace } from '@blocksuite/store';\nimport JSZip from 'jszip';\nimport { html, LitElement, type PropertyValues } from 'lit';\nimport { customElement, state } from 'lit/decorators.js';\n\nimport { ContentParser } from '../../__internal__/content-parser/index.js';\nimport type { SerializedBlock } from '../../__internal__/utils/index.js';\nimport type { Cell, Column } from '../../index.js';\nimport { toast } from '../toast.js';\nimport { styles } from './styles.js';\n\nexport type OnSuccessHandler = (pageIds: string[]) => void;\n\nconst SHOW_LOADING_SIZE = 1024 * 200;\n\n@customElement('import-page')\nexport class ImportPage extends WithDisposable(LitElement) {\n  static override styles = styles;\n\n  @state()\n  _loading = false;\n\n  @state()\n  x = 0;\n\n  @state()\n  y = 0;\n\n  @state()\n  _startX = 0;\n\n  @state()\n  _startY = 0;\n\n  constructor(\n    private workspace: Workspace,\n    private multiple: boolean,\n    private onSuccess?: OnSuccessHandler,\n    private abortController = new AbortController()\n  ) {\n    super();\n\n    this._loading = false;\n\n    this.x = 0;\n    this.y = 0;\n    this._startX = 0;\n    this._startY = 0;\n\n    this._onMouseMove = this._onMouseMove.bind(this);\n  }\n\n  loading(): boolean {\n    return this._loading;\n  }\n\n  override updated(changedProps: PropertyValues) {\n    if (changedProps.has('x') || changedProps.has('y')) {\n      this.style.transform = `translate(${this.x}px, ${this.y}px)`;\n    }\n  }\n\n  private _onMouseDown(event: MouseEvent) {\n    this._startX = event.clientX - this.x;\n    this._startY = event.clientY - this.y;\n    window.addEventListener('mousemove', this._onMouseMove);\n  }\n\n  private _onMouseUp() {\n    window.removeEventListener('mousemove', this._onMouseMove);\n  }\n\n  private _onMouseMove(event: MouseEvent) {\n    this.x = event.clientX - this._startX;\n    this.y = event.clientY - this._startY;\n  }\n\n  private _onCloseClick(event: MouseEvent) {\n    event.stopPropagation();\n    this.abortController.abort();\n  }\n\n  private async _selectFile(accept: string): Promise<File[]> {\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.accept = accept;\n    input.multiple = this.multiple;\n    input.click();\n    return new Promise((resolve, reject) => {\n      input.onchange = () => {\n        const files = input.files;\n        if (!files) {\n          reject();\n          return;\n        }\n        resolve(Array.from(files));\n      };\n      input.onerror = () => {\n        reject();\n      };\n    });\n  }\n\n  private _onImportSuccess(pageIds: string[]) {\n    toast(\n      `Successfully imported ${pageIds.length} Page${\n        pageIds.length > 1 ? 's' : ''\n      }.`\n    );\n    this.onSuccess?.(pageIds);\n  }\n\n  private async _importFile(\n    fileExtension: string,\n    needLoadingHandler: (files: File[]) => Promise<boolean>,\n    parseContentHandler: (file: File) => Promise<string[]>\n  ) {\n    this.hidden = true;\n    const files = await this._selectFile(fileExtension);\n    const needLoading = await needLoadingHandler(files);\n    if (needLoading) {\n      this.hidden = false;\n      this._loading = true;\n    } else {\n      this.abortController.abort();\n    }\n\n    const pageIds: string[] = [];\n    for (const file of files) {\n      const importPageIds = await parseContentHandler(file);\n      pageIds.push(...importPageIds);\n    }\n    this._onImportSuccess(pageIds);\n\n    needLoading && this.abortController.abort();\n  }\n\n  private async _importMarkDown() {\n    await this._importFile(\n      '.md',\n      async files => {\n        let totalSize = 0;\n        for (const file of files) {\n          totalSize += file.size;\n          if (totalSize > SHOW_LOADING_SIZE) return true;\n        }\n        return false;\n      },\n      async file => {\n        const text = await file.text();\n        const page = this.workspace.createPage({\n          init: {\n            title: '',\n          },\n        });\n        const rootId = page.root?.id;\n        const contentParser = new ContentParser(page);\n        if (rootId) {\n          await contentParser.importMarkdown(text, rootId);\n          return [page.id];\n        }\n        return [];\n      }\n    );\n  }\n\n  private async _importHtml() {\n    await this._importFile(\n      '.html',\n      async files => {\n        let totalSize = 0;\n        for (const file of files) {\n          totalSize += file.size;\n          if (totalSize > SHOW_LOADING_SIZE) return true;\n        }\n        return false;\n      },\n      async file => {\n        const text = await file.text();\n        const page = this.workspace.createPage({\n          init: {\n            title: '',\n          },\n        });\n        const rootId = page.root?.id;\n        const contentParser = new ContentParser(page);\n        if (rootId) {\n          await contentParser.importHtml(text, rootId);\n          return [page.id];\n        }\n        return [];\n      }\n    );\n  }\n\n  private async _importNotion() {\n    await this._importFile(\n      '.zip',\n      async files => {\n        let totalSize = 0;\n        for (const file of files) {\n          const zip = new JSZip();\n          const zipFile = await zip.loadAsync(file);\n          const fileArray = Object.values(zipFile.files);\n          for (const file of fileArray) {\n            if (file.dir) continue;\n            const fileContent = await file.async('uint8array');\n            totalSize += fileContent.length;\n            if (totalSize > SHOW_LOADING_SIZE) return true;\n          }\n        }\n        return false;\n      },\n      async file => {\n        const pageIds: string[] = [];\n        const allPageMap: Map<string, Page>[] = [];\n        // const dataBaseSubPages = new Set<string>();\n        const parseZipFile = async (file: File | Blob) => {\n          const zip = new JSZip();\n          const zipFile = await zip.loadAsync(file);\n          const pageMap = new Map<string, Page>();\n          allPageMap.push(pageMap);\n          const files = Object.keys(zipFile.files);\n          const promises: Promise<void>[] = [];\n          const csvFiles = files\n            .filter(file => file.endsWith('.csv'))\n            .map(file => file.substring(0, file.length - 4));\n          for (let i = 0; i < files.length; i++) {\n            const file = files[i];\n            if (file.startsWith('__MACOSX/')) continue;\n\n            const lastSplitIndex = file.lastIndexOf('/');\n            if (csvFiles.includes(file.substring(0, lastSplitIndex))) continue;\n\n            const fileName = file.substring(lastSplitIndex + 1);\n            if (fileName.endsWith('.html') || fileName.endsWith('.md')) {\n              const page = this.workspace.createPage({\n                init: {\n                  title: '',\n                },\n              });\n              pageMap.set(file, page);\n            }\n            if (fileName.endsWith('.zip')) {\n              const innerZipFile = await zipFile.file(fileName)?.async('blob');\n              if (innerZipFile) {\n                promises.push(...(await parseZipFile(innerZipFile)));\n              }\n            }\n          }\n          const pagePromises = Array.from(pageMap.keys()).map(async file => {\n            const page = pageMap.get(file);\n            if (!page) return;\n            const lastSplitIndex = file.lastIndexOf('/');\n            const folder = file.substring(0, lastSplitIndex) || '';\n            const fileName = file.substring(lastSplitIndex + 1);\n            if (fileName.endsWith('.html') || fileName.endsWith('.md')) {\n              const isHtml = fileName.endsWith('.html');\n              const rootId = page.root?.id;\n              const fetchFileHandler = async (url: string) => {\n                const fileName = this.joinWebPaths(folder, decodeURI(url));\n                return (\n                  (await zipFile.file(fileName)?.async('blob')) || new Blob()\n                );\n              };\n              const textStyleHandler = (\n                element: HTMLElement,\n                textStyle: Record<string, unknown>\n              ) => {\n                if (textStyle['link']) {\n                  const link = textStyle['link'] as string;\n                  const subPageLink = this.joinWebPaths(\n                    folder,\n                    decodeURI(link)\n                  );\n                  const linkPage = pageMap.get(subPageLink);\n                  if (linkPage) {\n                    textStyle['reference'] = {\n                      pageId: linkPage.id,\n                      type: 'LinkedPage',\n                    };\n                    delete textStyle['link'];\n                  }\n                }\n              };\n\n              const tableParserHandler = async (element: Element) => {\n                // if (element.tagName === 'TABLE') {\n                //   const parentElement = element.parentElement;\n                //   if (\n                //     parentElement?.tagName === 'DIV' &&\n                //     parentElement.hasAttribute('id')\n                //   ) {\n                //     parentElement.id && dataBaseSubPages.add(parentElement.id);\n                //   }\n                //   const tbodyElement = element.querySelector('tbody');\n                //   tbodyElement?.querySelectorAll('tr').forEach(ele => {\n                //     ele.id && dataBaseSubPages.add(ele.id);\n                //   });\n                // }\n                if (\n                  element.tagName === 'A' &&\n                  element.getAttribute('href')?.endsWith('.csv')\n                ) {\n                  const href = element.getAttribute('href') || '';\n                  const fileName = this.joinWebPaths(folder, decodeURI(href));\n                  const tableString = await zipFile\n                    .file(fileName)\n                    ?.async('string');\n\n                  let result: SerializedBlock[] | null = [];\n                  let id = 1;\n                  const titles: string[] = [];\n                  const rows: string[][] = [];\n                  tableString?.split('\\n').forEach((row, index) => {\n                    if (index === 0) {\n                      titles.push(...row.split(','));\n                    } else {\n                      const rowArray = row.split(',');\n                      rows.push(rowArray);\n                    }\n                  });\n\n                  const columns: Column[] = titles\n                    .slice(1)\n                    .map((value, index) => {\n                      return {\n                        name: value,\n                        type: 'rich-text',\n                        width: 200,\n                        hide: false,\n                        id: '' + id++,\n                      };\n                    });\n                  if (rows.length > 0) {\n                    let maxLen = rows[0].length;\n                    for (let i = 1; i < rows.length; i++) {\n                      maxLen = Math.max(maxLen, rows[i].length);\n                    }\n                    const addNum = maxLen - columns.length;\n                    for (let i = 0; i < addNum; i++) {\n                      columns.push({\n                        name: '',\n                        type: 'rich-text',\n                        width: 200,\n                        hide: false,\n                        id: '' + id++,\n                      });\n                    }\n                  }\n                  const databasePropsId = id++;\n                  const cells: Record<string, Record<string, Cell>> = {};\n                  const children: SerializedBlock[] = [];\n                  rows.forEach(row => {\n                    children.push({\n                      flavour: 'affine:paragraph',\n                      type: 'text',\n                      text: [{ insert: row[0] }],\n                      children: [],\n                    });\n                    const rowId = '' + id++;\n                    cells[rowId] = {};\n                    row.slice(1).forEach((value, index) => {\n                      cells[rowId][columns[index].id] = {\n                        columnId: columns[index].id,\n                        value,\n                      };\n                    });\n                  });\n\n                  result = [\n                    {\n                      flavour: 'affine:database',\n                      databaseProps: {\n                        id: '' + databasePropsId,\n                        title: element.textContent || 'Database',\n                        titleColumnName: titles[0],\n                        titleColumnWidth: 432,\n                        rowIds: Object.keys(cells),\n                        cells: cells,\n                        columns: columns,\n                      },\n                      children: children,\n                    },\n                  ];\n                  return result;\n                }\n                return null;\n              };\n              const contentParser = new ContentParser(\n                page,\n                fetchFileHandler,\n                textStyleHandler,\n                tableParserHandler\n              );\n              const text = (await zipFile.file(file)?.async('string')) || '';\n              if (rootId) {\n                pageIds.push(page.id);\n                if (isHtml) {\n                  await contentParser.importHtml(text, rootId);\n                } else {\n                  await contentParser.importMarkdown(text, rootId);\n                }\n              }\n            }\n          });\n          promises.push(...pagePromises);\n          return promises;\n        };\n        const allPromises = await parseZipFile(file);\n        await Promise.all(allPromises.flat());\n        // dataBaseSubPages.forEach(notionId => {\n        //   const dbSubPageId = notionId.replace(/-/g, '');\n        //   allPageMap.forEach(pageMap => {\n        //     for (const [key, value] of pageMap) {\n        //       if (\n        //         key.endsWith(` ${dbSubPageId}.html`) ||\n        //         key.endsWith(` ${dbSubPageId}.md`)\n        //       ) {\n        //         pageIds = pageIds.filter(id => id !== value.id);\n        //         this.workspace.removePage(value.id);\n        //         break;\n        //       }\n        //     }\n        //   });\n        // });\n        return pageIds;\n      }\n    );\n  }\n\n  private joinWebPaths(...paths: string[]): string {\n    const fullPath = paths.join('/').replace(/\\/+/g, '/');\n    const parts = fullPath.split('/').filter(Boolean);\n\n    const resolvedParts: string[] = [];\n\n    parts.forEach(part => {\n      if (part === '.') {\n        return;\n      }\n\n      if (part === '..') {\n        resolvedParts.pop();\n      } else {\n        resolvedParts.push(part);\n      }\n    });\n\n    return resolvedParts.join('/');\n  }\n\n  private _openLearnImportLink(event: MouseEvent) {\n    event.stopPropagation();\n    window.open(\n      'https://affine.pro/blog/import-your-data-from-notion-into-affine',\n      '_blank'\n    );\n  }\n\n  override render() {\n    if (this._loading) {\n      return html`\n        <header\n          class=\"loading-header\"\n          @mousedown=${this._onMouseDown}\n          @mouseup=${this._onMouseUp}\n        >\n          <div>Import</div>\n          <loader-element width=\"50px\"></loader-element>\n        </header>\n        <div>\n          Importing the file may take some time. It depends on document size and\n          complexity.\n        </div>\n      `;\n    }\n    return html`\n      <header @mousedown=${this._onMouseDown} @mouseup=${this._onMouseUp}>\n        <icon-button height=\"16px\" @click=${this._onCloseClick}>\n          ${CloseIcon}\n        </icon-button>\n        <div>Import</div>\n      </header>\n      <div>\n        AFFiNE will gradually support more and more file types for import.\n        <a\n          href=\"https://community.affine.pro/c/feature-requests/import-export\"\n          target=\"_blank\"\n          >Provide feedback.</a\n        >\n      </div>\n      <div class=\"button-container\">\n        <icon-button\n          class=\"button-item\"\n          text=\"Markdown\"\n          @click=${this._importMarkDown}\n        >\n          ${ExportToMarkdownIcon}\n        </icon-button>\n        <icon-button class=\"button-item\" text=\"HTML\" @click=${this._importHtml}>\n          ${ExportToHTMLIcon}\n        </icon-button>\n      </div>\n      <div class=\"button-container\">\n        <icon-button\n          class=\"button-item\"\n          text=\"Notion\"\n          @click=${this._importNotion}\n        >\n          ${NotionIcon}\n          <div\n            slot=\"optional\"\n            class=\"has-tool-tip\"\n            @click=${this._openLearnImportLink}\n          >\n            ${HelpIcon}\n            <tool-tip inert arrow tip-position=\"top\" role=\"tooltip\">\n              Learn how to Import your Notion pages into AFFiNE.\n            </tool-tip>\n          </div>\n        </icon-button>\n        <icon-button class=\"button-item\" text=\"Coming soon...\" disabled=\"true\">\n          ${NewIcon}\n        </icon-button>\n      </div>\n      <!-- <div class=\"footer\">\n        <div>Migrate from other versions of AFFiNE?</div>\n      </div> -->\n    `;\n  }\n}\n", "import { css } from 'lit';\n\nimport { tooltipStyle } from '../tooltip/tooltip.js';\n\nexport const styles = css`\n  :host {\n    position: absolute;\n    width: 480px;\n    left: calc(50% - 480px / 2);\n    top: calc(50% - 270px / 2);\n    font-family: var(--affine-font-family);\n    font-size: var(--affine-font-base);\n    line-height: var(--affine-line-height);\n    padding: 20px 40px 24px 40px;\n    gap: 19px;\n    display: flex;\n    flex-direction: column;\n    background: var(--affine-background-primary-color);\n    box-shadow: var(--affine-shadow-2);\n    border-radius: 16px;\n    z-index: var(--affine-z-index-popover);\n  }\n\n  :host([hidden]) {\n    display: none;\n  }\n\n  header {\n    cursor: move;\n    user-select: none;\n    font-size: var(--affine-font-h-6);\n    font-weight: 600;\n  }\n\n  a {\n    white-space: nowrap;\n    word-break: break-word;\n    color: var(--affine-link-color);\n    fill: var(--affine-link-color);\n    text-decoration: none;\n    cursor: pointer;\n  }\n\n  header icon-button {\n    margin-left: auto;\n  }\n\n  .button-container {\n    display: flex;\n    justify-content: space-between;\n  }\n\n  .button-container icon-button {\n    padding: 8px;\n    justify-content: flex-start;\n    gap: 8px;\n    width: 190px;\n    height: 40px;\n    box-shadow: var(--affine-shadow-1);\n  }\n\n  .footer {\n    display: flex;\n    align-items: center;\n    color: var(--affine-text-secondary-color);\n  }\n\n  .loading-header {\n    display: flex;\n    align-items: center;\n  }\n\n  .has-tool-tip {\n    display: flex;\n    margin-left: auto;\n  }\n\n  ${tooltipStyle}\n`;\n", "import type { Workspace } from '@blocksuite/store';\nimport { DisposableGroup } from '@blocksuite/store';\n\nimport { ImportPage, type OnSuccessHandler } from './import-page.js';\n\nexport function showImportModal({\n  workspace,\n  onSuccess,\n  multiple = true,\n  container = document.body,\n  abortController = new AbortController(),\n}: {\n  workspace: Workspace;\n  onSuccess?: OnSuccessHandler;\n  multiple?: boolean;\n  container?: HTMLElement;\n  abortController?: AbortController;\n}) {\n  const importPage = new ImportPage(\n    workspace,\n    multiple,\n    onSuccess,\n    abortController\n  );\n  container.appendChild(importPage);\n\n  const disposables = new DisposableGroup();\n  abortController.signal.addEventListener('abort', () => disposables.dispose());\n  disposables.add(() => importPage.remove());\n  disposables.addFromEvent(window, 'mousedown', (e: Event) => {\n    if (e.target === importPage || importPage.loading()) return;\n    abortController.abort();\n  });\n\n  return importPage;\n}\n", "import { css, html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\n// FIXME: horizontal\n@customElement('menu-divider')\nexport class MenuDivider extends LitElement {\n  static override styles = css`\n    :host {\n      display: inline-block;\n    }\n\n    .divider {\n      background-color: var(--affine-border-color);\n    }\n\n    .divider.vertical {\n      width: 1px;\n      height: 100%;\n      margin: 0 7px;\n    }\n\n    .divider.horizontal {\n      width: 100%;\n      height: 1px;\n      margin: 7px 0;\n    }\n  `;\n\n  @property()\n  vertical = false;\n\n  override render() {\n    return html`<div\n      class=\"divider ${this.vertical ? 'vertical' : 'horizontal'}\"\n    ></div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'menu-divider': MenuDivider;\n  }\n}\n", "import type { BaseBlockModel, Page } from '@blocksuite/store';\nimport {\n  assertExists,\n  type StackItem,\n  type UserInfo,\n  type UserRange,\n} from '@blocksuite/store';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport {\n  blockRangeToNativeRange,\n  restoreSelection,\n} from '../../__internal__/utils/block-range.js';\nimport { getEditorContainer } from '../../__internal__/utils/query.js';\n\ninterface SelectionRect {\n  width: number;\n  height: number;\n  top: number;\n  left: number;\n}\n\nfunction addAlpha(hexColor: string, opacity: number): string {\n  const normalized = Math.round(Math.min(Math.max(opacity, 0), 1) * 255);\n  return hexColor + normalized.toString(16).toUpperCase();\n}\n\nfunction randomColor(): string {\n  const hex = Math.floor(Math.random() * 16777215).toString(16);\n  return `#${hex}`;\n}\n\nfunction selectionStyle(rect: SelectionRect, color: string) {\n  return styleMap({\n    position: 'absolute',\n    width: `${rect.width}px`,\n    height: `${rect.height}px`,\n    top: `${rect.top}px`,\n    left: `${rect.left}px`,\n    backgroundColor: color,\n  });\n}\n\nfunction cursorStyle(rect: SelectionRect, color: string) {\n  return styleMap({\n    position: 'absolute',\n    width: `${rect.width}px`,\n    height: `${rect.height}px`,\n    top: `${rect.top}px`,\n    left: `${rect.left}px`,\n    backgroundColor: color,\n  });\n}\n\n@customElement('remote-selection')\nexport class RemoteSelection extends LitElement {\n  static override styles = css`\n    :host {\n      position: absolute;\n      pointer-events: none;\n      left: 0;\n      top: 0;\n    }\n  `;\n\n  @property()\n  page: Page | null = null;\n\n  private _ranges: Array<{\n    id: number;\n    userRange?: UserRange;\n    user?: UserInfo;\n  }> = [];\n\n  private _colorMap = new Map<number, string>();\n\n  private _resizeObserver: ResizeObserver = new ResizeObserver(() => {\n    this.requestUpdate();\n  });\n\n  private _abortController = new AbortController();\n\n  protected override firstUpdated() {\n    assertExists(this.page);\n    this.page.awarenessStore.slots.update.subscribe(\n      msg => msg,\n      msg => {\n        if (!msg || !msg.state?.rangeMap) {\n          return;\n        }\n\n        if (msg.id === this.page?.awarenessStore.awareness.clientID) {\n          return;\n        }\n\n        assertExists(this.page);\n        const page = this.page;\n        const { user, rangeMap } = msg.state;\n\n        if (msg.type === 'update') {\n          const index = this._ranges.findIndex(range => range.id === msg.id);\n          if (index === -1) {\n            this._ranges.push({\n              id: msg.id,\n              userRange: rangeMap[page.prefixedId],\n              user,\n            });\n          } else {\n            this._ranges[index] = {\n              id: msg.id,\n              userRange: rangeMap[page.prefixedId],\n              user,\n            };\n          }\n        } else if (msg.type === 'add') {\n          this._ranges.push({\n            id: msg.id,\n            userRange: rangeMap[page.prefixedId],\n            user,\n          });\n        } else if (msg.type === 'remove') {\n          const index = this._ranges.findIndex(range => range.id === msg.id);\n          this._ranges.splice(index, 1);\n        }\n\n        this.requestUpdate();\n      }\n    );\n\n    this.page.history.on(\n      'stack-item-popped',\n      (event: { stackItem: StackItem }) => {\n        const userRange = event.stackItem.meta.get('cursor-location');\n        if (!userRange) {\n          return;\n        }\n        assertExists(this.page);\n        const models = userRange.blockIds\n          .map(id => {\n            assertExists(this.page);\n            return this.page.getBlockById(id);\n          })\n          .filter(Boolean) as BaseBlockModel[];\n        if (!models.length) {\n          return;\n        }\n        requestAnimationFrame(() => {\n          assertExists(this.page);\n          // special case for title\n          if (models.length === 1 && models[0] === this.page.root) {\n            restoreSelection({\n              type: 'Title',\n              startOffset: userRange.startOffset,\n              endOffset: userRange.endOffset,\n              models: [this.page.root],\n            });\n            return;\n          }\n          restoreSelection({\n            type: 'Native',\n            startOffset: userRange.startOffset,\n            endOffset: userRange.endOffset,\n            models,\n          });\n        });\n      }\n    );\n\n    this._resizeObserver.observe(document.body);\n\n    const viewportElement = document.querySelector('.affine-default-viewport');\n    viewportElement?.addEventListener('scroll', () => this.requestUpdate(), {\n      signal: this._abortController.signal,\n    });\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this._resizeObserver.disconnect();\n    this._abortController.abort();\n  }\n\n  private _getSelectionRect(userRange: UserRange): SelectionRect[] {\n    assertExists(this.page);\n    const models = userRange.blockIds\n      .map(id => {\n        assertExists(this.page);\n        return this.page.getBlockById(id);\n      })\n      .filter(Boolean) as BaseBlockModel[];\n\n    let nativeRange: Range | null = null;\n    // special case for title\n    if (models.length === 1 && models[0] === this.page.root) {\n      nativeRange = blockRangeToNativeRange({\n        type: 'Title',\n        startOffset: userRange.startOffset,\n        endOffset: userRange.endOffset,\n        models: [this.page.root],\n      });\n    } else {\n      nativeRange = blockRangeToNativeRange({\n        type: 'Native',\n        startOffset: userRange.startOffset,\n        endOffset: userRange.endOffset,\n        models,\n      });\n    }\n    if (!nativeRange) {\n      return [];\n    }\n\n    const container = getEditorContainer(this.page);\n    assertExists(container);\n    const containerRect = container.getBoundingClientRect();\n    const nativeRects = Array.from(nativeRange.getClientRects());\n    return nativeRects\n      .map(rect => ({\n        width: rect.width,\n        height: rect.height,\n        top: rect.top - containerRect.top,\n        left: rect.left - containerRect.left,\n      }))\n      .filter(\n        rect =>\n          (rect.width > 1 && rect.height > 0) || userRange.blockIds.length === 1\n      );\n  }\n\n  private _getCursorRect(userRange: UserRange): SelectionRect | null {\n    assertExists(this.page);\n    const endBlockId = userRange.blockIds[userRange.blockIds.length - 1];\n    const endOffset = userRange.endOffset;\n    const endModel = this.page.getBlockById(endBlockId);\n    if (!endModel || !endModel.text) {\n      return null;\n    }\n\n    const nativeRange = blockRangeToNativeRange({\n      type: 'Native',\n      startOffset: endOffset,\n      endOffset: endOffset,\n      models: [endModel],\n    });\n    if (!nativeRange) {\n      return null;\n    }\n\n    const container = getEditorContainer(this.page);\n    assertExists(container);\n    const containerRect = container.getBoundingClientRect();\n    const nativeRects = Array.from(nativeRange.getClientRects());\n    if (nativeRects.length === 1) {\n      const rect = nativeRects[0];\n      return {\n        width: 2,\n        height: rect.height + 4,\n        top: rect.top - 2 - containerRect.top,\n        left: rect.left - containerRect.left,\n      };\n    }\n\n    return null;\n  }\n\n  override render() {\n    if (!this.page || this._ranges.length === 0) {\n      this._colorMap.clear();\n      return html``;\n    }\n\n    const selections: Array<{\n      id: number;\n      userRange: UserRange;\n      rects: SelectionRect[];\n      user?: UserInfo;\n    }> = this._ranges\n      .filter(range => range.userRange)\n      .map(range => ({\n        id: range.id,\n        userRange: range.userRange,\n        rects: this._getSelectionRect(range.userRange as UserRange),\n        user: range.user,\n      })) as Array<{\n      id: number;\n      userRange: UserRange;\n      rects: SelectionRect[];\n      user?: UserInfo;\n    }>;\n\n    return html`<div>\n      ${selections.flatMap(selection => {\n        if (selection.user) {\n          this._colorMap.set(selection.id, selection.user.color);\n        }\n        if (!this._colorMap.has(selection.id)) {\n          this._colorMap.set(selection.id, randomColor());\n        }\n        const color = this._colorMap.get(selection.id) as string;\n        const cursorRect = this._getCursorRect(selection.userRange);\n\n        return selection.rects\n          .map(\n            r => html`\n              <div style=\"${selectionStyle(r, addAlpha(color, 0.5))}\"></div>\n            `\n          )\n          .concat([\n            html`\n              <div\n                style=\"${cursorRect\n                  ? cursorStyle(cursorRect, color)\n                  : styleMap({\n                      display: 'none',\n                    })}\"\n              >\n                <div\n                  style=\"${styleMap({\n                    position: 'relative',\n                    height: '100%',\n                  })}\"\n                >\n                  <div\n                    style=\"${styleMap({\n                      position: 'absolute',\n                      bottom: `${cursorRect?.height}px`,\n                      padding: '2px',\n                      'background-color': color,\n                      color: 'white',\n                    })}\"\n                  >\n                    ${selection.user?.name}\n                  </div>\n                </div>\n              </div>\n            `,\n          ]);\n      })}\n    </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'remote-selection': RemoteSelection;\n  }\n}\n", "import { WithDisposable } from '@blocksuite/lit';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { type IPoint } from '../__internal__/index.js';\n\n@customElement('affine-selected-blocks')\nexport class AffineSelectedBlocks extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      z-index: 1;\n      pointer-events: none;\n    }\n\n    :host([data-grab]) {\n      pointer-events: auto;\n    }\n\n    :host([data-grab]:hover) {\n      cursor: grab;\n    }\n\n    :host > div {\n      position: absolute;\n      border-radius: 5px;\n      background: var(--affine-hover-color);\n    }\n  `;\n\n  private _onPointerUp({ clientX, clientY, shiftKey }: PointerEvent) {\n    this.removeAttribute('data-grab');\n    document.dispatchEvent(\n      new PointerEvent('pointerup', {\n        bubbles: true,\n        clientX,\n        clientY,\n        shiftKey,\n      })\n    );\n  }\n\n  @property()\n  mouseRoot!: HTMLElement;\n\n  @property()\n  offset: IPoint = { x: 0, y: 0 };\n\n  @property()\n  state: { rects: DOMRect[]; grab: boolean } = { rects: [], grab: false };\n\n  override connectedCallback() {\n    super.connectedCallback();\n    // trigger click event on editor container\n    this._disposables.addFromEvent(this, 'pointerup', this._onPointerUp);\n  }\n\n  override willUpdate() {\n    const {\n      rects: [firstRect],\n      grab,\n    } = this.state;\n    if (firstRect) {\n      const { x, y } = this.offset;\n      this.style.top = `${firstRect.top + y}px`;\n      this.style.left = `${firstRect.left + x}px`;\n    }\n    this.toggleAttribute('data-grab', Boolean(firstRect && grab));\n  }\n\n  override render() {\n    const { rects } = this.state;\n    const firstRect = rects[0];\n    return firstRect\n      ? repeat(\n          rects,\n          rect => html`<div\n            style=${styleMap({\n              width: `${rect.width}px`,\n              height: `${rect.height}px`,\n              top: `${rect.top - firstRect.top}px`,\n              left: `${rect.left - firstRect.left}px`,\n            })}\n          ></div>`\n        )\n      : nothing;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-selected-blocks': AffineSelectedBlocks;\n  }\n}\n", "import {\n  BLOCK_CHILDREN_CONTAINER_PADDING_LEFT,\n  BLOCK_SERVICE_LOADING_ATTR,\n  DRAG_HANDLE_OFFSET_LEFT,\n} from '@blocksuite/global/config';\nimport { assertExists, matchFlavours } from '@blocksuite/global/utils';\nimport type { BaseBlockModel } from '@blocksuite/store';\n\nimport { copyBlocks } from '../../__internal__/clipboard/index.js';\nimport {\n  type BlockComponentElement,\n  type EditingState,\n  type Point,\n  type SerializedBlock,\n} from '../../__internal__/index.js';\nimport {\n  getBlockElementById,\n  getBlockElementByModel,\n  getBlockElementsExcludeSubtrees,\n  getClosestBlockElementByPoint,\n  getModelByBlockElement,\n  isInSamePath,\n} from '../../__internal__/index.js';\nimport {\n  getService,\n  getServiceOrRegister,\n} from '../../__internal__/service.js';\nimport type { CodeBlockModel } from '../../code-block/index.js';\nimport { DragHandle } from '../../components/index.js';\nimport { toast } from '../../components/toast.js';\nimport type { EmbedBlockModel } from '../../embed-block/embed-model.js';\nimport type { DefaultPageBlockComponent } from './default-page-block.js';\n\nfunction hasOptionBar(block: BaseBlockModel) {\n  if (block.flavour === 'affine:code') return true;\n  if (block.flavour === 'affine:embed' && block.type === 'image') return true;\n  return false;\n}\n\nfunction getBlockWithOptionBarRect(\n  hoverDom: Element,\n  block: BaseBlockModel\n): Element {\n  if (hoverDom.hasAttribute(BLOCK_SERVICE_LOADING_ATTR)) {\n    return hoverDom;\n  }\n  if (block.flavour === 'affine:code') {\n    const codeBlockDom = hoverDom.querySelector(\n      '.affine-code-block-container'\n    ) as HTMLElement;\n    assertExists(codeBlockDom);\n    return codeBlockDom;\n  } else if (block.flavour === 'affine:embed' && block.type === 'image') {\n    const imgElement = hoverDom.querySelector(\n      '.resizable-img'\n    ) as HTMLDivElement;\n    assertExists(imgElement);\n    return imgElement;\n  }\n  throw new Error('unreachable');\n}\n\nfunction getDetectRect(block: BaseBlockModel, blockRect: DOMRect): DOMRect {\n  const detectRect = copyRect(blockRect);\n  // there is a optionBar on the right side\n  if (block.flavour === 'affine:code') {\n    detectRect.width += 52;\n  } else if (block.flavour === 'affine:embed' && block.type === 'image') {\n    detectRect.width += 50;\n  }\n  return detectRect;\n}\n\n// Workaround native DOMRect clone issue in #632\n// See https://stackoverflow.com/questions/42713229/getboundingclientrect-object-properties-cannot-be-copied\nfunction copyRect(rect: DOMRect): DOMRect {\n  const { top, right, bottom, left, width, height, x, y } = rect;\n  return { top, right, bottom, left, width, height, x, y } as DOMRect;\n}\n\nexport function getBlockEditingStateByPosition(\n  blocks: BaseBlockModel[],\n  x: number,\n  y: number,\n  options?: {\n    skipX?: boolean;\n  }\n) {\n  const end = blocks.length - 1;\n  if (end === -1) return null;\n\n  const start = 0;\n  return binarySearchBlockEditingState(blocks, x, y, start, end, options);\n}\n\nexport function getBlockEditingStateByCursor(\n  blocks: BaseBlockModel[],\n  x: number,\n  y: number,\n  cursor: number,\n  options?: {\n    size?: number;\n    skipX?: boolean;\n    dragging?: boolean;\n  }\n): EditingState | null {\n  let end = blocks.length - 1;\n  if (end === -1) return null;\n\n  const size = options?.size || 5;\n  const start = Math.max(cursor - size, 0);\n  end = Math.min(cursor + size, end);\n  return binarySearchBlockEditingState(blocks, x, y, start, end, options);\n}\n\n// seek range: [start, end]\nfunction binarySearchBlockEditingState(\n  blocks: BaseBlockModel[],\n  x: number,\n  y: number,\n  start: number,\n  end: number,\n  options?: {\n    skipX?: boolean;\n    dragging?: boolean;\n  }\n): EditingState | null {\n  const noSkipX = !options?.skipX;\n  const dragging = !!options?.dragging;\n  let containerLeft = 0;\n\n  if (noSkipX) {\n    const firstBlock = getBlockAndRect(blocks, 0);\n    containerLeft = firstBlock.blockRect.left;\n  }\n\n  let inside = false;\n  while (start <= end) {\n    const mid = start + Math.floor((end - start) / 2);\n    const { block, blockRect, detectRect, hoverDom } = getBlockAndRect(\n      blocks,\n      mid\n    );\n\n    // if the detectRect is not in the view port, it's definitely not the block we want\n    if (detectRect.top > window.innerHeight) {\n      end = mid - 1;\n      continue;\n    } else if (detectRect.bottom < 0) {\n      start = mid + 1;\n      continue;\n    }\n\n    // code block use async loading\n    if (block.flavour === 'affine:code' && !hoverDom) {\n      // @TODO: need more tests\n      if (mid === start || mid === end) {\n        return null;\n      }\n      // may have consecutive code blocks\n      let result = binarySearchBlockEditingState(\n        blocks,\n        x,\n        y,\n        mid + 1,\n        end,\n        options\n      );\n      if (result) {\n        return result;\n      }\n      result = binarySearchBlockEditingState(\n        blocks,\n        x,\n        y,\n        start,\n        mid - 1,\n        options\n      );\n      return result;\n    } else if (matchFlavours(block, ['affine:database'])) {\n      // double check when current block is database block\n      const result = binarySearchBlockEditingState(\n        blocks,\n        x,\n        y,\n        mid + 1,\n        end,\n        options\n      );\n      if (result) {\n        return result;\n      }\n    }\n\n    !inside && (inside = y >= detectRect.top && y <= detectRect.bottom);\n\n    if (inside) {\n      assertExists(blockRect);\n\n      if (noSkipX) {\n        if (dragging) {\n          x = Math.max(x + DRAG_HANDLE_OFFSET_LEFT, containerLeft);\n          let n = mid - 1;\n          if (n > 0) {\n            let depth = Math.floor(\n              (blockRect.left - containerLeft) /\n                BLOCK_CHILDREN_CONTAINER_PADDING_LEFT\n            );\n            while (n >= 0 && depth >= 0) {\n              const result = getBlockAndRect(blocks, n);\n              if (\n                result.hoverDom.compareDocumentPosition(hoverDom) &\n                Node.DOCUMENT_POSITION_CONTAINED_BY\n              ) {\n                if (x >= result.blockRect.left && x < blockRect.left) {\n                  return {\n                    rect: result.blockRect,\n                    model: result.block,\n                    element: result.hoverDom as BlockComponentElement,\n                  };\n                } else {\n                  depth--;\n                  n--;\n                }\n              } else {\n                n--;\n              }\n            }\n          }\n        } else {\n          // y-coord is checked before\n          if (!isPointIn(x, detectRect)) {\n            return null;\n          }\n        }\n      }\n\n      return {\n        rect: blockRect,\n        model: block,\n        element: hoverDom as BlockComponentElement,\n      };\n    }\n\n    if (detectRect.top > y) {\n      end = mid - 1;\n    } else if (detectRect.bottom < y) {\n      start = mid + 1;\n    }\n\n    // if search failed, it may be caused by the mouse fall between two blocks\n    if (start > end) {\n      let targetIndex = -1;\n      // now start = end + 1, eg: [0, 1, ..., end start ..., blocks.length - 1]\n      if (start === blocks.length) {\n        targetIndex = end;\n      } else if (end === -1) {\n        targetIndex = start;\n      } else {\n        const { detectRect: prevDetectRect } = getBlockAndRect(blocks, end);\n        const { detectRect: nextDetectRect } = getBlockAndRect(blocks, start);\n        if (\n          y <\n          prevDetectRect.bottom +\n            (nextDetectRect.top - prevDetectRect.bottom) / 2\n        ) {\n          // nearer to prevDetectRect\n          targetIndex = end;\n        } else {\n          // nearer to nextDetectRect\n          targetIndex = start;\n        }\n      }\n      inside = true;\n      start = end = targetIndex;\n    }\n  }\n\n  return null;\n}\n\nfunction isPointIn(x: number, detectRect: DOMRect) {\n  return x >= detectRect.left && x <= detectRect.left + detectRect.width;\n}\n\nconst offscreen = document.createElement(\n  'div'\n) as unknown as BlockComponentElement;\n\nfunction getBlockAndRect(blocks: BaseBlockModel[], mid: number) {\n  const block = blocks[mid];\n  let hoverDom = getBlockElementById(block.id);\n\n  // Give an empty position (xywh=0,0,0,0) for invisible blocks.\n  // Block may be hidden, e.g., inside a toggle list, see https://github.com/toeverything/blocksuite/pull/1139)\n  if (!hoverDom) {\n    hoverDom = offscreen;\n  }\n\n  assertExists(hoverDom);\n  let blockRect: DOMRect | null = null;\n  let detectRect: DOMRect | null = null;\n  if (hasOptionBar(block)) {\n    blockRect = getBlockWithOptionBarRect(\n      hoverDom,\n      block\n    ).getBoundingClientRect();\n    detectRect = getDetectRect(block, blockRect);\n  } else {\n    blockRect = hoverDom.getBoundingClientRect() as DOMRect;\n    if (block.flavour === 'affine:database') {\n      // in a database block, `.affine-database-block-title` which is its own editing area\n      detectRect = hoverDom\n        ?.querySelector('.affine-database-block-title')\n        ?.getBoundingClientRect() as DOMRect;\n    } else if (block.children.length) {\n      // in a nested block, `rich-text` which is its own editing area\n      detectRect = hoverDom\n        ?.querySelector('rich-text')\n        ?.getBoundingClientRect() as DOMRect;\n    } else {\n      detectRect = blockRect;\n    }\n  }\n\n  return {\n    block,\n    hoverDom,\n    blockRect,\n    detectRect,\n  };\n}\n\nexport async function downloadImage(model: BaseBlockModel) {\n  const img = await getUrlByModel(model);\n  if (!img) {\n    return;\n  }\n  const arrayBuffer = await img.arrayBuffer();\n  const buffer = new Uint8Array(arrayBuffer);\n  let fileType: string;\n  if (\n    buffer[0] === 0x47 &&\n    buffer[1] === 0x49 &&\n    buffer[2] === 0x46 &&\n    buffer[3] === 0x38\n  ) {\n    fileType = 'image/gif';\n  } else if (\n    buffer[0] === 0x89 &&\n    buffer[1] === 0x50 &&\n    buffer[2] === 0x4e &&\n    buffer[3] === 0x47\n  ) {\n    fileType = 'image/png';\n  } else if (\n    buffer[0] === 0xff &&\n    buffer[1] === 0xd8 &&\n    buffer[2] === 0xff &&\n    buffer[3] === 0xe0\n  ) {\n    fileType = 'image/jpeg';\n  } else {\n    // unknown, fallback to png\n    console.error('unknown image type');\n    fileType = 'image/png';\n  }\n  const downloadUrl = URL.createObjectURL(\n    new Blob([arrayBuffer], { type: fileType })\n  );\n  const a = document.createElement('a');\n  const event = new MouseEvent('click');\n  a.download = 'image';\n  a.href = downloadUrl;\n  a.dispatchEvent(event);\n\n  // cleanup\n  a.remove();\n  URL.revokeObjectURL(downloadUrl);\n}\n\nexport async function copyImage(model: EmbedBlockModel) {\n  copyBlocks({\n    type: 'Block',\n    models: [model],\n    startOffset: 0,\n    endOffset: 0,\n  });\n\n  toast('Copied image to clipboard');\n}\n\nfunction getTextDelta(model: BaseBlockModel) {\n  if (!model.text) {\n    return [];\n  }\n  return model.text.toDelta();\n}\n\n// TODO merge with copy-cut-manager\nexport async function copyBlock(model: BaseBlockModel) {\n  const copyType = 'blocksuite/x-c+w';\n  const delta = getTextDelta(model);\n  const copyData: { data: SerializedBlock[] } = {\n    data: [\n      {\n        type: model.type,\n        flavour: model.flavour,\n        sourceId: model.sourceId,\n        text: delta,\n        children: [],\n      },\n    ],\n  };\n  const copySuccess = performNativeCopy([\n    { mimeType: copyType, data: JSON.stringify(copyData) },\n    { mimeType: 'text/plain', data: model.text?.toString() || '' },\n  ]);\n  return copySuccess;\n}\n\ninterface ClipboardItem {\n  mimeType: string;\n  data: string;\n}\n\nfunction performNativeCopy(items: ClipboardItem[]): boolean {\n  let success = false;\n  const tempElem = document.createElement('textarea');\n  tempElem.value = 'temp';\n  document.body.appendChild(tempElem);\n  tempElem.select();\n  tempElem.setSelectionRange(0, tempElem.value.length);\n\n  const listener = (e: ClipboardEvent) => {\n    const clipboardData = e.clipboardData;\n    if (clipboardData) {\n      items.forEach(item => clipboardData.setData(item.mimeType, item.data));\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n    tempElem.removeEventListener('copy', listener);\n  };\n\n  tempElem.addEventListener('copy', listener);\n  try {\n    success = document.execCommand('copy');\n  } finally {\n    tempElem.removeEventListener('copy', listener);\n    document.body.removeChild(tempElem);\n  }\n  return success;\n}\n\nexport function focusCaption(model: BaseBlockModel) {\n  const blockEle = getBlockElementByModel(model);\n  assertExists(blockEle);\n  const dom = blockEle.querySelector(\n    '.affine-embed-wrapper-caption'\n  ) as HTMLInputElement;\n  dom.classList.add('caption-show');\n  dom.focus();\n}\n\nasync function getUrlByModel(model: BaseBlockModel) {\n  assertExists(model.sourceId);\n  const store = await model.page.blobs;\n  const url = store?.get(model.sourceId);\n  return url;\n}\n\nexport function copyCode(codeBlockModel: CodeBlockModel) {\n  copyBlocks({\n    type: 'Block',\n    models: [codeBlockModel],\n    startOffset: 0,\n    endOffset: 0,\n  });\n\n  toast('Copied to clipboard');\n}\nexport function getAllowSelectedBlocks(\n  model: BaseBlockModel\n): BaseBlockModel[] {\n  const result: BaseBlockModel[] = [];\n  const blocks = model.children.slice();\n\n  const dfs = (blocks: BaseBlockModel[]) => {\n    for (const block of blocks) {\n      if (block.flavour !== 'affine:frame') {\n        result.push(block);\n      }\n      block.children.length && dfs(block.children);\n    }\n  };\n\n  dfs(blocks);\n  return result;\n}\n\nexport function createDragHandle(pageBlock: DefaultPageBlockComponent) {\n  return new DragHandle({\n    // drag handle should be the same level with editor-container\n    container: pageBlock.mouseRoot as HTMLElement,\n    onDropCallback(_point, blockElements, editingState, type): void {\n      if (!editingState || type === 'none') return;\n      const { model } = editingState;\n      const page = pageBlock.page;\n      const models = getBlockElementsExcludeSubtrees(blockElements).map(\n        getModelByBlockElement\n      );\n      if (models.length === 1 && isInSamePath(page, model, models[0])) return;\n\n      page.captureSync();\n\n      const parent = page.getParent(model);\n      const dragBlockParent = page.getParent(models[0]);\n      if (type === 'database') {\n        page.moveBlocks(models, model);\n      } else {\n        assertExists(parent);\n        page.moveBlocks(models, parent, model, type === 'before');\n      }\n\n      // unneeded\n      // pageBlock.selection.clear();\n      // pageBlock.selection.state.type = 'block';\n\n      pageBlock.updateComplete.then(() => {\n        if (\n          dragBlockParent &&\n          matchFlavours(dragBlockParent, ['affine:database'])\n        ) {\n          const service = getService('affine:database');\n          service.refreshRowSelection();\n        }\n\n        if (parent && matchFlavours(parent, ['affine:database'])) {\n          pageBlock.selection.clear();\n          return;\n        }\n\n        // update selection rects\n        // block may change its flavour after moved.\n        requestAnimationFrame(() => {\n          pageBlock.selection.setSelectedBlocks(\n            blockElements\n              .map(b => getBlockElementById(b.model.id))\n              .filter((b): b is BlockComponentElement => !!b)\n          );\n        });\n      });\n    },\n    setDragType(dragging: boolean) {\n      pageBlock.selection.state.type = dragging ? 'block:drag' : 'block';\n    },\n    setSelectedBlock(modelState: EditingState | null, element) {\n      if (element && element.closest('affine-database')) {\n        const service = getService('affine:database');\n        const toggled = service.toggleRowSelection(element);\n        if (toggled) {\n          pageBlock.selection.clear();\n          return;\n        }\n      }\n\n      const model = modelState?.model;\n      if (model) {\n        const parent = model.page.getParent(model);\n        if (parent && matchFlavours(parent, ['affine:database'])) {\n          const service = getService('affine:database');\n          service.setRowSelectionByElement(modelState.element);\n          return;\n        }\n      }\n      pageBlock.selection.selectOneBlock(modelState?.element, modelState?.rect);\n\n      const service = getServiceOrRegister('affine:database');\n      Promise.resolve(service).then(service => {\n        const rowSelection = service.getLastRowSelection();\n        if (rowSelection) {\n          service.clearRowSelection();\n        }\n      });\n    },\n    getSelectedBlocks() {\n      return pageBlock.selection.state.selectedBlocks;\n    },\n    getClosestBlockElement(point: Point) {\n      return getClosestBlockElementByPoint(point, {\n        rect: pageBlock.innerRect,\n      });\n    },\n  });\n}\n", "import { css } from 'lit';\n\nexport const styles = css`\n  :host {\n    position: absolute;\n  }\n\n  .linked-page-popover {\n    position: fixed;\n    left: 0;\n    top: 0;\n    box-sizing: border-box;\n    font-family: var(--affine-font-family);\n    font-size: var(--affine-font-base);\n    padding: 12px 8px;\n    display: flex;\n    flex-direction: column;\n\n    background: var(--affine-background-overlay-panel-color);\n    box-shadow: var(--affine-shadow-2);\n    border-radius: 12px;\n    z-index: var(--affine-z-index-popover);\n  }\n\n  .linked-page-popover icon-button {\n    padding: 8px;\n    justify-content: flex-start;\n    gap: 8px;\n  }\n\n  .linked-page-popover .group-title {\n    color: var(--affine-text-secondary-color);\n    margin: 8px 12px;\n  }\n\n  .linked-page-popover .divider {\n    margin: 6px 12px;\n    height: 1px;\n    background: var(--affine-border-color);\n  }\n\n  ::-webkit-scrollbar {\n    -webkit-appearance: none;\n    width: 4px;\n  }\n  ::-webkit-scrollbar-thumb {\n    border-radius: 2px;\n    background-color: #b1b1b1;\n  }\n`;\n", "import { DualLinkIcon, ImportIcon, PageIcon } from '@blocksuite/global/config';\nimport { WithDisposable } from '@blocksuite/lit';\nimport {\n  assertExists,\n  type BaseBlockModel,\n  type PageMeta,\n} from '@blocksuite/store';\nimport { html, LitElement } from 'lit';\nimport { customElement, query, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { REFERENCE_NODE } from '../../__internal__/rich-text/reference-node.js';\nimport type { AffineVEditor } from '../../__internal__/rich-text/virgo/types.js';\nimport {\n  getRichTextByModel,\n  getVirgoByModel,\n} from '../../__internal__/utils/query.js';\nimport { isFuzzyMatch } from '../../__internal__/utils/std.js';\nimport { showImportModal } from '../import-page/index.js';\nimport { createKeydownObserver } from '../utils.js';\nimport { styles } from './styles.js';\n\n/**\n * Remove specified text from the current range.\n */\nfunction cleanSpecifiedTail(vEditor: AffineVEditor, str: string) {\n  const vRange = vEditor.getVRange();\n  assertExists(vRange);\n  const idx = vRange.index - str.length;\n  const textStr = vEditor.yText.toString().slice(idx, idx + str.length);\n  if (textStr !== str) {\n    console.warn(\n      `Failed to clean text! Text mismatch expected: ${str} but actual: ${textStr}`\n    );\n    return;\n  }\n  vEditor.deleteText({ index: idx, length: str.length });\n  vEditor.setVRange({\n    index: idx,\n    length: 0,\n  });\n}\n\nconst DEFAULT_PAGE_NAME = 'Untitled';\n\n@customElement('affine-linked-page-popover')\nexport class LinkedPagePopover extends WithDisposable(LitElement) {\n  static override styles = styles;\n\n  @state()\n  private _position: {\n    height: number;\n    x: string;\n    y: string;\n  } | null = null;\n\n  @state()\n  private _query = '';\n\n  @state()\n  private _pageList: PageMeta[] = [];\n\n  @state()\n  private _activatedItemIndex = 0;\n\n  private get _actionList() {\n    const DISPLAY_LENGTH = 8;\n    const pageName = this._query || DEFAULT_PAGE_NAME;\n    const displayPageName =\n      pageName.slice(0, DISPLAY_LENGTH) +\n      (pageName.length > DISPLAY_LENGTH ? '..' : '');\n    const filteredPageList = this._pageList.filter(({ title }) =>\n      isFuzzyMatch(title, this._query)\n    );\n\n    return [\n      ...filteredPageList.map((page, idx) => ({\n        key: page.id,\n        name: page.title || DEFAULT_PAGE_NAME,\n        active: idx === this._activatedItemIndex,\n        icon: PageIcon,\n        action: () => this._insertLinkedNode('LinkedPage', page.id),\n      })),\n      // The active condition is a bit tricky here\n      {\n        key: 'create-linked-page',\n        name: `Create \"${displayPageName}\" page`,\n        active: filteredPageList.length === this._activatedItemIndex,\n        icon: DualLinkIcon,\n        action: () => this._createPage(),\n      },\n      // {\n      //   key: 'create-subpage',\n      //   name: `Create \"${displayPageName}\" subpage`,\n      //   active: filteredPageList.length + 1 === this._activatedItemIndex,\n      //   icon: NewPageIcon,\n      //   action: () => this._createSubpage(),\n      // },\n      {\n        key: 'import-linked-page',\n        name: `Import`,\n        active: filteredPageList.length === this._activatedItemIndex,\n        icon: ImportIcon,\n        action: () => this._importPage(),\n      },\n    ];\n  }\n\n  @query('.linked-page-popover')\n  linkedPageElement?: Element;\n\n  private get _page() {\n    return this.model.page;\n  }\n\n  constructor(\n    private model: BaseBlockModel,\n    private abortController = new AbortController()\n  ) {\n    super();\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    const richText = getRichTextByModel(this.model);\n    assertExists(richText, 'RichText not found');\n\n    createKeydownObserver({\n      target: richText,\n      onUpdateQuery: str => {\n        this._query = str;\n        this._activatedItemIndex = 0;\n      },\n      abortController: this.abortController,\n      onMove: step => {\n        this._activatedItemIndex =\n          (this._actionList.length + this._activatedItemIndex + step) %\n          this._actionList.length;\n\n        // Scroll to the active item\n        const item = this._actionList[this._activatedItemIndex];\n        if (\n          item.key === 'create-linked-page' ||\n          item.key === 'import-linked-page'\n        ) {\n          return;\n        }\n        const shadowRoot = this.shadowRoot;\n        if (!shadowRoot) {\n          console.warn('Failed to find the shadow root!', this);\n          return;\n        }\n        const ele = shadowRoot.querySelector(\n          `icon-button[data-id=\"${item.key}\"]`\n        );\n        if (!ele) {\n          console.warn('Failed to find the active item!', item);\n          return;\n        }\n        ele.scrollIntoView({\n          block: 'nearest',\n        });\n      },\n      onConfirm: () => {\n        this._actionList[this._activatedItemIndex].action();\n      },\n      onEsc: () => {\n        this.abortController.abort();\n      },\n    });\n    this._disposables.addFromEvent(this, 'mousedown', e => {\n      // Prevent input from losing focus\n      e.preventDefault();\n    });\n\n    this._pageList = this._page.workspace.meta.pageMetas;\n    this._disposables.add(\n      this.model.page.workspace.slots.pagesUpdated.on(() => {\n        this._pageList = this._page.workspace.meta.pageMetas;\n      })\n    );\n  }\n\n  updatePosition(position: { height: number; x: string; y: string }) {\n    this._position = position;\n  }\n\n  private _insertLinkedNode(type: 'Subpage' | 'LinkedPage', pageId: string) {\n    this.abortController.abort();\n    const vEditor = getVirgoByModel(this.model);\n    assertExists(vEditor, 'Editor not found');\n    cleanSpecifiedTail(vEditor, '@' + this._query);\n    const vRange = vEditor.getVRange();\n    assertExists(vRange);\n    vEditor.insertText(vRange, REFERENCE_NODE, { reference: { type, pageId } });\n    vEditor.setVRange({\n      index: vRange.index + 1,\n      length: 0,\n    });\n  }\n\n  private _createPage() {\n    const pageName = this._query;\n    const page = this._page.workspace.createPage({\n      init: {\n        title: pageName,\n      },\n    });\n\n    this._insertLinkedNode('LinkedPage', page.id);\n  }\n\n  private _importPage() {\n    this.abortController.abort();\n    const onSuccess = (pageIds: string[]) => {\n      if (pageIds.length === 0) {\n        return;\n      }\n      const pageId = pageIds[0];\n      this._insertLinkedNode('LinkedPage', pageId);\n    };\n    showImportModal({\n      workspace: this._page.workspace,\n      multiple: false,\n      onSuccess,\n    });\n  }\n\n  // private _createSubpage() {\n  //   const pageName = this._query;\n  //   const page = this._page.workspace.createPage({\n  //     init: {\n  //       title: pageName,\n  //     },\n  //   });\n\n  //   this._insertLinkedNode('Subpage', page.id);\n  // }\n\n  override render() {\n    const MAX_HEIGHT = 396;\n    const style = this._position\n      ? styleMap({\n          transform: `translate(${this._position.x}, ${this._position.y})`,\n          maxHeight: `${Math.min(this._position.height, MAX_HEIGHT)}px`,\n        })\n      : styleMap({\n          visibility: 'hidden',\n        });\n\n    const pageList = this._actionList.slice(0, -2).map(\n      ({ key, name, action, active, icon }, index) => html`<icon-button\n        width=\"280px\"\n        height=\"32px\"\n        data-id=${key}\n        text=${name}\n        ?hover=${active}\n        @click=${action}\n        @mousemove=${() => {\n          // Use `mousemove` instead of `mouseover` to avoid navigate conflict with keyboard\n          this._activatedItemIndex = index;\n        }}\n        >${icon}</icon-button\n      >`\n    );\n\n    const createList = this._actionList.slice(-2).map(\n      ({ key, name, action, active, icon }, index) => html`<icon-button\n        width=\"280px\"\n        height=\"32px\"\n        data-id=${key}\n        text=${name}\n        ?hover=${active}\n        @click=${action}\n        @mousemove=${() => {\n          // Use `mousemove` instead of `mouseover` to avoid navigate conflict with keyboard\n          this._activatedItemIndex = this._actionList.length - 1 + index;\n        }}\n        >${icon}</icon-button\n      >`\n    );\n\n    return html`<div class=\"linked-page-popover\" style=\"${style}\">\n      ${pageList.length\n        ? html`<div class=\"group-title\">Link to page</div>\n            <div class=\"group\" style=\"overflow-y: scroll; max-height: 224px;\">\n              ${pageList}\n            </div>\n            <div class=\"divider\"></div>`\n        : null}\n\n      <div class=\"group-title\">New page</div>\n      ${createList}\n    </div>`;\n  }\n}\n", "import {\n  assertExists,\n  type BaseBlockModel,\n  DisposableGroup,\n} from '@blocksuite/store';\n\nimport { getViewportElement } from '../../__internal__/utils/query.js';\nimport { throttle } from '../../__internal__/utils/std.js';\nimport { getPopperPosition } from '../../page-block/utils/position.js';\nimport { LinkedPagePopover } from './linked-page-popover.js';\n\nexport function showLinkedPagePopover({\n  model,\n  range,\n  container = document.body,\n  abortController = new AbortController(),\n}: {\n  model: BaseBlockModel;\n  range: Range;\n  container?: HTMLElement;\n  abortController?: AbortController;\n}) {\n  const disposables = new DisposableGroup();\n  abortController.signal.addEventListener('abort', () => disposables.dispose());\n\n  const linkedPage = new LinkedPagePopover(model, abortController);\n  // Mount\n  container.appendChild(linkedPage);\n  disposables.add(() => linkedPage.remove());\n\n  // Handle position\n  const updatePosition = throttle(() => {\n    const linkedPageElement = linkedPage.linkedPageElement;\n    assertExists(\n      linkedPageElement,\n      'You should render the linked page node even if no position'\n    );\n    const position = getPopperPosition(linkedPageElement, range);\n    linkedPage.updatePosition(position);\n  }, 10);\n  disposables.addFromEvent(window, 'resize', updatePosition);\n  const scrollContainer = getViewportElement(model.page);\n  if (scrollContainer) {\n    // Note: in edgeless mode, the scroll container is not exist!\n    disposables.addFromEvent(scrollContainer, 'scroll', updatePosition, {\n      passive: true,\n    });\n  }\n\n  // Wait for node to be mounted\n  setTimeout(updatePosition);\n\n  disposables.addFromEvent(window, 'mousedown', (e: Event) => {\n    if (e.target === linkedPage) return;\n    abortController.abort();\n  });\n\n  return linkedPage;\n}\n", "import {\n  BookmarkIcon,\n  CopyIcon,\n  DatabaseKanbanViewIcon,\n  DatabaseTableViewIcon,\n  DeleteIcon,\n  DualLinkIcon,\n  DuplicateIcon,\n  ImageIcon20,\n  NewPageIcon,\n  NowIcon,\n  paragraphConfig,\n  // PasteIcon,\n  TodayIcon,\n  TomorrowIcon,\n  YesterdayIcon,\n} from '@blocksuite/global/config';\nimport {\n  assertExists,\n  type BaseBlockModel,\n  type Page,\n  Text,\n  Utils,\n} from '@blocksuite/store';\nimport type { TemplateResult } from 'lit';\n\nimport { normalizeDelta } from '../../__internal__/clipboard/utils/commons.js';\nimport { REFERENCE_NODE } from '../../__internal__/rich-text/reference-node.js';\nimport type { AffineTextAttributes } from '../../__internal__/rich-text/virgo/types.js';\nimport { getServiceOrRegister } from '../../__internal__/service.js';\nimport { restoreSelection } from '../../__internal__/utils/block-range.js';\nimport {\n  createBookmarkBlock,\n  getCurrentNativeRange,\n  getVirgoByModel,\n  resetNativeSelection,\n  uploadImageFromLocal,\n} from '../../__internal__/utils/index.js';\nimport { clearMarksOnDiscontinuousInput } from '../../__internal__/utils/virgo.js';\nimport { copyBlock } from '../../page-block/default/utils.js';\nimport { formatConfig } from '../../page-block/utils/format-config.js';\nimport {\n  onModelTextUpdated,\n  updateBlockType,\n} from '../../page-block/utils/index.js';\nimport { showLinkedPagePopover } from '../linked-page/index.js';\nimport { toast } from '../toast.js';\n\nexport type SlashItem = {\n  name: string;\n  groupName: string;\n  alias?: string[];\n  icon: TemplateResult<1>;\n  showWhen?: (model: BaseBlockModel) => boolean;\n  disabled?: boolean;\n  action: ({ page, model }: { page: Page; model: BaseBlockModel }) => void;\n};\n\nfunction insertContent(\n  model: BaseBlockModel,\n  text: string,\n  attributes?: AffineTextAttributes\n) {\n  if (!model.text) {\n    throw new Error(\"Can't insert text! Text not found\");\n  }\n  const vEditor = getVirgoByModel(model);\n  if (!vEditor) {\n    throw new Error(\"Can't insert text! vEditor not found\");\n  }\n  const vRange = vEditor.getVRange();\n  const index = vRange ? vRange.index : model.text.length;\n  model.text.insert(text, index, attributes);\n  // Update the caret to the end of the inserted text\n  vEditor.setVRange({\n    index: index + text.length,\n    length: 0,\n  });\n}\n\nfunction formatDate(date: Date) {\n  // yyyy-mm-dd\n  const year = date.getFullYear();\n  const month = (date.getMonth() + 1).toString().padStart(2, '0');\n  const day = date.getDate().toString().padStart(2, '0');\n  const strTime = `${year}-${month}-${day}`;\n  return strTime;\n}\n\nfunction insideDatabase(model: BaseBlockModel) {\n  return Utils.isInsideBlockByFlavour(model.page, model, 'affine:database');\n}\n\nexport const menuGroups: { name: string; items: SlashItem[] }[] = (\n  [\n    {\n      name: 'Text',\n      items: [\n        ...paragraphConfig\n          .filter(i => i.flavour !== 'affine:list')\n          .map<Omit<SlashItem, 'groupName'>>(\n            ({ name, icon, flavour, type }) => ({\n              name,\n              icon,\n              showWhen: model => {\n                if (!model.page.schema.flavourSchemaMap.has(flavour)) {\n                  return false;\n                }\n\n                if (['Quote', 'Code Block', 'Divider'].includes(name)) {\n                  return !insideDatabase(model);\n                }\n                return true;\n              },\n              action: ({ model }) => {\n                const newModels = updateBlockType([model], flavour, type);\n                // Reset selection if the target is code block\n                if (flavour === 'affine:code') {\n                  if (newModels.length !== 1) {\n                    throw new Error(\n                      \"Failed to reset selection! New model length isn't 1\"\n                    );\n                  }\n                  const codeModel = newModels[0];\n                  onModelTextUpdated(codeModel, () => {\n                    restoreSelection({\n                      type: 'Native',\n                      startOffset: 0,\n                      endOffset: 0,\n                      models: [codeModel],\n                    });\n                  });\n                }\n              },\n            })\n          ),\n      ],\n    },\n    {\n      name: 'Style',\n      items: formatConfig\n        .filter(i => !['Link', 'Code'].includes(i.name))\n        .map(({ name, icon, id }) => ({\n          name,\n          icon,\n          action: ({ model }) => {\n            if (!model.text) {\n              return;\n            }\n            const len = model.text.length;\n            if (!len) {\n              const vEditor = getVirgoByModel(model);\n              assertExists(vEditor, \"Can't set style mark! vEditor not found\");\n              vEditor.setMarks({\n                [id]: true,\n              });\n              clearMarksOnDiscontinuousInput(vEditor);\n              return;\n            }\n            model.text.format(0, len, {\n              [id]: true,\n            });\n          },\n        })),\n    },\n    {\n      name: 'List',\n      items: paragraphConfig\n        .filter(i => i.flavour === 'affine:list')\n        .map(({ name, icon, flavour, type }) => ({\n          name,\n          icon,\n          showWhen: model => {\n            if (!model.page.schema.flavourSchemaMap.has(flavour)) {\n              return false;\n            }\n            return true;\n          },\n          action: ({ model }) => updateBlockType([model], flavour, type),\n        })),\n    },\n\n    {\n      name: 'Pages',\n      items: [\n        {\n          name: 'New Page',\n          icon: NewPageIcon,\n          showWhen: model =>\n            !!model.page.awarenessStore.getFlag('enable_linked_page'),\n          action: ({ page, model }) => {\n            const newPage = page.workspace.createPage({\n              init: true,\n            });\n            insertContent(model, REFERENCE_NODE, {\n              reference: { type: 'LinkedPage', pageId: newPage.id },\n            });\n          },\n        },\n        {\n          name: 'Link Page',\n          alias: ['dual link'],\n          icon: DualLinkIcon,\n          showWhen: model =>\n            !!model.page.awarenessStore.getFlag('enable_linked_page'),\n          action: ({ model }) => {\n            insertContent(model, '@');\n            showLinkedPagePopover({ model, range: getCurrentNativeRange() });\n          },\n        },\n      ],\n    },\n    {\n      name: 'Content & Media',\n      items: [\n        {\n          name: 'Image',\n          icon: ImageIcon20,\n          showWhen: model => {\n            if (!model.page.schema.flavourSchemaMap.has('affine:embed')) {\n              return false;\n            }\n            if (insideDatabase(model)) {\n              return false;\n            }\n            return true;\n          },\n          async action({ page, model }) {\n            const parent = page.getParent(model);\n            if (!parent) {\n              return;\n            }\n            parent.children.indexOf(model);\n            const props = await uploadImageFromLocal(page);\n            page.addSiblingBlocks(model, props);\n          },\n        },\n        {\n          name: 'Bookmark',\n          icon: BookmarkIcon,\n          showWhen: model => {\n            if (\n              !model.page.awarenessStore.getFlag('enable_bookmark_operation')\n            ) {\n              return false;\n            }\n            if (!model.page.schema.flavourSchemaMap.has('affine:embed')) {\n              return false;\n            }\n            return !insideDatabase(model);\n          },\n          async action({ page, model }) {\n            const parent = page.getParent(model);\n            if (!parent) {\n              return;\n            }\n            const index = parent.children.indexOf(model);\n            createBookmarkBlock(parent, index + 1);\n          },\n        },\n      ],\n    },\n    {\n      name: 'Date & Time',\n      items: [\n        {\n          name: 'Today',\n          icon: TodayIcon,\n          action: ({ model }) => {\n            const date = new Date();\n            insertContent(model, formatDate(date));\n          },\n        },\n        {\n          name: 'Tomorrow',\n          icon: TomorrowIcon,\n          action: ({ model }) => {\n            // yyyy-mm-dd\n            const date = new Date();\n            date.setDate(date.getDate() + 1);\n            insertContent(model, formatDate(date));\n          },\n        },\n        {\n          name: 'Yesterday',\n          icon: YesterdayIcon,\n          action: ({ model }) => {\n            const date = new Date();\n            date.setDate(date.getDate() - 1);\n            insertContent(model, formatDate(date));\n          },\n        },\n        {\n          name: 'Now',\n          icon: NowIcon,\n          action: ({ model }) => {\n            // For example 7:13 pm\n            // https://stackoverflow.com/questions/8888491/how-do-you-display-javascript-datetime-in-12-hour-am-pm-format\n            const date = new Date();\n            let hours = date.getHours();\n            const minutes = date.getMinutes().toString().padStart(2, '0');\n            const amOrPm = hours >= 12 ? 'pm' : 'am';\n            hours = hours % 12;\n            hours = hours ? hours : 12; // the hour '0' should be '12'\n            const strTime = hours + ':' + minutes + ' ' + amOrPm;\n            insertContent(model, strTime);\n          },\n        },\n      ],\n    },\n    {\n      name: 'Database',\n      items: [\n        {\n          name: 'Table View',\n          alias: ['database'],\n          icon: DatabaseTableViewIcon,\n          showWhen: model => {\n            if (!model.page.awarenessStore.getFlag('enable_database')) {\n              return false;\n            }\n            if (!model.page.schema.flavourSchemaMap.has('affine:database')) {\n              return false;\n            }\n            if (insideDatabase(model)) {\n              // You can't add a database block inside another database block\n              return false;\n            }\n            return true;\n          },\n          action: async ({ page, model }) => {\n            const parent = page.getParent(model);\n            assertExists(parent);\n            const index = parent.children.indexOf(model);\n\n            const id = page.addBlock(\n              'affine:database',\n              {},\n              page.getParent(model),\n              index\n            );\n            const service = await getServiceOrRegister('affine:database');\n            service.initDatabaseBlock(page, model, id, false);\n          },\n        },\n        {\n          name: 'Kanban View',\n          alias: ['database'],\n          disabled: true,\n          icon: DatabaseKanbanViewIcon,\n          showWhen: model => {\n            if (!model.page.awarenessStore.getFlag('enable_database')) {\n              return false;\n            }\n            if (!model.page.schema.flavourSchemaMap.has('affine:database')) {\n              return false;\n            }\n            if (insideDatabase(model)) {\n              // You can't add a database block inside another database block\n              return false;\n            }\n            return true;\n          },\n          // eslint-disable-next-line @typescript-eslint/no-empty-function\n          action: ({ model }) => {},\n        },\n      ],\n    },\n    {\n      name: 'Actions',\n      items: [\n        {\n          name: 'Copy',\n          icon: CopyIcon,\n          action: async ({ model }) => {\n            const curRange = getCurrentNativeRange();\n            await copyBlock(model);\n            resetNativeSelection(curRange);\n            toast('Copied to clipboard');\n          },\n        },\n        // {\n        //   name: 'Paste',\n        //   icon: PasteIcon,\n        //   action: async ({ model }) => {\n        //     const copiedText = await navigator.clipboard.readText();\n        //     console.log('copiedText', copiedText);\n        //     insertContent(model, copiedText);\n        //   },\n        // },\n        {\n          name: 'Duplicate',\n          icon: DuplicateIcon,\n          action: ({ page, model }) => {\n            if (!model.text || !(model.text instanceof Text)) {\n              throw new Error(\"Can't duplicate a block without text\");\n            }\n            const parent = page.getParent(model);\n            if (!parent) {\n              throw new Error('Failed to duplicate block! Parent not found');\n            }\n            const index = parent.children.indexOf(model);\n\n            // TODO add clone model util\n            page.addBlock(\n              model.flavour,\n              {\n                type: model.type,\n                text: page.Text.fromDelta(\n                  normalizeDelta(page, model.text.toDelta())\n                ),\n                // @ts-expect-error\n                checked: model.checked,\n              },\n              page.getParent(model),\n              index\n            );\n          },\n        },\n        {\n          name: 'Delete',\n          icon: DeleteIcon,\n          action: ({ page, model }) => {\n            page.deleteBlock(model);\n          },\n        },\n      ],\n    },\n  ] satisfies { name: string; items: Omit<SlashItem, 'groupName'>[] }[]\n).map(group => ({\n  name: group.name,\n  items: group.items.map(item => ({ ...item, groupName: group.name })),\n}));\n", "import { css } from 'lit';\n\nexport const styles = css`\n  .overlay-mask {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    z-index: var(--affine-z-index-popover);\n  }\n\n  .slash-menu-container {\n    z-index: var(--affine-z-index-popover);\n    user-select: none;\n  }\n\n  .slash-menu {\n    position: fixed;\n    left: 0;\n    top: 0;\n    box-sizing: border-box;\n    font-size: var(--affine-font-base);\n    padding: 12px 0;\n    display: flex;\n\n    background: var(--affine-background-overlay-panel-color);\n    box-shadow: var(--affine-shadow-2);\n    border-radius: 12px;\n    z-index: var(--affine-z-index-popover);\n    /* transition: max-height 0.2s ease-in-out; */\n  }\n\n  .slash-category {\n    position: relative;\n    overflow: hidden;\n    box-sizing: border-box;\n    width: 150px;\n    max-width: 150px;\n    display: flex;\n    flex-direction: column;\n    color: var(--affine-text-secondary-color);\n    gap: 5px;\n    margin-bottom: 20px;\n    /* transition: max-width 0.2s ease-in-out; */\n  }\n  .slash-category::before {\n    content: '';\n    position: absolute;\n    top: 10px;\n    right: 0;\n    height: 100%;\n    width: 1px;\n    background-color: var(--affine-border-color);\n  }\n\n  .slash-category-hide {\n    max-width: 0;\n    padding: 0;\n    margin: 0;\n    height: 0;\n  }\n\n  .slash-category-name {\n    font-family: var(--affine-font-family);\n    font-size: var(--affine-font-sm);\n    white-space: nowrap;\n    cursor: pointer;\n    padding: 4px 20px;\n  }\n\n  .slash-active-category {\n    position: relative;\n    box-sizing: border-box;\n    color: var(--affine-primary-color);\n  }\n\n  .slash-active-category::after {\n    content: '';\n    position: absolute;\n    right: 0;\n    top: 50%;\n    transform: translateY(-50%);\n    width: 1px;\n    height: 12px;\n    background: linear-gradient(\n      180deg,\n      var(--affine-text-emphasis-color) 0%,\n      var(--affine-palette-purple) 100%\n    );\n    border-radius: 1px;\n  }\n\n  .slash-item-container {\n    box-sizing: border-box;\n    overflow-y: auto;\n    padding: 0 8px;\n    width: 200px;\n  }\n\n  ::-webkit-scrollbar {\n    -webkit-appearance: none;\n    width: 4px;\n  }\n  ::-webkit-scrollbar-thumb {\n    border-radius: 2px;\n    background-color: #b1b1b1;\n  }\n\n  .slash-item-divider {\n    border-top: 1px dashed var(--affine-border-color);\n    margin: 8px 0;\n  }\n\n  format-bar-button svg {\n    width: 20px;\n    height: 20px;\n  }\n`;\n", "import { WithDisposable } from '@blocksuite/lit';\nimport { type BaseBlockModel } from '@blocksuite/store';\nimport { html, LitElement, nothing } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport {\n  getRichTextByModel,\n  isControlledKeyboardEvent,\n  isFuzzyMatch,\n} from '../../__internal__/utils/index.js';\nimport { createKeydownObserver } from '../utils.js';\nimport { menuGroups, type SlashItem } from './config.js';\nimport { styles } from './styles.js';\n\nfunction collectGroupNames(menuItem: SlashItem[]) {\n  return menuItem.reduce((acc, item) => {\n    if (!acc.length || acc[acc.length - 1] !== item.groupName) {\n      acc.push(item.groupName);\n    }\n    return acc;\n  }, [] as string[]);\n}\n\n@customElement('slash-menu')\nexport class SlashMenu extends WithDisposable(LitElement) {\n  static override styles = styles;\n\n  @property()\n  model!: BaseBlockModel;\n\n  @query('.slash-menu')\n  slashMenuElement?: HTMLElement;\n\n  @state()\n  private _leftPanelActivated = false;\n\n  @state()\n  private _activatedItemIndex = 0;\n\n  @state()\n  private _filterItems: SlashItem[] = [];\n\n  @state()\n  private _hide = false;\n\n  @state()\n  private _position: {\n    x: string;\n    y: string;\n    height: number;\n  } | null = null;\n\n  abortController = new AbortController();\n\n  /**\n   * Does not include the slash character\n   */\n  private _searchString = '';\n\n  get menuGroups() {\n    return menuGroups;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._disposables.addFromEvent(window, 'mousedown', this._onClickAway);\n    this._disposables.addFromEvent(this, 'mousedown', e => {\n      // Prevent input from losing focus\n      e.preventDefault();\n    });\n    this._filterItems = this._updateItem('');\n\n    const richText = getRichTextByModel(this.model);\n    if (!richText) {\n      console.warn(\n        'Slash Menu may not work properly! No rich text found for model',\n        this.model\n      );\n      return;\n    }\n\n    /**\n     * Handle arrow key\n     *\n     * The slash menu will be closed in the following keyboard cases:\n     * - Press the space key\n     * - Press the backspace key and the search string is empty\n     * - Press the escape key\n     * - When the search item is empty, the slash menu will be hidden temporarily,\n     *   and if the following key is not the backspace key, the slash menu will be closed\n     */\n    createKeydownObserver({\n      target: richText,\n      abortController: this.abortController,\n      interceptor: (e, next) => {\n        if (e.key === '/') {\n          // Can not stopPropagation here,\n          // otherwise the rich text will not be able to trigger a new the slash menu\n          return;\n        }\n        if (this._hide && e.key !== 'Backspace') {\n          // if the following key is not the backspace key,\n          // the slash menu will be closed\n          this.abortController.abort();\n          return;\n        }\n        if (e.key === ' ') {\n          this._hide = true;\n          next();\n          return;\n        }\n        if (this._hide) {\n          this._hide = false;\n        }\n\n        const isControlled = isControlledKeyboardEvent(e);\n        const isShift = e.shiftKey;\n        if (e.key === 'ArrowLeft' && !isControlled && !isShift) {\n          e.stopPropagation();\n          e.preventDefault();\n          // If the left panel is hidden, should not activate it\n          if (this._searchString.length) return;\n          this._leftPanelActivated = true;\n          return;\n        }\n        if (e.key === 'ArrowRight' && !isControlled && !isShift) {\n          e.stopPropagation();\n          e.preventDefault();\n          this._leftPanelActivated = false;\n          return;\n        }\n        next();\n      },\n      onUpdateQuery: val => {\n        const newFilteredItems = this._updateItem(val);\n        this._filterItems = newFilteredItems;\n        if (!newFilteredItems.length) {\n          this._hide = true;\n        }\n      },\n      onMove: step => {\n        const configLen = this._filterItems.length;\n        if (this._leftPanelActivated) {\n          const groupNames = collectGroupNames(this._filterItems);\n          const nowGroupIdx = groupNames.findIndex(\n            groupName =>\n              groupName ===\n              this._filterItems[this._activatedItemIndex].groupName\n          );\n          const targetGroup =\n            groupNames[\n              (nowGroupIdx + step + groupNames.length) % groupNames.length\n            ];\n          this._handleClickCategory(targetGroup);\n          return;\n        }\n        let ejectedCnt = configLen;\n        do {\n          this._activatedItemIndex =\n            (this._activatedItemIndex + step + configLen) % configLen;\n          // Skip disabled items\n        } while (\n          this._filterItems[this._activatedItemIndex].disabled &&\n          // If all items are disabled, the loop will never end\n          ejectedCnt--\n        );\n\n        this._scrollToItem(this._filterItems[this._activatedItemIndex], false);\n      },\n      onConfirm: () => {\n        this._handleClickItem(this._activatedItemIndex);\n      },\n      onEsc: () => {\n        this.abortController.abort();\n      },\n    });\n  }\n\n  updatePosition(position: { x: string; y: string; height: number }) {\n    this._position = position;\n  }\n\n  // Handle click outside\n  private _onClickAway = (e: Event) => {\n    // if (e.target === this) return;\n    if (!this._hide) return;\n    // If the slash menu is hidden, click anywhere will close the slash menu\n    this.abortController.abort();\n  };\n\n  private _updateItem(query: string): SlashItem[] {\n    this._searchString = query;\n    this._activatedItemIndex = 0;\n    // Activate the right panel when search string is not empty\n    if (this._leftPanelActivated) {\n      this._leftPanelActivated = false;\n    }\n    const searchStr = this._searchString.toLowerCase();\n    let allMenus = this.menuGroups.flatMap(group => group.items);\n\n    allMenus = allMenus.filter(({ showWhen = () => true }) =>\n      showWhen(this.model)\n    );\n    if (!searchStr) {\n      return allMenus;\n    }\n\n    return allMenus.filter(({ name, alias = [] }) =>\n      [name, ...alias].some(str => isFuzzyMatch(str, searchStr))\n    );\n  }\n\n  private _scrollToItem(item: SlashItem, force = true) {\n    const shadowRoot = this.shadowRoot;\n    if (!shadowRoot) {\n      return;\n    }\n    const ele = shadowRoot.querySelector(\n      `format-bar-button[text=\"${item.name}\"]`\n    );\n    if (!ele) {\n      return;\n    }\n    if (force) {\n      // set parameter to `true` to align to top\n      ele.scrollIntoView(true);\n      return;\n    }\n    ele.scrollIntoView({\n      block: 'nearest',\n    });\n  }\n\n  private _handleClickItem(index: number) {\n    if (\n      this._leftPanelActivated ||\n      index < 0 ||\n      index >= this._filterItems.length\n    ) {\n      return;\n    }\n    // Need to remove the search string\n    // We must to do clean the slash string before we do the action\n    // Otherwise, the action may change the model and cause the slash string to be changed\n    this.abortController.abort(this._searchString);\n\n    const { action } = this._filterItems[index];\n    action({ page: this.model.page, model: this.model });\n  }\n\n  private _handleClickCategory(groupName: string) {\n    const item = this._filterItems.find(item => item.groupName === groupName);\n    if (!item) return;\n    this._scrollToItem(item);\n    this._activatedItemIndex = this._filterItems.findIndex(\n      i => i.name === item.name\n    );\n  }\n\n  private _categoryTemplate() {\n    const showCategory = !this._searchString.length;\n    const activatedGroupName =\n      this._filterItems[this._activatedItemIndex]?.groupName;\n    const groups = collectGroupNames(this._filterItems);\n\n    return html`<div\n      class=\"slash-category ${!showCategory ? 'slash-category-hide' : ''}\"\n    >\n      ${groups.map(\n        groupName =>\n          html`<div\n            class=\"slash-category-name ${activatedGroupName === groupName\n              ? 'slash-active-category'\n              : ''}\"\n            @click=${() => this._handleClickCategory(groupName)}\n          >\n            ${groupName}\n          </div>`\n      )}\n    </div>`;\n  }\n\n  override render() {\n    if (this._hide) {\n      return nothing;\n    }\n\n    const MAX_HEIGHT_WITH_CATEGORY = 408;\n    const MAX_HEIGHT = 344;\n    const showCategory = !this._searchString.length;\n\n    const slashMenuStyles = this._position\n      ? styleMap({\n          transform: `translate(${this._position.x}, ${this._position.y})`,\n          maxHeight: `${Math.min(\n            this._position.height,\n            showCategory ? MAX_HEIGHT_WITH_CATEGORY : MAX_HEIGHT\n          )}px`,\n        })\n      : styleMap({\n          visibility: 'hidden',\n        });\n\n    const btnItems = this._filterItems.map(\n      ({ name, icon, disabled = false, groupName }, index) => {\n        const showDivider =\n          index !== 0 && this._filterItems[index - 1].groupName !== groupName;\n        return html`<div\n            class=\"slash-item-divider\"\n            ?hidden=${!showDivider || !!this._searchString.length}\n          ></div>\n          <format-bar-button\n            ?disabled=${disabled}\n            width=\"100%\"\n            style=\"padding-left: 12px; justify-content: flex-start;\"\n            ?hover=${!disabled &&\n            !this._leftPanelActivated &&\n            this._activatedItemIndex === index}\n            text=\"${name}\"\n            data-testid=\"${name}\"\n            @mousemove=${() => {\n              // Use `mousemove` instead of `mouseover` to avoid navigate conflict in left panel\n              this._leftPanelActivated = false;\n              this._activatedItemIndex = index;\n            }}\n            @click=${() => {\n              this._handleClickItem(index);\n            }}\n          >\n            ${icon}\n          </format-bar-button>`;\n      }\n    );\n\n    return html`<div class=\"slash-menu-container\">\n      <div\n        class=\"overlay-mask\"\n        @click=\"${() => this.abortController.abort()}\"\n      ></div>\n      <div class=\"slash-menu\" style=\"${slashMenuStyles}\">\n        ${this._categoryTemplate()}\n        <div class=\"slash-item-container\">${btnItems}</div>\n      </div>\n    </div>`;\n  }\n}\n", "import type { BaseBlockModel } from '@blocksuite/store';\nimport { assertExists } from '@blocksuite/store';\n\nimport { getVirgoByModel, throttle } from '../../__internal__/utils/index.js';\nimport { getPopperPosition } from '../../page-block/utils/position.js';\nimport { SlashMenu } from './slash-menu-popover.js';\n\nlet globalAbortController = new AbortController();\n\nfunction onAbort(\n  e: Event,\n  slashMenu: SlashMenu,\n  positionCallback: () => void,\n  model: BaseBlockModel\n) {\n  slashMenu.remove();\n  window.removeEventListener('resize', positionCallback);\n\n  // Clean slash text\n\n  if (!e.target || !(e.target instanceof AbortSignal)) {\n    throw new Error('Failed to clean slash search text! Unknown abort event');\n  }\n  // If not explicitly set in those methods, it defaults to \"AbortError\" DOMException.\n  if (e.target.reason instanceof DOMException) {\n    // Should not clean slash text when click away or abort\n    return;\n  }\n\n  if (typeof e.target.reason !== 'string') {\n    throw new Error('Failed to clean slash search text! Unknown abort reason');\n  }\n  const searchStr = '/' + e.target.reason;\n  const text = model.text;\n  if (!text) {\n    console.warn(\n      'Failed to clean slash search text! No text found for model',\n      model\n    );\n    return;\n  }\n  const vEditor = getVirgoByModel(model);\n  if (!vEditor) {\n    console.warn(\n      'Failed to clean slash search text! No vEditor found for model, model:',\n      model\n    );\n    return;\n  }\n  const vRange = vEditor.getVRange();\n  assertExists(vRange);\n  const idx = vRange.index - searchStr.length;\n\n  const textStr = text.toString().slice(idx, idx + searchStr.length);\n  if (textStr !== searchStr) {\n    console.warn(\n      `Failed to clean slash search text! Text mismatch expected: ${searchStr} but actual: ${textStr}`\n    );\n    return;\n  }\n  text.delete(idx, searchStr.length);\n  vEditor.setVRange({\n    index: idx,\n    length: 0,\n  });\n}\n\nexport function showSlashMenu({\n  model,\n  range,\n  container = document.body,\n  abortController = new AbortController(),\n}: {\n  model: BaseBlockModel;\n  range: Range;\n  container?: HTMLElement;\n  abortController?: AbortController;\n}) {\n  // Abort previous format quick bar\n  globalAbortController.abort();\n  globalAbortController = abortController;\n\n  const slashMenu = new SlashMenu();\n  slashMenu.model = model;\n  slashMenu.abortController = abortController;\n\n  // Handle position\n  const updatePosition = throttle(() => {\n    const slashMenuElement = slashMenu.slashMenuElement;\n    assertExists(\n      slashMenuElement,\n      'You should render the slash menu node even if no position'\n    );\n    const position = getPopperPosition(slashMenuElement, range);\n    slashMenu.updatePosition(position);\n  }, 10);\n\n  window.addEventListener('resize', updatePosition);\n\n  // Mount\n  container.appendChild(slashMenu);\n  // Wait for the Node to be mounted\n  setTimeout(updatePosition);\n\n  // Handle dispose\n  abortController.signal.addEventListener('abort', e => {\n    onAbort(e, slashMenu, updatePosition, model);\n  });\n\n  return slashMenu;\n}\n", "import { EDGELESS_BLOCK_CHILD_PADDING } from '@blocksuite/global/config';\nimport type { BlockModels } from '@blocksuite/global/types';\nimport {\n  assertExists,\n  assertFlavours,\n  matchFlavours,\n} from '@blocksuite/global/utils';\nimport type { PointerEventState } from '@blocksuite/lit';\nimport { deserializeXYWH } from '@blocksuite/phasor';\nimport type { BaseBlockModel, Page } from '@blocksuite/store';\nimport { Text } from '@blocksuite/store';\n\nimport {\n  almostEqual,\n  asyncGetBlockElementByModel,\n  asyncGetRichTextByModel,\n  type BlockComponentElement,\n  type ExtendedModel,\n  focusBlockByModel,\n  getBlockElementByModel,\n  getClosestBlockElementByElement,\n  getCurrentNativeRange,\n  getDefaultPage,\n  getVirgoByModel,\n  handleNativeRangeDblClick,\n  handleNativeRangeTripleClick,\n  hasNativeSelection,\n  isCollapsedNativeSelection,\n  isMultiBlockRange,\n  resetNativeSelection,\n  type TopLevelBlockModel,\n} from '../../__internal__/index.js';\nimport type { RichText } from '../../__internal__/rich-text/rich-text.js';\nimport type { AffineTextAttributes } from '../../__internal__/rich-text/virgo/types.js';\nimport {\n  type BlockRange,\n  getCurrentBlockRange,\n  restoreSelection,\n  updateBlockRange,\n} from '../../__internal__/utils/block-range.js';\nimport { asyncFocusRichText } from '../../__internal__/utils/common-operations.js';\nimport { clearMarksOnDiscontinuousInput } from '../../__internal__/utils/virgo.js';\nimport { showFormatQuickBar } from '../../components/format-quick-bar/index.js';\nimport { showSlashMenu } from '../../components/slash-menu/index.js';\nimport type { BlockSchemas } from '../../models.js';\nimport type {\n  DefaultSelectionManager,\n  PageSelectionState,\n} from '../default/selection-manager/index.js';\nimport { calcCurrentSelectionPosition } from './position.js';\n\nexport function handleBlockSelectionBatchDelete(\n  page: Page,\n  models: ExtendedModel[]\n) {\n  const parentModel = page.getParent(models[0]);\n  assertExists(parentModel);\n  const index = parentModel.children.indexOf(models[0]);\n  page.captureSync();\n  models.forEach(model => page.deleteBlock(model));\n  const id = page.addBlock(\n    'affine:paragraph',\n    { type: 'text' },\n    parentModel,\n    index\n  );\n  const newBlock = page.getBlockById(id);\n\n  // Try clean block selection\n  const defaultPageBlock = getDefaultPage(models[0].page);\n  if (!defaultPageBlock) {\n    // In the edgeless mode\n    return null;\n  }\n  defaultPageBlock.selection.clear();\n  asyncFocusRichText(page, id);\n  return newBlock;\n}\n\nexport function deleteModelsByRange(\n  page: Page,\n  blockRange = getCurrentBlockRange(page)\n) {\n  if (!blockRange) {\n    return null;\n  }\n  if (blockRange.type === 'Block') {\n    const newBlock = handleBlockSelectionBatchDelete(page, blockRange.models);\n    return newBlock;\n  }\n  const startModel = blockRange.models[0];\n  const endModel = blockRange.models[blockRange.models.length - 1];\n  // TODO handle database\n  if (!startModel.text || !endModel.text) {\n    throw new Error('startModel or endModel does not have text');\n  }\n\n  const vEditor = getVirgoByModel(startModel);\n  assertExists(vEditor);\n\n  // Only select one block\n  if (startModel === endModel) {\n    page.captureSync();\n    if (\n      blockRange.startOffset === blockRange.endOffset &&\n      blockRange.startOffset > 0\n    ) {\n      // startModel.text.delete(blockRange.startOffset - 1, 1);\n      // vEditor.setVRange({\n      //   index: blockRange.startOffset - 1,\n      //   length: 0,\n      // });\n      return startModel;\n    }\n    startModel.text.delete(\n      blockRange.startOffset,\n      blockRange.endOffset - blockRange.startOffset\n    );\n    vEditor.setVRange({\n      index: blockRange.startOffset,\n      length: 0,\n    });\n    return startModel;\n  }\n  page.captureSync();\n  startModel.text.delete(\n    blockRange.startOffset,\n    startModel.text.length - blockRange.startOffset\n  );\n  endModel.text.delete(0, blockRange.endOffset);\n  startModel.text.join(endModel.text);\n  blockRange.models.slice(1).forEach(model => {\n    page.deleteBlock(model);\n  });\n\n  vEditor.setVRange({\n    index: blockRange.startOffset,\n    length: 0,\n  });\n  return startModel;\n}\n\n/**\n * Do nothing when selection is collapsed or not multi block selected\n */\nexport function handleMultiBlockBackspace(page: Page, e: KeyboardEvent) {\n  if (!hasNativeSelection()) return;\n  if (isCollapsedNativeSelection()) return;\n  if (!isMultiBlockRange()) return;\n  e.preventDefault();\n  deleteModelsByRange(page);\n}\n\nfunction mergeToCodeBlocks(page: Page, models: BaseBlockModel[]) {\n  const parent = page.getParent(models[0]);\n  assertExists(parent);\n  const index = parent.children.indexOf(models[0]);\n  const text = models\n    .map(model => {\n      if (model.text instanceof Text) {\n        return model.text.toString();\n      }\n      return null;\n    })\n    .filter(Boolean)\n    .join('\\n');\n  models.map(model => page.deleteBlock(model));\n\n  const id = page.addBlock(\n    'affine:code',\n    { text: new Text(text) },\n    parent,\n    index\n  );\n  return id;\n}\n\nexport function updateBlockType(\n  models: BaseBlockModel[],\n  flavour: keyof BlockSchemas,\n  type?: string\n) {\n  if (!models.length) {\n    return [];\n  }\n  const page = models[0].page;\n  const hasSamePage = models.every(model => model.page === page);\n  if (!hasSamePage) {\n    // page check\n    console.error(\n      'Not all models have the same page instanceof, the result for update text type may not be correct',\n      models\n    );\n  }\n  page.captureSync();\n  const savedBlockRange = getCurrentBlockRange(page);\n  if (flavour === 'affine:code') {\n    const id = mergeToCodeBlocks(page, models);\n    const model = page.getBlockById(id);\n    if (!model) {\n      throw new Error('Failed to get model after merge code block!');\n    }\n    return [model];\n  }\n  if (flavour === 'affine:divider') {\n    const model = models.at(-1);\n    if (!model) {\n      return [];\n    }\n    const parent = page.getParent(model);\n    if (!parent) {\n      return [];\n    }\n    const index = parent.children.indexOf(model);\n    const nextSibling = page.getNextSibling(model);\n    let nextSiblingId = nextSibling?.id as string;\n    const id = page.addBlock('affine:divider', {}, parent, index + 1);\n    if (!nextSibling) {\n      nextSiblingId = page.addBlock('affine:paragraph', {}, parent);\n    }\n    asyncFocusRichText(page, nextSiblingId);\n    const newModel = page.getBlockById(id);\n    if (!newModel) {\n      throw new Error('Failed to get model after add divider block!');\n    }\n    return [newModel];\n  }\n\n  // The lastNewId will not be null since we have checked models.length > 0\n  const newModels: BaseBlockModel[] = [];\n  models.forEach(model => {\n    assertFlavours(model, ['affine:paragraph', 'affine:list', 'affine:code']);\n    if (model.flavour === flavour) {\n      page.updateBlock(model, { type });\n      newModels.push(model);\n      return;\n    }\n    const newId = transformBlock(model, flavour, type);\n    const newModel = page.getBlockById(newId);\n    if (!newModel) {\n      throw new Error('Failed to get new model after transform block!');\n    }\n    savedBlockRange && updateBlockRange(savedBlockRange, model, newModel);\n    newModels.push(newModel);\n  });\n\n  const allTextUpdated = savedBlockRange?.models.map(\n    model => new Promise(resolve => onModelTextUpdated(model, resolve))\n  );\n  if (allTextUpdated && savedBlockRange) {\n    Promise.all(allTextUpdated).then(() => {\n      restoreSelection(savedBlockRange);\n    });\n  }\n\n  return newModels;\n}\n\nfunction transformBlock(\n  model: BaseBlockModel,\n  flavour: keyof BlockModels,\n  type?: string\n) {\n  const page = model.page;\n  const parent = page.getParent(model);\n  assertExists(parent);\n  const blockProps: {\n    type?: string;\n    text?: Text;\n    children?: BaseBlockModel[];\n  } = {\n    type,\n    text: model?.text?.clone(), // should clone before `deleteBlock`\n    children: model.children,\n  };\n  const index = parent.children.indexOf(model);\n  page.deleteBlock(model);\n  return page.addBlock(flavour, blockProps, parent, index);\n}\n\n/**\n * Merge format of multiple blocks. Format will be active only when all blocks have the same format.\n *\n * Used for format quick bar.\n */\nfunction mergeFormat(\n  formatArr: AffineTextAttributes[],\n  loose: boolean\n): AffineTextAttributes {\n  if (!formatArr.length) {\n    return {};\n  }\n  if (loose) {\n    return formatArr.reduce((acc, cur) => ({ ...acc, ...cur }));\n  }\n  return formatArr.reduce((acc, cur) => {\n    const newFormat: AffineTextAttributes = {};\n    for (const key in acc) {\n      const typedKey = key as keyof AffineTextAttributes;\n      if (acc[typedKey] === cur[typedKey]) {\n        // This cast is secure because we have checked that the value of the key is the same.\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        newFormat[typedKey] = acc[typedKey] as any;\n      }\n    }\n    return newFormat;\n  });\n}\n\n/**\n * By default, it is in `strict` mode, which only returns the formats that all the text in the range share.\n * formats with different values, such as different links, are considered different formats.\n *\n * If the `loose` mode is enabled, any format that exists in the range will be returned.\n * formats with different values will only return the last one.\n */\nexport function getCombinedFormat(\n  blockRange: BlockRange,\n  loose = false\n): AffineTextAttributes {\n  if (blockRange.models.length === 1) {\n    const vEditor = getVirgoByModel(blockRange.models[0]);\n    assertExists(vEditor);\n    const format = vEditor.getFormat(\n      {\n        index: blockRange.startOffset,\n        length: blockRange.endOffset - blockRange.startOffset,\n      },\n      loose\n    );\n    return format;\n  }\n  const formatArr = [];\n  // Start block\n  // Skip code block or empty block\n  const startModel = blockRange.models[0];\n  if (\n    !matchFlavours(startModel, ['affine:code']) &&\n    startModel.text &&\n    startModel.text.length\n  ) {\n    const vEditor = getVirgoByModel(startModel);\n    assertExists(vEditor);\n    const startFormat = vEditor.getFormat(\n      {\n        index: blockRange.startOffset,\n        length: vEditor.yText.length - blockRange.startOffset,\n      },\n      loose\n    );\n    formatArr.push(startFormat);\n  }\n  // End block\n  const endModel = blockRange.models[blockRange.models.length - 1];\n  if (\n    !matchFlavours(endModel, ['affine:code']) &&\n    endModel.text &&\n    endModel.text.length\n  ) {\n    const vEditor = getVirgoByModel(endModel);\n    assertExists(vEditor);\n    const endFormat = vEditor.getFormat(\n      {\n        index: 0,\n        length: blockRange.endOffset,\n      },\n      loose\n    );\n    formatArr.push(endFormat);\n  }\n  // Between blocks\n  blockRange.models\n    .slice(1, -1)\n    .filter(model => !matchFlavours(model, ['affine:code']))\n    .filter(model => model.text && model.text.length)\n    .forEach(model => {\n      const vEditor = getVirgoByModel(model);\n      assertExists(vEditor);\n      const format = vEditor.getFormat({\n        index: 0,\n        length: vEditor.yText.length - 1,\n      });\n      formatArr.push(format);\n    }, loose);\n\n  return mergeFormat(formatArr, loose);\n}\n\nexport function getCurrentCombinedFormat(\n  page: Page,\n  loose = false\n): AffineTextAttributes {\n  const blockRange = getCurrentBlockRange(page);\n  if (!blockRange || blockRange.models.every(model => !model.text)) {\n    return {};\n  }\n  return getCombinedFormat(blockRange, loose);\n}\n\nfunction formatBlockRange(\n  blockRange: BlockRange,\n  key: keyof Omit<AffineTextAttributes, 'link' | 'reference'>\n) {\n  const { startOffset, endOffset } = blockRange;\n  const startModel = blockRange.models[0];\n  const endModel = blockRange.models[blockRange.models.length - 1];\n  // edge case 1: collapsed range\n  if (blockRange.models.length === 1 && startOffset === endOffset) {\n    // Collapsed range\n\n    const vEditor = getVirgoByModel(startModel);\n    const delta = vEditor?.getDeltaByRangeIndex(startOffset);\n    if (!vEditor || !delta) return;\n    vEditor.setMarks({\n      ...vEditor.marks,\n      [key]:\n        (vEditor.marks && vEditor.marks[key]) ||\n        (delta.attributes && delta.attributes[key])\n          ? null\n          : true,\n    });\n    clearMarksOnDiscontinuousInput(vEditor);\n\n    return;\n  }\n  const format = getCombinedFormat(blockRange);\n\n  // edge case 2: same model\n  if (blockRange.models.length === 1) {\n    if (matchFlavours(startModel, ['affine:code'])) return;\n    const vEditor = getVirgoByModel(startModel);\n    vEditor?.slots.updated.once(() => {\n      restoreSelection(blockRange);\n    });\n    startModel.text?.format(startOffset, endOffset - startOffset, {\n      [key]: format[key] ? null : true,\n    });\n    return;\n  }\n  // common case\n  // format start model\n  if (!matchFlavours(startModel, ['affine:code'])) {\n    startModel.text?.format(startOffset, startModel.text.length - startOffset, {\n      [key]: format[key] ? null : true,\n    });\n  }\n  // format end model\n  if (!matchFlavours(endModel, ['affine:code'])) {\n    endModel.text?.format(0, endOffset, { [key]: format[key] ? null : true });\n  }\n  // format between models\n  blockRange.models\n    .slice(1, -1)\n    .filter(model => !matchFlavours(model, ['affine:code']))\n    .forEach(model => {\n      model.text?.format(0, model.text.length, {\n        [key]: format[key] ? null : true,\n      });\n    });\n\n  // Native selection maybe shifted after format\n  // We need to restore it manually\n  if (blockRange.type === 'Native') {\n    const allTextUpdated = blockRange.models\n      .filter(model => !matchFlavours(model, ['affine:code']))\n      .map(\n        model =>\n          // We can not use `onModelTextUpdated` here because it is asynchronous, which\n          // will make updated event emit before we observe it.\n          new Promise(resolve => {\n            const vEditor = getVirgoByModel(model);\n            vEditor?.slots.updated.once(() => {\n              resolve(vEditor);\n            });\n          })\n      );\n\n    Promise.all(allTextUpdated).then(() => {\n      restoreSelection(blockRange);\n    });\n  }\n}\n\nexport function handleFormat(\n  page: Page,\n  key: keyof Omit<AffineTextAttributes, 'link' | 'reference'>\n) {\n  const blockRange = getCurrentBlockRange(page);\n  if (!blockRange) return;\n  page.captureSync();\n  formatBlockRange(blockRange, key);\n}\n\nexport function handleSelectAll(selection: DefaultSelectionManager) {\n  const currentSelection = window.getSelection();\n  if (\n    selection.state.selectedBlocks.length === 0 &&\n    currentSelection?.focusNode?.nodeName === '#text'\n  ) {\n    selection.selectOneBlock(\n      getClosestBlockElementByElement(currentSelection.focusNode.parentElement)\n    );\n  } else {\n    selection.selectAllBlocks();\n  }\n\n  resetNativeSelection(null);\n}\nexport function handleKeydownAfterSelectBlocks({\n  page,\n  keyboardEvent,\n  selectedBlocks,\n}: {\n  page: Page;\n  keyboardEvent: KeyboardEvent;\n  selectedBlocks: BaseBlockModel[];\n}) {\n  const { key } = keyboardEvent;\n\n  const parent = page.getParent(selectedBlocks[0]);\n  const index = parent?.children.indexOf(selectedBlocks[0]);\n  selectedBlocks.forEach(block => {\n    page.deleteBlock(block);\n  });\n  // TODO:\n  //  1. should add block which has same flavour as the parent?\n  //  2. If use Chinese input method, the input method state cannot be retained\n  const id = page.addBlock(\n    'affine:paragraph',\n    {\n      text: new page.Text(key),\n    },\n    parent,\n    index\n  );\n  // Wait block inserted to dom\n  requestAnimationFrame(() => {\n    const defaultPage = getDefaultPage(page);\n    const newBlock = page.getBlockById(id) as BaseBlockModel;\n    defaultPage?.selection.clear();\n    focusBlockByModel(newBlock, 'end');\n\n    // XXX: slash menu trigger probably shouldn't be here\n    if (key === '/') {\n      const curRange = getCurrentNativeRange();\n      const model = page.getBlockById(id);\n      assertExists(model);\n      showSlashMenu({ model, range: curRange });\n    }\n  });\n}\nexport async function onModelTextUpdated(\n  model: BaseBlockModel,\n  callback: (text: RichText) => void\n) {\n  const richText = await asyncGetRichTextByModel(model);\n  richText?.vEditor?.slots.updated.once(() => {\n    callback(richText);\n  });\n}\n\n// Run the callback until a model's element updated.\n// Please notice that the callback will be called **once the element itself is ready**.\n// The children may be not updated.\n// If you want to wait for the text elements,\n// please use `onModelTextUpdated`.\nexport async function onModelElementUpdated(\n  model: BaseBlockModel,\n  callback: (blockElement: BlockComponentElement) => void\n) {\n  const element = await asyncGetBlockElementByModel(model);\n  if (element) {\n    callback(element);\n  }\n}\n\nexport function tryUpdateFrameSize(page: Page, zoom: number) {\n  requestAnimationFrame(() => {\n    if (!page.root) return;\n    const frames = page.root.children.filter(\n      child => child.flavour === 'affine:frame'\n    ) as TopLevelBlockModel[];\n    frames.forEach(model => {\n      // DO NOT resize shape block\n      // FIXME: we don't have shape block for now.\n      // if (matchFlavours(model, ['affine:shape'])) return;\n      const blockElement = getBlockElementByModel(model);\n      if (!blockElement) return;\n      const bound = blockElement.getBoundingClientRect();\n\n      const [x, y, w, h] = deserializeXYWH(model.xywh);\n      const newModelHeight =\n        bound.height / zoom + EDGELESS_BLOCK_CHILD_PADDING * 2;\n      if (!almostEqual(newModelHeight, h)) {\n        page.updateBlock(model, {\n          xywh: JSON.stringify([x, y, w, Math.round(newModelHeight)]),\n        });\n      }\n    });\n  });\n}\n\n// Show format quick bar when double/triple clicking on text\nexport function showFormatQuickBarByClicks(\n  type: 'double' | 'triple',\n  e: PointerEventState,\n  page: Page,\n  container?: HTMLElement,\n  state?: PageSelectionState\n) {\n  const range =\n    type === 'double'\n      ? handleNativeRangeDblClick()\n      : handleNativeRangeTripleClick(e);\n  if (e.raw.target instanceof HTMLTextAreaElement) return;\n  if (!range || range.collapsed) return;\n  if (page.readonly) return;\n\n  const direction = 'center-bottom';\n  showFormatQuickBar({\n    page,\n    container,\n    direction,\n    anchorEl: {\n      getBoundingClientRect: () => {\n        return calcCurrentSelectionPosition(direction, state);\n      },\n    },\n  });\n}\n", "import { HOTKEYS, paragraphConfig } from '@blocksuite/global/config';\nimport {\n  assertEquals,\n  assertExists,\n  matchFlavours,\n} from '@blocksuite/global/utils';\nimport type { Page } from '@blocksuite/store';\n\nimport {\n  blockRangeToNativeRange,\n  focusBlockByModel,\n  getDefaultPage,\n  hotkey,\n  isMultiBlockRange,\n  isPageMode,\n  isPrintableKeyEvent,\n} from '../../__internal__/index.js';\nimport { handleMultiBlockIndent } from '../../__internal__/rich-text/rich-text-operations.js';\nimport { getService } from '../../__internal__/service.js';\nimport { getCurrentBlockRange } from '../../__internal__/utils/block-range.js';\nimport { isAtLineEdge } from '../../__internal__/utils/check-line.js';\nimport {\n  asyncFocusRichText,\n  clearSelection,\n  focusNextBlock,\n  focusPreviousBlock,\n  focusTitle,\n  getCurrentNativeRange,\n  getModelByElement,\n  getPreviousBlock,\n  getRichTextByModel,\n  getVirgoByModel,\n  Point,\n} from '../../__internal__/utils/index.js';\nimport type { DefaultSelectionManager } from '../default/selection-manager/index.js';\nimport {\n  handleKeydownAfterSelectBlocks,\n  handleSelectAll,\n} from '../utils/index.js';\nimport { actionConfig } from './const.js';\nimport {\n  deleteModelsByRange,\n  updateBlockType,\n} from './container-operations.js';\nimport { formatConfig } from './format-config.js';\n\nexport function bindCommonHotkey(page: Page) {\n  if (page.readonly) return;\n\n  formatConfig.forEach(({ hotkey: hotkeyStr, action }) => {\n    hotkey.addListener(hotkeyStr, e => {\n      // Prevent default behavior\n      e.preventDefault();\n\n      if (page.awarenessStore.isReadonly(page)) return;\n\n      action({ page });\n    });\n  });\n\n  actionConfig.forEach(({ hotkey: hotkeyStr, action, enabledWhen }) => {\n    // if (!isPrintableKeyEvent(e) || page.readonly) return;\n    if (!hotkeyStr) return;\n\n    hotkey.addListener(hotkeyStr, e => {\n      // Prevent default behavior\n      e.preventDefault();\n\n      if (!enabledWhen(page)) return;\n      if (page.awarenessStore.isReadonly(page)) return;\n\n      action({ page });\n    });\n  });\n\n  paragraphConfig.forEach(({ flavour, type, hotkey: hotkeyStr }) => {\n    if (!hotkeyStr) return;\n\n    hotkey.addListener(hotkeyStr, () => {\n      const blockRange = getCurrentBlockRange(page);\n      if (!blockRange) return;\n\n      updateBlockType(blockRange.models, flavour, type);\n    });\n  });\n\n  hotkey.addListener(HOTKEYS.UNDO, e => {\n    e.preventDefault();\n    if (page.canUndo) clearSelection(page);\n    page.undo();\n  });\n\n  hotkey.addListener(HOTKEYS.REDO, e => {\n    e.preventDefault();\n    if (page.canRedo) clearSelection(page);\n    page.redo();\n  });\n\n  // Fixes: https://github.com/toeverything/blocksuite/issues/200\n  // We shouldn't prevent user input, because there could have CN/JP/KR... input,\n  // that have pop-up for selecting local characters.\n  // So we could just hook on the keydown event and detect whether user input a new character.\n  hotkey.addListener(HOTKEYS.ANY_KEY, e => {\n    if (!isPrintableKeyEvent(e) || page.readonly) return;\n\n    const blockRange = getCurrentBlockRange(page);\n    if (!blockRange) return;\n\n    if (blockRange.type === 'Block') {\n      handleKeydownAfterSelectBlocks({\n        page,\n        keyboardEvent: e,\n        selectedBlocks: blockRange.models,\n      });\n      return;\n    }\n\n    const range = blockRangeToNativeRange(blockRange);\n    if (!range || !isMultiBlockRange(range)) return;\n    deleteModelsByRange(page);\n  });\n\n  // !!!\n  // Don't forget to remove hotkeys at `removeCommonHotKey`\n}\n\nexport function removeCommonHotKey() {\n  hotkey.removeListener([\n    ...formatConfig.map(({ hotkey: hotkeyStr }) => hotkeyStr),\n    ...paragraphConfig\n      .map(({ hotkey: hotkeyStr }) => hotkeyStr)\n      .filter((i): i is string => !!i),\n    HOTKEYS.UNDO,\n    HOTKEYS.REDO,\n    HOTKEYS.ANY_KEY,\n  ]);\n}\n\nexport function handleUp(\n  e: KeyboardEvent,\n  page: Page,\n  {\n    selection,\n    zoom,\n  }: { selection?: DefaultSelectionManager; zoom?: number } = {\n    zoom: 1,\n  }\n) {\n  const blockRange = getCurrentBlockRange(page);\n  if (!blockRange) return;\n\n  if (blockRange.type === 'Block') {\n    if (!selection) {\n      console.error(\n        'Failed to handle up: selection is not provided',\n        blockRange\n      );\n      return;\n    }\n    const selectedModel = getModelByElement(selection.state.selectedBlocks[0]);\n    selection.clear();\n    const pageBlock = getDefaultPage(page);\n    assertExists(pageBlock);\n    focusPreviousBlock(\n      selectedModel,\n      pageBlock.lastSelectionPosition instanceof Point\n        ? pageBlock.lastSelectionPosition\n        : 'end'\n    );\n    e.preventDefault();\n    return;\n  }\n  // Assume the native selection is collapsed\n  if (blockRange.type === 'Native') {\n    assertEquals(\n      blockRange.models.length,\n      1,\n      'Failed to handle up! range is not collapsed'\n    );\n    const model = blockRange.models[0];\n    const previousBlock = getPreviousBlock(model);\n    const range = getCurrentNativeRange();\n    const { left, top } = range.getBoundingClientRect();\n    if (!previousBlock && isPageMode(page)) {\n      focusTitle(page);\n      return;\n    }\n\n    // Workaround: focus to empty line will get empty range rect\n    //\n    // See the following example:\n    // - long text\n    //   wrap line\n    // - |    <- caret at empty line,\n    //           if you press ArrowUp,\n    //           the cursor should jump to the start of `wrap line`,\n    //           instead of the start of `long text`!\n    //\n    // If at empty line range.getBoundingClientRect will return 0\n    // You can see the spec here:\n    // The `getBoundingClientRect()` method, when invoked, must return the result of the following algorithm:\n    //   - Let list be the result of invoking getClientRects() on the same range this method was invoked on.\n    //   - If list is empty return a DOMRect object whose x, y, width and height members are zero.\n    // https://w3c.github.io/csswg-drafts/cssom-view/#dom-range-getboundingclientrect\n    if (left === 0 && top === 0) {\n      if (!(range.startContainer instanceof HTMLElement)) {\n        console.warn(\n          \"Failed to calculate caret position! range.getBoundingClientRect() is zero and it's startContainer not an HTMLElement.\",\n          range\n        );\n        focusPreviousBlock(model);\n        return;\n      }\n      const rect = range.startContainer.getBoundingClientRect();\n      focusPreviousBlock(model, new Point(rect.left, rect.top), zoom);\n      return;\n    }\n    focusPreviousBlock(model, new Point(left, top), zoom);\n  }\n}\n\nexport function handleDown(\n  e: KeyboardEvent,\n  page: Page,\n  {\n    selection,\n    zoom,\n  }: { selection?: DefaultSelectionManager; zoom?: number } = {\n    zoom: 1,\n  }\n) {\n  const blockRange = getCurrentBlockRange(page);\n  if (!blockRange) return;\n\n  if (blockRange.type === 'Block') {\n    if (!selection) {\n      console.error(\n        'Failed to handle down: selection is not provided',\n        blockRange\n      );\n      return;\n    }\n    const lastEle = selection.state.selectedBlocks.at(-1);\n    if (!lastEle) {\n      throw new Error(\n        \"Failed to handleDown! Can't find last selected element!\"\n      );\n    }\n    const selectedModel = getModelByElement(lastEle);\n    selection.clear();\n    const pageBlock = getDefaultPage(page);\n    assertExists(pageBlock);\n    focusNextBlock(\n      selectedModel,\n      pageBlock.lastSelectionPosition instanceof Point\n        ? pageBlock.lastSelectionPosition\n        : 'start'\n    );\n    e.preventDefault();\n  }\n  // Assume the native selection is collapsed\n  if (blockRange.type === 'Native') {\n    assertEquals(\n      blockRange.models.length,\n      1,\n      'Failed to handle down! range is not collapsed'\n    );\n    const model = blockRange.models[0];\n    if (\n      matchFlavours(model, ['affine:code']) ||\n      matchFlavours(model, ['affine:page'])\n    ) {\n      return;\n    }\n    const range = getCurrentNativeRange();\n    const atLineEdge = isAtLineEdge(range);\n    const { left, bottom } = range.getBoundingClientRect();\n    const isAtEmptyLine = left === 0 && bottom === 0;\n    // Workaround: at line edge will return wrong rect\n    // See the following example:\n    // - long text\n    //   |wrap line    <- caret at empty line,\n    //                    if you press ArrowDown,\n    //                    the cursor should jump to the start of `next line`,\n    //                    instead of the end of `next line`!\n    // - next line\n    //\n    // Workaround: focus to empty line will get empty range,\n    // we can not focus 'start' directly,\n    // because pressing ArrowDown in multi-level indent line will cause the cursor to jump to wrong position\n    // If at empty line `range.getBoundingClientRect()` will return 0\n    // https://w3c.github.io/csswg-drafts/cssom-view/#dom-range-getboundingclientrect\n    //\n    // See the following example:\n    // - text\n    //   - child\n    //     - |   <- caret at empty line,\n    //              if you press ArrowDown,\n    //              the cursor should jump to the end of `next`,\n    //              instead of the start of `next`!\n    // - next\n    if (atLineEdge || isAtEmptyLine) {\n      const richText = getRichTextByModel(model);\n      assertExists(richText);\n      const richTextRect = richText.getBoundingClientRect();\n      focusNextBlock(\n        model,\n        new Point(richTextRect.left, richTextRect.top),\n        zoom\n      );\n      return;\n    }\n    focusNextBlock(model, new Point(left, bottom), zoom);\n  }\n}\n\nfunction handleTab(\n  e: KeyboardEvent,\n  page: Page,\n  selection: DefaultSelectionManager\n) {\n  const blockRange = getCurrentBlockRange(page);\n  if (!blockRange) return;\n\n  e.preventDefault();\n  const models = blockRange.models;\n  handleMultiBlockIndent(page, models);\n\n  if (blockRange.type === 'Block') {\n    requestAnimationFrame(() => {\n      // TODO update model is not elegant\n      selection.refreshSelectedBlocksRectsByModels(models);\n    });\n  }\n}\n\nexport function bindHotkeys(page: Page, selection: DefaultSelectionManager) {\n  const {\n    BACKSPACE,\n    SELECT_ALL,\n\n    SHIFT_UP,\n    SHIFT_DOWN,\n\n    UP,\n    DOWN,\n    LEFT,\n    RIGHT,\n    ENTER,\n    TAB,\n    SPACE,\n  } = HOTKEYS;\n\n  bindCommonHotkey(page);\n\n  hotkey.addListener(SELECT_ALL, e => {\n    e.preventDefault();\n    handleSelectAll(selection);\n    selection.state.type = 'block';\n  });\n\n  if (page.readonly) return;\n\n  hotkey.addListener(ENTER, e => {\n    const blockRange = getCurrentBlockRange(page);\n    if (!blockRange) return;\n\n    if (blockRange.type === 'Block') {\n      e.preventDefault();\n\n      const endModel = blockRange.models[blockRange.models.length - 1];\n      const parentModel = page.getParent(endModel);\n      const index = parentModel?.children.indexOf(endModel);\n      assertExists(index);\n      assertExists(parentModel);\n      const id = page.addBlock(\n        'affine:paragraph',\n        { type: 'text' },\n        parentModel,\n        index + 1\n      );\n\n      asyncFocusRichText(page, id);\n      selection.clear();\n      return;\n    }\n    // Native selection\n    // Avoid print extra enter\n    e.preventDefault();\n    const startModel = blockRange.models[0];\n    startModel.text?.delete(\n      blockRange.startOffset,\n      startModel.text.length - blockRange.startOffset\n    );\n    const endModel = blockRange.models[blockRange.models.length - 1];\n    endModel.text?.delete(0, blockRange.endOffset);\n    blockRange.models.slice(1, -1).forEach(model => {\n      page.deleteBlock(model);\n    });\n\n    // Virgo will addRange after update finished so we need to wait for it.\n    const vEditor = getVirgoByModel(endModel);\n    vEditor?.slots.updated.once(() => {\n      focusBlockByModel(endModel, 'start');\n    });\n  });\n\n  hotkey.addListener(BACKSPACE, e => {\n    // delete blocks\n    deleteModelsByRange(page);\n    e.preventDefault();\n  });\n\n  hotkey.addListener(UP, e => {\n    const blockRange = getCurrentBlockRange(page);\n    if (!blockRange) return;\n\n    const parent = page.getParent(blockRange.models[0]);\n    if (parent && matchFlavours(parent, ['affine:database'])) {\n      const service = getService('affine:database');\n      if (service.getLastCellSelection()) return;\n    }\n    handleUp(e, page, { selection });\n  });\n  hotkey.addListener(DOWN, e => {\n    const blockRange = getCurrentBlockRange(page);\n    if (!blockRange) return;\n\n    const parent = page.getParent(blockRange.models[0]);\n    if (parent && matchFlavours(parent, ['affine:database'])) {\n      const service = getService('affine:database');\n      if (service.getLastCellSelection()) return;\n    }\n    handleDown(e, page, { selection });\n  });\n  hotkey.addListener(LEFT, e => {\n    const blockRange = getCurrentBlockRange(page);\n    if (!blockRange) return;\n\n    // Do nothing\n    if (blockRange.type === 'Block') return;\n    // See https://github.com/toeverything/blocksuite/issues/2260\n    if (blockRange.models.length > 1) {\n      e.preventDefault();\n      const selection = getSelection();\n      if (selection) {\n        const range = blockRange.nativeRange.cloneRange();\n        range.collapse(true);\n        selection.removeAllRanges();\n        selection.addRange(range);\n      }\n      return;\n    }\n    focusPreviousBlock(blockRange.models[0], 'end');\n  });\n  hotkey.addListener(RIGHT, e => {\n    const blockRange = getCurrentBlockRange(page);\n    if (!blockRange) return;\n\n    if (matchFlavours(blockRange.models[0], ['affine:database'])) {\n      const service = getService('affine:database');\n      if (service.getLastCellSelection()) return;\n    }\n    // Do nothing\n    if (blockRange.type === 'Block') return;\n    // See https://github.com/toeverything/blocksuite/issues/2260\n    if (blockRange.models.length > 1) {\n      e.preventDefault();\n      const selection = getSelection();\n      if (selection) {\n        const range = blockRange.nativeRange.cloneRange();\n        range.collapse(false);\n        selection.removeAllRanges();\n        selection.addRange(range);\n      }\n      return;\n    }\n    focusNextBlock(blockRange.models[0], 'start');\n  });\n\n  hotkey.addListener(TAB, e => handleTab(e, page, selection));\n\n  hotkey.addListener(SHIFT_UP, e => {\n    // TODO expand selection up\n  });\n  hotkey.addListener(SHIFT_DOWN, e => {\n    // TODO expand selection down\n  });\n  // disable it on block selection\n  hotkey.addListener(SPACE, e => {\n    if (selection.state.type === 'block') {\n      e.preventDefault();\n    }\n  });\n\n  // !!!\n  // Don't forget to remove hotkeys at `removeHotkeys`\n}\n\nexport function removeHotkeys() {\n  removeCommonHotKey();\n  hotkey.removeListener([\n    HOTKEYS.BACKSPACE,\n    HOTKEYS.SELECT_ALL,\n\n    HOTKEYS.SHIFT_UP,\n    HOTKEYS.SHIFT_DOWN,\n\n    HOTKEYS.UP,\n    HOTKEYS.DOWN,\n    HOTKEYS.LEFT,\n    HOTKEYS.RIGHT,\n    HOTKEYS.ENTER,\n    HOTKEYS.TAB,\n    HOTKEYS.SPACE,\n  ]);\n}\n", "import {\n  CaptionIcon,\n  CopyIcon,\n  DeleteIcon,\n  DownloadIcon,\n} from '@blocksuite/global/config';\nimport { html } from 'lit';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { EditingState, IPoint } from '../../__internal__/index.js';\nimport { tooltipStyle } from '../../components/tooltip/tooltip.js';\nimport type { EmbedBlockModel } from '../../embed-block/embed-model.js';\nimport { stopPropagation } from '../edgeless/utils.js';\nimport type { DefaultSelectionSlots } from './default-page-block.js';\nimport { copyImage, downloadImage, focusCaption } from './utils.js';\n\nexport function DraggingArea(rect: DOMRect | null) {\n  if (rect === null) return null;\n\n  const style = {\n    left: rect.left + 'px',\n    top: rect.top + 'px',\n    width: rect.width + 'px',\n    height: rect.height + 'px',\n  };\n  return html`\n    <style>\n      .affine-page-dragging-area {\n        position: absolute;\n        background: var(--affine-hover-color);\n        z-index: 1;\n        pointer-events: none;\n      }\n    </style>\n    <div class=\"affine-page-dragging-area\" style=${styleMap(style)}></div>\n  `;\n}\n\nexport function EmbedSelectedRectsContainer(\n  rects: DOMRect[],\n  viewportOffset: IPoint\n) {\n  return html`\n    <style>\n      .affine-page-selected-embed-rects-container > div {\n        position: absolute;\n        display: block;\n        border: 2px solid var(--affine-primary-color);\n        user-select: none;\n      }\n    </style>\n    <div class=\"affine-page-selected-embed-rects-container resizable\">\n      ${rects.map(rect => {\n        const style = {\n          left: rect.left + viewportOffset.x + 'px',\n          top: rect.top + viewportOffset.y + 'px',\n          width: rect.width + 'px',\n          height: rect.height + 'px',\n        };\n        return html`\n          <div class=\"resizes\" style=${styleMap(style)}>\n            <div class=\"resize top-left\"></div>\n            <div class=\"resize top-right\"></div>\n            <div class=\"resize bottom-left\"></div>\n            <div class=\"resize bottom-right\"></div>\n          </div>\n        `;\n      })}\n    </div>\n  `;\n}\n\nexport function EmbedEditingContainer(\n  embedEditingState: EditingState | null,\n  slots: DefaultSelectionSlots,\n  viewportOffset: IPoint\n) {\n  if (!embedEditingState) return null;\n\n  const {\n    rect: { x, y },\n    model,\n  } = embedEditingState;\n  const style = {\n    left: x + viewportOffset.x + 'px',\n    top: y + viewportOffset.y + 'px',\n  };\n\n  return html`\n    <style>\n      .affine-embed-editing-state-container > div {\n        position: absolute;\n        display: block;\n        z-index: 1;\n      }\n      ${tooltipStyle}\n    </style>\n\n    <div\n      class=\"affine-embed-editing-state-container\"\n      @pointerdown=${stopPropagation}\n    >\n      <div style=${styleMap(style)} class=\"embed-editing-state\">\n        <format-bar-button\n          class=\"has-tool-tip\"\n          width=\"100%\"\n          @click=${() => {\n            focusCaption(model);\n            slots.embedRectsUpdated.emit([]);\n          }}\n        >\n          ${CaptionIcon}\n          <tool-tip inert tip-position=\"right\" role=\"tooltip\">Caption</tool-tip>\n        </format-bar-button>\n        <format-bar-button\n          class=\"has-tool-tip\"\n          width=\"100%\"\n          @click=${() => {\n            downloadImage(model);\n          }}\n        >\n          ${DownloadIcon}\n          <tool-tip inert tip-position=\"right\" role=\"tooltip\"\n            >Download\n          </tool-tip>\n        </format-bar-button>\n        <format-bar-button\n          class=\"has-tool-tip\"\n          width=\"100%\"\n          @click=${() => {\n            copyImage(model as EmbedBlockModel);\n          }}\n        >\n          ${CopyIcon}\n          <tool-tip inert tip-position=\"right\" role=\"tooltip\"\n            >Copy to clipboard\n          </tool-tip>\n        </format-bar-button>\n        <format-bar-button\n          class=\"has-tool-tip\"\n          width=\"100%\"\n          @click=\"${() => {\n            model.page.deleteBlock(model);\n            slots.embedRectsUpdated.emit([]);\n          }}\"\n        >\n          ${DeleteIcon}\n          <tool-tip inert tip-position=\"right\" role=\"tooltip\">Delete</tool-tip>\n        </format-bar-button>\n      </div>\n    </div>\n  `;\n}\n", "import { SCROLL_THRESHOLD } from '@blocksuite/global/config';\nimport type { PointerEventState } from '@blocksuite/lit';\nimport { matchFlavours, type Page, type UserRange } from '@blocksuite/store';\n\nimport type {\n  BlockComponentElement,\n  IPoint,\n} from '../../../__internal__/index.js';\nimport {\n  contains,\n  getBlockElementsExcludeSubtrees,\n  getRectByBlockElement,\n} from '../../../__internal__/index.js';\nimport { getExtendBlockRange } from '../../../__internal__/utils/block-range.js';\nimport type { DefaultSelectionSlots } from '../default-page-block.js';\nimport type { DefaultSelectionManager, PageSelectionState } from './index.js';\n\n// distance to the upper and lower boundaries of the viewport\nconst threshold = SCROLL_THRESHOLD / 2;\n\nfunction intersects(a: DOMRect, b: DOMRect, offset: IPoint) {\n  return (\n    a.left + offset.x < b.right &&\n    a.right + offset.x > b.left &&\n    a.top + offset.y < b.bottom &&\n    a.bottom + offset.y > b.top\n  );\n}\n\n// See https://github.com/toeverything/blocksuite/pull/904 and\n// https://github.com/toeverything/blocksuite/issues/839#issuecomment-1411742112\n// for more context.\n//\n// The `bound` is a rect of drag-and-drop selection.\nexport function filterBlocksExcludeSubtrees(\n  blockCache: Map<BlockComponentElement, DOMRect>,\n  bound: DOMRect,\n  offset: IPoint\n) {\n  const entries = Array.from(blockCache.entries());\n  const len = entries.length;\n  const results: { block: BlockComponentElement; index: number }[] = [];\n\n  // empty\n  if (len === 0) return results;\n\n  let prevIndex = -1;\n\n  for (let i = 0; i < len; i++) {\n    const [block, rect] = entries[i];\n    if (intersects(rect, bound, offset)) {\n      if (prevIndex === -1) {\n        prevIndex = i;\n      } else {\n        let prevBlock = entries[prevIndex][0];\n        // prev block before and contains block\n        if (contains(prevBlock, block)) {\n          if (matchFlavours(prevBlock.model, ['affine:database'])) {\n            continue;\n          } else {\n            // not continuous block\n            if (results.length > 1) {\n              continue;\n            }\n            prevIndex = i;\n            results.shift();\n          }\n        } else {\n          // backward search parent block and remove its subtree\n          // only keep blocks of same level\n          const { previousElementSibling } = block;\n          // previousElementSibling is not prev block and previousElementSibling contains prev block\n          if (\n            previousElementSibling &&\n            previousElementSibling !== prevBlock &&\n            contains(previousElementSibling, prevBlock)\n          ) {\n            let n = i;\n            let m = results.length;\n            while (n--) {\n              prevBlock = entries[n][0];\n              if (prevBlock === previousElementSibling) {\n                results.push({ block: prevBlock, index: n });\n                break;\n              } else if (m > 0) {\n                results.pop();\n                m--;\n              }\n            }\n          }\n          prevIndex = i;\n        }\n      }\n\n      results.push({ block, index: i });\n    }\n  }\n\n  return results;\n}\n\nexport function updateLocalSelectionRange(page: Page) {\n  const blockRange = getExtendBlockRange(page);\n  if (!blockRange || blockRange.type === 'Block') {\n    return;\n  }\n  const userRange: UserRange = {\n    startOffset: blockRange.startOffset,\n    endOffset: blockRange.endOffset,\n    blockIds: blockRange.models.map(m => m.id),\n  };\n  page.awarenessStore.setLocalRange(page, userRange);\n}\n\n/*\nfunction computeSelectionType(\n  selectedBlocks: Element[],\n  selectionType?: PageSelectionType\n) {\n  let newSelectionType: PageSelectionType = selectionType ?? 'native';\n\n  const isOnlyBlock = selectedBlocks.length === 1;\n  for (const block of selectedBlocks) {\n    if (selectionType) continue;\n    if (!('model' in block)) continue;\n\n    // Calculate selection type\n    const model = getModelByElement(block);\n    newSelectionType = 'block';\n\n    // Other selection types are possible if only one block is selected\n    if (!isOnlyBlock) continue;\n\n    const flavour = model.flavour;\n    switch (flavour) {\n      case 'affine:embed': {\n        newSelectionType = 'embed';\n        break;\n      }\n      case 'affine:database': {\n        newSelectionType = 'database';\n        break;\n      }\n    }\n  }\n  return newSelectionType;\n}\n*/\n\nexport function setSelectedBlocks(\n  state: PageSelectionState,\n  slots: DefaultSelectionSlots,\n  selectedBlocks: BlockComponentElement[],\n  rects?: DOMRect[]\n) {\n  state.selectedBlocks = selectedBlocks;\n\n  if (rects) {\n    slots.selectedRectsUpdated.emit(rects);\n    return;\n  }\n\n  const calculatedRects = [] as DOMRect[];\n  for (const block of getBlockElementsExcludeSubtrees(selectedBlocks)) {\n    calculatedRects.push(getRectByBlockElement(block));\n  }\n\n  slots.selectedRectsUpdated.emit(calculatedRects);\n}\n\nexport interface AutoScrollHooks {\n  init(): void;\n  onMove(): void;\n  onScroll(val: number): void;\n}\n\nexport function autoScroll(\n  selection: DefaultSelectionManager,\n  e: PointerEventState,\n  hooks: AutoScrollHooks\n) {\n  const { state } = selection;\n  const { y } = e.point;\n\n  const { viewportElement } = selection;\n  const { viewport } = state;\n  const { scrollHeight, clientHeight } = viewport;\n  let { scrollTop } = viewport;\n  const max = scrollHeight - clientHeight;\n\n  hooks.init();\n\n  let auto = true;\n  const autoScroll = () => {\n    if (!auto) {\n      state.clearRaf();\n      return;\n    } else {\n      state.rafID = requestAnimationFrame(autoScroll);\n    }\n\n    // TODO: for the behavior of scrolling, see the native selection\n    // speed easeOutQuad + easeInQuad\n    if (Math.ceil(scrollTop) < max && clientHeight - y < threshold) {\n      // \n      const d = (threshold - (clientHeight - y)) * 0.25;\n      scrollTop += d;\n      auto = Math.ceil(scrollTop) < max;\n      viewportElement.scrollTop = scrollTop;\n\n      hooks.onScroll(d);\n    } else if (scrollTop > 0 && y < threshold) {\n      // \n      const d = (y - threshold) * 0.25;\n      scrollTop += d;\n      auto = scrollTop > 0;\n      viewportElement.scrollTop = scrollTop;\n\n      hooks.onScroll(d);\n    } else {\n      auto = false;\n\n      hooks.onMove();\n    }\n  };\n\n  state.clearRaf();\n  state.rafID = requestAnimationFrame(autoScroll);\n}\n", "import { assertExists } from '@blocksuite/global/utils';\nimport type { PointerEventState } from '@blocksuite/lit';\n\nimport type { DefaultSelectionManager } from './selection-manager.js';\nimport { autoScroll } from './utils.js';\n\nexport const BlockDragHandlers = {\n  onStart(selection: DefaultSelectionManager, e: PointerEventState) {\n    const { state } = selection;\n    // rich-text should be unfocused\n    state.blur();\n    state.type = 'block';\n    selection.updateViewport();\n\n    const { scrollLeft, scrollTop } = state.viewport;\n    state.resetDraggingArea(e, {\n      scrollTop,\n      scrollLeft,\n    });\n    state.refreshBlockRectCache();\n  },\n\n  onMove(selection: DefaultSelectionManager, e: PointerEventState) {\n    autoScroll(selection, e, {\n      init() {\n        const { x, y } = e.point;\n        const {\n          draggingArea,\n          viewport: { scrollLeft, scrollTop },\n        } = selection.state;\n\n        assertExists(draggingArea);\n\n        draggingArea.end.x = x + scrollLeft;\n        draggingArea.end.y = y + scrollTop;\n      },\n      onScroll(d) {\n        const { draggingArea } = selection.state;\n\n        assertExists(draggingArea);\n\n        draggingArea.end.y += d;\n        selection.updateDraggingArea(draggingArea);\n      },\n      onMove() {\n        const { blockCache, draggingArea, viewportOffset } = selection.state;\n\n        assertExists(draggingArea);\n\n        const rect = selection.updateDraggingArea(draggingArea);\n        selection.selectBlocksByDraggingArea(blockCache, rect, viewportOffset);\n      },\n    });\n  },\n\n  onEnd(selection: DefaultSelectionManager, _: PointerEventState) {\n    selection.state.type = 'block';\n    selection.state.clearDraggingArea();\n    selection.slots.draggingAreaUpdated.emit(null);\n    // do not clear selected rects here\n  },\n};\n", "import { assertExists } from '@blocksuite/global/utils';\nimport type { PointerEventState } from '@blocksuite/lit';\n\nimport type { IPoint } from '../../../__internal__/index.js';\nimport type { DefaultSelectionSlots } from '../../../index.js';\nimport { getModelByElement } from '../../../index.js';\nimport type { PageSelectionState } from './selection-state.js';\n\nexport class EmbedResizeManager {\n  readonly state: PageSelectionState;\n  readonly slots: DefaultSelectionSlots;\n  private _originPosition: IPoint = { x: 0, y: 0 };\n  private _dropContainer: HTMLElement | null = null;\n  private _dropContainerSize: { w: number; h: number; left: number } = {\n    w: 0,\n    h: 0,\n    left: 0,\n  };\n  private _dragMoveTarget = 'right';\n\n  constructor(state: PageSelectionState, slots: DefaultSelectionSlots) {\n    this.state = state;\n    this.slots = slots;\n  }\n\n  onStart(e: PointerEventState) {\n    this._originPosition.x = e.raw.pageX;\n    this._originPosition.y = e.raw.pageY;\n    this._dropContainer = (e.raw.target as HTMLElement).closest('.resizes');\n    const rect = this._dropContainer?.getBoundingClientRect() as DOMRect;\n    this._dropContainerSize.w = rect.width;\n    this._dropContainerSize.h = rect.height;\n    this._dropContainerSize.left = rect.left;\n    if ((e.raw.target as HTMLElement).className.includes('right')) {\n      this._dragMoveTarget = 'right';\n    } else {\n      this._dragMoveTarget = 'left';\n    }\n  }\n\n  onMove(e: PointerEventState) {\n    const activeComponent =\n      this.state.activeComponent || this.state.selectedEmbeds[0];\n    if (!activeComponent) return;\n\n    let width = 0;\n    let height = 0;\n    let left = 0;\n    if (this._dragMoveTarget === 'right') {\n      width =\n        this._dropContainerSize.w + (e.raw.pageX - this._originPosition.x);\n    } else {\n      width =\n        this._dropContainerSize.w - (e.raw.pageX - this._originPosition.x);\n    }\n    if (width < activeComponent.getBoundingClientRect().width && width >= 50) {\n      if (this._dragMoveTarget === 'right') {\n        left =\n          this._dropContainerSize.left -\n          (e.raw.pageX - this._originPosition.x) / 2;\n      } else {\n        left =\n          this._dropContainerSize.left +\n          (e.raw.pageX - this._originPosition.x) / 2;\n      }\n\n      height = width * (this._dropContainerSize.h / this._dropContainerSize.w);\n      if (this._dropContainer) {\n        this.slots.embedRectsUpdated.emit([\n          new DOMRect(\n            left,\n            this._dropContainer.getBoundingClientRect().top,\n            width,\n            height\n          ),\n        ]);\n        const activeImg = this.state.activeComponent?.querySelector(\n          '.resizable-img'\n        ) as HTMLDivElement;\n        if (activeImg) {\n          activeImg.style.width = width + 'px';\n          activeImg.style.height = height + 'px';\n        }\n      }\n    }\n  }\n\n  onEnd() {\n    assertExists(this.state.activeComponent);\n    const dragModel = getModelByElement(this.state.activeComponent);\n    dragModel.page.captureSync();\n    assertExists(this._dropContainer);\n    const { width, height } = this._dropContainer.getBoundingClientRect();\n    dragModel.page.updateBlock(dragModel, { width: width, height: height });\n  }\n}\n", "import type { PointerEventState } from '@blocksuite/lit';\n\nimport {\n  handleNativeRangeDragMove,\n  noop,\n  Point,\n} from '../../../__internal__/index.js';\nimport type { DefaultSelectionManager } from './selection-manager.js';\nimport { autoScroll } from './utils.js';\n\nexport const NativeDragHandlers = {\n  onStart(selection: DefaultSelectionManager, e: PointerEventState) {\n    selection.state.resetStartRange(e);\n    selection.state.type = 'native';\n  },\n\n  onMove(selection: DefaultSelectionManager, e: PointerEventState) {\n    autoScroll(selection, e, {\n      init() {\n        selection.state.lastPoint = new Point(e.raw.clientX, e.raw.clientY);\n        handleNativeRangeDragMove(selection.state.startRange, e);\n      },\n      onMove: noop,\n      onScroll: noop,\n    });\n  },\n\n  onEnd(selection: DefaultSelectionManager, _: PointerEventState) {\n    selection.state.clearRaf();\n  },\n};\n", "import { assertExists } from '@blocksuite/global/utils';\nimport type { PointerEventState } from '@blocksuite/lit';\n\nimport { createDragEvent, Point } from '../../../__internal__/index.js';\nimport type { DefaultSelectionManager } from './selection-manager.js';\nimport { autoScroll } from './utils.js';\n\nexport const PreviewDragHandlers = {\n  onStart(selection: DefaultSelectionManager, e: PointerEventState) {\n    const { container, state } = selection;\n    state.blur();\n    container.components.dragHandle?.onDragStart(\n      createDragEvent('dragstart', e.raw),\n      true\n    );\n  },\n\n  onMove(selection: DefaultSelectionManager, e: PointerEventState) {\n    autoScroll(selection, e, {\n      init() {\n        const { state } = selection;\n        const {\n          raw: { clientX, clientY },\n        } = e;\n        state.lastPoint = new Point(clientX, clientY);\n      },\n      onScroll(_) {\n        const {\n          container,\n          state: { lastPoint },\n        } = selection;\n\n        assertExists(lastPoint);\n\n        container.components.dragHandle?.onDrag(\n          createDragEvent(\n            'drag',\n            new MouseEvent('mousemove', {\n              clientX: lastPoint.x,\n              clientY: lastPoint.y,\n              screenY: 1,\n            })\n          ),\n          true,\n          true\n        );\n      },\n      onMove() {\n        const { raw } = e;\n        const { container } = selection;\n        container.components.dragHandle?.onDrag(\n          createDragEvent('drag', raw),\n          true\n        );\n      },\n    });\n  },\n\n  onEnd(selection: DefaultSelectionManager, e: PointerEventState) {\n    const { container, state } = selection;\n    state.clearRaf();\n    state.lastPoint = null;\n    container.components.dragHandle?.onDragEnd(\n      createDragEvent('dragend', e.raw),\n      true\n    );\n  },\n\n  clear(selection: DefaultSelectionManager) {\n    const { container } = selection;\n    container.components.dragHandle?.onDragEnd(createDragEvent('dragend'));\n  },\n};\n", "import { caretRangeFromPoint } from '@blocksuite/global/utils';\nimport type { PointerEventState } from '@blocksuite/lit';\n\nimport type {\n  BlockComponentElement,\n  IPoint,\n} from '../../../__internal__/index.js';\nimport {\n  getBlockElementsByElement,\n  getRectByBlockElement,\n  Point,\n  resetNativeSelection,\n} from '../../../__internal__/index.js';\nimport type { RichText } from '../../../__internal__/rich-text/rich-text.js';\nimport type { EmbedBlockComponent } from '../../../embed-block/index.js';\n\nexport type PageSelectionType =\n  | 'native'\n  | 'block'\n  | 'block:drag'\n  | 'none'\n  | 'embed'\n  | 'database';\n\nexport interface PageViewport {\n  left: number;\n  top: number;\n  scrollLeft: number;\n  scrollTop: number;\n  scrollHeight: number;\n  clientHeight: number;\n  clientWidth: number;\n  // scrollWidth: number,\n}\n\nexport class PageSelectionState {\n  type: PageSelectionType;\n  viewport: PageViewport = {\n    left: 0,\n    top: 0,\n    scrollLeft: 0,\n    scrollTop: 0,\n    scrollHeight: 0,\n    clientHeight: 0,\n    clientWidth: 0,\n  };\n\n  draggingArea: { start: Point; end: Point } | null = null;\n  selectedEmbeds: EmbedBlockComponent[] = [];\n  selectedBlocks: BlockComponentElement[] = [];\n  // null: SELECT_ALL\n  focusedBlock: BlockComponentElement | null = null;\n  rafID?: number;\n  lastPoint: Point | null = null;\n  private _startRange: Range | null = null;\n  private _richTextCache = new Map<RichText, DOMRect>();\n  private _blockCache = new Map<BlockComponentElement, DOMRect>();\n  private _embedCache = new Map<EmbedBlockComponent, DOMRect>();\n  private _activeComponent: BlockComponentElement | null = null;\n\n  constructor(type: PageSelectionType) {\n    this.type = type;\n  }\n\n  get activeComponent() {\n    return this._activeComponent;\n  }\n\n  set activeComponent(component: BlockComponentElement | null) {\n    this._activeComponent = component;\n  }\n\n  get startRange() {\n    return this._startRange;\n  }\n\n  get richTextCache() {\n    return this._richTextCache;\n  }\n\n  get blockCache() {\n    return this._blockCache;\n  }\n\n  get embedCache() {\n    return this._embedCache;\n  }\n\n  get viewportOffset(): IPoint {\n    const {\n      viewport: { left, top, scrollLeft, scrollTop },\n    } = this;\n    return {\n      x: scrollLeft - left,\n      y: scrollTop - top,\n    };\n  }\n\n  resetStartRange(e: PointerEventState) {\n    const { clientX, clientY } = e.raw;\n    this._startRange = caretRangeFromPoint(clientX, clientY);\n    // Save the last coordinates so that we can send them when scrolling through the wheel\n    this.lastPoint = new Point(clientX, clientY);\n  }\n\n  resetDraggingArea(\n    e: PointerEventState,\n    offset: { scrollLeft: number; scrollTop: number } = {\n      scrollLeft: 0,\n      scrollTop: 0,\n    }\n  ) {\n    const { scrollLeft, scrollTop } = offset;\n    let { x, y } = e.point;\n    x += scrollLeft;\n    y += scrollTop;\n    const end = new Point(x, y);\n    this.draggingArea = {\n      start: end.clone(),\n      end,\n    };\n  }\n\n  refreshBlockRectCache() {\n    this._blockCache.clear();\n    // find all blocks from the document\n    const allBlocks = getBlockElementsByElement(\n      document\n    ) as BlockComponentElement[];\n    for (const block of allBlocks) {\n      this._blockCache.set(block, getRectByBlockElement(block));\n    }\n  }\n\n  blur() {\n    resetNativeSelection(null);\n    // deactivate keyboard event handler\n    if (\n      document.activeElement &&\n      document.activeElement instanceof HTMLElement\n    ) {\n      document.activeElement.blur();\n    }\n  }\n\n  clearRaf() {\n    if (this.rafID) {\n      this.rafID = void cancelAnimationFrame(this.rafID);\n    }\n  }\n\n  clearDraggingArea() {\n    this.clearRaf();\n    this.draggingArea = null;\n  }\n\n  clearNativeSelection() {\n    this.clearRaf();\n    this.type = 'none';\n    this._richTextCache.clear();\n    this._startRange = null;\n    this.lastPoint = null;\n    resetNativeSelection(null);\n  }\n\n  clearBlockSelection() {\n    this.type = 'none';\n    this._activeComponent = null;\n    this.focusedBlock = null;\n    this.selectedBlocks = [];\n    this.clearDraggingArea();\n  }\n\n  clearEmbedSelection() {\n    this.type = 'none';\n    this.selectedEmbeds = [];\n    this._activeComponent = null;\n  }\n\n  clearSelection() {\n    this.clearBlockSelection();\n    this.clearEmbedSelection();\n    this.clearNativeSelection();\n  }\n}\n", "import '../../../components/drag-handle.js';\n\nimport { PAGE_BLOCK_CHILD_PADDING } from '@blocksuite/global/config';\nimport { assertExists, matchFlavours } from '@blocksuite/global/utils';\nimport type {\n  EventName,\n  UIEventDispatcher,\n  UIEventHandler,\n  UIEventStateContext,\n} from '@blocksuite/lit';\nimport { type BaseBlockModel, type Page } from '@blocksuite/store';\n\nimport {\n  AbstractSelectionManager,\n  type BlockComponentElement,\n  debounce,\n  type EditingState,\n  type EmbedBlockDoubleClickData,\n  getBlockElementByModel,\n  getBlockElementsByElement,\n  getBlockElementsExcludeSubtrees,\n  getBlockElementsIncludeSubtrees,\n  getClosestBlockElementByPoint,\n  getCurrentNativeRange,\n  getEditorContainerByElement,\n  getModelByBlockElement,\n  getRectByBlockElement,\n  getSelectedStateRectByBlockElement,\n  handleNativeRangeClick,\n  handleNativeRangeDragMove,\n  type IPoint,\n  isBlankArea,\n  isDatabaseInput,\n  isDragHandle,\n  isElement,\n  isEmbed,\n  isImage,\n  isInsidePageTitle,\n  isSelectedBlocks,\n  Point,\n  Rect,\n} from '../../../__internal__/index.js';\nimport { activeEditorManager } from '../../../__internal__/utils/active-editor-manager.js';\nimport { showFormatQuickBar } from '../../../components/format-quick-bar/index.js';\nimport type {\n  EmbedBlockComponent,\n  EmbedBlockModel,\n} from '../../../embed-block/index.js';\nimport { showFormatQuickBarByClicks } from '../../index.js';\nimport {\n  calcCurrentSelectionPosition,\n  getNativeSelectionMouseDragInfo,\n  repairContextMenuRange,\n} from '../../utils/position.js';\nimport type {\n  DefaultPageBlockComponent,\n  DefaultSelectionSlots,\n} from '../default-page-block.js';\nimport { BlockDragHandlers } from './block-drag-handlers.js';\nimport { EmbedResizeManager } from './embed-resize-manager.js';\nimport { NativeDragHandlers } from './native-drag-handlers.js';\nimport { PreviewDragHandlers } from './preview-drag-handlers.js';\nimport { PageSelectionState } from './selection-state.js';\nimport {\n  filterBlocksExcludeSubtrees,\n  setSelectedBlocks,\n  updateLocalSelectionRange,\n} from './utils.js';\n\nfunction shouldFilterMouseEvent(event: Event): boolean {\n  const target = event.target;\n  if (!target || !(target instanceof HTMLElement)) {\n    return false;\n  }\n  if (target.tagName === 'INPUT') {\n    return true;\n  }\n  if (target.tagName === 'FORMAT-QUICK-BAR') {\n    return true;\n  }\n  return false;\n}\n\n/**\n * The selection manager used in default mode.\n */\nexport class DefaultSelectionManager extends AbstractSelectionManager<DefaultPageBlockComponent> {\n  readonly state = new PageSelectionState('none');\n  readonly slots: DefaultSelectionSlots;\n  private readonly _embedResizeManager: EmbedResizeManager;\n\n  constructor({\n    container,\n    dispatcher,\n    page,\n    mouseRoot,\n    slots,\n  }: {\n    container: DefaultPageBlockComponent;\n    dispatcher: UIEventDispatcher;\n    page: Page;\n    mouseRoot: HTMLElement;\n    slots: DefaultSelectionSlots;\n  }) {\n    super(container, dispatcher);\n\n    this.slots = slots;\n\n    this._embedResizeManager = new EmbedResizeManager(this.state, slots);\n\n    let isDragging = false;\n    this._add('dragStart', ctx => {\n      const event = ctx.get('pointerState');\n      if (shouldFilterMouseEvent(event.raw)) return;\n      if (\n        !isInsidePageTitle(event.raw.target) &&\n        !isDatabaseInput(event.raw.target)\n      ) {\n        event.raw.preventDefault();\n      }\n      isDragging = true;\n      this._onContainerDragStart(ctx);\n    });\n    this._add('dragMove', ctx => {\n      const event = ctx.get('pointerState');\n      if (shouldFilterMouseEvent(event.raw)) return;\n      if (\n        !isInsidePageTitle(event.raw.target) &&\n        !isDatabaseInput(event.raw.target)\n      ) {\n        event.raw.preventDefault();\n      }\n      this._onContainerDragMove(ctx);\n    });\n    this._dispatcher.add('dragEnd', ctx => {\n      const event = ctx.get('pointerState');\n      if (\n        !isInsidePageTitle(event.raw.target) &&\n        !isDatabaseInput(event.raw.target)\n      ) {\n        event.raw.preventDefault();\n      }\n      isDragging = false;\n      this._onContainerDragEnd(ctx);\n    });\n    this._add('click', ctx => {\n      const event = ctx.get('pointerState');\n      if (\n        !isInsidePageTitle(event.raw.target) &&\n        !isDatabaseInput(event.raw.target)\n      ) {\n        event.raw.preventDefault();\n      }\n      this._onContainerClick(ctx);\n    });\n    this._add('doubleClick', ctx => {\n      const event = ctx.get('pointerState');\n      if (shouldFilterMouseEvent(event.raw)) return;\n      this._onContainerDblClick(ctx);\n    });\n    this._add('tripleClick', ctx => {\n      const event = ctx.get('pointerState');\n      if (shouldFilterMouseEvent(event.raw)) return;\n      this._onContainerTripleClick(ctx);\n    });\n    this._add('pointerDown', this._onContainerPointerDown);\n    this._add('pointerMove', ctx => {\n      const event = ctx.get('pointerState');\n      if (shouldFilterMouseEvent(event.raw)) return;\n      if (\n        !isInsidePageTitle(event.raw.target) &&\n        !isDatabaseInput(event.raw.target)\n      ) {\n        event.raw.preventDefault();\n      }\n      if (this.page.hasFlavour('affine:frame')) {\n        this._onContainerPointerMove(ctx);\n      }\n    });\n    this._add('contextMenu', this._onContainerContextMenu);\n    this._add('virgo-vrange-updated', () => {\n      this._onSelectionChangeWithoutDebounce();\n    });\n    this._add(\n      'virgo-vrange-updated',\n      debounce((ctx: UIEventStateContext) => {\n        const { event } = ctx.get('defaultState');\n\n        if (shouldFilterMouseEvent(event)) return;\n        if (isDragging) {\n          return;\n        }\n\n        this._onSelectionChangeWithDebounce();\n      }, 300)\n    );\n  }\n\n  private _ensureFrameExists() {\n    const hasFrame = this.page.hasFlavour('affine:frame');\n    if (!hasFrame) {\n      const frameId = this.page.addBlock('affine:frame', {}, this.page.root);\n      this.page.addBlock('affine:paragraph', {}, frameId);\n      return true;\n    }\n\n    return false;\n  }\n\n  private _add = (name: EventName, fn: UIEventHandler) => {\n    this._disposables.add(this._dispatcher.add(name, fn));\n  };\n\n  private _onContainerDragStart = (ctx: UIEventStateContext) => {\n    const e = ctx.get('pointerState');\n    const target = e.raw.target;\n    if (isInsidePageTitle(target) || isDatabaseInput(target)) {\n      this.state.type = 'none';\n      return;\n    }\n\n    if (\n      isElement(target) &&\n      (isDragHandle(target as Element) || isSelectedBlocks(target as Element))\n    ) {\n      PreviewDragHandlers.onStart(this, e);\n      return;\n    }\n\n    if (isEmbed(e)) {\n      this.state.type = 'embed';\n      this._embedResizeManager.onStart(e);\n      return;\n    }\n\n    // disable dragHandle button\n    this.container.components.dragHandle?.setPointerEvents('none');\n\n    // clear selection first\n    this.clear();\n\n    if (isBlankArea(e)) {\n      BlockDragHandlers.onStart(this, e);\n    } else {\n      NativeDragHandlers.onStart(this, e);\n    }\n  };\n\n  private _onContainerDragMove = (ctx: UIEventStateContext) => {\n    const e = ctx.get('pointerState');\n    if (this.state.type === 'native') {\n      NativeDragHandlers.onMove(this, e);\n      return;\n    }\n\n    if (this.page.readonly) return;\n\n    if (this.state.type === 'block:drag') {\n      PreviewDragHandlers.onMove(this, e);\n      return;\n    }\n\n    if (this.state.type === 'block') {\n      BlockDragHandlers.onMove(this, e);\n      return;\n    }\n\n    if (this.state.type === 'embed') {\n      return this._embedResizeManager.onMove(e);\n    }\n  };\n\n  private _onContainerDragEnd = (ctx: UIEventStateContext) => {\n    const e = ctx.get('pointerState');\n    this.container.components.dragHandle?.setPointerEvents('auto');\n\n    if (this.state.type === 'block:drag') {\n      PreviewDragHandlers.onEnd(this, e);\n      return;\n    }\n    if (this.state.type === 'native') {\n      NativeDragHandlers.onEnd(this, e);\n    } else if (this.state.type === 'block') {\n      BlockDragHandlers.onEnd(this, e);\n    } else if (this.state.type === 'embed') {\n      this._embedResizeManager.onEnd();\n    }\n\n    if (this.page.readonly) return;\n\n    if (this.state.type === 'native') {\n      const { direction, selectedType } = getNativeSelectionMouseDragInfo(e);\n      // If nothing is selected, we should not show the format bar\n      if (selectedType === 'Caret') return;\n      showFormatQuickBar({\n        page: this.page,\n        container: this.container,\n        direction,\n        anchorEl: {\n          getBoundingClientRect: () => {\n            return calcCurrentSelectionPosition(direction, this.state);\n          },\n        },\n      });\n    } else if (this.state.type === 'block') {\n      if (\n        !this.page.awarenessStore.getFlag('enable_block_selection_format_bar')\n      ) {\n        return;\n      }\n      if (!this.state.selectedBlocks.length) {\n        return;\n      }\n      // TODO Check if there are valid blocks in the selection before showing the format bar\n      // If all the selected blocks are images, the format bar should not be displayed.\n\n      const direction = e.start.y < e.point.y ? 'center-bottom' : 'center-top';\n      showFormatQuickBar({\n        page: this.page,\n        container: this.container,\n        direction,\n        anchorEl: {\n          // After update block type, the block selection will be cleared and refreshed.\n          // So we need to get the targe block's rect dynamic.\n          getBoundingClientRect: () => {\n            return calcCurrentSelectionPosition(direction, this.state);\n          },\n        },\n      });\n    }\n  };\n\n  private _onContainerPointerDown = (ctx: UIEventStateContext) => {\n    const e = ctx.get('pointerState');\n    if (e.keys.shift) {\n      // dont trigger native selection behavior\n      e.raw.preventDefault();\n    }\n  };\n\n  private _onContainerClick = (ctx: UIEventStateContext) => {\n    const e = ctx.get('pointerState');\n    const {\n      point: { x, y },\n      raw: { target, clientX, clientY, pageX },\n      keys: { shift },\n    } = e;\n\n    const hasAddedFrame = this._ensureFrameExists();\n\n    if (hasAddedFrame && isInsidePageTitle(target)) {\n      requestAnimationFrame(() => {\n        handleNativeRangeClick(this.page, e, this.container);\n      });\n    }\n\n    const container = getEditorContainerByElement(this.container);\n    activeEditorManager.setActive(container);\n\n    const { state } = this;\n    const { viewport } = state;\n    let { type } = state;\n\n    // do nothing when clicking on scrollbar\n    if (pageX >= viewport.clientWidth + viewport.left) return;\n\n    // do nothing when clicking on drag-handle\n    if (isElement(target) && isDragHandle(target as Element)) {\n      return;\n    }\n\n    // shift + click\n    // * native: select texts\n    // * block: select blocks\n    if (shift) {\n      if (type === 'none') {\n        type = state.type = 'native';\n      }\n      if (type === 'native') {\n        state.lastPoint = new Point(clientX, clientY);\n        handleNativeRangeDragMove(state.startRange, e);\n      } else if (type === 'block') {\n        this.selectedBlocksWithShiftClick(x, y);\n      }\n      return;\n    }\n\n    // clear selection first\n    this.clear();\n\n    state.resetStartRange(e);\n\n    // mouseRoot click will blur all captions\n    const allCaptions = Array.from(\n      document.querySelectorAll('.affine-embed-wrapper-caption')\n    );\n    allCaptions.forEach(el => {\n      if (el !== target) {\n        (el as HTMLInputElement).blur();\n      }\n    });\n\n    let clickBlockInfo = null;\n\n    const element = getClosestBlockElementByPoint(new Point(clientX, clientY), {\n      rect: this.container.innerRect,\n    });\n\n    if (element) {\n      clickBlockInfo = {\n        model: getModelByBlockElement(element),\n        rect: getSelectedStateRectByBlockElement(element),\n        element: element as BlockComponentElement,\n      };\n    }\n\n    if (clickBlockInfo && clickBlockInfo.model) {\n      const { element } = clickBlockInfo;\n      this.container.lastSelectionPosition = 'start';\n      state.focusedBlock = element;\n    }\n\n    if (\n      clickBlockInfo &&\n      matchFlavours(clickBlockInfo.model, ['affine:embed', 'affine:divider'])\n    ) {\n      window.getSelection()?.removeAllRanges();\n\n      state.activeComponent = clickBlockInfo.element;\n\n      assertExists(this.state.activeComponent);\n      if (clickBlockInfo.model.type === 'image') {\n        state.type = 'embed';\n        state.selectedEmbeds.push(state.activeComponent as EmbedBlockComponent);\n        this.slots.embedRectsUpdated.emit([clickBlockInfo.rect]);\n      } else {\n        state.type = 'block';\n        state.selectedBlocks.push(state.activeComponent);\n        this.slots.selectedRectsUpdated.emit([clickBlockInfo.rect]);\n      }\n      return;\n    }\n    if (\n      isInsidePageTitle(target) ||\n      isDatabaseInput(target) ||\n      // TODO It's a workaround, we need remove the ad-hoc code\n      // Fix https://github.com/toeverything/blocksuite/issues/2459\n      target instanceof HTMLInputElement\n    )\n      return;\n\n    handleNativeRangeClick(this.page, e, this.container);\n  };\n\n  private _onContainerDblClick = (ctx: UIEventStateContext) => {\n    const e = ctx.get('pointerState');\n    // clear selection first\n    this.clear();\n\n    // switch native selection\n    NativeDragHandlers.onStart(this, e);\n\n    // The following code is for the fullscreen image modal\n    // fixme:\n    //  remove dispatch a custom event\n    //  once we have a better way to handle this\n    //  like plugin system.\n    {\n      const {\n        raw: { clientX, clientY },\n      } = e;\n\n      const element = getClosestBlockElementByPoint(\n        new Point(clientX, clientY),\n        {\n          rect: this.container.innerRect,\n        }\n      );\n\n      if (element) {\n        const targetModel = getModelByBlockElement(element) as EmbedBlockModel;\n        if (targetModel.flavour === 'affine:embed') {\n          window.dispatchEvent(\n            new CustomEvent<EmbedBlockDoubleClickData>(\n              'affine.embed-block-db-click',\n              {\n                detail: {\n                  blockId: targetModel.id,\n                },\n              }\n            )\n          );\n        }\n      }\n    }\n\n    showFormatQuickBarByClicks(\n      'double',\n      e,\n      this.page,\n      this.container,\n      this.state\n    );\n  };\n\n  private _onContainerTripleClick = (ctx: UIEventStateContext) => {\n    const e = ctx.get('pointerState');\n    showFormatQuickBarByClicks(\n      'triple',\n      e,\n      this.page,\n      this.container,\n      this.state\n    );\n  };\n\n  private _onContainerContextMenu = (ctx: UIEventStateContext) => {\n    const e = ctx.get('defaultState');\n    repairContextMenuRange(e.event as MouseEvent);\n  };\n\n  private _onContainerPointerMove = (ctx: UIEventStateContext) => {\n    const e = ctx.get('pointerState');\n    const { dragging, raw } = e;\n\n    // dont show option menu of image on block/native selection\n    if (dragging || (raw.target as HTMLElement).closest('.embed-editing-state'))\n      return;\n\n    const point = new Point(raw.clientX, raw.clientY);\n    let hoverEditingState = null;\n\n    const { innerRect } = this.container;\n    const element = getClosestBlockElementByPoint(point.clone(), {\n      rect: innerRect,\n    });\n\n    if (element) {\n      const { left, top, width, height } = getRectByBlockElement(element);\n      hoverEditingState = {\n        element: element as BlockComponentElement,\n        model: getModelByBlockElement(element),\n        rect: new DOMRect(\n          Math.max(left, innerRect.left + PAGE_BLOCK_CHILD_PADDING),\n          top,\n          width,\n          height\n        ),\n      };\n    }\n\n    this.container.components.dragHandle?.onContainerMouseMove(\n      e,\n      hoverEditingState\n    );\n\n    if (hoverEditingState) {\n      const { model, element } = hoverEditingState;\n      let shouldClear = true;\n\n      if (model.type === 'image') {\n        const {\n          state: {\n            viewport: { left, clientWidth },\n          },\n        } = this;\n        const rect = getSelectedStateRectByBlockElement(element);\n        const tempRect = Rect.fromDOMRect(rect);\n        const isOutside = rect.right + 60 < left + clientWidth;\n        tempRect.right += isOutside ? 60 : 0;\n\n        if (tempRect.isPointIn(point)) {\n          // when image size is too large, the option popup should show inside\n          rect.x = rect.right + (isOutside ? 10 : -50);\n          hoverEditingState.rect = rect;\n          shouldClear = false;\n        }\n      }\n\n      if (shouldClear) {\n        hoverEditingState = null;\n      }\n    }\n\n    this.slots.embedEditingStateUpdated.emit(hoverEditingState);\n  };\n\n  private _onSelectionChangeWithDebounce = () => {\n    const selection = window.getSelection();\n    if (!selection) return;\n\n    // filter out selection change event from title\n    if (\n      isInsidePageTitle(selection.anchorNode) ||\n      isInsidePageTitle(selection.focusNode)\n    ) {\n      return;\n    }\n\n    // Exclude selection change outside the editor\n    if (!selection.containsNode(this.container, true)) {\n      return;\n    }\n\n    const range = getCurrentNativeRange(selection);\n    if (range.collapsed) return;\n    if (this.page.readonly) return;\n\n    const offsetDelta = selection.anchorOffset - selection.focusOffset;\n    let selectionDirection: 'left-right' | 'right-left' | 'none' = 'none';\n\n    if (offsetDelta > 0) {\n      selectionDirection = 'right-left';\n    } else if (offsetDelta < 0) {\n      selectionDirection = 'left-right';\n    }\n    const direction =\n      selectionDirection === 'left-right' ? 'right-bottom' : 'left-top';\n    // Show quick bar when user select text by keyboard(Shift + Arrow)\n    showFormatQuickBar({\n      page: this.page,\n      container: this.container,\n      direction,\n      anchorEl: {\n        getBoundingClientRect: () => {\n          return calcCurrentSelectionPosition(direction, this.state);\n        },\n      },\n    });\n  };\n\n  private _onSelectionChangeWithoutDebounce = () => {\n    updateLocalSelectionRange(this.page);\n  };\n\n  get viewportElement() {\n    return this.container.viewportElement;\n  }\n\n  updateDraggingArea(draggingArea: { start: Point; end: Point }): DOMRect {\n    if (this.state.focusedBlock !== null) {\n      this.state.focusedBlock = null;\n    }\n    const rect = Rect.fromPoints(\n      draggingArea.start,\n      draggingArea.end\n    ).toDOMRect();\n    this.slots.draggingAreaUpdated.emit(rect);\n    return rect;\n  }\n\n  updateViewport() {\n    const { viewportElement } = this.container;\n    const { clientHeight, clientWidth, scrollHeight, scrollLeft, scrollTop } =\n      viewportElement;\n    const { top, left } = viewportElement.getBoundingClientRect();\n    this.state.viewport = {\n      top,\n      left,\n      clientHeight,\n      clientWidth,\n      scrollHeight,\n      scrollLeft,\n      scrollTop,\n    };\n  }\n\n  updateRects() {\n    const { type } = this.state;\n    if (type === 'block') {\n      this.refreshSelectedBlocksRects();\n    } else if (type === 'embed') {\n      this.refreshEmbedRects();\n    }\n  }\n\n  refreshDraggingArea(viewportOffset: IPoint) {\n    const { blockCache, draggingArea } = this.state;\n    if (draggingArea) {\n      this.selectBlocksByDraggingArea(\n        blockCache,\n        Rect.fromPoints(draggingArea.start, draggingArea.end).toDOMRect(),\n        viewportOffset,\n        true\n      );\n    } else {\n      this.state.draggingArea = null;\n      this.slots.draggingAreaUpdated.emit(null);\n      this.refreshSelectedBlocksRects();\n    }\n  }\n\n  refreshSelectedBlocksRects() {\n    const { focusedBlock, selectedBlocks } = this.state;\n\n    if (selectedBlocks.length === 0) return;\n\n    // just refresh selected blocks\n    if (focusedBlock === null) {\n      const rects = getBlockElementsExcludeSubtrees(selectedBlocks).map(\n        getRectByBlockElement\n      );\n      this.slots.selectedRectsUpdated.emit(rects);\n    } else {\n      // only current focused block element\n      this.slots.selectedRectsUpdated.emit([\n        getRectByBlockElement(focusedBlock),\n      ]);\n    }\n  }\n\n  refreshSelectedBlocksRectsByModels(models: BaseBlockModel[]) {\n    this.state.selectedBlocks = models\n      .map(getBlockElementByModel)\n      .filter((block): block is BlockComponentElement => block !== null);\n    this.refreshSelectedBlocksRects();\n  }\n\n  refreshEmbedRects(hoverEditingState: EditingState | null = null) {\n    const { activeComponent, selectedEmbeds, viewport } = this.state;\n    if (activeComponent && selectedEmbeds.length) {\n      const rect = getSelectedStateRectByBlockElement(activeComponent);\n      const embedRects = [\n        new DOMRect(rect.left, rect.top, rect.width, rect.height),\n      ];\n\n      // updates editing\n      if (hoverEditingState && isImage(activeComponent)) {\n        const isOutside =\n          rect.right + 60 < viewport.left + viewport.clientWidth;\n\n        // when image size is too large, the option popup should show inside\n        rect.x = rect.right + (isOutside ? 10 : -50);\n        hoverEditingState.rect = rect;\n      }\n\n      this.slots.embedRectsUpdated.emit(embedRects);\n    }\n  }\n\n  refreshRemoteSelection() {\n    const element = this.container.querySelector('remote-selection');\n    if (element) {\n      element.requestUpdate();\n    }\n  }\n\n  selectOneBlock(element?: Element | null, rect?: DOMRect) {\n    // clear selection first\n    this.clear();\n    // rich-text should be unfocused\n    this.state.blur();\n    this.state.type = 'block';\n    this.state.focusedBlock = element as BlockComponentElement;\n\n    if (!element) return;\n\n    if (!rect) {\n      rect = getRectByBlockElement(this.state.focusedBlock);\n    }\n\n    // find subtrees of focused block element\n    const selectedBlocks = getBlockElementsIncludeSubtrees([element]);\n\n    // only current focused block element\n    setSelectedBlocks(\n      this.state,\n      this.slots,\n      selectedBlocks as BlockComponentElement[],\n      [rect]\n    );\n  }\n\n  selectAllBlocks() {\n    // clear selection first\n    this.clear();\n    this.state.type = 'block';\n    this.state.focusedBlock = null;\n\n    const selectedBlocks = getBlockElementsByElement(this.container);\n\n    // clear subtrees\n    const rects = getBlockElementsExcludeSubtrees(selectedBlocks).map(\n      getRectByBlockElement\n    );\n\n    setSelectedBlocks(\n      this.state,\n      this.slots,\n      selectedBlocks as BlockComponentElement[],\n      rects\n    );\n  }\n\n  selectBlocksByDraggingArea(\n    blockCache: Map<BlockComponentElement, DOMRect>,\n    draggingArea: DOMRect,\n    viewportOffset: IPoint,\n    isScrolling = false\n  ) {\n    if (isScrolling) {\n      this.state.refreshBlockRectCache();\n    }\n\n    const blocks = filterBlocksExcludeSubtrees(\n      blockCache,\n      draggingArea,\n      // subtracting the left/top of the container is required.\n      viewportOffset\n    );\n    const [selectedBlocks, rects] = blocks.reduce<[Element[], DOMRect[]]>(\n      (data, { block }) => {\n        data[0].push(...getBlockElementsIncludeSubtrees([block as Element]));\n        data[1].push(getRectByBlockElement(block as Element));\n        return data;\n      },\n      [[], []]\n    );\n\n    setSelectedBlocks(\n      this.state,\n      this.slots,\n      selectedBlocks as BlockComponentElement[],\n      rects\n    );\n  }\n\n  selectedBlocksWithShiftClick(x: number, y: number) {\n    const { state } = this;\n    const {\n      viewport: { scrollLeft, scrollTop },\n      viewportOffset,\n      selectedBlocks,\n    } = state;\n    const lastIndex = selectedBlocks.length - 1;\n\n    if (lastIndex === -1) return;\n\n    const hasOneBlock = lastIndex === 0;\n    const first = selectedBlocks[0];\n    const last = hasOneBlock ? first : selectedBlocks[lastIndex];\n    const firstRect = getRectByBlockElement(first);\n    const lastRect = hasOneBlock ? firstRect : getRectByBlockElement(last);\n    const rect = Rect.fromPoints(\n      new Point(\n        firstRect.left + viewportOffset.x,\n        firstRect.top + viewportOffset.y\n      ),\n      new Point(\n        lastRect.right + viewportOffset.x,\n        lastRect.bottom + viewportOffset.y\n      )\n    );\n    const point = new Point(x + scrollLeft, y + scrollTop);\n\n    let start;\n    let end;\n    let pos = true;\n\n    if (hasOneBlock) {\n      if (rect.isPointIn(point)) {\n        return;\n      }\n\n      if (point.y < rect.top) {\n        start = point;\n        end = rect.max;\n        pos = false;\n      } else {\n        start = rect.min;\n        end = point;\n      }\n    } else {\n      if (rect.isPointIn(point)) {\n        if (point.y >= rect.top + rect.height / 2) {\n          start = point;\n          end = rect.max;\n          pos = false;\n        } else {\n          start = rect.min;\n          end = point;\n        }\n      } else if (point.y < rect.top) {\n        start = point;\n        end = rect.max;\n        pos = false;\n      } else {\n        start = rect.min;\n        end = point;\n      }\n    }\n\n    if (start && end) {\n      this.selectBlocksByDraggingArea(\n        state.blockCache,\n        Rect.fromPoints(start, end).toDOMRect(),\n        viewportOffset,\n        true\n      );\n    }\n\n    const direction = pos ? 'center-bottom' : 'center-top';\n    showFormatQuickBar({\n      page: this.page,\n      container: this.container,\n      direction,\n      anchorEl: {\n        // After update block type, the block selection will be cleared and refreshed.\n        // So we need to get the targe block's rect dynamic.\n        getBoundingClientRect: () => {\n          return calcCurrentSelectionPosition(direction, state);\n        },\n      },\n    });\n  }\n\n  setSelectedBlocks(\n    selectedBlocks: BlockComponentElement[],\n    rects?: DOMRect[]\n  ) {\n    setSelectedBlocks(this.state, this.slots, selectedBlocks, rects);\n  }\n\n  setFocusedBlock(blockElement: Element) {\n    this.state.focusedBlock = blockElement as BlockComponentElement;\n  }\n\n  // clear selection: `block`, `block:drag`, `embed`, `native`\n  clear() {\n    const { state, slots } = this;\n    let { type } = state;\n\n    if (type === 'block:drag') {\n      // clear `drag preview`\n      PreviewDragHandlers.clear(this);\n      type = 'block';\n    }\n\n    if (type === 'block') {\n      state.clearBlockSelection();\n      slots.selectedRectsUpdated.emit([]);\n      slots.draggingAreaUpdated.emit(null);\n\n      // `ESC`\n      // clear `format quick bar`\n      this.container.querySelector('format-quick-bar')?.remove();\n    } else if (type === 'embed') {\n      state.clearEmbedSelection();\n      slots.embedRectsUpdated.emit([]);\n      slots.embedEditingStateUpdated.emit(null);\n    } else if (type === 'native') {\n      state.clearNativeSelection();\n    }\n  }\n\n  dispose() {\n    this.slots.selectedRectsUpdated.dispose();\n    this.slots.draggingAreaUpdated.dispose();\n    this.slots.embedEditingStateUpdated.dispose();\n    this.slots.embedRectsUpdated.dispose();\n    this._disposables.dispose();\n  }\n}\n", "/// <reference types=\"vite/client\" />\nimport {\n  BLOCK_ID_ATTR,\n  PAGE_BLOCK_CHILD_PADDING,\n  PAGE_BLOCK_PADDING_BOTTOM,\n} from '@blocksuite/global/config';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { BlockElement } from '@blocksuite/lit';\nimport {\n  type BaseBlockModel,\n  matchFlavours,\n  Slot,\n  Utils,\n} from '@blocksuite/store';\nimport { VEditor } from '@blocksuite/virgo';\nimport { css, html } from 'lit';\nimport { customElement, query, state } from 'lit/decorators.js';\n\nimport { PageClipboard } from '../../__internal__/clipboard/index.js';\nimport type {\n  BlockHost,\n  EditingState,\n  SelectionPosition,\n} from '../../__internal__/index.js';\nimport {\n  asyncFocusRichText,\n  hotkey,\n  HOTKEY_SCOPE_TYPE,\n  Rect,\n} from '../../__internal__/index.js';\nimport { getService, registerService } from '../../__internal__/service.js';\nimport { activeEditorManager } from '../../__internal__/utils/active-editor-manager.js';\nimport type { DragHandle } from '../../components/index.js';\nimport { PageBlockService } from '../index.js';\nimport type { PageBlockModel } from '../page-model.js';\nimport { bindHotkeys, removeHotkeys } from '../utils/bind-hotkey.js';\nimport { tryUpdateFrameSize } from '../utils/index.js';\nimport {\n  DraggingArea,\n  EmbedEditingContainer,\n  EmbedSelectedRectsContainer,\n} from './components.js';\nimport { DefaultSelectionManager } from './selection-manager/index.js';\nimport { createDragHandle, getAllowSelectedBlocks } from './utils.js';\n\nexport interface DefaultSelectionSlots {\n  draggingAreaUpdated: Slot<DOMRect | null>;\n  selectedRectsUpdated: Slot<DOMRect[]>;\n  embedRectsUpdated: Slot<DOMRect[]>;\n  embedEditingStateUpdated: Slot<EditingState | null>;\n}\n\n@customElement('affine-default-page')\nexport class DefaultPageBlockComponent\n  extends BlockElement<PageBlockModel>\n  implements BlockHost\n{\n  static override styles = css`\n    .affine-default-viewport {\n      position: relative;\n      overflow-x: hidden;\n      overflow-y: auto;\n      height: 100%;\n    }\n\n    .affine-default-page-block-container {\n      display: flex;\n      flex-direction: column;\n      width: 100%;\n      font-family: var(--affine-font-family);\n      font-size: var(--affine-font-base);\n      line-height: var(--affine-line-height);\n      color: var(--affine-text-primary-color);\n      font-weight: 400;\n      max-width: var(--affine-editor-width);\n      margin: 0 auto;\n      /* cursor: crosshair; */\n      cursor: default;\n      padding-bottom: ${PAGE_BLOCK_PADDING_BOTTOM}px;\n\n      /* Leave a place for drag-handle */\n      padding-left: ${PAGE_BLOCK_CHILD_PADDING}px;\n      padding-right: ${PAGE_BLOCK_CHILD_PADDING}px;\n    }\n\n    .affine-default-page-block-title {\n      width: 100%;\n      font-size: 40px;\n      line-height: 50px;\n      font-weight: 700;\n      outline: none;\n      resize: none;\n      border: 0;\n      font-family: inherit;\n      color: inherit;\n      cursor: text;\n    }\n\n    .affine-default-page-block-title-empty::before {\n      content: 'Title';\n      color: var(--affine-placeholder-color);\n      position: absolute;\n      opacity: 0.5;\n    }\n\n    .affine-default-page-block-title:disabled {\n      background-color: transparent;\n    }\n\n    /*\n    .affine-default-page-block-title-container {\n    }\n    */\n\n    .affine-block-element {\n      display: block;\n    }\n  `;\n\n  flavour = 'affine:page' as const;\n\n  clipboard = new PageClipboard(this);\n\n  selection!: DefaultSelectionManager;\n\n  getService = getService;\n\n  lastSelectionPosition: SelectionPosition = 'start';\n\n  /**\n   * Shared components\n   */\n  components = {\n    dragHandle: <DragHandle | null>null,\n  };\n\n  mouseRoot!: HTMLElement;\n\n  @state()\n  private _draggingArea: DOMRect | null = null;\n\n  @state()\n  private _selectedRects: DOMRect[] = [];\n\n  @state()\n  private _selectedEmbedRects: DOMRect[] = [];\n\n  @state()\n  private _embedEditingState!: EditingState | null;\n\n  @state()\n  private _isComposing = false;\n\n  private _resizeObserver: ResizeObserver | null = null;\n\n  @query('.affine-default-viewport')\n  viewportElement!: HTMLDivElement;\n\n  @query('.affine-default-page-block-container')\n  pageBlockContainer!: HTMLDivElement;\n\n  slots = {\n    draggingAreaUpdated: new Slot<DOMRect | null>(),\n    selectedRectsUpdated: new Slot<DOMRect[]>(),\n    embedRectsUpdated: new Slot<DOMRect[]>(),\n    embedEditingStateUpdated: new Slot<EditingState | null>(),\n    nativeSelectionToggled: new Slot<boolean>(),\n    pageLinkClicked: new Slot<{ pageId: string; blockId?: string }>(),\n  };\n\n  @query('.affine-default-page-block-title')\n  private _titleContainer!: HTMLElement;\n  private _titleVEditor: VEditor | null = null;\n\n  get titleVEditor() {\n    assertExists(this._titleVEditor);\n    return this._titleVEditor;\n  }\n\n  get innerRect() {\n    const { left, width } = this.pageBlockContainer.getBoundingClientRect();\n    const { clientHeight, top } = this.selection.state.viewport;\n    return Rect.fromLWTH(\n      left,\n      Math.min(width, window.innerWidth),\n      top,\n      Math.min(clientHeight, window.innerHeight)\n    );\n  }\n\n  private _initTitleVEditor() {\n    const { model } = this;\n    const title = model.title;\n\n    this._titleVEditor = new VEditor(title.yText, {\n      active: () => activeEditorManager.isActive(this),\n    });\n    this._titleVEditor.mount(this._titleContainer);\n    this._titleVEditor.bindHandlers({\n      keydown: this._onTitleKeyDown,\n      paste: this._onTitlePaste,\n    });\n\n    // Workaround for virgo skips composition event\n    this._disposables.addFromEvent(\n      this._titleContainer,\n      'compositionstart',\n      () => (this._isComposing = true)\n    );\n    this._disposables.addFromEvent(\n      this._titleContainer,\n      'compositionend',\n      () => (this._isComposing = false)\n    );\n\n    this.model.title.yText.observe(() => {\n      this._updateTitleInMeta();\n      this.requestUpdate();\n    });\n    this._titleVEditor.setReadonly(this.page.readonly);\n  }\n\n  private _updateTitleInMeta = () => {\n    this.page.workspace.setPageMeta(this.page.id, {\n      title: this.model.title.toString(),\n    });\n  };\n\n  private _onTitleKeyDown = (e: KeyboardEvent) => {\n    if (e.isComposing || this.page.readonly) return;\n    const hasContent = !this.page.isEmpty;\n    const { page, model } = this;\n    const defaultFrame = model.children.find(\n      child => child.flavour === 'affine:frame'\n    );\n\n    if (e.key === 'Enter' && hasContent) {\n      e.preventDefault();\n      assertExists(this._titleVEditor);\n      const vRange = this._titleVEditor.getVRange();\n      assertExists(vRange);\n      const right = model.title.split(vRange.index);\n      const newFirstParagraphId = page.addBlock(\n        'affine:paragraph',\n        { text: right },\n        defaultFrame,\n        0\n      );\n      asyncFocusRichText(page, newFirstParagraphId);\n      return;\n    } else if (e.key === 'ArrowDown' && hasContent) {\n      e.preventDefault();\n      const firstText = defaultFrame?.children.find(block =>\n        matchFlavours(block, ['affine:paragraph', 'affine:list', 'affine:code'])\n      );\n      if (firstText) {\n        asyncFocusRichText(page, firstText.id);\n      } else {\n        const newFirstParagraphId = page.addBlock(\n          'affine:paragraph',\n          {},\n          defaultFrame,\n          0\n        );\n        asyncFocusRichText(page, newFirstParagraphId);\n      }\n      return;\n    } else if (e.key === 'Tab') {\n      e.preventDefault();\n    }\n  };\n\n  private _onTitlePaste = (event: ClipboardEvent) => {\n    const vEditor = this._titleVEditor;\n    if (!vEditor) return;\n    const vRange = vEditor.getVRange();\n    if (!vRange) return;\n\n    const data = event.clipboardData?.getData('text/plain');\n    if (data) {\n      const text = data.replace(/(\\r\\n|\\r|\\n)/g, '\\n');\n      vEditor.insertText(vRange, text);\n      vEditor.setVRange({\n        index: vRange.index + text.length,\n        length: 0,\n      });\n    }\n  };\n\n  // TODO: disable it on scroll's threshold\n  private _onWheel = (e: WheelEvent) => {\n    const { selection } = this;\n    const { state } = selection;\n    const { type, viewport } = state;\n\n    if (type === 'native') {\n      return;\n    }\n\n    if (type.startsWith('block')) {\n      e.preventDefault();\n      const { viewportElement } = this;\n      const { scrollTop, scrollHeight, clientHeight } = viewport;\n      const max = scrollHeight - clientHeight;\n      let top = e.deltaY / 2;\n      if (top > 0) {\n        if (Math.ceil(scrollTop) === max) return;\n\n        top = Math.min(top, max - scrollTop);\n      } else if (top < 0) {\n        if (scrollTop === 0) return;\n\n        top = Math.max(top, -scrollTop);\n      }\n\n      viewport.scrollTop += top;\n      // FIXME: need smooth\n      viewportElement.scrollTop += top;\n\n      if (type === 'block') {\n        const { draggingArea } = state;\n        if (draggingArea) {\n          draggingArea.end.y += top;\n          selection.updateDraggingArea(draggingArea);\n        }\n      }\n    }\n\n    // trigger native scroll\n  };\n\n  private _onScroll = (e: Event) => {\n    const { selection } = this;\n    const { type, viewport } = selection.state;\n    const { scrollLeft, scrollTop } = e.target as Element;\n    viewport.scrollLeft = scrollLeft;\n    viewport.scrollTop = scrollTop;\n\n    if (type === 'block') {\n      selection.refreshDraggingArea(selection.state.viewportOffset);\n      return;\n    }\n\n    if (type === 'embed') {\n      selection.refreshEmbedRects(this._embedEditingState);\n      return;\n    }\n\n    let point;\n\n    if (type === 'native') {\n      point = selection.state.startRange && selection.state.lastPoint;\n    } else if (type === 'block:drag') {\n      point = selection.state.lastPoint;\n    }\n\n    if (point) {\n      // Create a synthetic `pointermove` PointerEvent\n      const evt = new PointerEvent('pointermove', {\n        clientX: point.x,\n        clientY: point.y,\n      });\n      document.dispatchEvent(evt);\n    }\n  };\n\n  override updated(changedProperties: Map<string, unknown>) {\n    if (changedProperties.has('model')) {\n      if (this.model && !this._titleVEditor) {\n        this._initTitleVEditor();\n      }\n    }\n  }\n\n  private _initDragHandle = () => {\n    const createHandle = () => {\n      this.components.dragHandle = createDragHandle(this);\n      this.components.dragHandle.getDropAllowedBlocks = draggingBlockIds => {\n        if (\n          draggingBlockIds &&\n          draggingBlockIds.length === 1 &&\n          Utils.isInsideBlockByFlavour(\n            this.page,\n            draggingBlockIds[0],\n            'affine:database'\n          )\n        ) {\n          return getAllowSelectedBlocks(\n            this.page.getParent(draggingBlockIds[0]) as BaseBlockModel\n          );\n        }\n\n        if (!draggingBlockIds || draggingBlockIds.length === 1) {\n          return getAllowSelectedBlocks(this.model);\n        } else {\n          return getAllowSelectedBlocks(this.model).filter(block => {\n            return !draggingBlockIds?.includes(block.id);\n          });\n        }\n      };\n    };\n    if (\n      this.page.awarenessStore.getFlag('enable_drag_handle') &&\n      !this.components.dragHandle\n    ) {\n      createHandle();\n    }\n    this._disposables.add(\n      this.page.awarenessStore.slots.update.subscribe(\n        msg => msg.state?.flags.enable_drag_handle,\n        enable => {\n          if (enable) {\n            if (!this.components.dragHandle) {\n              createHandle();\n            }\n          } else {\n            this.components.dragHandle?.remove();\n            this.components.dragHandle = null;\n          }\n        },\n        {\n          filter: msg => msg.id === this.page.doc.clientID,\n        }\n      )\n    );\n  };\n\n  private _initSlotEffects() {\n    const { slots } = this;\n\n    slots.draggingAreaUpdated.on(rect => {\n      this._draggingArea = rect;\n    });\n    slots.selectedRectsUpdated.on(rects => {\n      this._selectedRects = rects;\n    });\n    slots.embedRectsUpdated.on(rects => {\n      this._selectedEmbedRects = rects;\n      if (rects.length === 0) {\n        this._embedEditingState = null;\n      }\n    });\n    slots.embedEditingStateUpdated.on(embedEditingState => {\n      this._embedEditingState = embedEditingState;\n    });\n\n    this.model.childrenUpdated.on(() => this.requestUpdate());\n  }\n\n  private _initFrameSizeEffect() {\n    tryUpdateFrameSize(this.page, 1);\n    this.addEventListener('keydown', e => {\n      if (e.ctrlKey || e.metaKey || e.shiftKey) return;\n      tryUpdateFrameSize(this.page, 1);\n    });\n  }\n\n  private _initResizeEffect() {\n    const resizeObserver = new ResizeObserver(\n      (entries: ResizeObserverEntry[]) => {\n        for (const { target } of entries) {\n          if (target === this.viewportElement) {\n            this.selection.updateViewport();\n            this.selection.updateRects();\n            break;\n          }\n        }\n      }\n    );\n    resizeObserver.observe(this.viewportElement);\n    this._resizeObserver = resizeObserver;\n  }\n\n  override firstUpdated() {\n    const { page, selection } = this;\n    const scope = hotkey.newScope(HOTKEY_SCOPE_TYPE.AFFINE_PAGE);\n    if (activeEditorManager.isActive(this)) {\n      hotkey.setScope(scope);\n    }\n    this._disposables.add(\n      activeEditorManager.activeSlot.on(() => {\n        if (activeEditorManager.isActive(this)) {\n          hotkey.setScope(scope);\n        }\n      })\n    );\n    this._disposables.add(() => hotkey.deleteScope(scope));\n    hotkey.withScope(scope, () => {\n      bindHotkeys(page, selection);\n    });\n    hotkey.enableHotkey();\n\n    this._initDragHandle();\n    this._initSlotEffects();\n    this._initFrameSizeEffect();\n    this._initResizeEffect();\n\n    this.mouseRoot.addEventListener('wheel', this._onWheel);\n    this.viewportElement.addEventListener('scroll', this._onScroll);\n\n    this.setAttribute(BLOCK_ID_ATTR, this.model.id);\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    registerService('affine:page', PageBlockService);\n    this.clipboard.init(this.page);\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    this.mouseRoot = this.parentElement!;\n    this.selection = new DefaultSelectionManager({\n      page: this.page,\n      mouseRoot: this.mouseRoot,\n      slots: this.slots,\n      container: this,\n      dispatcher: this.root.uiEventDispatcher,\n    });\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.clipboard.dispose();\n    this._disposables.dispose();\n    this.components.dragHandle?.remove();\n\n    removeHotkeys();\n    this.selection.clear();\n    this.selection.dispose();\n    if (this._resizeObserver) {\n      this._resizeObserver.disconnect();\n      this._resizeObserver = null;\n    }\n    this.mouseRoot.removeEventListener('wheel', this._onWheel);\n    this.viewportElement.removeEventListener('scroll', this._onScroll);\n  }\n\n  override render() {\n    requestAnimationFrame(() => {\n      this.selection.refreshRemoteSelection();\n    });\n\n    const { page, selection } = this;\n    const { viewportOffset } = selection.state;\n\n    const draggingArea = DraggingArea(this._draggingArea);\n    const selectedEmbedContainer = EmbedSelectedRectsContainer(\n      this._selectedEmbedRects,\n      viewportOffset\n    );\n    const embedEditingContainer = EmbedEditingContainer(\n      page.readonly ? null : this._embedEditingState,\n      this.slots,\n      viewportOffset\n    );\n    const isEmpty =\n      (!this.model.title || !this.model.title.length) && !this._isComposing;\n\n    return html`\n      <div class=\"affine-default-viewport\">\n        <div class=\"affine-default-page-block-container\">\n          <div class=\"affine-default-page-block-title-container\">\n            <div\n              data-block-is-title=\"true\"\n              class=\"affine-default-page-block-title ${isEmpty\n                ? 'affine-default-page-block-title-empty'\n                : ''}\"\n            ></div>\n            <backlink-button\n              .host=\"${this}\"\n              .page=\"${this.page}\"\n            ></backlink-button>\n          </div>\n          ${this.content}\n        </div>\n        <affine-selected-blocks\n          .mouseRoot=\"${this.mouseRoot}\"\n          .state=\"${{\n            rects: this._selectedRects,\n            grab: !draggingArea,\n          }}\"\n          .offset=\"${viewportOffset}\"\n        ></affine-selected-blocks>\n        ${draggingArea} ${selectedEmbedContainer} ${embedEditingContainer}\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-default-page': DefaultPageBlockComponent;\n  }\n}\n", "import type { TemplateResult } from 'lit';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport { tooltipStyle } from '../../../components/tooltip/tooltip.js';\n\n@customElement('edgeless-tool-icon-button')\nexport class EdgelessToolIconButton extends LitElement {\n  static override styles = css`\n    .icon-container {\n      position: relative;\n      display: flex;\n      align-items: center;\n      padding: 4px;\n      color: var(--affine-icon-color);\n      margin: 8px;\n      border-radius: 5px;\n      cursor: pointer;\n    }\n\n    .icon-container:hover {\n      background: var(--affine-hover-color);\n    }\n\n    .icon-container.active-mode-color[active] {\n      color: var(--affine-primary-color);\n    }\n\n    .icon-container.active-mode-background[active] {\n      background: var(--affine-hover-color);\n    }\n\n    .icon-container[disabled] {\n      pointer-events: none;\n      cursor: not-allowed;\n    }\n\n    .icon-container[coming] {\n      cursor: not-allowed;\n      color: var(--affine-text-disable-color);\n    }\n\n    ${tooltipStyle}\n\n    tool-tip {\n      z-index: 12;\n    }\n  `;\n\n  @property()\n  disabled = false;\n\n  @property()\n  coming = false;\n\n  @property()\n  tooltip!: string | TemplateResult<1>;\n\n  @property()\n  tipPosition: 'top' | 'bottom' | 'left' | 'right' = 'top';\n\n  @property()\n  active = false;\n\n  @property()\n  activeMode: 'color' | 'background' = 'color';\n\n  constructor() {\n    super();\n\n    this.addEventListener(\n      'click',\n      event => {\n        if (this.disabled) {\n          event.stopPropagation();\n          event.preventDefault();\n        }\n      },\n      { capture: true }\n    );\n  }\n\n  override render() {\n    const tooltip = this.coming ? '(Coming soon)' : this.tooltip;\n    const classnames = `icon-container has-tool-tip active-mode-${this.activeMode}`;\n\n    return html`\n      <div\n        class=${classnames}\n        role=\"button\"\n        ?disabled=${this.disabled}\n        ?active=${this.active}\n      >\n        <slot></slot>\n        ${tooltip\n          ? html`<tool-tip\n              inert\n              role=\"tooltip\"\n              tip-position=${this.tipPosition}\n              arrow\n              >${tooltip}</tool-tip\n            >`\n          : nothing}\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-tool-icon-button': EdgelessToolIconButton;\n  }\n}\n", "import {\n  DiamondIcon,\n  EllipseIcon,\n  RoundedRectangleIcon,\n  SquareIcon,\n  TriangleIcon,\n} from '@blocksuite/global/config';\nimport type { TemplateResult } from 'lit';\n\nimport type { ShapeMouseMode } from '../../../../__internal__/index.js';\n\ntype Config = {\n  name: ShapeMouseMode['shape'];\n  icon: TemplateResult<1>;\n  tooltip: string;\n  disabled: boolean;\n};\n\nexport const ShapeComponentConfig: Config[] = [\n  {\n    name: 'rect',\n    icon: SquareIcon,\n    tooltip: 'Square',\n    disabled: false,\n  },\n  {\n    name: 'ellipse',\n    icon: EllipseIcon,\n    tooltip: 'Ellipse',\n    disabled: false,\n  },\n  {\n    name: 'diamond',\n    icon: DiamondIcon,\n    tooltip: 'Diamond',\n    disabled: false,\n  },\n  {\n    name: 'triangle',\n    icon: TriangleIcon,\n    tooltip: 'Triangle',\n    disabled: false,\n  },\n  {\n    name: 'roundedRect',\n    icon: RoundedRectangleIcon,\n    tooltip: 'Rounded rectangle',\n    disabled: false,\n  },\n];\n\nexport const ShapeComponentConfigMap = ShapeComponentConfig.reduce(\n  (acc, config) => {\n    acc[config.name] = config;\n    return acc;\n  },\n  {} as Record<Config['name'], Config>\n);\n", "import '../../components/tool-icon-button.js';\n\nimport { Slot } from '@blocksuite/store';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport type { ShapeMouseMode } from '../../../../__internal__/index.js';\nimport { ShapeComponentConfig } from './shape-menu-config.js';\n\n@customElement('edgeless-shape-menu')\nexport class EdgelessShapeMenu extends LitElement {\n  static override styles = css`\n    :host {\n      display: block;\n      z-index: 2;\n    }\n    .shape-menu-container {\n      display: flex;\n      align-items: center;\n      width: 240px;\n      height: 48px;\n      background: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-shadow-2);\n      border-radius: 8px;\n      fill: none;\n      stroke: currentColor;\n    }\n  `;\n\n  @property()\n  selectedShape?: ShapeMouseMode['shape'] | null;\n\n  slots = {\n    select: new Slot<ShapeMouseMode['shape']>(),\n  };\n\n  private _onSelect(value: ShapeMouseMode['shape']) {\n    this.selectedShape = value;\n    this.slots.select.emit(value);\n  }\n\n  override disconnectedCallback(): void {\n    this.slots.select.dispose();\n    super.disconnectedCallback();\n  }\n\n  override render() {\n    return html`\n      <div class=\"shape-menu-container\">\n        ${ShapeComponentConfig.map(({ name, icon, tooltip, disabled }) => {\n          return html`\n            <edgeless-tool-icon-button\n              .disabled=${disabled}\n              .tooltip=${tooltip}\n              .active=${this.selectedShape === name}\n              @click=${() => {\n                if (disabled) return;\n\n                this._onSelect(name);\n              }}\n            >\n              ${icon}\n            </edgeless-tool-icon-button>\n          `;\n        })}\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-shape-menu': EdgelessShapeMenu;\n  }\n}\n", "import './tool-icon-button.js';\n\nimport { css, html } from 'lit';\n\nexport const lineSizeButtonStyles = [\n  css`\n    .edgeless-component-line-size-button {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      width: 16px;\n      height: 16px;\n    }\n\n    .edgeless-component-line-size-button div {\n      border-radius: 50%;\n      background-color: var(--affine-icon-color);\n    }\n\n    .edgeless-component-line-size-button.size-s div {\n      width: 4px;\n      height: 4px;\n    }\n    .edgeless-component-line-size-button.size-l div {\n      width: 10px;\n      height: 10px;\n    }\n  `,\n];\n\nexport interface LineSizeButtonProps {\n  className?: string;\n  size: 's' | 'l';\n  active?: boolean;\n  tooltip?: string;\n  onClick: (event: MouseEvent) => void;\n}\n\nfunction getTooltip(size: LineSizeButtonProps['size']) {\n  return {\n    s: 'Thin',\n    l: 'Thick',\n  }[size];\n}\n\nexport function LineSizeButton({\n  className,\n  size,\n  active,\n  tooltip: tooltipFromProps,\n  onClick,\n}: LineSizeButtonProps) {\n  const classnames = `edgeless-component-line-size-button size-${size} ${\n    active ? 'active' : ''\n  }`;\n  const tooltip =\n    tooltipFromProps !== undefined ? tooltipFromProps : getTooltip(size);\n\n  return html`<edgeless-tool-icon-button\n    class=${className}\n    .active=${active}\n    .activeMode=${'background'}\n    .tooltip=${tooltip}\n    @click=${onClick}\n  >\n    <div class=${classnames}>\n      <div></div>\n    </div>\n  </edgeless-tool-icon-button>`;\n}\n", "import './tool-icon-button.js';\n\nimport {\n  BanIcon,\n  ConnectorLIcon,\n  DashLineIcon,\n} from '@blocksuite/global/config';\nimport { css, html } from 'lit';\n\nexport const lineStyleButtonStyles = [\n  css`\n    .edgeless-component-line-style-button {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      width: 16px;\n      height: 16px;\n      color: var(--affine-icon-color);\n    }\n  `,\n];\n\nexport interface LineStyleButtonProps {\n  className?: string;\n  mode: 'solid' | 'dash' | 'none';\n  active?: boolean;\n  tooltip?: boolean;\n  onClick: (event: MouseEvent) => void;\n}\n\nfunction getModeIcon(mode: LineStyleButtonProps['mode']) {\n  switch (mode) {\n    case 'solid': {\n      return ConnectorLIcon;\n    }\n    case 'dash': {\n      return DashLineIcon;\n    }\n    case 'none': {\n      return BanIcon;\n    }\n  }\n}\n\nfunction getModeTooltip(mode: LineStyleButtonProps['mode']) {\n  return {\n    solid: 'Solid',\n    dash: 'Dash',\n    none: 'None',\n  }[mode];\n}\n\nexport function LineStyleButton({\n  className,\n  mode,\n  active,\n  tooltip: tooltipFromProps,\n  onClick,\n}: LineStyleButtonProps) {\n  const classnames = `edgeless-component-line-style-button mode-${mode} ${\n    active ? 'active' : ''\n  }`;\n  const icon = getModeIcon(mode);\n  const tooltip =\n    tooltipFromProps !== undefined ? tooltipFromProps : getModeTooltip(mode);\n\n  return html`<edgeless-tool-icon-button\n    class=${className}\n    .active=${active}\n    .activeMode=${'background'}\n    .tooltip=${tooltip}\n    @click=${onClick}\n  >\n    <div class=${classnames}>${icon}</div>\n  </edgeless-tool-icon-button>`;\n}\n", "import { css, html, type TemplateResult } from 'lit';\n\nexport const panelWrapperStyle = [\n  css`\n    .edgeless-component-panel-wrapper {\n      display: flex;\n      padding: 4px;\n      justify-content: center;\n      align-items: center;\n      background: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-shadow-2);\n      border-radius: 8px;\n    }\n  `,\n];\n\ninterface PanelWrapperProps {\n  className?: string;\n  children: TemplateResult<1>;\n}\n\nexport function PanelWrapper({ children, className }: PanelWrapperProps) {\n  const name = `edgeless-component-panel-wrapper ${className ? className : ''}`;\n  return html`<div class=${name}>${children}</div>`;\n}\n", "import { html } from 'lit';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport {\n  LineSizeButton,\n  type LineSizeButtonProps,\n  lineSizeButtonStyles,\n} from './line-size-button.js';\nimport {\n  LineStyleButton,\n  type LineStyleButtonProps,\n  lineStyleButtonStyles,\n} from './line-style-button.js';\nimport { PanelWrapper, panelWrapperStyle } from './panel-wrapper.js';\n\nexport const lineStylesPanelStyles = [\n  panelWrapperStyle,\n  lineSizeButtonStyles,\n  lineStyleButtonStyles,\n];\n\nexport type LineStylesPanelClickedButton =\n  | {\n      type: 'size';\n      value: LineSizeButtonProps['size'];\n    }\n  | {\n      type: 'lineStyle';\n      value: LineStyleButtonProps['mode'];\n    };\n\ninterface LineStylesPanelProps {\n  onClick?: (clickedButton: LineStylesPanelClickedButton) => void;\n  selectedLineSize?: LineSizeButtonProps['size'];\n  selectedLineStyle?: LineStyleButtonProps['mode'];\n  lineStyle?: LineStyleButtonProps['mode'][];\n}\n\nexport function LineStylesPanel({\n  onClick,\n  selectedLineSize,\n  selectedLineStyle,\n  lineStyle = ['solid', 'dash', 'none'],\n}: LineStylesPanelProps = {}) {\n  const lineSizeButtons = repeat(\n    ['s', 'l'] as const,\n    size => size,\n    size => {\n      return LineSizeButton({\n        size,\n        active: size === selectedLineSize,\n        onClick: () => {\n          onClick?.({\n            type: 'size',\n            value: size,\n          });\n        },\n      });\n    }\n  );\n\n  const lineStyleButtons = repeat(\n    lineStyle,\n    mode => mode,\n    mode => {\n      return LineStyleButton({\n        mode,\n        active: mode === selectedLineStyle,\n        onClick: () => {\n          onClick?.({\n            type: 'lineStyle',\n            value: mode,\n          });\n        },\n      });\n    }\n  );\n\n  return PanelWrapper({\n    className: 'line-style-panel',\n    children: html`\n      ${lineSizeButtons}\n      <menu-divider .vertical=${true}></menu-divider>\n      ${lineStyleButtons}\n    `,\n  });\n}\n", "import '../tool-icon-button.js';\nimport '../color-panel.js';\nimport '../../toolbar/shape-tool/shape-menu.js';\n\nimport { LineStyleIcon } from '@blocksuite/global/config';\nimport { WithDisposable } from '@blocksuite/lit';\nimport {\n  type ShapeElement,\n  StrokeStyle,\n  type SurfaceManager,\n} from '@blocksuite/phasor';\nimport type { Page } from '@blocksuite/store';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\n\nimport type { CssVariableName } from '../../../../__internal__/theme/css-variables.js';\nimport { countBy, maxBy } from '../../../../__internal__/utils/std.js';\nimport type { ShapeMouseMode } from '../../../../__internal__/utils/types.js';\nimport type { EdgelessSelectionSlots } from '../../edgeless-page-block.js';\nimport type { EdgelessSelectionState } from '../../selection-manager.js';\nimport type { EdgelessShapeMenu } from '../../toolbar/shape-tool/shape-menu.js';\nimport { ShapeComponentConfigMap } from '../../toolbar/shape-tool/shape-menu-config.js';\nimport type { ColorEvent } from '../color-panel.js';\nimport { isTransparent } from '../color-panel.js';\nimport { ColorUnit } from '../color-panel.js';\nimport type { LineSizeButtonProps } from '../line-size-button.js';\nimport { lineSizeButtonStyles } from '../line-size-button.js';\nimport type { LineStyleButtonProps } from '../line-style-button.js';\nimport {\n  LineStylesPanel,\n  type LineStylesPanelClickedButton,\n  lineStylesPanelStyles,\n} from '../line-styles-panel.js';\nimport type { EdgelessToolIconButton } from '../tool-icon-button.js';\nimport { createButtonPopper } from '../utils.js';\n\nfunction getMostCommonShape(\n  elements: ShapeElement[]\n): ShapeMouseMode['shape'] | null {\n  const shapeTypes = countBy(elements, (ele: ShapeElement) => {\n    return ele.shapeType === 'rect' && ele.radius\n      ? 'roundedRect'\n      : ele.shapeType;\n  });\n  const max = maxBy(Object.entries(shapeTypes), ([k, count]) => count);\n  return max ? (max[0] as ShapeMouseMode['shape']) : null;\n}\n\nfunction getMostCommonFillColor(\n  elements: ShapeElement[]\n): ShapeMouseMode['fillColor'] | null {\n  const colors = countBy(elements, (ele: ShapeElement) => {\n    return ele.filled ? ele.fillColor : '--affine-palette-transparent';\n  });\n  const max = maxBy(Object.entries(colors), ([k, count]) => count);\n  return max ? (max[0] as ShapeMouseMode['fillColor']) : null;\n}\n\nfunction getMostCommonStrokeColor(\n  elements: ShapeElement[]\n): ShapeMouseMode['fillColor'] | null {\n  const colors = countBy(elements, (ele: ShapeElement) => {\n    return ele.strokeColor;\n  });\n  const max = maxBy(Object.entries(colors), ([k, count]) => count);\n  return max ? (max[0] as ShapeMouseMode['fillColor']) : null;\n}\n\nfunction getMostCommonLineSize(\n  elements: ShapeElement[]\n): LineSizeButtonProps['size'] | null {\n  const sizes = countBy(elements, (ele: ShapeElement) => {\n    return ele.strokeWidth === 4 ? 's' : 'l';\n  });\n  const max = maxBy(Object.entries(sizes), ([k, count]) => count);\n  return max ? (max[0] as LineSizeButtonProps['size']) : null;\n}\n\nfunction getMostCommonLineStyle(\n  elements: ShapeElement[]\n): LineStyleButtonProps['mode'] | null {\n  const sizes = countBy(elements, (ele: ShapeElement) => {\n    switch (ele.strokeStyle) {\n      case StrokeStyle.Solid: {\n        return 'solid';\n      }\n      case StrokeStyle.Dashed: {\n        return 'dash';\n      }\n      case StrokeStyle.None: {\n        return 'none';\n      }\n    }\n  });\n  const max = maxBy(Object.entries(sizes), ([k, count]) => count);\n  return max ? (max[0] as LineStyleButtonProps['mode']) : null;\n}\n\nconst FILL_COLORS: CssVariableName[] = [\n  '--affine-palette-shape-yellow',\n  '--affine-palette-shape-orange',\n  '--affine-palette-shape-tangerine',\n  '--affine-palette-shape-red',\n  '--affine-palette-shape-magenta',\n  '--affine-palette-shape-purple',\n  '--affine-palette-shape-green',\n  '--affine-palette-shape-blue',\n  '--affine-palette-shape-navy',\n  '--affine-palette-shape-black',\n  '--affine-palette-shape-white',\n  '--affine-palette-transparent',\n];\nexport const DEFAULT_SHAPE_FILL_COLOR = FILL_COLORS[11];\n\nconst STROKE_COLORS: CssVariableName[] = [\n  '--affine-palette-line-yellow',\n  '--affine-palette-line-orange',\n  '--affine-palette-line-tangerine',\n  '--affine-palette-line-red',\n  '--affine-palette-line-magenta',\n  '--affine-palette-line-purple',\n  '--affine-palette-line-green',\n  '--affine-palette-line-blue',\n  '--affine-palette-line-navy',\n  '--affine-palette-line-black',\n  '--affine-palette-line-white',\n  '--affine-palette-transparent',\n];\nexport const DEFAULT_SHAPE_STROKE_COLOR = STROKE_COLORS[9];\n\n@customElement('edgeless-change-shape-button')\nexport class EdgelessChangeShapeButton extends WithDisposable(LitElement) {\n  static override styles = [\n    lineSizeButtonStyles,\n    lineStylesPanelStyles,\n    css`\n      :host {\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        justify-content: center;\n        color: var(--affine-text-primary-color);\n        stroke: none;\n        fill: currentColor;\n      }\n\n      menu-divider {\n        height: 24px;\n      }\n\n      edgeless-shape-menu {\n        display: none;\n      }\n\n      edgeless-shape-menu[data-show] {\n        display: block;\n      }\n\n      .change-shape-button {\n        fill: none;\n        stroke: currentColor;\n      }\n\n      .color-panel-container {\n        display: none;\n        padding: 4px;\n        justify-content: center;\n        align-items: center;\n        background: var(--affine-background-overlay-panel-color);\n        box-shadow: var(--affine-shadow-2);\n        border-radius: 8px;\n      }\n\n      .color-panel-container[data-show] {\n        display: block;\n      }\n\n      .shape-color-button-indicator {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        width: 24px;\n        height: 24px;\n        box-sizing: border-box;\n        border-radius: 4px;\n        cursor: pointer;\n      }\n\n      .shape-color-button-indicator div {\n        border-radius: 50%;\n        width: 16px;\n        height: 16px;\n      }\n\n      .line-style-panel {\n        display: none;\n      }\n      .line-style-panel[data-show] {\n        display: flex;\n      }\n    `,\n  ];\n\n  @property()\n  elements: ShapeElement[] = [];\n\n  @property()\n  page!: Page;\n\n  @property()\n  surface!: SurfaceManager;\n\n  @property()\n  selectionState!: EdgelessSelectionState;\n\n  @property()\n  slots!: EdgelessSelectionSlots;\n\n  @state()\n  private _popperShow = false;\n\n  @query('.change-shape-button')\n  private _changeShapeButton!: EdgelessToolIconButton;\n  @query('edgeless-shape-menu')\n  private _shapeMenu!: EdgelessShapeMenu;\n  private _shapeMenuPopper: ReturnType<typeof createButtonPopper> | null = null;\n\n  @query('.fill-color-button')\n  private _fillColorButton!: EdgelessToolIconButton;\n  @query('.color-panel-container.fill-color')\n  private _fillColorMenu!: HTMLDivElement;\n  private _fillColorMenuPopper: ReturnType<typeof createButtonPopper> | null =\n    null;\n\n  @query('.stroke-color-button')\n  private _strokeColorButton!: EdgelessToolIconButton;\n  @query('.color-panel-container.stroke-color')\n  private _strokeColorMenu!: HTMLDivElement;\n  private _strokeColorMenuPopper: ReturnType<typeof createButtonPopper> | null =\n    null;\n\n  @query('.line-styles-button')\n  private _lineStylesButton!: EdgelessToolIconButton;\n  @query('.line-style-panel')\n  private _lineStylesPanel!: HTMLDivElement;\n  private _lineStylesPanelPopper: ReturnType<typeof createButtonPopper> | null =\n    null;\n\n  private _forceUpdateSelection() {\n    // FIXME: force update selection, because connector mode changed\n    this.slots.selectionUpdated.emit({ ...this.selectionState });\n  }\n\n  private _setShapeFillColor(color: CssVariableName) {\n    const filled = !isTransparent(color);\n    this.elements.forEach(ele => {\n      this.surface.updateElement<'shape'>(ele.id, {\n        filled,\n        fillColor: color,\n      });\n    });\n    this._forceUpdateSelection();\n  }\n\n  private _setShapeStrokeColor(color: CssVariableName) {\n    this.elements.forEach(ele => {\n      this.surface.updateElement<'shape'>(ele.id, {\n        strokeColor: color,\n      });\n    });\n    this._forceUpdateSelection();\n  }\n\n  private _setShapeStrokeWidth(strokeWidth: number) {\n    this.elements.forEach(ele => {\n      this.surface.updateElement<'shape'>(ele.id, {\n        strokeWidth,\n      });\n    });\n    this._forceUpdateSelection();\n  }\n\n  private _setShapeStrokeStyle(strokeStyle: StrokeStyle) {\n    this.elements.forEach(ele => {\n      this.surface.updateElement<'shape'>(ele.id, {\n        strokeStyle,\n      });\n    });\n    this._forceUpdateSelection();\n  }\n\n  private _setShapeStyles({ type, value }: LineStylesPanelClickedButton) {\n    if (type === 'size') {\n      const strokeWidth = value === 's' ? 4 : 10;\n      this._setShapeStrokeWidth(strokeWidth);\n    } else if (type === 'lineStyle') {\n      switch (value) {\n        case 'solid': {\n          this._setShapeStrokeStyle(StrokeStyle.Solid);\n          break;\n        }\n        case 'dash': {\n          this._setShapeStrokeStyle(StrokeStyle.Dashed);\n          break;\n        }\n        case 'none': {\n          this._setShapeStrokeStyle(StrokeStyle.None);\n          break;\n        }\n      }\n    }\n  }\n\n  override firstUpdated(changedProperties: Map<string, unknown>) {\n    const _disposables = this._disposables;\n\n    this._shapeMenuPopper = createButtonPopper(\n      this._changeShapeButton,\n      this._shapeMenu,\n      ({ display }) => {\n        this._popperShow = display === 'show';\n      }\n    );\n    _disposables.add(this._shapeMenuPopper);\n    _disposables.add(\n      this._shapeMenu.slots.select.on(shapeType => {\n        const updatedProps =\n          shapeType === 'roundedRect'\n            ? ({ shapeType: 'rect', radius: 0.1 } as const)\n            : { shapeType, radius: 0 };\n\n        this.page.captureSync();\n        this.elements.forEach(element => {\n          this.surface.updateElement<'shape'>(element.id, updatedProps);\n        });\n        this._forceUpdateSelection();\n      })\n    );\n\n    this._fillColorMenuPopper = createButtonPopper(\n      this._fillColorButton,\n      this._fillColorMenu,\n      ({ display }) => {\n        this._popperShow = display === 'show';\n      }\n    );\n    _disposables.add(this._fillColorMenuPopper);\n\n    this._strokeColorMenuPopper = createButtonPopper(\n      this._strokeColorButton,\n      this._strokeColorMenu,\n      ({ display }) => {\n        this._popperShow = display === 'show';\n      }\n    );\n    _disposables.add(this._strokeColorMenuPopper);\n\n    this._lineStylesPanelPopper = createButtonPopper(\n      this._lineStylesButton,\n      this._lineStylesPanel,\n      ({ display }) => {\n        this._popperShow = display === 'show';\n      }\n    );\n    _disposables.add(this._lineStylesPanelPopper);\n\n    super.firstUpdated(changedProperties);\n  }\n\n  override render() {\n    const selectedShape = getMostCommonShape(this.elements);\n    const icon = selectedShape\n      ? ShapeComponentConfigMap[selectedShape].icon\n      : null;\n\n    const selectedFillColor =\n      getMostCommonFillColor(this.elements) ?? FILL_COLORS[0];\n    const selectedStrokeColor =\n      getMostCommonStrokeColor(this.elements) ?? STROKE_COLORS[0];\n    const selectedLineSize = getMostCommonLineSize(this.elements) ?? 's';\n    const selectedLineStyle = getMostCommonLineStyle(this.elements) ?? 'solid';\n\n    return html`\n      <edgeless-tool-icon-button\n        class=\"change-shape-button\"\n        .tooltip=${this._popperShow ? '' : 'Switch type'}\n        .tipPosition=${'bottom'}\n        .active=${false}\n        @click=${() => this._shapeMenuPopper?.toggle()}\n      >\n        ${icon}\n      </edgeless-tool-icon-button>\n      <edgeless-shape-menu .selectedShape=${selectedShape}>\n      </edgeless-shape-menu>\n\n      <menu-divider .vertical=${true}></menu-divider>\n\n      <edgeless-tool-icon-button\n        class=\"fill-color-button\"\n        .tooltip=${this._popperShow ? '' : 'Shape color'}\n        .tipPosition=${'bottom'}\n        .active=${false}\n        @click=${() => this._fillColorMenuPopper?.toggle()}\n      >\n        ${ColorUnit(selectedFillColor)}\n      </edgeless-tool-icon-button>\n      <div class=\"color-panel-container fill-color\">\n        <edgeless-color-panel\n          .value=${selectedFillColor}\n          .options=${FILL_COLORS}\n          @select=${(e: ColorEvent) => this._setShapeFillColor(e.detail)}\n        >\n        </edgeless-color-panel>\n      </div>\n\n      <edgeless-tool-icon-button\n        class=\"stroke-color-button\"\n        .tooltip=${this._popperShow ? '' : 'Border color'}\n        .tipPosition=${'bottom'}\n        .active=${false}\n        @click=${() => this._strokeColorMenuPopper?.toggle()}\n      >\n        ${ColorUnit(selectedStrokeColor, { hollowCircle: true })}\n      </edgeless-tool-icon-button>\n      <div class=\"color-panel-container stroke-color\">\n        <edgeless-color-panel\n          .value=${selectedStrokeColor}\n          .options=${STROKE_COLORS}\n          .hollowCircle=${true}\n          @select=${(e: ColorEvent) => this._setShapeStrokeColor(e.detail)}\n        >\n        </edgeless-color-panel>\n      </div>\n\n      <menu-divider .vertical=${true}></menu-divider>\n\n      <edgeless-tool-icon-button\n        class=\"line-styles-button\"\n        .tooltip=${this._popperShow ? '' : 'Border style'}\n        .tipPosition=${'bottom'}\n        .active=${false}\n        @click=${() => this._lineStylesPanelPopper?.toggle()}\n      >\n        ${LineStyleIcon}\n      </edgeless-tool-icon-button>\n      ${LineStylesPanel({\n        selectedLineSize,\n        selectedLineStyle,\n        onClick: event => {\n          this._setShapeStyles(event);\n        },\n      })}\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-change-shape-button': EdgelessChangeShapeButton;\n  }\n}\n", "import '../tool-icon-button.js';\nimport '../color-panel.js';\n\nimport { WithDisposable } from '@blocksuite/lit';\nimport type { BrushElement, SurfaceManager } from '@blocksuite/phasor';\nimport type { Page } from '@blocksuite/store';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { CssVariableName } from '../../../../__internal__/theme/css-variables.js';\nimport { countBy, maxBy } from '../../../../__internal__/utils/std.js';\nimport { BrushSize } from '../../../../__internal__/utils/types.js';\nimport type { EdgelessSelectionSlots } from '../../edgeless-page-block.js';\nimport type { EdgelessSelectionState } from '../../selection-manager.js';\nimport type { ColorEvent, EdgelessColorPanel } from '../color-panel.js';\nimport { DEFAULT_SELECTED_COLOR } from '../color-panel.js';\nimport { createButtonPopper } from '../utils.js';\n\nfunction getMostCommonColor(elements: BrushElement[]): CssVariableName | null {\n  const shapeTypes = countBy(elements, (ele: BrushElement) => ele.color);\n  const max = maxBy(Object.entries(shapeTypes), ([k, count]) => count);\n  return max ? (max[0] as CssVariableName) : null;\n}\n\nfunction getMostCommonSize(elements: BrushElement[]): BrushSize | null {\n  const shapeTypes = countBy(elements, (ele: BrushElement) => ele.lineWidth);\n  const max = maxBy(Object.entries(shapeTypes), ([k, count]) => count);\n  return max ? (Number(max[0]) as BrushSize) : null;\n}\n\n@customElement('edgeless-change-brush-button')\nexport class EdgelessChangeBrushButton extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n      justify-content: center;\n      color: var(--affine-text-primary-color);\n      fill: currentColor;\n    }\n\n    menu-divider {\n      height: 24px;\n    }\n\n    .color-panel-container {\n      display: none;\n      padding: 4px;\n      justify-content: center;\n      align-items: center;\n      background: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-shadow-2);\n      border-radius: 8px;\n    }\n\n    .color-panel-container[data-show] {\n      display: block;\n    }\n\n    .brush-size-button {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      width: 24px;\n      height: 24px;\n      box-sizing: border-box;\n      border-radius: 4px;\n      cursor: pointer;\n    }\n\n    .brush-size-button div {\n      border-radius: 50%;\n      background-color: var(--affine-icon-color);\n    }\n\n    .brush-size-button[active] div {\n      background-color: var(--affine-blue);\n    }\n\n    .brush-size-button .thin {\n      width: 4px;\n      height: 4px;\n    }\n\n    .brush-size-button .thick {\n      width: 10px;\n      height: 10px;\n    }\n  `;\n\n  @property()\n  elements: BrushElement[] = [];\n\n  @property({ type: Object })\n  selectionState!: EdgelessSelectionState;\n\n  @property()\n  page!: Page;\n\n  @property()\n  surface!: SurfaceManager;\n\n  @property()\n  slots!: EdgelessSelectionSlots;\n\n  @state()\n  private _popperShow = false;\n\n  @query('.color-panel-container')\n  private _colorPanel!: EdgelessColorPanel;\n\n  private _colorPanelPopper: ReturnType<typeof createButtonPopper> | null =\n    null;\n\n  private _setBrushSize(size: BrushSize) {\n    this.page.captureSync();\n    this.elements.forEach(element => {\n      if (element.lineWidth !== size) {\n        this.surface.updateElement<'brush'>(element.id, { lineWidth: size });\n      }\n    });\n    // FIXME: force update selection, because brush size changed\n    this.slots.selectionUpdated.emit({ ...this.selectionState });\n  }\n\n  private _setBrushColor(color: CssVariableName) {\n    this.page.captureSync();\n    this.elements.forEach(element => {\n      if (element.color !== color) {\n        this.surface.updateElement<'brush'>(element.id, { color });\n      }\n    });\n  }\n\n  override firstUpdated(changedProperties: Map<string, unknown>) {\n    const _disposables = this._disposables;\n\n    this._colorPanelPopper = createButtonPopper(\n      this,\n      this._colorPanel,\n      ({ display }) => {\n        this._popperShow = display === 'show';\n      }\n    );\n    _disposables.add(this._colorPanelPopper);\n    super.firstUpdated(changedProperties);\n  }\n\n  override render() {\n    const selectedColor =\n      getMostCommonColor(this.elements) ?? DEFAULT_SELECTED_COLOR;\n    const style = {\n      backgroundColor: `var(${selectedColor})`,\n    };\n\n    const selectedSize = getMostCommonSize(this.elements);\n\n    return html`\n      <edgeless-tool-icon-button\n        .tooltip=${'Thin'}\n        @click=${() => this._setBrushSize(BrushSize.Thin)}\n      >\n        <div\n          class=\"brush-size-button\"\n          ?active=${selectedSize === BrushSize.Thin}\n        >\n          <div class=\"thin\"></div>\n        </div>\n      </edgeless-tool-icon-button>\n      <edgeless-tool-icon-button\n        .tooltip=${'Thick'}\n        @click=${() => this._setBrushSize(BrushSize.Thick)}\n      >\n        <div\n          class=\"brush-size-button\"\n          ?active=${selectedSize === BrushSize.Thick}\n        >\n          <div class=\"thick\"></div>\n        </div>\n      </edgeless-tool-icon-button>\n      <menu-divider .vertical=${true}></menu-divider>\n      <edgeless-tool-icon-button\n        .tooltip=${this._popperShow ? '' : 'Color'}\n        .active=${false}\n        @click=${() => this._colorPanelPopper?.toggle()}\n      >\n        <div class=\"brush-size-button\">\n          <div class=\"thick\" style=${styleMap(style)}></div>\n        </div>\n      </edgeless-tool-icon-button>\n      <div class=\"color-panel-container\">\n        <edgeless-color-panel\n          .value=${selectedColor}\n          @select=${(e: ColorEvent) => this._setBrushColor(e.detail)}\n        >\n        </edgeless-color-panel>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-change-brush-button': EdgelessChangeBrushButton;\n  }\n}\n", "import '../tool-icon-button.js';\nimport '../color-panel.js';\n\nimport {\n  ConnectorLIcon,\n  ConnectorXIcon,\n  LineStyleIcon,\n} from '@blocksuite/global/config';\nimport type { ConnectorElement, SurfaceManager } from '@blocksuite/phasor';\nimport { StrokeStyle } from '@blocksuite/phasor';\nimport { ConnectorMode } from '@blocksuite/phasor';\nimport type { Page } from '@blocksuite/store';\nimport { DisposableGroup } from '@blocksuite/store';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { CssVariableName } from '../../../../__internal__/theme/css-variables.js';\nimport { countBy, maxBy } from '../../../../__internal__/utils/std.js';\nimport type { EdgelessSelectionSlots } from '../../edgeless-page-block.js';\nimport type { EdgelessSelectionState } from '../../selection-manager.js';\nimport {\n  generateConnectorPath,\n  getConnectorAttachedInfo,\n} from '../../utils.js';\nimport type { ColorEvent, EdgelessColorPanel } from '../color-panel.js';\nimport { DEFAULT_SELECTED_COLOR } from '../color-panel.js';\nimport type { LineSizeButtonProps } from '../line-size-button.js';\nimport { lineSizeButtonStyles } from '../line-size-button.js';\nimport type { LineStyleButtonProps } from '../line-style-button.js';\nimport {\n  LineStylesPanel,\n  type LineStylesPanelClickedButton,\n  lineStylesPanelStyles,\n} from '../line-styles-panel.js';\nimport type { EdgelessToolIconButton } from '../tool-icon-button.js';\nimport { createButtonPopper } from '../utils.js';\n\nfunction getMostCommonColor(\n  elements: ConnectorElement[]\n): CssVariableName | null {\n  const colors = countBy(elements, (ele: ConnectorElement) => ele.color);\n  const max = maxBy(Object.entries(colors), ([k, count]) => count);\n  return max ? (max[0] as CssVariableName) : null;\n}\n\nfunction getMostCommonMode(elements: ConnectorElement[]): ConnectorMode | null {\n  const modes = countBy(elements, (ele: ConnectorElement) => ele.mode);\n  const max = maxBy(Object.entries(modes), ([k, count]) => count);\n  return max ? (Number(max[0]) as ConnectorMode) : null;\n}\n\nfunction getMostCommonLineWidth(\n  elements: ConnectorElement[]\n): LineSizeButtonProps['size'] | null {\n  const sizes = countBy(elements, (ele: ConnectorElement) => {\n    return ele.lineWidth === 4 ? 's' : 'l';\n  });\n  const max = maxBy(Object.entries(sizes), ([k, count]) => count);\n  return max ? (max[0] as LineSizeButtonProps['size']) : null;\n}\n\nfunction getMostCommonLineStyle(\n  elements: ConnectorElement[]\n): LineStyleButtonProps['mode'] | null {\n  const sizes = countBy(elements, (ele: ConnectorElement) => {\n    switch (ele.strokeStyle) {\n      case StrokeStyle.Solid: {\n        return 'solid';\n      }\n      case StrokeStyle.Dashed: {\n        return 'dash';\n      }\n      case StrokeStyle.None: {\n        return 'none';\n      }\n    }\n  });\n  const max = maxBy(Object.entries(sizes), ([k, count]) => count);\n  return max ? (max[0] as LineStyleButtonProps['mode']) : null;\n}\n\n@customElement('edgeless-change-connector-button')\nexport class EdgelessChangeConnectorButton extends LitElement {\n  static override styles = [\n    lineSizeButtonStyles,\n    lineStylesPanelStyles,\n    css`\n      :host {\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        justify-content: center;\n        color: var(--affine-text-primary-color);\n        fill: currentColor;\n      }\n\n      menu-divider {\n        height: 24px;\n      }\n\n      .color-panel-container {\n        display: none;\n        padding: 4px;\n        justify-content: center;\n        align-items: center;\n        background: var(--affine-background-overlay-panel-color);\n        box-shadow: var(--affine-shadow-2);\n        border-radius: 8px;\n      }\n\n      .color-panel-container[data-show] {\n        display: block;\n      }\n\n      .connector-mode-button {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        width: 24px;\n        height: 24px;\n        box-sizing: border-box;\n        border-radius: 4px;\n        cursor: pointer;\n      }\n\n      .connector-mode-button[active] {\n        background-color: var(--affine-hover-color);\n      }\n\n      .connector-color-button .color {\n        width: 16px;\n        height: 16px;\n        border-radius: 50%;\n      }\n\n      .line-style-panel {\n        display: none;\n      }\n      .line-style-panel[data-show] {\n        display: flex;\n      }\n    `,\n  ];\n\n  @property()\n  elements: ConnectorElement[] = [];\n\n  @property({ type: Object })\n  selectionState!: EdgelessSelectionState;\n\n  @property()\n  page!: Page;\n\n  @property()\n  surface!: SurfaceManager;\n\n  @property()\n  slots!: EdgelessSelectionSlots;\n\n  @query('.connector-color-button')\n  private _colorButton!: EdgelessToolIconButton;\n  @query('.color-panel-container')\n  private _colorPanel!: EdgelessColorPanel;\n  private _colorPanelPopper: ReturnType<typeof createButtonPopper> | null =\n    null;\n\n  private _disposables: DisposableGroup = new DisposableGroup();\n\n  @query('.line-styles-button')\n  private _lineStylesButton!: EdgelessToolIconButton;\n  @query('.line-style-panel')\n  private _lineStylesPanel!: HTMLDivElement;\n  private _lineStylesPanelPopper: ReturnType<typeof createButtonPopper> | null =\n    null;\n\n  private _popperShow = false;\n\n  private _forceUpdateSelection() {\n    // FIXME: force update selection, because connector mode changed\n    this.slots.selectionUpdated.emit({ ...this.selectionState });\n  }\n\n  private _setConnectorMode(mode: ConnectorMode) {\n    this.page.captureSync();\n    this.elements.forEach(element => {\n      if (element.mode !== mode) {\n        if (element.mode === ConnectorMode.Orthogonal) {\n          const controllers = [\n            element.controllers[0],\n            element.controllers[element.controllers.length - 1],\n          ].map(c => {\n            return {\n              ...c,\n              x: c.x + element.x,\n              y: c.y + element.y,\n            };\n          });\n\n          this.surface.updateElement<'connector'>(element.id, {\n            controllers,\n            mode,\n          });\n        } else {\n          const { start, end } = getConnectorAttachedInfo(\n            element,\n            this.surface,\n            this.page\n          );\n          const route = generateConnectorPath(\n            start.rect,\n            end.rect,\n            start.point,\n            end.point,\n            []\n          );\n\n          this.surface.updateElement<'connector'>(element.id, {\n            controllers: route,\n            mode,\n          });\n        }\n      }\n    });\n    this._forceUpdateSelection();\n  }\n\n  private _setConnectorColor(color: CssVariableName) {\n    this.page.captureSync();\n    this.elements.forEach(element => {\n      if (element.color !== color) {\n        this.surface.updateElement<'connector'>(element.id, { color });\n      }\n    });\n  }\n\n  private _setShapeStrokeWidth(lineWidth: number) {\n    this.elements.forEach(ele => {\n      this.surface.updateElement<'connector'>(ele.id, {\n        lineWidth,\n      });\n    });\n    this._forceUpdateSelection();\n  }\n\n  private _setShapeStrokeStyle(strokeStyle: StrokeStyle) {\n    this.elements.forEach(ele => {\n      this.surface.updateElement<'connector'>(ele.id, {\n        strokeStyle,\n      });\n    });\n    this._forceUpdateSelection();\n  }\n\n  private _setShapeStyles({ type, value }: LineStylesPanelClickedButton) {\n    if (type === 'size') {\n      const strokeWidth = value === 's' ? 4 : 10;\n      this._setShapeStrokeWidth(strokeWidth);\n    } else if (type === 'lineStyle') {\n      switch (value) {\n        case 'solid': {\n          this._setShapeStrokeStyle(StrokeStyle.Solid);\n          break;\n        }\n        case 'dash': {\n          this._setShapeStrokeStyle(StrokeStyle.Dashed);\n          break;\n        }\n        case 'none': {\n          this._setShapeStrokeStyle(StrokeStyle.None);\n          break;\n        }\n      }\n    }\n  }\n\n  override firstUpdated(changedProperties: Map<string, unknown>) {\n    const _disposables = this._disposables;\n\n    this._colorPanelPopper = createButtonPopper(\n      this._colorButton,\n      this._colorPanel\n    );\n    _disposables.add(this._colorPanelPopper);\n\n    this._lineStylesPanelPopper = createButtonPopper(\n      this._lineStylesButton,\n      this._lineStylesPanel,\n      ({ display }) => {\n        this._popperShow = display === 'show';\n      }\n    );\n    _disposables.add(this._lineStylesPanelPopper);\n\n    super.firstUpdated(changedProperties);\n  }\n\n  override render() {\n    const selectedColor =\n      getMostCommonColor(this.elements) ?? DEFAULT_SELECTED_COLOR;\n    const style = {\n      backgroundColor: `var(${selectedColor})`,\n    };\n\n    const selectedMode = getMostCommonMode(this.elements);\n    const selectedLineSize = getMostCommonLineWidth(this.elements) ?? 's';\n    const selectedLineStyle = getMostCommonLineStyle(this.elements) ?? 'solid';\n\n    return html`\n      <edgeless-tool-icon-button\n        .tooltip=${'Straight line'}\n        .tipPosition=${'bottom'}\n        @click=${() => this._setConnectorMode(ConnectorMode.Straight)}\n      >\n        <div\n          class=\"connector-mode-button\"\n          ?active=${selectedMode === ConnectorMode.Straight}\n        >\n          ${ConnectorLIcon}\n        </div>\n      </edgeless-tool-icon-button>\n      <edgeless-tool-icon-button\n        .tooltip=${'Connector'}\n        .tipPosition=${'bottom'}\n        @click=${() => this._setConnectorMode(ConnectorMode.Orthogonal)}\n      >\n        <div\n          class=\"connector-mode-button\"\n          ?active=${selectedMode === ConnectorMode.Orthogonal}\n        >\n          ${ConnectorXIcon}\n        </div>\n      </edgeless-tool-icon-button>\n      <menu-divider .vertical=${true}></menu-divider>\n      <edgeless-tool-icon-button\n        class=\"connector-color-button\"\n        .tooltip=${'Color'}\n        .tipPosition=${'bottom'}\n        .active=${false}\n        @click=${() => this._colorPanelPopper?.toggle()}\n      >\n        <div>\n          <div class=\"color\" style=${styleMap(style)}></div>\n        </div>\n      </edgeless-tool-icon-button>\n      <div class=\"color-panel-container\">\n        <edgeless-color-panel\n          .value=${selectedColor}\n          @select=${(e: ColorEvent) => this._setConnectorColor(e.detail)}\n        >\n        </edgeless-color-panel>\n      </div>\n\n      <edgeless-tool-icon-button\n        class=\"line-styles-button\"\n        .tooltip=${this._popperShow ? '' : 'Border style'}\n        .tipPosition=${'bottom'}\n        .active=${false}\n        @click=${() => this._lineStylesPanelPopper?.toggle()}\n      >\n        ${LineStyleIcon}\n      </edgeless-tool-icon-button>\n      ${LineStylesPanel({\n        selectedLineSize,\n        selectedLineStyle,\n        lineStyle: ['solid', 'dash'],\n        onClick: event => {\n          this._setShapeStyles(event);\n        },\n      })}\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-change-connector-button': EdgelessChangeConnectorButton;\n  }\n}\n", "import '../tool-icon-button.js';\nimport '../../toolbar/shape-tool/shape-menu.js';\nimport '../color-panel.js';\n\nimport { FRAME_BACKGROUND_COLORS } from '@blocksuite/global/config';\nimport { WithDisposable } from '@blocksuite/lit';\nimport type { Page } from '@blocksuite/store';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { CssVariableName } from '../../../../__internal__/theme/css-variables.js';\nimport { countBy, maxBy } from '../../../../__internal__/utils/std.js';\nimport type {\n  NoteMouseMode,\n  TopLevelBlockModel,\n} from '../../../../__internal__/utils/types.js';\nimport type { EdgelessSelectionSlots } from '../../edgeless-page-block.js';\nimport type { EdgelessSelectionState } from '../../selection-manager.js';\nimport type { ColorEvent } from '../color-panel.js';\nimport { createButtonPopper } from '../utils.js';\n\nfunction getMostCommonBackground(\n  frames: TopLevelBlockModel[]\n): NoteMouseMode['background'] | null {\n  const shapeTypes = countBy(frames, (frame: TopLevelBlockModel) => {\n    return frame.background;\n  });\n  const max = maxBy(Object.entries(shapeTypes), ([k, count]) => count);\n  return max ? (max[0] as NoteMouseMode['background']) : null;\n}\n\n@customElement('edgeless-change-frame-button')\nexport class EdgelessChangeFrameButton extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      display: block;\n      color: var(--affine-text-primary-color);\n      fill: currentColor;\n    }\n\n    edgeless-color-panel {\n      display: none;\n      width: 108px;\n      height: 68px;\n      padding: 8px 12px;\n      flex-wrap: wrap;\n      background: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-shadow-2);\n      border-radius: 8px;\n    }\n\n    edgeless-color-panel[data-show] {\n      display: flex;\n    }\n\n    .selected-background {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      text-align: center;\n      width: 16px;\n      height: 16px;\n      box-sizing: border-box;\n      border-radius: 50%;\n      color: var(--affine-text-primary-color);\n      font-size: 12px;\n    }\n  `;\n\n  @property()\n  frames: TopLevelBlockModel[] = [];\n\n  @property()\n  page!: Page;\n\n  @property()\n  selectionState!: EdgelessSelectionState;\n\n  @property()\n  slots!: EdgelessSelectionSlots;\n\n  @state()\n  private _popperShow = false;\n\n  @query('edgeless-color-panel')\n  private _colorSelector!: HTMLDivElement;\n\n  private _colorSelectorPopper: ReturnType<typeof createButtonPopper> | null =\n    null;\n\n  private _renderSelectedColor(color: CssVariableName) {\n    const style = { backgroundColor: `var(${color})` };\n\n    return html`<div class=\"selected-background\" style=${styleMap(style)}>\n      A\n    </div>`;\n  }\n\n  private _setBlockBackground(color: CssVariableName) {\n    this.frames.forEach(frame => {\n      this.page.updateBlock(frame, { background: color });\n    });\n    // FIXME: force update selection, because connector mode changed\n    this.slots.selectionUpdated.emit({ ...this.selectionState });\n  }\n\n  override firstUpdated(changedProperties: Map<string, unknown>) {\n    const _disposables = this._disposables;\n\n    this._colorSelectorPopper = createButtonPopper(\n      this,\n      this._colorSelector,\n      ({ display }) => {\n        this._popperShow = display === 'show';\n      }\n    );\n    _disposables.add(this._colorSelectorPopper);\n    super.firstUpdated(changedProperties);\n  }\n\n  override render() {\n    const selectedBackground =\n      getMostCommonBackground(this.frames) || FRAME_BACKGROUND_COLORS[0];\n\n    return html`\n      <edgeless-tool-icon-button\n        .tooltip=${this._popperShow ? '' : 'Color'}\n        .active=${false}\n        @click=${() => this._colorSelectorPopper?.toggle()}\n      >\n        ${this._renderSelectedColor(selectedBackground)}\n      </edgeless-tool-icon-button>\n      <edgeless-color-panel\n        .value=${selectedBackground}\n        .options=${FRAME_BACKGROUND_COLORS}\n        .showLetterMark=${true}\n        @select=${(event: ColorEvent) => {\n          this._setBlockBackground(event.detail);\n        }}\n      ></edgeless-color-panel>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-change-frame-button': EdgelessChangeFrameButton;\n  }\n}\n", "import '../tool-icon-button.js';\nimport '../../toolbar/shape-tool/shape-menu.js';\n\nimport { MoreHorizontalIcon } from '@blocksuite/global/config';\nimport { WithDisposable } from '@blocksuite/lit';\nimport type { SurfaceElement, SurfaceManager } from '@blocksuite/phasor';\nimport type { Page } from '@blocksuite/store';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport {\n  type ReorderingType,\n  type TopLevelBlockModel,\n} from '../../../../__internal__/index.js';\nimport type { EdgelessSelectionSlots } from '../../edgeless-page-block.js';\nimport type { Selectable } from '../../selection-manager.js';\nimport { isTopLevelBlock } from '../../utils.js';\nimport { createButtonPopper } from '../utils.js';\n\ntype Action = {\n  name: string;\n  type: 'delete' | ReorderingType;\n  disabled?: boolean;\n};\nconst ACTIONS: Action[] = [\n  // FIXME: should implement these function\n  // { name: 'Copy', type: 'copy', disabled: true },\n  // { name: 'Paste', type: 'paste', disabled: true },\n  // { name: 'Duplicate', type: 'duplicate', disabled: true },\n  { name: 'Bring to front', type: 'front' },\n  { name: 'Bring forward', type: 'forward' },\n  { name: 'Send backward', type: 'backward' },\n  { name: 'Send to back', type: 'back' },\n  // { name: 'Copy as PNG', type: 'copy as PNG', disabled: true },\n  { name: 'Delete', type: 'delete' },\n];\n\nfunction Actions(onClick: (action: Action) => void) {\n  return repeat(\n    ACTIONS,\n    action => action.type,\n    action =>\n      html`<div\n        class=\"action-item\"\n        @click=${() => onClick(action)}\n        ?data-disabled=${action.disabled}\n      >\n        ${action.name}\n      </div>`\n  );\n}\n\n@customElement('edgeless-more-button')\nexport class EdgelessMoreButton extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      display: block;\n      color: var(--affine-text-primary-color);\n      fill: currentColor;\n    }\n\n    .more-actions-container {\n      display: none;\n      width: 158px;\n      padding: 8px 4px;\n      justify-content: center;\n      align-items: center;\n      background: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-shadow-2);\n      border-radius: 8px;\n      font-size: 16px;\n      line-height: 22px;\n    }\n\n    .more-actions-container[data-show] {\n      display: block;\n    }\n\n    .action-item {\n      width: 100%;\n      height: 32px;\n      box-sizing: border-box;\n      padding: 5px 12px;\n      border-radius: 5px;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      cursor: pointer;\n    }\n\n    .action-item:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .action-item[data-disabled] {\n      cursor: not-allowed;\n    }\n  `;\n\n  @property()\n  elements: Selectable[] = [];\n\n  @property()\n  page!: Page;\n\n  @property()\n  surface!: SurfaceManager;\n\n  @property()\n  slots!: EdgelessSelectionSlots;\n\n  @state()\n  private _popperShow = false;\n\n  @query('.more-actions-container')\n  private _actionsMenu!: HTMLDivElement;\n\n  private _actionsMenuPopper: ReturnType<typeof createButtonPopper> | null =\n    null;\n\n  private _splitElements(): {\n    frames: TopLevelBlockModel[];\n    shapes: SurfaceElement[];\n  } {\n    const frames: TopLevelBlockModel[] = [];\n    const shapes: SurfaceElement[] = [];\n    this.elements.forEach(element => {\n      if (isTopLevelBlock(element)) {\n        frames.push(element);\n      } else {\n        shapes.push(element);\n      }\n    });\n    return {\n      frames,\n      shapes,\n    };\n  }\n\n  private _delete() {\n    this.page.captureSync();\n    this.elements.forEach(element => {\n      if (isTopLevelBlock(element)) {\n        const children = this.page.root?.children ?? [];\n        if (children.length > 1) {\n          this.page.deleteBlock(element);\n        }\n      } else {\n        this.surface.removeElement(element.id);\n      }\n    });\n    this.slots.selectionUpdated.emit({ selected: [], active: false });\n  }\n\n  private _runAction = ({ type }: Action) => {\n    switch (type) {\n      case 'delete':\n        this._delete();\n        break;\n      case 'front':\n      case 'forward':\n      case 'backward':\n      case 'back': {\n        const { frames, shapes } = this._splitElements();\n        if (frames.length) {\n          this.slots.reorderingFramesUpdated.emit({\n            elements: frames,\n            type,\n          });\n        }\n        if (shapes.length) {\n          this.slots.reorderingShapesUpdated.emit({\n            elements: shapes,\n            type,\n          });\n        }\n        break;\n      }\n    }\n    this._actionsMenuPopper?.hide();\n  };\n\n  override firstUpdated(changedProperties: Map<string, unknown>) {\n    const _disposables = this._disposables;\n\n    this._actionsMenuPopper = createButtonPopper(\n      this,\n      this._actionsMenu,\n      ({ display }) => {\n        this._popperShow = display === 'show';\n      }\n    );\n    _disposables.add(this._actionsMenuPopper);\n    super.firstUpdated(changedProperties);\n  }\n\n  override render() {\n    const actions = Actions(this._runAction);\n    return html`\n      <edgeless-tool-icon-button\n        .tooltip=${this._popperShow ? '' : 'More'}\n        .active=${false}\n        @click=${() => this._actionsMenuPopper?.toggle()}\n      >\n        ${MoreHorizontalIcon}\n      </edgeless-tool-icon-button>\n      <div class=\"more-actions-container\">${actions}</div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-more-button': EdgelessMoreButton;\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\n/**\n * Returns an iterable containing the values in `items` interleaved with the\n * `joiner` value.\n *\n * @example\n *\n * ```ts\n * render() {\n *   return html`\n *     ${join(items, html`<span class=\"separator\">|</span>`)}\n *   `;\n * }\n */\nexport function join<I, J>(\n  items: Iterable<I> | undefined,\n  joiner: (index: number) => J\n): Iterable<I | J>;\nexport function join<I, J>(\n  items: Iterable<I> | undefined,\n  joiner: J\n): Iterable<I | J>;\nexport function* join<I, J>(items: Iterable<I> | undefined, joiner: J) {\n  const isFunction = typeof joiner === 'function';\n  if (items !== undefined) {\n    let i = -1;\n    for (const value of items) {\n      if (i > -1) {\n        yield isFunction ? joiner(i) : joiner;\n      }\n      i++;\n      yield value;\n    }\n  }\n}\n", "import '../tool-icon-button.js';\nimport './change-shape-button.js';\nimport './change-brush-button.js';\nimport './change-connector-button.js';\nimport './change-frame-button.js';\nimport './change-text-button.js';\nimport './more-button.js';\n\nimport type {\n  BrushElement,\n  ConnectorElement,\n  ShapeElement,\n  SurfaceManager,\n  TextElement,\n} from '@blocksuite/phasor';\nimport type { Page } from '@blocksuite/store';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { join } from 'lit/directives/join.js';\n\nimport {\n  atLeastNMatches,\n  groupBy,\n} from '../../../../__internal__/utils/std.js';\nimport type { TopLevelBlockModel } from '../../../../__internal__/utils/types.js';\nimport type { EdgelessSelectionSlots } from '../../edgeless-page-block.js';\nimport type { EdgelessSelectionState } from '../../selection-manager.js';\nimport type { Selectable } from '../../selection-manager.js';\nimport { isTopLevelBlock, stopPropagation } from '../../utils.js';\n\ntype CategorizedElements = {\n  shape: ShapeElement[];\n  brush: BrushElement[];\n  frame: TopLevelBlockModel[];\n  connector: ConnectorElement[];\n  text: TextElement[];\n};\n\n@customElement('edgeless-component-toolbar')\nexport class EdgelessComponentToolbar extends LitElement {\n  static override styles = css`\n    :host {\n      display: block;\n      user-select: none;\n    }\n\n    .container {\n      display: flex;\n      align-items: center;\n      height: 48px;\n      background: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-shadow-2);\n      border-radius: 8px;\n    }\n\n    menu-divider {\n      height: 24px;\n    }\n  `;\n\n  @property()\n  selected: Selectable[] = [];\n\n  @property({ type: Object })\n  selectionState!: EdgelessSelectionState;\n\n  @property()\n  page!: Page;\n\n  @property()\n  surface!: SurfaceManager;\n\n  @property()\n  slots!: EdgelessSelectionSlots;\n\n  private _groupSelected(): CategorizedElements {\n    const result = groupBy(this.selected, s => {\n      if (isTopLevelBlock(s)) {\n        return 'frame';\n      }\n      return s.type;\n    });\n    return result as CategorizedElements;\n  }\n\n  private _getShapeButton(shapeElements?: ShapeElement[]) {\n    const shapeButton = shapeElements?.length\n      ? html`<edgeless-change-shape-button\n          .elements=${shapeElements}\n          .page=${this.page}\n          .surface=${this.surface}\n          .slots=${this.slots}\n          .selectionState=${this.selectionState}\n        >\n        </edgeless-change-shape-button>`\n      : null;\n    return shapeButton;\n  }\n\n  private _getBrushButton(brushElements?: BrushElement[]) {\n    return brushElements?.length\n      ? html`<edgeless-change-brush-button\n          .elements=${brushElements}\n          .page=${this.page}\n          .surface=${this.surface}\n          .slots=${this.slots}\n          .selectionState=${this.selectionState}\n        >\n        </edgeless-change-brush-button>`\n      : null;\n  }\n\n  private _getConnectorButton(connectorElements?: ConnectorElement[]) {\n    return connectorElements?.length\n      ? html` <edgeless-change-connector-button\n          .elements=${connectorElements}\n          .page=${this.page}\n          .surface=${this.surface}\n          .slots=${this.slots}\n          .selectionState=${this.selectionState}\n        >\n        </edgeless-change-connector-button>`\n      : null;\n  }\n\n  private _getFrameButton(blocks?: TopLevelBlockModel[]) {\n    return blocks?.length\n      ? html`<edgeless-change-frame-button\n          .frames=${blocks}\n          .page=${this.page}\n          .surface=${this.surface}\n          .slots=${this.slots}\n          .selectionState=${this.selectionState}\n        >\n        </edgeless-change-frame-button>`\n      : null;\n  }\n\n  private _getTextButton(textElements: TextElement[]) {\n    return textElements?.length\n      ? html`<edgeless-change-text-button\n          .texts=${textElements}\n          .page=${this.page}\n          .surface=${this.surface}\n          .slots=${this.slots}\n          .selectionState=${this.selectionState}\n        >\n        </edgeless-change-text-button>`\n      : null;\n  }\n\n  override render() {\n    const groupedSelected = this._groupSelected();\n    const { shape, brush, connector, frame, text } = groupedSelected;\n\n    // when selected types more than two, only show `more` button\n    const selectedAtLeastTwoTypes = atLeastNMatches(\n      Object.values(groupedSelected),\n      e => !!e.length,\n      2\n    );\n\n    const buttons = selectedAtLeastTwoTypes\n      ? []\n      : [\n          this._getShapeButton(shape),\n          this._getBrushButton(brush),\n          this._getConnectorButton(connector),\n          this._getFrameButton(frame),\n          this._getTextButton(text),\n        ].filter(b => !!b);\n\n    const divider = !buttons.length\n      ? nothing\n      : html`<menu-divider .vertical=${true}></menu-divider>`;\n    return html`<div class=\"container\" @pointerdown=${stopPropagation}>\n      ${join(buttons, () => '')} ${divider}\n      <edgeless-more-button\n        .elements=${this.selected}\n        .page=${this.page}\n        .surface=${this.surface}\n        .slots=${this.slots}\n      >\n      </edgeless-more-button>\n    </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-component-toolbar': EdgelessComponentToolbar;\n  }\n}\n", "import { html, nothing } from 'lit';\n\nexport enum HandleDirection {\n  Left = 'left',\n  Right = 'right',\n  TopLeft = 'top-left',\n  BottomLeft = 'bottom-left',\n  TopRight = 'top-right',\n  BottomRight = 'bottom-right',\n}\n\nfunction ResizeHandle(\n  handleDirection: HandleDirection,\n  onPointerDown?: (e: PointerEvent, direction: HandleDirection) => void\n) {\n  const handlerPointerDown = (e: PointerEvent) => {\n    e.stopPropagation();\n    onPointerDown && onPointerDown(e, handleDirection);\n  };\n\n  return html`<div\n    aria-label=${`handle-${handleDirection}`}\n    @pointerdown=${handlerPointerDown}\n  ></div>`;\n}\n\nexport type ResizeMode = 'corner' | 'edge' | 'none';\nexport function ResizeHandles(\n  resizeMode: ResizeMode,\n  onPointerDown: (e: PointerEvent, direction: HandleDirection) => void\n) {\n  switch (resizeMode) {\n    case 'corner': {\n      const handleTopLeft = ResizeHandle(\n        HandleDirection.TopLeft,\n        onPointerDown\n      );\n      const handleTopRight = ResizeHandle(\n        HandleDirection.TopRight,\n        onPointerDown\n      );\n      const handleBottomLeft = ResizeHandle(\n        HandleDirection.BottomLeft,\n        onPointerDown\n      );\n      const handleBottomRight = ResizeHandle(\n        HandleDirection.BottomRight,\n        onPointerDown\n      );\n\n      // prettier-ignore\n      return html`\n        ${handleTopLeft}\n        ${handleTopRight}\n        ${handleBottomLeft}\n        ${handleBottomRight}\n      `;\n    }\n    case 'edge': {\n      const handleLeft = ResizeHandle(HandleDirection.Left, onPointerDown);\n      const handleRight = ResizeHandle(HandleDirection.Right, onPointerDown);\n\n      return html`${handleLeft} ${handleRight}`;\n    }\n    case 'none': {\n      return nothing;\n    }\n  }\n}\n", "import { Bound } from '@blocksuite/phasor';\nimport { getCommonBound } from '@blocksuite/phasor';\n\nimport { HandleDirection, type ResizeMode } from './resize-handles.js';\n\ntype ResizeMoveHandler = (bounds: Map<string, Bound>) => void;\n\ntype ResizeEndHandler = () => void;\n\nexport class HandleResizeManager {\n  private _onResizeMove: ResizeMoveHandler;\n  private _onResizeEnd: ResizeEndHandler;\n\n  private _dragDirection: HandleDirection = HandleDirection.Left;\n  private _dragPos: {\n    start: { x: number; y: number };\n    end: { x: number; y: number };\n  } = {\n    start: { x: 0, y: 0 },\n    end: { x: 0, y: 0 },\n  };\n\n  private _bounds = new Map<string, Bound>();\n  /** Use [minX, minY, maxX, maxY] for convenience */\n  private _commonBound = [0, 0, 0, 0];\n\n  private _aspectRatio = 1;\n  private _resizeMode = 'none';\n  private _zoom = 1;\n\n  private _shiftKey = false;\n\n  constructor(onResizeMove: ResizeMoveHandler, onResizeEnd: ResizeEndHandler) {\n    this._onResizeMove = onResizeMove;\n    this._onResizeEnd = onResizeEnd;\n  }\n\n  // TODO: move to vec2\n  private _resize(shift = false) {\n    const {\n      _aspectRatio: aspectRatio,\n      _dragDirection: direction,\n      _dragPos: dragPos,\n      _resizeMode: resizeMode,\n      _zoom: zoom,\n      _commonBound,\n    } = this;\n\n    const isCorner = resizeMode === 'corner';\n    const { x: startX, y: startY } = dragPos.start;\n    const { x: endX, y: endY } = dragPos.end;\n\n    const deltaX = (endX - startX) / zoom;\n\n    const [oldMinX, oldMinY, oldMaxX, oldMaxY] = _commonBound;\n    const oldCommonW = oldMaxX - oldMinX;\n    const oldCommonH = oldMaxY - oldMinY;\n    let [minX, minY, maxX, maxY] = _commonBound;\n    let width = 0;\n    let height = 0;\n    let flipX = false;\n    let flipY = false;\n\n    if (isCorner) {\n      const deltaY = (endY - startY) / zoom;\n\n      switch (direction) {\n        // TODO\n        // case HandleDirection.Top: {\n        //   minY += deltaY;\n        //   break;\n        // }\n        // case HandleDirection.Right: {\n        //   maxX += deltaX;\n        //   break;\n        // }\n        // case HandleDirection.Bottom: {\n        //   maxY += deltaY;\n        //   break;\n        // }\n        // case HandleDirection.Left: {\n        //   minX += deltaX;\n        //   break;\n        // }\n        case HandleDirection.TopLeft: {\n          minX += deltaX;\n          minY += deltaY;\n          break;\n        }\n        case HandleDirection.BottomRight: {\n          maxX += deltaX;\n          maxY += deltaY;\n          break;\n        }\n        case HandleDirection.TopRight:\n          maxX += deltaX;\n          minY += deltaY;\n          break;\n        case HandleDirection.BottomLeft: {\n          minX += deltaX;\n          maxY += deltaY;\n          break;\n        }\n      }\n\n      const dw = maxX - minX;\n      const dh = maxY - minY;\n      const scaleX = dw / oldCommonW;\n      const scaleY = dh / oldCommonH;\n\n      flipX = scaleX < 0;\n      flipY = scaleY < 0;\n\n      if (shift && isCorner) {\n        const bw = Math.abs(dw);\n        const bh = Math.abs(dh);\n        const isTall = aspectRatio < bw / bh;\n        const th = (bw / aspectRatio) * (flipY ? 1 : -1);\n        const tw = bh * aspectRatio * (flipX ? 1 : -1);\n\n        switch (direction) {\n          // TODO\n          // case HandleDirection.Top: {\n          //   break;\n          // }\n          // case HandleDirection.Right: {\n          //   break;\n          // }\n          // case HandleDirection.Bottom: {\n          //   break;\n          // }\n          // case HandleDirection.Left: {\n          //   break;\n          // }\n          case HandleDirection.TopLeft: {\n            if (isTall) minY = maxY + th;\n            else minX = maxX + tw;\n            break;\n          }\n          case HandleDirection.BottomRight: {\n            if (isTall) maxY = minY - th;\n            else maxX = minX - tw;\n            break;\n          }\n          case HandleDirection.TopRight:\n            if (isTall) minY = maxY + th;\n            else maxX = minX - tw;\n            break;\n          case HandleDirection.BottomLeft: {\n            if (isTall) maxY = minY - th;\n            else minX = maxX + tw;\n            break;\n          }\n        }\n      }\n    } else {\n      switch (direction) {\n        case HandleDirection.Left:\n          minX += deltaX;\n          break;\n        case HandleDirection.Right:\n          maxX += deltaX;\n          break;\n      }\n\n      flipX = maxX < minX;\n    }\n\n    if (flipX) {\n      const t = maxX;\n      maxX = minX;\n      minX = t;\n    }\n\n    if (flipY) {\n      const t = maxY;\n      maxY = minY;\n      minY = t;\n    }\n\n    width = Math.abs(maxX - minX);\n    height = Math.abs(maxY - minY);\n\n    const newCommonBound = {\n      x: minX,\n      y: minY,\n      w: width,\n      h: height,\n    };\n\n    const newBounds = new Map<string, Bound>();\n\n    this._bounds.forEach((bound, id) => {\n      const { x: oldX, y: oldY, w: oldW, h: oldH } = bound;\n\n      const nx = (flipX ? oldMaxX - oldX - oldW : oldX - oldMinX) / oldCommonW;\n      const ny = (flipY ? oldMaxY - oldY - oldH : oldY - oldMinY) / oldCommonH;\n\n      const shapeX = newCommonBound.w * nx + newCommonBound.x;\n      const shapeY = newCommonBound.h * ny + newCommonBound.y;\n      const shapeW = newCommonBound.w * (oldW / oldCommonW);\n      const shapeH = newCommonBound.h * (oldH / oldCommonH);\n\n      newBounds.set(id, new Bound(shapeX, shapeY, shapeW, shapeH));\n    });\n    this._onResizeMove(newBounds);\n  }\n\n  onPointerDown = (\n    e: PointerEvent,\n    direction: HandleDirection,\n    bounds: Map<string, Bound>,\n    resizeMode: ResizeMode,\n    zoom: number\n  ) => {\n    // Prevent selection action from being triggered\n    e.stopPropagation();\n\n    this._bounds = bounds;\n\n    const { x, y, w, h } = getCommonBound([...bounds.values()]) as Bound;\n    this._commonBound = [x, y, x + w, y + h];\n\n    this._dragDirection = direction;\n    this._dragPos.start = { x: e.x, y: e.y };\n    this._dragPos.end = { x: e.x, y: e.y };\n    this._aspectRatio = w / h;\n    this._resizeMode = resizeMode;\n    this._zoom = zoom;\n\n    const _onPointerMove = (e: PointerEvent) => {\n      if (resizeMode === 'none') return;\n\n      this._shiftKey ||= e.shiftKey;\n      this._dragPos.end = { x: e.x, y: e.y };\n\n      this._resize(this._shiftKey);\n    };\n\n    const _onPointerUp = (_: PointerEvent) => {\n      this._onResizeEnd();\n\n      this._bounds.clear();\n      this._dragPos = { start: { x: 0, y: 0 }, end: { x: 0, y: 0 } };\n      this._commonBound = [0, 0, 0, 0];\n\n      document.removeEventListener('pointermove', _onPointerMove);\n      document.removeEventListener('pointerup', _onPointerUp);\n    };\n    document.addEventListener('pointermove', _onPointerMove);\n    document.addEventListener('pointerup', _onPointerUp);\n  };\n\n  onPressShiftKey(pressed: boolean) {\n    if (this._shiftKey === pressed) return;\n\n    this._shiftKey = pressed;\n    this._resize(pressed);\n  }\n}\n", "import type { Point } from '@blocksuite/connector';\nimport { Rectangle, simplifyPath } from '@blocksuite/connector';\nimport type {\n  ConnectorElement,\n  Controller,\n  SurfaceManager,\n} from '@blocksuite/phasor';\nimport { ConnectorMode } from '@blocksuite/phasor';\nimport { deserializeXYWH } from '@blocksuite/phasor';\nimport type { Page } from '@blocksuite/store';\nimport { html } from 'lit';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport {\n  generateConnectorPath,\n  getAttachedPoint,\n  getConnectorAttachedInfo,\n  getXYWH,\n  pickBy,\n} from '../utils.js';\n\nfunction capPointerdown(\n  event: PointerEvent,\n  surface: SurfaceManager,\n  page: Page,\n  element: ConnectorElement,\n  position: 'start' | 'end',\n  connectorMode: ConnectorMode,\n  requestUpdate: () => void\n) {\n  const startX = event.clientX;\n  const startY = event.clientY;\n\n  const originControllers = element.controllers.map(c => ({\n    ...c,\n    x: c.x + element.x,\n    y: c.y + element.y,\n  }));\n\n  const anchorPoint =\n    position === 'start'\n      ? originControllers[0]\n      : originControllers[originControllers.length - 1];\n\n  const elementX = anchorPoint.x;\n  const elementY = anchorPoint.y;\n\n  const pointermove = (mousePointerEvent: PointerEvent) => {\n    const { clientX, clientY } = mousePointerEvent;\n    const deltaX = clientX - startX;\n    const deltaY = clientY - startY;\n    const { zoom } = surface.viewport;\n    const modelX = elementX + deltaX / zoom;\n    const modelY = elementY + deltaY / zoom;\n    const [x, y] = surface.toViewCoord(modelX, modelY);\n\n    const { start, end } = getConnectorAttachedInfo(element, surface, page);\n\n    const picked = pickBy(\n      surface,\n      page,\n      x,\n      y,\n      ele => ele.id !== element.id && ele.type !== 'connector'\n    );\n    const newRect = picked\n      ? new Rectangle(...deserializeXYWH(getXYWH(picked)))\n      : null;\n\n    const { point: newPoint, position: attachedPointPosition } =\n      getAttachedPoint(modelX, modelY, newRect);\n\n    let routes: Point[];\n    if (position === 'start') {\n      routes = generateConnectorPath(\n        newRect,\n        end.rect,\n        newPoint,\n        end.point,\n        originControllers,\n        connectorMode,\n        'end'\n      );\n    } else {\n      routes = generateConnectorPath(\n        start.rect,\n        newRect,\n        start.point,\n        newPoint,\n        originControllers,\n        connectorMode,\n        'start'\n      );\n    }\n\n    if (position === 'start') {\n      surface.updateElement<'connector'>(element.id, {\n        controllers: routes,\n        startElement:\n          picked && attachedPointPosition\n            ? { id: picked.id, position: attachedPointPosition }\n            : undefined,\n      });\n    } else {\n      surface.updateElement<'connector'>(element.id, {\n        controllers: routes,\n        endElement:\n          picked && attachedPointPosition\n            ? { id: picked.id, position: attachedPointPosition }\n            : undefined,\n      });\n    }\n\n    requestUpdate();\n  };\n\n  const pointerup = () => {\n    document.removeEventListener('pointermove', pointermove);\n    document.removeEventListener('pointerup', pointerup);\n  };\n\n  document.addEventListener('pointermove', pointermove);\n  document.addEventListener('pointerup', pointerup);\n}\n\ntype Handle = {\n  x: number;\n  y: number;\n  position: number;\n  isVertical: boolean;\n};\n\nfunction getControllerHandles(controllers: Controller[]) {\n  const handles: Handle[] = [];\n\n  for (let i = 0; i < controllers.length - 1; i++) {\n    const current = controllers[i];\n    const next = controllers[i + 1];\n    const isVertical = current.x === next.x;\n    const handle = isVertical\n      ? {\n          x: current.x,\n          y: (current.y + next.y) / 2,\n          position: i,\n          isVertical,\n        }\n      : {\n          x: (current.x + next.x) / 2,\n          y: current.y,\n          position: i,\n          isVertical,\n        };\n    handles.push(handle);\n  }\n\n  return handles;\n}\n\nfunction centerControllerPointerdown(\n  event: PointerEvent,\n  surface: SurfaceManager,\n  page: Page,\n  element: ConnectorElement,\n  handle: Handle,\n  requestUpdate: () => void\n) {\n  const startX = event.clientX;\n  const startY = event.clientY;\n  const { controllers, x, y } = element;\n\n  const pointermove = (pointerMoveEvent: PointerEvent) => {\n    const { isVertical, position } = handle;\n    const { zoom } = surface.viewport;\n\n    const absoluteControllers = controllers.map(c => ({\n      ...c,\n      x: c.x + x,\n      y: c.y + y,\n    }));\n\n    const deltaX = isVertical ? pointerMoveEvent.clientX - startX : 0;\n    const deltaY = isVertical ? 0 : pointerMoveEvent.clientY - startY;\n\n    const point0 = absoluteControllers[position];\n    const newPoint0 = {\n      x: point0.x + deltaX / zoom,\n      y: point0.y + deltaY / zoom,\n      customized: true,\n    };\n    const point1 = absoluteControllers[position + 1];\n    const newPoint1 = {\n      x: point1.x + deltaX / zoom,\n      y: point1.y + deltaY / zoom,\n      customized: true,\n    };\n\n    if (position === 0) {\n      // start\n      absoluteControllers.splice(position + 1, 0, newPoint0);\n      absoluteControllers[position + 2] = newPoint1;\n    } else if (position === absoluteControllers.length - 2) {\n      // end\n      absoluteControllers[position] = newPoint0;\n      absoluteControllers.splice(position + 1, 0, newPoint1);\n    } else {\n      absoluteControllers[position] = newPoint0;\n      absoluteControllers[position + 1] = newPoint1;\n    }\n\n    surface.updateElement<'connector'>(element.id, {\n      controllers: simplifyPath(absoluteControllers),\n    });\n\n    requestUpdate();\n  };\n  const pointerup = (pointerUpEvent: PointerEvent) => {\n    document.removeEventListener('pointermove', pointermove);\n    document.removeEventListener('pointerup', pointerup);\n  };\n  document.addEventListener('pointermove', pointermove);\n  document.addEventListener('pointerup', pointerup);\n}\n\nexport function SingleConnectorHandles(\n  element: ConnectorElement,\n  surface: SurfaceManager,\n  page: Page,\n  requestUpdate: () => void\n) {\n  const { controllers, mode } = element;\n  const controllerHandles =\n    mode === ConnectorMode.Orthogonal ? getControllerHandles(controllers) : [];\n  const zoom = surface.viewport.zoom;\n  const start = {\n    position: 'absolute',\n    left: `${controllers[0].x * zoom}px`,\n    top: `${controllers[0].y * zoom}px`,\n  };\n  const end = {\n    position: 'absolute',\n    left: `${controllers[controllers.length - 1].x * zoom}px`,\n    top: `${controllers[controllers.length - 1].y * zoom}px`,\n  };\n  return html`\n    <style>\n      .line-controller {\n        position: absolute;\n        width: 9px;\n        height: 9px;\n        box-sizing: border-box;\n        border-radius: 50%;\n        border: 2px solid var(--affine-text-emphasis-color);\n        background-color: var(--affine-background-primary-color);\n        transform: translate(-50%, -50%);\n        cursor: pointer;\n        z-index: 10;\n        pointer-events: all;\n        /**\n         * Fix: pointerEvent stops firing after a short time.\n         * When a gesture is started, the browser intersects the touch-action values of the touched element and its ancestors,\n         * up to the one that implements the gesture (in other words, the first containing scrolling element)\n         * https://developer.mozilla.org/en-US/docs/Web/CSS/touch-action\n         */\n        touch-action: none;\n      }\n    </style>\n    <div\n      class=\"line-controller line-start\"\n      style=${styleMap(start)}\n      @pointerdown=${(e: PointerEvent) => {\n        e.stopPropagation();\n        capPointerdown(e, surface, page, element, 'start', mode, requestUpdate);\n      }}\n    ></div>\n    <div\n      class=\"line-controller line-end\"\n      style=${styleMap(end)}\n      @pointerdown=${(e: PointerEvent) => {\n        e.stopPropagation();\n        capPointerdown(e, surface, page, element, 'end', mode, requestUpdate);\n      }}\n    ></div>\n    ${repeat(\n      controllerHandles,\n      c => Math.random(),\n      c => {\n        const style = {\n          left: `${c.x * zoom}px`,\n          top: `${c.y * zoom}px`,\n          cursor: c.isVertical ? 'col-resize' : 'row-resize',\n        };\n        return html`<div\n          class=\"line-controller\"\n          style=${styleMap(style)}\n          @pointerdown=${(e: PointerEvent) => {\n            e.stopPropagation();\n            centerControllerPointerdown(\n              e,\n              surface,\n              page,\n              element,\n              c,\n              requestUpdate\n            );\n          }}\n        ></div>`;\n      }\n    )}\n  `;\n}\n", "import './component-toolbar/component-toolbar.js';\n\nimport { WithDisposable } from '@blocksuite/lit';\nimport type { Bound } from '@blocksuite/phasor';\nimport {\n  type ConnectorElement,\n  serializeXYWH,\n  TextElement,\n} from '@blocksuite/phasor';\nimport { deserializeXYWH, SurfaceManager } from '@blocksuite/phasor';\nimport { Page } from '@blocksuite/store';\nimport type { Instance as PopperInstance } from '@popperjs/core';\nimport { createPopper } from '@popperjs/core';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { EdgelessSelectionSlots } from '../edgeless-page-block.js';\nimport type {\n  EdgelessSelectionState,\n  Selectable,\n} from '../selection-manager.js';\nimport {\n  FRAME_MIN_HEIGHT,\n  FRAME_MIN_WIDTH,\n  handleElementChangedEffectForConnector,\n  isTopLevelBlock,\n  stopPropagation,\n} from '../utils.js';\nimport type { EdgelessComponentToolbar } from './component-toolbar/component-toolbar.js';\nimport type { HandleDirection } from './resize-handles.js';\nimport { ResizeHandles, type ResizeMode } from './resize-handles.js';\nimport { HandleResizeManager } from './resize-manager.js';\nimport { SingleConnectorHandles } from './single-connector-handles.js';\nimport {\n  getCommonRectStyle,\n  getSelectableBounds,\n  getSelectedRect,\n} from './utils.js';\n\n@customElement('edgeless-selected-rect')\nexport class EdgelessSelectedRect extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      display: block;\n      user-select: none;\n    }\n\n    .affine-edgeless-selected-rect {\n      position: absolute;\n      border-radius: 0;\n      pointer-events: none;\n      box-sizing: border-box;\n      z-index: 1;\n      border: var(--affine-border-width) solid var(--affine-blue);\n    }\n\n    .affine-edgeless-selected-rect > [aria-label^='handle'] {\n      position: absolute;\n      width: 12px;\n      height: 12px;\n      box-sizing: border-box;\n      border-radius: 6px;\n      z-index: 10;\n      border: 2px var(--affine-blue) solid;\n      background: white;\n      pointer-events: auto;\n      user-select: none;\n      outline: none;\n\n      /**\n       * Fix: pointerEvent stops firing after a short time.\n       * When a gesture is started, the browser intersects the touch-action values of the touched element and its ancestors,\n       * up to the one that implements the gesture (in other words, the first containing scrolling element)\n       * https://developer.mozilla.org/en-US/docs/Web/CSS/touch-action\n       */\n      touchaction: none;\n    }\n\n    :host([disabled='true'])\n      .affine-edgeless-selected-rect\n      > [aria-label^='handle'] {\n      pointer-events: none;\n    }\n\n    .affine-edgeless-selected-rect > [aria-label='handle-top-left'] {\n      cursor: nwse-resize;\n      left: -6px;\n      top: -6px;\n    }\n\n    .affine-edgeless-selected-rect > [aria-label='handle-top-right'] {\n      cursor: nesw-resize;\n      top: -6px;\n      right: -6px;\n    }\n\n    .affine-edgeless-selected-rect > [aria-label='handle-bottom-right'] {\n      cursor: nwse-resize;\n      right: -6px;\n      bottom: -6px;\n    }\n\n    .affine-edgeless-selected-rect > [aria-label='handle-bottom-left'] {\n      cursor: nesw-resize;\n      bottom: -6px;\n      left: -6px;\n    }\n\n    .affine-edgeless-selected-rect > [aria-label='handle-left'],\n    .affine-edgeless-selected-rect > [aria-label='handle-right'] {\n      cursor: ew-resize;\n      top: 0;\n      bottom: 0;\n      height: 100%;\n      width: 6px;\n      border: 0;\n      background: transparent;\n    }\n\n    .affine-edgeless-selected-rect > [aria-label='handle-left'] {\n      left: -3.5px;\n    }\n\n    .affine-edgeless-selected-rect > [aria-label='handle-right'] {\n      right: -3.5px;\n    }\n\n    .affine-edgeless-selected-rect > [aria-label='handle-left']:after,\n    .affine-edgeless-selected-rect > [aria-label='handle-right']:after {\n      position: absolute;\n      width: 12px;\n      height: 12px;\n      box-sizing: border-box;\n      border-radius: 6px;\n      z-index: 10;\n      border: 2px var(--affine-blue) solid;\n      content: '';\n      top: calc(50% - 6px);\n      background: white;\n    }\n\n    .affine-edgeless-selected-rect > [aria-label='handle-left']:after {\n      left: -3px;\n    }\n\n    .affine-edgeless-selected-rect > [aria-label='handle-right']:after {\n      right: -3px;\n    }\n\n    edgeless-component-toolbar {\n      /* greater than handle */\n      z-index: 11;\n    }\n  `;\n\n  @property({ type: Page })\n  page!: Page;\n\n  @property({ type: SurfaceManager })\n  surface!: SurfaceManager;\n\n  @property({ type: Object })\n  state!: EdgelessSelectionState;\n\n  @property()\n  slots!: EdgelessSelectionSlots;\n\n  @query('.affine-edgeless-selected-rect')\n  private _selectedRect!: HTMLDivElement;\n\n  @query('edgeless-component-toolbar')\n  private _componentToolbar?: EdgelessComponentToolbar;\n\n  private _componentToolbarPopper: PopperInstance | null = null;\n\n  private _lock = false;\n  private _resizeManager: HandleResizeManager;\n\n  constructor() {\n    super();\n    this._resizeManager = new HandleResizeManager(\n      this._onDragMove,\n      this._onDragEnd\n    );\n    this.addEventListener('pointerdown', stopPropagation);\n  }\n\n  get zoom() {\n    return this.surface.viewport.zoom;\n  }\n\n  get resizeMode(): ResizeMode {\n    if (\n      this.state.selected.length === 1 &&\n      this.state.selected[0].type === 'connector'\n    ) {\n      return 'none';\n    }\n    const hasBlockElement = this.state.selected.find(elem =>\n      isTopLevelBlock(elem)\n    );\n    return hasBlockElement ? 'edge' : 'corner';\n  }\n\n  private _onDragMove = (newBounds: Map<string, Bound>) => {\n    const { page, state, surface } = this;\n    const selectedMap = new Map<string, Selectable>(\n      state.selected.map(element => [element.id, element])\n    );\n\n    newBounds.forEach((bound, id) => {\n      const element = selectedMap.get(id);\n      if (!element) return;\n\n      if (isTopLevelBlock(element)) {\n        let frameX = bound.x;\n        let frameY = bound.y;\n        let frameW = bound.w;\n        let frameH = deserializeXYWH(element.xywh)[3];\n        // Limit the width of the selected frame\n        if (frameW < FRAME_MIN_WIDTH) {\n          frameW = FRAME_MIN_WIDTH;\n          frameX = bound.x;\n        }\n        // Limit the height of the selected frame\n        if (frameH < FRAME_MIN_HEIGHT) {\n          frameH = FRAME_MIN_HEIGHT;\n          frameY = bound.y;\n        }\n        page.updateBlock(element, {\n          xywh: JSON.stringify([frameX, frameY, frameW, frameH]),\n        });\n      } else {\n        if (element instanceof TextElement) {\n          const p = bound.h / element.h;\n          bound.w = element.w * p;\n          surface.updateElement<'text'>(id, {\n            xywh: serializeXYWH(bound.x, bound.y, bound.w, bound.h),\n            fontSize: element.fontSize * p,\n          });\n        } else {\n          surface.setElementBound(element.id, bound);\n        }\n      }\n      handleElementChangedEffectForConnector(element, [element], surface, page);\n    });\n\n    this.requestUpdate();\n  };\n\n  private _onDragEnd = () => {\n    if (this._lock) {\n      this.page.captureSync();\n    }\n    this._lock = false;\n  };\n\n  override firstUpdated() {\n    const { _disposables, slots } = this;\n    _disposables.add(slots.viewportUpdated.on(() => this.requestUpdate()));\n    _disposables.add(\n      slots.pressShiftKeyUpdated.on(pressed =>\n        this._resizeManager.onPressShiftKey(pressed)\n      )\n    );\n\n    this._componentToolbarPopper = this._componentToolbar\n      ? createPopper(this._selectedRect, this._componentToolbar, {\n          placement: 'top',\n          modifiers: [\n            {\n              name: 'offset',\n              options: {\n                offset: [0, 12],\n              },\n            },\n            {\n              name: 'flip',\n              options: {\n                fallbackPlacements: ['bottom'],\n              },\n            },\n          ],\n        })\n      : null;\n    _disposables.add(() => this._componentToolbarPopper?.destroy());\n\n    if (this._componentToolbar) {\n      // This hook is not waiting all children updated.\n      // But children effect popper position. So we use ResizeObserver watching sizing change.\n      const resizeObserver = new ResizeObserver(() =>\n        this._componentToolbarPopper?.update()\n      );\n      resizeObserver.observe(this._componentToolbar);\n      _disposables.add(() => resizeObserver.disconnect());\n    }\n  }\n\n  override updated(changedProperties: Map<string, unknown>) {\n    // when viewport updates, popper should update too.\n    this._componentToolbarPopper?.update();\n    super.updated(changedProperties);\n  }\n\n  override render() {\n    const { state } = this;\n    const { active, selected } = state;\n    if (\n      selected.length === 0 ||\n      (active && selected[0] instanceof TextElement)\n    ) {\n      return nothing;\n    }\n\n    const { page, surface, resizeMode, _resizeManager } = this;\n    const selectedRect = getSelectedRect(selected, surface.viewport);\n\n    const style = getCommonRectStyle(selectedRect, active, true);\n\n    const hasResizeHandles = !active && !page.readonly;\n    const resizeHandles = hasResizeHandles\n      ? ResizeHandles(\n          resizeMode,\n          (e: PointerEvent, direction: HandleDirection) => {\n            const bounds = getSelectableBounds(selected);\n            _resizeManager.onPointerDown(\n              e,\n              direction,\n              bounds,\n              resizeMode,\n              this.zoom\n            );\n          }\n        )\n      : nothing;\n\n    const connectorHandles =\n      selected.length === 1 && selected[0].type === 'connector'\n        ? SingleConnectorHandles(\n            selected[0] as ConnectorElement,\n            this.surface,\n            this.page,\n            () => {\n              this.slots.selectionUpdated.emit({ ...state });\n            }\n          )\n        : nothing;\n\n    const componentToolbar = active\n      ? nothing\n      : html`<edgeless-component-toolbar\n          .selected=${selected}\n          .page=${this.page}\n          .surface=${this.surface}\n          .slots=${this.slots}\n          .selectionState=${state}\n        >\n        </edgeless-component-toolbar>`;\n\n    return html`\n      <div class=\"affine-edgeless-selected-rect\" style=${styleMap(style)}>\n        ${resizeHandles} ${connectorHandles}\n      </div>\n      ${componentToolbar}\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-selected-rect': EdgelessSelectedRect;\n  }\n}\n", "import '../../components/tool-icon-button.js';\nimport './shape-menu.js';\n\nimport { ShapeIcon } from '@blocksuite/global/config';\nimport { WithDisposable } from '@blocksuite/lit';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\n\nimport type { MouseMode } from '../../../../__internal__/index.js';\nimport {\n  DEFAULT_SHAPE_FILL_COLOR,\n  DEFAULT_SHAPE_STROKE_COLOR,\n} from '../../components/component-toolbar/change-shape-button.js';\nimport { createButtonPopper } from '../../components/utils.js';\nimport { getTooltipWithShortcut } from '../../components/utils.js';\nimport type { EdgelessPageBlockComponent } from '../../edgeless-page-block.js';\nimport type { EdgelessShapeMenu } from './shape-menu.js';\n\n@customElement('edgeless-shape-tool-button')\nexport class EdgelessShapeToolButton extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      display: flex;\n    }\n\n    edgeless-shape-menu {\n      display: none;\n    }\n\n    edgeless-shape-menu[data-show] {\n      display: block;\n    }\n  `;\n\n  @property()\n  mouseMode!: MouseMode;\n\n  @property()\n  edgeless!: EdgelessPageBlockComponent;\n\n  @property()\n  setMouseMode!: (mouseMode: MouseMode) => void;\n\n  @state()\n  private _popperShow = false;\n\n  @query('edgeless-shape-menu')\n  private _shapeMenu!: EdgelessShapeMenu;\n\n  private _shapeMenuPopper: ReturnType<typeof createButtonPopper> | null = null;\n\n  private _toggleShapeMenu() {\n    this._shapeMenuPopper?.toggle();\n  }\n\n  override firstUpdated(changedProperties: Map<string, unknown>) {\n    const _disposables = this._disposables;\n\n    this._shapeMenuPopper = createButtonPopper(\n      this,\n      this._shapeMenu,\n      ({ display }) => {\n        this._popperShow = display === 'show';\n      }\n    );\n    _disposables.add(this._shapeMenuPopper);\n    _disposables.add(\n      this._shapeMenu.slots.select.on(shape => {\n        this.setMouseMode({\n          type: 'shape',\n          shape,\n          fillColor: DEFAULT_SHAPE_FILL_COLOR,\n          strokeColor: DEFAULT_SHAPE_STROKE_COLOR,\n        });\n      })\n    );\n    super.firstUpdated(changedProperties);\n  }\n\n  override disconnectedCallback() {\n    this._disposables?.dispose();\n    super.disconnectedCallback();\n  }\n\n  override render() {\n    const type = this.mouseMode?.type;\n    const selectedShape = type === 'shape' ? this.mouseMode.shape : undefined;\n\n    return html`\n      <edgeless-tool-icon-button\n        .tooltip=${this._popperShow ? '' : getTooltipWithShortcut('Shape', 'S')}\n        .active=${type === 'shape'}\n        @click=${() => {\n          this.setMouseMode({\n            type: 'shape',\n            shape: 'rect',\n            fillColor: DEFAULT_SHAPE_FILL_COLOR,\n            strokeColor: DEFAULT_SHAPE_STROKE_COLOR,\n          });\n          this._toggleShapeMenu();\n        }}\n      >\n        ${ShapeIcon}\n      </edgeless-tool-icon-button>\n      <edgeless-shape-menu .selectedShape=${selectedShape}>\n      </edgeless-shape-menu>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-shape-tool-button': EdgelessShapeToolButton;\n  }\n}\n", "import '../../components/color-panel.js';\nimport '../../components/tool-icon-button.js';\n\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport type { MouseMode } from '../../../../__internal__/index.js';\nimport { BrushSize } from '../../../../__internal__/index.js';\nimport type { CssVariableName } from '../../../../__internal__/theme/css-variables.js';\nimport { tooltipStyle } from '../../../../components/tooltip/tooltip.js';\nimport type { ColorEvent } from '../../components/color-panel.js';\nimport type { EdgelessPageBlockComponent } from '../../edgeless-page-block.js';\n\nfunction BrushSizeButtonGroup(\n  mouseMode: MouseMode,\n  setBrushWidth: (size: BrushSize) => void\n) {\n  if (mouseMode.type !== 'brush') return nothing;\n\n  const { lineWidth } = mouseMode;\n  /**\n   * There is little hacky on rendering tooltip.\n   * We don't want either tooltip overlap the top button or tooltip on left.\n   * So we put the lower button's tooltip as the first element of the button group container\n   */\n  return html`\n    <div class=\"brush-size-button-group has-tool-tip\">\n      <!-- This tooltip is for the last button(Thick) -->\n      <tool-tip inert role=\"tooltip\" tip-position=\"top\" arrow>Thick</tool-tip>\n\n      <div\n        class=\"brush-size-button has-tool-tip\"\n        ?active=${lineWidth === BrushSize.Thin}\n        @click=${() => setBrushWidth(BrushSize.Thin)}\n      >\n        <div class=\"thin\"></div>\n        <tool-tip inert role=\"tooltip\" tip-position=\"top\" arrow>\n          Thin\n        </tool-tip>\n      </div>\n\n      <div\n        class=\"brush-size-button\"\n        ?active=${lineWidth === BrushSize.Thick}\n        @click=${() => setBrushWidth(BrushSize.Thick)}\n      >\n        <div class=\"thick\"></div>\n      </div>\n    </div>\n  `;\n}\n\n@customElement('edgeless-brush-menu')\nexport class EdgelessBrushMenu extends LitElement {\n  static override styles = css`\n    :host {\n      width: 260px;\n      z-index: 1;\n    }\n    .container {\n      display: flex;\n      padding: 4px;\n      justify-content: center;\n      align-items: center;\n      background: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-shadow-2);\n      border-radius: 8px;\n    }\n\n    .brush-size-button-group {\n      display: flex;\n      flex-direction: column;\n    }\n\n    .brush-size-button {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      width: 32px;\n      height: 32px;\n      box-sizing: border-box;\n      border-radius: 4px;\n      cursor: pointer;\n    }\n\n    .brush-size-button[active],\n    .brush-size-button:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .brush-size-button div {\n      border-radius: 50%;\n      background-color: var(--affine-icon-color);\n    }\n\n    .brush-size-button .thin {\n      width: 4px;\n      height: 4px;\n    }\n\n    .brush-size-button .thick {\n      width: 10px;\n      height: 10px;\n    }\n\n    menu-divider {\n      height: 62px;\n    }\n\n    ${tooltipStyle}\n  `;\n\n  @property()\n  mouseMode!: MouseMode;\n\n  @property()\n  edgeless!: EdgelessPageBlockComponent;\n\n  private _setBrushColor = (color: CssVariableName) => {\n    if (this.mouseMode.type !== 'brush') return;\n\n    const { lineWidth } = this.mouseMode;\n    this.edgeless.slots.mouseModeUpdated.emit({\n      type: 'brush',\n      color,\n      lineWidth,\n    });\n  };\n\n  private _setBrushWidth = (lineWidth: BrushSize) => {\n    if (this.mouseMode.type !== 'brush') return;\n\n    const { color } = this.mouseMode;\n    this.edgeless.slots.mouseModeUpdated.emit({\n      type: 'brush',\n      color,\n      lineWidth,\n    });\n  };\n\n  override render() {\n    if (this.mouseMode.type !== 'brush') return nothing;\n\n    const { color } = this.mouseMode;\n    const brushSizeButtonGroup = BrushSizeButtonGroup(\n      this.mouseMode,\n      this._setBrushWidth\n    );\n\n    return html`\n      <div class=\"container\">\n        ${brushSizeButtonGroup}\n        <menu-divider .vertical=${true}></menu-divider>\n        <edgeless-color-panel\n          .value=${color}\n          @select=${(e: ColorEvent) => this._setBrushColor(e.detail)}\n        ></edgeless-color-panel>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-brush-menu': EdgelessBrushMenu;\n  }\n}\n", "import '../../components/tool-icon-button.js';\nimport './brush-menu.js';\n\nimport { PenIcon } from '@blocksuite/global/config';\nimport { assertExists } from '@blocksuite/store';\nimport { createPopper } from '@popperjs/core';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\n\nimport type { MouseMode } from '../../../../__internal__/index.js';\nimport { DEFAULT_SELECTED_COLOR } from '../../components/color-panel.js';\nimport { getTooltipWithShortcut } from '../../components/utils.js';\nimport type { EdgelessPageBlockComponent } from '../../edgeless-page-block.js';\nimport type { EdgelessBrushMenu } from './brush-menu.js';\n\ninterface BrushMenuPopper {\n  element: EdgelessBrushMenu;\n  dispose: () => void;\n}\n\nfunction createBrushMenuPopper(reference: HTMLElement): BrushMenuPopper {\n  const brushMenu = document.createElement('edgeless-brush-menu');\n  assertExists(reference.shadowRoot);\n  reference.shadowRoot.appendChild(brushMenu);\n  const popper = createPopper(reference, brushMenu, {\n    placement: 'top',\n    modifiers: [\n      {\n        name: 'offset',\n        options: {\n          offset: [0, 12],\n        },\n      },\n    ],\n  });\n\n  return {\n    element: brushMenu,\n    dispose: () => {\n      brushMenu.remove();\n      popper.destroy();\n    },\n  };\n}\n\n@customElement('edgeless-brush-tool-button')\nexport class EdgelessBrushToolButton extends LitElement {\n  static override styles = css`\n    :host {\n      display: flex;\n    }\n  `;\n\n  @property()\n  mouseMode!: MouseMode;\n\n  @property()\n  edgeless!: EdgelessPageBlockComponent;\n\n  @property()\n  setMouseMode!: (mouseMode: MouseMode) => void;\n\n  @state()\n  private _popperShow = false;\n\n  private _brushMenu: BrushMenuPopper | null = null;\n\n  private _toggleBrushMenu() {\n    if (this._brushMenu) {\n      this._brushMenu.dispose();\n      this._brushMenu = null;\n      this._popperShow = false;\n    } else {\n      this._brushMenu = createBrushMenuPopper(this);\n      this._brushMenu.element.mouseMode = this.mouseMode;\n      this._brushMenu.element.edgeless = this.edgeless;\n      this._popperShow = true;\n    }\n  }\n\n  override updated(changedProperties: Map<string, unknown>) {\n    if (changedProperties.has('mouseMode')) {\n      if (this.mouseMode.type !== 'brush') {\n        this._brushMenu?.dispose();\n        this._brushMenu = null;\n      }\n      if (this._brushMenu) {\n        this._brushMenu.element.mouseMode = this.mouseMode;\n        this._brushMenu.element.edgeless = this.edgeless;\n      }\n    }\n  }\n\n  override disconnectedCallback() {\n    this._brushMenu?.dispose();\n    this._brushMenu = null;\n    super.disconnectedCallback();\n  }\n\n  override render() {\n    const type = this.mouseMode?.type;\n\n    return html`\n      <edgeless-tool-icon-button\n        .tooltip=${this._popperShow ? '' : getTooltipWithShortcut('Pen', 'P')}\n        .active=${type === 'brush'}\n        @click=${() => {\n          this.setMouseMode({\n            type: 'brush',\n            lineWidth: 4,\n            color: DEFAULT_SELECTED_COLOR,\n          });\n          this._toggleBrushMenu();\n        }}\n      >\n        ${PenIcon}\n      </edgeless-tool-icon-button>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-brush-tool-button': EdgelessBrushToolButton;\n  }\n}\n", "import '../../components/color-panel.js';\nimport '../../components/tool-icon-button.js';\n\nimport { ConnectorLIcon, ConnectorXIcon } from '@blocksuite/global/config';\nimport { ConnectorMode } from '@blocksuite/phasor';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport type { MouseMode } from '../../../../__internal__/index.js';\nimport type { CssVariableName } from '../../../../__internal__/theme/css-variables.js';\nimport { tooltipStyle } from '../../../../components/tooltip/tooltip.js';\nimport type { ColorEvent } from '../../components/color-panel.js';\nimport { getTooltipWithShortcut } from '../../components/utils.js';\nimport type { EdgelessPageBlockComponent } from '../../edgeless-page-block.js';\n\nfunction ConnectorModeButtonGroup(\n  mouseMode: MouseMode,\n  setConnectorMode: (mode: ConnectorMode) => void\n) {\n  if (mouseMode.type !== 'connector') return nothing;\n\n  const { mode } = mouseMode;\n  const straightLineTooltip = getTooltipWithShortcut('Straight line', 'L');\n  const orthogonalTooltip = getTooltipWithShortcut('Connector', 'X');\n  /**\n   * There is little hacky on rendering tooltip.\n   * We don't want either tooltip overlap the top button or tooltip on left.\n   * So we put the lower button's tooltip as the first element of the button group container\n   */\n  return html`\n    <div class=\"connector-mode-button-group has-tool-tip\">\n      <!-- This tooltip is for the last button(Thick) -->\n      <tool-tip inert role=\"tooltip\" tip-position=\"top\" arrow>\n        ${orthogonalTooltip}\n      </tool-tip>\n\n      <div\n        class=\"connector-mode-button has-tool-tip\"\n        ?active=${mode === ConnectorMode.Straight}\n        @click=${() => setConnectorMode(ConnectorMode.Straight)}\n      >\n        ${ConnectorLIcon}\n        <tool-tip inert role=\"tooltip\" tip-position=\"top\" arrow>\n          ${straightLineTooltip}\n        </tool-tip>\n      </div>\n\n      <div\n        class=\"connector-mode-button\"\n        ?active=${mode === ConnectorMode.Orthogonal}\n        @click=${() => setConnectorMode(ConnectorMode.Orthogonal)}\n      >\n        ${ConnectorXIcon}\n      </div>\n    </div>\n  `;\n}\n\n@customElement('edgeless-connector-menu')\nexport class EdgelessConnectorMenu extends LitElement {\n  static override styles = css`\n    :host {\n      width: 260px;\n      z-index: 1;\n    }\n    .container {\n      display: flex;\n      padding: 4px;\n      justify-content: center;\n      align-items: center;\n      background: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-shadow-2);\n      border-radius: 8px;\n    }\n\n    .connector-mode-button-group {\n      display: flex;\n      flex-direction: column;\n    }\n\n    .connector-mode-button {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      width: 32px;\n      height: 32px;\n      box-sizing: border-box;\n      border-radius: 4px;\n      cursor: pointer;\n    }\n\n    .connector-mode-button[active],\n    .connector-mode-button:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .connector-mode-button div {\n      border-radius: 50%;\n      background-color: var(--affine-icon-color);\n    }\n\n    menu-divider {\n      height: 62px;\n    }\n\n    ${tooltipStyle}\n  `;\n\n  @property()\n  mouseMode!: MouseMode;\n\n  @property()\n  edgeless!: EdgelessPageBlockComponent;\n\n  private _setConnectorColor = (color: CssVariableName) => {\n    if (this.mouseMode.type !== 'connector') return;\n\n    const { mode } = this.mouseMode;\n    this.edgeless.slots.mouseModeUpdated.emit({\n      type: 'connector',\n      color,\n      mode,\n    });\n  };\n\n  private _setConnectorMode = (mode: ConnectorMode) => {\n    if (this.mouseMode.type !== 'connector') return;\n\n    const { color } = this.mouseMode;\n    this.edgeless.slots.mouseModeUpdated.emit({\n      type: 'connector',\n      color,\n      mode,\n    });\n  };\n\n  override render() {\n    if (this.mouseMode.type !== 'connector') return nothing;\n\n    const { color } = this.mouseMode;\n    const brushSizeButtonGroup = ConnectorModeButtonGroup(\n      this.mouseMode,\n      this._setConnectorMode\n    );\n\n    return html`\n      <div class=\"container\">\n        ${brushSizeButtonGroup}\n        <menu-divider .vertical=${true}></menu-divider>\n        <edgeless-color-panel\n          .value=${color}\n          @select=${(e: ColorEvent) => this._setConnectorColor(e.detail)}\n        ></edgeless-color-panel>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-connector-menu': EdgelessConnectorMenu;\n  }\n}\n", "import '../../components/tool-icon-button.js';\nimport './connector-menu.js';\n\nimport { ConnectorIcon } from '@blocksuite/global/config';\nimport { ConnectorMode } from '@blocksuite/phasor';\nimport { assertExists } from '@blocksuite/store';\nimport { createPopper } from '@popperjs/core';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport type { MouseMode } from '../../../../__internal__/index.js';\nimport { DEFAULT_SELECTED_COLOR } from '../../components/color-panel.js';\nimport type { EdgelessPageBlockComponent } from '../../edgeless-page-block.js';\nimport type { EdgelessConnectorMenu } from './connector-menu.js';\n\ninterface ConnectorMenuPopper {\n  element: EdgelessConnectorMenu;\n  dispose: () => void;\n}\n\nfunction createConnectorMenuPopper(\n  reference: HTMLElement\n): ConnectorMenuPopper {\n  const menu = document.createElement('edgeless-connector-menu');\n  assertExists(reference.shadowRoot);\n  reference.shadowRoot.appendChild(menu);\n  const popper = createPopper(reference, menu, {\n    placement: 'top',\n    modifiers: [\n      {\n        name: 'offset',\n        options: {\n          offset: [0, 12],\n        },\n      },\n    ],\n  });\n\n  return {\n    element: menu,\n    dispose: () => {\n      menu.remove();\n      popper.destroy();\n    },\n  };\n}\n\n@customElement('edgeless-connector-tool-button')\nexport class EdgelessConnectorToolButton extends LitElement {\n  static override styles = css`\n    :host {\n      display: flex;\n    }\n  `;\n\n  @property()\n  mouseMode!: MouseMode;\n\n  @property()\n  edgeless!: EdgelessPageBlockComponent;\n\n  @property()\n  setMouseMode!: (mouseMode: MouseMode) => void;\n\n  private _menu: ConnectorMenuPopper | null = null;\n\n  private _toggleMenu() {\n    if (this._menu) {\n      this._menu.dispose();\n      this._menu = null;\n    } else {\n      this._menu = createConnectorMenuPopper(this);\n      this._menu.element.mouseMode = this.mouseMode;\n      this._menu.element.edgeless = this.edgeless;\n    }\n  }\n\n  override updated(changedProperties: Map<string, unknown>) {\n    if (changedProperties.has('mouseMode')) {\n      if (this.mouseMode.type !== 'connector') {\n        this._menu?.dispose();\n        this._menu = null;\n      }\n      if (this._menu) {\n        this._menu.element.mouseMode = this.mouseMode;\n        this._menu.element.edgeless = this.edgeless;\n      }\n    }\n  }\n\n  override disconnectedCallback() {\n    this._menu?.dispose();\n    this._menu = null;\n    super.disconnectedCallback();\n  }\n\n  override render() {\n    const type = this.mouseMode?.type;\n\n    return html`\n      <edgeless-tool-icon-button\n        .tooltip=${'Connector'}\n        .active=${type === 'connector'}\n        @click=${() => {\n          this.setMouseMode({\n            type: 'connector',\n            mode: ConnectorMode.Orthogonal,\n            color: DEFAULT_SELECTED_COLOR,\n          });\n          this._toggleMenu();\n        }}\n      >\n        ${ConnectorIcon}\n      </edgeless-tool-icon-button>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-connector-tool-button': EdgelessConnectorToolButton;\n  }\n}\n", "import '../components/tool-icon-button.js';\nimport './shape-tool/shape-tool-button.js';\nimport './brush-tool/brush-tool-button.js';\nimport './connector-tool/connector-tool-button.js';\n\nimport {\n  FRAME_BACKGROUND_COLORS,\n  HandIcon,\n  ImageIcon,\n  MinusIcon,\n  NoteIcon,\n  PlusIcon,\n  SelectIcon,\n  TextIconLarge,\n  ViewBarIcon,\n} from '@blocksuite/global/config';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { WithDisposable } from '@blocksuite/lit';\nimport {\n  Bound,\n  deserializeXYWH,\n  getCommonBound,\n  ZOOM_MAX,\n  ZOOM_MIN,\n  ZOOM_STEP,\n} from '@blocksuite/phasor';\nimport { css, html, LitElement } from 'lit';\nimport { customElement } from 'lit/decorators.js';\n\nimport {\n  clamp,\n  type MouseMode,\n  Point,\n  uploadImageFromLocal,\n} from '../../../__internal__/index.js';\nimport { getTooltipWithShortcut } from '../components/utils.js';\nimport type { EdgelessPageBlockComponent } from '../edgeless-page-block.js';\nimport { stopPropagation } from '../utils.js';\n\nconst FIT_TO_SCREEN_PADDING = 200;\n\nexport type ZoomAction = 'fit' | 'out' | 'reset' | 'in';\n\n@customElement('edgeless-toolbar')\nexport class EdgelessToolbar extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      position: absolute;\n      z-index: 2;\n      bottom: 28px;\n      left: calc(50%);\n      display: flex;\n      justify-content: center;\n      transform: translateX(-50%);\n      user-select: none;\n    }\n\n    .edgeless-toolbar-container {\n      display: flex;\n      align-items: center;\n      height: 48px;\n      background: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-shadow-2);\n      border-radius: 8px;\n      fill: currentcolor;\n    }\n\n    .edgeless-toolbar-container[level='second'] {\n      position: absolute;\n      bottom: 8px;\n      transform: translateY(-100%);\n    }\n\n    .edgeless-toolbar-container[hidden] {\n      display: none;\n    }\n\n    .divider {\n      width: 1px;\n      height: 24px;\n      margin: 0 7px;\n      background-color: var(--affine-border-color);\n    }\n\n    .zoom-percent {\n      display: block;\n      box-sizing: border-box;\n      width: 48px;\n      height: 32px;\n      line-height: 22px;\n      padding: 5px;\n      border-radius: 5px;\n      font-size: 14px;\n      font-weight: 500;\n      text-align: center;\n      cursor: pointer;\n      color: var(--affine-icon-color);\n    }\n\n    .zoom-percent:hover {\n      color: var(--affine-primary-color);\n      background-color: var(--affine-hover-color);\n    }\n  `;\n\n  edgeless: EdgelessPageBlockComponent;\n\n  constructor(edgeless: EdgelessPageBlockComponent) {\n    super();\n    this.edgeless = edgeless;\n  }\n\n  get mouseMode() {\n    return this.edgeless.mouseMode;\n  }\n\n  get zoom() {\n    return this.edgeless.surface.viewport.zoom;\n  }\n\n  private _imageLoading = false;\n  private _rafId: number | null = null;\n\n  private _setCenter(x: number, y: number) {\n    this.edgeless.surface.viewport.setCenter(x, y);\n    this.edgeless.slots.viewportUpdated.emit();\n  }\n\n  private _setZoom(zoom: number, focusPoint?: Point) {\n    this.edgeless.surface.viewport.setZoom(zoom, focusPoint);\n    this.edgeless.slots.viewportUpdated.emit();\n  }\n\n  private _setZoomByStep(step: number) {\n    this._smoothZoom(clamp(this.zoom + step, ZOOM_MIN, ZOOM_MAX));\n  }\n\n  private _smoothZoom(zoom: number, focusPoint?: Point) {\n    const delta = zoom - this.zoom;\n\n    const innerSmoothZoom = () => {\n      if (this._rafId) cancelAnimationFrame(this._rafId);\n      this._rafId = requestAnimationFrame(() => {\n        const sign = delta > 0 ? 1 : -1;\n        const total = 10;\n        const step = delta / total;\n        const nextZoom = this._cutoff(this.zoom + step, zoom, sign);\n\n        this._setZoom(nextZoom, focusPoint);\n        if (nextZoom != zoom) innerSmoothZoom();\n      });\n    };\n    innerSmoothZoom();\n  }\n\n  private _cutoff(value: number, ref: number, sign: number) {\n    if (sign > 0 && value > ref) return ref;\n    if (sign < 0 && value < ref) return ref;\n    return value;\n  }\n\n  private _zoomToFit() {\n    const bounds = [];\n\n    const frame = this.edgeless.frames[0];\n    if (frame) {\n      const frameXYWH = deserializeXYWH(frame.xywh);\n      const frameBound = new Bound(...frameXYWH);\n      bounds.push(frameBound);\n    }\n\n    const surfaceElementsBound = this.edgeless.surface.getElementsBound();\n    if (surfaceElementsBound) {\n      bounds.push(surfaceElementsBound);\n    }\n\n    const { viewport } = this.edgeless.surface;\n    let { centerX, centerY, zoom } = viewport;\n\n    if (bounds.length) {\n      const { width, height } = viewport;\n      const bound = getCommonBound(bounds);\n      assertExists(bound);\n\n      zoom = Math.min(\n        (width - FIT_TO_SCREEN_PADDING) / bound.w,\n        (height - FIT_TO_SCREEN_PADDING) / bound.h\n      );\n\n      centerX = bound.x + bound.w / 2;\n      centerY = bound.y + bound.h / 2;\n    } else {\n      zoom = 1;\n    }\n    const preZoom = this.zoom;\n    const newZoom = zoom;\n    const cofficient = preZoom / newZoom;\n    if (cofficient === 1) {\n      this._smoothTranslate(centerX, centerY);\n    } else {\n      const center = viewport.center;\n      const newCenter = new Point(centerX, centerY);\n      const focusPoint = newCenter\n        .subtract(center.scale(cofficient))\n        .scale(1 / (1 - cofficient));\n      this._smoothZoom(zoom, focusPoint);\n    }\n  }\n\n  private _smoothTranslate(x: number, y: number) {\n    const { viewport } = this.edgeless.surface;\n    const delta = { x: x - viewport.centerX, y: y - viewport.centerY };\n    const innerSmoothTranslate = () => {\n      if (this._rafId) cancelAnimationFrame(this._rafId);\n      this._rafId = requestAnimationFrame(() => {\n        const rate = 10;\n        const step = { x: delta.x / rate, y: delta.y / rate };\n        const nextCenter = {\n          x: viewport.centerX + step.x,\n          y: viewport.centerY + step.y,\n        };\n        const signX = delta.x > 0 ? 1 : -1;\n        const signY = delta.y > 0 ? 1 : -1;\n        nextCenter.x = this._cutoff(nextCenter.x, x, signX);\n        nextCenter.y = this._cutoff(nextCenter.y, y, signY);\n        this._setCenter(nextCenter.x, nextCenter.y);\n        if (nextCenter.x != x || nextCenter.y != y) innerSmoothTranslate();\n      });\n    };\n    innerSmoothTranslate();\n  }\n\n  private async _addImage() {\n    this._imageLoading = true;\n    const options = {\n      width: 0,\n      height: 0,\n      offsetX: 0,\n      offsetY: 0,\n    };\n\n    const models = await uploadImageFromLocal(this.edgeless.page, realSize =>\n      Object.assign(options, realSize)\n    );\n\n    const { left, width, top, height } =\n      this.edgeless.pageBlockContainer.getBoundingClientRect();\n\n    if (options.width && options.height) {\n      const s = width / height;\n      const sh = height > 100 ? height - 100 : height;\n      const p = options.width / options.height;\n      if (s >= 1) {\n        options.height =\n          options.height > sh ? sh : Math.min(options.height, sh);\n        options.width = p * options.height;\n      } else {\n        const sw = sh * s;\n        options.width = options.width > sw ? sw : Math.min(options.width, sw);\n        options.height = options.width / p;\n      }\n    }\n\n    const { zoom } = this.edgeless.surface.viewport;\n    const centerX = left + width / 2;\n    const centerY = top + height / 2;\n    let x = 0;\n    let y = 0;\n    if (zoom > 1) {\n      x = centerX - options.width / 2;\n      y = centerY - options.height / 2;\n      options.width /= zoom;\n      options.height /= zoom;\n    } else {\n      x = centerX - (options.width * zoom) / 2;\n      y = centerY - (options.height * zoom) / 2;\n    }\n\n    const { frameId } = this.edgeless.addNewFrame(\n      models,\n      new Point(x, y),\n      options\n    );\n    const frame = this.edgeless.frames.find(frame => frame.id === frameId);\n    assertExists(frame);\n\n    this.edgeless.selection.switchToDefaultMode({\n      selected: [frame],\n      active: false,\n    });\n\n    this._imageLoading = false;\n  }\n\n  setMouseMode = (mouseMode: MouseMode) => {\n    this.edgeless.selection.setMouseMode(mouseMode);\n  };\n\n  setZoomByAction(action: ZoomAction) {\n    switch (action) {\n      case 'fit':\n        this._zoomToFit();\n        break;\n      case 'reset':\n        this._smoothZoom(1.0);\n        break;\n      case 'in':\n      case 'out':\n        this._setZoomByStep(ZOOM_STEP * (action === 'in' ? 1 : -1));\n    }\n  }\n\n  override firstUpdated() {\n    const {\n      _disposables,\n      edgeless: { slots },\n    } = this;\n    _disposables.add(slots.mouseModeUpdated.on(() => this.requestUpdate()));\n    _disposables.add(slots.viewportUpdated.on(() => this.requestUpdate()));\n  }\n\n  override render() {\n    const { type } = this.mouseMode;\n    const formattedZoom = `${Math.round(this.zoom * 100)}%`;\n\n    return html`\n      <div\n        class=\"edgeless-toolbar-container\"\n        @dblclick=${stopPropagation}\n        @mousedown=${stopPropagation}\n        @mouseup=${stopPropagation}\n        @pointerdown=${stopPropagation}\n      >\n        <edgeless-tool-icon-button\n          .tooltip=${getTooltipWithShortcut('Select', 'V')}\n          .active=${type === 'default'}\n          @click=${() => this.setMouseMode({ type: 'default' })}\n        >\n          ${SelectIcon}\n        </edgeless-tool-icon-button>\n        <edgeless-tool-icon-button\n          .tooltip=${getTooltipWithShortcut('Text', 'T')}\n          .active=${type === 'text'}\n          @click=${() => this.setMouseMode({ type: 'text' })}\n        >\n          ${TextIconLarge}\n        </edgeless-tool-icon-button>\n        <edgeless-shape-tool-button\n          .mouseMode=${this.mouseMode}\n          .edgeless=${this.edgeless}\n          .setMouseMode=${this.setMouseMode}\n        ></edgeless-shape-tool-button>\n        <edgeless-tool-icon-button\n          .disabled=${this._imageLoading}\n          .tooltip=${'Image'}\n          @click=${() => this._addImage()}\n        >\n          ${ImageIcon}\n        </edgeless-tool-icon-button>\n        <edgeless-connector-tool-button\n          .mouseMode=${this.mouseMode}\n          .edgeless=${this.edgeless}\n          .setMouseMode=${this.setMouseMode}\n        ></edgeless-connector-tool-button>\n        <edgeless-brush-tool-button\n          .mouseMode=${this.mouseMode}\n          .edgeless=${this.edgeless}\n          .setMouseMode=${this.setMouseMode}\n        ></edgeless-brush-tool-button>\n        <edgeless-tool-icon-button\n          .tooltip=${getTooltipWithShortcut('Hand', 'H')}\n          .active=${type === 'pan'}\n          @click=${() => this.setMouseMode({ type: 'pan', panning: false })}\n        >\n          ${HandIcon}\n        </edgeless-tool-icon-button>\n        <edgeless-tool-icon-button\n          .tooltip=${getTooltipWithShortcut('Note', 'N')}\n          .active=${type === 'note'}\n          @click=${() =>\n            this.setMouseMode({\n              type: 'note',\n              background: FRAME_BACKGROUND_COLORS[0],\n            })}\n        >\n          ${NoteIcon}\n        </edgeless-tool-icon-button>\n        <div class=\"divider\"></div>\n        <edgeless-tool-icon-button\n          .tooltip=${'Fit to screen'}\n          @click=${() => this._zoomToFit()}\n        >\n          ${ViewBarIcon}\n        </edgeless-tool-icon-button>\n        <edgeless-tool-icon-button\n          .tooltip=${'Zoom out'}\n          @click=${() => this._setZoomByStep(-ZOOM_STEP)}\n        >\n          ${MinusIcon}\n        </edgeless-tool-icon-button>\n        <span class=\"zoom-percent\" @click=${() => this._smoothZoom(1)}>\n          ${formattedZoom}\n        </span>\n        <edgeless-tool-icon-button\n          .tooltip=${'Zoom in'}\n          @click=${() => this._setZoomByStep(ZOOM_STEP)}\n        >\n          ${PlusIcon}\n        </edgeless-tool-icon-button>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-toolbar': EdgelessToolbar;\n  }\n}\n", "import { assertExists } from '@blocksuite/store';\n\nimport { capitalize, uncapitalize } from '../utils/std.js';\nimport type { CssVariableName, CssVariablesMap } from './css-variables.js';\nimport type { ThemeObserver } from './theme-observer.js';\n\n/**\n * Usage:\n * cssNameToJsName('--affine-theme-mode');  // affineThemeMode\n */\nexport function cssNameToJsName(cssName: string) {\n  const upper = cssName\n    .split('-')\n    .filter(s => !!s)\n    .map(s => capitalize(s))\n    .join('');\n  return uncapitalize(upper);\n}\n\nfunction getClosestEditorContainer(element: Element) {\n  const container = element.closest(\n    'editor-container'\n  ) as unknown as Element & {\n    themeObserver: ThemeObserver;\n  };\n  assertExists(container);\n  return container;\n}\n\nexport function listenToThemeChange(\n  currentELement: Element,\n  callback: (cssVariables: CssVariablesMap) => void\n) {\n  const container = getClosestEditorContainer(currentELement);\n  return container.themeObserver.on(callback);\n}\n\nexport function getThemePropertyValue(\n  currentELement: Element,\n  name: CssVariableName\n) {\n  const container = getClosestEditorContainer(currentELement);\n  return container.themeObserver.cssVariables?.[name];\n}\n", "import {\n  EDGELESS_BLOCK_CHILD_PADDING,\n  FRAME_BACKGROUND_COLORS,\n} from '@blocksuite/global/config';\nimport { deserializeXYWH } from '@blocksuite/phasor';\nimport type { TemplateResult } from 'lit';\nimport { html, nothing } from 'lit';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { TopLevelBlockModel } from '../../../index.js';\n\nfunction EdgelessMask() {\n  const style = {\n    position: 'absolute',\n    top: '0',\n    left: '0',\n    bottom: '0',\n    right: '0',\n    zIndex: '1',\n  };\n  return html`\n    <div class=\"affine-edgeless-mask\" style=${styleMap(style)}></div>\n  `;\n}\n\nfunction EdgelessBlockChild(\n  index: number,\n  model: TopLevelBlockModel,\n  active: boolean,\n  renderer: (model: TopLevelBlockModel) => TemplateResult\n) {\n  const { xywh, background } = model;\n  const [modelX, modelY, modelW, modelH] = deserializeXYWH(xywh);\n\n  const style = {\n    position: 'absolute',\n    transform: `translate(${modelX}px, ${modelY}px)`,\n    transformOrigin: '0 0',\n    width: modelW + 'px',\n    height: modelH + 'px',\n    padding: `${EDGELESS_BLOCK_CHILD_PADDING}px`,\n    background: `var(${background || FRAME_BACKGROUND_COLORS[0]})`,\n    pointerEvents: 'all',\n    zIndex: `${index}`,\n    boxSizing: 'border-box',\n    borderRadius: '8px',\n    border: '2px solid var(--affine-white-10)',\n    boxShadow: 'var(--affine-shadow-3)',\n  };\n\n  const mask = active ? nothing : EdgelessMask();\n\n  return html`\n    <div class=\"affine-edgeless-block-child\" style=${styleMap(style)}>\n      ${renderer(model)} ${mask}\n    </div>\n  `;\n}\n\nexport function EdgelessBlockChildrenContainer(\n  frames: TopLevelBlockModel[],\n  active: boolean,\n  renderer: (model: TopLevelBlockModel) => TemplateResult\n) {\n  return html`\n    ${repeat(\n      frames,\n      child => child.id,\n      (child, index) => EdgelessBlockChild(index, child, active, renderer)\n    )}\n  `;\n}\n", "import { html } from 'lit';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nexport function EdgelessDraggingArea(rect: DOMRect | null) {\n  if (rect === null) return html``;\n\n  const style = {\n    left: rect.left + 'px',\n    top: rect.top + 'px',\n    width: rect.width + 'px',\n    height: rect.height + 'px',\n  };\n  return html`\n    <style>\n      .affine-edgeless-dragging-area {\n        position: absolute;\n        background: var(--affine-hover-color);\n        z-index: 1;\n        pointer-events: none;\n      }\n    </style>\n    <div class=\"affine-edgeless-dragging-area\" style=${styleMap(style)}></div>\n  `;\n}\n", "import { html } from 'lit';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { EdgelessHoverState } from '../selection-manager.js';\nimport { getCommonRectStyle } from './utils.js';\n\nexport function EdgelessHoverRect(\n  hoverState: EdgelessHoverState | null,\n  zoom: number\n) {\n  if (!hoverState) return null;\n  const rect = hoverState.rect;\n\n  const style = getCommonRectStyle(rect);\n\n  return html`\n    <div class=\"affine-edgeless-hover-rect\" style=${styleMap(style)}></div>\n  `;\n}\n", "import type { PointerEventState } from '@blocksuite/lit';\n\nimport type {\n  MouseMode,\n  TopLevelBlockModel,\n} from '../../../__internal__/index.js';\nimport type { EdgelessPageBlockComponent } from '../edgeless-page-block.js';\nimport type { SelectionArea } from '../selection-manager.js';\n\nexport abstract class MouseModeController<Mode extends MouseMode = MouseMode> {\n  protected readonly _edgeless: EdgelessPageBlockComponent;\n\n  protected _draggingArea: SelectionArea | null = null;\n\n  enableHover = false;\n\n  constructor(edgeless: EdgelessPageBlockComponent) {\n    this._edgeless = edgeless;\n  }\n\n  get draggingArea() {\n    return this._draggingArea;\n  }\n\n  protected get _surface() {\n    return this._edgeless.surface;\n  }\n\n  protected get _page() {\n    return this._edgeless.page;\n  }\n\n  protected get _blocks(): TopLevelBlockModel[] {\n    return this._edgeless.sortedFrames;\n  }\n\n  public abstract mouseMode: Mode;\n  abstract onContainerDragStart(e: PointerEventState): void;\n  abstract onContainerDragMove(e: PointerEventState): void;\n  abstract onContainerDragEnd(e: PointerEventState): void;\n  abstract onContainerClick(e: PointerEventState): void;\n  abstract onContainerDblClick(e: PointerEventState): void;\n  abstract onContainerTripleClick(e: PointerEventState): void;\n  abstract onContainerMouseMove(e: PointerEventState): void;\n  abstract onContainerMouseOut(e: PointerEventState): void;\n  abstract onContainerContextMenu(e: PointerEventState): void;\n  abstract onPressShiftKey(pressed: boolean): void;\n}\n", "import { assertExists, caretRangeFromPoint } from '@blocksuite/global/utils';\nimport type { PointerEventState } from '@blocksuite/lit';\nimport type { SurfaceManager } from '@blocksuite/phasor';\nimport {\n  Bound,\n  ConnectorElement,\n  deserializeXYWH,\n  getCommonBound,\n  isPointIn,\n  type PhasorElement,\n  type PhasorElementType,\n  TextElement,\n  type XYWH,\n} from '@blocksuite/phasor';\n\nimport {\n  type BlockComponentElement,\n  type DefaultMouseMode,\n  getBlockElementByModel,\n  getClosestBlockElementByPoint,\n  getModelByBlockElement,\n  getRectByBlockElement,\n  handleNativeRangeAtPoint,\n  handleNativeRangeDragMove,\n  isEmpty,\n  noop,\n  Point,\n  Rect,\n  resetNativeSelection,\n  type TopLevelBlockModel,\n} from '../../../__internal__/index.js';\nimport { showFormatQuickBar } from '../../../components/format-quick-bar/index.js';\nimport { showFormatQuickBarByClicks } from '../../index.js';\nimport {\n  calcCurrentSelectionPosition,\n  getNativeSelectionMouseDragInfo,\n} from '../../utils/position.js';\nimport type { Selectable } from '../selection-manager.js';\nimport {\n  addText,\n  getXYWH,\n  handleElementChangedEffectForConnector,\n  isConnectorAndBindingsAllSelected,\n  isPhasorElement,\n  isTopLevelBlock,\n  mountTextEditor,\n  pickBlocksByBound,\n  pickTopBlock,\n} from '../utils.js';\nimport { MouseModeController } from './index.js';\n\nexport enum DefaultModeDragType {\n  /** Moving selected contents */\n  ContentMoving = 'content-moving',\n  /** Expanding the dragging area, select the content covered inside */\n  Selecting = 'selecting',\n  /** Native range dragging inside active frame block */\n  NativeEditing = 'native-editing',\n  /** Default void state */\n  None = 'none',\n  /** Dragging preview */\n  PreviewDragging = 'preview-dragging',\n  /** press alt/option key to clone selected  */\n  AltCloning = 'alt-cloning',\n}\n\nexport class DefaultModeController extends MouseModeController<DefaultMouseMode> {\n  readonly mouseMode = <DefaultMouseMode>{\n    type: 'default',\n  };\n  override enableHover = true;\n  dragType = DefaultModeDragType.None;\n\n  private _startRange: Range | null = null;\n  private _dragStartPos: { x: number; y: number } = { x: 0, y: 0 };\n  private _dragLastPos: { x: number; y: number } = { x: 0, y: 0 };\n  private _lock = false;\n  // Do not select the text, when click again after activating the frame.\n  private _isDoubleClickedOnMask = false;\n\n  override get draggingArea() {\n    if (this.dragType === DefaultModeDragType.Selecting) {\n      return {\n        start: new DOMPoint(this._dragStartPos.x, this._dragStartPos.y),\n        end: new DOMPoint(this._dragLastPos.x, this._dragLastPos.y),\n      };\n    }\n    return null;\n  }\n\n  get selectedBlocks() {\n    return this._edgeless.selection.selectedBlocks;\n  }\n\n  get state() {\n    return this._edgeless.selection.state;\n  }\n\n  get isActive() {\n    return this._edgeless.selection.state.active;\n  }\n\n  private _pick(x: number, y: number) {\n    const { surface } = this._edgeless;\n    const [modelX, modelY] = surface.viewport.toModelCoord(x, y);\n    const selectedShape = surface.pickTop(modelX, modelY);\n    return selectedShape\n      ? selectedShape\n      : pickTopBlock(this._blocks, modelX, modelY);\n  }\n\n  private _setNoneSelectionState() {\n    this._edgeless.slots.selectionUpdated.emit({ selected: [], active: false });\n    resetNativeSelection(null);\n  }\n\n  private _setSelectionState(selected: Selectable[], active: boolean) {\n    this._edgeless.slots.selectionUpdated.emit({\n      selected,\n      active,\n    });\n  }\n\n  private _handleClickOnSelected(element: Selectable, e: PointerEventState) {\n    const { selected, active } = this.state;\n    this._edgeless.clearSelectedBlocks();\n    // click the inner area of active text and note element\n    if (active && selected.length === 1 && selected[0] === element) {\n      handleNativeRangeAtPoint(e.raw.clientX, e.raw.clientY);\n      return;\n    }\n\n    // handle single frame block click\n    if (!e.keys.shift && selected.length === 1 && isTopLevelBlock(element)) {\n      if (\n        (selected[0] === element && !active) ||\n        (active && selected[0] !== element)\n      ) {\n        // issue #1809\n        // If the previously selected element is a frameBlock and is in an active state,\n        // then the currently clicked frameBlock should also be in an active state when selected.\n        this._setSelectionState([element], true);\n        this._edgeless.slots.selectedBlocksUpdated.emit([]);\n        return;\n      }\n    }\n\n    // hold shift key to multi select or de-select element\n    if (e.keys.shift) {\n      const selections = [...selected];\n      if (selected.includes(element)) {\n        this._setSelectionState(\n          selections.filter(item => item !== element),\n          false\n        );\n      } else {\n        this._setSelectionState([...selections, element], false);\n      }\n    } else {\n      this._setSelectionState([element], false);\n    }\n  }\n\n  private _handleDragMoveEffect(element: Selectable) {\n    handleElementChangedEffectForConnector(\n      element,\n      this.state.selected,\n      this._edgeless.surface,\n      this._page\n    );\n  }\n\n  private _handleSurfaceDragMove(\n    selected: PhasorElement,\n    e: PointerEventState\n  ) {\n    if (!this._lock) {\n      this._lock = true;\n      this._page.captureSync();\n    }\n    const { surface } = this._edgeless;\n    const { zoom } = surface.viewport;\n    const deltaX = this._dragLastPos.x - e.x;\n    const deltaY = this._dragLastPos.y - e.y;\n    const boundX = selected.x - deltaX / zoom;\n    const boundY = selected.y - deltaY / zoom;\n    const boundW = selected.w;\n    const boundH = selected.h;\n\n    if (\n      selected.type !== 'connector' ||\n      (selected instanceof ConnectorElement &&\n        isConnectorAndBindingsAllSelected(selected, this.state.selected))\n    ) {\n      surface.setElementBound(selected.id, {\n        x: boundX,\n        y: boundY,\n        w: boundW,\n        h: boundH,\n      });\n    }\n\n    this._handleDragMoveEffect(selected);\n  }\n\n  private _handleBlockDragMove(\n    block: TopLevelBlockModel,\n    e: PointerEventState\n  ) {\n    const [modelX, modelY, modelW, modelH] = JSON.parse(block.xywh) as XYWH;\n    const { zoom } = this._edgeless.surface.viewport;\n    const xywh = JSON.stringify([\n      modelX + e.delta.x / zoom,\n      modelY + e.delta.y / zoom,\n      modelW,\n      modelH,\n    ]);\n    this._page.updateBlock(block, { xywh });\n    this._handleDragMoveEffect(block);\n\n    // TODO: refactor\n    if (this.selectedBlocks.length) {\n      this._edgeless.slots.selectedBlocksUpdated.emit(this.selectedBlocks);\n    }\n  }\n\n  private _isInSelectedRect(viewX: number, viewY: number) {\n    const { selected } = this.state;\n    if (!selected.length) return false;\n\n    const commonBound = getCommonBound(\n      selected.map(element => {\n        if (isTopLevelBlock(element)) {\n          const [x, y, w, h] = deserializeXYWH(getXYWH(element));\n          return {\n            x,\n            y,\n            w,\n            h,\n          };\n        }\n        return element;\n      })\n    );\n    const [modelX, modelY] = this._surface.toModelCoord(viewX, viewY);\n    if (commonBound && isPointIn(commonBound, modelX, modelY)) {\n      return true;\n    }\n    return false;\n  }\n\n  private _forceUpdateSelection() {\n    // FIXME: force triggering selection change to re-render selection rect\n    this._edgeless.slots.selectionUpdated.emit({\n      ...this.state,\n    });\n  }\n\n  private _tryDeleteEmptyBlocks() {\n    const emptyBlocks = this._blocks.filter(b => isEmpty(b));\n    // always keep at least one frame block\n    if (emptyBlocks.length === this._blocks.length) {\n      emptyBlocks.shift();\n    }\n\n    if (emptyBlocks.length) {\n      this._page.captureSync();\n      emptyBlocks.forEach(b => this._page.deleteBlock(b));\n    }\n  }\n\n  /** Update drag handle by closest block elements */\n  private _updateDragHandle(e: PointerEventState) {\n    const block = this.state.selected[0];\n    if (!block || !isTopLevelBlock(block)) return;\n    const frameBlockElement = getBlockElementByModel(block);\n    assertExists(frameBlockElement);\n\n    const {\n      raw: { clientX, clientY },\n    } = e;\n    const point = new Point(clientX, clientY);\n    const element = getClosestBlockElementByPoint(\n      point,\n      {\n        container: frameBlockElement,\n        rect: Rect.fromDOM(frameBlockElement),\n      },\n      this._edgeless.surface.viewport.zoom\n    );\n    let hoverEditingState = null;\n    if (element) {\n      hoverEditingState = {\n        element: element as BlockComponentElement,\n        model: getModelByBlockElement(element),\n        rect: getRectByBlockElement(element),\n      };\n      this._edgeless.components.dragHandle?.onContainerMouseMove(\n        e,\n        hoverEditingState\n      );\n    }\n  }\n\n  onContainerClick(e: PointerEventState) {\n    this._tryDeleteEmptyBlocks();\n\n    const selected = this._pick(e.x, e.y);\n\n    if (selected) {\n      this._handleClickOnSelected(selected, e);\n    } else {\n      this._setNoneSelectionState();\n    }\n\n    this._isDoubleClickedOnMask = false;\n  }\n\n  onContainerContextMenu(e: PointerEventState) {\n    // repairContextMenuRange(e);\n    noop();\n  }\n\n  onContainerDblClick(e: PointerEventState) {\n    const selected = this._pick(e.x, e.y);\n    if (!selected) {\n      addText(this._edgeless, e);\n      return;\n    } else {\n      if (selected instanceof TextElement) {\n        mountTextEditor(selected, this._edgeless);\n        return;\n      }\n    }\n\n    if (\n      e.raw.target &&\n      e.raw.target instanceof HTMLElement &&\n      e.raw.target.classList.contains('affine-edgeless-mask')\n    ) {\n      this.onContainerClick(e);\n      this._isDoubleClickedOnMask = true;\n      return;\n    }\n\n    showFormatQuickBarByClicks('double', e, this._page, this._edgeless);\n  }\n\n  onContainerTripleClick(e: PointerEventState) {\n    if (this._isDoubleClickedOnMask) return;\n    showFormatQuickBarByClicks('triple', e, this._page, this._edgeless);\n  }\n\n  private _determineDragType(e: PointerEventState): DefaultModeDragType {\n    // Is dragging started from current selected rect\n    if (this._isInSelectedRect(e.x, e.y)) {\n      return this.state.active\n        ? DefaultModeDragType.NativeEditing\n        : DefaultModeDragType.ContentMoving;\n    } else {\n      const selected = this._pick(e.x, e.y);\n      if (selected) {\n        this._setSelectionState([selected], false);\n        return DefaultModeDragType.ContentMoving;\n      } else {\n        return DefaultModeDragType.Selecting;\n      }\n    }\n  }\n\n  private async _cloneContent(e: PointerEventState) {\n    this._lock = true;\n    const { surface } = this._edgeless;\n    const elements = (await Promise.all(\n      this.state.selected.map(async selected => {\n        return await this._cloneSelected(selected, surface);\n      })\n    )) as Selectable[];\n\n    this._setSelectionState(elements, false);\n  }\n\n  private async _cloneSelected(selected: Selectable, surface: SurfaceManager) {\n    if (isTopLevelBlock(selected)) {\n      const frameService = this._edgeless.getService('affine:frame');\n      const id = this._page.addBlock(\n        'affine:frame',\n        { xywh: selected.xywh },\n        this._page.root?.id\n      );\n      const frame = this._page.getBlockById(id);\n\n      assertExists(frame);\n      await frameService.json2Block(\n        frame,\n        frameService.block2Json(selected).children\n      );\n      return this._page.getBlockById(id);\n    } else {\n      const id = surface.addElement(\n        selected.type as keyof PhasorElementType,\n        selected.serialize() as unknown as Record<string, unknown>\n      );\n      return surface.pickById(id);\n    }\n  }\n\n  async onContainerDragStart(e: PointerEventState) {\n    // Determine the drag type based on the current state and event\n    let dragType = this._determineDragType(e);\n\n    // If alt key is pressed and content is moving, clone the content\n    if (e.keys.alt && dragType === DefaultModeDragType.ContentMoving) {\n      dragType = DefaultModeDragType.AltCloning;\n      await this._cloneContent(e);\n    }\n\n    // Set up drag stvate\n    this.initializeDragState(e, dragType);\n  }\n\n  initializeDragState(e: PointerEventState, dragType: DefaultModeDragType) {\n    this.dragType = dragType;\n    this._startRange = caretRangeFromPoint(e.x, e.y);\n    this._dragStartPos = { x: e.x, y: e.y };\n    this._dragLastPos = { x: e.x, y: e.y };\n  }\n\n  onContainerDragMove(e: PointerEventState) {\n    switch (this.dragType) {\n      case DefaultModeDragType.Selecting: {\n        const startX = this._dragStartPos.x;\n        const startY = this._dragStartPos.y;\n        const viewX = Math.min(startX, e.x);\n        const viewY = Math.min(startY, e.y);\n\n        const [x, y] = this._surface.toModelCoord(viewX, viewY);\n        const w = Math.abs(startX - e.x);\n        const h = Math.abs(startY - e.y);\n        const { zoom } = this._surface.viewport;\n        const bound = new Bound(x, y, w / zoom, h / zoom);\n\n        const blocks = pickBlocksByBound(this._blocks, bound);\n        const elements = this._surface.pickByBound(bound);\n        this._setSelectionState([...blocks, ...elements], false);\n        break;\n      }\n      case DefaultModeDragType.AltCloning:\n      case DefaultModeDragType.ContentMoving: {\n        this.state.selected.forEach(element => {\n          if (isPhasorElement(element)) {\n            this._handleSurfaceDragMove(element, e);\n          } else {\n            this._handleBlockDragMove(element, e);\n          }\n        });\n        this._forceUpdateSelection();\n        break;\n      }\n      case DefaultModeDragType.NativeEditing: {\n        // TODO reset if drag out of frame\n        handleNativeRangeDragMove(this._startRange, e);\n        break;\n      }\n    }\n    this._dragLastPos = {\n      x: e.x,\n      y: e.y,\n    };\n  }\n\n  onContainerDragEnd(e: PointerEventState) {\n    if (this._lock) {\n      this._page.captureSync();\n\n      this._lock = false;\n    }\n\n    if (this.isActive) {\n      const { direction, selectedType } = getNativeSelectionMouseDragInfo(e);\n      if (selectedType === 'Caret') {\n        // If nothing is selected, then we should not show the format bar\n        return;\n      }\n      showFormatQuickBar({\n        page: this._page,\n        container: this._edgeless,\n        direction,\n        anchorEl: {\n          getBoundingClientRect: () => {\n            return calcCurrentSelectionPosition(direction);\n          },\n        },\n      });\n    }\n    this.dragType = DefaultModeDragType.None;\n    this._dragStartPos = { x: 0, y: 0 };\n    this._dragLastPos = { x: 0, y: 0 };\n    this._forceUpdateSelection();\n  }\n\n  onContainerMouseMove(e: PointerEventState) {\n    if (this.dragType === DefaultModeDragType.PreviewDragging) return;\n    this._updateDragHandle(e);\n  }\n\n  onContainerMouseOut(_: PointerEventState) {\n    noop();\n  }\n\n  onPressShiftKey(_: boolean) {\n    noop();\n  }\n}\n", "import { assertExists } from '@blocksuite/store';\n\nimport type {\n  BlockComponentElement,\n  EditingState,\n} from '../../__internal__/index.js';\nimport {\n  getBlockElementByModel,\n  getBlockElementsExcludeSubtrees,\n  getClosestBlockElementByPoint,\n  getClosestFrameBlockElementById,\n  getHoveringFrame,\n  getModelByBlockElement,\n  getRectByBlockElement,\n  isInSamePath,\n  Point,\n  Rect,\n} from '../../__internal__/index.js';\nimport { DragHandle } from '../../components/index.js';\nimport type { EdgelessPageBlockComponent } from './edgeless-page-block.js';\nimport {\n  type DefaultModeController,\n  DefaultModeDragType,\n} from './mode-controllers/default-mode.js';\n\nexport function createDragHandle(pageBlock: EdgelessPageBlockComponent) {\n  return new DragHandle({\n    // Drag handle should be at the same level with EditorContainer\n    container: pageBlock.mouseRoot as HTMLElement,\n    onDropCallback(point, blockElements, editingState, type) {\n      const blockElementsExcludeSubtrees =\n        getBlockElementsExcludeSubtrees(blockElements);\n      if (!blockElementsExcludeSubtrees.length) return;\n\n      const models = blockElementsExcludeSubtrees.map(getModelByBlockElement);\n      if (!models.length) return;\n\n      const page = pageBlock.page;\n\n      if (editingState && type !== 'none') {\n        const { model } = editingState;\n        if (models.length === 1 && isInSamePath(page, model, models[0])) return;\n\n        const focusId = models[0].id;\n        const targetFrameBlock = getClosestFrameBlockElementById(\n          model.id,\n          pageBlock\n        ) as BlockComponentElement;\n        assertExists(targetFrameBlock);\n        const frameBlock = getClosestFrameBlockElementById(\n          focusId,\n          pageBlock\n        ) as BlockComponentElement;\n        assertExists(frameBlock);\n\n        page.captureSync();\n\n        if (type === 'database') {\n          page.moveBlocks(models, model);\n        } else {\n          const parent = page.getParent(model);\n          assertExists(parent);\n          page.moveBlocks(models, parent, model, type === 'before');\n        }\n\n        pageBlock.setSelection(targetFrameBlock.model.id, true, focusId, point);\n        return;\n      }\n      // blank area\n      page.captureSync();\n\n      const parent = page.getParent(models[0]);\n      assertExists(parent);\n\n      const firstModelIndex = parent.children.findIndex(\n        m => m.id === models[0].id\n      );\n      const lastModelIndex = parent.children.findIndex(\n        m => m.id === models[models.length - 1].id\n      );\n\n      pageBlock.moveBlocksWithNewFrame(models, point, {\n        rect: getRectByBlockElement(blockElementsExcludeSubtrees[0]),\n        focus: true,\n        frameIndex: firstModelIndex === 0 ? 0 : undefined,\n      });\n\n      if (\n        firstModelIndex !== 0 &&\n        lastModelIndex !== parent.children.length - 1\n      ) {\n        const nextFirstBlockElement = getBlockElementByModel(\n          parent?.children[lastModelIndex]\n        );\n\n        assertExists(nextFirstBlockElement);\n        const nextFirstBlockRect = getRectByBlockElement(nextFirstBlockElement);\n        pageBlock.moveBlocksWithNewFrame(\n          parent?.children.slice(lastModelIndex),\n          new Point(nextFirstBlockRect.x, nextFirstBlockRect.y),\n          { rect: nextFirstBlockRect }\n        );\n      }\n    },\n    setDragType(dragging: boolean) {\n      const { selection } = pageBlock;\n      if (selection.mouseMode.type === 'default') {\n        const currentController =\n          selection.currentController as DefaultModeController;\n        currentController.dragType = dragging\n          ? DefaultModeDragType.PreviewDragging\n          : DefaultModeDragType.None;\n      }\n    },\n    setSelectedBlock(modelState: EditingState | null) {\n      const selectedBlocks = [];\n      if (modelState) {\n        selectedBlocks.push(modelState.element);\n      }\n      pageBlock.slots.selectedBlocksUpdated.emit(selectedBlocks);\n    },\n    getSelectedBlocks() {\n      return pageBlock.selection.selectedBlocks;\n    },\n    getClosestBlockElement(point: Point) {\n      if (pageBlock.mouseMode.type !== 'default') return null;\n      const hoveringFrame = getHoveringFrame(point);\n      if (!hoveringFrame) return null;\n      return getClosestBlockElementByPoint(\n        point,\n        { container: hoveringFrame, rect: Rect.fromDOM(hoveringFrame) },\n        pageBlock.surface.viewport.zoom\n      );\n    },\n  });\n}\n", "import { BLOCK_ID_ATTR } from '@blocksuite/global/config';\nimport type { Page } from '@blocksuite/store';\nimport { Slot } from '@blocksuite/store';\n\nimport { getBlockElementByModel } from '../../__internal__/utils/query.js';\nimport { almostEqual, throttle } from '../../__internal__/utils/std.js';\n\nexport class FrameResizeObserver {\n  private _observer: ResizeObserver;\n  /**\n   * Observation will fire when observation starts if Element is being rendered, and Elements size is not 0,0.\n   * https://w3c.github.io/csswg-drafts/resize-observer/#resize-observer-interface\n   *\n   * So we need to cache observed element.\n   */\n  private _cachedElements = new Map<string, Element>();\n  private _lastRects = new Map<string, DOMRectReadOnly>();\n\n  slots = {\n    resize: new Slot<Map<string, DOMRectReadOnly>>(),\n  };\n\n  constructor() {\n    this._observer = new ResizeObserver(\n      throttle<ResizeObserverEntry[][], typeof this._onResize>(\n        this._onResize,\n        1000 / 60\n      )\n    );\n  }\n\n  private _onResize = (entries: ResizeObserverEntry[]) => {\n    const resizedFrames = new Map<string, DOMRect>();\n    entries.forEach(entry => {\n      const blockElement = entry.target.closest(`[${BLOCK_ID_ATTR}]`);\n      const id = blockElement?.getAttribute(BLOCK_ID_ATTR);\n      if (!id) return;\n      if (this._lastRects.has(id)) {\n        const rect = this._lastRects.get(id);\n        if (\n          rect &&\n          almostEqual(rect.x, entry.contentRect.x) &&\n          almostEqual(rect.y, entry.contentRect.y) &&\n          almostEqual(rect.width, entry.contentRect.width) &&\n          almostEqual(rect.height, entry.contentRect.height)\n        ) {\n          return;\n        }\n      }\n      this._lastRects.set(id, entry.contentRect);\n      resizedFrames.set(id, entry.contentRect);\n    });\n\n    if (resizedFrames.size) {\n      this.slots.resize.emit(resizedFrames);\n    }\n  };\n\n  resetListener(page: Page) {\n    const unCachedKeys = new Set(this._cachedElements.keys());\n    page.root?.children.forEach(model => {\n      const blockId = model.id;\n      unCachedKeys.delete(blockId);\n      const blockElement = getBlockElementByModel(model);\n      const container = blockElement?.querySelector(\n        '.affine-frame-block-container'\n      );\n\n      const cachedElement = this._cachedElements.get(blockId);\n      if (cachedElement) {\n        if (container === cachedElement) {\n          return;\n        }\n        this._observer.unobserve(cachedElement);\n        this._cachedElements.delete(blockId);\n      }\n\n      if (!container) return;\n      this._observer.observe(container);\n      this._cachedElements.set(blockId, container);\n    });\n\n    unCachedKeys.forEach(k => {\n      const element = this._cachedElements.get(k);\n      if (!element) return;\n      this._observer.unobserve(element);\n    });\n  }\n\n  dispose() {\n    this._observer.disconnect();\n    this.slots.resize.dispose();\n    this._cachedElements.clear();\n    this._lastRects.clear();\n  }\n}\n", "import {\n  FRAME_BACKGROUND_COLORS,\n  HOTKEYS,\n  SHORT_KEY,\n} from '@blocksuite/global/config';\n\nimport { activeEditorManager } from '../../__internal__/utils/active-editor-manager.js';\nimport { hotkey, HOTKEY_SCOPE_TYPE } from '../../__internal__/utils/hotkey.js';\nimport type { MouseMode } from '../../__internal__/utils/types.js';\nimport { BrushSize } from '../../__internal__/utils/types.js';\nimport {\n  bindCommonHotkey,\n  deleteModelsByRange,\n  handleDown,\n  handleUp,\n} from '../utils/index.js';\nimport { DEFAULT_SELECTED_COLOR } from './components/color-panel.js';\nimport {\n  DEFAULT_SHAPE_FILL_COLOR,\n  DEFAULT_SHAPE_STROKE_COLOR,\n} from './components/component-toolbar/change-shape-button.js';\nimport type { EdgelessPageBlockComponent } from './edgeless-page-block.js';\nimport { isTopLevelBlock } from './utils.js';\n\nfunction setMouseMode(\n  edgeless: EdgelessPageBlockComponent,\n  mouseMode: MouseMode,\n  ignoreActiveState = false\n) {\n  // when editing, should not update mouse mode by shortcut\n  if (!ignoreActiveState && edgeless.selection.isActive) {\n    return;\n  }\n  edgeless.selection.setMouseMode(mouseMode);\n}\n\nfunction bindSpace(edgeless: EdgelessPageBlockComponent) {\n  // When user enters pan mode by pressing space,\n  // we should revert to the last mouse mode once user releases the key.\n  let shouldRevertMode = false;\n  let lastMode: MouseMode | null = null;\n  hotkey.addListener(\n    HOTKEYS.SPACE,\n    (event: KeyboardEvent) => {\n      const { mouseMode, state } = edgeless.selection;\n      if (event.type === 'keydown') {\n        if (mouseMode.type === 'pan') {\n          return;\n        }\n\n        // when user is editing, shouldn't enter pan mode\n        if (mouseMode.type === 'default' && state.active) {\n          return;\n        }\n\n        shouldRevertMode = true;\n        lastMode = mouseMode;\n        setMouseMode(edgeless, { type: 'pan', panning: false });\n        return;\n      }\n      if (event.type === 'keyup') {\n        if (mouseMode.type === 'pan' && shouldRevertMode && lastMode) {\n          setMouseMode(edgeless, lastMode);\n        }\n        shouldRevertMode = false;\n      }\n    },\n    {\n      keydown: true,\n      keyup: true,\n    }\n  );\n}\n\nfunction bindDelete(edgeless: EdgelessPageBlockComponent) {\n  function backspace(e: KeyboardEvent) {\n    // TODO: add `selection-state` to handle `block`, `native`, `frame`, `shape`, etc.\n    deleteModelsByRange(edgeless.page);\n\n    const { selected } = edgeless.selection.state;\n    selected.forEach(element => {\n      if (isTopLevelBlock(element)) {\n        const children = edgeless.page.root?.children ?? [];\n        // FIXME: should always keep at least 1 frame\n        if (children.length > 1) {\n          edgeless.page.deleteBlock(element);\n        }\n      } else {\n        edgeless.surface.removeElement(element.id);\n      }\n    });\n    edgeless.selection.clear();\n    edgeless.slots.selectionUpdated.emit(edgeless.selection.state);\n  }\n  hotkey.addListener(HOTKEYS.BACKSPACE, backspace);\n  hotkey.addListener(HOTKEYS.DELETE, backspace);\n}\n\nfunction bindShift(\n  edgeless: EdgelessPageBlockComponent,\n  key = 'shift',\n  pressed = false\n) {\n  hotkey.addListener(\n    HOTKEYS.ANY_KEY,\n    e => {\n      if (e.key.toLowerCase() === key && pressed !== e.shiftKey) {\n        pressed = e.shiftKey;\n        edgeless.slots.pressShiftKeyUpdated.emit(pressed);\n      }\n    },\n    {\n      keydown: true,\n      keyup: true,\n    }\n  );\n}\n\nexport function bindEdgelessHotkeys(edgeless: EdgelessPageBlockComponent) {\n  const scope = hotkey.newScope(HOTKEY_SCOPE_TYPE.AFFINE_EDGELESS);\n  if (activeEditorManager.isActive(edgeless)) {\n    hotkey.setScope(scope);\n  }\n  const activeDispose = activeEditorManager.activeSlot.on(() => {\n    if (activeEditorManager.isActive(edgeless)) {\n      hotkey.setScope(scope);\n    }\n  });\n  hotkey.withScope(scope, () => {\n    hotkey.addListener(HOTKEYS.UP, e =>\n      handleUp(e, edgeless.page, { zoom: edgeless.surface.viewport.zoom })\n    );\n    hotkey.addListener(HOTKEYS.DOWN, e =>\n      handleDown(e, edgeless.page, { zoom: edgeless.surface.viewport.zoom })\n    );\n\n    hotkey.addListener('v', () => setMouseMode(edgeless, { type: 'default' }));\n    hotkey.addListener('t', () => setMouseMode(edgeless, { type: 'text' }));\n    hotkey.addListener('h', () =>\n      setMouseMode(edgeless, { type: 'pan', panning: false })\n    );\n    hotkey.addListener('n', () =>\n      setMouseMode(edgeless, {\n        type: 'note',\n        background: FRAME_BACKGROUND_COLORS[0],\n      })\n    );\n    hotkey.addListener('p', () =>\n      setMouseMode(edgeless, {\n        type: 'brush',\n        color: DEFAULT_SELECTED_COLOR,\n        lineWidth: BrushSize.Thin,\n      })\n    );\n    hotkey.addListener('s', () =>\n      setMouseMode(edgeless, {\n        type: 'shape',\n        shape: 'rect',\n        fillColor: DEFAULT_SHAPE_FILL_COLOR,\n        strokeColor: DEFAULT_SHAPE_STROKE_COLOR,\n      })\n    );\n\n    // issue #1814\n    hotkey.addListener(HOTKEYS.ESC, () => {\n      edgeless.slots.selectionUpdated.emit({ selected: [], active: false });\n      setMouseMode(edgeless, { type: 'default' }, true);\n    });\n\n    hotkey.addListener(HOTKEYS.SELECT_ALL, keyboardEvent => {\n      keyboardEvent.preventDefault();\n\n      edgeless.slots.selectionUpdated.emit({\n        selected: [...edgeless.frames, ...edgeless.surface.getElements()],\n        active: false,\n      });\n    });\n\n    hotkey.addListener(`${SHORT_KEY}+1`, e => {\n      e.preventDefault();\n      edgeless.slots.zoomUpdated.emit('fit');\n    });\n    hotkey.addListener(`${SHORT_KEY}+-`, e => {\n      e.preventDefault();\n      edgeless.slots.zoomUpdated.emit('out');\n    });\n    hotkey.addListener(`${SHORT_KEY}+0`, e => {\n      e.preventDefault();\n      edgeless.slots.zoomUpdated.emit('reset');\n    });\n    hotkey.addListener(`${SHORT_KEY}+=`, e => {\n      e.preventDefault();\n      edgeless.slots.zoomUpdated.emit('in');\n    });\n\n    bindSpace(edgeless);\n    bindDelete(edgeless);\n    bindShift(edgeless);\n    bindCommonHotkey(edgeless.page);\n  });\n  return () => {\n    hotkey.deleteScope(scope);\n    activeDispose.dispose();\n  };\n}\n", "import { assertExists } from '@blocksuite/global/utils';\nimport type { PointerEventState } from '@blocksuite/lit';\n\nimport type { BrushMouseMode } from '../../../__internal__/index.js';\nimport { noop } from '../../../__internal__/index.js';\nimport { DEFAULT_SELECTED_COLOR } from '../components/color-panel.js';\nimport { MouseModeController } from './index.js';\n\nexport class BrushModeController extends MouseModeController<BrushMouseMode> {\n  readonly mouseMode = <BrushMouseMode>{\n    type: 'brush',\n    color: DEFAULT_SELECTED_COLOR,\n    lineWidth: 4,\n  };\n\n  private _draggingElementId: string | null = null;\n  protected _draggingPathPoints: number[][] | null = null;\n\n  onContainerClick(e: PointerEventState): void {\n    noop();\n  }\n\n  onContainerContextMenu(e: PointerEventState): void {\n    noop();\n  }\n\n  onContainerDblClick(e: PointerEventState): void {\n    noop();\n  }\n\n  onContainerTripleClick(e: PointerEventState) {\n    noop();\n  }\n\n  onContainerDragStart(e: PointerEventState) {\n    if (!this._page.awarenessStore.getFlag('enable_surface')) return;\n\n    this._page.captureSync();\n    const { viewport } = this._edgeless.surface;\n\n    // create a shape block when drag start\n    const [modelX, modelY] = viewport.toModelCoord(e.point.x, e.point.y);\n    const { color, lineWidth } = this.mouseMode;\n    const points = [[modelX, modelY]];\n\n    const id = this._surface.addElement('brush', {\n      points,\n      color,\n      lineWidth,\n    });\n\n    this._draggingElementId = id;\n    this._draggingPathPoints = points;\n\n    this._edgeless.slots.surfaceUpdated.emit();\n  }\n\n  onContainerDragMove(e: PointerEventState) {\n    if (!this._page.awarenessStore.getFlag('enable_surface')) return;\n    if (!this._draggingElementId) return;\n\n    assertExists(this._draggingElementId);\n    assertExists(this._draggingPathPoints);\n\n    const { lineWidth } = this.mouseMode;\n\n    const [modelX, modelY] = this._edgeless.surface.toModelCoord(\n      e.point.x,\n      e.point.y\n    );\n\n    const points = [...this._draggingPathPoints, [modelX, modelY]];\n\n    this._draggingPathPoints = points;\n\n    this._surface.updateElement<'brush'>(this._draggingElementId, {\n      points,\n      lineWidth,\n    });\n\n    this._edgeless.slots.surfaceUpdated.emit();\n  }\n\n  onContainerDragEnd(e: PointerEventState) {\n    this._draggingElementId = null;\n    this._draggingPathPoints = null;\n    this._page.captureSync();\n    this._edgeless.slots.surfaceUpdated.emit();\n  }\n\n  onContainerMouseMove(e: PointerEventState) {\n    noop();\n  }\n\n  onContainerMouseOut(e: PointerEventState) {\n    noop();\n  }\n\n  onPressShiftKey(_: boolean) {\n    noop();\n  }\n}\n", "import { Rectangle } from '@blocksuite/connector';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { PointerEventState } from '@blocksuite/lit';\nimport { deserializeXYWH, StrokeStyle } from '@blocksuite/phasor';\n\nimport type { ConnectorMouseMode } from '../../../__internal__/index.js';\nimport { noop } from '../../../__internal__/index.js';\nimport type { Selectable, SelectionArea } from '../selection-manager.js';\nimport {\n  generateConnectorPath,\n  getAttachedPoint,\n  getXYWH,\n  pickBy,\n} from '../utils.js';\nimport { MouseModeController } from './index.js';\n\nexport class ConnectorModeController extends MouseModeController<ConnectorMouseMode> {\n  readonly mouseMode = <ConnectorMouseMode>{\n    type: 'connector',\n  };\n\n  private _draggingElementId: string | null = null;\n\n  protected override _draggingArea: SelectionArea | null = null;\n  private _draggingStartElement: Selectable | null = null;\n  private _draggingStartRect: Rectangle | null = null;\n  // must assign value when dragging start\n  private _draggingStartPoint!: { x: number; y: number };\n\n  private _pickBy(\n    x: number,\n    y: number,\n    filter: (element: Selectable) => boolean\n  ) {\n    const { surface } = this._edgeless;\n    return pickBy(surface, this._page, x, y, filter);\n  }\n\n  onContainerClick(e: PointerEventState): void {\n    noop();\n  }\n\n  onContainerContextMenu(e: PointerEventState): void {\n    noop();\n  }\n\n  onContainerDblClick(e: PointerEventState): void {\n    noop();\n  }\n\n  onContainerTripleClick(e: PointerEventState) {\n    noop();\n  }\n\n  onContainerDragStart(e: PointerEventState) {\n    if (!this._page.awarenessStore.getFlag('enable_surface')) return;\n\n    this._page.captureSync();\n    const { viewport } = this._edgeless.surface;\n    const { mode, color } = this.mouseMode;\n\n    // create a block when drag start\n    const [modelX, modelY] = viewport.toModelCoord(e.x, e.y);\n\n    this._draggingStartElement = this._pickBy(\n      e.x,\n      e.y,\n      ele => ele.type !== 'connector'\n    );\n    this._draggingStartRect = this._draggingStartElement\n      ? new Rectangle(...deserializeXYWH(getXYWH(this._draggingStartElement)))\n      : null;\n\n    const { point: startPoint, position: startPosition } = getAttachedPoint(\n      modelX,\n      modelY,\n      this._draggingStartRect\n    );\n\n    this._draggingStartPoint = startPoint;\n\n    const id = this._surface.addElement('connector', {\n      color,\n      mode,\n      controllers: [\n        { x: modelX, y: modelY },\n        { x: modelX + 1, y: modelY + 1 },\n      ],\n      lineWidth: 4,\n      strokeStyle: StrokeStyle.Solid,\n      startElement:\n        this._draggingStartElement && startPosition\n          ? {\n              id: this._draggingStartElement.id,\n              position: startPosition,\n            }\n          : undefined,\n    });\n    this._draggingElementId = id;\n\n    this._draggingArea = {\n      start: new DOMPoint(e.x, e.y),\n      end: new DOMPoint(e.x, e.y),\n    };\n\n    this._edgeless.slots.surfaceUpdated.emit();\n  }\n\n  onContainerDragMove(e: PointerEventState) {\n    if (!this._page.awarenessStore.getFlag('enable_surface')) return;\n\n    assertExists(this._draggingElementId);\n    assertExists(this._draggingArea);\n\n    const { viewport } = this._edgeless.surface;\n    const { mode } = this.mouseMode;\n\n    this._draggingArea.end = new DOMPoint(e.x, e.y);\n\n    const id = this._draggingElementId;\n\n    const startX = this._draggingStartPoint.x;\n    const startY = this._draggingStartPoint.y;\n\n    const [endModelX, endModelY] = viewport.toModelCoord(e.x, e.y);\n    const end = this._pickBy(\n      e.x,\n      e.y,\n      ele => ele.id !== id && ele.type !== 'connector'\n    );\n    const endRect =\n      end && end.id !== id\n        ? new Rectangle(...deserializeXYWH(getXYWH(end)))\n        : null;\n\n    const {\n      point: { x: endX, y: endY },\n      position: endPosition,\n    } = getAttachedPoint(endModelX, endModelY, endRect);\n\n    const routes = generateConnectorPath(\n      this._draggingStartRect,\n      endRect,\n      { x: startX, y: startY },\n      { x: endX, y: endY },\n      [],\n      mode\n    );\n\n    this._surface.updateElement<'connector'>(id, {\n      controllers: routes,\n      endElement:\n        end && endPosition ? { id: end.id, position: endPosition } : undefined,\n    });\n\n    this._edgeless.slots.surfaceUpdated.emit();\n  }\n\n  onContainerDragEnd(e: PointerEventState) {\n    const id = this._draggingElementId;\n    assertExists(id);\n\n    this._draggingElementId = null;\n    this._draggingArea = null;\n\n    this._page.captureSync();\n\n    const element = this._surface.pickById(id);\n    assertExists(element);\n    this._edgeless.selection.switchToDefaultMode({\n      selected: [element],\n      active: false,\n    });\n  }\n\n  onContainerMouseMove(e: PointerEventState) {\n    noop();\n  }\n\n  onContainerMouseOut(e: PointerEventState) {\n    noop();\n  }\n\n  onPressShiftKey(_: boolean) {\n    noop();\n  }\n}\n", "import type { PointerEventState } from '@blocksuite/lit';\n\nimport { type NoteMouseMode } from '../../../__internal__/index.js';\nimport { noop } from '../../../__internal__/index.js';\nimport { addNote, DEFAULT_FRAME_WIDTH } from '../utils.js';\nimport { MouseModeController } from './index.js';\n\nexport class NoteModeController extends MouseModeController<NoteMouseMode> {\n  readonly mouseMode = <NoteMouseMode>{\n    type: 'note',\n  };\n\n  private _dragStartEvent: PointerEventState | null = null;\n\n  private _addNote(e: PointerEventState, width = DEFAULT_FRAME_WIDTH) {\n    addNote(this._edgeless, this._page, e, width);\n  }\n\n  onContainerClick(e: PointerEventState): void {\n    this._addNote(e);\n  }\n\n  onContainerContextMenu(e: PointerEventState): void {\n    noop();\n  }\n\n  onContainerDblClick(e: PointerEventState): void {\n    noop();\n  }\n\n  onContainerTripleClick(e: PointerEventState) {\n    noop();\n  }\n\n  onContainerDragStart(e: PointerEventState) {\n    this._dragStartEvent = e;\n    this._draggingArea = {\n      start: new DOMPoint(e.x, e.y),\n      end: new DOMPoint(e.x, e.y),\n    };\n  }\n\n  onContainerDragMove(e: PointerEventState) {\n    if (this._draggingArea) {\n      this._draggingArea.end = new DOMPoint(e.x, e.y);\n      this._edgeless.slots.hoverUpdated.emit();\n    }\n  }\n\n  onContainerDragEnd(e: PointerEventState) {\n    if (this._dragStartEvent) {\n      const startEvent =\n        e.x > this._dragStartEvent.x ? this._dragStartEvent : e;\n      const width = Math.max(\n        Math.abs(e.x - this._dragStartEvent.x),\n        DEFAULT_FRAME_WIDTH\n      );\n      this._addNote(startEvent, width);\n    }\n    this._dragStartEvent = null;\n    this._draggingArea = null;\n  }\n\n  onContainerMouseMove(e: PointerEventState) {\n    noop();\n  }\n\n  onContainerMouseOut(e: PointerEventState) {\n    noop();\n  }\n\n  onPressShiftKey(_: boolean) {\n    noop();\n  }\n}\n", "import type { PointerEventState } from '@blocksuite/lit';\n\nimport type { PanMouseMode } from '../../../__internal__/index.js';\nimport { noop } from '../../../__internal__/index.js';\nimport { MouseModeController } from './index.js';\n\nexport class PanModeController extends MouseModeController<PanMouseMode> {\n  readonly mouseMode = <PanMouseMode>{\n    type: 'pan',\n  };\n\n  private _lastPoint: [number, number] | null = null;\n\n  onContainerClick(e: PointerEventState): void {\n    noop();\n  }\n\n  onContainerContextMenu(e: PointerEventState): void {\n    noop();\n  }\n\n  onContainerDblClick(e: PointerEventState): void {\n    noop();\n  }\n\n  onContainerTripleClick(e: PointerEventState) {\n    noop();\n  }\n\n  onContainerDragStart(e: PointerEventState) {\n    if (!this._page.awarenessStore.getFlag('enable_surface')) return;\n\n    this._lastPoint = [e.x, e.y];\n    this._edgeless.slots.mouseModeUpdated.emit({ type: 'pan', panning: true });\n  }\n\n  onContainerDragMove(e: PointerEventState) {\n    if (!this._page.awarenessStore.getFlag('enable_surface')) return;\n    if (!this._lastPoint) return;\n\n    const { viewport } = this._edgeless.surface;\n    const { zoom } = viewport;\n\n    const [lastX, lastY] = this._lastPoint;\n    const deltaX = lastX - e.x;\n    const deltaY = lastY - e.y;\n\n    this._lastPoint = [e.x, e.y];\n\n    viewport.applyDeltaCenter(deltaX / zoom, deltaY / zoom);\n\n    this._edgeless.slots.viewportUpdated.emit();\n  }\n\n  onContainerDragEnd() {\n    this._lastPoint = null;\n    this._edgeless.slots.mouseModeUpdated.emit({ type: 'pan', panning: false });\n  }\n\n  onContainerMouseMove(e: PointerEventState) {\n    noop();\n  }\n\n  onContainerMouseOut(e: PointerEventState) {\n    noop();\n  }\n\n  onPressShiftKey(_: boolean) {\n    noop();\n  }\n}\n", "import { assertExists } from '@blocksuite/global/utils';\nimport type { PointerEventState } from '@blocksuite/lit';\nimport { Bound, StrokeStyle } from '@blocksuite/phasor';\n\nimport type { ShapeMouseMode } from '../../../__internal__/index.js';\nimport { noop } from '../../../__internal__/index.js';\nimport { isTransparent } from '../components/color-panel.js';\nimport {\n  DEFAULT_SHAPE_FILL_COLOR,\n  DEFAULT_SHAPE_STROKE_COLOR,\n} from '../components/component-toolbar/change-shape-button.js';\nimport type { SelectionArea } from '../selection-manager.js';\nimport { MouseModeController } from './index.js';\n\nexport class ShapeModeController extends MouseModeController<ShapeMouseMode> {\n  readonly mouseMode = <ShapeMouseMode>{\n    type: 'shape',\n    shape: 'rect',\n    fillColor: DEFAULT_SHAPE_FILL_COLOR,\n    strokeColor: DEFAULT_SHAPE_STROKE_COLOR,\n  };\n\n  private _draggingElementId: string | null = null;\n\n  protected override _draggingArea: SelectionArea | null = null;\n\n  onContainerClick(e: PointerEventState): void {\n    noop();\n  }\n\n  onContainerContextMenu(e: PointerEventState): void {\n    noop();\n  }\n\n  onContainerDblClick(e: PointerEventState): void {\n    noop();\n  }\n\n  onContainerTripleClick(e: PointerEventState) {\n    noop();\n  }\n\n  onContainerDragStart(e: PointerEventState) {\n    if (!this._page.awarenessStore.getFlag('enable_surface')) return;\n\n    this._page.captureSync();\n    const { viewport } = this._edgeless.surface;\n\n    // create a shape block when drag start\n    const [modelX, modelY] = viewport.toModelCoord(e.point.x, e.point.y);\n    const bound = new Bound(modelX, modelY, 0, 0);\n    const { shape, fillColor, strokeColor } = this.mouseMode;\n\n    const shapeType = shape === 'roundedRect' ? 'rect' : shape;\n\n    const id = this._surface.addElement('shape', {\n      shapeType,\n      xywh: bound.serialize(),\n      strokeColor,\n      fillColor,\n      filled: !isTransparent(fillColor),\n      radius: shape === 'roundedRect' ? 0.1 : 0,\n      strokeWidth: 4,\n      strokeStyle: StrokeStyle.Solid,\n    });\n\n    this._draggingElementId = id;\n\n    this._draggingArea = {\n      start: new DOMPoint(e.x, e.y),\n      end: new DOMPoint(e.x, e.y),\n    };\n    this._edgeless.slots.surfaceUpdated.emit();\n  }\n\n  onContainerDragMove(e: PointerEventState) {\n    if (!this._page.awarenessStore.getFlag('enable_surface')) return;\n\n    assertExists(this._draggingElementId);\n    assertExists(this._draggingArea);\n\n    this._draggingArea.end = new DOMPoint(e.x, e.y);\n\n    this._resize(e.keys.shift || this._edgeless.selection.shiftKey);\n  }\n\n  onContainerDragEnd(e: PointerEventState) {\n    const id = this._draggingElementId;\n    assertExists(id);\n\n    this._draggingElementId = null;\n    this._draggingArea = null;\n\n    this._page.captureSync();\n\n    const element = this._surface.pickById(id);\n    assertExists(element);\n    this._edgeless.selection.switchToDefaultMode({\n      selected: [element],\n      active: false,\n    });\n  }\n\n  onPressShiftKey(pressed: boolean) {\n    const id = this._draggingElementId;\n    if (!id) return;\n\n    this._resize(pressed);\n  }\n\n  private _resize(shift = false) {\n    const { _draggingElementId: id, _draggingArea, _edgeless } = this;\n    assertExists(id);\n    assertExists(_draggingArea);\n\n    const { slots, surface } = _edgeless;\n    const { viewport } = surface;\n    const { zoom } = viewport;\n    const {\n      start: { x: startX, y: startY },\n      end,\n    } = _draggingArea;\n    let { x: endX, y: endY } = end;\n\n    if (shift) {\n      const w = Math.abs(endX - startX);\n      const h = Math.abs(endY - startY);\n      const m = Math.max(w, h);\n      endX = startX + (endX > startX ? m : -m);\n      endY = startY + (endY > startY ? m : -m);\n    }\n\n    const [x, y] = viewport.toModelCoord(\n      Math.min(startX, endX),\n      Math.min(startY, endY)\n    );\n    const w = Math.abs(startX - endX) / zoom;\n    const h = Math.abs(startY - endY) / zoom;\n\n    const bound = new Bound(x, y, w, h);\n    surface.setElementBound(id, bound);\n    slots.surfaceUpdated.emit();\n  }\n\n  onContainerMouseMove(e: PointerEventState) {\n    noop();\n  }\n\n  onContainerMouseOut(e: PointerEventState) {\n    noop();\n  }\n}\n", "import type { PointerEventState } from '@blocksuite/lit';\n\nimport type { TextMouseMode } from '../../../__internal__/index.js';\nimport { noop } from '../../../__internal__/index.js';\nimport { addText } from '../utils.js';\nimport { MouseModeController } from './index.js';\n\nexport class TextModeController extends MouseModeController<TextMouseMode> {\n  readonly mouseMode = <TextMouseMode>{\n    type: 'text',\n  };\n\n  onContainerClick(e: PointerEventState): void {\n    addText(this._edgeless, e);\n  }\n\n  onContainerContextMenu(e: PointerEventState): void {\n    noop();\n  }\n\n  onContainerDblClick(e: PointerEventState): void {\n    noop();\n  }\n\n  onContainerTripleClick(e: PointerEventState) {\n    noop();\n  }\n\n  onContainerDragStart(e: PointerEventState) {\n    noop();\n  }\n\n  onContainerDragMove(e: PointerEventState) {\n    noop();\n  }\n\n  onContainerDragEnd(e: PointerEventState) {\n    noop();\n  }\n\n  onContainerMouseMove(e: PointerEventState) {\n    noop();\n  }\n\n  onContainerMouseOut(e: PointerEventState) {\n    noop();\n  }\n\n  onPressShiftKey(_: boolean) {\n    noop();\n  }\n}\n", "import type { PointerEventState } from '@blocksuite/lit';\nimport type { UIEventDispatcher } from '@blocksuite/lit';\nimport type { EventName, UIEventHandler } from '@blocksuite/lit';\nimport type { PhasorElement } from '@blocksuite/phasor';\nimport { normalizeWheelDeltaY } from '@blocksuite/phasor';\n\nimport {\n  AbstractSelectionManager,\n  type BlockComponentElement,\n  getEditorContainerByElement,\n  isDatabaseInput,\n  isInsideEdgelessTextEditor,\n  isInsidePageTitle,\n  isPinchEvent,\n  type MouseMode,\n  Point,\n  type TopLevelBlockModel,\n} from '../../__internal__/index.js';\nimport { activeEditorManager } from '../../__internal__/utils/active-editor-manager.js';\nimport { updateLocalSelectionRange } from '../default/selection-manager/utils.js';\nimport type { EdgelessPageBlockComponent } from './edgeless-page-block.js';\nimport { BrushModeController } from './mode-controllers/brush-mode.js';\nimport { ConnectorModeController } from './mode-controllers/connector-mode.js';\nimport { DefaultModeController } from './mode-controllers/default-mode.js';\nimport type { MouseModeController } from './mode-controllers/index.js';\nimport { NoteModeController } from './mode-controllers/note-mode.js';\nimport { PanModeController } from './mode-controllers/pan-mode.js';\nimport { ShapeModeController } from './mode-controllers/shape-mode.js';\nimport { TextModeController } from './mode-controllers/text-mode.js';\nimport {\n  getSelectionBoxBound,\n  getXYWH,\n  isTopLevelBlock,\n  pickTopBlock,\n} from './utils.js';\n\nexport type Selectable = TopLevelBlockModel | PhasorElement;\n\nfunction shouldFilterMouseEvent(event: Event): boolean {\n  const target = event.target;\n  if (!target || !(target instanceof HTMLElement)) {\n    return false;\n  }\n  if (target.tagName === 'INPUT') {\n    return true;\n  }\n  if (target.tagName === 'FORMAT-QUICK-BAR') {\n    return true;\n  }\n  if (target.tagName === 'AFFINE-DRAG-HANDLE') {\n    return true;\n  }\n  return false;\n}\n\nexport interface EdgelessHoverState {\n  rect: DOMRect;\n  content: Selectable;\n}\n\nexport interface EdgelessSelectionState {\n  /* The selected frame or surface element */\n  selected: Selectable[];\n  /* True if the selected content is active (like after double click) */\n  active: boolean;\n}\n\nexport interface SelectionArea {\n  start: DOMPoint;\n  end: DOMPoint;\n}\n\nexport class EdgelessSelectionManager extends AbstractSelectionManager<EdgelessPageBlockComponent> {\n  private _mouseMode: MouseMode = {\n    type: 'default',\n  };\n\n  private _controllers: Record<MouseMode['type'], MouseModeController>;\n\n  /** Latest mouse position in view coords */\n  private _lastMousePos: { x: number; y: number } = { x: 0, y: 0 };\n\n  private _rightClickTimer: {\n    mouseMode: MouseMode;\n    timer: number;\n    timeStamp: number;\n  } | null = null;\n\n  // pressed shift key\n  private _shiftKey = false;\n\n  // selected blocks\n  selectedBlocks: BlockComponentElement[] = [];\n\n  // Cache the last edited elements.\n  lastState: EdgelessSelectionState | null = null;\n\n  // Holds the state of the current selected elements.\n  state: EdgelessSelectionState = {\n    selected: [],\n    active: false,\n  };\n\n  get isActive() {\n    return this.state.active;\n  }\n\n  get lastMousePos() {\n    return this._lastMousePos;\n  }\n\n  get mouseMode() {\n    return this._mouseMode;\n  }\n\n  set mouseMode(mode: MouseMode) {\n    this._mouseMode = mode;\n    // sync mouse mode\n    this._controllers[this._mouseMode.type].mouseMode = this._mouseMode;\n  }\n\n  get currentController() {\n    return this._controllers[this.mouseMode.type];\n  }\n\n  get draggingArea() {\n    if (!this.currentController.draggingArea) return null;\n\n    const { start, end } = this.currentController.draggingArea;\n    const minX = Math.min(start.x, end.x);\n    const minY = Math.min(start.y, end.y);\n    const maxX = Math.max(start.x, end.x);\n    const maxY = Math.max(start.y, end.y);\n    return new DOMRect(minX, minY, maxX - minX, maxY - minY);\n  }\n\n  get shiftKey() {\n    return this._shiftKey;\n  }\n\n  set shiftKey(pressed: boolean) {\n    this._shiftKey = pressed;\n    this.currentController.onPressShiftKey(pressed);\n  }\n\n  constructor(\n    container: EdgelessPageBlockComponent,\n    dispacher: UIEventDispatcher\n  ) {\n    super(container, dispacher);\n\n    this._controllers = {\n      default: new DefaultModeController(this.container),\n      text: new TextModeController(this.container),\n      shape: new ShapeModeController(this.container),\n      brush: new BrushModeController(this.container),\n      pan: new PanModeController(this.container),\n      note: new NoteModeController(this.container),\n      connector: new ConnectorModeController(this.container),\n    };\n\n    this._initMouseAndWheelEvents();\n  }\n\n  private _updateLastMousePos(e: PointerEventState) {\n    this._lastMousePos = {\n      x: e.x,\n      y: e.y,\n    };\n  }\n\n  private async _initMouseAndWheelEvents() {\n    // due to surface initializing after one frame, the events handler should register after that.\n    if (!this.container.surface) {\n      await new Promise(resolve => requestAnimationFrame(resolve));\n    }\n\n    this._add('dragStart', ctx => {\n      const event = ctx.get('pointerState');\n      if (shouldFilterMouseEvent(event.raw)) return;\n      if (\n        !isInsidePageTitle(event.raw.target) &&\n        !isDatabaseInput(event.raw.target) &&\n        !isInsideEdgelessTextEditor(event.raw.target)\n      ) {\n        event.raw.preventDefault();\n      }\n      this._onContainerDragStart(event);\n    });\n    this._add('dragMove', ctx => {\n      const event = ctx.get('pointerState');\n      if (shouldFilterMouseEvent(event.raw)) return;\n      if (\n        !isInsidePageTitle(event.raw.target) &&\n        !isDatabaseInput(event.raw.target) &&\n        !isInsideEdgelessTextEditor(event.raw.target)\n      ) {\n        event.raw.preventDefault();\n      }\n      this._onContainerDragMove(event);\n    });\n    this._add('dragEnd', ctx => {\n      const event = ctx.get('pointerState');\n      if (\n        !isInsidePageTitle(event.raw.target) &&\n        !isDatabaseInput(event.raw.target) &&\n        !isInsideEdgelessTextEditor(event.raw.target)\n      ) {\n        event.raw.preventDefault();\n      }\n      this._onContainerDragEnd(event);\n    });\n    this._add('click', ctx => {\n      const event = ctx.get('pointerState');\n      if (\n        !isInsidePageTitle(event.raw.target) &&\n        !isDatabaseInput(event.raw.target) &&\n        !isInsideEdgelessTextEditor(event.raw.target)\n      ) {\n        event.raw.preventDefault();\n      }\n      this._onContainerClick(event);\n    });\n    this._add('doubleClick', ctx => {\n      const event = ctx.get('pointerState');\n      if (shouldFilterMouseEvent(event.raw)) return;\n      this._onContainerDblClick(event);\n    });\n    this._add('tripleClick', ctx => {\n      const event = ctx.get('pointerState');\n      if (shouldFilterMouseEvent(event.raw)) return;\n      this._onContainerTripleClick(event);\n    });\n    this._add('pointerMove', ctx => {\n      const event = ctx.get('pointerState');\n      if (shouldFilterMouseEvent(event.raw)) return;\n      if (\n        !isInsidePageTitle(event.raw.target) &&\n        !isDatabaseInput(event.raw.target) &&\n        !isInsideEdgelessTextEditor(event.raw.target)\n      ) {\n        event.raw.preventDefault();\n      }\n      this._onContainerPointerMove(event);\n    });\n    this._add('pointerUp', ctx => {\n      const event = ctx.get('pointerState');\n      this._onContainerPointerUp(event);\n    });\n    this._add('pointerOut', ctx => {\n      const event = ctx.get('pointerState');\n      this._onContainerPointerOut(event);\n    });\n    this._add('contextMenu', ctx => {\n      const event = ctx.get('pointerState');\n      this._onContainerContextMenu(event);\n    });\n    this._add('selectionChange', () => {\n      this._onSelectionChangeWithoutDebounce();\n    });\n    this._add('wheel', ctx => {\n      const state = ctx.get('defaultState');\n      const e = state.event;\n      if (!(e instanceof WheelEvent)) return;\n\n      e.preventDefault();\n\n      const container = this.container;\n      const { viewport } = container.surface;\n      // pan\n      if (!isPinchEvent(e)) {\n        const dx = e.deltaX / viewport.zoom;\n        const dy = e.deltaY / viewport.zoom;\n        viewport.applyDeltaCenter(dx, dy);\n        container.slots.viewportUpdated.emit();\n      }\n      // zoom\n      else {\n        const rect = container.getBoundingClientRect();\n        // Perform zooming relative to the mouse position\n        const [baseX, baseY] = container.surface.toModelCoord(\n          e.clientX - rect.x,\n          e.clientY - rect.y\n        );\n\n        const zoom = normalizeWheelDeltaY(e.deltaY, viewport.zoom);\n        viewport.setZoom(zoom, new Point(baseX, baseY));\n        container.slots.viewportUpdated.emit();\n      }\n    });\n  }\n\n  private _add = (name: EventName, fn: UIEventHandler) => {\n    this._disposables.add(this._dispatcher.add(name, fn));\n  };\n\n  private _onContainerDragStart = (e: PointerEventState) => {\n    if (this.page.readonly) return;\n    // do nothing when holding right-key and not in pan mode\n    if (e.button === 2 && this.mouseMode.type !== 'pan') return;\n\n    return this.currentController.onContainerDragStart(e);\n  };\n\n  private _onContainerDragMove = (e: PointerEventState) => {\n    if (this.page.readonly) return;\n    // do nothing when holding right-key and not in pan mode\n    if (e.button === 2 && this.mouseMode.type !== 'pan') return;\n\n    return this.currentController.onContainerDragMove(e);\n  };\n\n  private _onContainerDragEnd = (e: PointerEventState) => {\n    if (this.page.readonly) return;\n    // do nothing when holding right-key and not in pan mode\n    if (e.button === 2 && this.mouseMode.type !== 'pan') return;\n\n    return this.currentController.onContainerDragEnd(e);\n  };\n\n  private _onContainerClick = (e: PointerEventState) => {\n    const container = getEditorContainerByElement(this.container);\n    activeEditorManager.setActive(container);\n    return this.currentController.onContainerClick(e);\n  };\n\n  private _onContainerDblClick = (e: PointerEventState) => {\n    return this.currentController.onContainerDblClick(e);\n  };\n\n  private _onContainerTripleClick = (e: PointerEventState) => {\n    return this.currentController.onContainerTripleClick(e);\n  };\n\n  private _onContainerPointerMove = (e: PointerEventState) => {\n    this._updateLastMousePos(e);\n    this.container.slots.hoverUpdated.emit();\n    return this._controllers[this.mouseMode.type].onContainerMouseMove(e);\n  };\n\n  private _onContainerPointerOut = (e: PointerEventState) => {\n    return this._controllers[this.mouseMode.type].onContainerMouseOut(e);\n  };\n\n  private _onContainerContextMenu = (e: PointerEventState) => {\n    e.raw.preventDefault();\n    const mouseMode = this.mouseMode;\n    if (mouseMode.type !== 'pan' && !this._rightClickTimer) {\n      this._rightClickTimer = {\n        mouseMode,\n        timeStamp: e.raw.timeStamp,\n        timer: window.setTimeout(() => {\n          this._controllers['pan'].onContainerDragStart(e);\n        }, 233),\n      };\n    }\n  };\n\n  private _onContainerPointerUp = (e: PointerEventState) => {\n    if (e.button === 2 && this._rightClickTimer) {\n      const { timer, timeStamp, mouseMode } = this._rightClickTimer;\n      if (e.raw.timeStamp - timeStamp > 233) {\n        this.container.slots.mouseModeUpdated.emit(mouseMode);\n      } else {\n        clearTimeout(timer);\n      }\n      this._rightClickTimer = null;\n    }\n  };\n\n  private _onSelectionChangeWithoutDebounce = () => {\n    updateLocalSelectionRange(this.page);\n  };\n\n  refreshRemoteSelection() {\n    const element = document.querySelector('remote-selection');\n    if (element) {\n      element.requestUpdate();\n    }\n  }\n\n  getHoverState(): EdgelessHoverState | null {\n    if (!this.currentController.enableHover) {\n      return null;\n    }\n    const { surface } = this.container;\n    const frames = (this.page.root?.children ?? []).filter(\n      child => child.flavour === 'affine:frame'\n    ) as TopLevelBlockModel[];\n    const { x, y } = this._lastMousePos;\n    const [modelX, modelY] = surface.toModelCoord(x, y);\n\n    const hovered: Selectable | null =\n      surface.pickTop(modelX, modelY) || pickTopBlock(frames, modelX, modelY);\n\n    // See https://github.com/toeverything/blocksuite/issues/1812\n    if (\n      // if not frame block\n      !isTopLevelBlock(hovered) ||\n      // if in other mouse mode\n      this.mouseMode.type !== 'default' ||\n      // if current selection is not active\n      !this.state.active ||\n      // if current selected block is not the hovered block\n      this.state.selected[0].id !== hovered.id\n    ) {\n      this.container.components.dragHandle?.hide();\n    }\n\n    if (!hovered || this.state.active) {\n      return null;\n    }\n\n    const xywh = getXYWH(hovered);\n    return {\n      rect: getSelectionBoxBound(surface.viewport, xywh),\n      content: hovered,\n    };\n  }\n\n  setMouseMode = (\n    mouseMode: MouseMode,\n    state: EdgelessSelectionState = {\n      selected: [],\n      active: false,\n    }\n  ) => {\n    if (this.mouseMode === mouseMode) return;\n    if (mouseMode.type === 'default') {\n      if (!state.selected.length && this.lastState) {\n        state = this.lastState;\n        this.lastState = null;\n      } else {\n        this.lastState = state;\n      }\n    } else if (this.state.selected.length) {\n      this.lastState = this.state;\n    }\n\n    this.container.slots.mouseModeUpdated.emit(mouseMode);\n    this.container.slots.selectionUpdated.emit(state);\n  };\n\n  switchToDefaultMode(state: EdgelessSelectionState) {\n    this.setMouseMode({ type: 'default' }, state);\n  }\n\n  clear() {\n    this.selectedBlocks = [];\n    this.lastState = null;\n    this.state = {\n      selected: [],\n      active: false,\n    };\n  }\n\n  dispose() {\n    this._disposables.dispose();\n  }\n}\n", "/// <reference types=\"vite/client\" />\nimport './components/edgeless-selected-rect.js';\nimport './toolbar/edgeless-toolbar.js';\n\nimport {\n  BLOCK_ID_ATTR,\n  EDGELESS_BLOCK_CHILD_PADDING,\n} from '@blocksuite/global/config';\nimport { BlockElement } from '@blocksuite/lit';\nimport {\n  compare,\n  deserializeXYWH,\n  generateKeyBetween,\n  generateNKeysBetween,\n  intersects,\n  type PhasorElement,\n  serializeXYWH,\n  SurfaceManager,\n} from '@blocksuite/phasor';\nimport {\n  assertExists,\n  type BaseBlockModel,\n  type Page,\n  Slot,\n} from '@blocksuite/store';\nimport { css, html, nothing } from 'lit';\nimport { customElement, query, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { EdgelessClipboard } from '../../__internal__/clipboard/index.js';\nimport {\n  almostEqual,\n  asyncFocusRichText,\n  type BlockComponentElement,\n  bringForward,\n  getRectByBlockElement,\n  handleNativeRangeAtPoint,\n  type Point,\n  reorder,\n  type ReorderingAction,\n  type ReorderingRange,\n  reorderTo,\n  resetNativeSelection,\n  sendBackward,\n  type TopLevelBlockModel,\n} from '../../__internal__/index.js';\nimport { getService, registerService } from '../../__internal__/service.js';\nimport type { CssVariableName } from '../../__internal__/theme/css-variables.js';\nimport { isCssVariable } from '../../__internal__/theme/css-variables.js';\nimport {\n  getThemePropertyValue,\n  listenToThemeChange,\n} from '../../__internal__/theme/utils.js';\nimport type {\n  BlockHost,\n  DragHandle,\n  FrameBlockModel,\n  MouseMode,\n  PageBlockModel,\n} from '../../index.js';\nimport { PageBlockService } from '../../index.js';\nimport { tryUpdateFrameSize } from '../utils/index.js';\nimport { EdgelessBlockChildrenContainer } from './components/block-children-container.js';\nimport { EdgelessDraggingArea } from './components/dragging-area.js';\nimport { EdgelessHoverRect } from './components/hover-rect.js';\nimport { createDragHandle } from './create-drag-handle.js';\nimport { FrameResizeObserver } from './frame-resize-observer.js';\nimport { bindEdgelessHotkeys } from './hotkey.js';\nimport {\n  EdgelessSelectionManager,\n  type EdgelessSelectionState,\n  type Selectable,\n} from './selection-manager.js';\nimport {\n  EdgelessToolbar,\n  type ZoomAction,\n} from './toolbar/edgeless-toolbar.js';\nimport {\n  DEFAULT_FRAME_HEIGHT,\n  DEFAULT_FRAME_OFFSET_X,\n  DEFAULT_FRAME_OFFSET_Y,\n  DEFAULT_FRAME_WIDTH,\n  getBackgroundGrid,\n  getCursorMode,\n  xywhArrayToObject,\n} from './utils.js';\n\nexport interface EdgelessSelectionSlots {\n  hoverUpdated: Slot;\n  viewportUpdated: Slot;\n  selectionUpdated: Slot<EdgelessSelectionState>;\n  surfaceUpdated: Slot;\n  mouseModeUpdated: Slot<MouseMode>;\n  reorderingFramesUpdated: Slot<ReorderingAction<Selectable>>;\n  reorderingShapesUpdated: Slot<ReorderingAction<Selectable>>;\n  pressShiftKeyUpdated: Slot<boolean>;\n}\n\nexport interface EdgelessContainer extends HTMLElement {\n  readonly page: Page;\n  readonly surface: SurfaceManager;\n  readonly slots: EdgelessSelectionSlots;\n}\n\n@customElement('affine-edgeless-page')\nexport class EdgelessPageBlockComponent\n  extends BlockElement<PageBlockModel>\n  implements EdgelessContainer, BlockHost\n{\n  static override styles = css`\n    .affine-edgeless-page-block-container {\n      position: relative;\n      box-sizing: border-box;\n      overflow: hidden;\n      height: 100%;\n      font-family: var(--affine-font-family);\n      font-size: var(--affine-font-base);\n      line-height: var(--affine-line-height);\n      color: var(--affine-text-primary-color);\n      font-weight: 400;\n    }\n\n    .affine-edgeless-surface-block-container {\n      position: absolute;\n      width: 100%;\n      height: 100%;\n    }\n\n    .affine-edgeless-surface-block-container canvas {\n      width: 100%;\n      height: 100%;\n      position: relative;\n      z-index: 1;\n      pointer-events: none;\n    }\n\n    .affine-block-children-container.edgeless {\n      padding-left: 0;\n      position: relative;\n      overflow: hidden;\n      height: 100%;\n      /**\n       * Fix: pointerEvent stops firing after a short time.\n       * When a gesture is started, the browser intersects the touch-action values of the touched element and its ancestors,\n       * up to the one that implements the gesture (in other words, the first containing scrolling element)\n       * https://developer.mozilla.org/en-US/docs/Web/CSS/touch-action\n       */\n      touch-action: none;\n\n      background-size: var(--affine-edgeless-gap) var(--affine-edgeless-gap);\n      background-position: var(--affine-edgeless-x) var(--affine-edgeless-y);\n      background-color: var(--affine-background-primary-color);\n      background-image: var(--affine-edgeless-grid);\n      z-index: 0;\n    }\n\n    .affine-edgeless-layer {\n      position: absolute;\n      contain: layout style size;\n      transform: translate(var(--affine-edgeless-x), var(--affine-edgeless-y))\n        scale(var(--affine-zoom));\n    }\n\n    .affine-edgeless-hover-rect {\n      position: absolute;\n      border-radius: 0;\n      pointer-events: none;\n      box-sizing: border-box;\n      z-index: 1;\n      border: var(--affine-border-width) solid var(--affine-blue);\n    }\n  `;\n\n  flavour = 'edgeless' as const;\n\n  /**\n   * Shared components\n   */\n  components = {\n    dragHandle: <DragHandle | null>null,\n    toolbar: <EdgelessToolbar | null>null,\n  };\n\n  mouseRoot!: HTMLElement;\n\n  showGrid = true;\n\n  @state()\n  mouseMode: MouseMode = {\n    type: 'default',\n  };\n\n  @state()\n  private _rectsOfSelectedBlocks: DOMRect[] = [];\n\n  @query('.affine-edgeless-surface-block-container')\n  private _surfaceContainer!: HTMLDivElement;\n\n  @query('.affine-edgeless-page-block-container')\n  pageBlockContainer!: HTMLDivElement;\n\n  clipboard = new EdgelessClipboard(this.page, this);\n\n  slots = {\n    viewportUpdated: new Slot(),\n    selectedBlocksUpdated: new Slot<BlockComponentElement[]>(),\n    selectionUpdated: new Slot<EdgelessSelectionState>(),\n    hoverUpdated: new Slot(),\n    surfaceUpdated: new Slot(),\n    mouseModeUpdated: new Slot<MouseMode>(),\n    reorderingFramesUpdated: new Slot<ReorderingAction<Selectable>>(),\n    reorderingShapesUpdated: new Slot<ReorderingAction<Selectable>>(),\n    zoomUpdated: new Slot<ZoomAction>(),\n    pressShiftKeyUpdated: new Slot<boolean>(),\n\n    subpageLinked: new Slot<{ pageId: string }>(),\n    subpageUnlinked: new Slot<{ pageId: string }>(),\n    pageLinkClicked: new Slot<{ pageId: string; blockId?: string }>(),\n  };\n\n  surface!: SurfaceManager;\n\n  indexes: { max: string; min: string } = { max: 'a0', min: 'a0' };\n\n  getService = getService;\n\n  selection!: EdgelessSelectionManager;\n\n  // Gets the top level frames.\n  get frames() {\n    return this.model.children.filter(\n      child => child.flavour === 'affine:frame'\n    ) as TopLevelBlockModel[];\n  }\n\n  // Gets the sorted frames.\n  get sortedFrames() {\n    return this.frames.sort(compare);\n  }\n\n  private _resizeObserver: ResizeObserver | null = null;\n\n  private _frameResizeObserver = new FrameResizeObserver();\n\n  private _clearSelection() {\n    requestAnimationFrame(() => {\n      if (!this.selection.isActive) {\n        resetNativeSelection(null);\n      }\n    });\n  }\n\n  // just init surface, attach to dom later\n  private _initSurface() {\n    const { page, parentElement } = this;\n    const surfaceBlock = this.model.children.find(\n      child => child.flavour === 'affine:surface'\n    );\n    assertExists(parentElement);\n    assertExists(surfaceBlock);\n    const yBlock = page.getYBlockById(surfaceBlock.id);\n    assertExists(yBlock);\n    let yContainer = yBlock.get('elements') as InstanceType<typeof page.YMap>;\n    if (!yContainer) {\n      yContainer = new page.YMap();\n      yBlock.set('elements', yContainer);\n    }\n    this.surface = new SurfaceManager(yContainer, value => {\n      if (isCssVariable(value)) {\n        const cssValue = getThemePropertyValue(\n          parentElement,\n          value as CssVariableName\n        );\n        if (cssValue === undefined) {\n          console.error(\n            new Error(\n              `All variables should have a value. Please check for any dirty data or variable renaming.Variable: ${value}`\n            )\n          );\n        }\n        return cssValue ?? value;\n      }\n      return value;\n    });\n    this._disposables.add(\n      listenToThemeChange(this, () => {\n        this.surface.refresh();\n      })\n    );\n  }\n\n  private _handleToolbarFlag() {\n    const createToolbar = () => {\n      const toolbar = new EdgelessToolbar(this);\n      this.appendChild(toolbar);\n      this.components.toolbar = toolbar;\n    };\n\n    if (\n      this.page.awarenessStore.getFlag('enable_edgeless_toolbar') &&\n      !this.components.toolbar\n    ) {\n      createToolbar();\n    }\n\n    this._disposables.add(\n      this.page.awarenessStore.slots.update.subscribe(\n        msg => msg.state?.flags.enable_edgeless_toolbar,\n        enable => {\n          if (enable) {\n            if (this.components.toolbar) return;\n            createToolbar();\n            return;\n          }\n\n          this.components.toolbar?.remove();\n          this.components.toolbar = null;\n        },\n        {\n          filter: msg => msg.id === this.page.doc.clientID,\n        }\n      )\n    );\n  }\n\n  private _initDragHandle = () => {\n    const createHandle = () => {\n      this.components.dragHandle = createDragHandle(this);\n    };\n    if (\n      this.page.awarenessStore.getFlag('enable_drag_handle') &&\n      !this.components.dragHandle\n    ) {\n      createHandle();\n    }\n    this._disposables.add(\n      this.page.awarenessStore.slots.update.subscribe(\n        msg => msg.state?.flags.enable_drag_handle,\n        enable => {\n          if (enable) {\n            if (this.components.dragHandle) return;\n            createHandle();\n            return;\n          }\n          this.components.dragHandle?.remove();\n          this.components.dragHandle = null;\n        },\n        {\n          filter: msg => msg.id === this.page.doc.clientID,\n        }\n      )\n    );\n  };\n\n  private _initSlotEffects() {\n    // TODO: listen to new children\n    // this.model.children.forEach(frame => {\n    //   frame.propsUpdated.on(() => this.selection.syncDraggingArea());\n    // });\n    const { _disposables, slots } = this;\n    _disposables.add(\n      slots.viewportUpdated.on(() => {\n        const prevZoom = this.style.getPropertyValue('--affine-zoom');\n        const newZoom = this.surface.viewport.zoom;\n        if (!prevZoom || +prevZoom !== newZoom) {\n          this.style.setProperty('--affine-zoom', `${newZoom}`);\n          this.components.dragHandle?.setScale(newZoom);\n        }\n        this.components.dragHandle?.hide();\n        if (this.selection.selectedBlocks.length) {\n          slots.selectedBlocksUpdated.emit([...this.selection.selectedBlocks]);\n        }\n        this.requestUpdate();\n      })\n    );\n    _disposables.add(\n      slots.selectedBlocksUpdated.on(selectedBlocks => {\n        this.selection.selectedBlocks = selectedBlocks;\n        // TODO: remove `requestAnimationFrame`\n        requestAnimationFrame(() => {\n          this._rectsOfSelectedBlocks = selectedBlocks.map(\n            getRectByBlockElement\n          );\n        });\n        // this.requestUpdate();\n      })\n    );\n    _disposables.add(slots.hoverUpdated.on(() => this.requestUpdate()));\n    _disposables.add(\n      slots.selectionUpdated.on(state => {\n        this.selection.state = state;\n        this._clearSelection();\n        this.requestUpdate();\n      })\n    );\n    _disposables.add(slots.surfaceUpdated.on(() => this.requestUpdate()));\n    _disposables.add(\n      slots.mouseModeUpdated.on(mouseMode => {\n        if (mouseMode.type !== 'default') {\n          this.components.dragHandle?.hide();\n        }\n        this.mouseMode = mouseMode;\n      })\n    );\n    _disposables.add(\n      this.page.slots.historyUpdated.on(() => {\n        this._clearSelection();\n        this.requestUpdate();\n      })\n    );\n    _disposables.add(this.selection);\n    _disposables.add(this.surface);\n    _disposables.add(bindEdgelessHotkeys(this));\n\n    _disposables.add(this._frameResizeObserver);\n    _disposables.add(\n      this._frameResizeObserver.slots.resize.on(resizedFrames => {\n        const page = this.page;\n        resizedFrames.forEach((domRect, id) => {\n          const model = page.getBlockById(id) as TopLevelBlockModel;\n          const { index, xywh } = model;\n          const [x, y, w, h] = deserializeXYWH(xywh);\n\n          if (index < this.indexes.min) {\n            this.indexes.min = index;\n          } else if (index > this.indexes.max) {\n            this.indexes.max = index;\n          }\n\n          // ResizeObserver is not effected by CSS transform, so don't deal with viewport zoom.\n          const newModelHeight =\n            domRect.height + EDGELESS_BLOCK_CHILD_PADDING * 2;\n\n          if (!almostEqual(newModelHeight, h)) {\n            page.updateBlock(model, {\n              xywh: JSON.stringify([x, y, w, Math.round(newModelHeight)]),\n            });\n          }\n        });\n\n        // FIXME: force updating selection for triggering re-render `selected-rect`\n        slots.selectionUpdated.emit({ ...this.selection.state });\n      })\n    );\n\n    _disposables.add(slots.reorderingFramesUpdated.on(this.reorderFrames));\n    _disposables.add(slots.reorderingShapesUpdated.on(this.reorderShapes));\n    _disposables.add(\n      slots.zoomUpdated.on((action: ZoomAction) =>\n        this.components.toolbar?.setZoomByAction(action)\n      )\n    );\n    _disposables.add(\n      slots.pressShiftKeyUpdated.on(pressed => {\n        this.selection.shiftKey = pressed;\n        this.requestUpdate();\n      })\n    );\n  }\n\n  /**\n   * Brings to front or sends to back.\n   */\n  private _reorderTo(\n    elements: Selectable[],\n    getIndexes: (elements: Selectable[]) => {\n      start: string | null;\n      end: string | null;\n    },\n    updateIndexes: (keys: string[], elements: Selectable[]) => void\n  ) {\n    reorderTo(\n      elements,\n      compare,\n      getIndexes,\n      (start, end, len) => generateNKeysBetween(start, end, len),\n      updateIndexes\n    );\n  }\n\n  /**\n   * Brings forward or sends backward layer by layer.\n   */\n  private _reorder(\n    elements: Selectable[],\n    getIndexes: (pickedElements: Selectable[]) => {\n      start: string | null;\n      end: string | null;\n    },\n    pick: () => Selectable[],\n    order: (ranges: ReorderingRange[], pickedElements: Selectable[]) => void,\n    updateIndexes: (keys: string[], elements: Selectable[]) => void\n  ) {\n    reorder(\n      elements,\n      compare,\n      pick,\n      getIndexes,\n      order,\n      (start, end, len) => generateNKeysBetween(start, end, len),\n      updateIndexes\n    );\n  }\n\n  updateIndexes(\n    keys: string[],\n    elements: TopLevelBlockModel[],\n    callback: (keys: string[]) => void\n  ) {\n    let index;\n    let i = 0;\n    let element;\n    const len = elements.length;\n    for (; i < len; i++) {\n      index = keys[i];\n      element = elements[i];\n      if (element.index === index) continue;\n      this.page.updateBlock(element, {\n        index,\n      });\n    }\n\n    callback(keys);\n  }\n\n  getSortedElementsWithViewportBounds(elements: Selectable[]) {\n    const bounds = this.surface.viewport.viewportBounds;\n    // TODO: opt filter\n    return this.sortedFrames.filter(element => {\n      if (elements.includes(element)) return true;\n      return intersects(bounds, xywhArrayToObject(element));\n    });\n  }\n\n  // Just update `index`, we don't change the order of the frames in the children.\n  reorderFrames = ({ elements, type }: ReorderingAction<Selectable>) => {\n    const updateIndexes = (keys: string[], elements: Selectable[]) => {\n      this.updateIndexes(keys, elements as TopLevelBlockModel[], keys => {\n        const min = keys[0];\n        if (min < this.indexes.min) {\n          this.indexes.min = min;\n        }\n        const max = keys[keys.length - 1];\n        if (max > this.indexes.max) {\n          this.indexes.max = max;\n        }\n      });\n    };\n\n    switch (type) {\n      case 'front':\n        this._reorderTo(\n          elements,\n          () => ({\n            start: this.indexes.max,\n            end: null,\n          }),\n          updateIndexes\n        );\n        break;\n      case 'forward':\n        this._reorder(\n          elements,\n          (pickedElements: Selectable[]) => ({\n            start: generateKeyBetween(null, pickedElements[0].index),\n            end: null,\n          }),\n          () => this.getSortedElementsWithViewportBounds(elements),\n          bringForward,\n          updateIndexes\n        );\n        break;\n      case 'backward':\n        this._reorder(\n          elements,\n          (pickedElements: Selectable[]) => ({\n            start: null,\n            end: pickedElements[pickedElements.length - 1].index,\n          }),\n          () => this.getSortedElementsWithViewportBounds(elements),\n          sendBackward,\n          updateIndexes\n        );\n        break;\n      case 'back':\n        this._reorderTo(\n          elements,\n          () => ({\n            start: null,\n            end: this.indexes.min,\n          }),\n          updateIndexes\n        );\n        break;\n    }\n  };\n\n  // Just update `index`, we don't change the order of the shapes in the children.\n  reorderShapes = ({ elements, type }: ReorderingAction<Selectable>) => {\n    const updateIndexes = (keys: string[], elements: Selectable[]) => {\n      this.surface.updateIndexes(keys, elements as PhasorElement[], keys => {\n        const min = keys[0];\n        if (min < this.surface.indexes.min) {\n          this.surface.indexes.min = min;\n        }\n        const max = keys[keys.length - 1];\n        if (max > this.surface.indexes.max) {\n          this.surface.indexes.max = max;\n        }\n      });\n    };\n\n    switch (type) {\n      case 'front':\n        this._reorderTo(\n          elements,\n          () => ({\n            start: this.surface.indexes.max,\n            end: null,\n          }),\n          updateIndexes\n        );\n        break;\n      case 'forward':\n        this._reorder(\n          elements,\n          (pickedElements: Selectable[]) => ({\n            start: generateKeyBetween(null, pickedElements[0].index),\n            end: null,\n          }),\n          () => this.surface.getSortedElementsWithViewportBounds(),\n          bringForward,\n          updateIndexes\n        );\n        break;\n      case 'backward':\n        this._reorder(\n          elements,\n          (pickedElements: Selectable[]) => ({\n            start: null,\n            end: pickedElements[pickedElements.length - 1].index,\n          }),\n          () => this.surface.getSortedElementsWithViewportBounds(),\n          sendBackward,\n          updateIndexes\n        );\n        break;\n      case 'back':\n        this._reorderTo(\n          elements,\n          () => ({\n            start: null,\n            end: this.surface.indexes.min,\n          }),\n          updateIndexes\n        );\n        break;\n    }\n  };\n\n  /**\n   * Adds a new frame with the given point on the editor-container.\n   *\n   * @param: point Point\n   * @returns: The id of new frame\n   */\n  addFrameWithPoint(\n    point: Point,\n    options: {\n      width?: number;\n      height?: number;\n      parentId?: string;\n      frameIndex?: number;\n      offsetX?: number;\n      offsetY?: number;\n    } = {}\n  ) {\n    const {\n      width = DEFAULT_FRAME_WIDTH,\n      height = DEFAULT_FRAME_HEIGHT,\n      offsetX = DEFAULT_FRAME_OFFSET_X,\n      offsetY = DEFAULT_FRAME_OFFSET_Y,\n      parentId = this.page.root?.id,\n      frameIndex,\n    } = options;\n    const [x, y] = this.surface.toModelCoord(point.x, point.y);\n    return this.page.addBlock(\n      'affine:frame',\n      {\n        xywh: serializeXYWH(x - offsetX, y - offsetY, width, height),\n        index: this.indexes.max,\n      },\n      parentId,\n      frameIndex\n    );\n  }\n\n  /**\n   * Adds a new frame with the given blocks and point.\n   * @param blocks Array<Partial<BaseBlockModel>>\n   * @param point Point\n   */\n  addNewFrame(\n    blocks: Array<Partial<BaseBlockModel>>,\n    point: Point,\n    options?: {\n      width?: number;\n      height?: number;\n      parentId?: string;\n      frameIndex?: number;\n      offsetX?: number;\n      offsetY?: number;\n    }\n  ) {\n    this.page.captureSync();\n    const { left, top } = this.surface.viewport;\n    point.x -= left;\n    point.y -= top;\n    const frameId = this.addFrameWithPoint(point, options);\n    const ids = this.page.addBlocks(\n      blocks.map(({ flavour, ...blockProps }) => {\n        assertExists(flavour);\n        return {\n          flavour,\n          blockProps,\n        };\n      }),\n      frameId\n    );\n    return {\n      frameId,\n      ids,\n    };\n  }\n\n  /** Moves selected blocks into a new frame at the given point. */\n  moveBlocksWithNewFrame(\n    blocks: BaseBlockModel[],\n    point: Point,\n    {\n      rect,\n      focus,\n      parentId,\n      frameIndex,\n    }: {\n      rect?: DOMRect;\n      focus?: boolean;\n      parentId?: string;\n      frameIndex?: number;\n    } = {}\n  ) {\n    const { left, top, zoom } = this.surface.viewport;\n    const width = rect?.width\n      ? rect.width / zoom + EDGELESS_BLOCK_CHILD_PADDING * 2\n      : DEFAULT_FRAME_WIDTH;\n    point.x -= left;\n    point.y -= top;\n    const frameId = this.addFrameWithPoint(point, {\n      width,\n      parentId,\n      frameIndex,\n    });\n    const frameModel = this.page.getBlockById(frameId) as FrameBlockModel;\n    this.page.moveBlocks(blocks, frameModel);\n\n    focus && this.setSelection(frameId, true, blocks[0].id, point);\n  }\n\n  /*\n   * Set selection state by giving frameId & blockId.\n   * Not supports surface elements.\n   */\n  setSelection(frameId: string, active = true, blockId: string, point?: Point) {\n    const frameBlock = this.frames.find(b => b.id === frameId);\n    assertExists(frameBlock);\n\n    requestAnimationFrame(() => {\n      this.slots.selectedBlocksUpdated.emit([]);\n      this.slots.selectionUpdated.emit({\n        selected: [frameBlock as TopLevelBlockModel],\n        active,\n      });\n      // Waiting dom updated, `frame mask` is removed\n      this.updateComplete.then(() => {\n        if (blockId) {\n          asyncFocusRichText(this.page, blockId);\n        } else if (point) {\n          // Cannot reuse `handleNativeRangeClick` directly here,\n          // since `retargetClick` will re-target to pervious editor\n          handleNativeRangeAtPoint(point.x, point.y);\n        }\n      });\n    });\n  }\n\n  /**\n   * Clear selected blocks.\n   */\n  clearSelectedBlocks() {\n    if (this.selection.selectedBlocks.length) {\n      this.slots.selectedBlocksUpdated.emit([]);\n    }\n  }\n\n  override update(changedProperties: Map<string, unknown>) {\n    if (changedProperties.has('page')) {\n      this._initSurface();\n      this.selection = new EdgelessSelectionManager(\n        this,\n        this.root.uiEventDispatcher\n      );\n    }\n    if (changedProperties.has('mouseMode')) {\n      this.selection.mouseMode = this.mouseMode;\n    }\n    super.update(changedProperties);\n  }\n\n  private _initResizeEffect() {\n    const resizeObserver = new ResizeObserver((_: ResizeObserverEntry[]) => {\n      this.surface.onResize();\n      this.slots.selectedBlocksUpdated.emit([...this.selection.selectedBlocks]);\n      this.slots.selectionUpdated.emit({ ...this.selection.state });\n    });\n    resizeObserver.observe(this.pageBlockContainer);\n    this._resizeObserver = resizeObserver;\n  }\n\n  override firstUpdated() {\n    this._initSlotEffects();\n    this._initDragHandle();\n    this._initResizeEffect();\n    this.clipboard.init(this.page);\n    tryUpdateFrameSize(this.page, this.surface.viewport.zoom);\n\n    requestAnimationFrame(() => {\n      // Should be called in requestAnimationFrame,\n      // so as to avoid DOM mutation in SurfaceManager constructor\n      this.surface.attach(this._surfaceContainer);\n\n      const frame = this.frames.find(child => child.flavour === 'affine:frame');\n      if (frame) {\n        const [modelX, modelY, modelW, modelH] = deserializeXYWH(frame.xywh);\n        this.surface.viewport.setCenter(\n          modelX + modelW / 2,\n          modelY + modelH / 2\n        );\n      }\n\n      this._handleToolbarFlag();\n      this._frameResizeObserver.resetListener(this.page);\n      this.requestUpdate();\n    });\n\n    // XXX: should be called after rich text components are mounted\n    this._clearSelection();\n\n    // should be updated on any frame add and delete\n    this.page.root?.childrenUpdated.on(() => {\n      requestAnimationFrame(() => {\n        this._frameResizeObserver.resetListener(this.page);\n      });\n    });\n  }\n\n  override updated(changedProperties: Map<string, unknown>) {\n    super.updated(changedProperties);\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    registerService('affine:page', PageBlockService);\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    this.mouseRoot = this.parentElement!;\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.clipboard.dispose();\n    this.components.dragHandle?.remove();\n    if (this._resizeObserver) {\n      this._resizeObserver.disconnect();\n      this._resizeObserver = null;\n    }\n  }\n\n  override render() {\n    requestAnimationFrame(() => {\n      this.selection.refreshRemoteSelection();\n    });\n\n    this.setAttribute(BLOCK_ID_ATTR, this.model.id);\n\n    const { mouseMode, page, selection, surface, _rectsOfSelectedBlocks } =\n      this;\n    const { state, draggingArea } = selection;\n    const { viewport } = surface;\n\n    const childrenContainer = EdgelessBlockChildrenContainer(\n      this.sortedFrames,\n      state.active,\n      this.root.renderModel\n    );\n\n    const { zoom, viewportX, viewportY, left, top } = viewport;\n    const draggingAreaTpl = EdgelessDraggingArea(draggingArea);\n\n    const hoverState = selection.getHoverState();\n    const hoverRectTpl = EdgelessHoverRect(hoverState, zoom);\n\n    const { grid, gap, translateX, translateY } = getBackgroundGrid(\n      viewportX,\n      viewportY,\n      zoom,\n      this.showGrid\n    );\n\n    const blockContainerStyle = {\n      cursor: getCursorMode(mouseMode),\n      '--affine-edgeless-gap': `${gap}px`,\n      '--affine-edgeless-grid': grid,\n      '--affine-edgeless-x': `${translateX}px`,\n      '--affine-edgeless-y': `${translateY}px`,\n    };\n\n    return html`\n      <div class=\"affine-edgeless-surface-block-container\">\n        <!-- attach canvas later in Phasor -->\n      </div>\n      <div\n        class=\"affine-edgeless-page-block-container\"\n        style=${styleMap(blockContainerStyle)}\n      >\n        <div class=\"affine-block-children-container edgeless\">\n          <div class=\"affine-edgeless-layer\">${childrenContainer}</div>\n        </div>\n        <affine-selected-blocks\n          .mouseRoot=${this.mouseRoot}\n          .state=${{\n            rects: _rectsOfSelectedBlocks,\n            grab: false,\n          }}\n          .offset=${{\n            x: -left,\n            y: -top,\n          }}\n        ></affine-selected-blocks>\n        ${hoverRectTpl} ${draggingAreaTpl}\n        ${state.selected.length\n          ? html`\n              <edgeless-selected-rect\n                disabled=${mouseMode.type === 'pan'}\n                .page=${page}\n                .state=${state}\n                .slots=${this.slots}\n                .surface=${surface}\n              ></edgeless-selected-rect>\n            `\n          : nothing}\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-edgeless-page': EdgelessPageBlockComponent;\n  }\n}\n", "import type { Text } from '@blocksuite/store';\nimport { BaseBlockModel, defineBlockSchema } from '@blocksuite/store';\nimport { literal } from 'lit/static-html.js';\n\ntype PageProps = {\n  title: Text;\n};\n\nexport class PageBlockModel extends BaseBlockModel<PageProps> {\n  override onCreated() {\n    super.onCreated();\n\n    this.page.slots.blockUpdated.on(({ type }) => {\n      if (type === 'add') {\n        this.page.workspace.setPageMeta(this.page.id, {\n          title: this.title.toString(),\n        });\n      }\n    });\n  }\n}\n\nexport const PageBlockSchema = defineBlockSchema({\n  flavour: 'affine:page',\n  props: (internal): PageProps => ({\n    title: internal.Text(),\n  }),\n  metadata: {\n    version: 2,\n    role: 'root',\n    tag: literal`affine-page`,\n  },\n  toModel: () => new PageBlockModel(),\n});\n", "import type { BlockModels } from '@blocksuite/global/types';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { BaseBlockModel, Page } from '@blocksuite/store';\nimport { Text } from '@blocksuite/store';\nimport type { VRange } from '@blocksuite/virgo';\n\nimport { handleBlockSplit } from '../rich-text/rich-text-operations.js';\nimport { getServiceOrRegister } from '../service.js';\nimport {\n  asyncGetVirgoByModel,\n  type BlockRange,\n  type SerializedBlock,\n} from '../utils/index.js';\n\nexport async function json2block(\n  focusedBlockModel: BaseBlockModel,\n  pastedBlocks: SerializedBlock[],\n  options?: {\n    convertToPastedIfEmpty?: boolean;\n    range?: BlockRange;\n  }\n) {\n  const { convertToPastedIfEmpty = false, range } = options ?? {};\n\n  assertExists(range);\n\n  const { page } = focusedBlockModel;\n  // After deleteModelsByRange, selected block is must only, and selection is must caret\n  const firstBlock = pastedBlocks[0];\n  const lastBlock = pastedBlocks[pastedBlocks.length - 1];\n  const isFocusedBlockEmpty =\n    !focusedBlockModel.text?.length && !convertToPastedIfEmpty;\n  const shouldMergeFirstBlock =\n    !isFocusedBlockEmpty && firstBlock.text && focusedBlockModel.text;\n  const shouldMergeLastBlock = focusedBlockModel.text && lastBlock.text;\n  const parent = page.getParent(focusedBlockModel);\n\n  assertExists(parent);\n  if (pastedBlocks.length === 1) {\n    // TODO: optimize textLength\n    const textLength =\n      firstBlock?.text?.reduce((sum, data) => {\n        return sum + (data.insert?.length || 0);\n      }, 0) ?? 0;\n\n    const shouldSplitBlock = focusedBlockModel.text?.length !== range.endOffset;\n\n    shouldSplitBlock &&\n      (await handleBlockSplit(page, focusedBlockModel, range.startOffset, 0));\n\n    if (shouldMergeFirstBlock) {\n      focusedBlockModel.text?.insertList(\n        firstBlock.text || [],\n        range?.startOffset || 0\n      );\n\n      await addSerializedBlocks(\n        page,\n        firstBlock.children || [],\n        focusedBlockModel,\n        0\n      );\n\n      await setRange(focusedBlockModel, {\n        index: (range?.startOffset ?? 0) + textLength,\n        length: 0,\n      });\n    } else {\n      const [id] = await addSerializedBlocks(\n        page,\n        pastedBlocks,\n        parent,\n        parent.children.indexOf(focusedBlockModel) + 1\n      );\n\n      const model = page.getBlockById(id);\n\n      assertExists(model);\n      if (model.text) {\n        await setRange(model, {\n          index: textLength,\n          length: 0,\n        });\n      } else {\n        // TODO: set embed block selection\n      }\n    }\n\n    isFocusedBlockEmpty && page.deleteBlock(focusedBlockModel);\n    return;\n  }\n\n  await handleBlockSplit(page, focusedBlockModel, range.startOffset, 0);\n\n  if (shouldMergeFirstBlock) {\n    focusedBlockModel.text?.insertList(\n      firstBlock.text || [],\n      range?.startOffset || 0\n    );\n    await addSerializedBlocks(\n      page,\n      firstBlock.children || [],\n      focusedBlockModel,\n      0\n    );\n  }\n\n  const insertPosition =\n    parent.children.indexOf(focusedBlockModel) +\n    (shouldMergeFirstBlock ? 1 : 0);\n\n  const ids = await addSerializedBlocks(\n    page,\n    pastedBlocks.slice(shouldMergeFirstBlock ? 1 : 0),\n    parent,\n    insertPosition\n  );\n\n  isFocusedBlockEmpty && page.deleteBlock(focusedBlockModel);\n\n  const lastModel = page.getBlockById(ids[ids.length - 1]);\n\n  if (shouldMergeLastBlock) {\n    assertExists(lastModel);\n    const rangeOffset = lastModel.text?.length || 0;\n    const nextSiblingModel = page.getNextSibling(lastModel);\n    lastModel.text?.join(nextSiblingModel?.text as Text);\n    assertExists(nextSiblingModel);\n    page.deleteBlock(nextSiblingModel);\n    // Wait for the block's rich text mounted\n    requestAnimationFrame(() => {\n      setRange(lastModel, {\n        index: rangeOffset,\n        length: 0,\n      });\n    });\n  } else {\n    if (lastModel?.text) {\n      setRange(lastModel, {\n        index: lastModel.text.length,\n        length: 0,\n      });\n    } else {\n      // TODO: set embed block selection\n    }\n  }\n}\n\nasync function setRange(model: BaseBlockModel, vRange: VRange) {\n  const vEditor = await asyncGetVirgoByModel(model);\n  assertExists(vEditor);\n  vEditor.setVRange(vRange);\n}\n\nexport async function addSerializedBlocks(\n  page: Page,\n  serializedBlocks: SerializedBlock[],\n  parent: BaseBlockModel,\n  index: number\n) {\n  const addedBlockIds: string[] = [];\n  const pendingModels: { model: BaseBlockModel; json: SerializedBlock }[] = [];\n\n  for (let i = 0; i < serializedBlocks.length; i++) {\n    const json = serializedBlocks[i];\n    const flavour = json.flavour as keyof BlockModels;\n    // XXX: block props should not be written here !!!\n    const blockProps = {\n      flavour,\n      type: json.type as string,\n      checked: json.checked,\n      sourceId: json.sourceId,\n      caption: json.caption,\n      width: json.width,\n      height: json.height,\n      language: json.language,\n      title: json.databaseProps?.title || json.title,\n      titleColumnName: json.databaseProps?.titleColumnName,\n      titleColumnWidth: json.databaseProps?.titleColumnWidth,\n      // bookmark\n      url: json.url,\n      description: json.description,\n      icon: json.icon,\n      image: json.image,\n      crawled: json.crawled,\n    };\n    const id = page.addBlock(flavour, blockProps, parent, index + i);\n    addedBlockIds.push(id);\n    const model = page.getBlockById(id);\n    assertExists(model);\n\n    const initialProps =\n      model?.flavour && page.getInitialPropsByFlavour(model?.flavour);\n    if (initialProps && initialProps.text instanceof Text) {\n      json.text && model?.text?.applyDelta(json.text);\n    }\n\n    if (model && json.children.length) {\n      await addSerializedBlocks(page, json.children, model, 0);\n      pendingModels.push({ model, json });\n    }\n  }\n\n  for (const { model, json } of pendingModels) {\n    const flavour = model.flavour as keyof BlockModels;\n    const service = await getServiceOrRegister(flavour);\n    service.onBlockPasted(model, {\n      rowIds: json.databaseProps?.rowIds,\n      cells: json.databaseProps?.cells,\n      columns: json.databaseProps?.columns,\n    });\n  }\n\n  return addedBlockIds;\n}\n", "import { ALLOW_DEFAULT, PREVENT_DEFAULT } from '@blocksuite/global/config';\nimport { assertExists, isEqual, matchFlavours } from '@blocksuite/global/utils';\nimport type { BaseBlockModel, Page } from '@blocksuite/store';\nimport type { VRange } from '@blocksuite/virgo';\n\nimport { getStandardLanguage } from '../../code-block/utils/code-languages.js';\nimport { FALLBACK_LANG } from '../../code-block/utils/consts.js';\nimport {\n  asyncSetVRange,\n  convertToDivider,\n  convertToList,\n  convertToParagraph,\n  type ExtendedModel,\n} from '../utils/index.js';\nimport type { AffineVEditor } from './virgo/types.js';\n\ntype Match = {\n  name: string;\n  pattern: RegExp;\n  action: (\n    model: BaseBlockModel,\n    vEditor: AffineVEditor,\n    text: string,\n    selection: VRange,\n    pattern: RegExp\n  ) => boolean;\n};\n\nconst matches: Match[] = [\n  {\n    name: 'bolditalic',\n    pattern: /(?:\\*){3}(.+?)(?:\\*){3}$/g,\n    action: (\n      model: BaseBlockModel,\n      vEditor: AffineVEditor,\n      text: string,\n      selection: VRange,\n      pattern: RegExp\n    ) => {\n      const match = pattern.exec(text);\n      if (!match) {\n        return false;\n      }\n\n      const annotatedText = match[0];\n      const startIndex = selection.index - annotatedText.length;\n\n      if (text.match(/^([* \\n]+)$/g)) {\n        return false;\n      }\n\n      vEditor.insertText(\n        {\n          index: startIndex + annotatedText.length,\n          length: 0,\n        },\n        ' '\n      );\n\n      model.page.captureSync();\n\n      vEditor.formatText(\n        {\n          index: startIndex,\n          length: annotatedText.length,\n        },\n        {\n          bold: true,\n          italic: true,\n        }\n      );\n\n      vEditor.deleteText({\n        index: startIndex + annotatedText.length,\n        length: 1,\n      });\n      vEditor.deleteText({\n        index: startIndex + annotatedText.length - 3,\n        length: 3,\n      });\n      vEditor.deleteText({\n        index: startIndex,\n        length: 3,\n      });\n\n      vEditor.setVRange({\n        index: startIndex + annotatedText.length - 6,\n        length: 0,\n      });\n\n      return true;\n    },\n  },\n  {\n    name: 'bold',\n    pattern: /(?:\\*){2}(.+?)(?:\\*){2}$/g,\n    action: (\n      model: BaseBlockModel,\n      vEditor: AffineVEditor,\n      text: string,\n      selection: VRange,\n      pattern: RegExp\n    ) => {\n      const match = pattern.exec(text);\n      if (!match) {\n        return false;\n      }\n      const annotatedText = match[0];\n      const startIndex = selection.index - annotatedText.length;\n\n      if (text.match(/^([* \\n]+)$/g)) {\n        return false;\n      }\n\n      vEditor.insertText(\n        {\n          index: startIndex + annotatedText.length,\n          length: 0,\n        },\n        ' '\n      );\n      model.page.captureSync();\n      vEditor.formatText(\n        {\n          index: startIndex,\n          length: annotatedText.length,\n        },\n        {\n          bold: true,\n        }\n      );\n\n      vEditor.deleteText({\n        index: startIndex + annotatedText.length,\n        length: 1,\n      });\n      vEditor.deleteText({\n        index: startIndex + annotatedText.length - 2,\n        length: 2,\n      });\n      vEditor.deleteText({\n        index: startIndex,\n        length: 2,\n      });\n\n      vEditor.setVRange({\n        index: startIndex + annotatedText.length - 4,\n        length: 0,\n      });\n\n      return true;\n    },\n  },\n  {\n    name: 'italic',\n    pattern: /(?:\\*){1}(.+?)(?:\\*){1}$/g,\n    action: (\n      model: BaseBlockModel,\n      vEditor: AffineVEditor,\n      text: string,\n      selection: VRange,\n      pattern: RegExp\n    ) => {\n      const match = pattern.exec(text);\n      if (!match) {\n        return false;\n      }\n      const annotatedText = match[0];\n      const startIndex = selection.index - annotatedText.length;\n\n      if (text.match(/^([* \\n]+)$/g)) {\n        return false;\n      }\n\n      vEditor.insertText(\n        {\n          index: startIndex + annotatedText.length,\n          length: 0,\n        },\n        ' '\n      );\n      model.page.captureSync();\n      vEditor.formatText(\n        {\n          index: startIndex,\n          length: annotatedText.length,\n        },\n        {\n          italic: true,\n        }\n      );\n\n      vEditor.deleteText({\n        index: startIndex + annotatedText.length,\n        length: 1,\n      });\n      vEditor.deleteText({\n        index: startIndex + annotatedText.length - 1,\n        length: 1,\n      });\n      vEditor.deleteText({\n        index: startIndex,\n        length: 1,\n      });\n\n      vEditor.setVRange({\n        index: startIndex + annotatedText.length - 2,\n        length: 0,\n      });\n\n      return true;\n    },\n  },\n  {\n    name: 'strikethrough',\n    pattern: /(?:~~)(.+?)(?:~~)$/g,\n    action: (\n      model: BaseBlockModel,\n      vEditor: AffineVEditor,\n      text: string,\n      selection: VRange,\n      pattern: RegExp\n    ) => {\n      const match = pattern.exec(text);\n      if (!match) {\n        return false;\n      }\n      const annotatedText = match[0];\n      const startIndex = selection.index - annotatedText.length;\n\n      if (text.match(/^([* \\n]+)$/g)) {\n        return false;\n      }\n\n      vEditor.insertText(\n        {\n          index: startIndex + annotatedText.length,\n          length: 0,\n        },\n        ' '\n      );\n      model.page.captureSync();\n      vEditor.formatText(\n        {\n          index: startIndex,\n          length: annotatedText.length,\n        },\n        {\n          strike: true,\n        }\n      );\n\n      vEditor.deleteText({\n        index: startIndex + annotatedText.length,\n        length: 1,\n      });\n      vEditor.deleteText({\n        index: startIndex + annotatedText.length - 2,\n        length: 2,\n      });\n      vEditor.deleteText({\n        index: startIndex,\n        length: 2,\n      });\n\n      vEditor.setVRange({\n        index: startIndex + annotatedText.length - 4,\n        length: 0,\n      });\n\n      return true;\n    },\n  },\n  {\n    name: 'underthrough',\n    pattern: /(?:~)(.+?)(?:~)$/g,\n    action: (\n      model: BaseBlockModel,\n      vEditor: AffineVEditor,\n      text: string,\n      selection: VRange,\n      pattern: RegExp\n    ) => {\n      const match = pattern.exec(text);\n      if (!match) {\n        return false;\n      }\n      const annotatedText = match[0];\n      const startIndex = selection.index - annotatedText.length;\n\n      if (text.match(/^([* \\n]+)$/g)) {\n        return false;\n      }\n\n      vEditor.insertText(\n        {\n          index: startIndex + annotatedText.length,\n          length: 0,\n        },\n        ' '\n      );\n      model.page.captureSync();\n      vEditor.formatText(\n        {\n          index: startIndex,\n          length: annotatedText.length,\n        },\n        {\n          underline: true,\n        }\n      );\n\n      vEditor.deleteText({\n        index: startIndex + annotatedText.length,\n        length: 1,\n      });\n      vEditor.deleteText({\n        index: selection.index - 1,\n        length: 1,\n      });\n      vEditor.deleteText({\n        index: startIndex,\n        length: 1,\n      });\n\n      vEditor.setVRange({\n        index: startIndex + annotatedText.length - 2,\n        length: 0,\n      });\n\n      return true;\n    },\n  },\n  {\n    name: 'code',\n    pattern: /(?:`)(`{2,}?|[^`]+)(?:`)$/g,\n    action: (\n      model: BaseBlockModel,\n      vEditor: AffineVEditor,\n      text: string,\n      selection: VRange,\n      pattern: RegExp\n    ) => {\n      const match = pattern.exec(text);\n      if (!match) {\n        return false;\n      }\n      const annotatedText = match[0];\n      const startIndex = selection.index - annotatedText.length;\n\n      if (text.match(/^([* \\n]+)$/g)) {\n        return false;\n      }\n\n      vEditor.insertText(\n        {\n          index: startIndex + annotatedText.length,\n          length: 0,\n        },\n        ' '\n      );\n      model.page.captureSync();\n      vEditor.formatText(\n        {\n          index: startIndex,\n          length: annotatedText.length,\n        },\n        {\n          code: true,\n        }\n      );\n\n      vEditor.deleteText({\n        index: startIndex + annotatedText.length,\n        length: 1,\n      });\n      vEditor.deleteText({\n        index: startIndex + annotatedText.length - 1,\n        length: 1,\n      });\n      vEditor.deleteText({\n        index: startIndex,\n        length: 1,\n      });\n\n      vEditor.setVRange({\n        index: startIndex + annotatedText.length - 2,\n        length: 0,\n      });\n\n      return true;\n    },\n  },\n  {\n    name: 'codeblock',\n    pattern: /^```([a-zA-Z0-9]*)$/g,\n    action: (\n      model: BaseBlockModel,\n      vEditor: AffineVEditor,\n      text: string,\n      selection: VRange,\n      pattern: RegExp\n    ) => {\n      if (model.flavour === 'affine:paragraph' && model.type === 'quote') {\n        return false;\n      }\n      const match = pattern.exec(text);\n      const page = model.page;\n      page.captureSync();\n      const parent = page.getParent(model);\n      assertExists(parent);\n      const index = parent.children.indexOf(model);\n      page.deleteBlock(model);\n\n      const codeId = page.addBlock(\n        'affine:code',\n        {\n          language: getStandardLanguage(match?.[1] || '')?.id ?? FALLBACK_LANG,\n        },\n        parent,\n        index\n      );\n\n      const codeBlock = page.getBlockById(codeId);\n      assertExists(codeBlock);\n      asyncSetVRange(codeBlock, { index: 0, length: 0 });\n\n      return true;\n    },\n  },\n  {\n    name: 'link',\n    pattern: /(?:\\[(.+?)\\])(?:\\((.+?)\\))$/g,\n    action: (\n      model: BaseBlockModel,\n      vEditor: AffineVEditor,\n      text: string,\n      selection: VRange,\n      pattern: RegExp\n    ) => {\n      const startIndex = text.search(pattern);\n      const matchedText = text.match(pattern)?.[0];\n      const hrefText = text.match(/(?:\\[(.*?)\\])/g)?.[0];\n      const hrefLink = text.match(/(?:\\((.*?)\\))/g)?.[0];\n      if (startIndex === -1 || !matchedText || !hrefText || !hrefLink) {\n        return false;\n      }\n      const start = selection.index - matchedText.length;\n\n      vEditor.insertText(\n        {\n          index: selection.index,\n          length: 0,\n        },\n        ' '\n      );\n      model.page.captureSync();\n      vEditor.formatText(\n        {\n          index: start,\n          length: hrefText.length,\n        },\n        {\n          link: hrefLink.slice(1, hrefLink.length - 1),\n        }\n      );\n\n      vEditor.deleteText({\n        index: selection.index + matchedText.length,\n        length: 1,\n      });\n      vEditor.deleteText({\n        index: selection.index - hrefLink.length - 1,\n        length: hrefLink.length + 1,\n      });\n      vEditor.deleteText({\n        index: start,\n        length: 1,\n      });\n\n      vEditor.setVRange({\n        index: start + hrefText.length - 1,\n        length: 0,\n      });\n\n      return true;\n    },\n  },\n];\n\n/**\n * Returns true if markdown matches and converts to the appropriate format\n */\nexport function markdownConvert(\n  vEditor: AffineVEditor,\n  model: BaseBlockModel,\n  prefix: string\n): boolean {\n  const vRange = vEditor.getVRange();\n  if (!vRange) {\n    return false;\n  }\n\n  for (const match of matches) {\n    const matchedText = prefix.match(match.pattern);\n    if (matchedText) {\n      return match.action(model, vEditor, prefix, vRange, match.pattern);\n    }\n  }\n  return false;\n}\n\nexport function tryMatchSpaceHotkey(\n  page: Page,\n  model: ExtendedModel,\n  vEditor: AffineVEditor,\n  prefix: string,\n  range: { index: number; length: number }\n) {\n  const [, offset] = vEditor.getLine(range.index);\n  if (offset > prefix.length) {\n    return ALLOW_DEFAULT;\n  }\n  const isParagraphQuoteBlock = isEqual(model.type, 'quote');\n  const isCodeBlock = matchFlavours(model, ['affine:code']);\n  if (isParagraphQuoteBlock || isCodeBlock) {\n    return ALLOW_DEFAULT;\n  }\n  let isConverted = false;\n  switch (prefix.trim()) {\n    case '[]':\n    case '[ ]':\n      isConverted = convertToList(page, model, 'todo', prefix, {\n        checked: false,\n      });\n      break;\n    case '[x]':\n      isConverted = convertToList(page, model, 'todo', prefix, {\n        checked: true,\n      });\n      break;\n    case '-':\n    case '*':\n      isConverted = convertToList(page, model, 'bulleted', prefix);\n      break;\n    case '***':\n    case '---':\n      isConverted = convertToDivider(page, model, prefix);\n      break;\n    case '#':\n      isConverted = convertToParagraph(page, model, 'h1', prefix);\n      break;\n    case '##':\n      isConverted = convertToParagraph(page, model, 'h2', prefix);\n      break;\n    case '###':\n      isConverted = convertToParagraph(page, model, 'h3', prefix);\n      break;\n    case '####':\n      isConverted = convertToParagraph(page, model, 'h4', prefix);\n      break;\n    case '#####':\n      isConverted = convertToParagraph(page, model, 'h5', prefix);\n      break;\n    case '######':\n      isConverted = convertToParagraph(page, model, 'h6', prefix);\n      break;\n    case '>':\n      isConverted = convertToParagraph(page, model, 'quote', prefix);\n      break;\n    default:\n      isConverted = convertToList(page, model, 'numbered', prefix);\n  }\n\n  return isConverted ? PREVENT_DEFAULT : ALLOW_DEFAULT;\n}\n", "import { ALLOW_DEFAULT, PREVENT_DEFAULT } from '@blocksuite/global/config';\nimport { assertExists, matchFlavours } from '@blocksuite/global/utils';\nimport type { BaseBlockModel } from '@blocksuite/store';\nimport type { VRange } from '@blocksuite/virgo';\n\nimport type { BindingContext } from '../rich-text/keyboard.js';\nimport {\n  markdownConvert,\n  tryMatchSpaceHotkey,\n} from '../rich-text/markdown-convert.js';\nimport {\n  handleBlockEndEnter,\n  handleBlockSplit,\n  handleLineStartBackspace,\n  handleSoftEnter,\n  handleUnindent,\n} from '../rich-text/rich-text-operations.js';\nimport type { AffineVEditor } from '../rich-text/virgo/types.js';\nimport { isCollapsedAtBlockStart } from '../utils/index.js';\n\nexport function onSoftEnter(\n  model: BaseBlockModel,\n  range: VRange,\n  vEditor: AffineVEditor\n) {\n  handleSoftEnter(model.page, model, range.index, range.length);\n  vEditor.setVRange({\n    index: range.index + 1,\n    length: 0,\n  });\n  return PREVENT_DEFAULT;\n}\n\nexport function hardEnter(\n  model: BaseBlockModel,\n  range: VRange,\n  /**\n   * @deprecated\n   */\n  vEditor: AffineVEditor,\n  e: KeyboardEvent,\n  shortKey = false\n) {\n  const page = model.page;\n  e.stopPropagation();\n  const parent = page.getParent(model);\n  const isLastChild = parent?.lastChild() === model;\n  const isEmptyList =\n    matchFlavours(model, ['affine:list']) && model.text.length === 0;\n\n  assertExists(model.text, 'Failed to hardEnter! model.text not exists!');\n\n  if (\n    isEmptyList &&\n    parent &&\n    matchFlavours(parent, ['affine:frame', 'affine:database']) &&\n    model.children.length === 0\n  ) {\n    // TODO use `handleLineStartBackspace` directly is not concise enough,\n    // we should extract a function to handle this case\n    //\n    // Before\n    // - list\n    // - | <-- press Enter\n    //\n    // After\n    // - list\n    // |   <-- will replace with a new text block\n    handleLineStartBackspace(page, model);\n    return PREVENT_DEFAULT;\n  }\n  if (isEmptyList && isLastChild) {\n    // Before\n    // - line1\n    //   -  <-- press Enter\n    //\n    // After\n    // - line1\n    // - | <-- will unindent the block\n    handleUnindent(page, model, range.index);\n    return PREVENT_DEFAULT;\n  }\n\n  const isEnd = model.text.length === range.index;\n  if (isEnd || shortKey) {\n    const softEnterable = isSoftEnterable(model);\n    const textStr = model.text.toString();\n    const endWithTwoBlankLines = textStr === '\\n' || textStr.endsWith('\\n');\n    const shouldSoftEnter = softEnterable && !endWithTwoBlankLines;\n\n    if (shouldSoftEnter) {\n      // TODO handle ctrl+enter in code/quote block or other force soft enter block\n      onSoftEnter(model, range, vEditor);\n      return PREVENT_DEFAULT;\n    }\n\n    // delete the \\n at the end of block\n    if (softEnterable) {\n      // Before\n      // >\n      // >  <-- press Enter\n      //\n      // After\n      // - line1\n      // - | <-- will unindent the block\n      model.text.delete(range.index - 1, 1);\n    }\n    handleBlockEndEnter(page, model);\n    return PREVENT_DEFAULT;\n  }\n\n  const isSoftEnterBlock = isSoftEnterable(model);\n  if (isSoftEnterBlock) {\n    onSoftEnter(model, range, vEditor);\n    return PREVENT_DEFAULT;\n  }\n\n  handleBlockSplit(page, model, range.index, range.length);\n  return PREVENT_DEFAULT;\n}\n\n// If a block is soft enterable, the rule is:\n// 1. In the end of block, first press Enter will insert a \\n to break the line, second press Enter will insert a new block\n// 2. In the middle and start of block, press Enter will insert a \\n to break the line\n// TODO this should be configurable per-block\nfunction isSoftEnterable(model: BaseBlockModel) {\n  if (matchFlavours(model, ['affine:code'])) return true;\n  if (matchFlavours(model, ['affine:paragraph'])) {\n    return model.type === 'quote';\n  }\n  return false;\n}\n\nexport function enterMarkdownMatch(\n  model: BaseBlockModel,\n  virgo: AffineVEditor,\n  range: VRange,\n  context: BindingContext\n) {\n  const { prefix } = context;\n  markdownConvert(virgo, model, prefix);\n  return ALLOW_DEFAULT;\n}\n\nexport function spaceMarkdownMatch(\n  model: BaseBlockModel,\n  virgo: AffineVEditor,\n  range: VRange,\n  context: BindingContext\n) {\n  const { prefix } = context;\n  return markdownConvert(virgo, model, prefix)\n    ? PREVENT_DEFAULT\n    : ALLOW_DEFAULT;\n}\n\nexport function onSpace(\n  model: BaseBlockModel,\n  virgo: AffineVEditor,\n  range: VRange,\n  context: BindingContext\n) {\n  const { prefix } = context;\n  return tryMatchSpaceHotkey(model.page, model, virgo, prefix, range);\n}\n\nexport function onBackspace(\n  model: BaseBlockModel,\n  e: KeyboardEvent,\n  vEditor: AffineVEditor\n) {\n  e.stopPropagation();\n  if (isCollapsedAtBlockStart(vEditor)) {\n    handleLineStartBackspace(model.page, model);\n    return PREVENT_DEFAULT;\n  }\n  return ALLOW_DEFAULT;\n}\n\nexport function onKeyLeft(e: KeyboardEvent, range: VRange) {\n  // range.length === 0 means collapsed selection\n  if (range.length !== 0) {\n    e.stopPropagation();\n    return ALLOW_DEFAULT;\n  }\n  const lineStart = range.index === 0;\n  if (!lineStart) {\n    e.stopPropagation();\n    return ALLOW_DEFAULT;\n  }\n  // Need jump to previous block\n  return PREVENT_DEFAULT;\n}\n\nexport function onKeyRight(\n  model: BaseBlockModel,\n  e: KeyboardEvent,\n  range: VRange\n) {\n  if (range.length !== 0) {\n    e.stopPropagation();\n    return ALLOW_DEFAULT;\n  }\n  assertExists(model.text, 'Failed to onKeyRight! model.text not exists!');\n  const textLength = model.text.length;\n  const lineEnd = textLength === range.index;\n  if (!lineEnd) {\n    e.stopPropagation();\n    return ALLOW_DEFAULT;\n  }\n  // Need jump to next block\n  return PREVENT_DEFAULT;\n}\n", "import { PREVENT_DEFAULT } from '@blocksuite/global/config';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { BaseBlockModel, DeltaOperation } from '@blocksuite/store';\n\nimport type { KeyboardBindings } from '../rich-text/keyboard.js';\nimport {\n  handleIndent,\n  handleKeyDown,\n  handleKeyUp,\n  handleUnindent,\n} from '../rich-text/rich-text-operations.js';\nimport type { AffineVEditor } from '../rich-text/virgo/types.js';\nimport { getService } from '../service.js';\nimport type {\n  BlockRange,\n  BlockTransformContext,\n  SerializedBlock,\n} from '../utils/index.js';\nimport { supportsChildren } from '../utils/std.js';\nimport { json2block } from './json2block.js';\nimport {\n  enterMarkdownMatch,\n  hardEnter,\n  onBackspace,\n  onKeyLeft,\n  onKeyRight,\n  onSoftEnter,\n  onSpace,\n  spaceMarkdownMatch,\n} from './keymap.js';\n\nexport class BaseService<BlockModel extends BaseBlockModel = BaseBlockModel> {\n  block2html(\n    block: BlockModel,\n    { childText = '', begin, end }: BlockTransformContext = {}\n  ): string {\n    const delta = block.text?.sliceToDelta(begin || 0, end) || [];\n    const text = delta.reduce((html: string, item: DeltaOperation) => {\n      return html + BaseService.deltaLeaf2Html(block, item);\n    }, '');\n    return `${text}${childText}`;\n  }\n\n  block2Text(\n    block: BlockModel,\n    { childText = '', begin = 0, end }: BlockTransformContext = {}\n  ): string {\n    const text = (block.text?.toString() || '').slice(begin, end);\n    return `${text}${childText}`;\n  }\n\n  block2Json(block: BlockModel, begin?: number, end?: number): SerializedBlock {\n    const delta = block.text?.sliceToDelta(begin || 0, end) || [];\n    return {\n      flavour: block.flavour,\n      type: block.type as string,\n      text: delta,\n      children: block.children?.map((child, index) => {\n        if (index === block.children.length - 1) {\n          // @ts-ignore\n          return getService(child.flavour).block2Json(child, 0, end);\n        }\n        // @ts-ignore\n        return getService(child.flavour).block2Json(child);\n      }),\n    };\n  }\n\n  // json2block is triggered when paste behavior occurs(now),\n  // at this time cursor is focus on one block, and is must a caret in this block(since selection has been handled in paste callback)\n  // this is the common handler for most block, but like code block, it should be overridden this\n  async json2Block(\n    focusedBlockModel: BlockModel,\n    pastedBlocks: SerializedBlock[],\n    range?: BlockRange\n  ) {\n    return json2block(focusedBlockModel, pastedBlocks, { range });\n  }\n\n  async onBlockPasted(\n    model: BlockModel,\n    clipboardData: Record<string, unknown>\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n  ) {}\n\n  private static deltaLeaf2Html(\n    block: BaseBlockModel,\n    deltaLeaf: DeltaOperation\n  ) {\n    let text = deltaLeaf.insert ?? '';\n    // replace unsafe characters\n    text = text\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#039;');\n\n    const attributes = deltaLeaf.attributes;\n    if (!attributes) {\n      return text;\n    }\n    if (attributes.code) {\n      text = `<code>${text}</code>`;\n    }\n    if (attributes.bold) {\n      text = `<strong>${text}</strong>`;\n    }\n    if (attributes.italic) {\n      text = `<em>${text}</em>`;\n    }\n    if (attributes.underline) {\n      text = `<u>${text}</u>`;\n    }\n    if (attributes.strikethrough) {\n      text = `<s>${text}</s>`;\n    }\n    if (attributes.link) {\n      text = `<a href=\"${attributes.link}\">${text}</a>`;\n    }\n    if (attributes.reference) {\n      const refPageId = attributes.reference.pageId;\n      const workspace = block.page.workspace;\n      const pageMeta = workspace.meta.pageMetas.find(\n        page => page.id === refPageId\n      );\n      const host = window.location.origin;\n      // maybe should use public link at here?\n      const referenceLink = `${host}/workspace/${workspace.id}/${refPageId}`;\n      const referenceTitle = pageMeta ? pageMeta.title : 'Deleted page';\n      text = `<a href=\"${referenceLink}\">${referenceTitle}</a>`;\n    }\n    return text;\n  }\n\n  /**\n   * side effect when update block\n   */\n  async updateEffect(block: BlockModel) {\n    const handleUnindent = (\n      await import('../rich-text/rich-text-operations.js')\n    ).handleUnindent;\n    // we need to unindent the first child of the block if it not\n    // supports children\n    if (supportsChildren(block)) {\n      return;\n    }\n\n    if (!block.children.length) {\n      return;\n    }\n\n    handleUnindent(block.page, block.children[0], 0, false);\n  }\n\n  defineKeymap(block: BlockModel, virgo: AffineVEditor): KeyboardBindings {\n    return {\n      enterMarkdownMatch: {\n        key: 'Enter',\n        handler: (range, context) => {\n          assertExists(virgo);\n          return enterMarkdownMatch(block, virgo, range, context);\n        },\n      },\n      spaceMarkdownMatch: {\n        key: ' ',\n        handler(range, context) {\n          assertExists(virgo);\n          return spaceMarkdownMatch(block, virgo, range, context);\n        },\n      },\n      hardEnter: {\n        key: 'Enter',\n        handler(range, context) {\n          assertExists(virgo);\n          return hardEnter(block, range, virgo, context.event);\n        },\n      },\n      softEnter: {\n        key: 'Enter',\n        shiftKey: true,\n        handler(range, context) {\n          assertExists(virgo);\n          return onSoftEnter(block, range, virgo);\n        },\n      },\n      // shortKey+enter\n      insertLineAfter: {\n        key: 'Enter',\n        shortKey: true,\n        handler(range, context) {\n          assertExists(virgo);\n          return hardEnter(block, range, virgo, context.event, true);\n        },\n      },\n      tab: {\n        key: 'Tab',\n        handler(range, context) {\n          const index = range.index;\n          handleIndent(block.page, block, index);\n          context.event.stopPropagation();\n          return PREVENT_DEFAULT;\n        },\n      },\n      shiftTab: {\n        key: 'Tab',\n        shiftKey: true,\n        handler(range, context) {\n          const index = range.index;\n          handleUnindent(block.page, block, index);\n          context.event.stopPropagation();\n          return PREVENT_DEFAULT;\n        },\n      },\n      backspace: {\n        key: 'Backspace',\n        handler(range, context) {\n          return onBackspace(block, context.event, this.vEditor);\n        },\n      },\n      up: {\n        key: 'ArrowUp',\n        shiftKey: false,\n        handler(range, context) {\n          return handleKeyUp(context.event, this.vEditor.rootElement);\n        },\n      },\n      down: {\n        key: 'ArrowDown',\n        shiftKey: false,\n        handler(range, context) {\n          return handleKeyDown(block, context.event, this.vEditor.rootElement);\n        },\n      },\n      left: {\n        key: 'ArrowLeft',\n        shiftKey: false,\n        handler(range, context) {\n          return onKeyLeft(context.event, range);\n        },\n      },\n      right: {\n        key: 'ArrowRight',\n        shiftKey: false,\n        handler(range, context) {\n          return onKeyRight(block, context.event, range);\n        },\n      },\n      inputRule: {\n        key: ' ',\n        shiftKey: null,\n        prefix: /^(\\d+\\.|-|\\*|\\[ ?\\]|\\[x\\]|(#){1,6}|(-){3}|(\\*){3}|>)$/,\n        handler(range, context) {\n          return onSpace(block, virgo, range, context);\n        },\n      },\n    };\n  }\n}\n", "import type { BaseBlockModel } from '@blocksuite/store';\nimport { assertExists } from '@blocksuite/store';\n\nimport { getService } from '../__internal__/service.js';\nimport { BaseService } from '../__internal__/service/index.js';\nimport type {\n  BlockTransformContext,\n  SerializedBlock,\n} from '../__internal__/utils/index.js';\nimport type { PageBlockModel } from './page-model.js';\n\nexport class PageBlockService extends BaseService<PageBlockModel> {\n  override block2html(\n    block: PageBlockModel,\n    { childText = '', begin, end }: BlockTransformContext = {}\n  ) {\n    return `<div>${block.title.toString()}${childText}</div>`;\n  }\n\n  override block2Text(\n    block: PageBlockModel,\n    { childText = '', begin, end }: BlockTransformContext = {}\n  ) {\n    const text = (block.title.toString() || '').slice(begin || 0, end);\n    return `${text}${childText}`;\n  }\n\n  // todo we don't support link and database in page block title\n  private _getAllSubTexts(block: SerializedBlock) {\n    if (block.flavour === 'affine:database') {\n      return [];\n    }\n    const texts = (block.text || []).filter(text => !text.attributes?.link);\n    if (block.children) {\n      block.children.forEach(child => {\n        texts.push(...this._getAllSubTexts(child));\n      });\n    }\n    return texts;\n  }\n\n  override async json2Block(\n    focusedBlockModel: BaseBlockModel,\n    pastedBlocks: SerializedBlock[]\n  ) {\n    if (\n      pastedBlocks.length > 0 &&\n      (pastedBlocks[0].children.length === 0 ||\n        pastedBlocks[0].flavour === 'affine:page')\n    ) {\n      const titles = this._getAllSubTexts(pastedBlocks[0]);\n\n      (focusedBlockModel as PageBlockModel).title.applyDelta(titles);\n      pastedBlocks = pastedBlocks.slice(1);\n    }\n    // this is page block empty case\n    const frameId = focusedBlockModel.page.addBlock(\n      'affine:frame',\n      {},\n      focusedBlockModel.id\n    );\n    const frameModel = focusedBlockModel.page.getBlockById(frameId);\n    assertExists(frameModel);\n    const service = getService('affine:frame');\n    return service.json2Block(frameModel, pastedBlocks);\n    // TODO: if page is not empty\n  }\n}\n", "import { html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\n@customElement('counter-block')\nexport class CounterBlock extends LitElement {\n  @property()\n  count: number;\n\n  constructor() {\n    super();\n    this.count = 0;\n  }\n\n  private async _notify() {\n    this.count++;\n\n    // https://lit.dev/docs/components/events/#dispatching-events-after-an-element-updates\n    await this.updateComplete;\n    const options: CustomEventInit<number> = {\n      detail: this.count,\n      bubbles: true,\n      composed: true,\n    };\n    this.dispatchEvent(new CustomEvent('block-count-update', options));\n  }\n\n  override render() {\n    return html` <div @click=${this._notify}>${this.count}</div> `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'counter-block': CounterBlock;\n  }\n}\n", "import type {\n  BaseBlockModel,\n  InlineSuggestionProvider,\n} from '@blocksuite/store';\nimport {\n  assertExists,\n  DisposableGroup,\n  matchFlavours,\n} from '@blocksuite/store';\nimport type { VRange } from '@blocksuite/virgo';\nimport {\n  css,\n  html,\n  type LitElement,\n  nothing,\n  type ReactiveController,\n} from 'lit';\n\nimport { debounce } from '../utils/index.js';\nimport {\n  getCurrentNativeRange,\n  hasNativeSelection,\n} from '../utils/selection.js';\nimport type { AffineVEditor } from './virgo/types.js';\n\nexport class InlineSuggestionController implements ReactiveController {\n  static styles = css`\n    .inline-suggestion {\n      display: flex;\n      align-items: center;\n      gap: 4px;\n      left: 0;\n      top: 0;\n      color: var(--affine-placeholder-color);\n      fill: var(--affine-placeholder-color);\n      margin-bottom: calc(-1 * var(--affine-line-height));\n      transform: translateY(calc(-1 * var(--affine-line-height)));\n      pointer-events: none;\n    }\n  `;\n\n  host: LitElement;\n\n  private model?: BaseBlockModel;\n  private vEditor?: AffineVEditor;\n  private provider?: InlineSuggestionProvider;\n\n  private _abortController = new AbortController();\n  private _disposables = new DisposableGroup();\n\n  private _suggestionState = {\n    show: false,\n    position: { x: 0, y: 0 },\n    loading: false,\n    text: '',\n  };\n\n  constructor(host: LitElement) {\n    host.addController(this);\n    this.host = host;\n  }\n\n  hostConnected() {\n    this._disposables = new DisposableGroup();\n  }\n\n  hostDisconnected() {\n    this._disposables.dispose();\n  }\n\n  init({\n    model,\n    vEditor,\n    provider,\n  }: {\n    model: BaseBlockModel;\n    vEditor: AffineVEditor;\n    provider: InlineSuggestionProvider;\n  }) {\n    this.provider = provider;\n    this.model = model;\n    this.vEditor = vEditor;\n  }\n\n  private _setSuggestionState(newState: Partial<typeof this._suggestionState>) {\n    const previousState = this._suggestionState;\n    this._suggestionState = { ...previousState, ...newState };\n    // TODO diff to optimize performance\n    this.host.requestUpdate();\n  }\n\n  private _updatePosition() {\n    const richTextRect = this.host.getBoundingClientRect();\n    if (!hasNativeSelection()) return;\n    const range = getCurrentNativeRange();\n    const rangeRect = range.getBoundingClientRect();\n\n    return {\n      x: rangeRect.x - richTextRect.x,\n      y: -rangeRect.height,\n    };\n  }\n\n  readonly onFocusIn = (e: FocusEvent) => {\n    const inlineSuggestProvider = this.provider;\n    if (!inlineSuggestProvider) return;\n    assertExists(this.model);\n\n    const editor = this.vEditor;\n    assertExists(editor);\n    this._disposables.add(\n      editor.slots.vRangeUpdated.on(async ([vRange, type]) => {\n        this._updateSuggestions(vRange);\n      })\n    );\n  };\n\n  readonly onFocusOut = (e: FocusEvent) => {\n    this._abortController.abort();\n    // We should not observe text change when focus out\n    this._disposables.dispose();\n    this._disposables = new DisposableGroup();\n  };\n\n  private _updateSuggestions = debounce(\n    async (vRange: VRange) => {\n      this._abortController.abort();\n      this._abortController = new AbortController();\n\n      assertExists(this.model);\n      const editor = this.vEditor;\n      assertExists(editor);\n      const len = editor.yText.length;\n      if (!len || vRange.length !== 0 || vRange.index !== len) {\n        return;\n      }\n\n      const pageBlock = this.model.page.root;\n      assertExists(pageBlock);\n      if (!matchFlavours(pageBlock, ['affine:page'])) {\n        throw new Error('Invalid page root');\n      }\n\n      this._setSuggestionState({\n        show: true,\n        loading: true,\n        position: this._updatePosition(),\n      });\n      const text = this.model.text;\n      assertExists(text);\n      const textStr = text.toString();\n      const title = pageBlock.title.toString();\n      const abortController = this._abortController;\n      abortController.signal.addEventListener('abort', () => {\n        this._setSuggestionState({\n          show: false,\n          loading: false,\n        });\n      });\n      try {\n        assertExists(this.provider);\n        const suggestion = await this.provider({\n          title,\n          text: textStr,\n          abortSignal: abortController.signal,\n        });\n        if (abortController.signal.aborted) {\n          this._setSuggestionState({\n            show: false,\n            loading: false,\n          });\n          return;\n        }\n\n        // Wait for native range to be updated\n        requestAnimationFrame(() => {\n          this._setSuggestionState({\n            show: true,\n            loading: false,\n            text: suggestion,\n            position: this._updatePosition(),\n          });\n        });\n      } catch (error) {\n        console.error('Failed to get inline suggest', error);\n        this._setSuggestionState({\n          show: false,\n          loading: false,\n        });\n      }\n    },\n    300,\n    { leading: false }\n  );\n\n  readonly onKeyDown = (e: KeyboardEvent) => {\n    if (!this._suggestionState.show || this._suggestionState.loading) return;\n    if (e.isComposing || e.key !== 'Tab') {\n      requestAnimationFrame(() => {\n        const position = this._updatePosition();\n        this._setSuggestionState({\n          position,\n        });\n      });\n      return;\n    }\n    // accept suggestion\n    const editor = this.vEditor;\n    assertExists(editor);\n    const vRange = editor.getVRange();\n    if (!vRange) return;\n    const suggestion = this._suggestionState.text;\n    editor.insertText(vRange, suggestion);\n    editor.setVRange({\n      index: vRange.index + suggestion.length,\n      length: 0,\n    });\n    this._setSuggestionState({ text: '' });\n\n    e.stopPropagation();\n    e.preventDefault();\n  };\n\n  render() {\n    if (!this._suggestionState.show) return nothing;\n    const text = this._suggestionState.loading\n      ? '...'\n      : this._suggestionState.text;\n    const position = this._suggestionState.position;\n    if (!text) return nothing;\n    return html`<div\n      class=\"inline-suggestion\"\n      style=\"text-indent: ${position.x + 2}px;\"\n    >\n      ${text}\n    </div>`;\n  }\n}\n", "import { ALLOW_DEFAULT, PREVENT_DEFAULT } from '@blocksuite/global/config';\nimport type { BaseBlockModel } from '@blocksuite/store';\n\nimport type { KeyboardBindings } from './keyboard.js';\n\ntype BracketPair = {\n  name: string;\n  left: string;\n  right: string;\n};\n\nconst bracketPairs: BracketPair[] = [\n  {\n    name: 'parenthesis',\n    left: '(',\n    right: ')',\n  },\n  {\n    name: 'square bracket',\n    left: '[',\n    right: ']',\n  },\n  {\n    name: 'curly bracket',\n    left: '{',\n    right: '}',\n  },\n  {\n    name: 'single quote',\n    left: \"'\",\n    right: \"'\",\n  },\n  {\n    name: 'double quote',\n    left: '\"',\n    right: '\"',\n  },\n  // {\n  //   name: 'backtick',\n  //   left: '`',\n  //   right: '`',\n  // },\n  {\n    name: 'angle bracket',\n    left: '<',\n    right: '>',\n  },\n  {\n    name: 'fullwidth single quote',\n    left: '',\n    right: '',\n  },\n  {\n    name: 'fullwidth double quote',\n    left: '',\n    right: '',\n  },\n  {\n    name: 'fullwidth parenthesis',\n    left: '',\n    right: '',\n  },\n  {\n    name: 'fullwidth square bracket',\n    left: '',\n    right: '',\n  },\n  {\n    name: 'fullwidth angle bracket',\n    left: '',\n    right: '',\n  },\n  {\n    name: 'corner bracket',\n    left: '',\n    right: '',\n  },\n  {\n    name: 'white corner bracket',\n    left: '',\n    right: '',\n  },\n];\n\nexport function createBracketAutoCompleteBindings(\n  model: BaseBlockModel\n): KeyboardBindings {\n  const bindings: KeyboardBindings = {};\n\n  bracketPairs.forEach(pair => {\n    bindings[pair.name] = {\n      key: pair.left,\n      // Input some brackets need to press shift key\n      shiftKey: null,\n      collapsed: false,\n      handler(range) {\n        if (!model.text) return ALLOW_DEFAULT;\n\n        model.text.insert(pair.left, range.index);\n        model.text.insert(pair.right, range.index + range.length + 1);\n\n        this.vEditor.setVRange({\n          index: range.index + 1,\n          length: range.length,\n        });\n\n        return PREVENT_DEFAULT;\n      },\n    };\n  });\n\n  bindings['backtick'] = {\n    key: '`',\n    collapsed: false,\n    handler(range, context) {\n      if (!model.text) return ALLOW_DEFAULT;\n      model.text.format(range.index, range.length, { code: true });\n\n      this.vEditor.setVRange({\n        index: range.index,\n        length: range.length,\n      });\n\n      return PREVENT_DEFAULT;\n    },\n  };\n  return bindings;\n}\n", "import { ALLOW_DEFAULT, IS_IOS, IS_MAC } from '@blocksuite/global/config';\nimport { matchFlavours } from '@blocksuite/global/utils';\nimport type { BaseBlockModel } from '@blocksuite/store';\nimport type { VRange } from '@blocksuite/virgo';\n\nimport { showLinkedPagePopover } from '../../components/linked-page/index.js';\nimport { showSlashMenu } from '../../components/slash-menu/index.js';\nimport { getService } from '../service.js';\nimport { getCurrentNativeRange, hasNativeSelection } from '../utils/index.js';\nimport { createBracketAutoCompleteBindings } from './bracket-complete.js';\nimport type { AffineVEditor } from './virgo/types.js';\n\n// Type definitions is ported from quill\n// https://github.com/quilljs/quill/blob/6159f6480482dde0530920dc41033ebc6611a9e7/modules/keyboard.ts#L15-L46\n\nexport interface BindingContext {\n  collapsed: boolean;\n  empty: boolean;\n  offset: number;\n  prefix: string;\n  suffix: string;\n  format: Record<string, unknown>;\n  event: KeyboardEvent;\n}\n\nexport type KeyboardBinding = {\n  /**\n   * See https://developer.mozilla.org/en-US/docs/Web/API/UI_Events/Keyboard_event_key_values\n   */\n  key: number | string | string[];\n  collapsed?: boolean;\n  handler: KeyboardBindingHandler;\n  prefix?: RegExp;\n  suffix?: RegExp;\n  shortKey?: boolean | null;\n  shiftKey?: boolean | null;\n  altKey?: boolean | null;\n  metaKey?: boolean | null;\n  ctrlKey?: boolean | null;\n};\n\ntype KeyboardBindingHandler = (\n  this: KeyboardEventThis,\n  range: VRange,\n  context: BindingContext\n) => boolean;\n\nexport type KeyboardBindings = Record<string, KeyboardBinding>;\n\ninterface KeyboardEventThis {\n  vEditor: AffineVEditor;\n  options: {\n    bindings: KeyboardBindings;\n  };\n}\n\nexport function createKeyboardBindings(\n  model: BaseBlockModel,\n  vEditor: AffineVEditor\n): KeyboardBindings {\n  const page = model.page;\n\n  const service = getService(model.flavour);\n  const blockKeyBinding = service.defineKeymap(model, vEditor);\n\n  const keyboardBindings: KeyboardBindings = {\n    ...blockKeyBinding,\n\n    linkedPage: {\n      key: ['[', '', '@'],\n      altKey: null,\n      shiftKey: null,\n      handler(range, { event, prefix }) {\n        if (range.length > 0) {\n          // When select text and press `[[` should not trigger transform,\n          // since it will break the bracket complete.\n          // Expected `[[selected text]]` instead of `@selected text]]`\n          return ALLOW_DEFAULT;\n        }\n        if (\n          (event.key === '[' || event.key === '') &&\n          !prefix.endsWith(event.key)\n        ) {\n          // not end with `[[` or ``\n          return ALLOW_DEFAULT;\n        }\n        const flag = page.awarenessStore.getFlag('enable_linked_page');\n        if (!flag) return ALLOW_DEFAULT;\n        if (matchFlavours(model, ['affine:code'])) {\n          return ALLOW_DEFAULT;\n        }\n\n        this.vEditor.slots.rangeUpdated.once(() => {\n          if (event.key === '[' || event.key === '') {\n            // Convert to `@`\n            this.vEditor.deleteText({ index: range.index - 1, length: 2 });\n            this.vEditor.insertText({ index: range.index - 1, length: 0 }, '@');\n            this.vEditor.setVRange({ index: range.index, length: 0 });\n            this.vEditor.slots.rangeUpdated.once(() => {\n              const curRange = getCurrentNativeRange();\n              showLinkedPagePopover({ model, range: curRange });\n            });\n            return;\n          }\n          const curRange = getCurrentNativeRange();\n          showLinkedPagePopover({ model, range: curRange });\n        });\n        return ALLOW_DEFAULT;\n      },\n    },\n\n    slash: {\n      key: [\n        '/',\n        // Compatible with CJK IME\n        '',\n      ],\n      shiftKey: null,\n      // prefix non digit or empty string\n      // see https://stackoverflow.com/questions/19127384/what-is-a-regex-to-match-only-an-empty-string\n      // prefix: /[^\\d]$|^(?![\\s\\S])/,\n      handler(range, context) {\n        // TODO remove feature flag after slash menu is stable\n        const flag = page.awarenessStore.getFlag('enable_slash_menu');\n        if (!flag) {\n          return ALLOW_DEFAULT;\n        }\n        // End of feature flag\n\n        if (matchFlavours(model, ['affine:code'])) {\n          return ALLOW_DEFAULT;\n        }\n        // if (context.format['code'] === true) {\n        //   return ALLOW_DEFAULT;\n        // }\n        this.vEditor.slots.rangeUpdated.once(() => {\n          const curRange = getCurrentNativeRange();\n          showSlashMenu({ model, range: curRange });\n        });\n        return ALLOW_DEFAULT;\n      },\n    },\n    ...createBracketAutoCompleteBindings(model),\n  };\n\n  return keyboardBindings;\n}\n\nconst SHORT_KEY_PROPERTY = IS_IOS || IS_MAC ? 'metaKey' : 'ctrlKey';\n\nexport function createKeyDownHandler(\n  vEditor: AffineVEditor,\n  bindings: KeyboardBindings,\n  model: BaseBlockModel\n): (evt: KeyboardEvent) => void {\n  const bindingStore: Record<string, KeyboardBinding[]> = {};\n  function normalize(binding: KeyboardBinding): KeyboardBinding {\n    if (binding.shortKey) {\n      binding[SHORT_KEY_PROPERTY] = binding.shortKey;\n      delete binding.shortKey;\n    }\n    return binding;\n  }\n\n  function match(evt: KeyboardEvent, binding: KeyboardBinding) {\n    if (\n      (['altKey', 'ctrlKey', 'metaKey', 'shiftKey'] as const).some(key => {\n        return !!binding[key] !== evt[key] && binding[key] !== null;\n      })\n    ) {\n      return false;\n    }\n    return binding.key === evt.key || binding.key === evt.which;\n  }\n\n  function addBinding(keyBinding: KeyboardBinding) {\n    const binding = normalize(keyBinding);\n    const keys = Array.isArray(binding.key) ? binding.key : [binding.key];\n    keys.forEach(key => {\n      const singleBinding = {\n        ...binding,\n        key,\n      };\n      bindingStore[key] = bindingStore[key] ?? [];\n      bindingStore[key].push(singleBinding);\n    });\n  }\n\n  Object.values(bindings).forEach(binding => {\n    addBinding(binding);\n  });\n\n  function keyDownHandler(evt: KeyboardEvent) {\n    const parentModel = model.page.getParent(model);\n    const previousModel = model.page.getPreviousSibling(model);\n    if (\n      (parentModel && matchFlavours(parentModel, ['affine:database'])) ||\n      (previousModel && matchFlavours(previousModel, ['affine:database']))\n    ) {\n      if (evt.key === 'Tab') {\n        evt.preventDefault();\n        evt.stopPropagation();\n        return;\n      }\n    }\n\n    if (evt.defaultPrevented || evt.isComposing) return;\n    const keyBindings = (bindingStore[evt.key] || []).concat(\n      bindingStore[evt.which] || []\n    );\n    const matches = keyBindings.filter(binding => match(evt, binding));\n    if (matches.length === 0) return;\n\n    const vRange = vEditor.getVRange();\n    if (!vRange) return;\n\n    // edgeless mode\n    if (!hasNativeSelection()) return;\n    // if it is multi block selection, we should not handle the keydown event\n    const range = getCurrentNativeRange();\n    if (!range) return;\n    if (\n      !vEditor.rootElement.contains(range.startContainer) ||\n      !vEditor.rootElement.contains(range.endContainer)\n    ) {\n      return;\n    }\n\n    const [line, offset] = vEditor.getLine(vRange.index);\n    const [leafStart, offsetStart] = vEditor.getTextPoint(vRange.index);\n    const [leafEnd, offsetEnd] =\n      vRange.length === 0\n        ? [leafStart, offsetStart]\n        : vEditor.getTextPoint(vRange.index + vRange.length);\n    const prefixText = leafStart.textContent\n      ? leafStart.textContent.slice(0, offsetStart)\n      : '';\n    const suffixText = leafEnd.textContent\n      ? leafEnd.textContent.slice(offsetEnd)\n      : '';\n    const curContext = {\n      collapsed: vRange.length === 0,\n      empty: vRange.length === 0 && line.textLength <= 1,\n      format: vEditor.getFormat(vRange),\n      line,\n      offset,\n      prefix: prefixText,\n      suffix: suffixText,\n      event: evt,\n    };\n    const prevented = matches.some(binding => {\n      if (\n        binding.collapsed != null &&\n        binding.collapsed !== curContext.collapsed\n      ) {\n        return false;\n      }\n      if (binding.prefix != null && !binding.prefix.test(curContext.prefix)) {\n        return false;\n      }\n      if (binding.suffix != null && !binding.suffix.test(curContext.suffix)) {\n        return false;\n      }\n      return !binding.handler.call(\n        {\n          vEditor,\n          options: {\n            bindings,\n          },\n        },\n        vRange,\n        curContext\n      );\n    });\n    if (prevented) {\n      evt.preventDefault();\n    }\n  }\n\n  return keyDownHandler;\n}\n", "import type {\n  AttributeRenderer,\n  BaseTextAttributes,\n  DeltaInsert,\n  VEditor,\n} from '@blocksuite/virgo';\nimport { baseTextAttributes } from '@blocksuite/virgo';\nimport { z, type ZodTypeDef } from 'zod';\n\nexport const affineTextAttributes = baseTextAttributes.extend({\n  reference: z\n    .object({\n      type: z.enum(['Subpage', 'LinkedPage']),\n      pageId: z.string(),\n    })\n    .optional(),\n});\n\nexport type AffineTextAttributes = z.infer<typeof affineTextAttributes>;\n\nexport type AffineDeltaInsert = DeltaInsert<AffineTextAttributes>;\n\nexport type AffineVEditor = VEditor<AffineTextAttributes>;\n\nexport type AffineTextSchema<\n  TextAttributes extends BaseTextAttributes = AffineTextAttributes\n> = {\n  attributesSchema: z.ZodSchema<TextAttributes, ZodTypeDef, unknown>;\n  textRenderer: () => AttributeRenderer<TextAttributes>;\n};\n", "import { ShadowlessElement } from '@blocksuite/lit';\nimport { assertExists, type BaseBlockModel } from '@blocksuite/store';\nimport type { BaseTextAttributes, VHandlerContext } from '@blocksuite/virgo';\nimport { VEditor } from '@blocksuite/virgo';\nimport { css, html } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\n\nimport { activeEditorManager } from '../utils/active-editor-manager.js';\nimport { setupVirgoScroll } from '../utils/virgo.js';\nimport { InlineSuggestionController } from './inline-suggestion.js';\nimport { createKeyboardBindings, createKeyDownHandler } from './keyboard.js';\nimport { type AffineTextSchema, type AffineVEditor } from './virgo/types.js';\n\nconst IGNORED_ATTRIBUTES = ['code', 'reference'] as const;\n\nconst autoIdentifyLink = (\n  editor: AffineVEditor,\n  context: VHandlerContext<BaseTextAttributes, InputEvent | CompositionEvent>\n) => {\n  const vRange = editor.getVRange();\n  if (!vRange) return;\n  if (context.attributes?.link && context.data === ' ') {\n    delete context.attributes['link'];\n    return;\n  }\n\n  const linkPattern =\n    /.*\\.(com|cn|org|edu|net|gov|mil|info|biz|io|me)(\\/\\S*)?$/i;\n\n  if (context.attributes?.link) {\n    const linkDeltaInfo = editor.deltaService\n      .getDeltasByVRange(vRange)\n      .filter(([delta]) => delta.attributes?.link)[0];\n    const [delta, { index, length }] = linkDeltaInfo;\n    const rangePositionInDelta = vRange.index - index;\n\n    //It means the link has been custom edited\n    if (delta.attributes?.link !== delta.insert) {\n      // If the cursor is at the end of the link, we should not auto identify it\n      if (rangePositionInDelta === length) {\n        delete context.attributes['link'];\n        return;\n      }\n      // If the cursor is not at the end of the link, we should only update the link text\n      return;\n    }\n    const newText =\n      delta.insert.slice(0, rangePositionInDelta) +\n      context.data +\n      delta.insert.slice(rangePositionInDelta);\n    const match = linkPattern.exec(newText);\n    // If the new text with original link text is not pattern matched, we should reset the text\n    if (!match) {\n      editor.resetText({ index, length });\n      delete context.attributes['link'];\n      return;\n    }\n    // If the new text with original link text is pattern matched, we should update the link text\n    editor.formatText(\n      {\n        index,\n        length,\n      },\n      {\n        link: newText,\n      }\n    );\n    context.attributes = {\n      ...context.attributes,\n      link: newText,\n    };\n    return;\n  }\n\n  const [line] = editor.getLine(vRange.index);\n  const prefixText = line.textContent.slice(0, vRange.index);\n  const match = linkPattern.exec(prefixText + context.data);\n  if (!match) {\n    return;\n  }\n  const linkText = match[0];\n  const startIndex = vRange.index - linkText.length;\n\n  editor.formatText(\n    {\n      index: startIndex,\n      length: linkText.length,\n    },\n    {\n      link: linkText,\n    }\n  );\n\n  context.attributes = {\n    ...context.attributes,\n    link: linkText,\n  };\n};\n\n@customElement('rich-text')\nexport class RichText extends ShadowlessElement {\n  static override styles = css`\n    .affine-rich-text {\n      height: 100%;\n      width: 100%;\n      outline: none;\n      cursor: text;\n    }\n\n    v-line {\n      scroll-margin-top: 50px;\n      scroll-margin-bottom: 30px;\n    }\n\n    ${InlineSuggestionController.styles}\n  `;\n\n  @query('.affine-rich-text')\n  private _virgoContainer!: HTMLDivElement;\n  get virgoContainer() {\n    return this._virgoContainer;\n  }\n\n  @property()\n  model!: BaseBlockModel;\n\n  @property()\n  textSchema?: AffineTextSchema;\n\n  private _vEditor: AffineVEditor | null = null;\n  get vEditor() {\n    return this._vEditor;\n  }\n\n  private _inlineSuggestController: InlineSuggestionController =\n    new InlineSuggestionController(this);\n\n  override firstUpdated() {\n    assertExists(this.model.text, 'rich-text need text to init.');\n    this._vEditor = new VEditor(this.model.text.yText, {\n      active: () => activeEditorManager.isActive(this),\n    });\n    setupVirgoScroll(this.model.page, this._vEditor);\n    const textSchema = this.textSchema;\n    assertExists(\n      textSchema,\n      'Failed to render rich-text! textSchema not found'\n    );\n    this._vEditor.setAttributeSchema(textSchema.attributesSchema);\n    this._vEditor.setAttributeRenderer(textSchema.textRenderer());\n\n    const keyboardBindings = createKeyboardBindings(this.model, this._vEditor);\n    const keyDownHandler = createKeyDownHandler(\n      this._vEditor,\n      keyboardBindings,\n      this.model\n    );\n\n    let ifPrefixSpace = false;\n\n    this._vEditor.mount(this._virgoContainer);\n    this._vEditor.bindHandlers({\n      keydown: keyDownHandler,\n      virgoInput: ctx => {\n        const vEditor = this._vEditor;\n        assertExists(vEditor);\n        const vRange = vEditor.getVRange();\n        if (!vRange || vRange.length !== 0) {\n          return ctx;\n        }\n\n        const { data, event } = ctx;\n        const deltas = vEditor.getDeltasByVRange(vRange);\n\n        // Overwrite the default behavior (Insert period when consecutive spaces) of IME.\n        if (event.inputType === 'insertText' && data === ' ') {\n          ifPrefixSpace = true;\n        } else if (data !== '. ' && data !== ' ') {\n          ifPrefixSpace = false;\n        }\n        if (ifPrefixSpace && (data === '. ' || data === ' ')) {\n          ctx.data = ' ';\n        }\n\n        if (data && data.length > 0 && data !== '\\n') {\n          if (\n            deltas.length > 1 ||\n            (deltas.length === 1 && vRange.index !== 0)\n          ) {\n            const { attributes } = deltas[0][0];\n            if (deltas.length !== 1 || vRange.index === vEditor.yText.length) {\n              IGNORED_ATTRIBUTES.forEach(attr => {\n                delete attributes?.[attr];\n              });\n            }\n\n            ctx.attributes = attributes ?? null;\n          }\n        }\n        autoIdentifyLink(vEditor, ctx);\n\n        return ctx;\n      },\n      virgoCompositionEnd: ctx => {\n        const vEditor = this._vEditor;\n        assertExists(vEditor);\n        const vRange = vEditor.getVRange();\n        if (!vRange || vRange.length !== 0) {\n          return ctx;\n        }\n\n        const { data } = ctx;\n        const deltas = vEditor.getDeltasByVRange(vRange);\n        if (data && data.length > 0 && data !== '\\n') {\n          if (\n            deltas.length > 1 ||\n            (deltas.length === 1 && vRange.index !== 0)\n          ) {\n            const attributes = deltas[0][0].attributes;\n            if (deltas.length !== 1 || vRange.index === vEditor.yText.length) {\n              IGNORED_ATTRIBUTES.forEach(attr => {\n                delete attributes?.[attr];\n              });\n            }\n\n            ctx.attributes = attributes ?? null;\n          }\n        }\n        autoIdentifyLink(vEditor, ctx);\n\n        return ctx;\n      },\n    });\n\n    this._vEditor.setReadonly(this.model.page.readonly);\n    const inlineSuggestionProvider =\n      this.model.page.workspace.inlineSuggestionProvider;\n    if (inlineSuggestionProvider) {\n      this._inlineSuggestController.init({\n        provider: inlineSuggestionProvider,\n        model: this.model,\n        vEditor: this._vEditor,\n      });\n    }\n  }\n\n  override updated() {\n    if (this._vEditor) {\n      this._vEditor.setReadonly(this.model.page.readonly);\n    }\n  }\n\n  override render() {\n    return html`<div\n        class=\"affine-rich-text virgo-editor\"\n        @keydown=${this._inlineSuggestController.onKeyDown}\n        @focusin=${this._inlineSuggestController.onFocusIn}\n        @focusout=${this._inlineSuggestController.onFocusOut}\n      ></div>\n      ${this._inlineSuggestController.render()}`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'rich-text': RichText;\n  }\n}\n", "import { html } from 'lit';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport { REFERENCE_NODE } from '../reference-node.js';\nimport type { AffineTextSchema } from './types.js';\n\nexport const attributeRenderer: AffineTextSchema['textRenderer'] =\n  () => delta => {\n    const defaultTemplate = html`<affine-text .delta=${delta}></affine-text>`;\n    if (!delta.attributes) {\n      return defaultTemplate;\n    }\n    const attributes = delta.attributes;\n\n    if (attributes.link) {\n      if (attributes.reference) {\n        console.error(\n          'Invalid attributes: link and reference cannot be used together',\n          delta\n        );\n      }\n      return html`<affine-link .delta=${delta}></affine-link>`;\n    }\n    if (attributes.reference) {\n      // https://github.com/toeverything/blocksuite/issues/2136\n      return html`${repeat(\n        Array.from(delta.insert).map((_, index) => ({\n          delta: {\n            insert: REFERENCE_NODE,\n            attributes,\n          },\n          index,\n        })),\n        item => item.index,\n        item => html`<affine-reference .delta=${item.delta}></affine-reference>`\n      )}`;\n    }\n\n    return defaultTemplate;\n  };\n", "import type { BaseBlockModel } from '@blocksuite/store';\n\nimport type { BlockRange, SerializedBlock } from '../__internal__/index.js';\nimport type { BlockTransformContext } from '../__internal__/index.js';\nimport { BaseService } from '../__internal__/service/index.js';\nimport { json2block } from '../__internal__/service/json2block.js';\nimport type { ParagraphBlockModel } from './paragraph-model.js';\n\nexport class ParagraphBlockService extends BaseService<ParagraphBlockModel> {\n  override block2html(\n    model: ParagraphBlockModel,\n    { childText = '', begin, end }: BlockTransformContext = {}\n  ) {\n    const text = super.block2html(model, {\n      childText,\n      begin,\n      end,\n    });\n    switch (model.type) {\n      case 'text':\n        return `<p>${text}</p>`;\n      case 'h1':\n      case 'h2':\n      case 'h3':\n      case 'h4':\n      case 'h5':\n      case 'h6':\n        return `<${model.type}>${text}</${model.type}>`;\n      case 'quote':\n        return `<blockquote>${text}</blockquote>`;\n      default:\n        return text;\n    }\n  }\n\n  override async json2Block(\n    focusedBlockModel: BaseBlockModel,\n    pastedBlocks: SerializedBlock[],\n    range?: BlockRange\n  ) {\n    const convertToPastedIfEmpty = focusedBlockModel.type !== 'text';\n    return json2block(focusedBlockModel, pastedBlocks, {\n      range,\n      convertToPastedIfEmpty,\n    });\n  }\n}\n\nexport default ParagraphBlockService;\n", "import '../__internal__/rich-text/rich-text.js';\n\nimport {\n  BLOCK_CHILDREN_CONTAINER_PADDING_LEFT,\n  BlockHubIcon20,\n} from '@blocksuite/global/config';\nimport { DisposableGroup, matchFlavours } from '@blocksuite/global/utils';\nimport { BlockElement } from '@blocksuite/lit';\nimport type { BaseBlockModel } from '@blocksuite/store';\nimport { css, html } from 'lit';\nimport { customElement, query, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { isPageMode } from '../__internal__/index.js';\nimport { attributeRenderer } from '../__internal__/rich-text/virgo/attribute-renderer.js';\nimport {\n  affineTextAttributes,\n  type AffineTextSchema,\n} from '../__internal__/rich-text/virgo/types.js';\nimport { registerService } from '../__internal__/service.js';\nimport type { ParagraphBlockModel, ParagraphType } from './paragraph-model.js';\nimport paragraphService from './paragraph-service.js';\n\nfunction tipsPlaceholderPreventDefault(event: Event) {\n  // Call event.preventDefault() to keep the mouse event from being sent as well.\n  // https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent\n  event.preventDefault();\n}\n\ninterface Style {\n  [name: string]: string;\n}\n\nfunction TipsPlaceholder(model: BaseBlockModel, tipsPos: Style) {\n  if (!matchFlavours(model, ['affine:paragraph'])) {\n    throw new Error(\"TipsPlaceholder can't be used for this model\");\n  }\n  if (model.type === 'text') {\n    if (!isPageMode(model.page)) {\n      return html`<div class=\"tips-placeholder\" style=${styleMap(tipsPos)}>\n        Type '/' for commands\n      </div> `;\n    }\n\n    const blockHub = document.querySelector('affine-block-hub');\n    if (!blockHub) {\n      // Fall back\n      return html`<div class=\"tips-placeholder\" style=${styleMap(tipsPos)}>\n        Type '/' for commands\n      </div>`;\n    }\n    const onClick = () => {\n      if (!blockHub) {\n        throw new Error('Failed to find blockHub!');\n      }\n      blockHub.toggleMenu();\n    };\n    return html`\n      <div\n        class=\"tips-placeholder\"\n        @click=${onClick}\n        @pointerdown=${tipsPlaceholderPreventDefault}\n        style=${styleMap(tipsPos)}\n      >\n        Click ${BlockHubIcon20} to insert blocks, type '/' for commands\n      </div>\n    `;\n  }\n\n  const placeholders: Record<Exclude<ParagraphType, 'text'>, string> = {\n    h1: 'Heading 1',\n    h2: 'Heading 2',\n    h3: 'Heading 3',\n    h4: 'Heading 4',\n    h5: 'Heading 5',\n    h6: 'Heading 6',\n    quote: '',\n  };\n  return html`<div class=\"tips-placeholder\">${placeholders[model.type]}</div> `;\n}\n\n@customElement('affine-paragraph')\nexport class ParagraphBlockComponent extends BlockElement<ParagraphBlockModel> {\n  static override styles = css`\n    .affine-paragraph-block-container {\n      position: relative;\n      border-radius: 5px;\n    }\n    .affine-paragraph-block-container.selected {\n      background-color: var(--affine-hover-color);\n    }\n    .h1 {\n      font-size: var(--affine-font-h-1);\n      line-height: calc(1em + 12px);\n      margin-top: calc(var(--affine-paragraph-space) + 24px);\n    }\n    .h1 code {\n      font-size: calc(var(--affine-font-base) + 8px);\n    }\n    .h2 {\n      font-size: var(--affine-font-h-2);\n      line-height: calc(1em + 10px);\n      margin-top: calc(var(--affine-paragraph-space) + 20px);\n    }\n    .h2 code {\n      font-size: calc(var(--affine-font-base) + 6px);\n    }\n    .h3 {\n      font-size: var(--affine-font-h-3);\n      line-height: calc(1em + 8px);\n      margin-top: calc(var(--affine-paragraph-space) + 16px);\n    }\n    .h3 code {\n      font-size: calc(var(--affine-font-base) + 4px);\n    }\n    .h4 {\n      font-size: var(--affine-font-h-4);\n      line-height: calc(1em + 10px);\n      margin-top: calc(var(--affine-paragraph-space) + 12px);\n    }\n    .h4 code {\n      font-size: calc(var(--affine-font-base) + 2px);\n    }\n    .h5 {\n      font-size: var(--affine-font-h-5);\n      line-height: calc(1em + 8px);\n      margin-top: calc(var(--affine-paragraph-space) + 8px);\n    }\n    .h5 code {\n      font-size: calc(var(--affine-font-base));\n    }\n    .h6 {\n      font-size: var(--affine-font-h-6);\n      line-height: calc(1em + 8px);\n      margin-top: calc(var(--affine-paragraph-space) + 4px);\n    }\n    .h6 code {\n      font-size: calc(var(--affine-font-base) - 2px);\n    }\n    .quote {\n      line-height: 26px;\n      padding-left: 12px;\n      margin-top: var(--affine-paragraph-space);\n      position: relative;\n    }\n    .quote::after {\n      content: '';\n      width: 4px;\n      height: 100%;\n      position: absolute;\n      left: 0;\n      top: 0;\n      background: var(--affine-quote-color);\n      border-radius: 4px;\n    }\n    .text {\n      margin-top: var(--affine-paragraph-space);\n      font-size: var(--affine-font-base);\n    }\n\n    .tips-placeholder {\n      position: absolute;\n      display: flex;\n      align-items: center;\n      gap: 4px;\n      pointer-events: none;\n      color: var(--affine-placeholder-color);\n      fill: var(--affine-placeholder-color);\n    }\n\n    .tips-placeholder > svg {\n      cursor: pointer;\n      pointer-events: all;\n    }\n    .tips-placeholder > svg:hover {\n      fill: var(--affine-primary-color);\n    }\n  `;\n\n  @state()\n  tipsPos = { top: '50%', transform: 'translateY(-50%)', left: '2px' };\n\n  @state()\n  private _tipsPlaceholderTemplate = html``;\n\n  @state()\n  private _isComposing = false;\n\n  @state()\n  private _isFocus = false;\n\n  readonly textSchema: AffineTextSchema = {\n    attributesSchema: affineTextAttributes,\n    textRenderer: attributeRenderer,\n  };\n\n  private _placeholderDisposables = new DisposableGroup();\n\n  @query('rich-text')\n  private _richTextElement?: HTMLElement;\n\n  override connectedCallback() {\n    super.connectedCallback();\n    // Initial placeholder state\n    this._updatePlaceholder();\n    registerService('affine:paragraph', paragraphService);\n  }\n\n  override firstUpdated() {\n    this.model.propsUpdated.on(() => {\n      this._updatePlaceholder();\n      this.requestUpdate();\n    });\n    this.model.childrenUpdated.on(() => this.requestUpdate());\n  }\n\n  private _updatePlaceholder = () => {\n    if (this.model.text.length !== 0 || this._isComposing) {\n      this._tipsPlaceholderTemplate = html``;\n      return;\n    }\n\n    if (this.model.type === 'text' && !this._isFocus) {\n      // Text block placeholder only show when focus and empty\n      this._tipsPlaceholderTemplate = html``;\n      return;\n    }\n\n    if (this._richTextElement) {\n      const parentRect =\n        this._richTextElement.parentElement?.getBoundingClientRect() as DOMRect;\n      const rect = this._richTextElement.getBoundingClientRect();\n\n      const relativeTop = rect.top - parentRect.top;\n      const relativeLeft = rect.left - parentRect.left;\n      this.tipsPos = {\n        top: `${relativeTop}px`,\n        transform: '',\n        left: `${relativeLeft + 2}px`,\n      };\n    }\n\n    this._tipsPlaceholderTemplate = TipsPlaceholder(this.model, this.tipsPos);\n  };\n\n  private _onFocusIn = (e: FocusEvent) => {\n    this._isFocus = true;\n    this._updatePlaceholder();\n\n    this.model.text.yText.observe(this._updatePlaceholder);\n    this._placeholderDisposables.add(() =>\n      this.model.text.yText.unobserve(this._updatePlaceholder)\n    );\n    // Workaround for virgo skips composition event\n    this._placeholderDisposables.addFromEvent(this, 'compositionstart', () => {\n      this._isComposing = true;\n      this._updatePlaceholder();\n    });\n    this._placeholderDisposables.addFromEvent(this, 'compositionend', () => {\n      this._isComposing = false;\n      this._updatePlaceholder();\n    });\n  };\n\n  private _onFocusOut = (e: FocusEvent) => {\n    this._isFocus = false;\n    this._updatePlaceholder();\n    // We should not observe text change when focus out\n    this._placeholderDisposables.dispose();\n    this._placeholderDisposables = new DisposableGroup();\n  };\n\n  private isInDatabase = () => {\n    let parent = this.parentElement;\n    while (parent && parent !== document.body) {\n      if (parent.tagName.toLowerCase() === 'affine-database') {\n        return true;\n      }\n      parent = parent.parentElement;\n    }\n    return false;\n  };\n\n  override render() {\n    const { type } = this.model;\n\n    // hide placeholder in database\n    const tipsPlaceholderTemplate = this.isInDatabase()\n      ? ''\n      : this._tipsPlaceholderTemplate;\n\n    const children = html`<div\n      class=\"affine-block-children-container\"\n      style=\"padding-left: ${BLOCK_CHILDREN_CONTAINER_PADDING_LEFT}px\"\n    >\n      ${this.content}\n    </div>`;\n\n    return html`\n      <div class=\"affine-paragraph-block-container ${type}\">\n        ${tipsPlaceholderTemplate}\n        <rich-text\n          .model=${this.model}\n          .textSchema=${this.textSchema}\n          @focusin=${this._onFocusIn}\n          @focusout=${this._onFocusOut}\n          style=${styleMap({\n            fontWeight: /^h[1-6]$/.test(type) ? '600' : undefined,\n          })}\n        ></rich-text>\n        ${children}\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-paragraph': ParagraphBlockComponent;\n  }\n}\n", "import { defineBlockSchema, type SchemaToModel } from '@blocksuite/store';\nimport { literal } from 'lit/static-html.js';\n\nexport type ParagraphType =\n  | 'text'\n  | 'quote'\n  | 'h1'\n  | 'h2'\n  | 'h3'\n  | 'h4'\n  | 'h5'\n  | 'h6';\n\nexport const ParagraphBlockSchema = defineBlockSchema({\n  flavour: 'affine:paragraph',\n  props: internal => ({\n    type: 'text' as ParagraphType,\n    text: internal.Text(),\n  }),\n  metadata: {\n    version: 1,\n    role: 'content',\n    tag: literal`affine-paragraph`,\n    parent: [\n      'affine:frame',\n      'affine:database',\n      'affine:paragraph',\n      'affine:list',\n    ],\n  },\n});\n\nexport type ParagraphBlockModel = SchemaToModel<typeof ParagraphBlockSchema>;\n", "import type { BaseBlockModel } from '@blocksuite/store';\n\nimport type { BlockTransformContext } from '../__internal__/index.js';\nimport type { BlockRange, SerializedBlock } from '../__internal__/index.js';\nimport { BaseService } from '../__internal__/service/index.js';\nimport { json2block } from '../__internal__/service/json2block.js';\nimport type { ListBlockModel } from './list-model.js';\nexport class ListBlockService extends BaseService<ListBlockModel> {\n  override block2html(\n    block: ListBlockModel,\n    { childText = '', begin, end }: BlockTransformContext = {}\n  ) {\n    let text = super.block2html(block, {\n      childText,\n      begin,\n      end,\n    });\n    const previousSiblingBlock = block.page.getPreviousSibling(block);\n    const nextSiblingBlock = block.page.getNextSibling(block);\n    switch (block.type) {\n      case 'bulleted':\n      case 'toggle':\n        text = `<li>${text}</li>`;\n        break;\n      case 'numbered':\n        text = `<li>${text}</li>`;\n        break;\n      case 'todo':\n        text = `<li><input disabled type=\"checkbox\" ${\n          block.checked ? 'checked' : ''\n        }>${text}</li>`;\n        break;\n      default:\n        break;\n    }\n    if (\n      previousSiblingBlock?.flavour !== block.flavour ||\n      previousSiblingBlock.type !== block.type\n    ) {\n      switch (block.type) {\n        case 'bulleted':\n        case 'toggle':\n        case 'todo':\n          text = `<ul>${text}`;\n          break;\n        case 'numbered':\n          text = `<ol>${text}`;\n          break;\n        default:\n          break;\n      }\n    }\n    if (\n      nextSiblingBlock?.flavour !== block.flavour ||\n      nextSiblingBlock.type !== block.type\n    ) {\n      switch (block.type) {\n        case 'bulleted':\n        case 'toggle':\n        case 'todo':\n          text = `${text}</ul>`;\n          break;\n        case 'numbered':\n          text = `${text}</ol>`;\n          break;\n        default:\n          break;\n      }\n    }\n    return text;\n  }\n\n  override async json2Block(\n    focusedBlockModel: BaseBlockModel,\n    pastedBlocks: SerializedBlock[],\n    range?: BlockRange\n  ) {\n    const convertToPastedIfEmpty = pastedBlocks[0].flavour !== 'affine:list';\n    return json2block(focusedBlockModel, pastedBlocks, {\n      range,\n      convertToPastedIfEmpty,\n    });\n  }\n}\n", "function number2letter(n: number) {\n  const ordA = 'a'.charCodeAt(0);\n  const ordZ = 'z'.charCodeAt(0);\n  const len = ordZ - ordA + 1;\n  let s = '';\n  while (n >= 0) {\n    s = String.fromCharCode((n % len) + ordA) + s;\n    n = Math.floor(n / len) - 1;\n  }\n  return s;\n}\n\n// Derive from https://gist.github.com/imilu/00f32c61e50b7ca296f91e9d96d8e976\nexport function number2roman(num: number) {\n  const lookup: { [key: string]: number } = {\n    M: 1000,\n    CM: 900,\n    D: 500,\n    CD: 400,\n    C: 100,\n    XC: 90,\n    L: 50,\n    XL: 40,\n    X: 10,\n    IX: 9,\n    V: 5,\n    IV: 4,\n    I: 1,\n  };\n  let romanStr = '';\n  for (const i in lookup) {\n    while (num >= lookup[i]) {\n      romanStr += i;\n      num -= lookup[i];\n    }\n  }\n  return romanStr;\n}\n\nfunction getPrefix(depth: number, index: number) {\n  const map = [() => index + 1, number2letter, () => number2roman(index + 1)];\n  return map[depth % map.length](index);\n}\n\nexport function getNumberPrefix(index: number, depth: number) {\n  const prefix = getPrefix(depth, index);\n  return `${prefix} .`;\n}\n", "import { html } from 'lit';\n\nexport const point1 = () => {\n  return html`\n    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n      <circle cx=\"12\" cy=\"12\" r=\"2\" />\n    </svg>\n  `;\n};\n\nexport const point2 = () => {\n  return html`\n    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M12 13.5C12.8284 13.5 13.5 12.8284 13.5 12C13.5 11.1716 12.8284 10.5 12 10.5C11.1716 10.5 10.5 11.1716 10.5 12C10.5 12.8284 11.1716 13.5 12 13.5ZM12 14C13.1046 14 14 13.1046 14 12C14 10.8954 13.1046 10 12 10C10.8954 10 10 10.8954 10 12C10 13.1046 10.8954 14 12 14Z\"\n      />\n    </svg>\n  `;\n};\n\nexport const point3 = () => {\n  return html`\n    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n      <path\n        d=\"M11.6056 10.1634C11.8234 9.94555 12.1766 9.94555 12.3944 10.1634L13.8366 11.6056C14.0545 11.8234 14.0545 12.1766 13.8366 12.3944L12.3944 13.8366C12.1766 14.0545 11.8234 14.0545 11.6056 13.8366L10.1634 12.3944C9.94555 12.1766 9.94555 11.8234 10.1634 11.6056L11.6056 10.1634Z\"\n      />\n    </svg>\n  `;\n};\n\nexport const point4 = () => {\n  return html`\n    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M13.4422 12L12 10.5578L10.5578 12L12 13.4422L13.4422 12ZM12.3944 10.1634C12.1766 9.94555 11.8234 9.94555 11.6056 10.1634L10.1634 11.6056C9.94555 11.8234 9.94555 12.1766 10.1634 12.3944L11.6056 13.8366C11.8234 14.0545 12.1766 14.0545 12.3944 13.8366L13.8366 12.3944C14.0545 12.1766 14.0545 11.8234 13.8366 11.6056L12.3944 10.1634Z\"\n        fill=\"#7389FD\"\n      />\n    </svg>\n  `;\n};\n\nexport const toggleRight = (enabled = true) => {\n  return html`\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      data-is-toggle-icon=\"true\"\n      width=\"1em\"\n      height=\"1em\"\n      viewBox=\"0 0 20 20\"\n    >\n      <path\n        data-is-toggle-icon=\"true\"\n        fill=\"currentColor\"\n        opacity=\"${!enabled ? '0.6' : '1'}\"\n        d=\"m15.795 11.272l-8 5A1.5 1.5 0 0 1 5.5 15V5a1.5 1.5 0 0 1 2.295-1.272l8 5a1.5 1.5 0 0 1 0 2.544Z\"\n      />\n    </svg>\n  `;\n};\nexport const toggleDown = () => {\n  return html`\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      data-is-toggle-icon=\"true\"\n      width=\"1em\"\n      height=\"1em\"\n      viewBox=\"0 0 20 20\"\n      @mousedown=\"${(e: MouseEvent) => {\n        // console.log('preventing def svg');\n        // e.preventDefault();\n      }}\"\n    >\n      <path\n        data-is-toggle-icon=\"true\"\n        fill=\"currentColor\"\n        d=\"m8.728 15.795l-5-8A1.5 1.5 0 0 1 5 5.5h10a1.5 1.5 0 0 1 1.272 2.295l-5 8a1.5 1.5 0 0 1-2.544 0Z\"\n      />\n    </svg>\n  `;\n};\n\nexport const chevronCircleRight = (enabled = true) => {\n  return html`\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"1em\"\n      height=\"1em\"\n      viewBox=\"0 0 512 512\"\n    >\n      <path\n        fill=\"currentColor\"\n        opacity=\"${!enabled ? '0.6' : '1'}\"\n        d=\"M256 8c137 0 248 111 248 248S393 504 256 504S8 393 8 256S119 8 256 8zm113.9 231L234.4 103.5c-9.4-9.4-24.6-9.4-33.9 0l-17 17c-9.4 9.4-9.4 24.6 0 33.9L285.1 256L183.5 357.6c-9.4 9.4-9.4 24.6 0 33.9l17 17c9.4 9.4 24.6 9.4 33.9 0L369.9 273c9.4-9.4 9.4-24.6 0-34z\"\n      />\n    </svg>\n  `;\n};\nexport const chevronCircleDown = () => {\n  return html`\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"1em\"\n      height=\"1em\"\n      viewBox=\"0 0 512 512\"\n    >\n      <path\n        fill=\"currentColor\"\n        d=\"M504 256c0 137-111 248-248 248S8 393 8 256S119 8 256 8s248 111 248 248zM273 369.9l135.5-135.5c9.4-9.4 9.4-24.6 0-33.9l-17-17c-9.4-9.4-24.6-9.4-33.9 0L256 285.1L154.4 183.5c-9.4-9.4-24.6-9.4-33.9 0l-17 17c-9.4 9.4-9.4 24.6 0 33.9L239 369.9c9.4 9.4 24.6 9.4 34 0z\"\n      />\n    </svg>\n  `;\n};\n\nexport const checkboxChecked = () => {\n  return html`\n    <svg\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M7 4C5.34315 4 4 5.34315 4 7V17C4 18.6569 5.34315 20 7 20H17C18.6569 20 20 18.6569 20 17V7C20 5.34315 18.6569 4 17 4H7ZM17.5665 9.56473C17.8785 9.25181 17.8776 8.74528 17.5647 8.43336C17.2518 8.12144 16.7453 8.12225 16.4334 8.43517L10.3547 14.5333L7.56666 11.7352C7.2548 11.4222 6.74827 11.4213 6.43529 11.7331C6.1223 12.045 6.12139 12.5515 6.43325 12.8645L9.64626 16.0891C10.037 16.4813 10.672 16.4814 11.0629 16.0893L17.5665 9.56473Z\"\n        fill=\"#A6ABB7\"\n      />\n    </svg>\n  `;\n};\n\nexport const checkboxUnchecked = () => {\n  return html`\n    <svg\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M17 5.6H7C6.2268 5.6 5.6 6.2268 5.6 7V17C5.6 17.7732 6.2268 18.4 7 18.4H17C17.7732 18.4 18.4 17.7732 18.4 17V7C18.4 6.2268 17.7732 5.6 17 5.6ZM7 4C5.34315 4 4 5.34315 4 7V17C4 18.6569 5.34315 20 7 20H17C18.6569 20 20 18.6569 20 17V7C20 5.34315 18.6569 4 17 4H7Z\"\n        fill=\"#A6ABB7\"\n      />\n    </svg>\n  `;\n};\n\nexport const points = [point1(), point2(), point3(), point4()];\n", "import { html } from 'lit';\n\nimport type { ListBlockModel } from '../list-model.js';\nimport { getNumberPrefix } from './get-number-prefix.js';\nimport {\n  checkboxChecked,\n  checkboxUnchecked,\n  points,\n  toggleDown,\n  toggleRight,\n} from './icons.js';\n\nexport function ListIcon(\n  model: ListBlockModel,\n  index: number,\n  depth: number,\n  showChildren: boolean,\n  onClick: (e: MouseEvent) => void\n) {\n  const icon = (() => {\n    switch (model.type) {\n      case 'bulleted':\n        return points[depth % points.length];\n      case 'numbered':\n        return getNumberPrefix(index, depth);\n      case 'todo':\n        return model.checked ? checkboxChecked() : checkboxUnchecked();\n      case 'toggle':\n        return showChildren\n          ? toggleDown()\n          : toggleRight(model.children.length > 0);\n      default:\n        return '';\n    }\n  })();\n\n  return html`\n    <div\n      class=\"affine-list-block__prefix ${model.type === 'todo'\n        ? 'affine-list-block__todo-prefix'\n        : ''}\"\n      @click=\"${(e: MouseEvent) => onClick(e)}\"\n    >\n      ${icon}\n    </div>\n  `;\n}\n", "import type { ListBlockModel } from '../list-model.js';\n\nconst getIndex = (model: ListBlockModel) => {\n  const siblings = model.page.getParent(model)?.children || [];\n  const fakeIndex = siblings.findIndex(v => v === model);\n\n  // fakeIndex is the index of the model in the parent's children array\n  // but we need to filter out the other list items\n  let index = 0;\n  for (let i = 0; i < fakeIndex; i++) {\n    if (\n      siblings[i].flavour === model.flavour &&\n      siblings[i].type === model.type\n    ) {\n      index += 1;\n    } else {\n      index = 0;\n    }\n  }\n\n  return index;\n};\n\nconst getListDeep = (model: ListBlockModel): number => {\n  let deep = 0;\n  let parent = model.page.getParent(model);\n  while (parent?.flavour === model.flavour) {\n    deep++;\n    parent = model.page.getParent(parent);\n  }\n  return deep;\n};\n\nexport const getListInfo = (model: ListBlockModel) => {\n  const deep = getListDeep(model);\n  const index = getIndex(model);\n\n  return { deep, index };\n};\n", "/// <reference types=\"vite/client\" />\nimport '../__internal__/rich-text/rich-text.js';\n\nimport { BLOCK_CHILDREN_CONTAINER_PADDING_LEFT } from '@blocksuite/global/config';\nimport { BlockElement } from '@blocksuite/lit';\nimport { assertExists } from '@blocksuite/store';\nimport { css, html, nothing } from 'lit';\nimport { customElement, state } from 'lit/decorators.js';\n\nimport { getPageBlock } from '../__internal__/index.js';\nimport { attributeRenderer } from '../__internal__/rich-text/virgo/attribute-renderer.js';\nimport {\n  affineTextAttributes,\n  type AffineTextSchema,\n} from '../__internal__/rich-text/virgo/types.js';\nimport { registerService } from '../__internal__/service.js';\nimport { DefaultPageBlockComponent } from '../index.js';\nimport type { ListBlockModel } from './list-model.js';\nimport { ListBlockService } from './list-service.js';\nimport { ListIcon } from './utils/get-list-icon.js';\nimport { getListInfo } from './utils/get-list-info.js';\n\n@customElement('affine-list')\nexport class ListBlockComponent extends BlockElement<ListBlockModel> {\n  static override styles = css`\n    .affine-list-block-container {\n      box-sizing: border-box;\n      border-radius: 5px;\n      margin-top: 2px;\n    }\n    .affine-list-block-container--first {\n      margin-top: var(--affine-paragraph-space);\n    }\n    .affine-list-block-container .affine-list-block-container {\n      margin-top: 0;\n    }\n    .affine-list-block-container.selected {\n      background-color: var(--affine-hover-color);\n    }\n    .affine-list-rich-text-wrapper {\n      display: flex;\n      align-items: center;\n    }\n    .affine-list-rich-text-wrapper rich-text {\n      flex: 1;\n    }\n\n    .affine-list-block__prefix {\n      flex-shrink: 0;\n      min-width: 26px;\n      height: 26px;\n      margin-right: 4px;\n      display: flex;\n      align-items: center;\n      justify-content: flex-start;\n      align-self: flex-start;\n      color: var(--affine-list-color);\n      font-size: 14px;\n      line-height: var(--affine-line-height);\n      user-select: none;\n    }\n    .affine-list-block__todo-prefix {\n      cursor: pointer;\n    }\n    .affine-list-block__todo {\n      width: 16px;\n      height: 16px;\n      border-radius: 4px;\n      border: 1px solid var(--affine-icon-color);\n    }\n    .affine-list-block__todo.affine-list-block__todo--active {\n      background: var(--affine-icon-color);\n    }\n\n    .affine-list--checked {\n      color: var(--affine-icon-color);\n    }\n  `;\n\n  @state()\n  showChildren = true;\n\n  readonly textSchema: AffineTextSchema = {\n    attributesSchema: affineTextAttributes,\n    textRenderer: attributeRenderer,\n  };\n\n  private _select() {\n    const pageBlock = getPageBlock(this.model);\n    assertExists(pageBlock);\n    if (pageBlock instanceof DefaultPageBlockComponent) {\n      pageBlock.selection.selectOneBlock(this);\n    }\n  }\n\n  private _onClickIcon = (e: MouseEvent) => {\n    e.stopPropagation();\n\n    if (this.model.type === 'toggle') {\n      this.showChildren = !this.showChildren;\n      return;\n    } else if (this.model.type === 'todo') {\n      this.model.page.captureSync();\n      const checkedPropObj = { checked: !this.model.checked };\n      this.model.page.updateBlock(this.model, checkedPropObj);\n      return;\n    }\n    this._select();\n  };\n\n  override firstUpdated() {\n    this.model.propsUpdated.on(() => this.requestUpdate());\n    this.model.childrenUpdated.on(() => this.requestUpdate());\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    registerService('affine:list', ListBlockService);\n  }\n\n  override render() {\n    const { deep, index } = getListInfo(this.model);\n    const { model, showChildren, _onClickIcon } = this;\n    const listIcon = ListIcon(model, index, deep, showChildren, _onClickIcon);\n\n    // For the first list item, we need to add a margin-top to make it align with the text\n    const shouldAddMarginTop = index === 0 && deep === 0;\n\n    const children = html`<div\n      class=\"affine-block-children-container\"\n      style=\"padding-left: ${BLOCK_CHILDREN_CONTAINER_PADDING_LEFT}px\"\n    >\n      ${this.content}\n    </div>`;\n\n    return html`\n      <div\n        class=${`affine-list-block-container ${\n          shouldAddMarginTop ? 'affine-list-block-container--first' : ''\n        }`}\n      >\n        <div\n          class=${`affine-list-rich-text-wrapper ${\n            this.model.checked ? 'affine-list--checked' : ''\n          }`}\n        >\n          ${listIcon}\n          <rich-text\n            .model=${this.model}\n            .textSchema=${this.textSchema}\n          ></rich-text>\n        </div>\n        ${this.showChildren ? children : nothing}\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-list': ListBlockComponent;\n  }\n}\n", "import { defineBlockSchema, type SchemaToModel } from '@blocksuite/store';\nimport { literal } from 'lit/static-html.js';\n\nexport type ListType = 'bulleted' | 'numbered' | 'todo' | 'toggle';\nexport const ListBlockSchema = defineBlockSchema({\n  flavour: 'affine:list',\n  props: internal => ({\n    type: 'bulleted' as ListType,\n    text: internal.Text(),\n    checked: false,\n  }),\n  metadata: {\n    version: 1,\n    role: 'content',\n    tag: literal`affine-list`,\n    parent: [\n      'affine:frame',\n      'affine:database',\n      'affine:list',\n      'affine:paragraph',\n    ],\n  },\n});\n\nexport type ListBlockModel = SchemaToModel<typeof ListBlockSchema>;\n", "import type { BaseBlockModel } from '@blocksuite/store';\n\nimport { getService } from '../__internal__/service.js';\nimport { BaseService } from '../__internal__/service/index.js';\nimport { addSerializedBlocks } from '../__internal__/service/json2block.js';\nimport type { SerializedBlock } from '../__internal__/utils/index.js';\nimport type { FrameBlockModel } from './frame-model.js';\n\nexport class FrameBlockService extends BaseService<FrameBlockModel> {\n  override async json2Block(\n    focusedBlockModel: BaseBlockModel,\n    pastedBlocks: SerializedBlock[]\n  ) {\n    await addSerializedBlocks(\n      focusedBlockModel.page,\n      pastedBlocks,\n      focusedBlockModel,\n      0\n    );\n  }\n\n  override block2Json(\n    block: FrameBlockModel,\n    begin?: number,\n    end?: number\n  ): SerializedBlock {\n    const delta = block.text?.sliceToDelta(begin || 0, end) || [];\n    return {\n      flavour: block.flavour,\n      type: block.type as string,\n      text: delta,\n      xywh: block.xywh,\n      background: block.background,\n      children: block.children?.map((child, index) => {\n        if (index === block.children.length - 1) {\n          return getService(child.flavour).block2Json(child, 0, end);\n        }\n        return getService(child.flavour).block2Json(child);\n      }),\n    };\n  }\n}\n", "/// <reference types=\"vite/client\" />\nimport { BlockElement } from '@blocksuite/lit';\nimport { css, html } from 'lit';\nimport { customElement } from 'lit/decorators.js';\n\nimport { registerService } from '../__internal__/service.js';\nimport type { FrameBlockModel } from './frame-model.js';\nimport { FrameBlockService } from './frame-service.js';\n\n@customElement('affine-frame')\nexport class FrameBlockComponent extends BlockElement<FrameBlockModel> {\n  static override styles = css`\n    .affine-frame-block-container {\n      display: flow-root;\n    }\n    .affine-frame-block-container.selected {\n      background-color: var(--affine-hover-color);\n    }\n  `;\n\n  override connectedCallback() {\n    super.connectedCallback();\n    registerService('affine:frame', FrameBlockService);\n  }\n\n  override firstUpdated() {\n    this.model.propsUpdated.on(() => this.requestUpdate());\n    this.model.childrenUpdated.on(() => this.requestUpdate());\n  }\n\n  override render() {\n    return html`\n      <div class=\"affine-frame-block-container\">\n        <div class=\"affine-block-children-container\">${this.content}</div>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-frame': FrameBlockComponent;\n  }\n}\n", "import {\n  EDITOR_WIDTH,\n  FRAME_BACKGROUND_COLORS,\n} from '@blocksuite/global/config';\nimport { defineBlockSchema, type SchemaToModel } from '@blocksuite/store';\nimport { literal } from 'lit/static-html.js';\n\nexport const FrameBlockSchema = defineBlockSchema({\n  flavour: 'affine:frame',\n  props: () => ({\n    xywh: `[0,0,${EDITOR_WIDTH},480]`,\n    background: FRAME_BACKGROUND_COLORS[0],\n    index: 'a0',\n  }),\n  metadata: {\n    version: 1,\n    role: 'hub',\n    tag: literal`affine-frame`,\n    parent: ['affine:page'],\n    children: [\n      'affine:paragraph',\n      'affine:list',\n      'affine:code',\n      'affine:divider',\n      'affine:database',\n      'affine:embed',\n      'affine:frame-block-*',\n      'affine:bookmark',\n    ],\n  },\n});\n\nexport type FrameBlockModel = SchemaToModel<typeof FrameBlockSchema>;\n", "import type { BlockTransformContext } from '../__internal__/index.js';\nimport { BaseService } from '../__internal__/service/index.js';\nimport type { DividerBlockModel } from './divider-model.js';\n\nexport class DividerBlockService extends BaseService<DividerBlockModel> {\n  override block2html(\n    block: DividerBlockModel,\n    { childText = '', begin, end }: BlockTransformContext = {}\n  ): string {\n    return `<hr/>`;\n  }\n}\n", "/// <reference types=\"vite/client\" />\nimport { BLOCK_CHILDREN_CONTAINER_PADDING_LEFT } from '@blocksuite/global/config';\nimport { BlockElement } from '@blocksuite/lit';\nimport { css, html } from 'lit';\nimport { customElement } from 'lit/decorators.js';\n\nimport { registerService } from '../__internal__/service.js';\nimport type { DividerBlockModel } from './divider-model.js';\nimport { DividerBlockService } from './divider-service.js';\n\n@customElement('affine-divider')\nexport class DividerBlockComponent extends BlockElement<DividerBlockModel> {\n  static override styles = css`\n    .affine-divider-block-container {\n      width: 100%;\n      height: 20px;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      margin-top: calc(var(--affine-paragraph-space) + 8px);\n      margin-bottom: calc(var(--affine-paragraph-space) + 8px);\n    }\n    hr {\n      width: 100%;\n    }\n  `;\n\n  override connectedCallback() {\n    super.connectedCallback();\n    registerService('affine:divider', DividerBlockService);\n  }\n\n  override firstUpdated() {\n    this.model.propsUpdated.on(() => this.requestUpdate());\n    this.model.childrenUpdated.on(() => this.requestUpdate());\n  }\n\n  override render() {\n    const children = html`<div\n      class=\"affine-block-children-container\"\n      style=\"padding-left: ${BLOCK_CHILDREN_CONTAINER_PADDING_LEFT}px\"\n    >\n      ${this.content}\n    </div>`;\n\n    return html`\n      <div class=${`affine-divider-block-container`}>\n        <hr />\n        ${children}\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-divider': DividerBlockComponent;\n  }\n}\n", "import { defineBlockSchema, type SchemaToModel } from '@blocksuite/store';\nimport { literal } from 'lit/static-html.js';\n\nexport const DividerBlockSchema = defineBlockSchema({\n  flavour: 'affine:divider',\n  metadata: {\n    version: 1,\n    role: 'content',\n    tag: literal`affine-divider`,\n    children: [],\n  },\n});\n\nexport type DividerBlockModel = SchemaToModel<typeof DividerBlockSchema>;\n", "import type { IThemedToken } from 'shiki';\n\nclass LRUCache<K, V> {\n  private maxSize: number;\n  private cache: Map<K, V>;\n\n  constructor(maxSize: number) {\n    this.maxSize = maxSize;\n    this.cache = new Map();\n  }\n\n  get(key: K): V | null {\n    const value = this.cache.get(key);\n    if (value === undefined) {\n      return null;\n    }\n    this.cache.delete(key);\n    this.cache.set(key, value);\n    return value;\n  }\n\n  set(key: K, value: V): void {\n    if (this.cache.size >= this.maxSize) {\n      const firstKey = this.cache.keys().next().value;\n      this.cache.delete(firstKey);\n    }\n    this.cache.set(key, value);\n  }\n}\n\nexport type highlightCacheKey = `${string}-${string}-${string}`;\n\nexport const highlightCache = new LRUCache<highlightCacheKey, IThemedToken[]>(\n  100\n);\n", "import { ShadowlessElement } from '@blocksuite/lit';\nimport { assertExists } from '@blocksuite/store';\nimport { type DeltaInsert, VText, ZERO_WIDTH_SPACE } from '@blocksuite/virgo';\nimport { html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\nimport type { Highlighter, IThemedToken, Lang } from 'shiki';\n\nimport type { AffineTextAttributes } from '../__internal__/rich-text/virgo/types.js';\nimport { queryCurrentMode } from '../std.js';\nimport { DARK_THEME, LIGHT_THEME } from './utils/consts.js';\nimport {\n  highlightCache,\n  type highlightCacheKey,\n} from './utils/highlight-cache.js';\n\n@customElement('affine-code-line')\nexport class AffineCodeLine extends ShadowlessElement {\n  @property({ type: Object })\n  delta: DeltaInsert<AffineTextAttributes> = {\n    insert: ZERO_WIDTH_SPACE,\n  };\n\n  @property()\n  highlightOptionsGetter:\n    | (() => {\n        lang: Lang;\n        highlighter: Highlighter | null;\n      })\n    | null = null;\n\n  override render() {\n    assertExists(\n      this.highlightOptionsGetter,\n      'highlightOptionsGetter is not set'\n    );\n    const { lang, highlighter } = this.highlightOptionsGetter();\n\n    if (!highlighter || !highlighter.getLoadedLanguages().includes(lang)) {\n      const vText = new VText();\n      vText.str = this.delta.insert;\n      vText.styles = styleMap({});\n      return html`<span>${vText}</span>`;\n    }\n\n    const mode = queryCurrentMode();\n    const cacheKey: highlightCacheKey = `${this.delta.insert}-${lang}-${mode}`;\n    const cache = highlightCache.get(cacheKey);\n\n    let tokens: IThemedToken[] = [\n      {\n        content: this.delta.insert,\n      },\n    ];\n    if (cache) {\n      tokens = cache;\n    } else {\n      tokens = highlighter.codeToThemedTokens(\n        this.delta.insert,\n        lang,\n        mode === 'dark' ? DARK_THEME : LIGHT_THEME\n      )[0];\n      highlightCache.set(cacheKey, tokens);\n    }\n\n    const vTexts = tokens.map(token => {\n      const vText = new VText();\n      vText.str = token.content;\n      vText.styles = styleMap({\n        color: token.color,\n      });\n\n      return vText;\n    });\n\n    return html`<span>${vTexts}</span>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-code-line': AffineCodeLine;\n  }\n}\n", "import { BaseService } from '../__internal__/service/index.js';\nimport type {\n  BlockTransformContext,\n  SerializedBlock,\n} from '../__internal__/utils/index.js';\nimport type { EmbedBlockModel } from './embed-model.js';\nexport class EmbedBlockService extends BaseService<EmbedBlockModel> {\n  override block2html(\n    block: EmbedBlockModel,\n    { childText = '', begin, end }: BlockTransformContext = {}\n  ) {\n    return `<figure><img src=\"${block.sourceId}\" alt=\"${block.caption}\"><figcaption>${block.caption}</figcaption></figure>`;\n  }\n\n  override block2Text(\n    block: EmbedBlockModel,\n    { childText = '', begin, end }: BlockTransformContext = {}\n  ): string {\n    return block.caption;\n  }\n\n  override block2Json(\n    block: EmbedBlockModel,\n    begin?: number,\n    end?: number\n  ): SerializedBlock {\n    return {\n      type: block.type,\n      sourceId: block.sourceId,\n      width: block.width,\n      height: block.height,\n      caption: block.caption,\n      flavour: block.flavour,\n      children: [],\n    };\n  }\n}\n", "import { BlockElement } from '@blocksuite/lit';\nimport { css, html, nothing, type PropertyValues } from 'lit';\nimport { customElement, query, state } from 'lit/decorators.js';\n\nimport { registerService } from '../__internal__/service.js';\nimport type { EmbedBlockModel } from './embed-model.js';\nimport { EmbedBlockService } from './embed-service.js';\n\n@customElement('affine-embed')\nexport class EmbedBlockComponent extends BlockElement<EmbedBlockModel> {\n  static override styles = css`\n    affine-embed {\n      display: block;\n    }\n    .affine-embed-wrapper {\n      text-align: center;\n      margin-bottom: calc(var(--affine-paragraph-space) + 8px);\n    }\n    .affine-embed-wrapper-caption {\n      width: 100%;\n      font-size: var(--affine-font-sm);\n      outline: none;\n      border: 0;\n      font-family: inherit;\n      text-align: center;\n      color: var(--affine-icon-color);\n      display: none;\n      background: var(--affine-background-primary-color);\n    }\n    .affine-embed-wrapper-caption::placeholder {\n      color: var(--affine-placeholder-color);\n    }\n\n    .affine-embed-wrapper .caption-show {\n      display: inline-block;\n    }\n  `;\n\n  @query('input')\n  _input!: HTMLInputElement;\n\n  @state()\n  private _caption!: string;\n\n  override connectedCallback() {\n    super.connectedCallback();\n    registerService('affine:embed', EmbedBlockService);\n  }\n\n  override firstUpdated(changedProperties: PropertyValues) {\n    super.firstUpdated(changedProperties);\n\n    this.updateComplete.then(() => {\n      this._caption = this.model?.caption ?? '';\n\n      if (this._caption.length > 0) {\n        // Caption input should be toggled manually.\n        // Otherwise it will be lost if the caption is deleted into empty state.\n        this._input.classList.add('caption-show');\n      }\n    });\n\n    // The embed block can not be focused,\n    // so the active element will be the last activated element.\n    // If the active element is the title textarea,\n    // any event will dispatch from it and be ignored. (Most events will ignore title)\n    // so we need to blur it.\n    // See also https://developer.mozilla.org/en-US/docs/Web/API/Document/activeElement\n    this.addEventListener('click', () => {\n      if (\n        document.activeElement &&\n        document.activeElement instanceof HTMLElement\n      ) {\n        document.activeElement.blur();\n      }\n    });\n  }\n\n  private _onInputChange() {\n    this._caption = this._input.value;\n    this.model.page.updateBlock(this.model, { caption: this._caption });\n  }\n\n  private _onInputBlur() {\n    if (!this._caption) {\n      this._input.classList.remove('caption-show');\n    }\n  }\n\n  override render() {\n    const slot =\n      this.model.type === 'image'\n        ? html`<affine-image .model=${this.model}></affine-image>`\n        : nothing;\n    return html`\n      ${slot}\n      <div class=\"affine-embed-block-container\">\n        <div class=\"affine-embed-wrapper\">\n          <input\n            .disabled=${this.model.page.readonly}\n            placeholder=\"Write a caption\"\n            class=\"affine-embed-wrapper-caption\"\n            value=${this._caption}\n            @input=${this._onInputChange}\n            @blur=${this._onInputBlur}\n            @click=${(e: Event) => {\n              e.stopPropagation();\n            }}\n          />\n        </div>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-embed': EmbedBlockComponent;\n  }\n}\n", "import { defineBlockSchema, type SchemaToModel } from '@blocksuite/store';\nimport { literal } from 'lit/static-html.js';\n\nexport const EmbedBlockSchema = defineBlockSchema({\n  flavour: 'affine:embed',\n  props: () => ({\n    type: 'image',\n    caption: '',\n    sourceId: '',\n    width: 0,\n    height: 0,\n  }),\n  metadata: {\n    version: 1,\n    role: 'content',\n    tag: literal`affine-embed`,\n  },\n});\n\nexport type EmbedBlockModel = SchemaToModel<typeof EmbedBlockSchema>;\n", "import { ShadowlessElement } from '@blocksuite/lit';\nimport { css, html } from 'lit';\nimport { customElement } from 'lit/decorators.js';\n\nconst ELEMENT_TAG = 'affine-image-block-circle-loading' as const;\n@customElement(ELEMENT_TAG)\nexport class AffineImageBlockCircleLoading extends ShadowlessElement {\n  static override styles = css`\n    @keyframes affine-image-block-rotate {\n      from {\n        rotate: 0deg;\n      }\n      to {\n        rotate: 360deg;\n      }\n    }\n\n    .affine-image-block-container {\n      width: 24px;\n      height: 24px;\n      overflow: hidden;\n    }\n\n    .affine-image-block-loading {\n      display: inline-block;\n      width: 24px;\n      height: 24px;\n      position: relative;\n      background: conic-gradient(rgba(255, 255, 255, 0.31), #6880ff);\n      border-radius: 50%;\n      animation: affine-image-block-rotate 1s infinite ease-in;\n    }\n\n    .affine-image-block-loading::before {\n      content: '';\n      width: 20px;\n      height: 20px;\n      border-radius: 50%;\n      background-color: white;\n      position: absolute;\n      top: 2px;\n      left: 2px;\n    }\n  `;\n\n  override render() {\n    return html`<div class=\"affine-image-block-container\">\n      <div class=\"affine-image-block-loading\"></div>\n    </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [ELEMENT_TAG]: AffineImageBlockCircleLoading;\n  }\n}\n", "import './circle-loading.js';\n\nimport { ShadowlessElement } from '@blocksuite/lit';\nimport { css, html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nconst ELEMENT_TAG = 'affine-image-block-loading-card' as const;\n\n@customElement(ELEMENT_TAG)\nexport class AffineImageBlockLoadingCard extends ShadowlessElement {\n  static override styles = css`\n    .affine-image-block-loading-card {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      width: 100%;\n      height: 100%;\n      margin: 0 auto;\n      border: 1px solid #ebeeff;\n      border-radius: 10px;\n      background: #fbfbff;\n    }\n\n    .affine-image-block-content {\n      height: 30px;\n      line-height: 22px;\n      padding-top: 8px;\n      color: var(--affine-primary-color);\n      font-size: 16px;\n      font-weight: 400;\n    }\n  `;\n\n  @property()\n  content = 'Loading content...';\n\n  override render() {\n    return html`\n      <div class=\"affine-image-block-loading-card\">\n        <affine-image-block-circle-loading></affine-image-block-circle-loading>\n        <div class=\"affine-image-block-content\">${this.content}</div>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [ELEMENT_TAG]: AffineImageBlockLoadingCard;\n  }\n}\n", "import { ShadowlessElement } from '@blocksuite/lit';\nimport { css, html } from 'lit';\nimport { customElement } from 'lit/decorators.js';\n\nconst notFoundIcon = html`<svg\n  width=\"25\"\n  height=\"24\"\n  viewBox=\"0 0 25 24\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M14.5 3H8.3C6.61984 3 5.77976 3 5.13803 3.32698C4.57354 3.6146 4.1146 4.07354 3.82698 4.63803C3.5 5.27976 3.5 6.11984 3.5 7.8V16.2C3.5 17.8802 3.5 18.7202 3.82698 19.362C4.1146 19.9265 4.57354 20.3854 5.13803 20.673C5.77976 21 6.61984 21 8.3 21H12.5L15.5 18L11.5 14L12.8418 12.6582C12.8197 12.6391 12.7979 12.6205 12.7762 12.6022C12.4696 12.3444 12.1366 12.1162 11.7278 11.987C11.1185 11.7945 10.4637 11.8016 9.85866 12.0072C9.45274 12.1452 9.12474 12.3806 8.82383 12.645C8.82383 12.645 6.60291 14.8415 5.5 15.9308V6.6C5.5 6.03995 5.5 5.75992 5.60899 5.54601C5.70487 5.35785 5.85785 5.20487 6.04601 5.10899C6.25992 5 6.53995 5 7.1 5H12.5L14.5 3ZM13.304 7.80408C13.1102 8.15931 13 8.56677 13 9C13 9.94759 13.5271 10.7719 14.3041 11.1959L15.5 10L13.304 7.80408ZM15.4156 11.4986L16.9142 10L13.9514 7.03724C14.3773 6.7008 14.9152 6.5 15.5 6.5C16.8806 6.5 18 7.61914 18 9C18 10.3809 16.8806 11.5 15.5 11.5C15.4718 11.5 15.4437 11.4995 15.4156 11.4986ZM13.5691 13.3451C13.6352 13.4103 13.7029 13.4775 13.7724 13.5464L14.7645 14.5302C15.0059 14.2937 15.2246 14.0861 15.4261 13.9167C15.7329 13.6587 16.0663 13.4302 16.4756 13.3011C17.0855 13.1087 17.7409 13.1162 18.3463 13.3226C18.7524 13.4611 19.0805 13.6971 19.3813 13.9622C19.4202 13.9965 19.4598 14.0322 19.5 14.0694V6.6C19.5 6.03995 19.5 5.75992 19.391 5.54601C19.2951 5.35785 19.1422 5.20487 18.954 5.10899C18.7401 5 18.4601 5 17.9 5H13.9143L15.9143 3H16.7C18.3802 3 19.2202 3 19.862 3.32698C20.4265 3.6146 20.8854 4.07354 21.173 4.63803C21.5 5.27976 21.5 6.11984 21.5 7.8V16.2C21.5 17.8802 21.5 18.7202 21.173 19.362C20.8854 19.9265 20.4265 20.3854 19.862 20.673C19.2202 21 18.3802 21 16.7 21H13.9143L16.9142 18L12.9142 14L13.5691 13.3451Z\"\n    fill=\"#6880FF\"\n  />\n</svg>`;\n\nconst ELEMENT_TAG = 'affine-image-block-not-found-card' as const;\n\n@customElement(ELEMENT_TAG)\nexport class AffineImageBlockNotFoundCard extends ShadowlessElement {\n  static override styles = css`\n    .affine-image-block-not-found-card {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      width: 100%;\n      height: 100%;\n      margin: 0 auto;\n      border: 1px solid var(--affine-border-color);\n      border-radius: 10px;\n      background: var(--affine-background-primary-color);\n    }\n  `;\n\n  override render() {\n    return html`\n      <div class=\"affine-image-block-not-found-card\">${notFoundIcon}</div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [ELEMENT_TAG]: AffineImageBlockNotFoundCard;\n  }\n}\n", "import './placeholder/loading-card.js';\nimport './placeholder/image-not-found.js';\n\nimport type { Disposable } from '@blocksuite/global/utils';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/lit';\nimport { css, html } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { EmbedBlockModel } from '../index.js';\n\n@customElement('affine-image')\nexport class ImageBlockComponent extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    .affine-image-wrapper {\n      padding: 8px;\n      width: 100%;\n      text-align: center;\n      line-height: 0;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      margin-top: calc(var(--affine-paragraph-space) + 8px);\n      overflow: hidden;\n    }\n    .affine-image-wrapper img {\n      max-width: 100%;\n      margin: auto;\n      width: 100%;\n    }\n\n    .resizable {\n      max-width: 100%;\n    }\n\n    .active .resizable {\n      border: 1px solid var(--affine-primary-color) !important;\n    }\n    .resizable .image-option-container {\n      display: none;\n      position: absolute;\n      top: 4px;\n      right: -52px;\n      margin: 0;\n      padding-left: 12px;\n    }\n\n    .embed-editing-state {\n      box-shadow: var(--affine-shadow-2);\n      border-radius: 10px;\n      list-style: none;\n      padding: 4px;\n      width: 40px;\n      background-color: var(--affine-background-overlay-panel-color);\n      margin: 0;\n    }\n\n    .resizable .resizes {\n      /* width: 100%; */\n      height: 100%;\n      box-sizing: border-box;\n      line-height: 0;\n    }\n\n    .resizable .resizes .resize {\n      /* display: none; */\n      width: 10px;\n      height: 10px;\n      border-radius: 50%; /*magic to turn square into circle*/\n      background: white;\n      border: 2px solid var(--affine-primary-color);\n      position: absolute;\n    }\n\n    .resizable:hover .resize {\n      display: block;\n    }\n    .active .resize {\n      display: block !important;\n    }\n    .resizable .resizes .resize.top-left {\n      left: -5px;\n      top: -5px;\n      cursor: nwse-resize; /*resizer cursor*/\n    }\n    .resizable .resizes .resize.top-right {\n      right: -5px;\n      top: -5px;\n      cursor: nesw-resize;\n    }\n    .resizable .resizes .resize.bottom-left {\n      left: -5px;\n      bottom: -5px;\n      cursor: nesw-resize;\n    }\n    .resizable .resizes .resize.bottom-right {\n      right: -5px;\n      bottom: -5px;\n      cursor: nwse-resize;\n    }\n\n    .resizable-img {\n      border: 1px solid var(--affine-white-90);\n    }\n    .resizable-img:hover {\n      border: 1px solid var(--affine-primary-color);\n    }\n\n    .resizable-img img {\n      width: 100%;\n    }\n  `;\n\n  @property()\n  model!: EmbedBlockModel;\n\n  @query('.resizable-img')\n  public readonly resizeImg!: HTMLElement;\n\n  @state()\n  private _source!: string;\n\n  private _imageReady: Disposable = {\n    dispose: () => {\n      return;\n    },\n  };\n\n  static maxRetryCount = 3;\n\n  @state()\n  private _imageState: 'waitUploaded' | 'loading' | 'ready' | 'failed' =\n    'loading';\n\n  private _retryCount = 0;\n\n  override async firstUpdated() {\n    this.model.propsUpdated.on(() => this.requestUpdate());\n    this.model.childrenUpdated.on(() => this.requestUpdate());\n    // exclude padding and border width\n    const { width, height } = this.model;\n\n    if (width && height) {\n      this.resizeImg.style.width = width + 'px';\n      this.resizeImg.style.height = height + 'px';\n    }\n  }\n\n  private _fetchError = (e: unknown) => {\n    // Do have the id but cannot find the blob\n    //  this is probably because the blob is not uploaded yet\n    this._imageState = 'waitUploaded';\n    this._retryCount++;\n    console.warn('Cannot find blob, retrying', this._retryCount);\n    if (this._retryCount < ImageBlockComponent.maxRetryCount) {\n      setTimeout(() => {\n        this._fetchImage();\n        // 1s, 2s, 3s\n      }, 1000 * this._retryCount);\n    } else {\n      console.error(e);\n      this._imageState = 'failed';\n    }\n  };\n\n  private _fetchImage = () => {\n    if (this._imageState === 'ready') {\n      return;\n    }\n    const storage = this.model.page.blobs;\n    storage\n      .get(this.model.sourceId)\n      .then(blob => {\n        if (blob) {\n          this._source = URL.createObjectURL(blob);\n          this._imageState = 'ready';\n        } else {\n          this._fetchError(new Error('Cannot find blob'));\n        }\n      })\n      .catch(this._fetchError);\n  };\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._imageState = 'loading';\n    this._fetchImage();\n    this._disposables.add(\n      this.model.page.workspace.slots.blobUpdate.on(this._fetchImage)\n    );\n  }\n\n  override disconnectedCallback() {\n    this._imageReady.dispose();\n    if (this._source) {\n      URL.revokeObjectURL(this._source);\n    }\n    super.disconnectedCallback();\n  }\n\n  override render() {\n    const resizeImgStyle = {\n      width: 'unset',\n      height: 'unset',\n    };\n    const { width, height } = this.model;\n    if (width && height) {\n      resizeImgStyle.width = `${width}px`;\n      resizeImgStyle.height = `${height}px`;\n    }\n\n    const img = {\n      waitUploaded: html`<affine-image-block-loading-card\n        content=\"Delivering content...\"\n      ></affine-image-block-loading-card>`,\n      loading: html`<affine-image-block-loading-card\n        content=\"Loading content...\"\n      ></affine-image-block-loading-card>`,\n      ready: html`<img src=${this._source} />`,\n      failed: html`<affine-image-block-not-found-card></affine-image-block-not-found-card>`,\n    }[this._imageState];\n\n    // For the first list item, we need to add a margin-top to make it align with the text\n    // const shouldAddMarginTop = index === 0 && deep === 0;\n    return html`\n      <div class=\"affine-image-wrapper\">\n        <div class=\"resizable-img\" style=${styleMap(resizeImgStyle)}>\n          ${img}\n        </div>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-image': ImageBlockComponent;\n  }\n}\n", "import { defineBlockSchema, type SchemaToModel } from '@blocksuite/store';\nimport { literal } from 'lit/static-html.js';\n\nexport const SurfaceBlockSchema = defineBlockSchema({\n  flavour: 'affine:surface',\n  metadata: {\n    version: 3,\n    role: 'hub',\n    tag: literal`affine-surface`,\n    parent: ['affine:page'],\n    children: [],\n  },\n});\n\nexport type SurfaceBlockModel = SchemaToModel<typeof SurfaceBlockSchema>;\n", "import type { DatabaseAction, Divider } from './table/types.js';\n\n// source (2018-03-11): https://github.com/jquery/jquery/blob/master/src/css/hiddenVisibleSelectors.js\nfunction isVisible(elem: HTMLElement) {\n  return (\n    !!elem &&\n    !!(elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length)\n  );\n}\n\nexport function onClickOutside(\n  element: HTMLElement,\n  callback: (element: HTMLElement, target: HTMLElement) => void,\n  event: 'click' | 'mousedown' = 'click',\n  reusable = false\n): () => void {\n  const outsideClickListener = (event: Event) => {\n    // support shadow dom\n    const path = event.composedPath && event.composedPath();\n    const isOutside = path\n      ? path.indexOf(element) < 0\n      : !element.contains(event.target as Node) && isVisible(element);\n\n    if (!isOutside) return;\n\n    callback(element, event.target as HTMLElement);\n    // if reuseable, need to manually remove the listener\n    if (!reusable) removeClickListener();\n  };\n\n  document.addEventListener(event, outsideClickListener);\n  const removeClickListener = () => {\n    document.removeEventListener(event, outsideClickListener);\n  };\n\n  return removeClickListener;\n}\n\n/** select tag color poll */\nconst tagColorPoll: string[] = [\n  'var(--affine-tag-blue)',\n  'var(--affine-tag-green)',\n  'var(--affine-tag-teal)',\n  'var(--affine-tag-white)',\n  'var(--affine-tag-purple)',\n  'var(--affine-tag-red)',\n  'var(--affine-tag-pink)',\n  'var(--affine-tag-yellow)',\n  'var(--affine-tag-orange)',\n  'var(--affine-tag-gray)',\n];\n\nfunction tagColorHelper() {\n  let colors = [...tagColorPoll];\n  return () => {\n    if (colors.length === 0) {\n      colors = [...tagColorPoll];\n    }\n    const index = Math.floor(Math.random() * colors.length);\n    const color = colors.splice(index, 1)[0];\n    return color;\n  };\n}\n\nexport const getTagColor = tagColorHelper();\n\nexport function isDivider(action: DatabaseAction): action is Divider {\n  return action.type === 'divider';\n}\n", "/** column default width */\nexport const DEFAULT_COLUMN_WIDTH = 200;\n/** column min width */\nexport const DEFAULT_COLUMN_MIN_WIDTH = 100;\n/** column title height */\nexport const DEFAULT_COLUMN_TITLE_HEIGHT = 40;\n/** column title height */\nexport const DEFAULT_ADD_BUTTON_WIDTH = 40;\n\n/** database title length */\nexport const DATABASE_TITLE_LENGTH = 50;\n/** select tag name max length */\nexport const SELECT_TAG_NAME_MAX_LENGTH = 50;\n/** edit select popup width */\nexport const SELECT_EDIT_POPUP_WIDTH = 345;\n\nexport const DEFAULT_TITLE = 'Database';\n", "import type { TemplateResult } from 'lit';\n\nimport type { DatabaseMode } from '../types.js';\n\nexport type SetValueOption = {\n  captureSync: boolean;\n};\n\nexport interface RowHost<Value = unknown> extends HTMLElement {\n  setEditing(isEditing: boolean): void;\n  setHeight(height: number): void;\n  setValue(value: Value, option?: SetValueOption): void;\n  updateColumnProperty(\n    apply: (oldProperty: Record<string, unknown>) => Record<string, unknown>\n  ): void;\n}\n\nexport type ColumnType =\n  | 'rich-text'\n  | 'select'\n  | 'multi-select'\n  | 'number'\n  | 'checkbox'\n  | 'progress';\n\nexport type ColumnTypeIcon = Record<ColumnType, TemplateResult>;\n\nexport interface Column extends Record<string, unknown> {\n  id: string;\n  type: ColumnType;\n  width: number; // px\n  hide: boolean;\n}\n\nexport type Cell<ValueType = unknown> = {\n  columnId: Column['id'];\n  value: ValueType;\n};\n\nexport const enum ColumnInsertPosition {\n  Left = 'left',\n  Right = 'right',\n}\n\n/** select tag property */\nexport type SelectTag = {\n  id: string;\n  color: string;\n  value: string;\n};\n\nexport type ColumnHeader = {\n  type: ColumnType;\n  text: string;\n  icon: TemplateResult;\n};\n\nexport type ToolbarActionType = 'database-type' | 'copy' | 'delete-database';\n\nexport type SwitchViewActionType = DatabaseMode;\n\ntype ActionMenuItem<T extends DatabaseActionType> = {\n  type: T;\n  text: string;\n  icon: TemplateResult;\n};\n\nexport type ColumnActionType =\n  | 'rename'\n  | 'column-type'\n  | 'duplicate'\n  | 'insert-left'\n  | 'insert-right'\n  | 'move-left'\n  | 'move-right'\n  | 'delete';\nexport type ColumnAction = ActionMenuItem<ColumnActionType> | Divider;\n\ntype DatabaseActionType =\n  | ColumnActionType\n  | ToolbarActionType\n  | SwitchViewActionType;\n\nexport type DatabaseAction = ActionMenuItem<DatabaseActionType> | Divider;\n\n// divider in menu\nexport type Divider = {\n  type: 'divider';\n};\n\nexport type TitleColumnActionType = 'rename' | 'insert-right';\nexport type TitleColumnAction = ActionMenuItem<TitleColumnActionType>;\n\nexport type SelectTagActionType = 'rename' | 'delete';\nexport type SelectTagAction = ActionMenuItem<SelectTagActionType> | Divider;\n\nexport type ToolbarAction = ActionMenuItem<ToolbarActionType> | Divider;\n\nexport type SwitchViewAction = ActionMenuItem<SwitchViewActionType>;\n\nexport const enum SearchState {\n  /** show search input */\n  SearchInput = 'input',\n  /** show search icon */\n  SearchIcon = 'icon',\n  /** searching */\n  Searching = 'searching',\n  /** show more action */\n  Action = 'action',\n}\n\nexport const enum SelectMode {\n  Multi = 'multi',\n  Single = 'single',\n}\n", "import { css } from 'lit';\n\nexport const actionStyles = css`\n  .action {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    height: 32px;\n    padding: 4px 8px;\n    border-radius: 5px;\n    cursor: pointer;\n  }\n  .action:hover {\n    background: var(--affine-hover-color);\n  }\n  .action-content {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n  }\n  .action-content > svg {\n    width: 20px;\n    height: 20px;\n    color: var(--affine-icon-color);\n    fill: var(--affine-icon-color);\n  }\n  .action-divider {\n    height: 0.5px;\n    background: var(--affine-divider-color);\n    margin: 8px 0;\n  }\n`;\n\nexport const styles = css`\n  :host {\n    background: var(--affine-background-primary-color);\n    box-shadow: var(--affine-menu-shadow);\n    padding: 8px;\n    border: 1px solid var(--affine-border-color);\n    border-radius: 8px;\n    z-index: 1;\n    font-family: var(--affine-font-family);\n  }\n\n  .affine-database-edit-column-popup {\n    display: flex;\n    flex-direction: column;\n    color: var(--affine-text-primary-color);\n  }\n  .affine-database-edit-column-popup * {\n    box-sizing: border-box;\n  }\n  .rename,\n  .delete,\n  .column-type {\n    fill: var(--affine-icon-color);\n  }\n  .column-type > svg {\n    transform: rotate(-90deg);\n  }\n  ${actionStyles}\n`;\n", "import {\n  DatabaseDone,\n  DatabaseMultiSelect,\n  DatabaseNumber,\n  DatabaseProgress,\n  DatabaseSelect,\n  TextIcon,\n  TodoIcon,\n} from '@blocksuite/global/config';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport type { ColumnHeader, ColumnType } from '../../types.js';\nimport { actionStyles } from './styles.js';\n\nconst columnTypes: ColumnHeader[] = [\n  {\n    type: 'rich-text',\n    text: 'Text',\n    icon: TextIcon,\n  },\n  {\n    type: 'select',\n    text: 'Select',\n    icon: DatabaseSelect,\n  },\n  {\n    type: 'multi-select',\n    text: 'Multi-select',\n    icon: DatabaseMultiSelect,\n  },\n  {\n    type: 'number',\n    text: 'Number',\n    icon: DatabaseNumber,\n  },\n  {\n    type: 'checkbox',\n    text: 'Checkbox',\n    icon: TodoIcon,\n  },\n  {\n    type: 'progress',\n    text: 'Progress',\n    icon: DatabaseProgress,\n  },\n];\n\nconst styles = css`\n  :host {\n    z-index: 1;\n    width: 200px;\n    padding: 8px;\n    border: 1px solid var(--affine-border-color);\n    border-radius: 8px;\n    background: var(--affine-background-primary-color);\n    box-shadow: var(--affine-menu-shadow);\n    font-family: var(--affine-font-family);\n  }\n  ${actionStyles}\n  .action > svg {\n    width: 16px;\n    height: 16px;\n  }\n\n  .rich-text {\n    fill: var(--affine-icon-color);\n  }\n  .column-type {\n    padding: 0;\n    color: var(--affine-text-secondary-color);\n    font-size: 14px;\n    cursor: unset;\n  }\n  .column-type:hover {\n    background: none;\n  }\n  .selected {\n    color: var(--affine-text-emphasis-color);\n    background: rgba(0, 0, 0, 0.02);\n  }\n  .selected svg {\n    color: var(--affine-text-emphasis-color);\n  }\n  .selected.rich-text svg {\n    fill: var(--affine-text-emphasis-color);\n  }\n  /* .action.disabled {\n    cursor: not-allowed;\n  }\n  .action.disabled:hover {\n    background: unset;\n  } */\n`;\n\n@customElement('affine-database-column-type-popup')\nexport class ColumnTypePopup extends LitElement {\n  static override styles = styles;\n\n  @property()\n  columnType: ColumnType | undefined;\n\n  @property()\n  columnId!: string;\n\n  @property()\n  changeColumnType!: (columnId: string, type: ColumnType) => void;\n\n  override render() {\n    return html`\n      <div class=\"affine-database-column-type-popup\">\n        <div class=\"action column-type\">\n          <div class=\"action-content\"><span>Column type</span></div>\n        </div>\n        <div class=\"action-divider\"></div>\n        ${columnTypes.map(column => {\n          const selected = column.type === this.columnType;\n          const onChangeColumnType = () => {\n            if (!selected) {\n              this.changeColumnType(this.columnId, column.type);\n            }\n          };\n\n          return html`\n            <div\n              class=\"action ${column.type} ${selected ? 'selected' : ''}\"\n              @click=${onChangeColumnType}\n            >\n              <div class=\"action-content\">\n                ${column.icon}<span>${column.text}</span>\n              </div>\n              ${selected ? DatabaseDone : null}\n            </div>\n          `;\n        })}\n      </div>\n    `;\n  }\n}\n", "import { assertExists } from '@blocksuite/store';\n\nimport type { DatabaseBlockModel } from '../../../database-model.js';\nimport type { ColumnRendererHelper } from '../../register.js';\nimport type { Column, ColumnActionType, ColumnType } from '../../types.js';\nimport { ColumnInsertPosition } from '../../types.js';\n\nexport function changeColumnType(\n  columnId: string,\n  targetType: ColumnType,\n  targetColumn: Column | string,\n  targetModel: DatabaseBlockModel,\n  columnRenderer: ColumnRendererHelper\n) {\n  if (isTitleColumn(targetColumn)) return;\n\n  const currentType = targetColumn.type;\n  targetModel.page.captureSync();\n\n  // select -> multi-select\n  if (currentType === 'select' && targetType === 'multi-select') {\n    updateColumn(columnId, { type: targetType }, targetModel);\n  }\n  // multi-select -> select\n  else if (currentType === 'multi-select' && targetType === 'select') {\n    updateColumn(columnId, { type: targetType }, targetModel);\n    targetModel.convertCellsByColumn(columnId, 'select');\n  }\n  // number -> rich-text\n  else if (currentType === 'number' && targetType === 'rich-text') {\n    updateColumn(columnId, { type: targetType }, targetModel);\n    targetModel.convertCellsByColumn(columnId, 'rich-text');\n  } else {\n    // incompatible types: clear the value of the column\n    const renderer = columnRenderer.get(targetType);\n    updateColumn(\n      columnId,\n      {\n        ...renderer.propertyCreator(),\n        type: targetType,\n      },\n      targetModel\n    );\n    targetModel.deleteCellsByColumn(columnId);\n  }\n}\n\nexport function onActionClick(\n  actionType: ColumnActionType,\n  columnId: string,\n  targetModel: DatabaseBlockModel,\n  columnIndex: number,\n  setTitleColumnEditId: (columnId: string) => void,\n  insertColumn: (position: ColumnInsertPosition) => void\n) {\n  if (actionType === 'rename') {\n    setTitleColumnEditId(columnId);\n    return;\n  }\n  if (actionType === 'insert-right' || actionType === 'insert-left') {\n    if (actionType === 'insert-right') {\n      insertColumn(ColumnInsertPosition.Right);\n    } else {\n      insertColumn(ColumnInsertPosition.Left);\n    }\n    return;\n  }\n\n  if (actionType === 'delete') {\n    targetModel.page.captureSync();\n    targetModel.deleteColumn(columnId);\n    targetModel.deleteCellsByColumn(columnId);\n    targetModel.applyColumnUpdate();\n    return;\n  }\n\n  if (actionType === 'move-left' || actionType === 'move-right') {\n    const targetIndex =\n      actionType === 'move-left' ? columnIndex - 1 : columnIndex + 1;\n    targetModel.page.captureSync();\n    targetModel.moveColumn(columnIndex, targetIndex);\n    targetModel.applyColumnUpdate();\n    return;\n  }\n\n  if (actionType === 'duplicate') {\n    // TODO: rich text copy throws, check reason\n    targetModel.page.captureSync();\n    const currentSchema = targetModel.getColumn(columnId);\n    assertExists(currentSchema);\n    const { id: copyId, ...nonIdProps } = currentSchema;\n    const schema = { ...nonIdProps };\n    const id = targetModel.addColumn(schema, columnIndex + 1);\n    targetModel.applyColumnUpdate();\n    targetModel.copyCellsByColumn(copyId, id);\n    return;\n  }\n}\n\nexport function updateColumn(\n  columnId: string,\n  schemaProperties: Partial<Column>,\n  targetModel: DatabaseBlockModel\n) {\n  const currentSchema = targetModel.getColumn(columnId);\n  assertExists(currentSchema);\n  const schema = { ...currentSchema, ...schemaProperties };\n  targetModel.updateColumn(schema);\n}\n\nexport function isTitleColumn(column: Column | string): column is string {\n  return typeof column === 'string';\n}\n", "import {\n  ArrowDownIcon,\n  DatabaseDuplicate,\n  DatabaseInsertLeft,\n  DatabaseInsertRight,\n  DatabaseMoveLeft,\n  DatabaseMoveRight,\n  DeleteIcon,\n  PenIcon,\n  TextIcon,\n} from '@blocksuite/global/config';\nimport { createPopper } from '@popperjs/core';\nimport { html, LitElement } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\n\nimport type { DatabaseBlockModel } from '../../../database-model.js';\nimport { isDivider } from '../../../utils.js';\nimport type { ColumnRendererHelper } from '../../register.js';\nimport type {\n  Column,\n  ColumnAction,\n  ColumnActionType,\n  ColumnType,\n  TitleColumnAction,\n} from '../../types.js';\nimport type { ColumnInsertPosition } from '../../types.js';\nimport { ColumnTypePopup } from './column-type-popup.js';\nimport { styles } from './styles.js';\nimport { changeColumnType, isTitleColumn, onActionClick } from './utils.js';\n\nconst columnActions: ColumnAction[] = [\n  {\n    type: 'rename',\n    text: 'Rename',\n    icon: PenIcon,\n  },\n  {\n    type: 'divider',\n  },\n  {\n    type: 'column-type',\n    text: 'Column type',\n    icon: TextIcon,\n  },\n  {\n    type: 'duplicate',\n    text: 'Duplicate column',\n    icon: DatabaseDuplicate,\n  },\n  {\n    type: 'insert-left',\n    text: 'Insert left column',\n    icon: DatabaseInsertLeft,\n  },\n  {\n    type: 'insert-right',\n    text: 'Insert right column',\n    icon: DatabaseInsertRight,\n  },\n  {\n    type: 'move-left',\n    text: 'Move left',\n    icon: DatabaseMoveLeft,\n  },\n  {\n    type: 'move-right',\n    text: 'Move Right',\n    icon: DatabaseMoveRight,\n  },\n  {\n    type: 'divider',\n  },\n  {\n    type: 'delete',\n    text: 'Delete column',\n    icon: DeleteIcon,\n  },\n];\n\nconst titleColumnActions: TitleColumnAction[] = [\n  {\n    type: 'rename',\n    text: 'Rename',\n    icon: PenIcon,\n  },\n  {\n    type: 'insert-right',\n    text: 'Insert right column',\n    icon: DatabaseInsertRight,\n  },\n];\n\n@customElement('affine-database-edit-column-popup')\nexport class EditColumnPopup extends LitElement {\n  static override styles = styles;\n\n  @property()\n  targetModel!: DatabaseBlockModel;\n\n  @property()\n  columnRenderer!: ColumnRendererHelper;\n\n  @property()\n  targetColumn!: Column | string;\n\n  /** base on database column index */\n  @property()\n  columnIndex!: number;\n\n  @property()\n  closePopup!: () => void;\n\n  @property()\n  setTitleColumnEditId!: (columnId: string) => void;\n\n  @property()\n  insertColumn!: (position: ColumnInsertPosition) => void;\n\n  @query('input')\n  titleInput!: HTMLInputElement;\n\n  @query('.affine-database-edit-column-popup')\n  private _container!: HTMLDivElement;\n  private _columnTypePopup!: ColumnTypePopup | null;\n\n  private _onShowColumnType = (columnId: string) => {\n    if (this._columnTypePopup) return;\n    this._columnTypePopup = new ColumnTypePopup();\n    this._columnTypePopup.changeColumnType = this._changeColumnType;\n    this._columnTypePopup.columnId = columnId;\n\n    if (!isTitleColumn(this.targetColumn)) {\n      this._columnTypePopup.columnType = this.targetColumn.type;\n    }\n    this._container.appendChild(this._columnTypePopup);\n    createPopper(this._container, this._columnTypePopup, {\n      placement: 'right-start',\n      modifiers: [\n        {\n          name: 'offset',\n          options: {\n            offset: [-9, 12],\n          },\n        },\n      ],\n    });\n  };\n\n  private _onHideColumnType = () => {\n    if (this._columnTypePopup) {\n      this._columnTypePopup?.remove();\n      this._columnTypePopup = null;\n    }\n  };\n\n  private _changeColumnType = (columnId: string, targetType: ColumnType) => {\n    changeColumnType(\n      columnId,\n      targetType,\n      this.targetColumn,\n      this.targetModel,\n      this.columnRenderer\n    );\n    this.closePopup();\n  };\n\n  private _onActionClick = (actionType: ColumnActionType, columnId: string) => {\n    onActionClick(\n      actionType,\n      columnId,\n      this.targetModel,\n      this.columnIndex,\n      this.setTitleColumnEditId,\n      this.insertColumn\n    );\n    this.closePopup();\n  };\n\n  private _renderActions = () => {\n    const actions = isTitleColumn(this.targetColumn)\n      ? titleColumnActions\n      : columnActions;\n\n    return html`\n      ${actions.map(action => {\n        if (isDivider(action)) {\n          return html`<div class=\"action-divider\"></div>`;\n        }\n\n        // boundary\n        if (\n          (this.columnIndex === 0 && action.type === 'move-left') ||\n          (this.columnIndex === this.targetModel.columns.length - 1 &&\n            action.type === 'move-right')\n        ) {\n          return null;\n        }\n\n        const columnId = isTitleColumn(this.targetColumn)\n          ? '-1'\n          : this.targetColumn.id;\n\n        const onMouseOver = isTitleColumn(this.targetColumn)\n          ? undefined\n          : action.type === 'column-type'\n          ? () => this._onShowColumnType(columnId)\n          : this._onHideColumnType;\n\n        return html`\n          <div\n            class=\"action ${action.type}\"\n            @mouseover=${onMouseOver}\n            @click=${() => this._onActionClick(action.type, columnId)}\n          >\n            <div class=\"action-content\">\n              ${action.icon}<span>${action.text}</span>\n            </div>\n            ${action.type === 'column-type' ? ArrowDownIcon : html``}\n          </div>\n        `;\n      })}\n    `;\n  };\n\n  protected override render() {\n    return html`\n      <div class=\"affine-database-edit-column-popup\">\n        ${this._renderActions()}\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-database-edit-column-popup': EditColumnPopup;\n  }\n}\n", "import { css, html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\n@customElement('affine-database-column-drag-indicator')\nexport class ColumnDragIndicator extends LitElement {\n  static override styles = css`\n    .affine-database-column-drag-indicator {\n      position: fixed;\n      z-index: 10;\n      top: 0;\n      left: 0;\n      background: var(--affine-primary-color);\n      transition-property: width, transform;\n      transition-duration: 100ms;\n      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n      transition-delay: 0s;\n      pointer-events: none;\n    }\n  `;\n\n  @property()\n  targetRect: DOMRect | null = null;\n\n  @property()\n  scale = 1;\n\n  override render() {\n    if (!this.targetRect) {\n      return null;\n    }\n\n    const rect = this.targetRect;\n    const style = styleMap({\n      width: `${3 * this.scale}px`,\n      height: `${rect.height}px`,\n      transform: `translate(${rect.left}px, ${rect.top}px)`,\n    });\n\n    return html`\n      <div class=\"affine-database-column-drag-indicator\" style=${style}></div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-database-column-drag-indicator': ColumnDragIndicator;\n  }\n}\n", "import { ShadowlessElement } from '@blocksuite/lit';\nimport { html } from 'lit';\nimport { customElement } from 'lit/decorators.js';\n\n@customElement('affine-database-column-drag-preview')\nexport class ColumnDragPreview extends ShadowlessElement {\n  override render() {\n    return html`\n      <style>\n        affine-database-column-drag-preview {\n          display: flex;\n          flex-direction: column;\n          position: fixed;\n          top: 0;\n          left: 0;\n          height: 220px;\n          width: fit-content;\n          border: 1px solid var(--affine-border-color);\n          border-radius: 4px;\n          overflow: hidden;\n          cursor: none;\n          user-select: none;\n          pointer-events: none;\n          caret-color: transparent;\n          z-index: 100;\n        }\n\n        .preview-column-header {\n          opacity: 0.8;\n          border-bottom: 1px solid var(--affine-border-color);\n          background: var(--affine-tertiary-color);\n        }\n        .preview-column-header .affine-database-column-move svg {\n          cursor: grabbing;\n          opacity: 1;\n        }\n        .preview-column-header .affine-database-column-move circle {\n          fill: var(--affine-text-emphasis-color);\n        }\n\n        .preview-column-content {\n          flex: 1;\n          opacity: 0.8;\n          background: var(--affine-white);\n        }\n      </style>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-database-column-drag-preview': ColumnDragPreview;\n  }\n}\n", "import { DisposableGroup } from '@blocksuite/global/utils';\nimport { assertExists } from '@blocksuite/global/utils';\n\nimport { Point } from '../../../../../__internal__/index.js';\nimport type { DatabaseBlockModel } from '../../../../database-model.js';\nimport { ColumnDragIndicator } from './column-drag-indicator.js';\nimport { ColumnDragPreview } from './column-drag-preview.js';\n\nexport type ColumnDragConfig = {\n  dragIndex: number;\n  targetIndex: number;\n  indicatorHeight: number;\n  headerColumns: HTMLElement[];\n  tableBody: HTMLElement;\n  previewBoundaries: {\n    left: number;\n    right: number;\n  };\n  offset: { x: number; y: number };\n};\n\nexport function initMoveColumnHandlers(\n  headerContainer: HTMLElement,\n  tableContainer: HTMLElement,\n  targetModel: DatabaseBlockModel\n) {\n  let dragPreview: ColumnDragPreview | null = null;\n  let dragColumnConfig: ColumnDragConfig | null = null;\n  let indicator = document.querySelector<ColumnDragIndicator>(\n    'affine-database-column-drag-indicator'\n  );\n  if (!indicator) {\n    indicator = new ColumnDragIndicator();\n    document.body.appendChild(indicator);\n  }\n  let rafId = -1;\n\n  const onColumnDragStart = (event: DragEvent) => {\n    event.stopPropagation();\n    assertExists(event.dataTransfer);\n    event.dataTransfer.effectAllowed = 'move';\n\n    const headerColumns = Array.from<HTMLElement>(\n      headerContainer.querySelectorAll('.affine-database-column')\n    ).filter(column => !column.classList.contains('add-column-button'));\n\n    const dragIcon = event.target as HTMLElement;\n    const dragHeaderColumn = dragIcon.closest<HTMLElement>(\n      '.affine-database-column'\n    );\n    assertExists(dragHeaderColumn);\n    const dragIndex = headerColumns.indexOf(dragHeaderColumn) - 1;\n\n    const database = tableContainer.closest('affine-database');\n    assertExists(database);\n    const { x, y } = dragHeaderColumn.getBoundingClientRect();\n    const tableBody = tableContainer.closest<HTMLElement>(\n      '.affine-database-block-table'\n    );\n    assertExists(tableBody);\n    const { left, right } = tableBody.getBoundingClientRect();\n\n    dragColumnConfig = {\n      dragIndex,\n      tableBody,\n      headerColumns,\n      targetIndex: -1,\n      indicatorHeight: tableContainer.clientHeight,\n      previewBoundaries: {\n        left,\n        right,\n      },\n      offset: {\n        x: event.clientX - x,\n        y: event.clientY - y,\n      },\n    };\n\n    dragPreview = createDragPreview(event);\n    tableContainer.appendChild(dragPreview);\n  };\n\n  const onColumnDrag = (event: DragEvent) => {\n    if (!dragColumnConfig) return;\n\n    assertExists(dragPreview);\n    if (dragPreview.style.opacity !== '1') {\n      dragPreview.style.opacity = '1';\n    }\n    const x = event.clientX;\n    const y = event.clientY;\n    const {\n      dragIndex,\n      tableBody,\n      previewBoundaries,\n      indicatorHeight,\n      headerColumns,\n      offset: { x: offsetX, y: offsetY },\n    } = dragColumnConfig;\n\n    dragPreview.style.transform = `translate(${x - offsetX}px, ${\n      y - offsetY\n    }px)`;\n\n    const point = new Point(x, y);\n    const { element, index: targetIndex } = getClosestElement(\n      point,\n      headerColumns\n    );\n    const elementRect = element.getBoundingClientRect();\n\n    const outOfBoundaries =\n      elementRect.right < previewBoundaries.left ||\n      elementRect.right > previewBoundaries.right;\n\n    // both side of drag element should hide the indicator\n    const rect =\n      dragIndex === targetIndex ||\n      dragIndex === targetIndex - 1 ||\n      outOfBoundaries\n        ? null\n        : new DOMRect(elementRect.right, elementRect.top, 1, indicatorHeight);\n\n    assertExists(indicator);\n    indicator.targetRect = rect;\n    dragColumnConfig.targetIndex = targetIndex - 1;\n\n    // auto scroll\n    const autoLeft = x <= previewBoundaries.left + 50;\n    const autoRight = x >= previewBoundaries.right - 50;\n    const auto = autoLeft || autoRight;\n\n    const autoScroll = () => {\n      if (!auto) {\n        cancelAnimationFrame(rafId);\n        return;\n      } else {\n        rafId = requestAnimationFrame(autoScroll);\n      }\n\n      if (autoRight) {\n        tableBody.scrollLeft += 10;\n      }\n      if (autoLeft) {\n        tableBody.scrollLeft -= 10;\n      }\n    };\n    cancelAnimationFrame(rafId);\n    rafId = requestAnimationFrame(autoScroll);\n  };\n\n  const onColumnDragEnd = (event: DragEvent) => {\n    if (!dragColumnConfig) return;\n\n    const { dragIndex: fromIndex, targetIndex } = dragColumnConfig;\n\n    // clear data\n    dragColumnConfig = null;\n    if (indicator) indicator.targetRect = null;\n    if (dragPreview) {\n      dragPreview.remove();\n      dragPreview = null;\n    }\n\n    const toIndex = targetIndex + 1;\n    if (\n      // self\n      fromIndex === toIndex - 1 ||\n      // same position\n      fromIndex === toIndex\n    ) {\n      return;\n    }\n\n    targetModel.page.captureSync();\n    targetModel.moveColumn(fromIndex, toIndex);\n    targetModel.applyColumnUpdate();\n  };\n\n  const disposables = new DisposableGroup();\n  const stopPropagation = (e: Event) => e.stopPropagation();\n  const columnMoveElements = headerContainer.querySelectorAll<HTMLDivElement>(\n    '.affine-database-column-move'\n  );\n  columnMoveElements.forEach(moveElement => {\n    // prevent block selection and drag-handle\n    disposables.addFromEvent(moveElement, 'pointerdown', stopPropagation);\n    disposables.addFromEvent(moveElement, 'pointermove', stopPropagation);\n    disposables.addFromEvent(moveElement, 'pointerup', stopPropagation);\n    disposables.addFromEvent(moveElement, 'click', stopPropagation);\n\n    // init drag event\n    disposables.addFromEvent(moveElement, 'dragstart', onColumnDragStart);\n    disposables.addFromEvent(moveElement, 'drag', onColumnDrag);\n    disposables.addFromEvent(moveElement, 'dragend', onColumnDragEnd);\n  });\n  return disposables;\n}\n\nfunction createDragPreview(event: DragEvent) {\n  const dragPreview = new ColumnDragPreview();\n  dragPreview.style.opacity = '0';\n\n  const previewFragment = document.createDocumentFragment();\n  // header\n  const dragIcon = event.target as HTMLElement;\n  const headerColumn = dragIcon.closest<HTMLElement>('.affine-database-column');\n  assertExists(headerColumn);\n  const headerColumnClone = headerColumn.cloneNode(true) as HTMLElement;\n  headerColumnClone.classList.add('preview-column-header');\n  previewFragment.appendChild(headerColumnClone);\n\n  // content\n  const previewContent = document.createElement('div');\n  previewContent.classList.add('preview-column-content');\n  previewFragment.appendChild(previewContent);\n\n  dragPreview.appendChild(previewFragment);\n\n  event.dataTransfer?.setDragImage(dragPreview, 0, 0);\n\n  return dragPreview;\n}\n\nfunction getClosestElement(\n  point: Point,\n  headerColumns: HTMLElement[]\n): {\n  element: HTMLElement;\n  index: number;\n} {\n  let element: HTMLElement | null = null;\n  let index = -1;\n  const length = headerColumns.length;\n\n  for (let i = 0; i < length; i++) {\n    const column = headerColumns[i];\n    const rect = column.getBoundingClientRect();\n    if (point.x >= rect.left && point.x <= rect.right) {\n      element = column;\n      index = i;\n      break;\n    }\n  }\n\n  // boundary check\n  if (!element) {\n    const firstColumnRect = headerColumns[0].getBoundingClientRect();\n    if (point.x <= firstColumnRect.left) {\n      // left boundary\n      element = headerColumns[0];\n      index = 0;\n    } else {\n      // right boundary\n      element = headerColumns[length - 1];\n      index = length - 1;\n    }\n  }\n  return {\n    element,\n    index,\n  };\n}\n", "import { assertExists, DisposableGroup } from '@blocksuite/global/utils';\n\nimport type { DatabaseBlockModel } from '../../../../database-model.js';\nimport {\n  DEFAULT_ADD_BUTTON_WIDTH,\n  DEFAULT_COLUMN_MIN_WIDTH,\n} from '../../../consts.js';\n\ntype ColumnWidthConfig = {\n  index: number;\n  rafId?: number;\n  rawWidth: number;\n  scrollLeft: number;\n  lastClientX: number;\n  startClientX: number;\n  currentCell: HTMLElement;\n  rowCells: HTMLElement[];\n};\n\nexport function initChangeColumnWidthHandlers(\n  headerContainer: HTMLElement,\n  tableContainer: HTMLElement,\n  targetModel: DatabaseBlockModel,\n  changeActiveColumnIndex: (index: number) => void\n) {\n  let changeColumnWidthConfig: ColumnWidthConfig | null = null;\n\n  const onColumnWidthPointerdown = (event: PointerEvent, index: number) => {\n    event.stopPropagation();\n\n    // all rows cell in current column\n    const currentColumnCells = Array.from(\n      tableContainer.querySelectorAll<HTMLElement>(\n        `.database-cell:nth-child(${index + 1})`\n      )\n    );\n\n    const dragHandleCell = headerContainer.querySelector<HTMLElement>(\n      `.database-cell:nth-child(${index + 1})`\n    );\n    assertExists(dragHandleCell);\n\n    const parentElement = tableContainer.parentElement;\n    assertExists(parentElement);\n    changeColumnWidthConfig = {\n      index,\n      rowCells: currentColumnCells,\n      scrollLeft: parentElement.scrollLeft,\n      lastClientX: event.clientX,\n      startClientX: event.clientX,\n      rawWidth: currentColumnCells[0].clientWidth,\n      currentCell: dragHandleCell,\n      rafId: undefined,\n    };\n    changeActiveColumnIndex(index);\n  };\n\n  const onColumnWidthPointermove = (event: PointerEvent) => {\n    event.stopPropagation();\n    if (!changeColumnWidthConfig) return;\n\n    const {\n      rafId,\n      rowCells,\n      rawWidth,\n      lastClientX,\n      startClientX,\n      scrollLeft: startScrollLeft,\n    } = changeColumnWidthConfig;\n\n    if (event.clientX - lastClientX === 0) return;\n\n    const direction = event.clientX - lastClientX > 0 ? 'right' : 'left';\n    changeColumnWidthConfig.lastClientX = event.clientX;\n\n    const onUpdateDOM = () => {\n      const columnWidth =\n        rawWidth + event.clientX - startClientX <= DEFAULT_COLUMN_MIN_WIDTH\n          ? DEFAULT_COLUMN_MIN_WIDTH\n          : rawWidth + event.clientX - startClientX;\n\n      // update column width\n      rowCells.forEach(cell => {\n        cell.style.width = `${columnWidth}px`;\n        const titleText = cell.querySelector<HTMLDivElement>(\n          '.affine-database-column-text-input'\n        );\n        if (titleText) {\n          // 54px is the width of other elements of the column\n          titleText.style.width = `${columnWidth - 54}px`;\n        }\n      });\n\n      // scroll when crossing the right border\n      const parentElement = tableContainer.parentElement;\n      assertExists(parentElement);\n      const { right: boundaryRight, left: boundaryLeft } =\n        parentElement.getBoundingClientRect();\n      // the distance from the drag handle to the right border\n      const dragHandleRight =\n        event.clientX - boundaryRight + DEFAULT_ADD_BUTTON_WIDTH;\n      // x\n      if (dragHandleRight >= 0) {\n        //  | \n        // the `|` is boundary\n        if (direction === 'right') {\n          // 1. Drag right 100 (scroll distance 100)\n          // 2. Drag left 30 (scroll distance unchanged)\n          // 3. At this point, dragging further to the right should keep the 100\n          parentElement.scrollLeft = Math.max(\n            parentElement.scrollLeft,\n            startScrollLeft + dragHandleRight\n          );\n        } else {\n          //  | \n          let scrollLeft = parentElement.scrollLeft;\n          if (dragHandleRight <= DEFAULT_ADD_BUTTON_WIDTH) {\n            scrollLeft += dragHandleRight;\n          }\n          parentElement.scrollLeft = Math.min(\n            scrollLeft,\n            startScrollLeft + dragHandleRight\n          );\n        }\n        return;\n      }\n\n      // scroll when crossing the left border\n      const dragHandleLeft =\n        event.clientX - boundaryLeft - DEFAULT_ADD_BUTTON_WIDTH;\n      //  | \n      if (dragHandleLeft <= 0 && parentElement.scrollLeft > 0) {\n        parentElement.scrollLeft = startScrollLeft + dragHandleLeft;\n      }\n    };\n    if (rafId) cancelAnimationFrame(rafId);\n    changeColumnWidthConfig.rafId = requestAnimationFrame(onUpdateDOM);\n  };\n\n  const onColumnWidthPointerup = (event: PointerEvent) => {\n    event.stopPropagation();\n\n    changeActiveColumnIndex(-1);\n    if (!changeColumnWidthConfig) return;\n    const { rafId, index, rowCells } = changeColumnWidthConfig;\n    if (rafId) cancelAnimationFrame(rafId);\n    changeColumnWidthConfig = null;\n\n    const columnWidth = rowCells[0].offsetWidth;\n    targetModel.page.captureSync();\n    if (index === 0) {\n      targetModel.page.updateBlock(targetModel, {\n        titleColumnWidth: columnWidth,\n      });\n    } else {\n      const columnId = targetModel.columns[index - 1].id;\n      const columnProps = targetModel.getColumn(columnId);\n      targetModel.updateColumn({\n        ...columnProps,\n        width: columnWidth,\n      });\n      targetModel.applyColumnUpdate();\n    }\n  };\n\n  const disposables = new DisposableGroup();\n  const dragHandles = headerContainer.querySelectorAll<HTMLDivElement>(\n    '.affine-database-column-drag-handle'\n  );\n  dragHandles.forEach((dragHandle, index) => {\n    disposables.addFromEvent(dragHandle, 'pointerdown', (event: PointerEvent) =>\n      onColumnWidthPointerdown(event, index)\n    );\n  });\n\n  disposables.addFromEvent(document, 'pointermove', onColumnWidthPointermove);\n  disposables.addFromEvent(document, 'pointerup', onColumnWidthPointerup);\n  return disposables;\n}\n", "import { css } from 'lit';\n\nimport {\n  DEFAULT_ADD_BUTTON_WIDTH,\n  DEFAULT_COLUMN_MIN_WIDTH,\n} from '../../consts.js';\n\nexport const styles = css`\n  .affine-database-column-header {\n    position: relative;\n    display: flex;\n    flex-direction: row;\n    height: 40px;\n    border-bottom: 1px solid var(--affine-border-color);\n  }\n  .affine-database-column-header > .affine-database-column:first-child {\n    background: var(--affine-hover-color);\n  }\n\n  .affine-database-column {\n    position: relative;\n    z-index: 1;\n    cursor: pointer;\n    background: var(--affine-white);\n    transform: translateX(0);\n  }\n  .database-cell {\n    min-width: ${DEFAULT_COLUMN_MIN_WIDTH}px;\n  }\n  .database-cell.add-column-button {\n    flex: 1;\n    min-width: ${DEFAULT_ADD_BUTTON_WIDTH}px;\n    min-height: 100%;\n    display: flex;\n    align-items: center;\n  }\n  .affine-database-column-content {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    width: 100%;\n    height: 100%;\n    padding: 8px;\n    border-right: 1px solid var(--affine-border-color);\n  }\n  .affine-database-column:last-child .affine-database-column-content {\n    border-right: none;\n  }\n  .affine-database-column-drag-handle {\n    position: absolute;\n    z-index: 1;\n    top: 0;\n    left: -8px;\n    width: 16px;\n    height: 100%;\n    cursor: col-resize;\n  }\n  .affine-database-column-drag-handle::before {\n    content: ' ';\n    display: none;\n    position: absolute;\n    width: 2px;\n    height: 100%;\n    left: 7px;\n    background: var(--affine-text-emphasis-color);\n    box-shadow: 0px 0px 8px rgba(84, 56, 255, 0.35);\n  }\n  .affine-database-column-drag-handle:hover::before,\n  .affine-database-column-drag-handle.dragging::before {\n    display: block;\n  }\n  .affine-database-column-content:hover,\n  .affine-database-column-content.edit {\n    background: linear-gradient(\n        0deg,\n        var(--affine-hover-color),\n        var(--affine-hover-color)\n      ),\n      var(--affine-white);\n  }\n  .affine-database-column-content.edit .affine-database-column-text-icon {\n    opacity: 1;\n  }\n  .affine-database-column-text {\n    flex: 1;\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    /* https://stackoverflow.com/a/36247448/15443637 */\n    overflow: hidden;\n    color: var(--affine-text-secondary-color);\n    font-size: 14px;\n    font-weight: 600;\n  }\n  .affine-database-column-type-icon {\n    display: flex;\n    align-items: center;\n    border: 1px solid transparent;\n    border-radius: 4px;\n  }\n  .affine-database-column-type-icon.edit {\n    background: linear-gradient(\n        0deg,\n        var(--affine-hover-color),\n        var(--affine-hover-color)\n      ),\n      var(--affine-white);\n    border-color: var(--affine-border-color);\n  }\n  .affine-database-column-type-icon.edit:hover {\n    background: var(--affine-white);\n  }\n  .affine-database-column-type-icon svg {\n    width: 16px;\n    height: 16px;\n    fill: var(--affine-icon-color);\n  }\n  .affine-database-column-text-content {\n    flex: 1;\n    display: flex;\n    align-items: center;\n    overflow: hidden;\n  }\n  .affine-database-column-content:hover .affine-database-column-text-icon {\n    opacity: 1;\n  }\n  .affine-database-column-text-input {\n    flex: 1;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n  .affine-database-column-text-icon {\n    display: flex;\n    align-items: center;\n    width: 16px;\n    height: 16px;\n    background: var(--affine-white);\n    border: 1px solid var(--affine-border-color);\n    border-radius: 4px;\n    opacity: 0;\n  }\n  .affine-database-column-text-save-icon {\n    display: flex;\n    align-items: center;\n    width: 16px;\n    height: 16px;\n    border: 1px solid transparent;\n    border-radius: 4px;\n    fill: var(--affine-icon-color);\n  }\n  .affine-database-column-text-save-icon:hover {\n    background: var(--affine-white);\n    border-color: var(--affine-border-color);\n  }\n  .affine-database-column-text-icon svg {\n    fill: var(--affine-icon-color);\n  }\n  .affine-database-column-input {\n    width: 100%;\n    height: 24px;\n    padding: 0;\n    border: none;\n    color: inherit;\n    font-weight: 600;\n    font-size: 14px;\n    font-family: var(--affine-font-family);\n    background: transparent;\n  }\n  .affine-database-column-input:focus {\n    outline: none;\n  }\n  .affine-database-column-move {\n    display: flex;\n    align-items: center;\n  }\n  .affine-database-column-move svg {\n    width: 10px;\n    height: 14px;\n    color: var(--affine-black-10);\n    cursor: grab;\n    opacity: 0;\n  }\n  .affine-database-column-content:hover svg {\n    opacity: 1;\n  }\n\n  .affine-database-add-column-button {\n    visibility: hidden;\n    position: fixed;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 40px;\n    height: 38px;\n    cursor: pointer;\n  }\n  .header-add-column-button {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 40px;\n    height: 100%;\n    cursor: pointer;\n  }\n\n  .affine-database-column-move-preview {\n    position: fixed;\n    z-index: 100;\n    width: 100px;\n    height: 100px;\n    background: var(--affine-text-emphasis-color);\n  }\n`;\n", "import {\n  DatabaseAddColumn,\n  DatabaseDone,\n  DatabaseDragIcon,\n  DatabaseMultiSelect,\n  DatabaseNumber,\n  DatabaseProgress,\n  DatabaseSelect,\n  PenIcon,\n  TextIcon,\n  TodoIcon,\n} from '@blocksuite/global/config';\nimport { assertExists, DisposableGroup } from '@blocksuite/global/utils';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/lit';\nimport { createPopper } from '@popperjs/core';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { styleMap } from 'lit/directives/style-map.js';\nimport { html } from 'lit/static-html.js';\n\nimport { getDefaultPage } from '../../../../__internal__/index.js';\nimport type { DatabaseBlockModel } from '../../../database-model.js';\nimport { onClickOutside } from '../../../utils.js';\nimport { DEFAULT_COLUMN_TITLE_HEIGHT } from '../../consts.js';\nimport type { ColumnRendererHelper } from '../../register.js';\nimport type { Column, ColumnTypeIcon } from '../../types.js';\nimport { ColumnInsertPosition } from '../../types.js';\nimport { ColumnTypePopup } from '../edit-column-popup/column-type-popup.js';\nimport { EditColumnPopup } from '../edit-column-popup/edit-column-popup.js';\nimport { changeColumnType } from '../edit-column-popup/utils.js';\nimport type { ColumnDragIndicator } from './column-move/column-drag-indicator.js';\nimport { initMoveColumnHandlers } from './column-move/index.js';\nimport { initChangeColumnWidthHandlers } from './column-width/index.js';\nimport { styles } from './styles.js';\n\nconst columnTypeIconMap: ColumnTypeIcon = {\n  select: DatabaseSelect,\n  number: DatabaseNumber,\n  checkbox: TodoIcon,\n  progress: DatabaseProgress,\n  'rich-text': TextIcon,\n  'multi-select': DatabaseMultiSelect,\n};\n\n@customElement('affine-database-column-header')\nexport class DatabaseColumnHeader extends WithDisposable(ShadowlessElement) {\n  static override styles = styles;\n\n  @property()\n  targetModel!: DatabaseBlockModel;\n\n  @property()\n  columns!: Column[];\n\n  @property()\n  addColumn!: (index: number) => string;\n\n  @property()\n  columnRenderer!: ColumnRendererHelper;\n\n  get tableContainer(): HTMLElement {\n    return this.parentElement as HTMLElement;\n  }\n\n  @state()\n  private _editingColumnId = '';\n\n  @state()\n  private _changingColumnTypeId = '';\n\n  @query('.affine-database-column-input')\n  private _titleColumnInput!: HTMLInputElement;\n\n  @query('.affine-database-column-header')\n  private _headerContainer!: HTMLElement;\n\n  @query('.affine-database-add-column-button')\n  private _addColumnButton!: HTMLElement;\n\n  @query('.header-add-column-button')\n  private _headerAddColumnButton!: HTMLElement;\n\n  @state()\n  private _widthChangingIndex = -1;\n\n  private _columnWidthDisposables: DisposableGroup = new DisposableGroup();\n  private _columnMoveDisposables: DisposableGroup = new DisposableGroup();\n  private _isHeaderHover = false;\n  private _indicator: ColumnDragIndicator | null = null;\n  private _editingColumnPopupIndex = -1;\n\n  private get readonly() {\n    return this.targetModel.page.readonly;\n  }\n\n  setEditingColumnId = (id: string) => {\n    this._editingColumnId = id;\n  };\n\n  override firstUpdated() {\n    if (this.readonly) return;\n\n    this._initChangeColumnWidthHandlers();\n    this._initSetDragHandleHeightEffect();\n    this._initHeaderMousemoveHandlers();\n    this._initMoveColumnHandlers();\n\n    const databaseElement = this.closest('affine-database');\n    if (databaseElement) {\n      this._initResizeEffect(databaseElement);\n    }\n  }\n\n  override updated(changedProperties: Map<string, unknown>) {\n    super.updated(changedProperties);\n    if (this.readonly) return;\n\n    if (changedProperties.has('_editingColumnId') && !!this._editingColumnId) {\n      this._titleColumnInput.focus();\n      const length = this._titleColumnInput.value.length;\n      this._titleColumnInput.setSelectionRange(0, length);\n    }\n\n    if (changedProperties.has('columns')) {\n      // bind event when new column is added\n      this._initMoveColumnHandlers();\n      this._initChangeColumnWidthHandlers();\n    }\n\n    // When dragging a block or adding a new row to the database, the changedProperties.size is 0\n    if (changedProperties.size === 0 || changedProperties.has('columns')) {\n      this._setDragHandleHeight();\n    }\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this._columnWidthDisposables.dispose();\n\n    if (this._indicator) {\n      this._indicator.targetRect = null;\n    }\n  }\n\n  private _initResizeEffect(element: HTMLElement) {\n    const pageBlock = getDefaultPage(this.targetModel.page);\n    const viewportElement = pageBlock?.viewportElement;\n    if (viewportElement) {\n      const resizeObserver = new ResizeObserver(\n        (entries: ResizeObserverEntry[]) => {\n          for (const { target } of entries) {\n            if (target === viewportElement) {\n              const { right: containerRight } = element.getBoundingClientRect();\n              // calc the position of add column button\n              this._addColumnButton.style.left = `${containerRight}px`;\n              break;\n            }\n          }\n        }\n      );\n      resizeObserver.observe(viewportElement);\n    }\n  }\n\n  private _initSetDragHandleHeightEffect() {\n    const mutationObserver = new MutationObserver(() => {\n      this._setDragHandleHeight();\n    });\n    const tableContainer = this.closest('.affine-database-table-container');\n    assertExists(tableContainer);\n    mutationObserver.observe(tableContainer, {\n      childList: true,\n      subtree: true,\n    });\n    this._disposables.add(() => mutationObserver.disconnect());\n  }\n\n  private _setDragHandleHeight() {\n    const databaseElement = this.closest('affine-database');\n    // When dragging to generate a database preview,\n    // the database may not be rendered to the page in time\n    if (!databaseElement) return;\n    const databaseBody = databaseElement.querySelector(\n      '.affine-database-block-rows'\n    );\n    assertExists(databaseBody);\n    const dragHandleHeight =\n      databaseBody.clientHeight + DEFAULT_COLUMN_TITLE_HEIGHT - 1;\n    const allDragHandle = databaseElement.querySelectorAll<HTMLElement>(\n      '.affine-database-column-drag-handle'\n    );\n    allDragHandle.forEach(handle => {\n      handle.style.height = `${dragHandleHeight}px`;\n    });\n  }\n\n  private _initHeaderMousemoveHandlers() {\n    this._disposables.addFromEvent(\n      this._headerContainer,\n      'mouseover',\n      event => {\n        this._isHeaderHover = true;\n        this.showAddColumnButton(event);\n      }\n    );\n    this._disposables.addFromEvent(\n      this._headerContainer,\n      'mouseleave',\n      event => {\n        this._isHeaderHover = false;\n        this.showAddColumnButton(event);\n      }\n    );\n  }\n\n  showAddColumnButton = (event?: MouseEvent) => {\n    const databaseElement = this.closest('affine-database');\n    assertExists(databaseElement);\n    const { right: boundaryRight } = databaseElement.getBoundingClientRect();\n    const { left: headerAddColumnButtonLeft } =\n      this._headerAddColumnButton.getBoundingClientRect();\n\n    let isInHeader = true;\n    if (event) {\n      // mouse over the header\n      isInHeader =\n        event.offsetY <= DEFAULT_COLUMN_TITLE_HEIGHT && event.offsetY >= 0;\n    }\n\n    const needShow = boundaryRight <= headerAddColumnButtonLeft;\n    if (needShow && this._isHeaderHover && isInHeader) {\n      this._addColumnButton.style.visibility = 'visible';\n    } else {\n      this._addColumnButton.style.visibility = 'hidden';\n    }\n  };\n\n  private _setChangingColumnIndex = (index: number) => {\n    if (this._widthChangingIndex !== index) {\n      this._widthChangingIndex = index;\n    }\n  };\n\n  private _initChangeColumnWidthHandlers() {\n    // Don't `dispose()` if column width is being changed\n    const isChangingWidth = this._widthChangingIndex !== -1;\n    if (isChangingWidth) return;\n\n    this._columnWidthDisposables.dispose();\n    const disposables = initChangeColumnWidthHandlers(\n      this._headerContainer,\n      this.tableContainer,\n      this.targetModel,\n      this._setChangingColumnIndex\n    );\n    this._columnWidthDisposables = disposables;\n  }\n\n  private _initMoveColumnHandlers() {\n    // remove previous handlers\n    this._columnMoveDisposables.dispose();\n\n    const disposables = initMoveColumnHandlers(\n      this._headerContainer,\n      this.tableContainer,\n      this.targetModel\n    );\n    // bind new handlers\n    this._columnMoveDisposables = disposables;\n  }\n\n  private _onShowEditColumnPopup = (\n    target: Element,\n    column: Column | string,\n    index: number\n  ) => {\n    if (this._editingColumnId || this.readonly) return;\n    if (this._editingColumnPopupIndex === index) {\n      this._editingColumnPopupIndex = -1;\n      return;\n    }\n    this._editingColumnPopupIndex = index;\n\n    const currentEl = target as Element;\n    const reference = currentEl.closest('.affine-database-column');\n    assertExists(reference);\n\n    const editColumn = new EditColumnPopup();\n    editColumn.setTitleColumnEditId = this.setEditingColumnId;\n    editColumn.targetModel = this.targetModel;\n    editColumn.targetColumn = column;\n    editColumn.columnIndex = index - 1;\n    editColumn.columnRenderer = this.columnRenderer;\n    editColumn.closePopup = () => {\n      this._editingColumnPopupIndex = -1;\n      editColumn.remove();\n    };\n    editColumn.insertColumn = position => {\n      const insertIdex =\n        position === ColumnInsertPosition.Right ? index : index - 1;\n      this.addColumn(insertIdex);\n    };\n    document.body.appendChild(editColumn);\n    createPopper(reference, editColumn, { placement: 'bottom-start' });\n    onClickOutside(\n      editColumn,\n      (ele, target) => {\n        // click outside of column title, need to reset the index\n        if (!target.closest('.affine-database-column-content')) {\n          this._editingColumnPopupIndex = -1;\n        }\n        ele.remove();\n      },\n      'mousedown'\n    );\n  };\n\n  private _onShowColumnTypePopup = (\n    event: MouseEvent,\n    columnId: string,\n    column: Column\n  ) => {\n    if (this._editingColumnId === '' || this.readonly) return;\n    if (this._changingColumnTypeId === columnId) {\n      this._changingColumnTypeId = '';\n      return;\n    }\n    event.stopPropagation();\n\n    this._changingColumnTypeId = columnId;\n    const popup = new ColumnTypePopup();\n    popup.columnId = columnId;\n    popup.columnType = column.type;\n    popup.changeColumnType = (columnId, type) => {\n      changeColumnType(\n        columnId,\n        type,\n        column,\n        this.targetModel,\n        this.columnRenderer\n      );\n      this._changingColumnTypeId = '';\n      popup.remove();\n    };\n    document.body.appendChild(popup);\n\n    const target = event.target as HTMLElement;\n    const reference = target.closest('.affine-database-column-content');\n    assertExists(reference);\n\n    createPopper(reference, popup, {\n      placement: 'bottom-start',\n    });\n    onClickOutside(\n      popup,\n      (ele, target) => {\n        if (!target.closest('.affine-database-column-type-icon')) {\n          this._changingColumnTypeId = '';\n        }\n        ele.remove();\n      },\n      'mousedown'\n    );\n  };\n\n  private _onKeydown = (\n    event: KeyboardEvent,\n    type: 'title' | 'normal',\n    column?: Column\n  ) => {\n    if (event.key === 'Enter') {\n      this.targetModel.page.captureSync();\n      this._saveColumnTitle(type, column);\n      return;\n    }\n    if (event.key === 'Escape') {\n      this.setEditingColumnId('');\n      return;\n    }\n  };\n\n  private _saveColumnTitle = (type: 'title' | 'normal', column?: Column) => {\n    // Prevent triggering again after press enter key\n    if (this._editingColumnId === '') return;\n\n    const name = this._titleColumnInput.value;\n    if (type === 'title') {\n      // title column\n      this._onUpdateTitleColumn(name);\n    } else {\n      // other columns\n      assertExists(column);\n      this._onUpdateNormalColumn(name, column);\n    }\n    // To handle this situation:\n    // 1. click the pen icon, edit the title\n    // 2. then click the other column's pen icon, edit the title\n    if (this._editingColumnId === column?.id) {\n      this.setEditingColumnId('');\n    }\n  };\n\n  private _onUpdateTitleColumn = (titleColumnName: string) => {\n    this.targetModel.page.captureSync();\n    this.targetModel.page.updateBlock(this.targetModel, {\n      titleColumnName,\n    });\n    this.setEditingColumnId('');\n  };\n\n  private _onUpdateNormalColumn = (name: string, column: Column) => {\n    this.targetModel.page.captureSync();\n    this.targetModel.updateColumn({\n      ...column,\n      name,\n    });\n    this.targetModel.applyColumnUpdate();\n    this.setEditingColumnId('');\n  };\n\n  private _onEditColumnTitle = (event: MouseEvent, columnId: string) => {\n    event.stopPropagation();\n    this.setEditingColumnId(columnId);\n  };\n\n  private _onAddColumn = () => {\n    if (this.readonly) return;\n    this.addColumn(this.targetModel.columns.length);\n  };\n\n  override render() {\n    const style = styleMap({\n      width: `${this.targetModel.titleColumnWidth}px`,\n    });\n\n    const isTitleEditing = this._editingColumnId === '-1' && !this.readonly;\n    return html`\n      <div class=\"affine-database-column-header database-row\">\n        <div class=\"affine-database-column database-cell\" style=${style}>\n          <div\n            class=\"affine-database-column-content ${this._editingColumnId ===\n            '-1'\n              ? 'edit'\n              : ''}\"\n            data-column-id=\"-1\"\n            @click=${(event: MouseEvent) =>\n              this._onShowEditColumnPopup(\n                event.target as Element,\n                this.targetModel.titleColumnName,\n                0\n              )}\n          >\n            <div class=\"affine-database-column-text\">\n              <div class=\"affine-database-column-type-icon\">${TextIcon}</div>\n              ${isTitleEditing\n                ? html`<div class=\"affine-database-column-text-content\">\n                    <input\n                      class=\"affine-database-column-input\"\n                      value=${this.targetModel.titleColumnName}\n                      @keydown=${(event: KeyboardEvent) =>\n                        this._onKeydown(event, 'title')}\n                      @pointerdown=${(event: PointerEvent) =>\n                        event.stopPropagation()}\n                    />\n                    <div\n                      class=\"affine-database-column-text-save-icon\"\n                      @click=${(event: MouseEvent) => {\n                        event.stopPropagation();\n                        this._saveColumnTitle('title');\n                      }}\n                    >\n                      ${DatabaseDone}\n                    </div>\n                  </div>`\n                : html`<div class=\"affine-database-column-text-content\">\n                    <div class=\"affine-database-column-text-input\">\n                      ${this.targetModel.titleColumnName}\n                    </div>\n                    ${this.readonly\n                      ? null\n                      : html`<div\n                          class=\"affine-database-column-text-icon\"\n                          @click=${(e: MouseEvent) =>\n                            this._onEditColumnTitle(e, '-1')}\n                        >\n                          ${PenIcon}\n                        </div>`}\n                  </div>`}\n            </div>\n          </div>\n        </div>\n        ${repeat(\n          this.columns,\n          column => column.id,\n          (column, index) => {\n            const style = styleMap({\n              width: `${column.width}px`,\n            });\n            const isEditing =\n              this._editingColumnId === column.id && !this.readonly;\n            const isChangingColumnType =\n              this._changingColumnTypeId === column.id;\n\n            return html`\n              <div class=\"affine-database-column database-cell\" style=${style}>\n                <div\n                  class=\"affine-database-column-content ${isEditing\n                    ? 'edit'\n                    : ''}\"\n                  data-column-id=\"${column.id}\"\n                  @click=${(event: MouseEvent) =>\n                    this._onShowEditColumnPopup(\n                      event.target as Element,\n                      column,\n                      index + 1\n                    )}\n                >\n                  <div class=\"affine-database-column-text ${column.type}\">\n                    <div\n                      class=\"affine-database-column-type-icon ${isEditing\n                        ? 'edit'\n                        : ''} ${isChangingColumnType ? 'active' : ''}\"\n                      @click=${(e: MouseEvent) =>\n                        this._onShowColumnTypePopup(e, column.id, column)}\n                    >\n                      ${columnTypeIconMap[column.type]}\n                    </div>\n                    ${isEditing\n                      ? html`<div class=\"affine-database-column-text-content\">\n                          <input\n                            class=\"affine-database-column-input\"\n                            value=${column.name}\n                            @keydown=${(event: KeyboardEvent) =>\n                              this._onKeydown(event, 'normal', column)}\n                            @pointerdown=${(event: PointerEvent) =>\n                              event.stopPropagation()}\n                          />\n                          <div\n                            class=\"affine-database-column-text-save-icon\"\n                            @click=${(event: MouseEvent) => {\n                              event.stopPropagation();\n                              this._saveColumnTitle('normal', column);\n                            }}\n                          >\n                            ${DatabaseDone}\n                          </div>\n                        </div>`\n                      : html`<div class=\"affine-database-column-text-content\">\n                          <div class=\"affine-database-column-text-input\">\n                            ${column.name}\n                          </div>\n                          ${this.readonly\n                            ? null\n                            : html`<div\n                                class=\"affine-database-column-text-icon\"\n                                @click=${(e: MouseEvent) =>\n                                  this._onEditColumnTitle(e, column.id)}\n                              >\n                                ${PenIcon}\n                              </div>`}\n                        </div>`}\n                  </div>\n                  ${this.readonly\n                    ? null\n                    : html`<div\n                        draggable=\"true\"\n                        class=\"affine-database-column-move\"\n                      >\n                        ${DatabaseDragIcon}\n                      </div>`}\n                </div>\n                ${this.readonly\n                  ? null\n                  : html`<div\n                      class=\"affine-database-column-drag-handle ${this\n                        ._widthChangingIndex === index\n                        ? 'dragging'\n                        : ''}\"\n                    ></div>`}\n              </div>\n            `;\n          }\n        )}\n        <div class=\"affine-database-column database-cell add-column-button\">\n          ${this.readonly\n            ? null\n            : html`<div\n                  class=\"affine-database-column-drag-handle  ${this\n                    ._widthChangingIndex === this.columns.length\n                    ? 'dragging'\n                    : ''}\"\n                ></div>\n                <div\n                  class=\"header-add-column-button\"\n                  @click=${this._onAddColumn}\n                >\n                  ${DatabaseAddColumn}\n                </div>`}\n        </div>\n        ${this.readonly\n          ? null\n          : html`<div\n              class=\"affine-database-add-column-button\"\n              data-test-id=\"affine-database-add-column-button\"\n              @click=${this._onAddColumn}\n            >\n              ${DatabaseAddColumn}\n            </div>`}\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-database-column-header': DatabaseColumnHeader;\n  }\n}\n", "import { ShadowlessElement, WithDisposable } from '@blocksuite/lit';\nimport type { Page } from '@blocksuite/store';\nimport type { BaseBlockModel } from '@blocksuite/store';\nimport { property } from 'lit/decorators.js';\nimport type { literal } from 'lit/static-html.js';\n\nimport type { DatabaseBlockModel } from '../database-model.js';\nimport type { Cell, Column, ColumnType, RowHost } from './types.js';\n\nexport abstract class TableViewCell extends ShadowlessElement {\n  abstract readonly cellType: ColumnType;\n}\n\nexport abstract class DatabaseCellElement<Value> extends WithDisposable(\n  ShadowlessElement\n) {\n  static tag: ReturnType<typeof literal>;\n\n  @property()\n  rowHost!: RowHost<Value>;\n  @property()\n  databaseModel!: DatabaseBlockModel;\n  @property()\n  rowModel!: BaseBlockModel;\n  @property()\n  column!: Column;\n  @property()\n  cell: Cell<Value> | null = null;\n}\n\nexport interface ColumnRenderer<\n  Type extends ColumnType = ColumnType,\n  Property extends Record<string, unknown> = Record<string, unknown>,\n  Value = unknown\n> {\n  displayName: string;\n  type: Type;\n  propertyCreator: () => Property;\n  components: ColumnComponents;\n  defaultValue: (page: Page) => Value;\n}\n\nexport interface ColumnComponents<Value = unknown> {\n  Cell: typeof DatabaseCellElement<Value>;\n  CellEditing: typeof DatabaseCellElement<Value> | null;\n}\n\nexport function defineColumnRenderer<\n  Type extends ColumnType,\n  Property extends Record<string, unknown>,\n  Value\n>(\n  type: Type,\n  propertyCreator: () => Property,\n  defaultValue: (page: Page) => Value,\n  components: ColumnComponents,\n  config: {\n    displayName: string;\n  }\n): ColumnRenderer<Type, Property, Value> {\n  return {\n    displayName: config.displayName,\n    type,\n    propertyCreator,\n    components,\n    defaultValue,\n  };\n}\n\nexport class ColumnRendererHelper {\n  private _columns = new Map<ColumnRenderer['type'], ColumnRenderer>();\n\n  register(renderer: ColumnRenderer) {\n    const columns = this._columns;\n    if (columns.has(renderer.type)) {\n      throw new Error('cannot register twice for ' + renderer.type);\n    }\n    columns.set(renderer.type, renderer);\n  }\n\n  get(type: ColumnRenderer['type']): ColumnRenderer {\n    const renderer = this._columns.get(type);\n    if (!renderer) {\n      throw new Error('cannot find renderer');\n    }\n    return renderer;\n  }\n\n  list(): ColumnRenderer[] {\n    return [...this._columns.values()];\n  }\n}\n", "import { css } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { html } from 'lit/static-html.js';\n\nimport { onClickOutside } from '../../utils.js';\nimport type { ColumnRendererHelper } from '../register.js';\nimport { DatabaseCellElement } from '../register.js';\nimport type { RowHost, SetValueOption } from '../types.js';\n\n/** affine-database-cell-container padding */\nconst CELL_PADDING = 8;\n\n@customElement('affine-database-cell-container')\nexport class DatabaseCellContainer\n  extends DatabaseCellElement<unknown>\n  implements RowHost\n{\n  static override styles = css`\n    affine-database-cell-container {\n      display: flex;\n      align-items: center;\n      width: 100%;\n      height: 100%;\n      padding: 0 ${CELL_PADDING}px;\n      border-right: 1px solid var(--affine-border-color);\n    }\n\n    affine-database-cell-container * {\n      box-sizing: border-box;\n    }\n  `;\n\n  @state()\n  private _isEditing = false;\n\n  @property()\n  columnRenderer!: ColumnRendererHelper;\n\n  private get readonly() {\n    return this.databaseModel.page.readonly;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    const disposables = this._disposables;\n    disposables.addFromEvent(this, 'click', this._onClick);\n  }\n\n  protected override firstUpdated() {\n    this.setAttribute('data-block-is-database-input', 'true');\n    this.setAttribute('data-row-id', this.rowModel.id);\n    this.setAttribute('data-column-id', this.column.id);\n  }\n\n  private _onClick = (event: Event) => {\n    if (this.readonly) return;\n\n    this._isEditing = true;\n    this.removeEventListener('click', this._onClick);\n    setTimeout(() => {\n      onClickOutside(\n        this,\n        () => {\n          this.addEventListener('click', this._onClick);\n          this._isEditing = false;\n        },\n        'mousedown'\n      );\n    });\n  };\n\n  setValue(value: unknown, option: SetValueOption = { captureSync: true }) {\n    queueMicrotask(() => {\n      if (option.captureSync) {\n        this.databaseModel.page.captureSync();\n      }\n      this.databaseModel.updateCell(this.rowModel.id, {\n        columnId: this.column.id,\n        value,\n      });\n      this.databaseModel.applyColumnUpdate();\n      this.requestUpdate();\n    });\n  }\n\n  setEditing = (isEditing: boolean) => {\n    this._isEditing = isEditing;\n    if (!this._isEditing) {\n      setTimeout(() => {\n        this.addEventListener('click', this._onClick);\n      });\n    }\n  };\n\n  updateColumnProperty(\n    apply: (oldProperty: Record<string, unknown>) => Record<string, unknown>\n  ) {\n    const newProperty = apply(this.column);\n    this.databaseModel.page.captureSync();\n    this.databaseModel.updateColumn({\n      ...this.column,\n      ...newProperty,\n    });\n  }\n\n  setHeight = (height: number) => {\n    this.style.height = `${height + CELL_PADDING * 2}px`;\n  };\n\n  /* eslint-disable lit/binding-positions, lit/no-invalid-html */\n  override render() {\n    const renderer = this.columnRenderer.get(this.column.type);\n    const cell = this.databaseModel.getCell(this.rowModel.id, this.column.id);\n\n    if (\n      !this.readonly &&\n      this._isEditing &&\n      renderer.components.CellEditing !== null\n    ) {\n      const editingTag = renderer.components.CellEditing.tag;\n      return html`\n        <${editingTag}\n          data-is-editing-cell=\"true\"\n          .rowHost=${this}\n          .databaseModel=${this.databaseModel}\n          .rowModel=${this.rowModel}\n          .column=${this.column}\n          .cell=${cell}\n        ></${editingTag}>\n      `;\n    }\n    const previewTag = renderer.components.Cell.tag;\n    return html`\n      <${previewTag}\n        .rowHost=${this}\n        .databaseModel=${this.databaseModel}\n        .rowModel=${this.rowModel}\n        .column=${this.column}\n        .cell=${cell}\n      ></${previewTag}>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-database-cell-container': DatabaseCellContainer;\n  }\n}\n", "import {\n  ArrowDownIcon,\n  CopyIcon,\n  DatabaseKanbanViewIcon,\n  DatabaseTableViewIcon,\n  DeleteIcon,\n} from '@blocksuite/global/config';\nimport { createPopper } from '@popperjs/core';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\n\nimport { copyBlocks } from '../../../../__internal__/clipboard/utils/commons.js';\nimport { toast } from '../../../../components/toast.js';\nimport type { DatabaseBlockModel } from '../../../database-model.js';\nimport { isDivider } from '../../../utils.js';\nimport type {\n  SwitchViewAction,\n  SwitchViewActionType,\n  ToolbarAction,\n  ToolbarActionType,\n} from '../../types.js';\nimport { actionStyles } from '../edit-column-popup/styles.js';\n\nconst toolbarActions: ToolbarAction[] = [\n  {\n    type: 'database-type',\n    text: 'Database type',\n    icon: DatabaseTableViewIcon,\n  },\n  {\n    type: 'copy',\n    text: 'Copy',\n    icon: CopyIcon,\n  },\n  {\n    type: 'divider',\n  },\n  {\n    type: 'delete-database',\n    text: 'Delete database',\n    icon: DeleteIcon,\n  },\n];\n\nconst databaseTypes: SwitchViewAction[] = [\n  {\n    type: 'table',\n    text: 'Table view',\n    icon: DatabaseTableViewIcon,\n  },\n  {\n    type: 'kanban',\n    text: 'Kanban view',\n    icon: DatabaseKanbanViewIcon,\n  },\n];\n\n@customElement('affine-database-type-popup')\nclass DatabaseTypePopup extends LitElement {\n  static override styles = css`\n    :host {\n      width: 200px;\n      padding: 8px;\n      border: 1px solid var(--affine-border-color);\n      border-radius: 8px;\n      background: var(--affine-background-primary-color);\n      box-shadow: 0px 0px 12px rgba(66, 65, 73, 0.14),\n        inset 0px 0px 0px 0.5px var(--affine-border-color);\n    }\n    :host * {\n      box-sizing: border-box;\n    }\n    ${actionStyles}\n    .action > svg {\n      width: 16px;\n      height: 16px;\n      fill: var(--affine-icon-color);\n    }\n    .database-type {\n      height: 30px;\n      padding: 0;\n      color: var(--affine-text-secondary-color);\n      font-size: 14px;\n      cursor: unset;\n    }\n    .database-type:hover {\n      background: none;\n    }\n    .selected {\n      color: var(--affine-text-emphasis-color);\n      background: rgba(0, 0, 0, 0.02);\n    }\n    .selected svg {\n      color: var(--affine-text-emphasis-color);\n    }\n    .selected.table-view svg {\n      fill: var(--affine-text-emphasis-color);\n    }\n    .action.disabled {\n      cursor: not-allowed;\n    }\n    .action.disabled:hover {\n      background: unset;\n    }\n  `;\n\n  @property()\n  dbType!: SwitchViewActionType;\n\n  override render() {\n    return html`\n      <div class=\"affine-database-type-popup\">\n        <div class=\"action database-type\">\n          <div class=\"action-content\"><span>Database type</span></div>\n        </div>\n        <div class=\"action-divider\"></div>\n        ${databaseTypes.map(column => {\n          const isKanban = column.type === 'kanban';\n          const selected = column.type === this.dbType && !isKanban;\n\n          return html`\n            <div\n              class=\"action ${column.type} ${selected\n                ? 'selected'\n                : ''} ${isKanban ? 'disabled' : ''}\"\n            >\n              <div class=\"action-content\">\n                ${column.icon}<span>${column.text}</span>\n              </div>\n            </div>\n          `;\n        })}\n      </div>\n    `;\n  }\n}\n\n@customElement('affine-database-toolbar-action-popup')\nexport class ToolbarActionPopup extends LitElement {\n  static override styles = css`\n    :host {\n      width: 200px;\n      height: 128px;\n      padding: 8px;\n      border: 1px solid var(--affine-border-color);\n      border-radius: 8px;\n      box-shadow: 0px 0px 12px rgba(66, 65, 73, 0.14),\n        inset 0px 0px 0px 0.5px var(--affine-border-color);\n      z-index: var(--affine-z-index-popover);\n      background: var(--affine-white);\n    }\n    :host * {\n      box-sizing: border-box;\n    }\n    ${actionStyles}\n    .action-content > svg {\n      width: 20px;\n      height: 20px;\n      fill: var(--affine-icon-color);\n    }\n    .action > svg {\n      width: 16px;\n      height: 16px;\n      fill: var(--affine-icon-color);\n    }\n    .database-type > svg {\n      transform: rotate(-90deg);\n    }\n  `;\n\n  targetModel!: DatabaseBlockModel;\n\n  @property()\n  close!: () => void;\n\n  @query('.affine-database-toolbar-action-popup')\n  private _container!: HTMLDivElement;\n\n  private _databaseTypePopup!: DatabaseTypePopup | null;\n\n  private _onActionClick = (\n    event: MouseEvent,\n    actionType: ToolbarActionType\n  ) => {\n    event.stopPropagation();\n\n    if (actionType === 'delete-database') {\n      const models = [this.targetModel, ...this.targetModel.children];\n      models.forEach(model => this.targetModel.page.deleteBlock(model));\n    } else if (actionType === 'copy') {\n      copyBlocks({\n        type: 'Block',\n        models: [this.targetModel],\n        startOffset: 0,\n        endOffset: 0,\n      });\n      toast('Copied Database to clipboard');\n    }\n\n    this.close();\n  };\n\n  private _onShowDatabaseType = () => {\n    if (this._databaseTypePopup) return;\n    this._databaseTypePopup = new DatabaseTypePopup();\n    this._databaseTypePopup.dbType = 'table';\n    this._container.appendChild(this._databaseTypePopup);\n    createPopper(this._container, this._databaseTypePopup, {\n      placement: 'right-start',\n      modifiers: [\n        {\n          name: 'offset',\n          options: {\n            offset: [-9, 12],\n          },\n        },\n      ],\n    });\n  };\n\n  private _onHideDatabaseType = () => {\n    if (this._databaseTypePopup) {\n      this._databaseTypePopup?.remove();\n      this._databaseTypePopup = null;\n    }\n  };\n\n  private _renderActions = () => {\n    return html`\n      ${toolbarActions.map(action => {\n        if (isDivider(action)) {\n          return html`<div class=\"action-divider\"></div>`;\n        }\n\n        const onMouseOver =\n          action.type === 'database-type'\n            ? this._onShowDatabaseType\n            : this._onHideDatabaseType;\n\n        return html`\n          <div\n            class=\"action ${action.type}\"\n            @mouseover=${onMouseOver}\n            @click=${(event: MouseEvent) =>\n              this._onActionClick(event, action.type)}\n          >\n            <div class=\"action-content\">\n              ${action.icon}<span>${action.text}</span>\n            </div>\n            ${action.type === 'database-type' ? ArrowDownIcon : html``}\n          </div>\n        `;\n      })}\n    `;\n  };\n\n  override render() {\n    return html`<div class=\"affine-database-toolbar-action-popup\">\n      ${this._renderActions()}\n    </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-database-toolbar-action-popup': ToolbarActionPopup;\n  }\n}\n", "import { PlusIcon } from '@blocksuite/global/config';\nimport { ShadowlessElement } from '@blocksuite/lit';\nimport { DisposableGroup } from '@blocksuite/store';\nimport { assertExists } from '@blocksuite/store';\nimport { html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport type { DragIndicator } from '../../../../components/drag-handle.js';\nimport { Point, Rect } from '../../../../std.js';\n\n@customElement('affine-database-new-record-preview')\nclass NewRecordPreview extends ShadowlessElement {\n  @property()\n  offset = { x: 0, y: 0 };\n\n  override render() {\n    return html`\n      <style>\n        affine-database-new-record-preview {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          position: fixed;\n          top: 0;\n          left: 0;\n          height: 32px;\n          width: 32px;\n          border: 1px solid var(--affine-border-color);\n          border-radius: 50%;\n          background: linear-gradient(\n              0deg,\n              rgba(96, 70, 254, 0.3),\n              rgba(96, 70, 254, 0.3)\n            ),\n            linear-gradient(\n              0deg,\n              var(--affine-hover-color),\n              var(--affine-hover-color)\n            ),\n            var(--affine-white);\n          box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.05),\n            0px 0px 0px 0.5px var(--affine-black-10);\n          cursor: none;\n          user-select: none;\n          pointer-events: none;\n          caret-color: transparent;\n          z-index: 100;\n        }\n        affine-database-new-record-preview svg {\n          width: 16px;\n          height: 16px;\n        }\n        affine-database-new-record-preview path {\n          fill: var(--affine-brand-color);\n        }\n      </style>\n      ${PlusIcon}\n    `;\n  }\n}\n\nexport type ColumnConfig = {\n  index: number;\n  rows: HTMLElement[];\n};\n\nexport function initAddNewRecordHandlers(\n  element: HTMLElement,\n  container: HTMLElement,\n  addRow: (index: number) => void\n) {\n  let dragConfig: ColumnConfig | null = null;\n  let dragPreview: NewRecordPreview | null = null;\n\n  const database = container.closest('affine-database');\n  if (!database) return;\n\n  const rowContainer = database.querySelector<HTMLElement>(\n    '.affine-database-block-rows'\n  );\n  assertExists(rowContainer);\n\n  const indicator = document.querySelector<DragIndicator>(\n    'affine-drag-indicator'\n  );\n  if (!indicator) {\n    const indicator = <DragIndicator>(\n      document.createElement('affine-drag-indicator')\n    );\n    document.body.appendChild(indicator);\n  }\n\n  const onDragStart = (event: DragEvent) => {\n    event.stopPropagation();\n    assertExists(event.dataTransfer);\n    event.dataTransfer.effectAllowed = 'move';\n\n    dragPreview = new NewRecordPreview();\n    dragPreview.style.opacity = '0';\n    event.dataTransfer?.setDragImage(dragPreview, 0, 0);\n    container.appendChild(dragPreview);\n\n    const rows = Array.from(\n      rowContainer.querySelectorAll<HTMLElement>('.affine-database-block-row')\n    );\n    dragConfig = {\n      index: -1,\n      rows,\n    };\n  };\n\n  const onDrag = (event: DragEvent) => {\n    if (!dragConfig) return;\n    if (!dragPreview) return;\n\n    if (dragPreview.style.opacity !== '1') {\n      dragPreview.style.opacity = '1';\n    }\n    const x = event.clientX;\n    const y = event.clientY;\n\n    dragPreview.style.transform = `translate(${x}px, ${y}px)`;\n\n    const point = new Point(x, y);\n    const row = getClosestRow(point, dragConfig.rows);\n    assertExists(indicator);\n\n    if (row) {\n      const { top, bottom } = row.element.getBoundingClientRect();\n      const rectTop = row.isLast ? bottom : top;\n      const { width: databaseWidth, left: databaseLeft } =\n        database.getBoundingClientRect();\n      indicator.rect = Rect.fromLWTH(databaseLeft, databaseWidth, rectTop, 3);\n      dragConfig.index = row.insertRowIndex;\n    } else {\n      indicator.rect = null;\n      dragConfig.index = -1;\n    }\n  };\n\n  const onDragEnd = () => {\n    if (!dragConfig) return;\n    const { index } = dragConfig;\n    // clear data\n    dragConfig = null;\n    if (indicator) indicator.rect = null;\n    if (dragPreview) {\n      dragPreview.remove();\n      dragPreview = null;\n    }\n    if (index !== -1) {\n      addRow(index);\n    }\n  };\n\n  const disposables = new DisposableGroup();\n  const stopPropagation = (e: Event) => {\n    e.stopPropagation();\n  };\n  disposables.addFromEvent(element, 'pointerdown', stopPropagation);\n  disposables.addFromEvent(element, 'pointermove', stopPropagation);\n  disposables.addFromEvent(element, 'pointerup', stopPropagation);\n\n  disposables.addFromEvent(element, 'dragstart', onDragStart);\n  disposables.addFromEvent(element, 'drag', onDrag);\n  disposables.addFromEvent(element, 'dragend', onDragEnd);\n  return disposables;\n}\n\nfunction getClosestRow(\n  point: Point,\n  rows: HTMLElement[]\n): {\n  element: HTMLElement;\n  insertRowIndex: number;\n  isLast: boolean;\n} | null {\n  const length = rows.length;\n\n  for (let i = 0; i < length; i++) {\n    const row = rows[i];\n    const { top, bottom } = row.getBoundingClientRect();\n    if (point.y <= top + 20 && point.y >= top - 20) {\n      return {\n        element: row,\n        insertRowIndex: i,\n        isLast: false,\n      };\n    }\n\n    // last row\n    if (i === length - 1) {\n      if (point.y >= bottom - 20 && point.y <= bottom + 20) {\n        return {\n          element: row,\n          insertRowIndex: i + 1,\n          isLast: true,\n        };\n      }\n    }\n  }\n\n  return null;\n}\n", "import './toolbar-action-popup.js';\n\nimport {\n  DatabaseSearchClose,\n  DatabaseSearchIcon,\n  MoreHorizontalIcon,\n  PlusIcon,\n} from '@blocksuite/global/config';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/lit';\nimport { DisposableGroup } from '@blocksuite/store';\nimport { createPopper } from '@popperjs/core';\nimport { css, html } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\n\nimport { stopPropagation } from '../../../../page-block/edgeless/utils.js';\nimport type { DatabaseBlockModel } from '../../../database-model.js';\nimport { onClickOutside } from '../../../utils.js';\nimport { SearchState } from '../../types.js';\nimport { initAddNewRecordHandlers } from './index.js';\nimport { ToolbarActionPopup } from './toolbar-action-popup.js';\n\ntype CellValues = string[];\n\n/**\n * Containing all the cell values in rows.\n * ```\n * { rowId: CellValues }\n * ```\n */\ntype DatabaseMap = Record<string, CellValues>;\n\nconst styles = css`\n  .affine-database-toolbar {\n    display: none;\n    align-items: center;\n    gap: 26px;\n  }\n  .affine-database-toolbar-search svg,\n  .affine-database-toolbar svg {\n    width: 16px;\n    height: 16px;\n    fill: var(--affine-icon-color);\n  }\n  .affine-database-toolbar-item {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n  }\n  .search-container.hidden {\n    overflow: hidden;\n  }\n  .affine-database-toolbar-item.more-action {\n    width: 32px;\n    height: 32px;\n    border-radius: 4px;\n  }\n  .affine-database-toolbar-item.more-action:hover,\n  .more-action.active {\n    background: var(--affine-hover-color);\n  }\n  .affine-database-search-container {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    width: 16px;\n    height: 32px;\n    padding: 8px 0;\n    border-radius: 8px;\n    transition: all 0.3s ease;\n  }\n  .affine-database-search-container > svg {\n    min-width: 16px;\n    min-height: 16px;\n  }\n  .search-container-expand {\n    width: 138px;\n    padding: 8px 12px;\n    background-color: var(--affine-hover-color);\n  }\n  .search-input-container {\n    display: flex;\n    align-items: center;\n  }\n  .search-input-container > .close-icon {\n    display: flex;\n    align-items: center;\n  }\n  .close-icon .code {\n    width: 31px;\n    height: 18px;\n    padding: 2px 6px;\n    border-radius: 4px;\n    background: var(--affine-white-10);\n  }\n  .affine-database-search-input-icon {\n    display: inline-flex;\n  }\n  .affine-database-search-input {\n    flex: 1;\n    height: 16px;\n    width: 80px;\n    border: none;\n    font-family: var(--affine-font-family);\n    font-size: var(--affine-font-sm);\n    box-sizing: border-box;\n    color: inherit;\n    background: transparent;\n  }\n  .affine-database-search-input:focus {\n    outline: none;\n  }\n  .affine-database-search-input::placeholder {\n    color: var(--affine-placeholder-color);\n    font-size: var(--affine-font-sm);\n  }\n\n  .affine-database-toolbar-item.new-record {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    width: 120px;\n    height: 32px;\n    padding: 6px 8px;\n    border-radius: 8px;\n    font-size: 14px;\n    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.05),\n      0px 0px 0px 0.5px var(--affine-black-10);\n    background: linear-gradient(\n        0deg,\n        var(--affine-hover-color),\n        var(--affine-hover-color)\n      ),\n      var(--affine-white);\n  }\n  .new-record > tool-tip {\n    max-width: 280px;\n  }\n\n  .show-toolbar {\n    display: flex;\n  }\n`;\n\n@customElement('affine-database-toolbar')\nexport class DatabaseToolbar extends WithDisposable(ShadowlessElement) {\n  static override styles = styles;\n\n  @property()\n  targetModel!: DatabaseBlockModel;\n\n  @property()\n  hoverState!: boolean;\n\n  @property()\n  searchState!: SearchState;\n\n  @property()\n  addRow!: (index?: number) => void;\n\n  @property()\n  setSearchState!: (state: SearchState) => void;\n\n  @property()\n  setFilteredRowIds!: (rowIds: string[]) => void;\n\n  @query('.affine-database-search-input')\n  private _searchInput!: HTMLInputElement;\n\n  @query('.more-action')\n  private _moreActionContainer!: HTMLDivElement;\n\n  @query('.search-container')\n  private _searchContainer!: HTMLDivElement;\n\n  @query('.new-record')\n  private _newRecord!: HTMLDivElement;\n\n  private _toolbarAction!: ToolbarActionPopup | undefined;\n  private _recordAddDisposables = new DisposableGroup();\n\n  private get readonly() {\n    return this.targetModel.page.readonly;\n  }\n\n  override firstUpdated() {\n    if (!this.readonly) {\n      this._initAddRecordHandlers();\n    }\n  }\n\n  override updated(changedProperties: Map<string, unknown>) {\n    super.updated(changedProperties);\n\n    if (!this.readonly) {\n      this._initAddRecordHandlers();\n    }\n  }\n\n  private _initAddRecordHandlers() {\n    // remove previous handlers\n    this._recordAddDisposables.dispose();\n\n    const disposables = initAddNewRecordHandlers(\n      this._newRecord,\n      this,\n      this.addRow\n    );\n    if (disposables) {\n      // bind new handlers\n      this._recordAddDisposables = disposables;\n    }\n  }\n\n  private get _databaseMap() {\n    const databaseMap: DatabaseMap = {};\n    for (const child of this.targetModel.children) {\n      // The first value is the text context of the row block\n      databaseMap[child.id] = [child.text?.toString() ?? ''];\n    }\n\n    const { cells } = this.targetModel;\n    const rowIds = this.targetModel.children.map(child => child.id);\n\n    rowIds.forEach(rowId => {\n      // The map containing all columns related to this row (block)\n      const columnMap = cells[rowId];\n      if (!columnMap) return;\n\n      // Flatten the columnMap into a list of values\n      const columnValues = Object.keys(columnMap).map(key => {\n        const value = columnMap[key].value;\n        if (Array.isArray(value)) {\n          return value.map(item => item.value);\n        }\n        return columnMap[key].value + '';\n      });\n      databaseMap[rowId].push(...columnValues.flat());\n    });\n\n    return databaseMap;\n  }\n\n  private _onSearch = (event: InputEvent) => {\n    const el = event.target as HTMLInputElement;\n    const inputValue = el.value.trim();\n    this.setSearchState(SearchState.Searching);\n    if (inputValue === '') {\n      this.setSearchState(SearchState.SearchInput);\n    }\n\n    const { _databaseMap } = this;\n    const existingRowIds = Object.keys(_databaseMap).filter(key => {\n      return (\n        _databaseMap[key].findIndex(item =>\n          item.toLocaleLowerCase().includes(inputValue.toLocaleLowerCase())\n        ) > -1\n      );\n    });\n\n    const filteredRowIds = this.targetModel.children\n      .filter(child => existingRowIds.includes(child.id))\n      .map(child => child.id);\n    this.setFilteredRowIds(filteredRowIds);\n\n    // When deleting the search content, the rich-text in the database row will automatically get the focus,\n    // causing the search box to blur. So, here we manually make it focus.\n    requestAnimationFrame(() => el.focus());\n  };\n\n  private _onSearchKeydown = (event: KeyboardEvent) => {\n    if (event.key === 'Escape') {\n      if (this._searchInput.value) {\n        this._searchInput.value = '';\n        this.setSearchState(SearchState.SearchInput);\n      } else {\n        this._resetSearchStatus();\n        this._searchContainer.classList.add('hidden');\n      }\n    }\n  };\n\n  private _clearSearch = (event: MouseEvent) => {\n    event.stopPropagation();\n    this._searchInput.value = '';\n    this.setSearchState(SearchState.SearchInput);\n  };\n\n  private _onShowSearch = () => {\n    this.setSearchState(SearchState.SearchInput);\n    const removeListener = onClickOutside(\n      this._searchContainer,\n      () => {\n        if (this.searchState !== SearchState.Searching) {\n          this._searchContainer.classList.add('hidden');\n          this.setSearchState(SearchState.SearchIcon);\n          removeListener();\n        }\n      },\n      'click',\n      true\n    );\n  };\n\n  private _onFocusSearchInput = () => {\n    if (this.searchState === SearchState.SearchInput) {\n      this._searchInput.focus();\n      this._searchContainer.classList.remove('hidden');\n    } else {\n      this._searchInput.blur();\n    }\n  };\n\n  private _onShowAction = () => {\n    if (this.readonly) return;\n\n    if (this._toolbarAction) {\n      this._closeToolbarAction();\n      return;\n    }\n    this.setSearchState(SearchState.Action);\n    this._toolbarAction = new ToolbarActionPopup();\n    this._toolbarAction.targetModel = this.targetModel;\n    this._toolbarAction.close = this._closeToolbarAction;\n    this._moreActionContainer.appendChild(this._toolbarAction);\n    createPopper(this._moreActionContainer, this._toolbarAction, {\n      placement: 'bottom',\n    });\n    onClickOutside(\n      this._moreActionContainer,\n      () => {\n        this._closeToolbarAction();\n      },\n      'mousedown'\n    );\n  };\n\n  private _closeToolbarAction = () => {\n    this._toolbarAction?.remove();\n    this._toolbarAction = undefined;\n  };\n\n  private _resetSearchStatus = () => {\n    this._searchInput.value = '';\n    this.setFilteredRowIds([]);\n    this.setSearchState(SearchState.SearchIcon);\n  };\n\n  private _onAddNewRecord = () => {\n    if (this.readonly) return;\n    this.addRow(0);\n  };\n\n  override render() {\n    const expandSearch =\n      this.searchState === SearchState.SearchInput ||\n      this.searchState === SearchState.Searching;\n    const isActiveMoreAction = this.searchState === SearchState.Action;\n\n    const onSearchIconClick = expandSearch ? undefined : this._onShowSearch;\n\n    const closeIcon = this._searchInput\n      ? this._searchInput.value === ''\n        ? null\n        : DatabaseSearchClose\n      : null;\n\n    const searchTool = html`\n      <div\n        class=\"affine-database-search-container ${expandSearch\n          ? 'search-container-expand'\n          : ''}\"\n        @click=${onSearchIconClick}\n        @transitionend=${this._onFocusSearchInput}\n      >\n        <div class=\"affine-database-search-input-icon\">\n          ${DatabaseSearchIcon}\n        </div>\n        <div class=\"search-input-container\">\n          <input\n            placeholder=\"Search...\"\n            class=\"affine-database-search-input\"\n            @input=${this._onSearch}\n            @click=${(event: MouseEvent) => event.stopPropagation()}\n            @keydown=${this._onSearchKeydown}\n            @pointerdown=${stopPropagation}\n          />\n          <div class=\"has-tool-tip close-icon\" @click=${this._clearSearch}>\n            ${closeIcon}\n            <tool-tip inert arrow tip-position=\"top\" role=\"tooltip\">\n              <span class=\"code\">Esc</span> to clear all\n            </tool-tip>\n          </div>\n        </div>\n      </div>\n    `;\n\n    return html`<div\n      class=\"affine-database-toolbar ${this.hoverState ? 'show-toolbar' : ''}\"\n    >\n      <div class=\"affine-database-toolbar-item search-container hidden\">\n        ${searchTool}\n      </div>\n      ${this.readonly\n        ? null\n        : html`<div\n              class=\"affine-database-toolbar-item more-action ${isActiveMoreAction\n                ? 'active'\n                : ''}\"\n              @click=${this._onShowAction}\n            >\n              ${MoreHorizontalIcon}\n            </div>\n            <div\n              class=\"has-tool-tip affine-database-toolbar-item new-record\"\n              draggable=\"true\"\n              @click=${this._onAddNewRecord}\n            >\n              ${PlusIcon}<span>New Record</span>\n              <tool-tip inert arrow tip-position=\"top\" role=\"tooltip\"\n                >You can drag this button to the desired location and add a\n                record\n              </tool-tip>\n            </div>`}\n    </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-database-toolbar': DatabaseToolbar;\n  }\n}\n", "import { VEditor, type VRange } from '@blocksuite/virgo';\nimport * as Y from 'yjs';\n\nimport { activeEditorManager } from '../../__internal__/utils/active-editor-manager.js';\n\ninterface StackItem {\n  meta: Map<'v-range', VRange | null>;\n  type: 'undo' | 'redo';\n}\n\nexport class VirgoInput {\n  static YTEXT_NAME = 'YTEXT_NAME';\n\n  yDoc: Y.Doc = new Y.Doc();\n  yText: Y.Text;\n\n  vEditor: VEditor;\n\n  private _active = true;\n\n  readonly type: 'default' | 'number' = 'default';\n  readonly maxLength = Infinity;\n\n  readonly undoManager: Y.UndoManager;\n\n  constructor(options: {\n    rootElement: HTMLElement;\n    yText?: Y.Text | string;\n    maxLength?: number;\n    type?: 'number';\n  }) {\n    const {\n      rootElement,\n      yText = this.yDoc.getText(VirgoInput.YTEXT_NAME),\n      maxLength,\n      type,\n    } = options;\n    const text = yText.toString();\n\n    if (maxLength) {\n      this.maxLength = maxLength;\n      if (text.length > maxLength) {\n        throw new Error('The text exceeds the limit length.');\n      }\n    }\n\n    if (type) {\n      this.type = type;\n    }\n\n    if (yText instanceof Y.Text) {\n      if (yText.doc) {\n        this.yText = yText;\n        this.yDoc = yText.doc;\n      } else {\n        throw new Error('Y.Text should be binded to Y.Doc.');\n      }\n    } else {\n      this.yText = this.yDoc.getText(VirgoInput.YTEXT_NAME);\n      this.yText.insert(0, text);\n    }\n\n    this.undoManager = new Y.UndoManager(this.yText, {\n      trackedOrigins: new Set([this.yDoc.clientID]),\n    });\n    this.undoManager.on(\n      'stack-item-added',\n      (event: { stackItem: StackItem }) => {\n        const vRange = this.vEditor.getVRange();\n        event.stackItem.meta.set('v-range', vRange);\n      }\n    );\n    this.undoManager.on(\n      'stack-item-popped',\n      (event: { stackItem: StackItem }) => {\n        const vRange = event.stackItem.meta.get('v-range');\n        if (vRange) {\n          this.vEditor.setVRange(vRange);\n        }\n      }\n    );\n\n    this.vEditor = new VEditor(this.yText, {\n      active: () =>\n        activeEditorManager.isActive(options.rootElement) && this.active,\n    });\n    this.vEditor.mount(rootElement);\n    this.vEditor.bindHandlers({\n      paste: (event: ClipboardEvent) => {\n        event.stopPropagation();\n\n        const data = event.clipboardData\n          ?.getData('text/plain')\n          ?.replace(/(\\r\\n|\\r|\\n)/g, '\\n');\n        if (!data) {\n          return;\n        }\n\n        const vRange = this.vEditor.getVRange();\n        if (vRange) {\n          if (vRange.length > 0) {\n            this.vEditor.yText.delete(vRange.index, vRange.length);\n          }\n          const length = this.vEditor.yText.length;\n          const restLength = this.maxLength - length;\n          if (restLength <= 0) {\n            return;\n          }\n          const text =\n            data.length > restLength ? data.slice(0, restLength) : data;\n\n          this.vEditor.insertText(vRange, text);\n          this.vEditor.setVRange({\n            index: vRange.index + text.length,\n            length: 0,\n          });\n          this.undoManager.stopCapturing();\n        }\n      },\n      virgoInput: ctx => {\n        const vRange = this.vEditor.getVRange();\n        if (!vRange) {\n          return ctx;\n        }\n\n        let originalText = this.vEditor.yText.toString();\n        if (vRange.length > 0) {\n          originalText = `${originalText.substring(\n            0,\n            vRange.index\n          )}${originalText.substring(vRange.index + vRange.length)}`;\n        }\n        const tmpText = `${originalText.substring(0, vRange.index)}${\n          ctx.data ?? ''\n        }${originalText.substring(vRange.index)}`;\n\n        let flag = true;\n\n        if (tmpText.length >= this.maxLength) {\n          ctx.skipDefault = true;\n          flag = false;\n        }\n\n        if (flag) {\n          this.undoManager.stopCapturing();\n        }\n        return ctx;\n      },\n      virgoCompositionEnd: ctx => {\n        const vRange = this.vEditor.getVRange();\n        if (!vRange) {\n          return ctx;\n        }\n\n        let originalText = this.vEditor.yText.toString();\n        if (vRange.length > 0) {\n          originalText = `${originalText.substring(\n            0,\n            vRange.index\n          )}${originalText.substring(vRange.index + vRange.length)}`;\n        }\n        const tmpText = `${originalText.substring(0, vRange.index)}${\n          ctx.data\n        }${originalText.substring(vRange.index)}`;\n\n        let flag = true;\n\n        if (tmpText.length >= this.maxLength) {\n          // We should not use `skipDefault` because we need to clear text node from IME.\n          ctx.data = '';\n          flag = false;\n        }\n\n        if (flag) {\n          this.undoManager.stopCapturing();\n        }\n\n        return ctx;\n      },\n      keydown: e => {\n        if (\n          e instanceof KeyboardEvent &&\n          (e.ctrlKey || e.metaKey) &&\n          (e.key === 'z' || e.key === 'Z')\n        ) {\n          e.preventDefault();\n          if (e.shiftKey) {\n            this.redo();\n          } else {\n            this.undo();\n          }\n        }\n      },\n    });\n\n    rootElement.addEventListener('blur', () => {\n      if (this.type === 'number') {\n        const text = this.yText.toString();\n        const num = parseFloat(text);\n        const transformedText = isNaN(num) ? '' : num.toString();\n        if (text !== transformedText) {\n          this.setActive(false);\n          this.setValue(transformedText);\n          // prevent vRange applied after value changed\n          requestAnimationFrame(() => {\n            this.setActive(true);\n          });\n        }\n      }\n    });\n  }\n\n  get value() {\n    return this.yText.toString();\n  }\n\n  get active() {\n    return this._active;\n  }\n\n  setActive(value: boolean) {\n    this._active = value;\n  }\n\n  setValue(str: string) {\n    if (str.length > this.maxLength) {\n      throw new Error('The text exceeds the limit length.');\n    }\n\n    this.yText.delete(0, this.yText.length);\n    this.yText.insert(0, str);\n    this.vEditor.setVRange({\n      index: str.length,\n      length: 0,\n    });\n    this.undoManager.stopCapturing();\n  }\n\n  undo() {\n    this.undoManager.undo();\n  }\n\n  redo() {\n    this.undoManager.redo();\n  }\n}\n", "import { ShadowlessElement, WithDisposable } from '@blocksuite/lit';\nimport { css, html } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\n\nimport { setupVirgoScroll } from '../../../__internal__/utils/virgo.js';\nimport { VirgoInput } from '../../../components/virgo-input/virgo-input.js';\nimport type { DatabaseBlockModel } from '../../database-model.js';\nimport { DATABASE_TITLE_LENGTH, DEFAULT_TITLE } from '../consts.js';\n\n@customElement('affine-database-title')\nexport class DatabaseTitle extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    .affine-database-title {\n      flex: 1;\n      max-width: 300px;\n      min-width: 300px;\n      height: 30px;\n    }\n\n    .database-title {\n      position: sticky;\n      width: 300px;\n      height: 30px;\n      font-size: 18px;\n      font-weight: 600;\n      line-height: 24px;\n      color: var(--affine-text-primary-color);\n      font-family: inherit;\n      /* overflow-x: scroll; */\n      overflow: hidden;\n      cursor: text;\n    }\n\n    .database-title [data-virgo-text='true'] {\n      display: block;\n      white-space: pre !important;\n    }\n\n    .database-title.ellipsis [data-virgo-text='true'] {\n      white-space: nowrap !important;\n      text-overflow: ellipsis;\n      overflow: hidden;\n    }\n\n    .database-title:focus {\n      outline: none;\n    }\n\n    .database-title:disabled {\n      background-color: transparent;\n    }\n\n    .database-title-empty::before {\n      content: 'Database';\n      color: var(--affine-placeholder-color);\n      position: absolute;\n      opacity: 0.5;\n    }\n  `;\n\n  @property()\n  targetModel!: DatabaseBlockModel;\n\n  @property()\n  addRow!: (rowIndex?: number) => void;\n\n  @query('.database-title')\n  private _titleContainer!: HTMLDivElement;\n\n  private _titleVInput: VirgoInput | null = null;\n\n  override firstUpdated() {\n    this._initTitleVEditor();\n    const disposables = this._disposables;\n\n    disposables.addFromEvent(this._titleContainer, 'focus', this._onTitleFocus);\n    disposables.addFromEvent(this._titleContainer, 'blur', this._onTitleBlur);\n\n    // prevent block selection\n    const onStopPropagation = (event: Event) => event.stopPropagation();\n    this._disposables.addFromEvent(this, 'pointerdown', onStopPropagation);\n    this._disposables.addFromEvent(this, 'pointermove', onStopPropagation);\n  }\n\n  private _initTitleVEditor() {\n    this._titleVInput = new VirgoInput({\n      yText: this.targetModel.title.yText,\n      rootElement: this._titleContainer,\n      maxLength: DATABASE_TITLE_LENGTH,\n    });\n    setupVirgoScroll(this.targetModel.page, this._titleVInput.vEditor);\n    this._titleVInput.vEditor.setReadonly(this.targetModel.page.readonly);\n    this._titleContainer.addEventListener('keydown', this._handleKeyDown);\n\n    // for title placeholder\n    this.targetModel.title.yText.observe(() => {\n      this.requestUpdate();\n    });\n  }\n\n  private _handleKeyDown = (event: KeyboardEvent) => {\n    if (event.key === 'Enter') {\n      // prevent insert v-line\n      event.preventDefault();\n      // insert new row\n      this.addRow(0);\n      return;\n    }\n  };\n\n  private _onTitleFocus = () => {\n    this._titleContainer.classList.remove('ellipsis');\n\n    this._titleVInput?.setActive(true);\n    if (this._titleVInput?.value === 'Database') {\n      this._titleVInput?.setValue('');\n    }\n  };\n\n  private _onTitleBlur = () => {\n    this._titleContainer.classList.add('ellipsis');\n\n    this._titleVInput?.setActive(false);\n    if (this._titleVInput?.value === '') {\n      this._titleVInput?.setValue(DEFAULT_TITLE);\n    }\n  };\n\n  override render() {\n    const isEmpty = !this.targetModel.title || !this.targetModel.title.length;\n    return html`<div class=\"affine-database-title\">\n      <div\n        class=\"database-title ${isEmpty ? 'database-title-empty' : ''}\"\n        data-block-is-database-title=\"true\"\n        title=${this.targetModel.title.toString()}\n      ></div>\n    </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-database-title': DatabaseTitle;\n  }\n}\n", "import { css, html } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport { literal } from 'lit/static-html.js';\n\nimport {\n  checkboxChecked,\n  checkboxUnchecked,\n} from '../../../../list-block/utils/icons.js';\nimport {\n  DatabaseCellElement,\n  defineColumnRenderer,\n  type TableViewCell,\n} from '../../register.js';\n\n@customElement('affine-database-checkbox-cell')\nclass CheckboxCell\n  extends DatabaseCellElement<boolean>\n  implements TableViewCell\n{\n  static override tag = literal`affine-database-checkbox-cell`;\n  cellType = 'checkbox' as const;\n\n  static override styles = css`\n    affine-database-checkbox-cell {\n      display: block;\n      width: 100%;\n      height: 100%;\n      cursor: pointer;\n    }\n\n    .affine-database-checkbox-container {\n      height: 100%;\n    }\n\n    .affine-database-checkbox {\n      display: flex;\n      align-items: center;\n      height: 100%;\n      width: 100%;\n    }\n  `;\n\n  protected override firstUpdated() {\n    this._disposables.addFromEvent(this, 'click', this._onChange);\n  }\n\n  private _onChange() {\n    const checked = !this.cell?.value;\n\n    this.rowHost.setValue(checked);\n  }\n\n  protected override render() {\n    const checked = this.cell?.value ?? false;\n\n    const icon = checked ? checkboxChecked() : checkboxUnchecked();\n    return html`<div class=\"affine-database-checkbox-container\">\n      <div class=\"affine-database-checkbox checkbox ${checked && 'checked'}\">\n        ${icon}\n      </div>\n    </div>`;\n  }\n}\n\nexport const CheckboxColumnRenderer = defineColumnRenderer(\n  'checkbox',\n  () => ({}),\n  () => false,\n  {\n    Cell: CheckboxCell,\n    CellEditing: null,\n  },\n  {\n    displayName: 'Checkbox',\n  }\n);\n", "import { css } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport { html, literal } from 'lit/static-html.js';\n\nimport {\n  DatabaseCellElement,\n  defineColumnRenderer,\n  type TableViewCell,\n} from '../../register.js';\nimport type { SelectTag } from '../../types.js';\nimport { SelectMode } from '../../types.js';\n\n@customElement('affine-database-multi-select-cell')\nclass MultiSelectCell\n  extends DatabaseCellElement<SelectTag[]>\n  implements TableViewCell\n{\n  static override styles = css`\n    :host {\n      width: 100%;\n    }\n  `;\n  static override tag = literal`affine-database-multi-select-cell`;\n  cellType = 'multi-select' as const;\n\n  override render() {\n    return html`\n      <affine-database-select-cell\n        .rowHost=${this.rowHost}\n        .databaseModel=${this.databaseModel}\n        .rowModel=${this.rowModel}\n        .column=${this.column}\n        .cell=${this.cell}\n      ></affine-database-select-cell>\n    `;\n  }\n}\n\n@customElement('affine-database-multi-select-cell-editing')\nclass MultiSelectCellEditing\n  extends DatabaseCellElement<SelectTag[]>\n  implements TableViewCell\n{\n  static override tag = literal`affine-database-multi-select-cell-editing`;\n  cellType = 'multi-select' as const;\n\n  override render() {\n    return html`\n      <affine-database-select-cell-editing\n        data-is-editing-cell=\"true\"\n        .rowHost=${this.rowHost}\n        .databaseModel=${this.databaseModel}\n        .rowModel=${this.rowModel}\n        .column=${this.column}\n        .cell=${this.cell}\n        .mode=${SelectMode.Multi}\n      ></affine-database-select-cell-editing>\n    `;\n  }\n}\n\nexport const MultiSelectColumnRenderer = defineColumnRenderer(\n  'multi-select',\n  () => ({\n    selection: [] as SelectTag[],\n  }),\n  () => [] as SelectTag[],\n  {\n    Cell: MultiSelectCell,\n    CellEditing: MultiSelectCellEditing,\n  },\n  {\n    displayName: 'Multi Select',\n  }\n);\n", "import { assertExists, type Y } from '@blocksuite/store';\nimport { css, html } from 'lit';\nimport { customElement, query } from 'lit/decorators.js';\nimport { literal } from 'lit/static-html.js';\n\nimport { setupVirgoScroll } from '../../../../__internal__/utils/virgo.js';\nimport { VirgoInput } from '../../../../components/virgo-input/virgo-input.js';\nimport {\n  DatabaseCellElement,\n  defineColumnRenderer,\n  type TableViewCell,\n} from '../../register.js';\n\n@customElement('affine-database-number-cell-editing')\nexport class NumberCellEditing\n  extends DatabaseCellElement<Y.Text>\n  implements TableViewCell\n{\n  static override styles = css`\n    affine-database-number-cell-editing {\n      display: block;\n      width: 100%;\n      height: 100%;\n      cursor: text;\n    }\n\n    .affine-database-number {\n      display: flex;\n      align-items: center;\n      height: 100%;\n    }\n    .affine-database-number:focus {\n      outline: none;\n    }\n    .affine-database-number v-line {\n      display: flex !important;\n      align-items: center;\n      height: 100%;\n      width: 100%;\n    }\n    .affine-database-number v-line > div {\n      flex-grow: 1;\n    }\n  `;\n\n  static override tag = literal`affine-database-number-cell-editing`;\n  cellType = 'number' as const;\n\n  @query('.affine-database-number')\n  private _container!: HTMLDivElement;\n\n  private _vInput: VirgoInput | null = null;\n  get vEditor() {\n    assertExists(this._vInput);\n    return this._vInput.vEditor;\n  }\n\n  override firstUpdated() {\n    this._disposables.addFromEvent(this, 'click', this._onClick);\n    this._onInitVEditor();\n  }\n\n  private _onClick = () => {\n    this.databaseModel.page.captureSync();\n  };\n\n  private _onInitVEditor = () => {\n    let value: Y.Text;\n    if (!this.cell?.value) {\n      const yText = new this.databaseModel.page.YText('');\n      this.databaseModel.updateCell(this.rowModel.id, {\n        columnId: this.column.id,\n        value: yText,\n      });\n      value = yText;\n    } else {\n      value = this.cell.value;\n    }\n\n    this._vInput = new VirgoInput({\n      yText: value,\n      rootElement: this._container,\n      type: 'number',\n    });\n    setupVirgoScroll(this.databaseModel.page, this.vEditor);\n    this._container.addEventListener('keydown', event => {\n      if (!this._vInput) return;\n      if (event.key === 'Enter') {\n        if (event.shiftKey) {\n          // soft enter\n        } else {\n          // exit editing\n          this.rowHost.setEditing(false);\n          this._container.blur();\n        }\n        event.preventDefault();\n        return;\n      }\n    });\n  };\n\n  protected override render() {\n    return html`<div class=\"affine-database-number number virgo-editor\"></div>`;\n  }\n}\n\nexport const NumberColumnRenderer = defineColumnRenderer(\n  'number',\n  () => ({\n    decimal: 0,\n  }),\n  page => new page.YText(''),\n  {\n    Cell: NumberCellEditing,\n    CellEditing: null,\n  },\n  {\n    displayName: 'Number',\n  }\n);\n", "import { css, html } from 'lit';\nimport { customElement, query } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\nimport { literal } from 'lit/static-html.js';\n\nimport {\n  DatabaseCellElement,\n  defineColumnRenderer,\n  type TableViewCell,\n} from '../../register.js';\n\nconst styles = css`\n  affine-database-progress-cell-editing {\n    display: block;\n    width: 100%;\n    height: 100%;\n    padding: 0 4px;\n  }\n\n  affine-database-progress-cell-editing:hover\n    .affine-database-progress-drag-handle {\n    opacity: 1;\n  }\n\n  .affine-database-progress {\n    display: flex;\n    align-items: center;\n    height: 100%;\n    gap: 4px;\n  }\n\n  .affine-database-progress-bar {\n    position: relative;\n    width: 104px;\n  }\n\n  .affine-database-progress-bg {\n    overflow: hidden;\n    width: 100%;\n    height: 13px;\n    border-radius: 22px;\n  }\n\n  .affine-database-progress-fg {\n    height: 100%;\n  }\n\n  .affine-database-progress-drag-handle {\n    position: absolute;\n    top: 0;\n    left: 0;\n    transform: translate(0px, -1px);\n    width: 6px;\n    height: 15px;\n    border-radius: 2px;\n    opacity: 0;\n    cursor: ew-resize;\n    background: var(--affine-primary-color);\n    transition: opacity 0.2s ease-in-out;\n  }\n\n  .progress-number {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 18px;\n    width: 25px;\n    color: var(--affine-text-secondary-color);\n    font-size: 14px;\n  }\n`;\n\nconst progressColors = {\n  empty: 'var(--affine-black-10)',\n  processing: 'var(--affine-processing-color)',\n  success: 'var(--affine-success-color)',\n};\n\ntype DragConfig = {\n  stepWidth: number;\n  containerWidth: number;\n  boundLeft: number;\n};\n\n@customElement('affine-database-progress-cell-editing')\nclass ProgressCellEditing\n  extends DatabaseCellElement<number>\n  implements TableViewCell\n{\n  static override styles = styles;\n\n  static override tag = literal`affine-database-progress-cell-editing`;\n  cellType = 'progress' as const;\n\n  @query('.affine-database-progress-drag-handle')\n  private _dragHandle!: HTMLElement;\n\n  @query('.affine-database-progress-bg')\n  private _progressBg!: HTMLElement;\n\n  private _dragConfig: DragConfig | null = null;\n  private _progressBgWidth = 0;\n\n  override firstUpdated() {\n    const disposables = this._disposables;\n\n    disposables.addFromEvent(\n      this._dragHandle,\n      'pointerdown',\n      this._onPointerDown\n    );\n    disposables.addFromEvent(this, 'pointermove', this._onPointerMove);\n    disposables.addFromEvent(this, 'pointerup', this._onPointerUp);\n    disposables.addFromEvent(document, 'pointermove', this._onDocumentMove);\n\n    const { width } = this._progressBg.getBoundingClientRect();\n    const visibleWidth = width - 6;\n    this._progressBgWidth = visibleWidth;\n    const value = this.cell?.value;\n    if (value) {\n      this._setDragHandlePosition(value);\n    }\n  }\n\n  private _setDragHandlePosition(value: number) {\n    const x = this._progressBgWidth * (value / 100);\n    this._dragHandle.style.transform = `translate(${x}px, -1px)`;\n  }\n\n  protected override updated(_changedProperties: Map<string, unknown>) {\n    super.updated(_changedProperties);\n\n    if (_changedProperties.has('cell')) {\n      this._setDragHandlePosition(this.cell?.value ?? 0);\n    }\n  }\n\n  private _onDocumentMove = () => {\n    if (!this._dragConfig) return;\n    this._onPointerUp();\n  };\n\n  private _onPointerDown = (event: PointerEvent) => {\n    event.stopPropagation();\n    const { left, width } = this._progressBg.getBoundingClientRect();\n    const visibleWidth = width - 6;\n    this._dragConfig = {\n      stepWidth: visibleWidth / 100,\n      boundLeft: left,\n      containerWidth: visibleWidth,\n    };\n    this.databaseModel.page.captureSync();\n  };\n\n  private _onPointerMove = (event: PointerEvent) => {\n    event.stopPropagation();\n    if (!this._dragConfig) return;\n    const x = event.clientX;\n    const { boundLeft, containerWidth, stepWidth } = this._dragConfig;\n\n    let steps: number;\n    if (x <= boundLeft) {\n      steps = 0;\n    } else if (x - boundLeft >= containerWidth) {\n      steps = 100;\n    } else {\n      steps = Math.floor((x - boundLeft) / stepWidth);\n    }\n\n    if (this.cell?.value !== steps) {\n      this.rowHost.setValue(steps, { captureSync: false });\n    }\n  };\n\n  private _onPointerUp = () => {\n    this._dragConfig = null;\n    this.databaseModel.page.captureSync();\n  };\n\n  protected override render() {\n    const progress = this.cell?.value ?? 0;\n    let backgroundColor = progressColors.processing;\n    if (progress === 100) {\n      backgroundColor = progressColors.success;\n    }\n    const fgStyles = styleMap({\n      width: `${progress}%`,\n      backgroundColor,\n    });\n    const bgStyles = styleMap({\n      backgroundColor:\n        progress === 0 ? progressColors.empty : 'var(--affine-hover-color)',\n    });\n\n    return html`<div\n      class=\"affine-database-progress\"\n      @mousedown=${(e: Event) => e.preventDefault()}\n    >\n      <div class=\"affine-database-progress-bar\">\n        <div class=\"affine-database-progress-bg\" style=${bgStyles}>\n          <div class=\"affine-database-progress-fg\" style=${fgStyles}></div>\n          <div class=\"affine-database-progress-drag-handle\"></div>\n        </div>\n      </div>\n      <div class=\"progress-number progress\">${progress}</div>\n    </div>`;\n  }\n}\n\nexport const ProgressColumnRenderer = defineColumnRenderer(\n  'progress',\n  () => ({}),\n  () => 0,\n  {\n    Cell: ProgressCellEditing,\n    CellEditing: null,\n  },\n  {\n    displayName: 'Progress',\n  }\n);\n", "import { assertExists } from '@blocksuite/global/utils';\nimport type { Y } from '@blocksuite/store';\nimport { Text } from '@blocksuite/store';\nimport { VEditor } from '@blocksuite/virgo';\nimport { css } from 'lit';\nimport { customElement, query } from 'lit/decorators.js';\nimport { html, literal } from 'lit/static-html.js';\n\nimport type {\n  AffineTextAttributes,\n  AffineVEditor,\n} from '../../../../__internal__/rich-text/virgo/types.js';\nimport { activeEditorManager } from '../../../../__internal__/utils/active-editor-manager.js';\nimport { setupVirgoScroll } from '../../../../__internal__/utils/virgo.js';\nimport {\n  DatabaseCellElement,\n  defineColumnRenderer,\n  type TableViewCell,\n} from '../../register.js';\n\nfunction toggleStyle(\n  vEditor: AffineVEditor,\n  attrs: AffineTextAttributes\n): void {\n  const vRange = vEditor.getVRange();\n  if (!vRange) {\n    return;\n  }\n\n  const root = vEditor.rootElement;\n  if (!root) {\n    return;\n  }\n\n  const deltas = vEditor.getDeltasByVRange(vRange);\n  let oldAttributes: AffineTextAttributes = {};\n\n  for (const [delta] of deltas) {\n    const attributes = delta.attributes;\n\n    if (!attributes) {\n      continue;\n    }\n\n    oldAttributes = { ...attributes };\n  }\n\n  const newAttributes = Object.fromEntries(\n    Object.entries(attrs).map(([k, v]) => {\n      if (\n        typeof v === 'boolean' &&\n        v === (oldAttributes as { [k: string]: unknown })[k]\n      ) {\n        return [k, !v];\n      } else {\n        return [k, v];\n      }\n    })\n  );\n\n  vEditor.formatText(vRange, newAttributes, {\n    mode: 'merge',\n  });\n  root.blur();\n\n  vEditor.syncVRange();\n}\n\n@customElement('affine-database-rich-text-cell')\nexport class TextCell\n  extends DatabaseCellElement<Y.Text>\n  implements TableViewCell\n{\n  static override styles = css`\n    affine-database-rich-text-cell {\n      display: flex;\n      align-items: center;\n      width: 100%;\n      height: 100%;\n      cursor: text;\n    }\n\n    .affine-database-rich-text {\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      width: 100%;\n      height: 100%;\n      outline: none;\n    }\n    .affine-database-rich-text v-line {\n      display: flex !important;\n      align-items: center;\n      height: 100%;\n      width: 100%;\n    }\n    .affine-database-rich-text v-line > div {\n      flex-grow: 1;\n    }\n  `;\n\n  vEditor: AffineVEditor | null = null;\n  static override tag = literal`affine-database-rich-text-cell`;\n  cellType = 'rich-text' as const;\n\n  @query('.affine-database-rich-text')\n  private _container!: HTMLDivElement;\n\n  private get readonly() {\n    return this.databaseModel.page.readonly;\n  }\n\n  protected override firstUpdated() {\n    this._onInitVEditor();\n    this._disposables.addFromEvent(this, 'click', this._handleClick);\n  }\n\n  private _handleClick() {\n    this.databaseModel.page.captureSync();\n  }\n\n  private _initYText = (text?: string) => {\n    const yText = new this.databaseModel.page.YText(text);\n    this.databaseModel.updateCell(this.rowModel.id, {\n      columnId: this.column.id,\n      value: yText,\n    });\n    return yText;\n  };\n\n  private _onInitVEditor() {\n    let value: Y.Text;\n    if (!this.cell?.value) {\n      value = this._initYText();\n    } else {\n      // When copying the database, the type of the value is `string`.s\n      if (typeof this.cell.value === 'string') {\n        value = this._initYText(this.cell.value);\n      } else {\n        value = this.cell.value;\n      }\n    }\n\n    this.vEditor = new VEditor(value, {\n      active: () => activeEditorManager.isActive(this),\n    });\n    setupVirgoScroll(this.databaseModel.page, this.vEditor);\n    this.vEditor.mount(this._container);\n    this.vEditor.bindHandlers({\n      keydown: this._handleKeyDown,\n    });\n    this.vEditor.setReadonly(this.readonly);\n  }\n\n  private _handleKeyDown = (event: KeyboardEvent) => {\n    if (event.key !== 'Escape') {\n      if (event.key === 'Tab') {\n        event.preventDefault();\n        return;\n      }\n      event.stopPropagation();\n    }\n\n    if (!this.vEditor) return;\n    if (event.key === 'Enter') {\n      if (event.shiftKey) {\n        // soft enter\n        this._onSoftEnter();\n      } else {\n        // exit editing\n        this.rowHost.setEditing(false);\n        this._container.blur();\n      }\n      event.preventDefault();\n      return;\n    }\n\n    const vEditor = this.vEditor;\n\n    switch (event.key) {\n      // bold ctrl+b\n      case 'B':\n      case 'b':\n        if (event.metaKey || event.ctrlKey) {\n          event.preventDefault();\n          toggleStyle(this.vEditor, { bold: true });\n        }\n        break;\n      // italic ctrl+i\n      case 'I':\n      case 'i':\n        if (event.metaKey || event.ctrlKey) {\n          event.preventDefault();\n          toggleStyle(this.vEditor, { italic: true });\n        }\n        break;\n      // underline ctrl+u\n      case 'U':\n      case 'u':\n        if (event.metaKey || event.ctrlKey) {\n          event.preventDefault();\n          toggleStyle(this.vEditor, { underline: true });\n        }\n        break;\n      // strikethrough ctrl+shift+s\n      case 'S':\n      case 's':\n        if ((event.metaKey || event.ctrlKey) && event.shiftKey) {\n          event.preventDefault();\n          toggleStyle(vEditor, { strike: true });\n        }\n        break;\n      // inline code ctrl+shift+e\n      case 'E':\n      case 'e':\n        if ((event.metaKey || event.ctrlKey) && event.shiftKey) {\n          event.preventDefault();\n          toggleStyle(vEditor, { code: true });\n        }\n        break;\n      default:\n        break;\n    }\n  };\n\n  private _onSoftEnter = () => {\n    if (this.cell && this.vEditor) {\n      const vRange = this.vEditor.getVRange();\n      assertExists(vRange);\n\n      const page = this.databaseModel.page;\n      page.captureSync();\n      const text = new Text(this.vEditor.yText);\n      text.replace(vRange.index, length, '\\n');\n      this.vEditor.setVRange({\n        index: vRange.index + 1,\n        length: 0,\n      });\n    }\n  };\n\n  override render() {\n    return html`<div class=\"affine-database-rich-text virgo-editor\"></div>`;\n  }\n}\n\nexport const RichTextColumnRenderer = defineColumnRenderer(\n  'rich-text',\n  () => ({}),\n  page => new page.YText(''),\n  {\n    Cell: TextCell,\n    CellEditing: null,\n  },\n  {\n    displayName: 'Rich Text',\n  }\n);\n", "import { ShadowlessElement, WithDisposable } from '@blocksuite/lit';\nimport { css, html } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { setupVirgoScroll } from '../../../../../__internal__/utils/virgo.js';\nimport { VirgoInput } from '../../../../../components/virgo-input/virgo-input.js';\nimport type { DatabaseBlockModel } from '../../../../database-model.js';\nimport { SELECT_TAG_NAME_MAX_LENGTH } from '../../../consts.js';\nimport type { SelectTag } from '../../../types.js';\n\n@customElement('affine-database-select-option')\nexport class SelectOption extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    affine-database-select-option {\n      display: flex;\n      align-items: center;\n    }\n    .select-option-text {\n      display: inline-block;\n      min-width: 22px;\n      height: 100%;\n      max-width: 100%;\n      padding: 2px 10px;\n      border-radius: 4px;\n      background: var(--affine-tag-pink);\n      overflow: hidden;\n      cursor: text;\n    }\n    .select-option-text:focus {\n      outline: none;\n    }\n\n    .select-option-text [data-virgo-text='true'] {\n      display: block;\n      white-space: nowrap !important;\n      text-overflow: ellipsis;\n      overflow: hidden;\n    }\n  `;\n\n  @property()\n  databaseModel!: DatabaseBlockModel;\n\n  @property()\n  select!: SelectTag;\n\n  @property()\n  editing!: boolean;\n\n  @property()\n  index!: number;\n\n  @property()\n  saveSelectionName!: (index: number) => void;\n\n  @property()\n  setEditingIndex!: (index: number) => void;\n\n  @query('.select-option-text')\n  private _container!: HTMLDivElement;\n\n  private _vInput!: VirgoInput;\n  private get _vEditor() {\n    return this._vInput.vEditor;\n  }\n\n  override updated(changedProperties: Map<string, unknown>) {\n    super.updated(changedProperties);\n    if (changedProperties.has('editing')) {\n      if (this.editing) {\n        this._vEditor.focusEnd();\n      }\n      this._vEditor.setReadonly(!this.editing);\n      this._vEditor.setText(this.select.value);\n    }\n\n    if (changedProperties.has('select')) {\n      this._vEditor.setText(this.select.value);\n    }\n  }\n\n  getSelectionValue() {\n    return this._vEditor.yText.toString();\n  }\n\n  private _onInitVEditor() {\n    this._vInput = new VirgoInput({\n      yText: this.select.value,\n      rootElement: this._container,\n      maxLength: SELECT_TAG_NAME_MAX_LENGTH,\n    });\n    setupVirgoScroll(this.databaseModel.page, this._vEditor);\n    // When editing the current select, other sibling selects should not be edited\n    this._vEditor.setReadonly(!this.editing);\n    this._container.addEventListener('keydown', event => {\n      if (event.key === 'Enter') {\n        event.preventDefault();\n        if (this._vInput.value.length > 0) {\n          this.saveSelectionName(this.index);\n        }\n      }\n      if (event.key === 'Escape') {\n        event.stopPropagation();\n        event.preventDefault();\n\n        this.setEditingIndex(-1);\n        this._container.blur();\n      }\n    });\n  }\n\n  override firstUpdated() {\n    this._disposables.addFromEvent(\n      this._container,\n      'focus',\n      this._onOptionFocus\n    );\n    this._disposables.addFromEvent(this._container, 'blur', this._onOptionBlur);\n\n    this._onInitVEditor();\n  }\n\n  private _onOptionFocus = () => {\n    this._container.classList.remove('ellipsis');\n  };\n\n  private _onOptionBlur = () => {\n    this._container.classList.add('ellipsis');\n  };\n\n  override render() {\n    const style = styleMap({\n      backgroundColor: this.select.color,\n      cursor: this.editing ? 'text' : 'pointer',\n    });\n    return html`<div\n      class=\"select-option-text virgo-editor\"\n      style=${style}\n    ></div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-database-select-option': SelectOption;\n  }\n}\n", "import { WithDisposable } from '@blocksuite/lit';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { DatabaseTableViewCellSelect } from '../../../../std.js';\nimport { getCellSelectionRectByCoords, getRowsContainer } from './utils.js';\n\ntype SelectionState = Pick<\n  DatabaseTableViewCellSelect,\n  'databaseId' | 'coords'\n>;\n\n@customElement('database-cell-level-selection')\nexport class CellLevelSelection extends WithDisposable(LitElement) {\n  static override styles = css`\n    .database-cell-level-selection {\n      position: absolute;\n      width: 100%;\n      z-index: 1;\n      box-sizing: border-box;\n      border: 2px solid var(--affine-primary-color);\n      border-radius: 2px;\n      background: var(--affine-primary-color-04);\n    }\n  `;\n\n  @property()\n  cell!: HTMLElement;\n\n  @state()\n  state: SelectionState | null = null;\n\n  setSelection = (state: SelectionState) => {\n    this.state = state;\n  };\n\n  clearSelection = () => {\n    this.state = null;\n  };\n\n  private get _zoom() {\n    const edgelessPageBlock = document.querySelector('affine-edgeless-page');\n    if (!edgelessPageBlock) return 1;\n    return edgelessPageBlock.surface.viewport.zoom;\n  }\n\n  private _getStyles = () => {\n    if (this.state === null) {\n      // Hide selection.\n      return styleMap({\n        left: 0,\n        top: 0,\n        height: 0,\n        width: 0,\n        display: 'none',\n      });\n    }\n\n    const { databaseId, coords } = this.state;\n    const { left, top, width, height } = getCellSelectionRectByCoords(\n      coords,\n      databaseId\n    );\n    const rowsContainer = getRowsContainer(databaseId);\n    const containerRect = rowsContainer.getBoundingClientRect();\n\n    const scale = 1 / this._zoom;\n    const scaledLeft = (left - containerRect.left) * scale;\n    const scaledTop = (top - containerRect.top) * scale;\n    const scaledWidth = width * scale;\n    const scaledHeight = height * scale;\n\n    return styleMap({\n      left: `${scaledLeft}px`,\n      top: `${scaledTop}px`,\n      height: `${scaledHeight}px`,\n      width: `${scaledWidth}px`,\n      display: 'block',\n    });\n  };\n\n  override render() {\n    const styles = this._getStyles();\n    return html`<div\n      class=\"database-cell-level-selection\"\n      style=${styles}\n    ></div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'database-cell-level-selection': CellLevelSelection;\n  }\n}\n", "import { WithDisposable } from '@blocksuite/lit';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { DatabaseTableViewRowSelect } from '../../../../std.js';\n\ntype SelectionState = Pick<DatabaseTableViewRowSelect, 'databaseId' | 'rowIds'>;\n\n@customElement('database-row-level-selection')\nexport class RowLevelSelection extends WithDisposable(LitElement) {\n  static override styles = css`\n    .database-row-level-selection {\n      position: absolute;\n      z-index: 1;\n      box-sizing: border-box;\n      width: 100%;\n      border: 2px solid var(--affine-primary-color);\n      border-radius: 2px;\n      background: var(--affine-primary-color-04);\n    }\n  `;\n\n  @property()\n  container!: HTMLElement;\n\n  @state()\n  state: SelectionState | null = null;\n\n  setSelection = ({ databaseId, rowIds }: SelectionState) => {\n    this.state = {\n      databaseId,\n      rowIds,\n    };\n  };\n\n  clearSelection = () => {\n    this.state = null;\n  };\n\n  private get _zoom() {\n    const edgelessPageBlock = document.querySelector('affine-edgeless-page');\n    if (!edgelessPageBlock) return 1;\n    return edgelessPageBlock.surface.viewport.zoom;\n  }\n\n  private _getStyles = () => {\n    const hideStyles = styleMap({\n      left: 0,\n      top: 0,\n      height: 0,\n      display: 'none',\n    });\n    if (!this.state) return hideStyles;\n\n    const { rowIds } = this.state;\n    const { startRow, endRow } = getRowsByIds(this.container, {\n      startRowId: rowIds[0],\n      endRowId: rowIds[rowIds.length - 1],\n    });\n\n    if (!startRow || !endRow) return hideStyles;\n\n    const containerPos = this.container.getBoundingClientRect();\n    const { left, top } = startRow.getBoundingClientRect();\n\n    const scale = 1 / this._zoom;\n    const scaledHeight = calcSelectionHeight(this.container, rowIds) * scale;\n    const scaledLeft = (left - containerPos.left) * scale;\n    const scaledTop = (top - containerPos.top) * scale;\n    const styles = styleMap({\n      left: `${scaledLeft}px`,\n      top: `${scaledTop}px`,\n      height: `${scaledHeight}px`,\n    });\n\n    return styles;\n  };\n\n  override render() {\n    const styles = this._getStyles();\n    return html`<div\n      class=\"database-row-level-selection\"\n      style=${styles}\n    ></div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'database-row-level-selection': RowLevelSelection;\n  }\n}\n\nfunction getRowsByIds(\n  container: Element,\n  { startRowId, endRowId }: { startRowId: string; endRowId: string }\n) {\n  const startRow = container.querySelector(\n    `.database-row[data-row-id=\"${startRowId}\"]`\n  );\n  const endRow = container.querySelector(\n    `.database-row[data-row-id=\"${endRowId}\"]`\n  );\n\n  return {\n    startRow,\n    endRow,\n  };\n}\n\nfunction calcSelectionHeight(container: Element, rowIds: string[]) {\n  return rowIds.reduce((acc, rowId) => {\n    const row = container.querySelector(\n      `.database-row[data-row-id=\"${rowId}\"]`\n    );\n    if (!row) {\n      return acc;\n    }\n    const { height } = row.getBoundingClientRect();\n    return acc + height;\n  }, 0);\n}\n", "import { assertExists } from '@blocksuite/store';\n\nimport type { CellCoord } from '../../../../std.js';\nimport type { TableViewCell } from '../../register.js';\nimport type { NumberCellEditing } from '../column-type/number.js';\nimport type { TextCell } from '../column-type/rich-text.js';\nimport { CellLevelSelection } from './cell-selection.js';\nimport { RowLevelSelection } from './row-selection.js';\n\ntype CellRects = {\n  left: number;\n  top: number;\n  height: number;\n  width: number;\n  cell: HTMLElement;\n}[][];\n\nexport function clearAllDatabaseRowsSelection() {\n  const databases = document.querySelectorAll('affine-database');\n  databases.forEach(database => {\n    const rowLevelSelection = database.querySelector(\n      'database-row-level-selection'\n    );\n    rowLevelSelection?.clearSelection();\n  });\n}\n\nexport function setDatabaseRowsSelection(databaseId: string, rowIds: string[]) {\n  const container = getRowsContainer(databaseId);\n\n  let rowLevelSelection = container.querySelector(\n    'database-row-level-selection'\n  );\n  if (!rowLevelSelection) {\n    rowLevelSelection = new RowLevelSelection();\n    container.appendChild(rowLevelSelection);\n  }\n\n  rowLevelSelection.container = container;\n  rowLevelSelection.setSelection({\n    databaseId,\n    rowIds,\n  });\n}\n\nexport function setDatabaseCellSelection(\n  databaseId: string,\n  coords: [CellCoord]\n) {\n  const container = getRowsContainer(databaseId);\n  const cellLevelSelection = getCellLevelSelection(container);\n  cellLevelSelection.setSelection({\n    databaseId,\n    coords,\n  });\n\n  const currentCell = getCellElementByCoord(coords[0], databaseId);\n  currentCell.scrollIntoView({ block: 'nearest' });\n}\n\nexport function clearAllDatabaseCellSelection() {\n  const databases = document.querySelectorAll('affine-database');\n  databases.forEach(database => {\n    const cellLevelSelection = database.querySelector(\n      'database-cell-level-selection'\n    );\n    cellLevelSelection?.clearSelection();\n  });\n}\n\nexport function setDatabaseCellEditing(databaseId: string, coord: CellCoord) {\n  const currentCell = getCellElementByCoord(coord, databaseId);\n  const cell = currentCell.firstElementChild\n    ?.firstElementChild as TableViewCell;\n  assertExists(cell);\n\n  let shouldClearCellSelection = true;\n  const richText = cell?.querySelector('rich-text');\n  if (richText) {\n    // title column\n    richText.vEditor?.focusEnd();\n  } else if (cell.cellType === 'number') {\n    const richTextCell = cell as NumberCellEditing;\n    richTextCell.vEditor?.focusEnd();\n  } else if (cell.cellType === 'rich-text') {\n    const richTextCell = cell as TextCell;\n    richTextCell.vEditor?.focusEnd();\n  } else {\n    // checkbox column\n    if (cell.cellType === 'checkbox') {\n      shouldClearCellSelection = false;\n    }\n    cell.click();\n  }\n\n  if (shouldClearCellSelection) {\n    clearDatabaseCellSelectionByDatabaseId(databaseId);\n  }\n}\n\nexport function getCellCoord(\n  target: CellCoord | HTMLElement,\n  databaseId: string,\n  key: string\n) {\n  const rowsContainer = getRowsContainer(databaseId);\n  const cellRects = getAllCellsRect(rowsContainer);\n\n  const rowsCount = cellRects.length;\n  const cellsCount = cellRects[0].length;\n  let cellCoord: CellCoord | null = null;\n  if (target instanceof Element) {\n    cellCoord = getCellCoordByElement(target, databaseId);\n    assertExists(cellCoord);\n  } else {\n    cellCoord = target;\n  }\n\n  const nextCellCoord = getNextCellCoord(key, cellCoord, rowsCount, cellsCount);\n  return nextCellCoord;\n}\n\nexport function getCellSelectionRectByCoords(\n  coords: [CellCoord],\n  databaseId: string\n) {\n  const rowsContainer = getRowsContainer(databaseId);\n  const cellRects = getAllCellsRect(rowsContainer);\n\n  // Currently only supports single cell selection.\n  const [start] = coords;\n  const cell = cellRects[start.rowIndex][start.cellIndex];\n  return {\n    left: cell.left,\n    top: cell.top,\n    width: cell.width,\n    height: cell.height,\n  };\n}\n\nexport function getRowsContainer(databaseId: string) {\n  const database = getDatabaseById(databaseId);\n  const container = database.querySelector<HTMLElement>(\n    '.affine-database-table-container'\n  );\n  assertExists(container);\n  return container;\n}\n\nexport function getDatabaseById(id: string) {\n  const database = document.querySelector<HTMLElement>(\n    `affine-database[data-block-id=\"${id}\"]`\n  );\n  assertExists(database);\n  return database;\n}\n\nfunction getCellCoordByElement(cell: HTMLElement, databaseId: string) {\n  const rowsContainer = getRowsContainer(databaseId);\n  const cellRects = getAllCellsRect(rowsContainer);\n  for (let i = 0; i < cellRects.length; i++) {\n    const row = cellRects[i];\n    for (let j = 0; j < row.length; j++) {\n      if (row[j].cell === cell) {\n        return {\n          rowIndex: i,\n          cellIndex: j,\n        };\n      }\n    }\n  }\n  return null;\n}\n\nfunction getCellElementByCoord(coord: CellCoord, databaseId: string) {\n  const rowsContainer = getRowsContainer(databaseId);\n  const cellRects = getAllCellsRect(rowsContainer);\n  const { rowIndex, cellIndex } = coord;\n  const cell = cellRects[rowIndex][cellIndex].cell;\n  return cell;\n}\n\nfunction getAllCellsRect(rowsContainer: Element) {\n  // [ [{ left, top, height, cell }] ]\n  const cellRects: CellRects = [];\n  const allRows = rowsContainer.querySelectorAll('.affine-database-block-row');\n  allRows.forEach((row, rowIndex) => {\n    const allCells = row.querySelectorAll<HTMLElement>('.database-cell');\n    allCells.forEach((cell, cellIndex) => {\n      // skip the last cell which is \"+\"\n      if (cell.classList.contains('add-column-button')) return;\n      const { left, top, height, width } = cell.getBoundingClientRect();\n      cellRects[rowIndex] = cellRects[rowIndex] ?? [];\n      cellRects[rowIndex][cellIndex] = { left, top, height, width, cell };\n    });\n  });\n\n  return cellRects;\n}\n\nfunction getNextCellCoord(\n  key: string,\n  currentCellCoord: CellCoord,\n  rowsCount: number,\n  cellsCount: number\n) {\n  switch (key) {\n    case 'Escape':\n      return getNextCellCoordByEscape(currentCellCoord);\n    case 'Tab':\n    case 'ArrowRight':\n      return getNextCellCoordByTab(currentCellCoord, rowsCount, cellsCount);\n    case 'ArrowUp':\n      return getNextCellCoordByArrowUp(currentCellCoord);\n    case 'ArrowDown':\n      return getNextCellCoordByArrowDown(currentCellCoord, rowsCount);\n    case 'ArrowLeft':\n      return getNextCellCoordByArrowLeft(currentCellCoord, cellsCount);\n  }\n\n  return currentCellCoord;\n}\n\nfunction getNextCellCoordByTab(\n  currentCellCoord: CellCoord,\n  rowsCount: number,\n  cellsCount: number\n) {\n  const nextCellPos = { rowIndex: 0, cellIndex: 0 };\n  if (currentCellCoord.cellIndex !== cellsCount - 1) {\n    // not last cell\n    nextCellPos.rowIndex = currentCellCoord.rowIndex;\n    nextCellPos.cellIndex = currentCellCoord.cellIndex + 1;\n    return nextCellPos;\n  }\n  // last cell\n  if (currentCellCoord.rowIndex !== rowsCount - 1) {\n    // not last row\n    nextCellPos.rowIndex = currentCellCoord.rowIndex + 1;\n    nextCellPos.cellIndex = 0;\n    return nextCellPos;\n  }\n  return currentCellCoord;\n}\n\nfunction getNextCellCoordByArrowLeft(\n  currentCellCoord: CellCoord,\n  cellsCount: number\n) {\n  const nextCellPos = { rowIndex: 0, cellIndex: 0 };\n  if (currentCellCoord.cellIndex !== 0) {\n    // not first cell\n    nextCellPos.rowIndex = currentCellCoord.rowIndex;\n    nextCellPos.cellIndex = currentCellCoord.cellIndex - 1;\n    return nextCellPos;\n  }\n  // first cell\n  if (currentCellCoord.rowIndex !== 0) {\n    // not first row\n    nextCellPos.rowIndex = currentCellCoord.rowIndex - 1;\n    nextCellPos.cellIndex = cellsCount - 1;\n    return nextCellPos;\n  }\n  return currentCellCoord;\n}\n\nfunction getNextCellCoordByArrowUp(currentCellCoord: CellCoord) {\n  const nextCellPos = { rowIndex: 0, cellIndex: 0 };\n  if (currentCellCoord.rowIndex !== 0) {\n    // not first cell\n    nextCellPos.rowIndex = currentCellCoord.rowIndex - 1;\n    nextCellPos.cellIndex = currentCellCoord.cellIndex;\n    return nextCellPos;\n  }\n  return currentCellCoord;\n}\n\nfunction getNextCellCoordByArrowDown(\n  currentCellCoord: CellCoord,\n  rowsCount: number\n) {\n  const nextCellPos = { rowIndex: 0, cellIndex: 0 };\n  if (currentCellCoord.rowIndex + 1 !== rowsCount) {\n    // not first cell\n    nextCellPos.rowIndex = currentCellCoord.rowIndex + 1;\n    nextCellPos.cellIndex = currentCellCoord.cellIndex;\n    return nextCellPos;\n  }\n  return currentCellCoord;\n}\n\nfunction getNextCellCoordByEscape(currentCellCoord: CellCoord) {\n  return currentCellCoord;\n}\n\nfunction getCellLevelSelection(container: Element) {\n  let cellLevelSelection = container.querySelector(\n    'database-cell-level-selection'\n  );\n  if (!cellLevelSelection) {\n    cellLevelSelection = new CellLevelSelection();\n    container.appendChild(cellLevelSelection);\n  }\n\n  return cellLevelSelection;\n}\n\nfunction clearDatabaseCellSelectionByDatabaseId(databaseId: string) {\n  const container = getRowsContainer(databaseId);\n  const cellLevelSelection = container.querySelector(\n    'database-cell-level-selection'\n  );\n  cellLevelSelection?.clearSelection();\n}\n", "import type {\n  EventName,\n  UIEventDispatcher,\n  UIEventHandler,\n  UIEventStateContext,\n} from '@blocksuite/lit';\nimport { DisposableGroup } from '@blocksuite/store';\n\nimport { getService } from '../../../__internal__/service.js';\nimport { resetNativeSelection } from '../../../std.js';\nimport type { DatabaseBlockModel } from '../../database-model.js';\nimport type { DatabaseBlockService } from '../../database-service.js';\nimport { getCellCoord } from '../components/selection/utils.js';\n\nconst CELL_SELECTION_MOVE_KEYS = [\n  'Tab',\n  'Enter',\n  'ArrowUp',\n  'ArrowDown',\n  'ArrowLeft',\n  'ArrowRight',\n];\n\nconst CELL_SELECTION_ENTER_KEYS = ['Tab', 'Escape'];\nexport type CellSelectionEnterKeys = 'Tab' | 'Escape';\n\nexport class CellSelectionManager {\n  private readonly _dispatcher: UIEventDispatcher;\n  private readonly _disposables = new DisposableGroup();\n  private readonly _model!: DatabaseBlockModel;\n\n  private _service: DatabaseBlockService | null = null;\n\n  constructor(dispatcher: UIEventDispatcher, model: DatabaseBlockModel) {\n    this._dispatcher = dispatcher;\n    this._model = model;\n    this._service = getService('affine:database');\n\n    this._add('click', this._onClick);\n    this._add('keyDown', this._onCellSelectionMove);\n  }\n\n  private _onClick = (ctx: UIEventStateContext) => {\n    this._service?.clearCellLevelSelection();\n  };\n\n  private _onCellSelectionMove = (ctx: UIEventStateContext) => {\n    const e = ctx.get('keyboardState');\n    const event = e.raw;\n    if (CELL_SELECTION_MOVE_KEYS.indexOf(event.key) <= -1) return;\n\n    const service = getService('affine:database');\n    const cellSelection = service.getLastCellSelection();\n    if (!cellSelection) return;\n    event.preventDefault();\n\n    const { databaseId, coords } = cellSelection;\n    if (event.key === 'Enter') {\n      // enter editing state\n      service.setCellSelection({\n        type: 'edit',\n        coords,\n        databaseId,\n      });\n    } else {\n      // set cell selection\n      const nextCoord = getCellCoord(coords[0], databaseId, event.key);\n      service.setCellSelection({\n        type: 'select',\n        coords: [nextCoord],\n        databaseId,\n      });\n    }\n\n    return true;\n  };\n\n  private _add = (name: EventName, fn: UIEventHandler) => {\n    this._disposables.add(this._dispatcher.add(name, fn));\n  };\n\n  onCellSelectionChange = (event: KeyboardEvent) => {\n    if (!isValidKey(event.key)) return;\n    event.preventDefault();\n    event.stopPropagation();\n\n    const element = event.target as HTMLElement;\n    selectCellByElement(element, this._model.id, event.key);\n  };\n\n  dispose() {\n    this._disposables.dispose();\n  }\n}\n\nfunction isValidKey(key: string): key is CellSelectionEnterKeys {\n  return CELL_SELECTION_ENTER_KEYS.indexOf(key) > -1;\n}\n\nexport function selectCellByElement(\n  element: Element,\n  databaseId: string,\n  key: CellSelectionEnterKeys\n) {\n  const rowsContainer = element.closest('.affine-database-block-rows');\n  const currentCell = element.closest<HTMLElement>('.database-cell');\n  if (!rowsContainer) return;\n  if (!currentCell) return;\n\n  const editor = currentCell.querySelector<HTMLElement>('.virgo-editor');\n  editor?.blur();\n  resetNativeSelection(null);\n\n  const nextCoord = getCellCoord(currentCell, databaseId, key);\n\n  const service = getService('affine:database');\n  // TODO\n  // Maybe we can no longer trigger the cell selection logic after selecting the row selection.\n  const hasRowSelection = service.getLastRowSelection() !== null;\n  if (hasRowSelection) return;\n\n  service.setCellSelection({\n    type: 'select',\n    coords: [nextCoord],\n    databaseId,\n  });\n}\n", "import { DeleteIcon, PenIcon } from '@blocksuite/global/config';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport { isDivider } from '../../../../utils.js';\nimport type { SelectTagAction, SelectTagActionType } from '../../../types.js';\nimport { actionStyles } from '../../edit-column-popup/styles.js';\n\nconst tagActions: SelectTagAction[] = [\n  {\n    type: 'rename',\n    text: 'Rename',\n    icon: PenIcon,\n  },\n  {\n    type: 'divider',\n  },\n  {\n    type: 'delete',\n    text: 'Delete',\n    icon: DeleteIcon,\n  },\n];\n\n@customElement('affine-database-select-action-popup')\nexport class SelectActionPopup extends LitElement {\n  static override styles = css`\n    :host {\n      z-index: 11;\n    }\n    .affine-database-select-action {\n      width: 200px;\n      padding: 8px;\n      border: 1px solid var(--affine-border-color);\n      border-radius: 8px;\n      background: var(--affine-white);\n      box-shadow: var(--affine-menu-shadow);\n    }\n    ${actionStyles}\n    .action {\n      color: var(--affine-text-primary-color);\n    }\n    .action svg {\n      width: 20px;\n      height: 20px;\n    }\n    .rename,\n    .delete {\n      fill: var(--affine-icon-color);\n    }\n  `;\n\n  @property()\n  index!: number;\n\n  @property()\n  onAction!: (type: SelectTagActionType, index: number) => void;\n\n  @property()\n  onClose!: () => void;\n\n  private _onAction = (e: Event, type: SelectTagActionType) => {\n    e.stopPropagation();\n    this.onAction(type, this.index);\n    this.onClose();\n  };\n\n  override render() {\n    return html`\n      <div class=\"affine-database-select-action\">\n        ${tagActions.map(action => {\n          if (isDivider(action))\n            return html`<div class=\"action-divider\"></div>`;\n\n          return html`\n            <div\n              class=\"action ${action.type}\"\n              @mousedown=${(e: Event) => this._onAction(e, action.type)}\n            >\n              <div class=\"action-content\">\n                ${action.icon}<span>${action.text}</span>\n              </div>\n            </div>\n          `;\n        })}\n      </div>\n    `;\n  }\n}\n", "import './select-option.js';\n\nimport {\n  DatabaseDone,\n  DatabaseSearchClose,\n  MoreHorizontalIcon,\n  PlusIcon,\n} from '@blocksuite/global/config';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { nanoid } from '@blocksuite/store';\nimport { createPopper } from '@popperjs/core';\nimport { css } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { styleMap } from 'lit/directives/style-map.js';\nimport { html, literal } from 'lit/static-html.js';\n\nimport { getTagColor, onClickOutside } from '../../../../utils.js';\nimport {\n  SELECT_EDIT_POPUP_WIDTH,\n  SELECT_TAG_NAME_MAX_LENGTH,\n} from '../../../consts.js';\nimport { DatabaseCellElement, type TableViewCell } from '../../../register.js';\nimport {\n  type CellSelectionEnterKeys,\n  selectCellByElement,\n} from '../../../selection-manager/cell.js';\nimport type { SelectTag } from '../../../types.js';\nimport { SelectMode, type SelectTagActionType } from '../../../types.js';\nimport type { SelectOption } from './select-option.js';\nimport { SelectActionPopup } from './select-option-popup.js';\n\nconst KEYS_WHITE_LIST = ['Enter', 'ArrowUp', 'ArrowDown'];\n\nconst styles = css`\n  affine-database-select-cell-editing {\n    z-index: 2;\n    border: 1px solid var(--affine-border-color);\n    border-radius: 8px;\n    background: var(--affine-background-primary-color);\n    box-shadow: var(--affine-shadow-2);\n  }\n  .affine-database-select-cell-select {\n    font-size: var(--affine-font-sm);\n  }\n  .select-input-container {\n    display: flex;\n    align-items: center;\n    flex-wrap: wrap;\n    gap: 6px;\n    min-height: 44px;\n    padding: 10px 8px;\n    background: var(--affine-hover-color);\n  }\n  .select-input {\n    flex: 1 1 0%;\n    height: 24px;\n    border: none;\n    font-family: var(--affine-font-family);\n    color: inherit;\n    background: transparent;\n    line-height: 24px;\n  }\n  .select-input:focus {\n    outline: none;\n  }\n  .select-input::placeholder {\n    color: var(--affine-placeholder-color);\n  }\n  .select-option-container {\n    padding: 8px;\n    color: var(--affine-black-90);\n  }\n  .select-option-container-header {\n    padding: 8px 0px;\n    color: var(--affine-black-60);\n  }\n  .select-input-container .select-selected {\n    display: flex;\n    align-items: center;\n    padding: 2px 10px;\n    gap: 10px;\n    height: 28px;\n    background: var(--affine-tag-white);\n    border-radius: 4px;\n    color: var(--affine-black-90);\n    background: var(--affine-tertiary-color);\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n  }\n  .select-selected-text {\n    width: calc(100% - 16px);\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n  }\n  .select-selected > .close-icon {\n    display: flex;\n    align-items: center;\n  }\n  .select-selected > .close-icon:hover {\n    cursor: pointer;\n  }\n  .select-selected > .close-icon > svg {\n    fill: var(--affine-black-90);\n  }\n  .select-option-new {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    height: 36px;\n    padding: 4px;\n    gap: 5px;\n    border-radius: 4px;\n    background: var(--affine-selected-color);\n  }\n  .select-option-new-text {\n    flex: 1;\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    height: 28px;\n    padding: 2px 10px;\n    border-radius: 4px;\n    background: var(--affine-tag-red);\n  }\n  .select-option-new-icon {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    height: 28px;\n    color: var(--affine-text-primary-color);\n  }\n  .select-option-new-icon svg {\n    width: 16px;\n    height: 16px;\n  }\n  .select-option {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    height: 36px;\n    padding: 4px;\n    border-radius: 4px;\n    margin-bottom: 4px;\n    cursor: pointer;\n  }\n  .select-option.selected,\n  .select-option:hover {\n    background: var(--affine-hover-color);\n  }\n  .select-option:hover .select-option-icon {\n    display: flex;\n  }\n  .select-option-text-container {\n    width: calc(100% - 28px);\n    overflow: hidden;\n  }\n  .select-option-icon {\n    display: none;\n    justify-content: center;\n    align-items: center;\n    width: 28px;\n    height: 28px;\n    border-radius: 3px;\n    cursor: pointer;\n  }\n  .select-option-icon:hover {\n    background: var(--affine-hover-color);\n  }\n  .select-option-icon svg {\n    width: 16px;\n    height: 16px;\n    pointer-events: none;\n  }\n  .editing {\n    background: var(--affine-hover-color);\n  }\n  .editing .select-option-text [data-virgo-text='true'] {\n    display: block;\n    white-space: pre !important;\n    overflow: unset;\n    text-overflow: unset;\n  }\n  .editing .select-option-icon {\n    display: flex;\n    background: var(--affine-hover-background);\n  }\n`;\n\n@customElement('affine-database-select-cell-editing')\nexport class SelectCellEditing\n  extends DatabaseCellElement<SelectTag[]>\n  implements TableViewCell\n{\n  value: SelectTag | undefined = undefined;\n\n  static override styles = styles;\n  static override tag = literal`affine-database-select-cell-editing`;\n  cellType = 'select' as const;\n\n  @property()\n  mode: SelectMode = SelectMode.Single;\n\n  @query('.select-input')\n  private _selectInput!: HTMLInputElement;\n\n  @state()\n  private _inputValue = '';\n\n  @state()\n  private _editingIndex = -1;\n\n  @state()\n  private _selectedOptionIndex = -1;\n\n  @query('.select-option-container')\n  private _selectOptionContainer!: HTMLDivElement;\n  private _selectColor: string | undefined = undefined;\n\n  get isSingleMode() {\n    return this.mode === SelectMode.Single;\n  }\n\n  get selectionList() {\n    return this.column.selection as SelectTag[];\n  }\n\n  protected override firstUpdated() {\n    this.style.width = `${SELECT_EDIT_POPUP_WIDTH}px`;\n    this._selectInput.focus();\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this._disposables.addFromEvent(\n      document.body,\n      'keydown',\n      this._onSelectOption\n    );\n\n    createPopper(\n      {\n        getBoundingClientRect: () => {\n          const rect = this.rowHost.getBoundingClientRect();\n          rect.y = rect.y - rect.height - 2;\n          rect.x = rect.x - 2;\n          return rect;\n        },\n      },\n      this,\n      {\n        placement: 'bottom-start',\n        strategy: 'fixed',\n      }\n    );\n  }\n\n  protected override updated(_changedProperties: Map<PropertyKey, unknown>) {\n    super.updated(_changedProperties);\n\n    if (_changedProperties.has('cell')) {\n      this._selectInput.focus();\n    }\n  }\n\n  private _onSelectOption = (event: KeyboardEvent) => {\n    const key = event.key;\n\n    if (KEYS_WHITE_LIST.indexOf(key) <= -1) return;\n    event.preventDefault();\n    event.stopPropagation();\n\n    const maxIndex = this.selectionList.length - 1;\n    if (this._selectedOptionIndex === maxIndex && key === 'ArrowDown') {\n      this._selectedOptionIndex = 0;\n      return;\n    }\n    if (this._selectedOptionIndex <= 0 && key === 'ArrowUp') {\n      this._selectedOptionIndex = maxIndex;\n      return;\n    }\n\n    if (key === 'ArrowDown') {\n      this._selectedOptionIndex++;\n    } else if (key === 'ArrowUp') {\n      this._selectedOptionIndex--;\n    } else if (key === 'Enter') {\n      const index = this._selectedOptionIndex;\n      if (index === -1) return;\n      if (this.isSingleMode) {\n        this._selectedOptionIndex = -1;\n      }\n\n      const selected = this.cell?.value ?? [];\n      const currentSelection = this.selectionList[index];\n      this._onSelect(selected, currentSelection);\n      const cell =\n        this._selectOptionContainer.closest<HTMLElement>('.database-cell');\n      assertExists(cell);\n      this._selectCell(cell, 'Escape');\n    }\n  };\n\n  private _selectCell = (\n    element: Element,\n    key: CellSelectionEnterKeys,\n    exitEditing = false\n  ) => {\n    if (this.isSingleMode || exitEditing) this.rowHost.setEditing(false);\n    selectCellByElement(element, this.databaseModel.id, key);\n  };\n\n  private _onDeleteSelected = (\n    selectedValue: SelectTag[],\n    value: SelectTag\n  ) => {\n    const filteredValue = selectedValue.filter(item => item !== value);\n    this.rowHost.setValue(filteredValue);\n  };\n\n  private _onSelectSearchInput = (event: KeyboardEvent) => {\n    const value = (event.target as HTMLInputElement).value;\n    this._inputValue = value;\n    if (!this._selectColor) {\n      this._selectColor = getTagColor();\n    }\n  };\n\n  private _onSelectOrAdd = (\n    event: KeyboardEvent,\n    selectedValue: SelectTag[]\n  ) => {\n    const inputValue = this._inputValue.trim();\n\n    if (event.key === 'Backspace' && inputValue === '') {\n      this._onDeleteSelected(\n        selectedValue,\n        selectedValue[selectedValue.length - 1]\n      );\n    } else if (event.key === 'Enter' && inputValue !== '') {\n      if (this._selectedOptionIndex !== -1) return;\n      const selectTag = this.selectionList.find(\n        item => item.value === inputValue\n      );\n      if (selectTag) {\n        this._onSelect(selectedValue, selectTag);\n      } else {\n        this._onAddSelection(selectedValue);\n      }\n    } else if (event.key === 'Escape') {\n      this._selectCell(event.target as Element, 'Escape', true);\n    } else if (event.key === 'Tab') {\n      event.preventDefault();\n      this._selectCell(event.target as Element, 'Tab', true);\n    }\n  };\n\n  private _onSelect = (selectedValue: SelectTag[], select: SelectTag) => {\n    // when editing, do not select\n    if (this._editingIndex !== -1) return;\n\n    const isExist =\n      selectedValue.findIndex(item => item.value === select.value) > -1;\n    if (isExist) return;\n\n    this.value = select;\n    const isSelected = selectedValue.indexOf(this.value) > -1;\n    if (!isSelected) {\n      const newValue = this.isSingleMode\n        ? [this.value]\n        : [...selectedValue, this.value];\n      this.rowHost.setValue(newValue);\n      if (this.isSingleMode) this.rowHost.setEditing(false);\n\n      if (!this.isSingleMode && newValue.length > 1) {\n        this._calcRowHostHeight();\n      }\n    }\n  };\n\n  private _onAddSelection = (selectedValue: SelectTag[]) => {\n    let value = this._inputValue.trim();\n    if (value === '') return;\n    if (value.length > SELECT_TAG_NAME_MAX_LENGTH) {\n      value = value.slice(0, SELECT_TAG_NAME_MAX_LENGTH);\n    }\n\n    const tagColor = this._selectColor ?? getTagColor();\n    this._selectColor = undefined;\n    const newSelect = { id: nanoid(), value, color: tagColor };\n\n    this.rowHost.updateColumnProperty(property => {\n      const selection = property.selection as SelectTag[];\n      return {\n        ...property,\n        selection:\n          selection.findIndex(select => select.value === value) === -1\n            ? [...selection, newSelect]\n            : selection,\n      };\n    });\n\n    const newValue = this.isSingleMode\n      ? [newSelect]\n      : [...selectedValue, newSelect];\n    this.rowHost.setValue(newValue);\n    this.rowHost.setEditing(false);\n\n    if (!this.isSingleMode && newValue.length > 1) {\n      this._calcRowHostHeight();\n    }\n  };\n\n  private _calcRowHostHeight = () => {\n    setTimeout(() => {\n      const shadowRoot =\n        this.rowHost.shadowRoot?.children[0].shadowRoot?.children[0].shadowRoot;\n      const selectCell = shadowRoot?.querySelector(\n        '.affine-database-select-cell-container'\n      );\n      if (selectCell) {\n        const { height } = selectCell.getBoundingClientRect();\n        this.rowHost.setHeight(height);\n      }\n    });\n  };\n\n  private _onSelectAction = (type: SelectTagActionType, index: number) => {\n    if (type === 'rename') {\n      this._setEditingIndex(index);\n      return;\n    }\n\n    if (type === 'delete') {\n      this.databaseModel.updateColumn({\n        ...this.column,\n        selection: this.selectionList.filter((_, i) => i !== index),\n      });\n      const select = this.selectionList[index];\n      this.databaseModel.deleteSelectedCellTag(this.column.id, select);\n      return;\n    }\n  };\n\n  private _showSelectAction = (index: number) => {\n    const selectOption = this.querySelectorAll('.select-option').item(index);\n    assertExists(selectOption);\n\n    const action = new SelectActionPopup();\n    action.onAction = this._onSelectAction;\n    action.index = index;\n    selectOption.appendChild(action);\n    const onClose = () => action.remove();\n    action.onClose = onClose;\n\n    createPopper(\n      {\n        getBoundingClientRect: () => {\n          const optionIcon = selectOption.querySelector('.select-option-icon');\n          assertExists(optionIcon);\n          const { height } = action.getBoundingClientRect();\n          const rect = optionIcon.getBoundingClientRect();\n          rect.y = rect.y + height + 36;\n          rect.x = rect.x + 33;\n          return rect;\n        },\n      },\n      action,\n      {\n        placement: 'bottom-end',\n      }\n    );\n    onClickOutside(selectOption as HTMLElement, onClose, 'mousedown');\n  };\n\n  private _onSaveSelectionName = (index: number) => {\n    const selectOption = this._selectOptionContainer\n      .querySelectorAll('affine-database-select-option')\n      .item(index) as SelectOption;\n\n    const selection = [...this.selectionList];\n    const value = selectOption.getSelectionValue();\n    const isExist =\n      selection.findIndex(\n        (select, i) => i !== index && select.value === value\n      ) > -1;\n    if (isExist) return;\n\n    const oldSelect = selection[index];\n    const newSelect = { ...oldSelect, value };\n    selection[index] = newSelect;\n    this.databaseModel.updateColumn({\n      ...this.column,\n      selection,\n    });\n    this.databaseModel.renameSelectedCellTag(\n      this.column.id,\n      oldSelect,\n      newSelect\n    );\n\n    this._setEditingIndex(-1);\n  };\n\n  private _setEditingIndex = (index: number) => {\n    this._editingIndex = index;\n  };\n\n  override render() {\n    const filteredSelection = this.selectionList.filter(item => {\n      if (!this._inputValue) {\n        return true;\n      }\n      return (\n        item.value\n          .toLocaleLowerCase()\n          .indexOf(this._inputValue.toLocaleLowerCase()) > -1\n      );\n    });\n\n    const selectedTag = this.cell?.value ?? [];\n    const showCreateTip =\n      this._inputValue &&\n      filteredSelection.findIndex(item => item.value === this._inputValue) ===\n        -1;\n    const selectCreateTip = showCreateTip\n      ? html`<div class=\"select-option-new\" @click=${this._onAddSelection}>\n          <div class=\"select-option-new-icon\">Create ${PlusIcon}</div>\n          <span\n            class=\"select-option-new-text\"\n            style=${styleMap({ backgroundColor: this._selectColor })}\n            >${this._inputValue}</span\n          >\n        </div>`\n      : null;\n\n    return html`\n      <div class=\"affine-database-select-cell-select\">\n        <div class=\"select-input-container\">\n          ${selectedTag.map(item => {\n            const style = styleMap({\n              backgroundColor: item.color,\n            });\n            return html`<div class=\"select-selected\" style=${style}>\n              <div class=\"select-selected-text\">${item.value}</div>\n              <span\n                class=\"close-icon\"\n                @click=${() => this._onDeleteSelected(selectedTag, item)}\n                >${DatabaseSearchClose}</span\n              >\n            </div>`;\n          })}\n          <input\n            class=\"select-input\"\n            placeholder=\"Type here...\"\n            maxlength=${SELECT_TAG_NAME_MAX_LENGTH}\n            @input=${this._onSelectSearchInput}\n            @keydown=${(event: KeyboardEvent) =>\n              this._onSelectOrAdd(event, selectedTag)}\n          />\n        </div>\n        <div class=\"select-option-container\">\n          <div class=\"select-option-container-header\">\n            Select tag or create one\n          </div>\n          ${selectCreateTip}\n          ${repeat(\n            filteredSelection,\n            select => select.id,\n            (select, index) => {\n              const isEditing = index === this._editingIndex;\n              const isSelected = index === this._selectedOptionIndex;\n              const onOptionIconClick = isEditing\n                ? () => this._onSaveSelectionName(index)\n                : () => this._showSelectAction(index);\n\n              const classes = classMap({\n                'select-option': true,\n                selected: isSelected,\n                editing: isEditing,\n              });\n              return html`\n                <div class=\"${classes}\">\n                  <div\n                    class=\"select-option-text-container\"\n                    @click=${() => this._onSelect(selectedTag, select)}\n                  >\n                    <affine-database-select-option\n                      style=${styleMap({\n                        cursor: isEditing ? 'text' : 'pointer',\n                      })}\n                      .databaseModel=${this.databaseModel}\n                      .select=${select}\n                      .editing=${isEditing}\n                      .index=${index}\n                      .saveSelectionName=${this._onSaveSelectionName}\n                      .setEditingIndex=${this._setEditingIndex}\n                    ></affine-database-select-option>\n                  </div>\n                  <div class=\"select-option-icon\" @click=${onOptionIconClick}>\n                    ${isEditing ? DatabaseDone : MoreHorizontalIcon}\n                  </div>\n                </div>\n              `;\n            }\n          )}\n        </div>\n      </div>\n    `;\n  }\n}\n", "import { css } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\nimport { html, literal } from 'lit/static-html.js';\n\nimport {\n  DatabaseCellElement,\n  defineColumnRenderer,\n  type TableViewCell,\n} from '../../../register.js';\nimport type { SelectTag } from '../../../types.js';\nimport { SelectCellEditing } from './select-cell-editing.js';\n\n@customElement('affine-database-select-cell')\nclass SelectCell\n  extends DatabaseCellElement<SelectTag[]>\n  implements TableViewCell\n{\n  static override styles = css`\n    affine-database-select-cell {\n      display: flex;\n      align-items: center;\n      width: calc(100% + 8px);\n      height: 100%;\n      margin: -2px -4px;\n    }\n    .affine-database-select-cell-container * {\n      box-sizing: border-box;\n    }\n    .affine-database-select-cell-container {\n      display: flex;\n      align-items: center;\n      flex-wrap: wrap;\n      gap: 6px;\n      width: 100%;\n      cursor: pointer;\n      font-size: var(--affine-font-sm);\n    }\n    .affine-database-select-cell-container .select-selected {\n      height: 28px;\n      padding: 2px 10px;\n      border-radius: 4px;\n      white-space: nowrap;\n      background: var(--affine-tag-white);\n    }\n  `;\n\n  static override tag = literal`affine-database-select-cell`;\n\n  cellType = 'select' as const;\n\n  override render() {\n    const values = this.cell?.value ?? [];\n    return html`\n      <div\n        class=\"affine-database-select-cell-container\"\n        style=${styleMap({\n          maxWidth: `${this.column.width}px`,\n        })}\n      >\n        ${values.map(item => {\n          const style = styleMap({\n            backgroundColor: item.color,\n          });\n          return html`<span class=\"select-selected\" style=${style}\n            >${item.value}</span\n          >`;\n        })}\n      </div>\n    `;\n  }\n}\n\nexport const SelectColumnRenderer = defineColumnRenderer(\n  'select',\n  () => ({\n    selection: [] as SelectTag[],\n  }),\n  () => [] as SelectTag[],\n  {\n    Cell: SelectCell,\n    CellEditing: SelectCellEditing,\n  },\n  {\n    displayName: 'Select',\n  }\n);\n", "import { ColumnRendererHelper } from '../../register.js';\nimport { CheckboxColumnRenderer } from './checkbox.js';\nimport { MultiSelectColumnRenderer } from './multi-select.js';\nimport { NumberColumnRenderer } from './number.js';\nimport { ProgressColumnRenderer } from './progress.js';\nimport { RichTextColumnRenderer } from './rich-text.js';\nimport { SelectColumnRenderer } from './select/select.js';\n\nexport function registerInternalRenderer() {\n  const columnRenderer = new ColumnRendererHelper();\n\n  columnRenderer.register(NumberColumnRenderer);\n  columnRenderer.register(SelectColumnRenderer);\n  columnRenderer.register(MultiSelectColumnRenderer);\n  columnRenderer.register(RichTextColumnRenderer);\n  columnRenderer.register(ProgressColumnRenderer);\n  columnRenderer.register(CheckboxColumnRenderer);\n\n  return columnRenderer;\n}\n", "import './cell-container.js';\n\nimport type { BlockSuiteRoot } from '@blocksuite/lit';\nimport { html } from 'lit';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { DEFAULT_COLUMN_MIN_WIDTH } from '../consts.js';\nimport type { DatabaseTable } from '../table-view.js';\nimport { SearchState } from '../types.js';\n\nexport function DataBaseRowContainer(\n  databaseBlock: DatabaseTable,\n  filteredRowIds: string[],\n  searchState: SearchState,\n  root: BlockSuiteRoot\n) {\n  const databaseModel = databaseBlock.model;\n  const columns = databaseModel.columns;\n\n  const filteredChildren =\n    searchState === SearchState.Searching\n      ? databaseModel.children.filter(\n          child => filteredRowIds.indexOf(child.id) > -1\n        )\n      : databaseModel.children;\n\n  return html`\n    <style>\n      .affine-database-block-rows {\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: flex-start;\n      }\n\n      .affine-database-block-row {\n        width: 100%;\n        min-height: 44px;\n        display: flex;\n        flex-direction: row;\n        border-bottom: 1px solid var(--affine-border-color);\n      }\n      .affine-database-block-row.selected > .database-cell {\n        background: transparent;\n      }\n      .affine-database-block-row > .affine-database-block-row-cell:first-child {\n        background: var(--affine-hover-color);\n      }\n      .affine-database-block-row > .database-cell {\n        background: var(--affine-white);\n      }\n\n      .affine-database-block-row-cell-content {\n        display: flex;\n        align-items: center;\n        height: 100%;\n        min-height: 44px;\n        padding: 0 8px;\n        border-right: 1px solid var(--affine-border-color);\n        transform: translateX(0);\n      }\n      .affine-database-block-row-cell-content > [data-block-id] {\n        width: 100%;\n      }\n      .affine-database-block-row-cell-content > affine-paragraph {\n        display: flex;\n        align-items: center;\n        width: 100%;\n        height: 100%;\n      }\n      .affine-database-block-row-cell-content > affine-paragraph > .text {\n        width: 100%;\n        margin-top: unset;\n      }\n      .database-cell {\n        min-width: ${DEFAULT_COLUMN_MIN_WIDTH}px;\n      }\n      .database-cell:last-child affine-database-cell-container {\n        border-right: none;\n      }\n    </style>\n    <div class=\"affine-database-block-rows\">\n      ${repeat(\n        filteredChildren,\n        child => child.id,\n        (child, idx) => {\n          const style = styleMap({\n            width: `${databaseModel.titleColumnWidth}px`,\n          });\n          return html`\n            <div\n              class=\"affine-database-block-row database-row\"\n              data-row-index=\"${idx}\"\n              data-row-id=\"${child.id}\"\n            >\n              <div\n                class=\"affine-database-block-row-cell database-cell\"\n                style=${style}\n              >\n                <div class=\"affine-database-block-row-cell-content\">\n                  ${root.renderModel(child)}\n                </div>\n              </div>\n              ${repeat(columns, column => {\n                return html`\n                  <div\n                    class=\"database-cell\"\n                    style=${styleMap({\n                      width: `${column.width}px`,\n                    })}\n                  >\n                    <affine-database-cell-container\n                      .databaseModel=${databaseModel}\n                      .rowModel=${child}\n                      .column=${column}\n                      .columnRenderer=${databaseBlock.columnRenderer}\n                    >\n                    </affine-database-cell-container>\n                  </div>\n                `;\n              })}\n              <div class=\"database-cell add-column-button\"></div>\n            </div>\n          `;\n        }\n      )}\n    </div>\n  `;\n}\n", "import { assertExists } from '@blocksuite/store';\n\nexport function getClosestRowIndex(element: Element): number {\n  const rowIndex = element\n    .closest('.database-row')\n    ?.getAttribute('data-row-index');\n  if (rowIndex) {\n    return Number(rowIndex);\n  }\n  // Header row has no index.\n  return -1;\n}\n\nexport function getClosestRowId(element: Element): string {\n  const rowId = element.closest('.database-row')?.getAttribute('data-row-id');\n  if (rowId) {\n    return rowId;\n  }\n  // Header row has no id.\n  return '';\n}\n\nexport function getSelectedRowIdsByIndexes(\n  database: Element,\n  indexes: number[]\n) {\n  return indexes.map(item => getRowIdByIndex(database, item));\n}\n\nexport function getSelectedRowIndexes(\n  startCell: Element,\n  endCell: Element\n): number[] {\n  const currentRowIndex = getClosestRowIndex(startCell);\n  const startRowIndex = getClosestRowIndex(endCell);\n  if (currentRowIndex === -1 || startRowIndex === -1) return [];\n\n  const minIndex = Math.min(currentRowIndex, startRowIndex);\n  const maxIndex = Math.max(currentRowIndex, startRowIndex);\n  const rowIndexes = [];\n  for (let id = minIndex; id <= maxIndex; id++) {\n    rowIndexes.push(id);\n  }\n\n  return rowIndexes;\n}\n\nexport function getClosestDatabase(element: Element | null) {\n  const database = element?.closest('affine-database');\n  assertExists(database);\n  return database;\n}\n\nexport function getClosestDatabaseId(element: Element) {\n  const databaseId = getClosestDatabase(element).getAttribute('data-block-id');\n  assertExists(databaseId);\n  return databaseId;\n}\n\nexport function isInDatabase(element: Element) {\n  const database = element.closest('affine-database');\n  return database !== null;\n}\n\nfunction getRowIdByIndex(database: Element, index: number) {\n  const rowId = database\n    .querySelector(`.database-row[data-row-index=\"${index}\"]`)\n    ?.getAttribute('data-row-id');\n  assertExists(rowId);\n  return rowId;\n}\n", "import type {\n  EventName,\n  UIEventDispatcher,\n  UIEventHandler,\n  UIEventStateContext,\n} from '@blocksuite/lit';\nimport { caretRangeFromPoint, DisposableGroup } from '@blocksuite/store';\n\nimport { getService } from '../../../__internal__/service.js';\nimport { DragHandle } from '../../../components/drag-handle.js';\nimport {\n  handleNativeRangeDragMove,\n  isBlankArea,\n  resetNativeSelection,\n} from '../../../std.js';\nimport type { DatabaseBlockModel } from '../../database-model.js';\nimport type { DatabaseBlockService } from '../../database-service.js';\nimport { getDatabaseById } from '../components/selection/utils.js';\nimport {\n  getClosestDatabase,\n  getClosestDatabaseId,\n  getSelectedRowIdsByIndexes,\n  getSelectedRowIndexes,\n  isInDatabase,\n} from './utils.js';\n\nexport class RowSelectionManager {\n  private readonly _dispatcher: UIEventDispatcher;\n  private readonly _disposables = new DisposableGroup();\n  private readonly _model: DatabaseBlockModel;\n\n  private _service: DatabaseBlockService | null = null;\n  private _startCell: HTMLElement | null = null;\n  private _database: HTMLElement | null = null;\n  private _columnWidthHandles: HTMLElement[] = [];\n  private _startRange: Range | null = null;\n  private _rowIds: string[] = [];\n  private _isInDatabase = false;\n\n  constructor(dispatcher: UIEventDispatcher, model: DatabaseBlockModel) {\n    this._dispatcher = dispatcher;\n    this._model = model;\n    this._service = getService('affine:database');\n\n    this._add('dragStart', this._onDragStart);\n    this._add('dragMove', this._onDragMove);\n    this._add('dragEnd', this._onDragEnd);\n    this._add('click', this._onClick);\n    this._add('keyDown', this._onKeydown);\n  }\n\n  private _onDragStart = (ctx: UIEventStateContext) => {\n    const e = ctx.get('pointerState');\n\n    const { clientX: x, clientY: y, target } = e.raw;\n    const targetElement = target as HTMLElement;\n    this._isInDatabase = isInDatabase(targetElement);\n    if (!this._isInDatabase) {\n      return false;\n    }\n\n    const startRange = caretRangeFromPoint(x, y);\n    this._startRange = startRange;\n\n    if (!isBlankArea(e)) {\n      const el = document.elementFromPoint(x, y);\n      this._startCell = el?.closest<HTMLElement>('.database-cell') ?? null;\n\n      const database = getClosestDatabase(this._startCell);\n      this._database = database;\n      this._columnWidthHandles = Array.from(\n        database.querySelectorAll<HTMLElement>(\n          '.affine-database-column-drag-handle'\n        )\n      );\n      this._setColumnWidthHandleDisplay('none');\n    }\n    return true;\n  };\n\n  private _onDragMove = (ctx: UIEventStateContext) => {\n    if (!this._isInDatabase) {\n      return false;\n    }\n\n    const e = ctx.get('pointerState');\n    e.raw.preventDefault();\n\n    const { clientX: x, clientY: y, target } = e.raw;\n    if (!isInDatabase(target as HTMLElement)) {\n      return false;\n    }\n\n    // In order to avoid missing the underlying database-related elements, use `elementsFromPoint` instead\n    const elements = Array.from(document.elementsFromPoint(x, y));\n\n    const endCell = elements.find(el => el.classList.contains('database-cell'));\n    const startCell = this._startCell;\n    if (!endCell || !startCell || !this._database) return false;\n\n    if (endCell === startCell) {\n      // current cell, native selection\n      const editor = elements.find(el => el.classList.contains('virgo-editor'));\n      if (editor) {\n        const { left, right } = editor.getBoundingClientRect();\n        // Prevent native cross-cell selections from being generated\n        if (x <= left + 1 || x >= right - 1) {\n          return true;\n        }\n\n        handleNativeRangeDragMove(this._startRange, e);\n      }\n\n      if (this._rowIds.length > 0) {\n        this._clearRowSelection();\n      }\n    } else {\n      // cross cell, row-level selection\n      e.raw.preventDefault();\n      resetNativeSelection(null);\n\n      const rowIndexes = getSelectedRowIndexes(startCell, endCell);\n      const rowIds = getSelectedRowIdsByIndexes(this._database, rowIndexes);\n      this._rowIds = rowIds;\n\n      const databaseId = getClosestDatabaseId(endCell);\n      this._service?.setRowSelection({\n        type: 'select',\n        rowIds,\n        databaseId,\n      });\n    }\n\n    return true;\n  };\n\n  private _onDragEnd = (ctx: UIEventStateContext) => {\n    const e = ctx.get('pointerState');\n    const target = e.raw.target as HTMLElement;\n    if (!isInDatabase(target)) {\n      return;\n    }\n\n    this._startRange = null;\n    this._setColumnWidthHandleDisplay('block');\n  };\n\n  private _onClick = (ctx: UIEventStateContext) => {\n    const e = ctx.get('pointerState');\n    const target = e.raw.target as HTMLElement;\n\n    if (target instanceof DragHandle) return;\n\n    const rowSelection = this._service?.getLastRowSelection();\n    if (rowSelection) {\n      this._clearRowSelection();\n    }\n  };\n\n  private _onKeydown = (ctx: UIEventStateContext) => {\n    const e = ctx.get('keyboardState');\n    const event = e.raw;\n\n    const key = event.key;\n    if (key === 'Delete' || key === 'Backspace') {\n      this._onRowSelectionDelete();\n    } else if (key === 'Escape') {\n      const service = getService('affine:database');\n      const cellSelection = service.getLastCellSelection();\n      if (cellSelection) {\n        const {\n          databaseId,\n          coords: [coord],\n        } = cellSelection;\n        // clear cell selection\n        service.clearCellLevelSelection();\n\n        // select row\n        const database = getDatabaseById(databaseId);\n        const rowIds = getSelectedRowIdsByIndexes(database, [coord.rowIndex]);\n        service.setRowSelection({\n          type: 'select',\n          rowIds,\n          databaseId,\n        });\n      }\n    }\n  };\n\n  private _onRowSelectionDelete = () => {\n    const service = getService('affine:database');\n    const rowSelection = service.getLastRowSelection();\n    if (!rowSelection) return;\n\n    const { rowIds } = rowSelection;\n    const page = this._model.page;\n    const children = this._model.children;\n    page.captureSync();\n    if (children.length === rowIds.length) {\n      // delete the database\n      page.deleteBlock(this._model);\n    } else {\n      // delete rows\n      page.updateBlock(this._model, {\n        children: children.filter(child => rowIds.indexOf(child.id) === -1),\n      });\n    }\n    service.clearRowSelection();\n\n    return true;\n  };\n\n  private _setColumnWidthHandleDisplay(display: string) {\n    this._columnWidthHandles.forEach(handle => {\n      handle.style.display = display;\n    });\n  }\n\n  private _clearRowSelection() {\n    this._rowIds = [];\n    this._service?.clearRowSelection();\n    resetNativeSelection(null);\n  }\n\n  private _add = (name: EventName, fn: UIEventHandler) => {\n    this._disposables.add(this._dispatcher.add(name, fn));\n  };\n\n  dispose() {\n    this._disposables.dispose();\n  }\n}\n", "// related component\nimport './components/column-header/column-header.js';\nimport './components/cell-container.js';\nimport './components/toolbar/toolbar.js';\nimport './components/database-title.js';\n\nimport { PlusIcon } from '@blocksuite/global/config';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { BlockSuiteRoot } from '@blocksuite/lit';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/lit';\nimport { css } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { html } from 'lit/static-html.js';\n\nimport { asyncFocusRichText } from '../../__internal__/index.js';\nimport { tooltipStyle } from '../../components/tooltip/tooltip.js';\nimport type { DatabaseBlockModel } from '../database-model.js';\nimport { onClickOutside } from '../utils.js';\nimport type { DatabaseColumnHeader } from './components/column-header/column-header.js';\nimport { registerInternalRenderer } from './components/column-type/index.js';\nimport { DataBaseRowContainer } from './components/row-container.js';\nimport { DEFAULT_COLUMN_WIDTH } from './consts.js';\nimport { CellSelectionManager } from './selection-manager/cell.js';\nimport { RowSelectionManager } from './selection-manager/row.js';\nimport type { Column } from './types.js';\nimport { SearchState } from './types.js';\n\nconst styles = css`\n  affine-database-table {\n    position: relative;\n  }\n\n  .affine-database-block-title-container {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 44px;\n    margin: 18px 0 0;\n  }\n\n  .affine-database-block-table {\n    position: relative;\n    width: 100%;\n    padding-bottom: 4px;\n    overflow-x: scroll;\n    overflow-y: hidden;\n    border-top: 1.5px solid var(--affine-border-color);\n  }\n  .affine-database-block-table:hover {\n    padding-bottom: 0px;\n  }\n  .affine-database-block-table::-webkit-scrollbar {\n    -webkit-appearance: none;\n    display: block;\n  }\n  .affine-database-block-table::-webkit-scrollbar:horizontal {\n    height: 4px;\n  }\n  .affine-database-block-table::-webkit-scrollbar-thumb {\n    border-radius: 2px;\n    background-color: var(--affine-black-10);\n  }\n  .affine-database-block-table:hover::-webkit-scrollbar:horizontal {\n    height: 8px;\n  }\n  .affine-database-block-table:hover::-webkit-scrollbar-thumb {\n    border-radius: 16px;\n    background-color: var(--affine-black-30);\n  }\n  .affine-database-block-table:hover::-webkit-scrollbar-track {\n    background-color: var(--affine-hover-color);\n  }\n\n  .affine-database-table-container {\n    position: relative;\n    width: fit-content;\n    min-width: 100%;\n  }\n\n  .affine-database-block-tag-circle {\n    width: 12px;\n    height: 12px;\n    border-radius: 50%;\n    display: inline-block;\n  }\n\n  .affine-database-block-tag {\n    display: inline-flex;\n    border-radius: 11px;\n    align-items: center;\n    padding: 0 8px;\n    cursor: pointer;\n  }\n\n  .affine-database-block-footer {\n    display: flex;\n    width: 100%;\n    height: 28px;\n    margin-top: -8px;\n  }\n  .affine-database-block-footer:hover {\n    position: relative;\n    z-index: 1;\n    background-color: var(--affine-hover-color-filled);\n  }\n  .affine-database-block-footer:hover .affine-database-block-add-row {\n    display: flex;\n  }\n\n  .affine-database-block-add-row {\n    display: none;\n    flex: 1;\n    align-items: center;\n    justify-content: center;\n    gap: 4px;\n    width: 100%;\n    height: 100%;\n    cursor: pointer;\n    user-select: none;\n    font-size: 14px;\n  }\n  .affine-database-block-add-row svg {\n    width: 16px;\n    height: 16px;\n  }\n\n  ${tooltipStyle}\n`;\n\n@customElement('affine-database-table')\nexport class DatabaseTable extends WithDisposable(ShadowlessElement) {\n  flavour = 'affine:database' as const;\n\n  static override styles = styles;\n\n  @property()\n  model!: DatabaseBlockModel;\n\n  @property()\n  root!: BlockSuiteRoot;\n\n  @query('.affine-database-table-container')\n  private _tableContainer!: HTMLDivElement;\n\n  @query('affine-database-column-header')\n  private _columnHeaderComponent!: DatabaseColumnHeader;\n\n  @state()\n  private _searchState: SearchState = SearchState.SearchIcon;\n\n  @state()\n  private _filteredRowIds: string[] = [];\n\n  @state()\n  private _hoverState = false;\n\n  private _rowSelection!: RowSelectionManager;\n  private _cellSelection!: CellSelectionManager;\n\n  private _columnRenderer = registerInternalRenderer();\n  get columnRenderer() {\n    return this._columnRenderer;\n  }\n\n  private get columns(): Column[] {\n    return this.model.columns;\n  }\n\n  private get readonly() {\n    return this.model.page.readonly;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this._updateHoverState();\n    this._initRowSelectionEvents();\n    this._initCellSelectionEvents();\n\n    const disposables = this._disposables;\n    disposables.addFromEvent(this, 'mouseover', this._onMouseOver);\n    disposables.addFromEvent(this, 'mouseleave', this._onMouseLeave);\n    disposables.addFromEvent(this, 'click', this._onClick);\n    disposables.addFromEvent(\n      this,\n      'keydown',\n      this._cellSelection.onCellSelectionChange\n    );\n  }\n\n  override firstUpdated() {\n    this.model.propsUpdated.on(() => {\n      this.requestUpdate();\n      // TODO: optimize performance here\n      this.querySelectorAll('affine-database-cell-container').forEach(cell => {\n        cell.requestUpdate();\n      });\n      this.querySelector('affine-database-column-header')?.requestUpdate();\n    });\n    this.model.childrenUpdated.on(() => {\n      this.requestUpdate();\n      // TODO: optimize performance here\n      this.querySelectorAll('affine-database-cell-container').forEach(cell => {\n        cell.requestUpdate();\n      });\n      this.querySelector('affine-database-column-header')?.requestUpdate();\n      this._updateHoverState();\n    });\n\n    if (this.readonly) return;\n    const tableContent = this._tableContainer.parentElement;\n    assertExists(tableContent);\n    this._disposables.addFromEvent(\n      tableContent,\n      'scroll',\n      this._onDatabaseScroll\n    );\n  }\n\n  private _updateHoverState() {\n    if (this.model.children.length === 0) {\n      this._hoverState = true;\n      return;\n    }\n\n    this._resetHoverState();\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n\n    this._rowSelection.dispose();\n    this._cellSelection.dispose();\n  }\n\n  private _initRowSelectionEvents = () => {\n    this._rowSelection = new RowSelectionManager(\n      this.root.uiEventDispatcher,\n      this.model\n    );\n  };\n\n  private _initCellSelectionEvents = () => {\n    this._cellSelection = new CellSelectionManager(\n      this.root.uiEventDispatcher,\n      this.model\n    );\n  };\n\n  private _setFilteredRowIds = (rowIds: string[]) => {\n    this._filteredRowIds = rowIds;\n  };\n\n  private _setSearchState = (state: SearchState) => {\n    this._searchState = state;\n  };\n\n  private _resetSearchState() {\n    this._searchState = SearchState.SearchIcon;\n  }\n\n  private _resetHoverState() {\n    this._hoverState = false;\n  }\n\n  private _onDatabaseScroll = (event: Event) => {\n    this._columnHeaderComponent.showAddColumnButton();\n  };\n\n  private _onMouseOver = () => {\n    this._hoverState = true;\n  };\n\n  private _onMouseLeave = () => {\n    if (this._searchState === SearchState.SearchIcon) {\n      this._updateHoverState();\n    }\n  };\n\n  private _onClick = () => {\n    setTimeout(() => {\n      onClickOutside(\n        this,\n        () => {\n          if (this._searchState !== SearchState.Searching) {\n            this._resetHoverState();\n            this._resetSearchState();\n          }\n        },\n        'mousedown'\n      );\n    });\n  };\n\n  private _addRow = (index?: number) => {\n    if (this.readonly) return;\n\n    const currentSearchState = this._searchState;\n    this._resetSearchState();\n    this._resetHoverState();\n\n    const page = this.model.page;\n    page.captureSync();\n    const id = page.addBlock('affine:paragraph', {}, this.model.id, index);\n    asyncFocusRichText(page, id);\n    // save the search state\n    this._setSearchState(currentSearchState);\n  };\n\n  private _addColumn = (index: number) => {\n    if (this.readonly) return;\n\n    this.model.page.captureSync();\n    const currentColumns = this.model.columns;\n    const defaultColumnType = 'multi-select';\n    const renderer = this._columnRenderer.get(defaultColumnType);\n    const schema: Omit<Column, 'id'> = {\n      type: defaultColumnType,\n      name: `Column ${currentColumns.length + 1}`,\n      width: DEFAULT_COLUMN_WIDTH,\n      hide: false,\n      ...renderer.propertyCreator(),\n    };\n    const id = this.model.addColumn(schema, index);\n    this.model.applyColumnUpdate();\n\n    requestAnimationFrame(() => {\n      this._columnHeaderComponent.setEditingColumnId(id);\n    });\n  };\n\n  override render() {\n    const rows = DataBaseRowContainer(\n      this,\n      this._filteredRowIds,\n      this._searchState,\n      this.root\n    );\n\n    return html`\n      <div class=\"affine-database-table\">\n        <div class=\"affine-database-block-title-container\">\n          <affine-database-title\n            .addRow=${this._addRow}\n            .targetModel=${this.model}\n          ></affine-database-title>\n          <affine-database-toolbar\n            .addRow=${this._addRow}\n            .targetModel=${this.model}\n            .hoverState=${this._hoverState}\n            .searchState=${this._searchState}\n            .setSearchState=${this._setSearchState}\n            .setFilteredRowIds=${this._setFilteredRowIds}\n          ></affine-database-toolbar>\n        </div>\n        <div class=\"affine-database-block-table\">\n          <div class=\"affine-database-table-container\">\n            <affine-database-column-header\n              .columns=${this.columns}\n              .targetModel=${this.model}\n              .addColumn=${this._addColumn}\n              .columnRenderer=${this.columnRenderer}\n            ></affine-database-column-header>\n            ${rows}\n          </div>\n        </div>\n        ${this.readonly\n          ? null\n          : html`<div class=\"affine-database-block-footer\">\n              <div\n                class=\"affine-database-block-add-row\"\n                data-test-id=\"affine-database-add-row-button\"\n                role=\"button\"\n                @click=${() => this._addRow()}\n              >\n                ${PlusIcon}<span>New Record</span>\n              </div>\n            </div>`}\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-database-table': DatabaseTable;\n  }\n}\n", "// related component\n\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/lit';\nimport { css } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { html } from 'lit/static-html.js';\n\nimport { type BlockHost } from '../../__internal__/index.js';\nimport type { DatabaseBlockModel } from '../database-model.js';\n\nconst styles = css`\n  affine-database-kanban {\n    position: relative;\n  }\n`;\n\n@customElement('affine-database-kanban')\nexport class DatabaseKanban\n  extends WithDisposable(ShadowlessElement)\n  implements BlockHost\n{\n  flavour = 'affine:database' as const;\n\n  static override styles = styles;\n\n  get slots() {\n    return this.host.slots;\n  }\n\n  get page() {\n    return this.host.page;\n  }\n  get clipboard() {\n    return this.host.clipboard;\n  }\n  get getService() {\n    return this.host.getService;\n  }\n\n  @property()\n  model!: DatabaseBlockModel;\n\n  @property()\n  host!: BlockHost;\n\n  override connectedCallback() {\n    super.connectedCallback();\n  }\n\n  override render() {\n    return html`<div class=\"affine-database-kanban\">kanban view</div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-database-kanban': DatabaseKanban;\n  }\n}\n", "import type { BlockModels } from '@blocksuite/global/types';\nimport {\n  assertExists,\n  type BaseBlockModel,\n  type Page,\n  Slot,\n} from '@blocksuite/store';\n\nimport { getService } from '../__internal__/service.js';\nimport { BaseService } from '../__internal__/service/index.js';\nimport type {\n  DatabaseTableViewCellSelect,\n  DatabaseTableViewCellState,\n  DatabaseTableViewRowState,\n} from '../std.js';\nimport { asyncFocusRichText, type SerializedBlock } from '../std.js';\nimport type { DatabaseBlockModel } from './database-model.js';\nimport {\n  clearAllDatabaseCellSelection,\n  clearAllDatabaseRowsSelection,\n  setDatabaseCellEditing,\n  setDatabaseCellSelection,\n  setDatabaseRowsSelection,\n} from './table/components/selection/utils.js';\nimport {\n  getClosestDatabaseId,\n  getClosestRowId,\n} from './table/selection-manager/utils.js';\nimport type { Cell, Column } from './table/types.js';\n\ntype LastTableViewRowSelection = {\n  databaseId: string;\n  rowIds: string[];\n};\ntype LastTableViewCellSelection = Pick<\n  DatabaseTableViewCellSelect,\n  'databaseId' | 'coords'\n>;\nexport class DatabaseBlockService extends BaseService<DatabaseBlockModel> {\n  private _lastRowSelection: LastTableViewRowSelection | null = null;\n  private _lastCellSelection: LastTableViewCellSelection | null = null;\n\n  slots = {\n    tableViewRowSelectionUpdated: new Slot<DatabaseTableViewRowState>(),\n    tableViewCellSelectionUpdated: new Slot<DatabaseTableViewCellState>(),\n  };\n\n  constructor() {\n    super();\n\n    this.slots.tableViewRowSelectionUpdated.on(state => {\n      const { type } = state;\n\n      if (type === 'select' || type === 'click') {\n        const { rowIds, databaseId } = state;\n\n        this._lastRowSelection = {\n          databaseId,\n          rowIds,\n        };\n        setDatabaseRowsSelection(databaseId, rowIds);\n      } else if (type === 'clear') {\n        this.clearLastRowSelection();\n        clearAllDatabaseRowsSelection();\n      }\n    });\n\n    this.slots.tableViewCellSelectionUpdated.on(state => {\n      const { type } = state;\n\n      if (type === 'select') {\n        const { databaseId, coords } = state;\n        //  select\n        this._lastCellSelection = {\n          databaseId,\n          coords,\n        };\n        setDatabaseCellSelection(databaseId, coords);\n      } else if (type === 'edit') {\n        this._lastCellSelection = null;\n        const { databaseId, coords } = state;\n        setDatabaseCellEditing(databaseId, coords[0]);\n      } else if (type === 'clear') {\n        // clear\n        this._lastCellSelection = null;\n        clearAllDatabaseCellSelection();\n      }\n    });\n  }\n\n  initDatabaseBlock(\n    page: Page,\n    model: BaseBlockModel,\n    databaseId: string,\n    isAppendNewRow = true\n  ) {\n    // By default, database has 3 empty rows\n    for (let i = 0; i < 3; i++) {\n      const id = page.addBlock(\n        'affine:paragraph',\n        {\n          text: new page.Text(''),\n        },\n        databaseId\n      );\n      if (i === 0) asyncFocusRichText(page, id);\n    }\n    if (isAppendNewRow) {\n      // Add a paragraph after database\n      const parent = page.getParent(model);\n      assertExists(parent);\n      page.addBlock('affine:paragraph', {}, parent.id);\n    }\n\n    const blockModel = page.getBlockById(databaseId) as DatabaseBlockModel;\n    assertExists(blockModel);\n    // default column\n    blockModel.updateColumn({\n      name: 'Tag',\n      type: 'multi-select',\n      width: 200,\n      hide: false,\n      selection: [],\n    });\n    blockModel.applyColumnUpdate();\n  }\n\n  override block2Json(\n    block: BlockModels['affine:database'],\n    begin?: number,\n    end?: number\n  ): SerializedBlock {\n    const columns = [...block.columns];\n    const rowIds = block.children.map(child => child.id);\n\n    return {\n      flavour: block.flavour,\n      databaseProps: {\n        id: block.id,\n        title: block.title.toString(),\n        titleColumnName: block.titleColumnName,\n        titleColumnWidth: block.titleColumnWidth,\n        rowIds,\n        cells: block.cells,\n        columns,\n      },\n      children: block.children?.map((child, index) => {\n        if (index === block.children.length - 1) {\n          return getService(child.flavour).block2Json(child, 0, end);\n        }\n        return getService(child.flavour).block2Json(child);\n      }),\n    };\n  }\n\n  override async onBlockPasted(\n    model: BlockModels['affine:database'],\n    props: {\n      rowIds: string[];\n      columns: Column[];\n      cells: Record<string, Record<string, Cell>>;\n    }\n  ) {\n    const { rowIds, columns, cells } = props;\n\n    const columnIds = columns.map(column => column.id);\n\n    const newColumnIds = columns.map(schema => {\n      const { id, ...nonIdProps } = schema;\n      return model.updateColumn(nonIdProps);\n    });\n    model.applyColumnUpdate();\n\n    const newRowIds = model.children.map(child => child.id);\n    rowIds.forEach((rowId, rowIndex) => {\n      const newRowId = newRowIds[rowIndex];\n      columnIds.forEach((columnId, columnIndex) => {\n        const cellData = cells[rowId]?.[columnId];\n        const value = cellData?.value;\n        if (!value) return;\n        model.updateCell(newRowId, {\n          columnId: newColumnIds[columnIndex],\n          value,\n        });\n      });\n    });\n  }\n\n  clearSelection() {\n    this.clearRowSelection();\n    this.clearCellLevelSelection();\n  }\n\n  // row level selection\n  clearRowSelection() {\n    this.slots.tableViewRowSelectionUpdated.emit({\n      type: 'clear',\n    });\n  }\n\n  setRowSelection(state: DatabaseTableViewRowState) {\n    if (\n      state.type === 'click' &&\n      this._lastRowSelection &&\n      state.rowIds?.[0] === this._lastRowSelection.rowIds?.[0]\n    ) {\n      this.clearRowSelection();\n      return;\n    }\n\n    this.slots.tableViewRowSelectionUpdated.emit(state);\n  }\n\n  setRowSelectionByElement(element: Element) {\n    const rowId = getClosestRowId(element);\n    if (rowId !== '') {\n      const databaseId = getClosestDatabaseId(element);\n      this.setRowSelection({\n        type: 'select',\n        databaseId,\n        rowIds: [rowId],\n      });\n    }\n  }\n\n  clearLastRowSelection() {\n    this._lastRowSelection = null;\n  }\n\n  refreshRowSelection() {\n    if (!this._lastRowSelection) return;\n\n    const { databaseId, rowIds } = this._lastRowSelection;\n\n    this.setRowSelection({\n      type: 'select',\n      databaseId,\n      rowIds,\n    });\n  }\n\n  toggleRowSelection(element: Element) {\n    const rowId = getClosestRowId(element);\n    // click on database's drag handle\n    if (rowId === '') return false;\n\n    const rowIds = this._lastRowSelection?.rowIds ?? [];\n\n    if (rowIds.indexOf(rowId) > -1) {\n      this.clearRowSelection();\n    } else {\n      this.setRowSelection({\n        type: 'click',\n        databaseId: getClosestDatabaseId(element),\n        rowIds: [rowId],\n      });\n    }\n    return true;\n  }\n\n  getLastRowSelection() {\n    return this._lastRowSelection;\n  }\n\n  // cell level selection\n  clearCellLevelSelection() {\n    this.slots.tableViewCellSelectionUpdated.emit({\n      type: 'clear',\n    });\n  }\n\n  setCellSelection(cellSelectionState: DatabaseTableViewCellState) {\n    this.slots.tableViewCellSelectionUpdated.emit(cellSelectionState);\n  }\n\n  getLastCellSelection() {\n    return this._lastCellSelection;\n  }\n}\n", "// related component\nimport './table/table-view.js';\nimport './kanban/kanban-view.js';\n\nimport { BlockElement } from '@blocksuite/lit';\nimport { customElement } from 'lit/decorators.js';\nimport { html, literal, unsafeStatic } from 'lit/static-html.js';\n\nimport { registerService } from '../__internal__/service.js';\nimport type { DatabaseBlockModel } from './database-model.js';\nimport { DatabaseBlockService } from './database-service.js';\n\n@customElement('affine-database')\nexport class DatabaseBlockComponent extends BlockElement<DatabaseBlockModel> {\n  override connectedCallback() {\n    super.connectedCallback();\n\n    registerService('affine:database', DatabaseBlockService);\n    this.model.propsUpdated.on(() => this.requestUpdate());\n  }\n\n  override render() {\n    const databaseTag = literal`affine-database-${unsafeStatic(\n      this.model.mode\n    )}`;\n\n    /* eslint-disable lit/binding-positions, lit/no-invalid-html */\n    return html`\n      <${databaseTag}\n        .root=${this.root}\n        .model=${this.model}\n        class=\"affine-block-element\"\n      ></${databaseTag}>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-database': DatabaseBlockComponent;\n  }\n}\n", "import { Text } from '@blocksuite/store';\nimport { BaseBlockModel, defineBlockSchema } from '@blocksuite/store';\nimport { literal } from 'lit/static-html.js';\n\nimport { DEFAULT_TITLE } from './table/consts.js';\nimport type { Cell, Column, SelectTag } from './table/types.js';\nimport type { DatabaseMode } from './types.js';\n\nexport type Props = {\n  mode: DatabaseMode;\n  title: Text;\n  cells: SerializedCells;\n  columns: Array<Column>;\n  titleColumnName: string;\n  titleColumnWidth: number;\n};\n\ntype SerializedCells = {\n  // row\n  [key: string]: {\n    // column\n    [key: string]: Cell;\n  };\n};\n\nexport class DatabaseBlockModel extends BaseBlockModel<Props> {\n  override onCreated() {\n    super.onCreated();\n\n    this.page.slots.onYEvent.on(({ event }) => {\n      if (\n        event.path.includes(this.id) &&\n        (event.path.includes('prop:columns') ||\n          event.path.includes('prop:cells'))\n      ) {\n        this.propsUpdated.emit();\n      }\n    });\n  }\n\n  applyColumnUpdate() {\n    this.page.updateBlock(this, {\n      columns: this.columns,\n    });\n  }\n\n  applyCellsUpdate() {\n    this.page.updateBlock(this, {\n      cells: this.cells,\n    });\n  }\n\n  findColumnIndex(id: Column['id']) {\n    let result = -1;\n    this.columns.forEach((col, index) => {\n      if (col.id === id) result = index;\n    });\n    return result;\n  }\n\n  getColumn(id: Column['id']): Column | null {\n    const index = this.findColumnIndex(id);\n    if (index < 0) {\n      return null;\n    }\n    return this.columns[index];\n  }\n\n  addColumn(column: Omit<Column, 'id'>, index?: number): string {\n    const id = this.page.generateId();\n    this.page.transact(() => {\n      const col = { ...column, id } as Column;\n      if (index === undefined) {\n        this.columns.push(col);\n      } else {\n        this.columns.splice(index, 0, col);\n      }\n    });\n    return id;\n  }\n\n  updateColumn(column: Omit<Column, 'id'> & { id?: Column['id'] }): string {\n    const id = column.id ?? this.page.generateId();\n    const index = this.findColumnIndex(id);\n    this.page.transact(() => {\n      if (index < 0) {\n        this.columns.push({ ...column, id } as Column);\n      } else {\n        this.columns[index] = { ...column, id } as Column;\n      }\n    });\n    return id;\n  }\n\n  moveColumn(from: number, to: number) {\n    this.page.transact(() => {\n      const column = this.columns[from];\n      this.columns.splice(from, 1);\n      this.columns.splice(to, 0, column);\n    });\n  }\n\n  deleteColumn(columnId: Column['id']) {\n    const index = this.findColumnIndex(columnId);\n    if (index < 0) return;\n\n    this.page.transact(() => this.columns.splice(index, 1));\n  }\n\n  getCell(rowId: BaseBlockModel['id'], columnId: Column['id']): Cell | null {\n    const yRow = this.cells[rowId];\n    const yCell = yRow?.[columnId] ?? null;\n    if (!yCell) return null;\n\n    return {\n      columnId: yCell.columnId,\n      value: yCell.value,\n    };\n  }\n\n  updateCell(rowId: string, cell: Cell) {\n    const hasRow = rowId in this.cells;\n    if (!hasRow) {\n      this.cells[rowId] = {};\n    }\n    this.page.transact(() => {\n      this.cells[rowId][cell.columnId] = {\n        columnId: cell.columnId,\n        value: cell.value,\n      };\n    });\n  }\n\n  copyCellsByColumn(fromId: Column['id'], toId: Column['id']) {\n    this.page.transact(() => {\n      Object.keys(this.cells).forEach(rowId => {\n        const cell = this.cells[rowId][fromId];\n        if (cell) {\n          this.cells[rowId][toId] = {\n            ...cell,\n            columnId: toId,\n          };\n        }\n      });\n    });\n  }\n\n  deleteCellsByColumn(columnId: Column['id']) {\n    this.page.transact(() => {\n      Object.keys(this.cells).forEach(rowId => {\n        delete this.cells[rowId][columnId];\n      });\n    });\n  }\n\n  convertCellsByColumn(\n    columnId: Column['id'],\n    newType: 'select' | 'rich-text'\n  ) {\n    this.page.transact(() => {\n      Object.keys(this.cells).forEach(rowId => {\n        const cell = this.cells[rowId][columnId];\n        if (!cell) return;\n\n        const value = cell.value;\n        if (!value) return;\n\n        if (newType === 'select') {\n          this.cells[rowId][columnId] = {\n            columnId,\n            value: [(value as string[])[0]],\n          };\n          return;\n        }\n\n        if (newType === 'rich-text') {\n          const text = new Text((value as number) + '');\n          this.cells[rowId][columnId] = {\n            columnId,\n            value: text.yText,\n          };\n          return;\n        }\n      });\n    });\n  }\n\n  renameSelectedCellTag(\n    columnId: Column['id'],\n    oldValue: SelectTag,\n    newValue: SelectTag\n  ) {\n    this.page.transact(() => {\n      Object.keys(this.cells).forEach(rowId => {\n        const cell = this.cells[rowId][columnId];\n        if (!cell) return;\n\n        const selected = cell.value as SelectTag[];\n        const newSelected = [...selected];\n        const index = newSelected.findIndex(s => s.value === oldValue.value);\n        newSelected[index] = newValue;\n\n        this.cells[rowId][columnId].value = newSelected;\n      });\n    });\n  }\n\n  deleteSelectedCellTag(columnId: Column['id'], target: SelectTag) {\n    this.page.transact(() => {\n      Object.keys(this.cells).forEach(rowId => {\n        const cell = this.cells[rowId][columnId];\n        if (!cell) return;\n\n        const selected = cell.value as SelectTag[];\n        const newSelected = [...selected].filter(\n          item => item.value !== target.value\n        );\n\n        this.cells[rowId][columnId] = {\n          columnId,\n          value: newSelected,\n        };\n      });\n    });\n  }\n}\n\nexport const DatabaseBlockSchema = defineBlockSchema({\n  flavour: 'affine:database',\n  props: (internal): Props => ({\n    mode: 'table',\n    title: internal.Text(DEFAULT_TITLE),\n    cells: {},\n    columns: [],\n    titleColumnName: 'Title',\n    titleColumnWidth: 432,\n  }),\n  metadata: {\n    role: 'hub',\n    version: 1,\n    tag: literal`affine-database`,\n    parent: ['affine:frame'],\n    children: ['affine:paragraph', 'affine:list'],\n  },\n  toModel: () => {\n    return new DatabaseBlockModel();\n  },\n});\n", "import { Slot } from '@blocksuite/store';\n\nimport type { CssVariablesMap } from './css-variables.js';\nimport { VARIABLES } from './css-variables.js';\n\nexport function extractCssVariables(element: Element): CssVariablesMap {\n  const styles = window.getComputedStyle(element);\n  const variables = VARIABLES.reduce((acc, cssName) => {\n    const value = styles.getPropertyValue(cssName).trim();\n    acc[cssName] = value;\n\n    // --affine-palette-transparent: special values added for the sake of logical consistency.\n    if (cssName === '--affine-palette-transparent' && !value) {\n      acc[cssName] = '#00000000';\n    }\n\n    return acc;\n  }, {} as CssVariablesMap);\n  return variables;\n}\n\n/**\n * Observer theme changing by `data-theme` property\n */\nexport class ThemeObserver extends Slot<CssVariablesMap> {\n  private _observer?: MutationObserver;\n\n  private _mode = '';\n  private _cssVariables: CssVariablesMap | null = null;\n\n  get cssVariables() {\n    return this._cssVariables;\n  }\n\n  observer(element: Element) {\n    this._observer?.disconnect();\n    this._cssVariables = extractCssVariables(element);\n    this._observer = new MutationObserver(() => {\n      const mode = element.getAttribute('data-theme');\n      if (this._mode !== mode) {\n        this._cssVariables = extractCssVariables(element);\n        this.emit(this._cssVariables);\n      }\n    });\n    this._observer.observe(element, {\n      attributes: true,\n      attributeFilter: ['data-theme'],\n    });\n  }\n\n  override dispose() {\n    super.dispose();\n    this._observer?.disconnect();\n  }\n}\n", "import { html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\n/**\n * Renders a template into a portal. Defaults to `document.body`.\n *\n * @example\n * ```ts\n * render() {\n *   return html`${showPortal\n *     ? html`<affine-portal .template=${portalTemplate}></affine-portal>`\n *     : null}`;\n * };\n * ```\n */\n@customElement('affine-portal')\nexport class Portal extends LitElement {\n  @property()\n  public container = document.body;\n\n  @property()\n  public template = html``;\n\n  private _portalRoot: HTMLElement | null = null;\n\n  override disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this._portalRoot?.remove();\n  }\n\n  override createRenderRoot() {\n    const portalRoot = document.createElement('div');\n    portalRoot.classList.add('affine-portal');\n    this.container.append(portalRoot);\n    this._portalRoot = portalRoot;\n    return portalRoot;\n  }\n\n  override render() {\n    return this.template;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-portal': Portal;\n  }\n}\n", "import {\n  CancelWrapIcon,\n  CopyIcon,\n  DeleteIcon,\n  WrapIcon,\n} from '@blocksuite/global/config';\nimport type { Slot } from '@blocksuite/global/utils';\nimport type { BaseBlockModel } from '@blocksuite/store';\nimport { html } from 'lit';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { tooltipStyle } from '../../components/tooltip/tooltip.js';\nimport { copyCode } from '../../page-block/default/utils.js';\nimport type { CodeBlockModel } from '../code-model.js';\n\nexport function CodeOptionTemplate({\n  model,\n  position,\n  hoverState,\n  wrap,\n  onClickWrap,\n}: {\n  position: { x: number; y: number };\n  model: BaseBlockModel;\n  hoverState: Slot<boolean>;\n  wrap: boolean;\n  onClickWrap: () => void;\n}) {\n  const page = model.page;\n  const readonly = page.readonly;\n\n  const style = {\n    position: 'fixed',\n    left: position.x + 'px',\n    top: position.y + 'px',\n  };\n\n  return html`\n    <style>\n      .affine-codeblock-option-container > div {\n          position: fixed;\n          z-index: 1;\n          box-shadow:var(--affine-shadow-2)\n      }\n      .affine-codeblock-option {\n        box-shadow:var(--affine-shadow-2);\n        padding:4px;\n        border-radius:8px;\n        background:var(--affine-background-overlay-panel-color)\n      }\n\n      ${tooltipStyle}\n    </style>\n\n    <div\n      class=\"affine-codeblock-option\"\n      style=${styleMap(style)}\n      @mouseover=${() => hoverState.emit(true)}\n      @mouseout=${() => hoverState.emit(false)}\n    >\n      <format-bar-button\n        class=\"has-tool-tip\"\n        data-testid=\"copy-button\"\n        @click=${() => copyCode(model as CodeBlockModel)}\n      >\n        ${CopyIcon}\n        <tool-tip inert tip-position=\"right\" role=\"tooltip\"\n          >Copy to Clipboard</tool-tip\n        >\n      </format-bar-button>\n      <format-bar-button\n        class=\"has-tool-tip\"\n        data-testid=\"wrap-button\"\n        ?active=${wrap}\n        @click=${onClickWrap}\n      >\n        ${wrap ? CancelWrapIcon : WrapIcon}\n        <tool-tip inert tip-position=\"right\" role=\"tooltip\">Wrap code</tool-tip>\n      </format-bar-button>\n      ${readonly\n        ? ''\n        : html`<format-bar-button\n            data-testid=\"delete-button\"\n            class=\"has-tool-tip\"\n            @click=${() => {\n              if (readonly) return;\n              model.page.deleteBlock(model);\n            }}\n          >\n            ${DeleteIcon}\n            <tool-tip inert tip-position=\"right\" role=\"tooltip\"\n              >Delete</tool-tip\n            >\n          </format-bar-button>`}\n    </div>\n  `;\n}\n", "import { SearchIcon } from '@blocksuite/global/config';\nimport { ShadowlessElement } from '@blocksuite/lit';\nimport { css, html } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport {\n  BUNDLED_LANGUAGES,\n  type ILanguageRegistration,\n  type Lang,\n} from 'shiki';\n\nimport { createEvent } from '../../__internal__/index.js';\nimport { POPULAR_LANGUAGES_MAP } from '../utils/code-languages.js';\nimport { PLAIN_TEXT_REGISTRATION } from '../utils/consts.js';\n\n// TODO extract to a common list component\n@customElement('lang-list')\nexport class LangList extends ShadowlessElement {\n  static override get styles() {\n    return css`\n      lang-list {\n        display: flex;\n        flex-direction: column;\n        position: absolute;\n        background: var(--affine-background-overlay-panel-color);\n        border-radius: 12px;\n        top: 24px;\n        z-index: 1;\n      }\n\n      .lang-list-container {\n        box-shadow: var(--affine-menu-shadow);\n        border-radius: 8px;\n        padding: 12px 8px;\n      }\n\n      .lang-list-button-container {\n        position: relative;\n        overflow: scroll;\n        height: 424px;\n        width: 200px;\n        padding-top: 5px;\n        padding-left: 4px;\n        padding-right: 4px;\n        /*scrollbar-color: #fff0 #fff0;*/\n      }\n\n      /*\n      .lang-list-button-container::-webkit-scrollbar {\n        background: none;\n      }\n      */\n\n      .lang-item {\n        display: flex;\n        justify-content: flex-start;\n        padding-left: 12px;\n        margin-bottom: 5px;\n      }\n\n      .input-wrapper {\n        position: relative;\n        display: flex;\n        margin-top: 8px;\n        margin-left: 4px;\n      }\n\n      #filter-input {\n        display: flex;\n        align-items: center;\n        height: 32px;\n        width: 192px;\n        border: 1px solid var(--affine-border-color);\n        border-radius: 8px;\n        padding-left: 44px;\n        padding-top: 4px;\n\n        font-family: var(--affine-font-family);\n        font-size: var(--affine-font-sm);\n        box-sizing: border-box;\n        color: inherit;\n        background: var(--affine-background-overlay-panel-color);\n      }\n\n      #filter-input:focus {\n        outline: none;\n      }\n\n      #filter-input::placeholder {\n        color: var(--affine-placeholder-color);\n        font-size: var(--affine-font-sm);\n      }\n\n      .search-icon {\n        position: absolute;\n        left: 8px;\n        height: 100%;\n        display: flex;\n        align-items: center;\n        fill: var(--affine-icon-color);\n      }\n    `;\n  }\n\n  @state()\n  private _filterText = '';\n\n  @state()\n  private _currentSelectedIndex = 0;\n\n  @query('#filter-input')\n  filterInput!: HTMLInputElement;\n\n  @property()\n  delay = 150;\n\n  override async connectedCallback() {\n    super.connectedCallback();\n    // Avoid triggering click away listener on initial render\n    document.addEventListener('click', this._clickAwayListener);\n\n    setTimeout(() => {\n      this.filterInput?.focus();\n    }, 0);\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    document.removeEventListener('click', this._clickAwayListener);\n  }\n\n  private _clickAwayListener = (e: Event) => {\n    if (this.renderRoot.parentElement?.contains(e.target as Node)) {\n      return;\n    }\n    this.dispatchEvent(createEvent('dispose', null));\n  };\n\n  private _onLanguageClicked(language: ILanguageRegistration | null) {\n    // TODO use slot instead\n    this.dispatchEvent(\n      createEvent('selected-language-changed', {\n        language: language?.id ?? null,\n      })\n    );\n  }\n\n  override render() {\n    const filteredLanguages = [PLAIN_TEXT_REGISTRATION, ...BUNDLED_LANGUAGES]\n      .filter(language => {\n        if (!this._filterText) {\n          return true;\n        }\n        return (\n          language.id.startsWith(this._filterText.toLowerCase()) ||\n          language.aliases?.some(alias =>\n            alias.startsWith(this._filterText.toLowerCase())\n          )\n        );\n      })\n      .sort(\n        (a, b) =>\n          (POPULAR_LANGUAGES_MAP[a.id as Lang] ?? Infinity) -\n          (POPULAR_LANGUAGES_MAP[b.id as Lang] ?? Infinity)\n      );\n\n    const onLanguageSelect = (e: KeyboardEvent) => {\n      if (e.key === 'ArrowDown') {\n        e.preventDefault();\n        this._currentSelectedIndex =\n          (this._currentSelectedIndex + 1) % filteredLanguages.length;\n        // TODO scroll to item\n      } else if (e.key === 'ArrowUp') {\n        e.preventDefault();\n        this._currentSelectedIndex =\n          (this._currentSelectedIndex + filteredLanguages.length - 1) %\n          filteredLanguages.length;\n        // TODO scroll to item\n      } else if (e.key === 'Enter') {\n        e.preventDefault();\n        if (\n          this._currentSelectedIndex === -1 ||\n          this._currentSelectedIndex >= filteredLanguages.length\n        )\n          return;\n\n        this._onLanguageClicked(filteredLanguages[this._currentSelectedIndex]);\n      }\n    };\n\n    return html`\n      <div class=\"lang-list-container\">\n        <div class=\"input-wrapper\">\n          <div class=\"search-icon\">${SearchIcon}</div>\n          <input\n            id=\"filter-input\"\n            type=\"text\"\n            placeholder=\"Search\"\n            @input=\"${() => {\n              this._filterText = this.filterInput?.value;\n              this._currentSelectedIndex = 0;\n            }}\"\n            @keydown=\"${onLanguageSelect}\"\n          />\n        </div>\n        <div class=\"lang-list-button-container\">\n          ${filteredLanguages.map(\n            (language, index) => html`\n              <icon-button\n                width=\"100%\"\n                height=\"32px\"\n                @click=\"${() => this._onLanguageClicked(language)}\"\n                class=\"lang-item\"\n                ?hover=${index === this._currentSelectedIndex}\n              >\n                ${language.id[0].toUpperCase() + language.id.slice(1)}\n              </icon-button>\n            `\n          )}\n        </div>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'lang-list': LangList;\n  }\n\n  interface HTMLElementEventMap {\n    /**\n     * @deprecated Use slot instead\n     */\n    'selected-language-changed': CustomEvent<{ language: string | null }>;\n    dispose: CustomEvent<null>;\n  }\n}\n", "import { BLOCK_ID_ATTR, PREVENT_DEFAULT } from '@blocksuite/global/config';\nimport type { BaseBlockModel } from '@blocksuite/store';\nimport { assertExists } from '@blocksuite/store';\n\nimport type { KeyboardBindings } from '../__internal__/rich-text/keyboard.js';\nimport type { AffineVEditor } from '../__internal__/rich-text/virgo/types.js';\nimport { BaseService } from '../__internal__/service/index.js';\nimport type {\n  BlockRange,\n  BlockTransformContext,\n  SerializedBlock,\n} from '../__internal__/utils/index.js';\nimport { getVirgoByModel } from '../__internal__/utils/index.js';\nimport type { CodeBlockModel } from './code-model.js';\nimport { getStandardLanguage } from './utils/code-languages.js';\nimport { FALLBACK_LANG } from './utils/consts.js';\n\nconst INDENT_SYMBOL = '  ';\nconst LINE_BREAK_SYMBOL = '\\n';\nconst allIndexOf = (\n  text: string,\n  symbol: string,\n  start = 0,\n  end = text.length\n) => {\n  const indexArr: number[] = [];\n  let i = start;\n\n  while (i < end) {\n    const index = text.indexOf(symbol, i);\n    if (index === -1 || index > end) {\n      break;\n    }\n    indexArr.push(index);\n    i = index + 1;\n  }\n  return indexArr;\n};\n\nexport class CodeBlockService extends BaseService<CodeBlockModel> {\n  setLang(model: CodeBlockModel, lang: string | null) {\n    const standardLang = getStandardLanguage(lang);\n    const langName = standardLang?.id ?? FALLBACK_LANG;\n    model.page.updateBlock(model, {\n      language: langName,\n    });\n  }\n\n  override block2html(\n    block: CodeBlockModel,\n    { childText = '', begin, end }: BlockTransformContext = {}\n  ): string {\n    const richTextElement = document.querySelector(\n      `[${BLOCK_ID_ATTR}=\"${block.id}\"] rich-text`\n    );\n    if (!richTextElement) {\n      return super.block2html(block, {\n        childText,\n        begin,\n        end,\n      });\n    }\n    const preElement = document.createElement('pre');\n    const codeElement = document.createElement('code');\n    preElement.setAttribute('code-lang', block.language);\n    codeElement.innerHTML = Array.from(\n      richTextElement.querySelectorAll('v-line')\n    )\n      .map(line => line.textContent + '\\n')\n      .join('');\n    preElement.append(codeElement);\n    return preElement.outerHTML;\n  }\n\n  override async json2Block(\n    focusedBlockModel: BaseBlockModel,\n    pastedBlocks: SerializedBlock[],\n    range?: BlockRange\n  ) {\n    assertExists(range);\n    const texts = pastedBlocks.map(block => block.text);\n    const lines = texts.map(line => line?.map(op => op.insert).join(''));\n    const text = lines.join('\\n');\n    focusedBlockModel.text?.insert(text, range.startOffset);\n\n    const vEditor = getVirgoByModel(focusedBlockModel);\n    assertExists(vEditor);\n    vEditor.setVRange({\n      index: range.startOffset + text.length,\n      length: 0,\n    });\n  }\n\n  override defineKeymap(\n    block: CodeBlockModel,\n    virgo: AffineVEditor\n  ): KeyboardBindings {\n    const keymap = super.defineKeymap(block, virgo);\n\n    return {\n      ...keymap,\n      tab: {\n        key: 'Tab',\n        handler(range, context) {\n          context.event.stopPropagation();\n          const text = this.vEditor.yText.toString();\n          const index = text.lastIndexOf(LINE_BREAK_SYMBOL, range.index - 1);\n          const indexArr = allIndexOf(\n            text,\n            LINE_BREAK_SYMBOL,\n            range.index,\n            range.index + range.length\n          )\n            .map(i => i + 1)\n            .reverse();\n          if (index !== -1) {\n            indexArr.push(index + 1);\n          } else {\n            indexArr.push(0);\n          }\n          indexArr.forEach(i => {\n            this.vEditor.insertText(\n              {\n                index: i,\n                length: 0,\n              },\n              INDENT_SYMBOL\n            );\n          });\n          this.vEditor.setVRange({\n            index: range.index + 2,\n            length: range.length + (indexArr.length - 1) * INDENT_SYMBOL.length,\n          });\n\n          return PREVENT_DEFAULT;\n        },\n      },\n      shiftTab: {\n        key: 'Tab',\n        shiftKey: true,\n        handler: function (range, context) {\n          context.event.stopPropagation();\n          const text = this.vEditor.yText.toString();\n          const index = text.lastIndexOf(LINE_BREAK_SYMBOL, range.index - 1);\n          let indexArr = allIndexOf(\n            text,\n            LINE_BREAK_SYMBOL,\n            range.index,\n            range.index + range.length\n          )\n            .map(i => i + 1)\n            .reverse();\n          if (index !== -1) {\n            indexArr.push(index + 1);\n          } else {\n            indexArr.push(0);\n          }\n          indexArr = indexArr.filter(\n            i => text.slice(i, i + 2) === INDENT_SYMBOL\n          );\n          indexArr.forEach(i => {\n            this.vEditor.deleteText({\n              index: i,\n              length: 2,\n            });\n          });\n          if (indexArr.length > 0) {\n            this.vEditor.setVRange({\n              index:\n                range.index -\n                (indexArr[indexArr.length - 1] < range.index ? 2 : 0),\n              length:\n                range.length - (indexArr.length - 1) * INDENT_SYMBOL.length,\n            });\n          }\n\n          return PREVENT_DEFAULT;\n        },\n      },\n    };\n  }\n}\n", "import type { AttributeRenderer } from '@blocksuite/virgo';\nimport { html } from 'lit';\nimport type { Highlighter, Lang } from 'shiki';\n\nexport const getCodeLineRenderer: (\n  highlightOptionsGetter: () => {\n    lang: Lang;\n    highlighter: Highlighter | null;\n  }\n) => AttributeRenderer = highlightOptionsGetter => delta => {\n  return html`<affine-code-line\n    .delta=${delta}\n    .highlightOptionsGetter=${highlightOptionsGetter}\n  ></affine-code-line>`;\n};\n", "import '../__internal__/rich-text/rich-text.js';\nimport '../components/portal.js';\nimport './components/code-option.js';\nimport './components/lang-list.js';\n\nimport { ArrowDownIcon } from '@blocksuite/global/config';\nimport { BlockElement } from '@blocksuite/lit';\nimport type { Disposable } from '@blocksuite/store';\nimport { assertExists, Slot } from '@blocksuite/store';\nimport { css, html, render } from 'lit';\nimport { customElement, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { styleMap } from 'lit/directives/style-map.js';\nimport {\n  BUNDLED_LANGUAGES,\n  getHighlighter,\n  type Highlighter,\n  type ILanguageRegistration,\n  type Lang,\n} from 'shiki';\nimport { z } from 'zod';\n\nimport { getViewportElement, queryCurrentMode } from '../__internal__/index.js';\nimport type { AffineTextSchema } from '../__internal__/rich-text/virgo/types.js';\nimport { getService, registerService } from '../__internal__/service.js';\nimport { listenToThemeChange } from '../__internal__/theme/utils.js';\nimport { tooltipStyle } from '../components/tooltip/tooltip.js';\nimport type { CodeBlockModel } from './code-model.js';\nimport { CodeBlockService } from './code-service.js';\nimport { CodeOptionTemplate } from './components/code-option.js';\nimport { getCodeLineRenderer } from './utils/code-line-renderer.js';\nimport { DARK_THEME, FALLBACK_LANG, LIGHT_THEME } from './utils/consts.js';\n\n@customElement('affine-code')\nexport class CodeBlockComponent extends BlockElement<CodeBlockModel> {\n  static override styles = css`\n    code-block {\n      position: relative;\n      z-index: 1;\n    }\n\n    .affine-code-block-container {\n      font-size: var(--affine-font-sm);\n      line-height: var(--affine-line-height);\n      position: relative;\n      padding: 32px 0px 12px 0px;\n      background: var(--affine-background-code-block);\n      border-radius: 10px;\n      margin-top: calc(var(--affine-paragraph-space) + 8px);\n      margin-bottom: calc(var(--affine-paragraph-space) + 8px);\n    }\n\n    /* hover area */\n    .affine-code-block-container::after {\n      content: '';\n      position: absolute;\n      top: 0;\n      right: 0;\n      width: 50px;\n      height: 100%;\n      transform: translateX(100%);\n    }\n\n    /* hover area */\n    .affine-code-block-container::after {\n      content: '';\n      position: absolute;\n      top: 0;\n      right: 0;\n      width: 50px;\n      height: 100%;\n      transform: translateX(100%);\n    }\n\n    .affine-code-block-container .virgo-editor {\n      font-family: var(--affine-font-code-family);\n      font-variant-ligatures: none;\n    }\n\n    .affine-code-block-container .lang-list-wrapper {\n      position: absolute;\n      font-size: var(--affine-font-sm);\n      line-height: var(--affine-line-height);\n      top: 12px;\n      left: 12px;\n    }\n\n    .affine-code-block-container > .lang-list-wrapper {\n      visibility: hidden;\n    }\n    .affine-code-block-container:hover > .lang-list-wrapper {\n      visibility: visible;\n    }\n\n    .affine-code-block-container > .lang-list-wrapper > .lang-button {\n      display: flex;\n      justify-content: flex-start;\n      padding: 0 8px;\n    }\n\n    .affine-code-block-container rich-text {\n      /* to make sure the resize observer can be triggered as expected */\n      display: block;\n      position: relative;\n      width: 90%;\n      overflow-x: auto;\n      overflow-y: hidden;\n      padding-bottom: 20px;\n    }\n\n    .affine-code-block-container .rich-text-container {\n      position: relative;\n      border-radius: 5px;\n      padding: 4px 12px 4px 60px;\n    }\n\n    #line-numbers {\n      position: absolute;\n      text-align: right;\n      left: 20px;\n      line-height: var(--affine-line-height);\n      color: var(--affine-text-secondary-color);\n    }\n\n    .affine-code-block-container .virgo-editor {\n      width: 90%;\n      margin: 0;\n    }\n\n    .affine-code-block-container affine-code-line span v-text {\n      display: inline;\n    }\n\n    .affine-code-block-container affine-code-line span {\n      white-space: pre;\n    }\n\n    .affine-code-block-container.wrap #line-numbers {\n      top: calc(var(--affine-line-height) + 4px);\n    }\n\n    .affine-code-block-container.wrap #line-numbers > div {\n      margin-top: calc(\n        var(--top, 0) / var(--affine-zoom, 1) - var(--affine-line-height)\n      );\n    }\n\n    .affine-code-block-container.wrap v-line > div {\n      display: block;\n    }\n\n    .affine-code-block-container.wrap affine-code-line span {\n      white-space: break-spaces;\n    }\n\n    .affine-code-block-container .virgo-editor::-webkit-scrollbar {\n      display: none;\n    }\n\n    .code-block-option {\n      box-shadow: var(--affine-shadow-2);\n      border-radius: 8px;\n      list-style: none;\n      padding: 4px;\n      width: 40px;\n      background-color: var(--affine-background-overlay-panel-color);\n      margin: 0;\n    }\n\n    ${tooltipStyle}\n  `;\n\n  @state()\n  private _showLangList = false;\n\n  @state()\n  private _optionPosition: { x: number; y: number } | null = null;\n\n  @state()\n  private _wrap = false;\n\n  readonly textSchema: AffineTextSchema = {\n    attributesSchema: z.object({}),\n    textRenderer: () =>\n      getCodeLineRenderer(() => ({\n        lang: this.model.language.toLowerCase() as Lang,\n        highlighter: this._highlighter,\n      })),\n  };\n\n  private _richTextResizeObserver: ResizeObserver = new ResizeObserver(() => {\n    this._updateLineNumbers();\n  });\n  private _themeChangeObserver: Disposable | null = null;\n\n  private _preLang: string | null = null;\n  private _highlighter: Highlighter | null = null;\n  private async _startHighlight(lang: ILanguageRegistration) {\n    const mode = queryCurrentMode();\n    this._highlighter = await getHighlighter({\n      theme: mode === 'dark' ? DARK_THEME : LIGHT_THEME,\n      themes: [LIGHT_THEME, DARK_THEME],\n      langs: [lang],\n      paths: {\n        // TODO: use local path\n        wasm: 'https://cdn.jsdelivr.net/npm/shiki/dist',\n        themes: 'https://cdn.jsdelivr.net/',\n        languages: 'https://cdn.jsdelivr.net/npm/shiki/languages',\n      },\n    });\n\n    const richText = this.querySelector('rich-text');\n    assertExists(richText);\n    const vEditor = richText.vEditor;\n    assertExists(vEditor);\n    const range = vEditor.getVRange();\n    vEditor.requestUpdate();\n    if (range) {\n      vEditor.setVRange(range);\n    }\n  }\n\n  get readonly() {\n    return this.model.page.readonly;\n  }\n\n  hoverState = new Slot<boolean>();\n\n  override connectedCallback() {\n    super.connectedCallback();\n    registerService('affine:code', CodeBlockService);\n    this._disposables.add(\n      this.model.propsUpdated.on(() => this.requestUpdate())\n    );\n    this._disposables.add(\n      this.model.childrenUpdated.on(() => this.requestUpdate())\n    );\n\n    // At AFFiNE, avoid the option element to be covered by the header\n    // we need to reserve the space for the header\n    const HEADER_HEIGHT = 64;\n    // The height of the option element\n    // You need to change this value manually if you change the style of the option element\n    const OPTION_ELEMENT_HEIGHT = 96;\n\n    let timer: number;\n    const updatePosition = () => {\n      // Update option position when scrolling\n      const rect = this.getBoundingClientRect();\n      this._optionPosition = {\n        x: rect.right + 12,\n        y: Math.min(\n          Math.max(rect.top, HEADER_HEIGHT + 12),\n          rect.bottom - OPTION_ELEMENT_HEIGHT\n        ),\n      };\n    };\n    this.hoverState.on(hover => {\n      clearTimeout(timer);\n      if (hover) {\n        updatePosition();\n        return;\n      }\n      timer = window.setTimeout(() => {\n        this._optionPosition = null;\n      }, HOVER_DELAY);\n    });\n    this._disposables.addFromEvent(this, 'mouseover', e => {\n      this.hoverState.emit(true);\n    });\n    const HOVER_DELAY = 300;\n    this._disposables.addFromEvent(this, 'mouseleave', e => {\n      this.hoverState.emit(false);\n    });\n\n    const viewportElement = getViewportElement(this.model.page);\n    if (viewportElement) {\n      this._disposables.addFromEvent(viewportElement, 'scroll', e => {\n        if (!this._optionPosition) return;\n        updatePosition();\n      });\n    }\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.hoverState.dispose();\n    this._richTextResizeObserver.disconnect();\n    this._themeChangeObserver?.dispose();\n  }\n\n  private _onClickWrapBtn() {\n    const container = this.querySelector('.affine-code-block-container');\n    assertExists(container);\n    this._wrap = container.classList.toggle('wrap');\n  }\n\n  protected override firstUpdated() {\n    this._themeChangeObserver = listenToThemeChange(this, async a => {\n      if (!this._highlighter) return;\n      const richText = this.querySelector('rich-text');\n      const vEditor = richText?.vEditor;\n      if (!vEditor) return;\n\n      // update code-line theme\n      setTimeout(() => {\n        vEditor.requestUpdate();\n      });\n    });\n\n    if (!this.model.language || this.model.language === FALLBACK_LANG) {\n      this._highlighter = null;\n      return;\n    }\n\n    const lang = BUNDLED_LANGUAGES.find(\n      lang => lang.id === this.model.language.toLowerCase()\n    );\n    if (!lang) {\n      console.warn('Unexpected language: ', this.model.language);\n      return;\n    }\n    this._startHighlight(lang);\n  }\n\n  override updated() {\n    if (this.model.language !== this._preLang) {\n      this._preLang = this.model.language;\n\n      const lang = BUNDLED_LANGUAGES.find(\n        lang => lang.id === this.model.language.toLowerCase()\n      );\n      if (lang) {\n        if (this._highlighter) {\n          const currentLangs = this._highlighter.getLoadedLanguages();\n          if (!currentLangs.includes(lang.id as Lang)) {\n            this._highlighter.loadLanguage(lang).then(() => {\n              const richText = this.querySelector('rich-text');\n              const vEditor = richText?.vEditor;\n              if (vEditor) {\n                vEditor.requestUpdate();\n              }\n            });\n          }\n        } else {\n          this._startHighlight(lang);\n        }\n      } else {\n        this._highlighter = null;\n      }\n\n      const richText = this.querySelector('rich-text');\n      const vEditor = richText?.vEditor;\n      if (vEditor) {\n        vEditor.requestUpdate();\n      }\n    }\n\n    const richText = this.querySelector('rich-text');\n    assertExists(richText);\n    this._richTextResizeObserver.disconnect();\n    this._richTextResizeObserver.observe(richText);\n  }\n\n  private _onClickLangBtn() {\n    if (this.readonly) return;\n    this._showLangList = !this._showLangList;\n  }\n\n  private _langListTemplate() {\n    // TODO this is a workaround\n    const normalizedLang =\n      this.model.language[0].toUpperCase() + this.model.language.slice(1);\n    return html`<div\n      class=\"lang-list-wrapper\"\n      style=\"${this._showLangList ? 'visibility: visible;' : ''}\"\n    >\n      <icon-button\n        class=\"lang-button\"\n        data-testid=\"lang-button\"\n        width=\"auto\"\n        height=\"24px\"\n        ?hover=${this._showLangList}\n        ?disabled=${this.readonly}\n        @click=${this._onClickLangBtn}\n      >\n        ${normalizedLang} ${!this.readonly ? ArrowDownIcon : html``}\n      </icon-button>\n      ${this._showLangList\n        ? html`<lang-list\n            @selected-language-changed=${(e: CustomEvent) => {\n              getService('affine:code').setLang(this.model, e.detail.language);\n              this._showLangList = false;\n            }}\n            @dispose=${() => {\n              this._showLangList = false;\n            }}\n          ></lang-list>`\n        : ''}\n    </div>`;\n  }\n\n  private _codeOptionTemplate() {\n    if (!this._optionPosition) return '';\n    return html`<affine-portal\n      .template=${CodeOptionTemplate({\n        model: this.model,\n        position: this._optionPosition,\n        hoverState: this.hoverState,\n        wrap: this._wrap,\n        onClickWrap: () => this._onClickWrapBtn(),\n      })}\n    ></affine-portal>`;\n  }\n\n  private _updateLineNumbers() {\n    const lineNumbersContainer =\n      this.querySelector<HTMLElement>('#line-numbers');\n    assertExists(lineNumbersContainer);\n\n    const next = this._wrap ? generateLineNumberRender() : lineNumberRender;\n\n    render(\n      repeat(Array.from(this.querySelectorAll('v-line')), next),\n      lineNumbersContainer\n    );\n  }\n\n  override render() {\n    return html`<div class=\"affine-code-block-container\">\n        ${this._langListTemplate()}\n        <div class=\"rich-text-container\">\n          <div id=\"line-numbers\"></div>\n          <rich-text .model=${this.model} .textSchema=${this.textSchema}>\n          </rich-text>\n        </div>\n        ${this.content}\n      </div>\n      ${this._codeOptionTemplate()}`;\n  }\n}\n\nfunction generateLineNumberRender(top = 0) {\n  return function lineNumberRender(e: HTMLElement, index: number) {\n    const style = {\n      '--top': `${top}px`,\n    };\n    top = e.getBoundingClientRect().height;\n    return html`<div style=${styleMap(style)}>${index + 1}</div>`;\n  };\n}\n\nfunction lineNumberRender(_: HTMLElement, index: number) {\n  return html`<div>${index + 1}</div>`;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-code': CodeBlockComponent;\n  }\n}\n", "import { defineBlockSchema, type SchemaToModel } from '@blocksuite/store';\nimport { literal } from 'lit/static-html.js';\n\nimport { FALLBACK_LANG } from './utils/consts.js';\n\nexport const CodeBlockSchema = defineBlockSchema({\n  flavour: 'affine:code',\n  props: internal => ({\n    text: internal.Text(),\n    language: FALLBACK_LANG,\n  }),\n  metadata: {\n    version: 1,\n    role: 'content',\n    tag: literal`affine-code`,\n    parent: ['affine:frame', 'affine:paragraph', 'affine:list'],\n    children: [],\n  },\n});\n\nexport type CodeBlockModel = SchemaToModel<typeof CodeBlockSchema>;\n", "import type { BlockSchemaType } from '@blocksuite/store';\nimport type { StaticValue } from 'lit/static-html.js';\nimport { literal } from 'lit/static-html.js';\n\nimport { BookmarkBlockSchema } from '../bookmark-block/index.js';\nimport { CodeBlockSchema } from '../code-block/code-model.js';\nimport { DatabaseBlockSchema } from '../database-block/database-model.js';\nimport { DividerBlockSchema } from '../divider-block/divider-model.js';\nimport { EmbedBlockSchema } from '../embed-block/embed-model.js';\nimport { FrameBlockSchema } from '../frame-block/frame-model.js';\nimport { ListBlockSchema } from '../list-block/list-model.js';\nimport { PageBlockSchema } from '../page-block/page-model.js';\nimport { ParagraphBlockSchema } from '../paragraph-block/paragraph-model.js';\nimport { SurfaceBlockSchema } from '../surface-block/surface-model.js';\n\nexport const pagePreset = new Map<BlockSchemaType, StaticValue>([\n  [PageBlockSchema, literal`affine-default-page`],\n  [SurfaceBlockSchema, literal`affine-surface`],\n  [ListBlockSchema, literal`affine-list`],\n  [FrameBlockSchema, literal`affine-frame`],\n  [DatabaseBlockSchema, literal`affine-database`],\n  [DividerBlockSchema, literal`affine-divider`],\n  [CodeBlockSchema, literal`affine-code`],\n  [EmbedBlockSchema, literal`affine-embed`],\n  [ParagraphBlockSchema, literal`affine-paragraph`],\n  [BookmarkBlockSchema, literal`affine-bookmark`],\n]);\n\nexport const edgelessPreset = new Map<BlockSchemaType, StaticValue>([\n  [PageBlockSchema, literal`affine-edgeless-page`],\n  [SurfaceBlockSchema, literal`affine-surface`],\n  [ListBlockSchema, literal`affine-list`],\n  [FrameBlockSchema, literal`affine-frame`],\n  [DatabaseBlockSchema, literal`affine-database`],\n  [DividerBlockSchema, literal`affine-divider`],\n  [CodeBlockSchema, literal`affine-code`],\n  [EmbedBlockSchema, literal`affine-embed`],\n  [ParagraphBlockSchema, literal`affine-paragraph`],\n  [BookmarkBlockSchema, literal`affine-bookmark`],\n]);\n", "/// <reference types=\"@blocksuite/global\" />\n// manual import to avoid being tree-shaken\nimport './page-block/index.js';\nimport './counter-block/index.js';\nimport './paragraph-block/index.js';\nimport './list-block/index.js';\nimport './frame-block/index.js';\nimport './divider-block/index.js';\nimport './__internal__/rich-text/link-node/index.js';\nimport './__internal__/rich-text/reference-node.js';\nimport './code-block/affine-code-line.js';\nimport './__internal__/rich-text/virgo/affine-text.js';\nimport './__internal__/rich-text/link-node/affine-link.js';\nimport './embed-block/index.js';\nimport './embed-block/image/index.js';\nimport './surface-block/index.js';\nimport './database-block/index.js';\n\nexport * from './__internal__/rich-text/rich-text-operations.js';\nexport { getServiceOrRegister } from './__internal__/service.js';\nexport type { BaseService } from './__internal__/service/index.js';\nexport type { CssVariableName } from './__internal__/theme/css-variables.js';\nexport * from './__internal__/theme/css-variables.js';\nexport * from './__internal__/theme/theme-observer.js';\nexport * from './__internal__/utils/active-editor-manager.js';\nexport * from './__internal__/utils/block-range.js';\nexport * from './__internal__/utils/common-operations.js';\nexport * from './__internal__/utils/filesys.js';\nexport * from './__internal__/utils/query.js';\nexport * from './__internal__/utils/rect.js';\nexport * as SelectionUtils from './__internal__/utils/selection.js';\nexport * from './__internal__/utils/std.js';\nexport * from './__internal__/utils/types.js';\nexport * from './bookmark-block/index.js';\nexport * from './code-block/index.js';\nexport { FormatQuickBar } from './components/format-quick-bar/format-bar-node.js';\nexport * from './components/index.js';\nexport * from './counter-block/index.js';\nexport * from './database-block/index.js';\nexport * from './divider-block/index.js';\nexport * from './embed-block/image/index.js';\nexport * from './embed-block/index.js';\nexport * from './frame-block/index.js';\nexport * from './list-block/index.js';\nexport * from './page-block/index.js';\nexport * from './paragraph-block/index.js';\nexport * from './preset/index.js';\nexport * from './surface-block/index.js';\nconst env: Record<string, unknown> =\n  typeof globalThis !== 'undefined'\n    ? globalThis\n    : typeof window !== 'undefined'\n    ? window\n    : // @ts-ignore\n    typeof global !== 'undefined'\n    ? // @ts-ignore\n      global\n    : {};\nconst importIdentifier = '__ $BLOCKSUITE_BLOCKS$ __';\n\nif (env[importIdentifier] === true) {\n  // https://github.com/yjs/yjs/issues/438\n  console.error(\n    '@blocksuite/blocks was already imported. This breaks constructor checks and will lead to issues!'\n  );\n}\n\nif (typeof window === 'undefined') {\n  throw new Error(\n    'Seems like you are importing @blocksuite/blocks in SSR mode. Which is not supported for now.'\n  );\n}\n\nenv[importIdentifier] = true;\n", "export const EPSILON = 1e-12;\nexport const MACHINE_EPSILON = 1.12e-16;\n", "import { clamp, type Point } from '@blocksuite/blocks';\nimport { almostEqual } from '@blocksuite/blocks';\n\nimport { EPSILON, MACHINE_EPSILON } from './numerical.js';\n\nexport class Line {\n  static intersect(\n    sp: Point,\n    ep: Point,\n    sp2: Point,\n    ep2: Point,\n    infinite = false\n  ): Point | null {\n    const v1 = ep.subtract(sp);\n    const v2 = ep2.subtract(sp2);\n    const cross = v1.cross(v2);\n    // Avoid divisions by 0, and errors when getting too close to 0\n    if (almostEqual(cross, 0, MACHINE_EPSILON)) return null;\n    const d = sp.subtract(sp2);\n    let u1 = v2.cross(d) / cross;\n    const u2 = v1.cross(d) / cross,\n      // Check the ranges of the u parameters if the line is not\n      // allowed to extend beyond the definition points, but\n      // compare with EPSILON tolerance over the [0, 1] bounds.\n      epsilon = /*#=*/ EPSILON,\n      uMin = -epsilon,\n      uMax = 1 + epsilon;\n\n    if (infinite || (uMin < u1 && u1 < uMax && uMin < u2 && u2 < uMax)) {\n      // Address the tolerance at the bounds by clipping to\n      // the actual range.\n      if (!infinite) {\n        u1 = clamp(u1, 0, 1);\n      }\n      return sp.lerp(v1, u1);\n    }\n    return null;\n  }\n}\n", "// Inlined from https://raw.githubusercontent.com/tldraw/tldraw/24cad6959f59f93e20e556d018c391fd89d4ecca/packages/vec/src/index.ts\n// Credits to tldraw\n\nexport class Vec {\n  /**\n   * Clamp a value into a range.\n   * @param n\n   * @param min\n   */\n  static clamp(n: number, min: number): number;\n  static clamp(n: number, min: number, max: number): number;\n  static clamp(n: number, min: number, max?: number): number {\n    return Math.max(min, typeof max !== 'undefined' ? Math.min(n, max) : n);\n  }\n\n  /**\n   * Clamp a value into a range.\n   * @param n\n   * @param min\n   */\n  static clampV(A: number[], min: number): number[];\n  static clampV(A: number[], min: number, max: number): number[];\n  static clampV(A: number[], min: number, max?: number): number[] {\n    return A.map(n => (max ? Vec.clamp(n, min, max) : Vec.clamp(n, min)));\n  }\n\n  /**\n   * Negate a vector.\n   * @param A\n   */\n  static neg = (A: number[]): number[] => {\n    return [-A[0], -A[1]];\n  };\n\n  /**\n   * Add vectors.\n   * @param A\n   * @param B\n   */\n  static add = (A: number[], B: number[]): number[] => {\n    return [A[0] + B[0], A[1] + B[1]];\n  };\n\n  /**\n   * Add scalar to vector.\n   * @param A\n   * @param B\n   */\n  static addScalar = (A: number[], n: number): number[] => {\n    return [A[0] + n, A[1] + n];\n  };\n\n  /**\n   * Subtract vectors.\n   * @param A\n   * @param B\n   */\n  static sub = (A: number[], B: number[]): number[] => {\n    return [A[0] - B[0], A[1] - B[1]];\n  };\n\n  /**\n   * Subtract scalar from vector.\n   * @param A\n   * @param B\n   */\n  static subScalar = (A: number[], n: number): number[] => {\n    return [A[0] - n, A[1] - n];\n  };\n\n  /**\n   * Get the vector from vectors A to B.\n   * @param A\n   * @param B\n   */\n  static vec = (A: number[], B: number[]): number[] => {\n    // A, B as vectors get the vector from A to B\n    return [B[0] - A[0], B[1] - A[1]];\n  };\n\n  /**\n   * Vector multiplication by scalar\n   * @param A\n   * @param n\n   */\n  static mul = (A: number[], n: number): number[] => {\n    return [A[0] * n, A[1] * n];\n  };\n\n  /**\n   * Multiple two vectors.\n   * @param A\n   * @param B\n   */\n  static mulV = (A: number[], B: number[]): number[] => {\n    return [A[0] * B[0], A[1] * B[1]];\n  };\n\n  /**\n   * Vector division by scalar.\n   * @param A\n   * @param n\n   */\n  static div = (A: number[], n: number): number[] => {\n    return [A[0] / n, A[1] / n];\n  };\n\n  /**\n   * Vector division by vector.\n   * @param A\n   * @param n\n   */\n  static divV = (A: number[], B: number[]): number[] => {\n    return [A[0] / B[0], A[1] / B[1]];\n  };\n\n  /**\n   * Perpendicular rotation of a vector A\n   * @param A\n   */\n  static per = (A: number[]): number[] => {\n    return [A[1], -A[0]];\n  };\n\n  /**\n   * Dot product\n   * @param A\n   * @param B\n   */\n  static dpr = (A: number[], B: number[]): number => {\n    return A[0] * B[0] + A[1] * B[1];\n  };\n\n  /**\n   * Cross product (outer product) | A X B |\n   * @param A\n   * @param B\n   */\n  static cpr = (A: number[], B: number[]): number => {\n    return A[0] * B[1] - B[0] * A[1];\n  };\n\n  /**\n   * Cross (for point in polygon)\n   *\n   */\n  static cross(x: number[], y: number[], z: number[]): number {\n    return (y[0] - x[0]) * (z[1] - x[1]) - (z[0] - x[0]) * (y[1] - x[1]);\n  }\n\n  /**\n   * Length of the vector squared\n   * @param A\n   */\n  static len2 = (A: number[]): number => {\n    return A[0] * A[0] + A[1] * A[1];\n  };\n\n  /**\n   * Length of the vector\n   * @param A\n   */\n  static len = (A: number[]): number => {\n    return Math.hypot(A[0], A[1]);\n  };\n\n  /**\n   * Project A over B\n   * @param A\n   * @param B\n   */\n  static pry = (A: number[], B: number[]): number => {\n    return Vec.dpr(A, B) / Vec.len(B);\n  };\n\n  /**\n   * Get normalized / unit vector.\n   * @param A\n   */\n  static uni = (A: number[]): number[] => {\n    return Vec.div(A, Vec.len(A));\n  };\n\n  /**\n   * Get normalized / unit vector.\n   * @param A\n   */\n  static normalize = (A: number[]): number[] => {\n    return Vec.uni(A);\n  };\n\n  /**\n   * Get the tangent between two vectors.\n   * @param A\n   * @param B\n   * @returns\n   */\n  static tangent = (A: number[], B: number[]): number[] => {\n    return Vec.uni(Vec.sub(A, B));\n  };\n\n  /**\n   * Dist length from A to B squared.\n   * @param A\n   * @param B\n   */\n  static dist2 = (A: number[], B: number[]): number => {\n    return Vec.len2(Vec.sub(A, B));\n  };\n\n  /**\n   * Dist length from A to B\n   * @param A\n   * @param B\n   */\n  static dist = (A: number[], B: number[]): number => {\n    return Math.hypot(A[1] - B[1], A[0] - B[0]);\n  };\n\n  /**\n   * A faster, though less accurate method for testing distances. Maybe faster?\n   * @param A\n   * @param B\n   * @returns\n   */\n  static fastDist = (A: number[], B: number[]): number[] => {\n    const V = [B[0] - A[0], B[1] - A[1]];\n    const aV = [Math.abs(V[0]), Math.abs(V[1])];\n    let r = 1 / Math.max(aV[0], aV[1]);\n    r = r * (1.29289 - (aV[0] + aV[1]) * r * 0.29289);\n    return [V[0] * r, V[1] * r];\n  };\n\n  /**\n   * Angle between vector A and vector B in radians\n   * @param A\n   * @param B\n   */\n  static ang = (A: number[], B: number[]): number => {\n    return Math.atan2(Vec.cpr(A, B), Vec.dpr(A, B));\n  };\n\n  /**\n   * Angle between vector A and vector B in radians\n   * @param A\n   * @param B\n   */\n  static angle = (A: number[], B: number[]): number => {\n    return Math.atan2(B[1] - A[1], B[0] - A[0]);\n  };\n\n  /**\n   * Mean between two vectors or mid vector between two vectors\n   * @param A\n   * @param B\n   */\n  static med = (A: number[], B: number[]): number[] => {\n    return Vec.mul(Vec.add(A, B), 0.5);\n  };\n\n  /**\n   * Vector rotation by r (radians)\n   * @param A\n   * @param r rotation in radians\n   */\n  static rot = (A: number[], r = 0): number[] => {\n    return [\n      A[0] * Math.cos(r) - A[1] * Math.sin(r),\n      A[0] * Math.sin(r) + A[1] * Math.cos(r),\n    ];\n  };\n\n  /**\n   * Rotate a vector around another vector by r (radians)\n   * @param A vector\n   * @param C center\n   * @param r rotation in radians\n   */\n  static rotWith = (A: number[], C: number[], r = 0): number[] => {\n    if (r === 0) return A;\n\n    const s = Math.sin(r);\n    const c = Math.cos(r);\n\n    const px = A[0] - C[0];\n    const py = A[1] - C[1];\n\n    const nx = px * c - py * s;\n    const ny = px * s + py * c;\n\n    return [nx + C[0], ny + C[1]];\n  };\n\n  /**\n   * Check of two vectors are identical.\n   * @param A\n   * @param B\n   */\n  static isEqual = (A: number[], B: number[]): boolean => {\n    return A[0] === B[0] && A[1] === B[1];\n  };\n\n  /**\n   * Interpolate vector A to B with a scalar t\n   * @param A\n   * @param B\n   * @param t scalar\n   */\n  static lrp = (A: number[], B: number[], t: number): number[] => {\n    return Vec.add(A, Vec.mul(Vec.sub(B, A), t));\n  };\n\n  /**\n   * Interpolate from A to B when curVAL goes fromVAL: number[] => to\n   * @param A\n   * @param B\n   * @param from Starting value\n   * @param to Ending value\n   * @param s Strength\n   */\n  static int = (\n    A: number[],\n    B: number[],\n    from: number,\n    to: number,\n    s = 1\n  ): number[] => {\n    const t = (Vec.clamp(from, to) - from) / (to - from);\n    return Vec.add(Vec.mul(A, 1 - t), Vec.mul(B, s));\n  };\n\n  /**\n   * Get the angle between the three vectors A, B, and C.\n   * @param p1\n   * @param pc\n   * @param p2\n   */\n  static ang3 = (p1: number[], pc: number[], p2: number[]): number => {\n    // this,\n    const v1 = Vec.vec(pc, p1);\n    const v2 = Vec.vec(pc, p2);\n    return Vec.ang(v1, v2);\n  };\n\n  /**\n   * Absolute value of a vector.\n   * @param A\n   * @returns\n   */\n  static abs = (A: number[]): number[] => {\n    return [Math.abs(A[0]), Math.abs(A[1])];\n  };\n\n  static rescale = (a: number[], n: number): number[] => {\n    const l = Vec.len(a);\n    return [(n * a[0]) / l, (n * a[1]) / l];\n  };\n\n  /**\n   * Get whether p1 is left of p2, relative to pc.\n   * @param p1\n   * @param pc\n   * @param p2\n   */\n  static isLeft = (p1: number[], pc: number[], p2: number[]): number => {\n    //  isLeft: >0 for counterclockwise\n    //          =0 for none (degenerate)\n    //          <0 for clockwise\n    return (\n      (pc[0] - p1[0]) * (p2[1] - p1[1]) - (p2[0] - p1[0]) * (pc[1] - p1[1])\n    );\n  };\n\n  /**\n   * Get whether p1 is left of p2, relative to pc.\n   * @param p1\n   * @param pc\n   * @param p2\n   */\n  static clockwise = (p1: number[], pc: number[], p2: number[]): boolean => {\n    return Vec.isLeft(p1, pc, p2) > 0;\n  };\n\n  /**\n   * Round a vector to two decimal places.\n   * @param a\n   */\n  static toFixed = (a: number[]): number[] => {\n    return a.map(v => Math.round(v * 100) / 100);\n  };\n\n  /**\n   * Snap vector to nearest step.\n   * @param A\n   * @param step\n   * @example\n   * ```ts\n   * Vec.snap([10.5, 28], 10) // [10, 30]\n   * ```\n   */\n  static snap(a: number[], step = 1) {\n    return [Math.round(a[0] / step) * step, Math.round(a[1] / step) * step];\n  }\n\n  /**\n   * Get the nearest point on a line with a known unit vector that passes through point A\n   * @param A Any point on the line\n   * @param u The unit vector for the line.\n   * @param P A point not on the line to test.\n   * @returns\n   */\n  static nearestPointOnLineThroughPoint = (\n    A: number[],\n    u: number[],\n    P: number[]\n  ): number[] => {\n    return Vec.add(A, Vec.mul(u, Vec.pry(Vec.sub(P, A), u)));\n  };\n\n  /**\n   * Distance between a point and a line with a known unit vector that passes through a point.\n   * @param A Any point on the line\n   * @param u The unit vector for the line.\n   * @param P A point not on the line to test.\n   * @returns\n   */\n  static distanceToLineThroughPoint = (\n    A: number[],\n    u: number[],\n    P: number[]\n  ): number => {\n    return Vec.dist(P, Vec.nearestPointOnLineThroughPoint(A, u, P));\n  };\n\n  /**\n   * Get the nearest point on a line segment between A and B\n   * @param A The start of the line segment\n   * @param B The end of the line segment\n   * @param P The off-line point\n   * @param clamp Whether to clamp the point between A and B.\n   * @returns\n   */\n  static nearestPointOnLineSegment = (\n    A: number[],\n    B: number[],\n    P: number[],\n    clamp = true\n  ): number[] => {\n    const u = Vec.uni(Vec.sub(B, A));\n    const C = Vec.add(A, Vec.mul(u, Vec.pry(Vec.sub(P, A), u)));\n\n    if (clamp) {\n      if (C[0] < Math.min(A[0], B[0])) return A[0] < B[0] ? A : B;\n      if (C[0] > Math.max(A[0], B[0])) return A[0] > B[0] ? A : B;\n      if (C[1] < Math.min(A[1], B[1])) return A[1] < B[1] ? A : B;\n      if (C[1] > Math.max(A[1], B[1])) return A[1] > B[1] ? A : B;\n    }\n\n    return C;\n  };\n\n  /**\n   * Distance between a point and the nearest point on a line segment between A and B\n   * @param A The start of the line segment\n   * @param B The end of the line segment\n   * @param P The off-line point\n   * @param clamp Whether to clamp the point between A and B.\n   * @returns\n   */\n  static distanceToLineSegment = (\n    A: number[],\n    B: number[],\n    P: number[],\n    clamp = true\n  ): number => {\n    return Vec.dist(P, Vec.nearestPointOnLineSegment(A, B, P, clamp));\n  };\n\n  /**\n   * Get the nearest point on a bounding box to a point P.\n   * @param bounds The bounding box\n   * @param P The point point\n   * @returns\n   */\n  static nearestPointOnBounds = (\n    bounds: {\n      minX: number;\n      minY: number;\n      maxX: number;\n      maxY: number;\n    },\n    P: number[]\n  ): number[] => {\n    return [\n      Vec.clamp(P[0], bounds.minX, bounds.maxX),\n      Vec.clamp(P[1], bounds.minY, bounds.maxY),\n    ];\n  };\n\n  /**\n   * Distance between a point and the nearest point on a bounding box.\n   * @param bounds The bounding box.\n   * @param P The point\n   * @returns\n   */\n  static distanceToBounds = (\n    bounds: {\n      minX: number;\n      minY: number;\n      maxX: number;\n      maxY: number;\n    },\n    P: number[]\n  ): number => {\n    return Vec.dist(P, Vec.nearestPointOnBounds(bounds, P));\n  };\n\n  /**\n   * Push a point A towards point B by a given distance.\n   * @param A\n   * @param B\n   * @param d\n   * @returns\n   */\n  static nudge = (A: number[], B: number[], d: number): number[] => {\n    if (Vec.isEqual(A, B)) return A;\n    return Vec.add(A, Vec.mul(Vec.uni(Vec.sub(B, A)), d));\n  };\n\n  /**\n   * Push a point in a given angle by a given distance.\n   * @param A\n   * @param B\n   * @param d\n   */\n  static nudgeAtAngle = (A: number[], a: number, d: number): number[] => {\n    return [Math.cos(a) * d + A[0], Math.sin(a) * d + A[1]];\n  };\n\n  /**\n   * Round a vector to a precision length.\n   * @param a\n   * @param n\n   */\n  static toPrecision = (a: number[], n = 4): number[] => {\n    return [+a[0].toPrecision(n), +a[1].toPrecision(n)];\n  };\n\n  /**\n   * Get an array of points between two points.\n   * @param A The first point.\n   * @param B The second point.\n   * @param steps The number of points to return.\n   */\n  static pointsBetween = (A: number[], B: number[], steps = 6): number[][] => {\n    return Array.from(Array(steps)).map((_, i) => {\n      const t = i / (steps - 1);\n      const k = Math.min(1, 0.5 + Math.abs(0.5 - t));\n      return [...Vec.lrp(A, B, t), k];\n    });\n  };\n\n  /**\n   * Get the slope between two points.\n   * @param A\n   * @param B\n   */\n  static slope = (A: number[], B: number[]) => {\n    if (A[0] === B[0]) return NaN;\n    return (A[1] - B[1]) / (A[0] - B[0]);\n  };\n\n  /**\n   * Get a vector comprised of the maximum of two or more vectors.\n   */\n  static max = (...v: number[][]) => {\n    return [Math.max(...v.map(a => a[0])), Math.max(...v.map(a => a[1]))];\n  };\n\n  /**\n   * Get a vector comprised of the minimum of two or more vectors.\n   */\n  static min = (...v: number[][]) => {\n    return [Math.min(...v.map(a => a[0])), Math.min(...v.map(a => a[1]))];\n  };\n\n  static rotAround = (A: number[], C: number[], r: number): number[] => {\n    const s = Math.sin(r);\n    const c = Math.cos(r);\n\n    const px = A[0] - C[0];\n    const py = A[1] - C[1];\n\n    const nx = px * c - py * s;\n    const ny = px * s + py * c;\n\n    return [nx + C[0], ny + C[1]];\n  };\n}\n", "// https://github.com/tldraw/tldraw/blob/31f0f02adf58b909f59764f62de09e97542eb2b1/packages/core/src/utils/utils.ts\n// Credits to tldraw\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport type { StrokePoint } from '../perfect-freehand/types.js';\nimport { Vec } from './vec.js';\n\nconst TAU = Math.PI * 2;\n\ntype Patch<T> = Partial<{\n  [P in keyof T]: T | Partial<T> | Patch<T[P]>;\n}>;\n\nenum TLBoundsEdge {\n  Top = 'top_edge',\n  Right = 'right_edge',\n  Bottom = 'bottom_edge',\n  Left = 'left_edge',\n}\n\nenum TLBoundsCorner {\n  TopLeft = 'top_left_corner',\n  TopRight = 'top_right_corner',\n  BottomRight = 'bottom_right_corner',\n  BottomLeft = 'bottom_left_corner',\n}\ninterface TLBounds {\n  minX: number;\n  minY: number;\n  maxX: number;\n  maxY: number;\n  width: number;\n  height: number;\n  rotation?: number;\n}\n\ninterface TLBoundsWithCenter extends TLBounds {\n  midX: number;\n  midY: number;\n}\n\nenum SnapPoints {\n  minX = 'minX',\n  midX = 'midX',\n  maxX = 'maxX',\n  minY = 'minY',\n  midY = 'midY',\n  maxY = 'maxY',\n}\n\ntype Snap =\n  | { id: SnapPoints; isSnapped: false }\n  | {\n      id: SnapPoints;\n      isSnapped: true;\n      to: number;\n      B: TLBoundsWithCenter;\n      distance: number;\n    };\n\nexport class Utils {\n  /* -------------------------------------------------- */\n  /*                    Math & Geometry                 */\n  /* -------------------------------------------------- */\n\n  /**\n   * Linear interpolation between two numbers.\n   * @param y1\n   * @param y2\n   * @param mu\n   */\n  static lerp(y1: number, y2: number, mu: number): number {\n    mu = Utils.clamp(mu, 0, 1);\n    return y1 * (1 - mu) + y2 * mu;\n  }\n\n  /**\n   * Linear interpolation between two colors.\n   *\n   * ### Example\n   *\n   *```ts\n   * lerpColor(\"#000000\", \"#0099FF\", .25)\n   *```\n   */\n\n  static lerpColor(color1: string, color2: string, factor = 0.5): string {\n    function h2r(hex: string) {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex)!;\n      return [\n        parseInt(result[1], 16),\n        parseInt(result[2], 16),\n        parseInt(result[3], 16),\n      ];\n    }\n\n    function r2h(rgb: number[]) {\n      return (\n        '#' +\n        ((1 << 24) + (rgb[0] << 16) + (rgb[1] << 8) + rgb[2])\n          .toString(16)\n          .slice(1)\n      );\n    }\n\n    const c1 = h2r(color1) || [0, 0, 0];\n    const c2 = h2r(color2) || [0, 0, 0];\n\n    const result = c1.slice();\n\n    for (let i = 0; i < 3; i++) {\n      result[i] = Math.round(result[i] + factor * (c2[i] - c1[i]));\n    }\n\n    return r2h(result);\n  }\n\n  /**\n   * Modulate a value between two ranges.\n   * @param value\n   * @param rangeA from [low, high]\n   * @param rangeB to [low, high]\n   * @param clamp\n   */\n  static modulate(\n    value: number,\n    rangeA: number[],\n    rangeB: number[],\n    clamp = false\n  ): number {\n    const [fromLow, fromHigh] = rangeA;\n    const [v0, v1] = rangeB;\n    const result = v0 + ((value - fromLow) / (fromHigh - fromLow)) * (v1 - v0);\n\n    return clamp\n      ? v0 < v1\n        ? Math.max(Math.min(result, v1), v0)\n        : Math.max(Math.min(result, v0), v1)\n      : result;\n  }\n\n  /**\n   * Clamp a value into a range.\n   * @param n\n   * @param min\n   */\n  static clamp(n: number, min: number): number;\n  static clamp(n: number, min: number, max: number): number;\n  static clamp(n: number, min: number, max?: number): number {\n    return Math.max(min, typeof max !== 'undefined' ? Math.min(n, max) : n);\n  }\n\n  /**\n   * Recursively clone an object or array.\n   * @param obj\n   */\n  static deepClone<T>(obj: T): T {\n    if (obj === null) return obj;\n\n    if (Array.isArray(obj)) {\n      return [...obj] as unknown as T;\n    }\n\n    if (typeof obj === 'object') {\n      const clone = { ...(obj as Record<string, unknown>) };\n\n      Object.keys(clone).forEach(\n        key =>\n          (clone[key] =\n            typeof obj[key as keyof T] === 'object'\n              ? Utils.deepClone(obj[key as keyof T])\n              : obj[key as keyof T])\n      );\n\n      return clone as unknown as T;\n    }\n\n    return obj;\n  }\n\n  /**\n   * Seeded random number generator, using [xorshift](https://en.wikipedia.org/wiki/Xorshift).\n   * The result will always be between -1 and 1.\n   *\n   * Adapted from [seedrandom](https://github.com/davidbau/seedrandom).\n   */\n  static rng(seed = ''): () => number {\n    let x = 0;\n    let y = 0;\n    let z = 0;\n    let w = 0;\n\n    function next() {\n      const t = x ^ (x << 11);\n      x = y;\n      y = z;\n      z = w;\n      w ^= ((w >>> 19) ^ t ^ (t >>> 8)) >>> 0;\n      return w / 0x100000000;\n    }\n\n    for (let k = 0; k < seed.length + 64; k++) {\n      x ^= seed.charCodeAt(k) | 0;\n      next();\n    }\n\n    return next;\n  }\n\n  /* ---------------------- Boxes --------------------- */\n\n  static pointsToLineSegments(points: number[][], closed = false) {\n    const segments = [];\n    for (let i = 1; i < points.length; i++)\n      segments.push([points[i - 1], points[i]]);\n    if (closed) segments.push([points[points.length - 1], points[0]]);\n    return segments;\n  }\n\n  static getRectangleSides(\n    point: number[],\n    size: number[],\n    rotation = 0\n  ): [string, number[][]][] {\n    const center = [point[0] + size[0] / 2, point[1] + size[1] / 2];\n    const tl = Vec.rotWith(point, center, rotation);\n    const tr = Vec.rotWith(Vec.add(point, [size[0], 0]), center, rotation);\n    const br = Vec.rotWith(Vec.add(point, size), center, rotation);\n    const bl = Vec.rotWith(Vec.add(point, [0, size[1]]), center, rotation);\n\n    return [\n      ['top', [tl, tr]],\n      ['right', [tr, br]],\n      ['bottom', [br, bl]],\n      ['left', [bl, tl]],\n    ];\n  }\n\n  /* --------------- Circles and Angles --------------- */\n\n  /**\n   * Get a circle from three points.\n   * @param A\n   * @param B\n   * @param C\n   * @returns [x, y, r]\n   */\n  static circleFromThreePoints(\n    A: number[],\n    B: number[],\n    C: number[]\n  ): number[] {\n    const [x1, y1] = A;\n    const [x2, y2] = B;\n    const [x3, y3] = C;\n\n    const a = x1 * (y2 - y3) - y1 * (x2 - x3) + x2 * y3 - x3 * y2;\n\n    const b =\n      (x1 * x1 + y1 * y1) * (y3 - y2) +\n      (x2 * x2 + y2 * y2) * (y1 - y3) +\n      (x3 * x3 + y3 * y3) * (y2 - y1);\n\n    const c =\n      (x1 * x1 + y1 * y1) * (x2 - x3) +\n      (x2 * x2 + y2 * y2) * (x3 - x1) +\n      (x3 * x3 + y3 * y3) * (x1 - x2);\n\n    const x = -b / (2 * a);\n\n    const y = -c / (2 * a);\n\n    return [x, y, Math.hypot(x - x1, y - y1)];\n  }\n\n  /**\n   * Find the approximate perimeter of an ellipse.\n   * @param rx\n   * @param ry\n   */\n  static perimeterOfEllipse(rx: number, ry: number): number {\n    const h = Math.pow(rx - ry, 2) / Math.pow(rx + ry, 2);\n    const p = Math.PI * (rx + ry) * (1 + (3 * h) / (10 + Math.sqrt(4 - 3 * h)));\n    return p;\n  }\n\n  /**\n   * Get the short angle distance between two angles.\n   * @param a0\n   * @param a1\n   */\n  static shortAngleDist(a0: number, a1: number): number {\n    const max = Math.PI * 2;\n    const da = (a1 - a0) % max;\n    return ((2 * da) % max) - da;\n  }\n\n  /**\n   * Get the long angle distance between two angles.\n   * @param a0\n   * @param a1\n   */\n  static longAngleDist(a0: number, a1: number): number {\n    return Math.PI * 2 - Utils.shortAngleDist(a0, a1);\n  }\n\n  /**\n   * Interpolate an angle between two angles.\n   * @param a0\n   * @param a1\n   * @param t\n   */\n  static lerpAngles(a0: number, a1: number, t: number): number {\n    return a0 + Utils.shortAngleDist(a0, a1) * t;\n  }\n\n  /**\n   * Get the short distance between two angles.\n   * @param a0\n   * @param a1\n   */\n  static angleDelta(a0: number, a1: number): number {\n    return Utils.shortAngleDist(a0, a1);\n  }\n\n  /**\n   * Get the \"sweep\" or short distance between two points on a circle's perimeter.\n   * @param C\n   * @param A\n   * @param B\n   */\n  static getSweep(C: number[], A: number[], B: number[]): number {\n    return Utils.angleDelta(Vec.angle(C, A), Vec.angle(C, B));\n  }\n\n  /**\n   * Clamp radians within 0 and 2PI\n   * @param r\n   */\n  static clampRadians(r: number): number {\n    return (Math.PI * 2 + r) % (Math.PI * 2);\n  }\n\n  /**\n   * Clamp rotation to even segments.\n   * @param r\n   * @param segments\n   */\n  static snapAngleToSegments(r: number, segments: number): number {\n    const seg = (Math.PI * 2) / segments;\n    return Math.floor((Utils.clampRadians(r) + seg / 2) / seg) * seg;\n  }\n\n  /**\n   * Is angle c between angles a and b?\n   * @param a\n   * @param b\n   * @param c\n   */\n  static isAngleBetween(a: number, b: number, c: number): boolean {\n    if (c === a || c === b) return true;\n\n    const AB = (b - a + TAU) % TAU;\n    const AC = (c - a + TAU) % TAU;\n    return AB <= Math.PI !== AC > AB;\n  }\n\n  /**\n   * Convert degrees to radians.\n   * @param d\n   */\n  static degreesToRadians(d: number): number {\n    return (d * Math.PI) / 180;\n  }\n\n  /**\n   * Convert radians to degrees.\n   * @param r\n   */\n  static radiansToDegrees(r: number): number {\n    return (r * 180) / Math.PI;\n  }\n\n  /**\n   * Get the length of an arc between two points on a circle's perimeter.\n   * @param C\n   * @param r\n   * @param A\n   * @param B\n   */\n  static getArcLength(\n    C: number[],\n    r: number,\n    A: number[],\n    B: number[]\n  ): number {\n    const sweep = Utils.getSweep(C, A, B);\n    return r * (2 * Math.PI) * (sweep / (2 * Math.PI));\n  }\n\n  static getSweepFlag(A: number[], B: number[], C: number[]) {\n    const angleAC = Vec.angle(A, C);\n    const angleAB = Vec.angle(A, B);\n    const angleCAB =\n      ((angleAB - angleAC + 3 * Math.PI) % (2 * Math.PI)) - Math.PI;\n    return angleCAB > 0 ? 0 : 1;\n  }\n\n  static getLargeArcFlag(A: number[], C: number[], P: number[]) {\n    const anglePA = Vec.angle(P, A);\n    const anglePC = Vec.angle(P, C);\n    const angleAPC =\n      ((anglePC - anglePA + 3 * Math.PI) % (2 * Math.PI)) - Math.PI;\n    return Math.abs(angleAPC) > Math.PI / 2 ? 0 : 1;\n  }\n\n  /**\n   * Get a dash offset for an arc, based on its length.\n   * @param C\n   * @param r\n   * @param A\n   * @param B\n   * @param step\n   */\n  static getArcDashOffset(\n    C: number[],\n    r: number,\n    A: number[],\n    B: number[],\n    step: number\n  ): number {\n    const del0 = Utils.getSweepFlag(C, A, B);\n    const len0 = Utils.getArcLength(C, r, A, B);\n    const off0 = del0 < 0 ? len0 : 2 * Math.PI * C[2] - len0;\n    return -off0 / 2 + step;\n  }\n\n  /**\n   * Get a dash offset for an ellipse, based on its length.\n   * @param A\n   * @param step\n   */\n  static getEllipseDashOffset(A: number[], step: number): number {\n    const c = 2 * Math.PI * A[2];\n    return -c / 2 + -step;\n  }\n\n  /* -------------------- Hit Tests ------------------- */\n\n  /**\n   * Get whether a point is inside of a circle.\n   * @param A\n   * @param b\n   * @returns\n   */\n  static pointInCircle(A: number[], C: number[], r: number): boolean {\n    return Vec.dist(A, C) <= r;\n  }\n\n  /**\n   * Get whether a point is inside of an ellipse.\n   * @param point\n   * @param center\n   * @param rx\n   * @param ry\n   * @param rotation\n   * @returns\n   */\n  static pointInEllipse(\n    A: number[],\n    C: number[],\n    rx: number,\n    ry: number,\n    rotation = 0\n  ): boolean {\n    rotation = rotation || 0;\n    const cos = Math.cos(rotation);\n    const sin = Math.sin(rotation);\n    const delta = Vec.sub(A, C);\n    const tdx = cos * delta[0] + sin * delta[1];\n    const tdy = sin * delta[0] - cos * delta[1];\n\n    return (tdx * tdx) / (rx * rx) + (tdy * tdy) / (ry * ry) <= 1;\n  }\n\n  /**\n   * Get whether a point is inside of a rectangle.\n   * @param point\n   * @param size\n   */\n  static pointInRect(point: number[], size: number[]): boolean {\n    return !(\n      point[0] < size[0] ||\n      point[0] > point[0] + size[0] ||\n      point[1] < size[1] ||\n      point[1] > point[1] + size[1]\n    );\n  }\n\n  static pointInPolygon(p: number[], points: number[][]): boolean {\n    let wn = 0; // winding number\n\n    points.forEach((a, i) => {\n      const b = points[(i + 1) % points.length];\n      if (a[1] <= p[1]) {\n        if (b[1] > p[1] && Vec.cross(a, b, p) > 0) {\n          wn += 1;\n        }\n      } else if (b[1] <= p[1] && Vec.cross(a, b, p) < 0) {\n        wn -= 1;\n      }\n    });\n\n    return wn !== 0;\n  }\n\n  /**\n   * Get whether a point is inside of a bounds.\n   * @param A The point to check.\n   * @param b The bounds to check.\n   * @returns\n   */\n  static pointInBounds(A: number[], b: TLBounds): boolean {\n    return !(A[0] < b.minX || A[0] > b.maxX || A[1] < b.minY || A[1] > b.maxY);\n  }\n\n  /**\n   * Hit test a point and a polyline using a minimum distance.\n   * @param A The point to check.\n   * @param points The points that make up the polyline.\n   * @param distance (optional) The minimum distance that qualifies a hit.\n   */\n  static pointInPolyline(\n    A: number[],\n    points: number[][],\n    distance = 3\n  ): boolean {\n    for (let i = 1; i < points.length; i++) {\n      if (Vec.distanceToLineSegment(points[i - 1], points[i], A) < distance) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /* --------------------- Bounds --------------------- */\n\n  static getBoundsSides(bounds: TLBounds): [string, number[][]][] {\n    return this.getRectangleSides(\n      [bounds.minX, bounds.minY],\n      [bounds.width, bounds.height]\n    );\n  }\n\n  /**\n   * Expand a bounding box by a delta.\n   *\n   * ### Example\n   *\n   *```ts\n   * expandBounds(myBounds, [100, 100])\n   *```\n   */\n  static expandBounds(bounds: TLBounds, delta: number): TLBounds {\n    return {\n      minX: bounds.minX - delta,\n      minY: bounds.minY - delta,\n      maxX: bounds.maxX + delta,\n      maxY: bounds.maxY + delta,\n      width: bounds.width + delta * 2,\n      height: bounds.height + delta * 2,\n    };\n  }\n\n  /**\n   * Get whether two bounds collide.\n   * @param a Bounds\n   * @param b Bounds\n   * @returns\n   */\n  static boundsCollide(a: TLBounds, b: TLBounds): boolean {\n    return !(\n      a.maxX < b.minX ||\n      a.minX > b.maxX ||\n      a.maxY < b.minY ||\n      a.minY > b.maxY\n    );\n  }\n\n  /**\n   * Get whether the bounds of A contain the bounds of B. A perfect match will return true.\n   * @param a Bounds\n   * @param b Bounds\n   * @returns\n   */\n  static boundsContain(a: TLBounds, b: TLBounds): boolean {\n    return (\n      a.minX < b.minX && a.minY < b.minY && a.maxY > b.maxY && a.maxX > b.maxX\n    );\n  }\n\n  /**\n   * Get whether the bounds of A are contained by the bounds of B.\n   * @param a Bounds\n   * @param b Bounds\n   * @returns\n   */\n  static boundsContained(a: TLBounds, b: TLBounds): boolean {\n    return Utils.boundsContain(b, a);\n  }\n\n  /**\n   * Get whether two bounds are identical.\n   * @param a Bounds\n   * @param b Bounds\n   * @returns\n   */\n  static boundsAreEqual(a: TLBounds, b: TLBounds): boolean {\n    return !(\n      b.maxX !== a.maxX ||\n      b.minX !== a.minX ||\n      b.maxY !== a.maxY ||\n      b.minY !== a.minY\n    );\n  }\n\n  /**\n   * Find a bounding box from an array of points.\n   * @param points\n   * @param rotation (optional) The bounding box's rotation.\n   */\n  static getBoundsFromPoints(points: number[][], rotation = 0): TLBounds {\n    let minX = Infinity;\n    let minY = Infinity;\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n\n    if (points.length < 2) {\n      minX = 0;\n      minY = 0;\n      maxX = 1;\n      maxY = 1;\n    } else {\n      for (const [x, y] of points) {\n        minX = Math.min(x, minX);\n        minY = Math.min(y, minY);\n        maxX = Math.max(x, maxX);\n        maxY = Math.max(y, maxY);\n      }\n    }\n\n    if (rotation !== 0) {\n      return Utils.getBoundsFromPoints(\n        points.map(pt =>\n          Vec.rotWith(pt, [(minX + maxX) / 2, (minY + maxY) / 2], rotation)\n        )\n      );\n    }\n\n    return {\n      minX,\n      minY,\n      maxX,\n      maxY,\n      width: Math.max(1, maxX - minX),\n      height: Math.max(1, maxY - minY),\n    };\n  }\n\n  /**\n   * Center a bounding box around a given point.\n   * @param bounds\n   * @param center\n   */\n  static centerBounds(bounds: TLBounds, point: number[]): TLBounds {\n    const boundsCenter = this.getBoundsCenter(bounds);\n    const dx = point[0] - boundsCenter[0];\n    const dy = point[1] - boundsCenter[1];\n    return this.translateBounds(bounds, [dx, dy]);\n  }\n\n  /**\n   * Snap a bounding box to a grid size.\n   * @param bounds\n   * @param gridSize\n   */\n  static snapBoundsToGrid(bounds: TLBounds, gridSize: number): TLBounds {\n    const minX = Math.round(bounds.minX / gridSize) * gridSize;\n    const minY = Math.round(bounds.minY / gridSize) * gridSize;\n    const maxX = Math.round(bounds.maxX / gridSize) * gridSize;\n    const maxY = Math.round(bounds.maxY / gridSize) * gridSize;\n    return {\n      minX,\n      minY,\n      maxX,\n      maxY,\n      width: Math.max(1, maxX - minX),\n      height: Math.max(1, maxY - minY),\n    };\n  }\n\n  /**\n   * Move a bounding box without recalculating it.\n   * @param bounds\n   * @param delta\n   * @returns\n   */\n  static translateBounds(bounds: TLBounds, delta: number[]): TLBounds {\n    return {\n      minX: bounds.minX + delta[0],\n      minY: bounds.minY + delta[1],\n      maxX: bounds.maxX + delta[0],\n      maxY: bounds.maxY + delta[1],\n      width: bounds.width,\n      height: bounds.height,\n    };\n  }\n\n  /**\n   * Rotate a bounding box.\n   * @param bounds\n   * @param center\n   * @param rotation\n   */\n  static rotateBounds(\n    bounds: TLBounds,\n    center: number[],\n    rotation: number\n  ): TLBounds {\n    const [minX, minY] = Vec.rotWith(\n      [bounds.minX, bounds.minY],\n      center,\n      rotation\n    );\n    const [maxX, maxY] = Vec.rotWith(\n      [bounds.maxX, bounds.maxY],\n      center,\n      rotation\n    );\n\n    return {\n      minX,\n      minY,\n      maxX,\n      maxY,\n      width: bounds.width,\n      height: bounds.height,\n    };\n  }\n\n  /**\n   * Get the rotated bounds of an ellipse.\n   * @param x\n   * @param y\n   * @param rx\n   * @param ry\n   * @param rotation\n   */\n  static getRotatedEllipseBounds(\n    x: number,\n    y: number,\n    rx: number,\n    ry: number,\n    rotation = 0\n  ): TLBounds {\n    const c = Math.cos(rotation);\n    const s = Math.sin(rotation);\n    const w = Math.hypot(rx * c, ry * s);\n    const h = Math.hypot(rx * s, ry * c);\n\n    return {\n      minX: x + rx - w,\n      minY: y + ry - h,\n      maxX: x + rx + w,\n      maxY: y + ry + h,\n      width: w * 2,\n      height: h * 2,\n    };\n  }\n\n  /**\n   * Get a bounding box that includes two bounding boxes.\n   * @param a Bounding box\n   * @param b Bounding box\n   * @returns\n   */\n  static getExpandedBounds(a: TLBounds, b: TLBounds): TLBounds {\n    const minX = Math.min(a.minX, b.minX);\n    const minY = Math.min(a.minY, b.minY);\n    const maxX = Math.max(a.maxX, b.maxX);\n    const maxY = Math.max(a.maxY, b.maxY);\n    const width = Math.abs(maxX - minX);\n    const height = Math.abs(maxY - minY);\n\n    return { minX, minY, maxX, maxY, width, height };\n  }\n\n  /**\n   * Get the common bounds of a group of bounds.\n   * @returns\n   */\n  static getCommonBounds(bounds: TLBounds[]): TLBounds {\n    if (bounds.length < 2) return bounds[0];\n\n    let result = bounds[0];\n\n    for (let i = 1; i < bounds.length; i++) {\n      result = Utils.getExpandedBounds(result, bounds[i]);\n    }\n\n    return result;\n  }\n\n  static getRotatedCorners(b: TLBounds, rotation = 0): number[][] {\n    const center = [b.minX + b.width / 2, b.minY + b.height / 2];\n\n    return [\n      [b.minX, b.minY],\n      [b.maxX, b.minY],\n      [b.maxX, b.maxY],\n      [b.minX, b.maxY],\n    ].map(point => Vec.rotWith(point, center, rotation));\n  }\n\n  static getTransformedBoundingBox(\n    bounds: TLBounds,\n    handle: TLBoundsCorner | TLBoundsEdge | 'center',\n    delta: number[],\n    rotation = 0,\n    isAspectRatioLocked = false\n  ): TLBounds & { scaleX: number; scaleY: number } {\n    // Create top left and bottom right corners.\n    const [ax0, ay0] = [bounds.minX, bounds.minY];\n    const [ax1, ay1] = [bounds.maxX, bounds.maxY];\n\n    // Create a second set of corners for the new box.\n    let [bx0, by0] = [bounds.minX, bounds.minY];\n    let [bx1, by1] = [bounds.maxX, bounds.maxY];\n\n    // If the drag is on the center, just translate the bounds.\n    if (handle === 'center') {\n      return {\n        minX: bx0 + delta[0],\n        minY: by0 + delta[1],\n        maxX: bx1 + delta[0],\n        maxY: by1 + delta[1],\n        width: bx1 - bx0,\n        height: by1 - by0,\n        scaleX: 1,\n        scaleY: 1,\n      };\n    }\n\n    // Counter rotate the delta. This lets us make changes as if\n    // the (possibly rotated) boxes were axis aligned.\n    const [dx, dy] = Vec.rot(delta, -rotation);\n\n    /*\n1. Delta\n\nUse the delta to adjust the new box by changing its corners.\nThe dragging handle (corner or edge) will determine which\ncorners should change.\n*/\n    switch (handle) {\n      case TLBoundsEdge.Top:\n      case TLBoundsCorner.TopLeft:\n      case TLBoundsCorner.TopRight: {\n        by0 += dy;\n        break;\n      }\n      case TLBoundsEdge.Bottom:\n      case TLBoundsCorner.BottomLeft:\n      case TLBoundsCorner.BottomRight: {\n        by1 += dy;\n        break;\n      }\n    }\n\n    switch (handle) {\n      case TLBoundsEdge.Left:\n      case TLBoundsCorner.TopLeft:\n      case TLBoundsCorner.BottomLeft: {\n        bx0 += dx;\n        break;\n      }\n      case TLBoundsEdge.Right:\n      case TLBoundsCorner.TopRight:\n      case TLBoundsCorner.BottomRight: {\n        bx1 += dx;\n        break;\n      }\n    }\n\n    const aw = ax1 - ax0;\n    const ah = ay1 - ay0;\n\n    const scaleX = (bx1 - bx0) / aw;\n    const scaleY = (by1 - by0) / ah;\n\n    const flipX = scaleX < 0;\n    const flipY = scaleY < 0;\n\n    const bw = Math.abs(bx1 - bx0);\n    const bh = Math.abs(by1 - by0);\n\n    /*\n2. Aspect ratio\n\nIf the aspect ratio is locked, adjust the corners so that the\nnew box's aspect ratio matches the original aspect ratio.\n*/\n\n    if (isAspectRatioLocked) {\n      const ar = aw / ah;\n      const isTall = ar < bw / bh;\n      const tw = bw * (scaleY < 0 ? 1 : -1) * (1 / ar);\n      const th = bh * (scaleX < 0 ? 1 : -1) * ar;\n\n      switch (handle) {\n        case TLBoundsCorner.TopLeft: {\n          if (isTall) by0 = by1 + tw;\n          else bx0 = bx1 + th;\n          break;\n        }\n        case TLBoundsCorner.TopRight: {\n          if (isTall) by0 = by1 + tw;\n          else bx1 = bx0 - th;\n          break;\n        }\n        case TLBoundsCorner.BottomRight: {\n          if (isTall) by1 = by0 - tw;\n          else bx1 = bx0 - th;\n          break;\n        }\n        case TLBoundsCorner.BottomLeft: {\n          if (isTall) by1 = by0 - tw;\n          else bx0 = bx1 + th;\n          break;\n        }\n        case TLBoundsEdge.Bottom:\n        case TLBoundsEdge.Top: {\n          const m = (bx0 + bx1) / 2;\n          const w = bh * ar;\n          bx0 = m - w / 2;\n          bx1 = m + w / 2;\n          break;\n        }\n        case TLBoundsEdge.Left:\n        case TLBoundsEdge.Right: {\n          const m = (by0 + by1) / 2;\n          const h = bw / ar;\n          by0 = m - h / 2;\n          by1 = m + h / 2;\n          break;\n        }\n      }\n    }\n\n    /*\n3. Rotation\n\nIf the bounds are rotated, get a Vector from the rotated anchor\ncorner in the initial bounds to the rotated anchor corner in the\nresult's bounds. Subtract this Vector from the result's corners,\nso that the two anchor points (initial and result) will be equal.\n*/\n\n    if (rotation % (Math.PI * 2) !== 0) {\n      let cv = [0, 0];\n\n      const c0 = Vec.med([ax0, ay0], [ax1, ay1]);\n      const c1 = Vec.med([bx0, by0], [bx1, by1]);\n\n      switch (handle) {\n        case TLBoundsCorner.TopLeft: {\n          cv = Vec.sub(\n            Vec.rotWith([bx1, by1], c1, rotation),\n            Vec.rotWith([ax1, ay1], c0, rotation)\n          );\n          break;\n        }\n        case TLBoundsCorner.TopRight: {\n          cv = Vec.sub(\n            Vec.rotWith([bx0, by1], c1, rotation),\n            Vec.rotWith([ax0, ay1], c0, rotation)\n          );\n          break;\n        }\n        case TLBoundsCorner.BottomRight: {\n          cv = Vec.sub(\n            Vec.rotWith([bx0, by0], c1, rotation),\n            Vec.rotWith([ax0, ay0], c0, rotation)\n          );\n          break;\n        }\n        case TLBoundsCorner.BottomLeft: {\n          cv = Vec.sub(\n            Vec.rotWith([bx1, by0], c1, rotation),\n            Vec.rotWith([ax1, ay0], c0, rotation)\n          );\n          break;\n        }\n        case TLBoundsEdge.Top: {\n          cv = Vec.sub(\n            Vec.rotWith(Vec.med([bx0, by1], [bx1, by1]), c1, rotation),\n            Vec.rotWith(Vec.med([ax0, ay1], [ax1, ay1]), c0, rotation)\n          );\n          break;\n        }\n        case TLBoundsEdge.Left: {\n          cv = Vec.sub(\n            Vec.rotWith(Vec.med([bx1, by0], [bx1, by1]), c1, rotation),\n            Vec.rotWith(Vec.med([ax1, ay0], [ax1, ay1]), c0, rotation)\n          );\n          break;\n        }\n        case TLBoundsEdge.Bottom: {\n          cv = Vec.sub(\n            Vec.rotWith(Vec.med([bx0, by0], [bx1, by0]), c1, rotation),\n            Vec.rotWith(Vec.med([ax0, ay0], [ax1, ay0]), c0, rotation)\n          );\n          break;\n        }\n        case TLBoundsEdge.Right: {\n          cv = Vec.sub(\n            Vec.rotWith(Vec.med([bx0, by0], [bx0, by1]), c1, rotation),\n            Vec.rotWith(Vec.med([ax0, ay0], [ax0, ay1]), c0, rotation)\n          );\n          break;\n        }\n      }\n      // eslint-disable-next-line @typescript-eslint/no-extra-semi\n      [bx0, by0] = Vec.sub([bx0, by0], cv);\n      // eslint-disable-next-line @typescript-eslint/no-extra-semi\n      [bx1, by1] = Vec.sub([bx1, by1], cv);\n    }\n\n    /*\n4. Flips\n\nIf the axes are flipped (e.g. if the right edge has been dragged\nleft past the initial left edge) then swap points on that axis.\n*/\n\n    if (bx1 < bx0) {\n      // eslint-disable-next-line @typescript-eslint/no-extra-semi\n      [bx1, bx0] = [bx0, bx1];\n    }\n\n    if (by1 < by0) {\n      // eslint-disable-next-line @typescript-eslint/no-extra-semi\n      [by1, by0] = [by0, by1];\n    }\n\n    return {\n      minX: bx0,\n      minY: by0,\n      maxX: bx1,\n      maxY: by1,\n      width: bx1 - bx0,\n      height: by1 - by0,\n      scaleX: ((bx1 - bx0) / (ax1 - ax0 || 1)) * (flipX ? -1 : 1),\n      scaleY: ((by1 - by0) / (ay1 - ay0 || 1)) * (flipY ? -1 : 1),\n    };\n  }\n\n  static getTransformAnchor(\n    type: TLBoundsEdge | TLBoundsCorner,\n    isFlippedX: boolean,\n    isFlippedY: boolean\n  ): TLBoundsCorner | TLBoundsEdge {\n    let anchor: TLBoundsCorner | TLBoundsEdge = type;\n\n    // Change corner anchors if flipped\n    switch (type) {\n      case TLBoundsCorner.TopLeft: {\n        if (isFlippedX && isFlippedY) {\n          anchor = TLBoundsCorner.BottomRight;\n        } else if (isFlippedX) {\n          anchor = TLBoundsCorner.TopRight;\n        } else if (isFlippedY) {\n          anchor = TLBoundsCorner.BottomLeft;\n        } else {\n          anchor = TLBoundsCorner.BottomRight;\n        }\n        break;\n      }\n      case TLBoundsCorner.TopRight: {\n        if (isFlippedX && isFlippedY) {\n          anchor = TLBoundsCorner.BottomLeft;\n        } else if (isFlippedX) {\n          anchor = TLBoundsCorner.TopLeft;\n        } else if (isFlippedY) {\n          anchor = TLBoundsCorner.BottomRight;\n        } else {\n          anchor = TLBoundsCorner.BottomLeft;\n        }\n        break;\n      }\n      case TLBoundsCorner.BottomRight: {\n        if (isFlippedX && isFlippedY) {\n          anchor = TLBoundsCorner.TopLeft;\n        } else if (isFlippedX) {\n          anchor = TLBoundsCorner.BottomLeft;\n        } else if (isFlippedY) {\n          anchor = TLBoundsCorner.TopRight;\n        } else {\n          anchor = TLBoundsCorner.TopLeft;\n        }\n        break;\n      }\n      case TLBoundsCorner.BottomLeft: {\n        if (isFlippedX && isFlippedY) {\n          anchor = TLBoundsCorner.TopRight;\n        } else if (isFlippedX) {\n          anchor = TLBoundsCorner.BottomRight;\n        } else if (isFlippedY) {\n          anchor = TLBoundsCorner.TopLeft;\n        } else {\n          anchor = TLBoundsCorner.TopRight;\n        }\n        break;\n      }\n    }\n\n    return anchor;\n  }\n\n  /**\n   * Get the relative bounds (usually a child) within a transformed bounding box.\n   * @param bounds\n   * @param initialBounds\n   * @param initialShapeBounds\n   * @param isFlippedX\n   * @param isFlippedY\n   */\n  static getRelativeTransformedBoundingBox(\n    bounds: TLBounds,\n    initialBounds: TLBounds,\n    initialShapeBounds: TLBounds,\n    isFlippedX: boolean,\n    isFlippedY: boolean\n  ): TLBounds {\n    const nx =\n      (isFlippedX\n        ? initialBounds.maxX - initialShapeBounds.maxX\n        : initialShapeBounds.minX - initialBounds.minX) / initialBounds.width;\n    const ny =\n      (isFlippedY\n        ? initialBounds.maxY - initialShapeBounds.maxY\n        : initialShapeBounds.minY - initialBounds.minY) / initialBounds.height;\n    const nw = initialShapeBounds.width / initialBounds.width;\n    const nh = initialShapeBounds.height / initialBounds.height;\n\n    const minX = bounds.minX + bounds.width * nx;\n    const minY = bounds.minY + bounds.height * ny;\n    const width = bounds.width * nw;\n    const height = bounds.height * nh;\n\n    return {\n      minX,\n      minY,\n      maxX: minX + width,\n      maxY: minY + height,\n      width,\n      height,\n    };\n  }\n\n  /**\n   * Get the size of a rotated box.\n   * @param size : ;\n   * @param rotation\n   */\n  static getRotatedSize(size: number[], rotation: number): number[] {\n    const center = Vec.div(size, 2);\n\n    const points = [[0, 0], [size[0], 0], size, [0, size[1]]].map(point =>\n      Vec.rotWith(point, center, rotation)\n    );\n\n    const bounds = Utils.getBoundsFromPoints(points);\n\n    return [bounds.width, bounds.height];\n  }\n\n  /**\n   * Get the center of a bounding box.\n   * @param bounds\n   */\n  static getBoundsCenter(bounds: TLBounds): number[] {\n    return [bounds.minX + bounds.width / 2, bounds.minY + bounds.height / 2];\n  }\n\n  /**\n   * Get a bounding box with a midX and midY.\n   * @param bounds\n   */\n  static getBoundsWithCenter(bounds: TLBounds): TLBoundsWithCenter {\n    const center = Utils.getBoundsCenter(bounds);\n    return {\n      ...bounds,\n      midX: center[0],\n      midY: center[1],\n    };\n  }\n\n  /**\n   * Given a set of points, get their common [minX, minY].\n   * @param points\n   */\n  static getCommonTopLeft(points: number[][]) {\n    const min = [Infinity, Infinity];\n\n    points.forEach(point => {\n      min[0] = Math.min(min[0], point[0]);\n      min[1] = Math.min(min[1], point[1]);\n    });\n\n    return min;\n  }\n\n  static getSnapPoints = (\n    bounds: TLBoundsWithCenter,\n    others: TLBoundsWithCenter[],\n    snapDistance: number\n  ) => {\n    const A = { ...bounds };\n\n    const offset = [0, 0];\n\n    const snapLines: number[][][] = [];\n\n    // 1.\n    // Find the snap points for the x and y axes\n\n    const snaps: Record<SnapPoints, Snap> = {\n      [SnapPoints.minX]: { id: SnapPoints.minX, isSnapped: false },\n      [SnapPoints.midX]: { id: SnapPoints.midX, isSnapped: false },\n      [SnapPoints.maxX]: { id: SnapPoints.maxX, isSnapped: false },\n      [SnapPoints.minY]: { id: SnapPoints.minY, isSnapped: false },\n      [SnapPoints.midY]: { id: SnapPoints.midY, isSnapped: false },\n      [SnapPoints.maxY]: { id: SnapPoints.maxY, isSnapped: false },\n    };\n\n    const xs = [SnapPoints.midX, SnapPoints.minX, SnapPoints.maxX];\n    const ys = [SnapPoints.midY, SnapPoints.minY, SnapPoints.maxY];\n\n    const snapResults = others.map(B => {\n      const rx = xs.flatMap((f, i) =>\n        xs.map((t, k) => {\n          const gap = A[f] - B[t];\n          const distance = Math.abs(gap);\n          return {\n            f,\n            t,\n            gap,\n            distance,\n            isCareful: i === 0 || i + k === 3,\n          };\n        })\n      );\n\n      const ry = ys.flatMap((f, i) =>\n        ys.map((t, k) => {\n          const gap = A[f] - B[t];\n          const distance = Math.abs(gap);\n          return {\n            f,\n            t,\n            gap,\n            distance,\n            isCareful: i === 0 || i + k === 3,\n          };\n        })\n      );\n\n      return [B, rx, ry] as const;\n    });\n\n    let gapX = Infinity;\n    let gapY = Infinity;\n\n    let minX = Infinity;\n    let minY = Infinity;\n\n    snapResults.forEach(([_, rx, ry]) => {\n      rx.forEach(r => {\n        if (r.distance < snapDistance && r.distance < minX) {\n          minX = r.distance;\n          gapX = r.gap;\n        }\n      });\n\n      ry.forEach(r => {\n        if (r.distance < snapDistance && r.distance < minY) {\n          minY = r.distance;\n          gapY = r.gap;\n        }\n      });\n    });\n\n    // Check for other shapes with the same gap\n\n    snapResults.forEach(([B, rx, ry]) => {\n      if (gapX !== Infinity) {\n        rx.forEach(r => {\n          if (Math.abs(r.gap - gapX) < 2) {\n            snaps[r.f] = {\n              ...snaps[r.f],\n              isSnapped: true,\n              to: B[r.t],\n              B,\n              distance: r.distance,\n            };\n          }\n        });\n      }\n\n      if (gapY !== Infinity) {\n        ry.forEach(r => {\n          if (Math.abs(r.gap - gapY) < 2) {\n            snaps[r.f] = {\n              ...snaps[r.f],\n              isSnapped: true,\n              to: B[r.t],\n              B,\n              distance: r.distance,\n            };\n          }\n        });\n      }\n    });\n\n    offset[0] = gapX === Infinity ? 0 : gapX;\n    offset[1] = gapY === Infinity ? 0 : gapY;\n\n    A.minX -= offset[0];\n    A.midX -= offset[0];\n    A.maxX -= offset[0];\n    A.minY -= offset[1];\n    A.midY -= offset[1];\n    A.maxY -= offset[1];\n\n    // 2.\n    // Calculate snap lines based on adjusted bounds A. This has\n    // to happen after we've adjusted both dimensions x and y of\n    // the bounds A!\n    xs.forEach(from => {\n      const snap = snaps[from];\n\n      if (!snap.isSnapped) return;\n\n      const { id, B } = snap;\n      const x = A[id];\n\n      // If A is snapped at its center, show include only the midY;\n      // otherwise, include both its minY and maxY.\n      snapLines.push(\n        id === SnapPoints.minX\n          ? [\n              [x, A.midY],\n              [x, B.minY],\n              [x, B.maxY],\n            ]\n          : [\n              [x, A.minY],\n              [x, A.maxY],\n              [x, B.minY],\n              [x, B.maxY],\n            ]\n      );\n    });\n\n    ys.forEach(from => {\n      const snap = snaps[from];\n\n      if (!snap.isSnapped) return;\n\n      const { id, B } = snap;\n      const y = A[id];\n\n      snapLines.push(\n        id === SnapPoints.midY\n          ? [\n              [A.midX, y],\n              [B.minX, y],\n              [B.maxX, y],\n            ]\n          : [\n              [A.minX, y],\n              [A.maxX, y],\n              [B.minX, y],\n              [B.maxX, y],\n            ]\n      );\n    });\n\n    return { offset, snapLines };\n  };\n\n  /* -------------------------------------------------- */\n  /*                Lists and Collections               */\n  /* -------------------------------------------------- */\n\n  static deepMerge = <T>(target: T, patch: Patch<T>): T => {\n    const result: T = { ...target };\n\n    const entries = Object.entries(patch) as [keyof T, T[keyof T]][];\n\n    for (const [key, value] of entries)\n      result[key] =\n        value === Object(value) && !Array.isArray(value)\n          ? Utils.deepMerge(result[key], value)\n          : value;\n\n    return result;\n  };\n\n  /**\n   * Get a value from a cache (a WeakMap), filling the value if it is not present.\n   *\n   * ### Example\n   *\n   *```ts\n   * getFromCache(boundsCache, shape, (cache) => cache.set(shape, \"value\"))\n   *```\n   */\n  static getFromCache<V, I extends object>(\n    cache: WeakMap<I, V>,\n    item: I,\n    getNext: () => V\n  ): V {\n    let value = cache.get(item);\n\n    if (value === undefined) {\n      cache.set(item, getNext());\n      value = cache.get(item);\n\n      if (value === undefined) {\n        throw Error('Cache did not include item!');\n      }\n    }\n\n    return value;\n  }\n\n  /**\n   * Get a unique string id.\n   */\n  static uniqueId(a = ''): string {\n    return a\n      ? /* eslint-disable no-bitwise */\n        ((Number(a) ^ (Math.random() * 16)) >> (Number(a) / 4)).toString(16)\n      : `${1e7}-${1e3}-${4e3}-${8e3}-${1e11}`.replace(/[018]/g, Utils.uniqueId);\n  }\n\n  /**\n   * Shuffle the contents of an array.\n   * @param arr\n   * @param offset\n   */\n  static rotateArray<T>(arr: T[], offset: number): T[] {\n    return arr.map((_, i) => arr[(i + offset) % arr.length]);\n  }\n\n  /**\n   * Debounce a function.\n   */\n  static debounce<T extends (...args: any[]) => void>(fn: T, ms = 0) {\n    let timeoutId: number | any;\n    return function (...args: Parameters<T>) {\n      clearTimeout(timeoutId);\n      timeoutId = setTimeout(() => fn.apply(args), ms);\n    };\n  }\n\n  /**\n   * Turn an array of points into a path of quadratic curves.\n   *\n   * @param points The points returned from perfect-freehand\n   * @param closed Whether the stroke is closed\n   */\n  static getSvgPathFromStroke(points: number[][], closed = true): string {\n    const len = points.length;\n\n    if (len < 4) {\n      return ``;\n    }\n\n    let a = points[0];\n    let b = points[1];\n    const c = points[2];\n\n    let result = `M${a[0].toFixed(2)},${a[1].toFixed(2)} Q${b[0].toFixed(\n      2\n    )},${b[1].toFixed(2)} ${average(b[0], c[0]).toFixed(2)},${average(\n      b[1],\n      c[1]\n    ).toFixed(2)} T`;\n\n    for (let i = 2, max = len - 1; i < max; i++) {\n      a = points[i];\n      b = points[i + 1];\n      result += `${average(a[0], b[0]).toFixed(2)},${average(\n        a[1],\n        b[1]\n      ).toFixed(2)} `;\n    }\n\n    if (closed) {\n      result += 'Z';\n    }\n\n    return result;\n  }\n\n  /**\n   * Turn an array of stroke points into a path of quadratic curves.\n   * @param points - the stroke points returned from perfect-freehand\n   */\n  static getSvgPathFromStrokePoints(\n    points: StrokePoint[],\n    closed = false\n  ): string {\n    const len = points.length;\n\n    if (len < 4) {\n      return ``;\n    }\n\n    let a = points[0].point;\n    let b = points[1].point;\n    const c = points[2].point;\n\n    let result = `M${a[0].toFixed(2)},${a[1].toFixed(2)} Q${b[0].toFixed(\n      2\n    )},${b[1].toFixed(2)} ${average(b[0], c[0]).toFixed(2)},${average(\n      b[1],\n      c[1]\n    ).toFixed(2)} T`;\n\n    for (let i = 2, max = len - 1; i < max; i++) {\n      a = points[i].point;\n      b = points[i + 1].point;\n      result += `${average(a[0], b[0]).toFixed(2)},${average(\n        a[1],\n        b[1]\n      ).toFixed(2)} `;\n    }\n\n    if (closed) {\n      result += 'Z';\n    }\n\n    return result;\n  }\n\n  /* -------------------------------------------------- */\n  /*                   Browser and DOM                  */\n  /* -------------------------------------------------- */\n\n  /**\n   * Get balanced dash-strokearray and dash-strokeoffset properties for a path of a given length.\n   * @param length The length of the path.\n   * @param strokeWidth The shape's stroke-width property.\n   * @param style The stroke's style: \"dashed\" or \"dotted\" (default \"dashed\").\n   * @param snap An interval for dashes (e.g. 4 will produce arrays with 4, 8, 16, etc dashes).\n   * @param outset Whether to outset the stroke (default false).\n   * @param lengthRatio The ratio to apply to dashed lines (default 2).\n   */\n  static getPerfectDashProps(\n    length: number,\n    strokeWidth: number,\n    style: 'dashed' | 'dotted' | string,\n    snap = 1,\n    outset = true,\n    lengthRatio = 2\n  ): {\n    strokeDasharray: string;\n    strokeDashoffset: string;\n  } {\n    let dashLength: number;\n    let strokeDashoffset: string;\n    let ratio: number;\n\n    if (style.toLowerCase() === 'dashed') {\n      dashLength = strokeWidth * lengthRatio;\n      ratio = 1;\n      strokeDashoffset = outset ? (dashLength / 2).toString() : '0';\n    } else if (style.toLowerCase() === 'dotted') {\n      dashLength = strokeWidth / 100;\n      ratio = 100;\n      strokeDashoffset = '0';\n    } else {\n      return {\n        strokeDasharray: 'none',\n        strokeDashoffset: 'none',\n      };\n    }\n\n    let dashes = Math.floor(length / dashLength / (2 * ratio));\n\n    dashes -= dashes % snap;\n\n    dashes = Math.max(dashes, 4);\n\n    const gapLength = Math.max(\n      dashLength,\n      (length - dashes * dashLength) / (outset ? dashes : dashes - 1)\n    );\n\n    return {\n      strokeDasharray: [dashLength, gapLength].join(' '),\n      strokeDashoffset,\n    };\n  }\n\n  static isMobileSafari() {\n    if (typeof window === 'undefined') return false;\n    const ua = window.navigator.userAgent;\n    const iOS = !!ua.match(/iPad/i) || !!ua.match(/iPhone/i);\n    const webkit = !!ua.match(/WebKit/i);\n    return iOS && webkit && !ua.match(/CriOS/i);\n  }\n\n  // via https://github.com/bameyrick/throttle-typescript\n  static throttle<T extends (...args: any) => any>(\n    func: T,\n    limit: number\n  ): (...args: Parameters<T>) => ReturnType<T> {\n    let inThrottle: boolean;\n    let lastResult: ReturnType<T>;\n\n    return function (this: any, ...args: any[]): ReturnType<T> {\n      if (!inThrottle) {\n        inThrottle = true;\n\n        setTimeout(() => (inThrottle = false), limit);\n\n        // @ts-ignore\n        lastResult = func(...args);\n      }\n\n      return lastResult;\n    };\n  }\n\n  /**\n   * Find whether the current display is a touch display.\n   */\n  // static isTouchDisplay(): boolean {\n  //   return (\n  //     'ontouchstart' in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0\n  //   )\n  // }\n\n  /**\n   * Find whether the current device is a Mac / iOS / iPadOS.\n   */\n  static isDarwin(): boolean {\n    return /Mac|iPod|iPhone|iPad/.test(window.navigator.platform);\n  }\n\n  /**\n   * Get whether an event is command (mac) or control (pc).\n   * @param e\n   */\n  static metaKey(e: KeyboardEvent): boolean {\n    return Utils.isDarwin() ? e.metaKey : e.ctrlKey;\n  }\n\n  /**\n   * Reversible pseudo hash.\n   * @param str string\n   */\n  static lns(str: string) {\n    const result = str.split('');\n    result.push(...result.splice(0, Math.round(result.length / 5)));\n    result.push(...result.splice(0, Math.round(result.length / 4)));\n    result.push(...result.splice(0, Math.round(result.length / 3)));\n    result.push(...result.splice(0, Math.round(result.length / 2)));\n    return result\n      .reverse()\n      .map(n => (+n ? (+n < 5 ? 5 + +n : +n > 5 ? +n - 5 : n) : n))\n      .join('');\n  }\n}\n\nexport default Utils;\n\nfunction average(a: number, b: number): number {\n  return (a + b) / 2;\n}\n", "import type { IBound } from '../consts.js';\n\nexport type XYWH = [number, number, number, number];\n\nexport type SerializedXYWH = `[${number},${number},${number},${number}]`;\n\nexport function serializeXYWH(\n  x: number,\n  y: number,\n  w: number,\n  h: number\n): SerializedXYWH {\n  return `[${x},${y},${w},${h}]`;\n}\n\nexport function deserializeXYWH(xywh: string): XYWH {\n  return JSON.parse(xywh) as XYWH;\n}\n\nexport function setXYWH(element: IBound, bound: IBound) {\n  element.x = bound.x;\n  element.y = bound.y;\n  element.w = bound.w;\n  element.h = bound.h;\n}\n", "import { Point } from '@blocksuite/blocks';\n\nimport type { IBound } from '../consts.js';\nimport { Line } from './line.js';\nimport { EPSILON } from './numerical.js';\nimport { Utils } from './tl-utils.js';\nimport { deserializeXYWH, type SerializedXYWH, serializeXYWH } from './xywh.js';\n\nexport class Bound implements IBound {\n  x: number;\n  y: number;\n  w: number;\n  h: number;\n\n  constructor(x: number, y: number, w: number, h: number) {\n    this.x = x;\n    this.y = y;\n    this.w = w;\n    this.h = h;\n  }\n\n  static from(arg1: IBound) {\n    return new Bound(arg1.x, arg1.y, arg1.w, arg1.h);\n  }\n\n  get center() {\n    return new Point(this.x + this.w / 2, this.y + this.h / 2);\n  }\n\n  get minX() {\n    return this.x;\n  }\n\n  get minY() {\n    return this.y;\n  }\n\n  get maxX() {\n    return this.x + this.w;\n  }\n\n  get maxY() {\n    return this.y + this.h;\n  }\n\n  get tl() {\n    return new Point(this.x, this.y);\n  }\n\n  get tr() {\n    return new Point(this.x + this.w, this.y);\n  }\n\n  get bl() {\n    return new Point(this.x, this.y + this.h);\n  }\n\n  get br() {\n    return new Point(this.x + this.w, this.y + this.h);\n  }\n\n  intersectLine(sp: Point, ep: Point, infinite = false) {\n    const rst: Point[] = [];\n    [\n      [this.tl, this.tr],\n      [this.tl, this.bl],\n      [this.tr, this.br],\n      [this.bl, this.br],\n    ].forEach(([p1, p2]) => {\n      const p = Line.intersect(sp, ep, p1, p2, infinite);\n      if (p) rst.push(p);\n    });\n    return rst.length === 0 ? null : rst;\n  }\n\n  isIntersectWithBound(bound: Bound, epsilon = EPSILON) {\n    return (\n      bound.maxX > this.minX - epsilon &&\n      bound.maxY > this.minY - epsilon &&\n      bound.minX < this.maxX + epsilon &&\n      bound.minY < this.maxY + epsilon\n    );\n  }\n\n  serialize(): SerializedXYWH {\n    return serializeXYWH(this.x, this.y, this.w, this.h);\n  }\n\n  static deserialize(s: string) {\n    const [x, y, w, h] = deserializeXYWH(s);\n    return new Bound(x, y, w, h);\n  }\n}\n\nfunction getExpandedBound(a: IBound, b: IBound): IBound {\n  const minX = Math.min(a.x, b.x);\n  const minY = Math.min(a.y, b.y);\n  const maxX = Math.max(a.x + a.w, b.x + b.w);\n  const maxY = Math.max(a.y + a.h, b.y + b.h);\n  const width = Math.abs(maxX - minX);\n  const height = Math.abs(maxY - minY);\n\n  return {\n    x: minX,\n    y: minY,\n    w: width,\n    h: height,\n  };\n}\n\nexport function getCommonBound(bounds: IBound[]): Bound | null {\n  if (!bounds.length) {\n    return null;\n  }\n  if (bounds.length === 1) {\n    const { x, y, w, h } = bounds[0];\n    return new Bound(x, y, w, h);\n  }\n\n  let result = bounds[0];\n\n  for (let i = 1; i < bounds.length; i++) {\n    result = getExpandedBound(result, bounds[i]);\n  }\n\n  return new Bound(result.x, result.y, result.w, result.h);\n}\n\n/**\n * Get whether A contains B\n */\nexport function contains(a: IBound, b: IBound): boolean {\n  return (\n    a.x <= b.x && a.x + a.w >= b.x + b.w && a.y <= b.y && a.y + a.h >= b.y + b.h\n  );\n}\n\nexport function getBoundFromPoints(points: number[][]) {\n  const { minX, minY, width, height } = Utils.getBoundsFromPoints(points);\n  return new Bound(minX, minY, width, height);\n}\n\nexport function inflateBound(bound: IBound, delta: number) {\n  const half = delta / 2;\n\n  const newBound = new Bound(\n    bound.x - half,\n    bound.y - half,\n    bound.w + delta,\n    bound.h + delta\n  );\n\n  if (newBound.w <= 0 || newBound.h <= 0) {\n    throw new Error('Invalid delta range or bound size.');\n  }\n\n  return newBound;\n}\n\nexport function transformPointsToNewBound<T extends { x: number; y: number }>(\n  points: T[],\n  oldBound: IBound,\n  oldMargin: number,\n  newBound: IBound,\n  newMargin: number\n) {\n  const wholeOldMargin = oldMargin * 2;\n  const wholeNewMargin = newMargin * 2;\n  const oldW = Math.max(oldBound.w - wholeOldMargin, 1);\n  const oldH = Math.max(oldBound.h - wholeOldMargin, 1);\n  const newW = Math.max(newBound.w - wholeNewMargin, 1);\n  const newH = Math.max(newBound.h - wholeNewMargin, 1);\n\n  const transformedPoints = points.map(p => {\n    return {\n      ...p,\n      x: newW * ((p.x - oldMargin) / oldW) + newMargin,\n      y: newH * ((p.y - oldMargin) / oldH) + newMargin,\n    } as T;\n  });\n\n  return {\n    points: transformedPoints,\n    bound: new Bound(\n      newBound.x,\n      newBound.y,\n      newW + wholeNewMargin,\n      newH + wholeNewMargin\n    ),\n  };\n}\n", "import type { IBound } from '../consts.js';\n\nexport function isPointIn(a: IBound, x: number, y: number): boolean {\n  return a.x <= x && x <= a.x + a.w && a.y <= y && y <= a.y + a.h;\n}\n\nexport function intersects(a: IBound, b: IBound): boolean {\n  return (\n    a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y\n  );\n}\n", "import type { RoughCanvas } from 'roughjs/bin/canvas.js';\nimport type * as Y from 'yjs';\n\nimport type { Renderer } from '../renderer.js';\nimport type { SurfaceManager } from '../surface.js';\nimport { isPointIn } from '../utils/hit-utils.js';\nimport { deserializeXYWH, type SerializedXYWH } from '../utils/xywh.js';\n\nexport interface ISurfaceElement {\n  id: string;\n  type: string;\n  xywh: SerializedXYWH;\n  index: string;\n  seed: number;\n}\n\nexport interface HitTestOptions {\n  expandStroke: boolean;\n  fillHollow: boolean;\n}\n\nexport type ComputedValue = (value: string) => string;\n\nexport class SurfaceElement<T extends ISurfaceElement = ISurfaceElement> {\n  yMap: Y.Map<unknown>;\n\n  protected renderer: Renderer | null = null;\n  protected surface: SurfaceManager | null = null;\n\n  computedValue: ComputedValue = v => v;\n\n  private _display = true;\n\n  get display() {\n    return this._display;\n  }\n\n  setDisplay(display: boolean) {\n    this._display = display;\n    this.renderer?.removeElement(this);\n    this.renderer?.addElement(this);\n  }\n\n  constructor(yMap: Y.Map<unknown>, surface: SurfaceManager, data?: T) {\n    if (!yMap.doc) {\n      throw new Error('yMap must be bound to a Y.Doc');\n    }\n\n    this.yMap = yMap;\n    if (data) {\n      for (const key in data) {\n        this.yMap.set(key, data[key] as T[keyof T]);\n      }\n    }\n\n    this.surface = surface;\n  }\n\n  get id() {\n    const id = this.yMap.get('id') as T['id'];\n    return id;\n  }\n\n  get index() {\n    const index = this.yMap.get('index') as T['index'];\n    return index;\n  }\n\n  get type() {\n    const type = this.yMap.get('type') as T['type'];\n    return type;\n  }\n\n  get xywh() {\n    const xywh = this.yMap.get('xywh') as T['xywh'];\n    return xywh;\n  }\n\n  get x() {\n    const [x] = deserializeXYWH(this.xywh);\n    return x;\n  }\n\n  get y() {\n    const [, y] = deserializeXYWH(this.xywh);\n    return y;\n  }\n\n  get w() {\n    const [, , w] = deserializeXYWH(this.xywh);\n    return w;\n  }\n\n  get h() {\n    const [, , , h] = deserializeXYWH(this.xywh);\n    return h;\n  }\n\n  get seed() {\n    const seed = this.yMap.get('seed') as T['seed'];\n    return seed;\n  }\n\n  get minWidth() {\n    return this.w;\n  }\n\n  get minHeight() {\n    return this.h;\n  }\n\n  applyUpdate(updates: Partial<T>) {\n    for (const key in updates) {\n      this.yMap.set(key, updates[key] as T[keyof T]);\n    }\n  }\n\n  serialize(): T {\n    return this.yMap.toJSON() as T;\n  }\n\n  hitTest(x: number, y: number, options?: HitTestOptions) {\n    return isPointIn(this, x, y);\n  }\n\n  private _onMap = () => {\n    this.renderer?.removeElement(this);\n    this.renderer?.addElement(this);\n  };\n\n  mount(renderer: Renderer) {\n    this.renderer = renderer;\n    this.renderer.addElement(this);\n    this.yMap.observeDeep(this._onMap);\n  }\n\n  unmount() {\n    this.yMap.unobserveDeep(this._onMap);\n    this.renderer?.removeElement(this);\n    this.renderer = null;\n  }\n\n  render(ctx: CanvasRenderingContext2D, rc: RoughCanvas) {\n    return;\n  }\n}\n", "import { getStroke } from '../../perfect-freehand/getStroke.js';\nimport {\n  Bound,\n  getBoundFromPoints,\n  inflateBound,\n  transformPointsToNewBound,\n} from '../../utils/bound.js';\nimport { Utils } from '../../utils/tl-utils.js';\nimport { SurfaceElement } from '../surface-element.js';\nimport type { IBrush } from './types.js';\n\nfunction getSolidStrokePoints(points: number[][], lineWidth: number) {\n  return getStroke(points, {\n    size: lineWidth,\n    thinning: 0.6,\n    streamline: 0.5,\n    smoothing: 0.5,\n    easing: t => Math.sin((t * Math.PI) / 2),\n    simulatePressure: true,\n  });\n}\n\nexport class BrushElement extends SurfaceElement<IBrush> {\n  /* Brush mouse coords relative to left-top corner */\n  get points() {\n    const points = this.yMap.get('points') as IBrush['points'];\n    return points;\n  }\n\n  get color() {\n    const color = this.yMap.get('color') as IBrush['color'];\n    return color;\n  }\n\n  get lineWidth() {\n    const lineWidth = this.yMap.get('lineWidth') as IBrush['lineWidth'];\n    return lineWidth;\n  }\n\n  override render(ctx: CanvasRenderingContext2D) {\n    const stroke = getSolidStrokePoints(this.points, this.lineWidth);\n    const commands = Utils.getSvgPathFromStroke(stroke);\n    const path = new Path2D(commands);\n\n    ctx.fillStyle = this.computedValue(this.color);\n    ctx.fill(path);\n  }\n\n  override applyUpdate(props: Partial<IBrush>) {\n    const updates: Partial<IBrush> = { ...props };\n\n    const { points, xywh } = props;\n\n    if (points?.length) {\n      const lineWidth = this.lineWidth;\n      const bound = getBoundFromPoints(points);\n      const boundWidthLineWidth = inflateBound(bound, lineWidth);\n      const relativePoints = points.map(([x, y]) => {\n        return [x - boundWidthLineWidth.x, y - boundWidthLineWidth.y];\n      });\n      updates.points = relativePoints;\n\n      updates.xywh = boundWidthLineWidth.serialize();\n    }\n\n    if (xywh) {\n      const bound = Bound.deserialize(xywh);\n      const { lineWidth } = this;\n      const transformed = transformPointsToNewBound(\n        this.points.map(([x, y]) => ({ x, y })),\n        this,\n        lineWidth / 2,\n        bound,\n        lineWidth / 2\n      );\n\n      updates.points = transformed.points.map(p => [p.x, p.y]);\n      updates.xywh = transformed.bound.serialize();\n    }\n\n    if (props.lineWidth && props.lineWidth !== this.lineWidth) {\n      const bound = updates.xywh ? Bound.deserialize(updates.xywh) : this;\n      const points = updates.points ?? this.points;\n      const transformed = transformPointsToNewBound(\n        points.map(([x, y]) => ({ x, y })),\n        bound,\n        this.lineWidth / 2,\n        inflateBound(bound, props.lineWidth - this.lineWidth),\n        props.lineWidth / 2\n      );\n\n      updates.points = transformed.points.map(p => [p.x, p.y]);\n      updates.xywh = transformed.bound.serialize();\n    }\n\n    for (const key in updates) {\n      this.yMap.set(key, updates[key as keyof IBrush] as IBrush[keyof IBrush]);\n    }\n  }\n}\n", "import type { IElementDefaultProps } from '../index.js';\n\nexport const BrushElementDefaultProps: IElementDefaultProps<'brush'> = {\n  type: 'brush',\n  xywh: '[0,0,0,0]',\n\n  points: [],\n  color: '#000000',\n  lineWidth: 4,\n};\n", "import { getBoundFromPoints } from '../../utils/bound.js';\nimport type { Controller } from './types.js';\n\nexport function getArrowPoints(\n  [startX, startY]: number[],\n  [endX, endY]: number[],\n  arrowSize = 10\n) {\n  const dx = endX - startX;\n  const dy = endY - startY;\n  const angle = Math.atan2(dy, dx);\n  const oneSide = [\n    endX - arrowSize * Math.cos(angle - Math.PI / 10),\n    endY - arrowSize * Math.sin(angle - Math.PI / 10),\n  ];\n  const anotherSide = [\n    endX - arrowSize * Math.cos(angle + Math.PI / 10),\n    endY - arrowSize * Math.sin(angle + Math.PI / 10),\n  ];\n  return {\n    sides: [oneSide, anotherSide],\n    start: [startX, startY],\n    end: [endX, endY],\n  };\n}\n\nexport function getConnectorPointsBound(controllers: Controller[]) {\n  const last = controllers[controllers.length - 1];\n  const secondToLast = controllers[controllers.length - 2];\n  const arrowPoints = getArrowPoints(\n    [last.x, last.y],\n    [secondToLast.x, secondToLast.y]\n  );\n\n  const points = arrowPoints.sides.concat(controllers.map(c => [c.x, c.y]));\n  return getBoundFromPoints(points);\n}\n", "import type { RoughCanvas } from 'roughjs/bin/canvas.js';\n\nimport { StrokeStyle } from '../../consts.js';\nimport {\n  Bound,\n  inflateBound,\n  transformPointsToNewBound,\n} from '../../utils/bound.js';\nimport { SurfaceElement } from '../surface-element.js';\nimport type { IConnector } from './types.js';\nimport { ConnectorMode } from './types.js';\nimport { getArrowPoints, getConnectorPointsBound } from './utils.js';\n\nexport class ConnectorElement extends SurfaceElement<IConnector> {\n  get mode() {\n    return this.yMap.get('mode') as IConnector['mode'];\n  }\n\n  get lineWidth() {\n    return this.yMap.get('lineWidth') as IConnector['lineWidth'];\n  }\n\n  get color() {\n    return this.yMap.get('color') as IConnector['color'];\n  }\n\n  get strokeStyle() {\n    return this.yMap.get('strokeStyle') as IConnector['strokeStyle'];\n  }\n\n  get roughness() {\n    return (this.yMap.get('roughness') as IConnector['roughness']) ?? 2;\n  }\n\n  get startElement() {\n    return this.yMap.get('startElement') as IConnector['startElement'];\n  }\n\n  get endElement() {\n    return this.yMap.get('endElement') as IConnector['endElement'];\n  }\n\n  get controllers() {\n    return this.yMap.get('controllers') as IConnector['controllers'];\n  }\n\n  override render(ctx: CanvasRenderingContext2D, rc: RoughCanvas) {\n    const { seed, strokeStyle, color, roughness, lineWidth, controllers } =\n      this;\n    const realStrokeColor = this.computedValue(color);\n\n    if (this.mode === ConnectorMode.Orthogonal) {\n      rc.linearPath(\n        controllers.map(controller => [controller.x, controller.y]),\n        {\n          seed,\n          roughness,\n          strokeLineDash:\n            strokeStyle === StrokeStyle.Dashed ? [12, 12] : undefined,\n          stroke: realStrokeColor,\n          strokeWidth: lineWidth,\n        }\n      );\n    } else {\n      rc.linearPath(\n        [\n          [controllers[0].x, controllers[0].y],\n          [\n            controllers[controllers.length - 1].x,\n            controllers[controllers.length - 1].y,\n          ],\n        ],\n        {\n          seed,\n          roughness,\n          strokeLineDash:\n            strokeStyle === StrokeStyle.Dashed ? [12, 12] : undefined,\n          stroke: realStrokeColor,\n          strokeWidth: lineWidth,\n        }\n      );\n    }\n\n    const last = this.controllers[this.controllers.length - 1];\n    const secondToLast = this.controllers[this.controllers.length - 2];\n\n    //TODO: Adjust arrow direction\n    const { sides, end } = getArrowPoints(\n      [secondToLast.x, secondToLast.y],\n      [last.x, last.y],\n      35\n    );\n    rc.linearPath(\n      [\n        [sides[0][0], sides[0][1]],\n        [end[0], end[1]],\n        [sides[1][0], sides[1][1]],\n      ],\n      {\n        seed,\n        roughness,\n        strokeLineDash:\n          strokeStyle === StrokeStyle.Dashed ? [12, 12] : undefined,\n        stroke: realStrokeColor,\n        strokeWidth: lineWidth,\n      }\n    );\n  }\n\n  override applyUpdate(props: Partial<IConnector>) {\n    const updates = { ...props };\n\n    const { controllers, xywh } = props;\n    if (controllers?.length) {\n      const lineWidth = props.lineWidth ?? this.lineWidth;\n      const bound = getConnectorPointsBound(controllers);\n      const boundWidthLineWidth = inflateBound(bound, lineWidth);\n      const relativeControllers = controllers.map(c => {\n        return {\n          ...c,\n          x: c.x - boundWidthLineWidth.x,\n          y: c.y - boundWidthLineWidth.y,\n        };\n      });\n      updates.controllers = relativeControllers;\n      updates.xywh = boundWidthLineWidth.serialize();\n    }\n\n    if (xywh) {\n      const { lineWidth } = this;\n      const bound = Bound.deserialize(xywh);\n      const transformed = transformPointsToNewBound(\n        this.controllers,\n        this,\n        lineWidth / 2,\n        bound,\n        lineWidth / 2\n      );\n\n      updates.controllers = transformed.points;\n      updates.xywh = transformed.bound.serialize();\n    }\n\n    if (props.lineWidth && props.lineWidth !== this.lineWidth) {\n      const bound = updates.xywh ? Bound.deserialize(updates.xywh) : this;\n      const controllers = updates.controllers ?? this.controllers;\n      const transformed = transformPointsToNewBound(\n        controllers,\n        bound,\n        this.lineWidth / 2,\n        inflateBound(bound, props.lineWidth - this.lineWidth),\n        props.lineWidth / 2\n      );\n\n      updates.controllers = transformed.points;\n      updates.xywh = transformed.bound.serialize();\n    }\n\n    for (const key in updates) {\n      this.yMap.set(\n        key,\n        updates[key as keyof IConnector] as IConnector[keyof IConnector]\n      );\n    }\n  }\n}\n", "import { StrokeStyle } from '../../consts.js';\nimport type { IElementDefaultProps } from '../index.js';\nimport { ConnectorMode } from './types.js';\n\nexport const ConnectorElementDefaultProps: IElementDefaultProps<'connector'> = {\n  type: 'connector',\n  xywh: '[0,0,0,0]',\n\n  mode: ConnectorMode.Orthogonal,\n  lineWidth: 4,\n  color: '#000000',\n  strokeStyle: StrokeStyle.Solid,\n  roughness: 2,\n  controllers: [],\n};\n", "import { type SerializedXYWH } from '../../utils/xywh.js';\nimport type { IElementDefaultProps } from '../index.js';\nimport { SurfaceElement } from '../surface-element.js';\n\nexport interface IDebug {\n  id: string;\n  type: 'debug';\n  xywh: SerializedXYWH;\n  index: string;\n  seed: number;\n\n  color: string;\n}\n\nexport const DebugElementDefaultProps: IElementDefaultProps<'debug'> = {\n  type: 'debug',\n  xywh: '[0,0,0,0]',\n\n  color: '#000000',\n};\n\nexport class DebugElement extends SurfaceElement<IDebug> {\n  get color() {\n    const color = this.yMap.get('color') as IDebug['color'];\n    return color;\n  }\n\n  override render(ctx: CanvasRenderingContext2D): void {\n    ctx.fillStyle = this.color;\n    ctx.fillRect(0, 0, this.w, this.h);\n  }\n}\n", "import { StrokeStyle } from '../../consts.js';\nimport type { IElementDefaultProps } from '../index.js';\n\nexport const ShapeElementDefaultProps: IElementDefaultProps<'shape'> = {\n  type: 'shape',\n  xywh: '[0,0,0,0]',\n\n  shapeType: 'rect',\n  radius: 0,\n  filled: false,\n  fillColor: '#ffffff',\n  strokeWidth: 4,\n  strokeColor: '#000000',\n  strokeStyle: StrokeStyle.Solid,\n  roughness: 2,\n};\n", "import type { RoughCanvas } from 'roughjs/bin/canvas.js';\n\nimport { type IBound, StrokeStyle } from '../../../consts.js';\nimport { Utils } from '../../../utils/tl-utils.js';\nimport type { HitTestOptions } from '../../surface-element.js';\nimport type { ShapeElement } from '../shape-element.js';\nimport type { ShapeMethods } from '../types.js';\n\nexport const DiamondMethods: ShapeMethods = {\n  render(\n    ctx: CanvasRenderingContext2D,\n    rc: RoughCanvas,\n    element: ShapeElement\n  ) {\n    const {\n      w,\n      h,\n      seed,\n      strokeWidth,\n      filled,\n      realFillColor,\n      realStrokeColor,\n      strokeStyle,\n      roughness,\n    } = element;\n\n    const renderOffset = Math.max(strokeWidth, 0) / 2;\n    const renderWidth = w - renderOffset * 2;\n    const renderHeight = h - renderOffset * 2;\n\n    ctx.translate(renderOffset, renderOffset);\n\n    rc.polygon(\n      [\n        [renderWidth / 2, 0],\n        [renderWidth, renderHeight / 2],\n        [renderWidth / 2, renderHeight],\n        [0, renderHeight / 2],\n      ],\n      {\n        seed,\n        roughness,\n        strokeLineDash:\n          strokeStyle === StrokeStyle.Dashed ? [12, 12] : undefined,\n        stroke: realStrokeColor,\n        strokeWidth,\n        fill: filled ? realFillColor : undefined,\n      }\n    );\n  },\n\n  hitTest(x: number, y: number, bound: IBound, options?: HitTestOptions) {\n    const points = [\n      [bound.x + bound.w / 2, bound.y + 0],\n      [bound.x + bound.w, bound.y + bound.h / 2],\n      [bound.x + bound.w / 2, bound.y + bound.h],\n      [bound.x + 0, bound.y + bound.h / 2],\n    ];\n    return Utils.pointInPolygon([x, y], points);\n  },\n};\n", "import type { RoughCanvas } from 'roughjs/bin/canvas.js';\n\nimport { type IBound, StrokeStyle } from '../../../consts.js';\nimport { Utils } from '../../../utils/tl-utils.js';\nimport type { HitTestOptions } from '../../surface-element.js';\nimport type { ShapeElement } from '../shape-element.js';\nimport type { ShapeMethods } from '../types.js';\n\nexport const EllipseMethods: ShapeMethods = {\n  render(\n    ctx: CanvasRenderingContext2D,\n    rc: RoughCanvas,\n    element: ShapeElement\n  ) {\n    const {\n      w,\n      h,\n      seed,\n      strokeWidth,\n      filled,\n      realFillColor,\n      realStrokeColor,\n      strokeStyle,\n      roughness,\n    } = element;\n\n    const renderOffset = Math.max(strokeWidth, 0) / 2;\n    const renderWidth = Math.max(1, w - renderOffset * 2);\n    const renderHeight = Math.max(1, h - renderOffset * 2);\n\n    ctx.translate(renderOffset, renderOffset);\n\n    rc.ellipse(renderWidth / 2, renderHeight / 2, renderWidth, renderHeight, {\n      seed,\n      roughness,\n      strokeLineDash: strokeStyle === StrokeStyle.Dashed ? [12, 12] : undefined,\n      stroke: realStrokeColor,\n      strokeWidth,\n      fill: filled ? realFillColor : undefined,\n    });\n  },\n\n  hitTest(x: number, y: number, bound: IBound, options?: HitTestOptions) {\n    return Utils.pointInEllipse(\n      [x, y],\n      [bound.x + bound.w / 2, bound.y + bound.h / 2],\n      bound.w / 2,\n      bound.h / 2\n    );\n  },\n};\n", "import type { RoughCanvas } from 'roughjs/bin/canvas.js';\n\nimport { type IBound, StrokeStyle } from '../../../consts.js';\nimport { isPointIn } from '../../../utils/hit-utils.js';\nimport type { HitTestOptions } from '../../surface-element.js';\nimport type { ShapeElement } from '../shape-element.js';\nimport type { ShapeMethods } from '../types.js';\n\n/* \"magic number\" for bezier approximations of arcs (http://itc.ktu.lt/itc354/Riskus354.pdf) */\nconst kRect = 1 - 0.5522847498;\n\nexport const RectMethods: ShapeMethods = {\n  render(\n    ctx: CanvasRenderingContext2D,\n    rc: RoughCanvas,\n    element: ShapeElement\n  ) {\n    const {\n      w,\n      h,\n      seed,\n      strokeWidth,\n      filled,\n      realFillColor,\n      realStrokeColor,\n      radius,\n      strokeStyle,\n      roughness,\n    } = element;\n\n    const renderOffset = Math.max(strokeWidth, 0) / 2;\n    const renderWidth = w - renderOffset * 2;\n    const renderHeight = h - renderOffset * 2;\n    const r = Math.min(renderWidth * radius, renderHeight * radius);\n\n    ctx.translate(renderOffset, renderOffset);\n\n    rc.path(\n      `\n      M${r} 0\n      L${renderWidth - r} 0\n      C ${renderWidth - kRect * r} 0 ${renderWidth} ${\n        kRect * r\n      } ${renderWidth} ${r}\n      L${renderWidth} ${renderHeight - r}\n      C ${renderWidth} ${renderHeight - kRect * r} ${\n        renderWidth - kRect * r\n      } ${renderHeight} ${renderWidth - r} ${renderHeight}\n      L${r} ${renderHeight}\n      C ${kRect * r} ${renderHeight} 0 ${renderHeight - kRect * r} 0 ${\n        renderHeight - r\n      }\n      L0 ${r}\n      C 0 ${kRect * r} ${kRect * r} 0 ${r} 0\n      Z\n      `,\n      {\n        seed,\n        roughness,\n        strokeLineDash:\n          strokeStyle === StrokeStyle.Dashed ? [12, 12] : undefined,\n        stroke: realStrokeColor,\n        strokeWidth,\n        fill: filled ? realFillColor : undefined,\n      }\n    );\n  },\n\n  hitTest(x: number, y: number, bound: IBound, options?: HitTestOptions) {\n    return isPointIn(bound, x, y);\n  },\n};\n", "import type { RoughCanvas } from 'roughjs/bin/canvas.js';\n\nimport { type IBound, StrokeStyle } from '../../../consts.js';\nimport { Utils } from '../../../utils/tl-utils.js';\nimport type { HitTestOptions } from '../../surface-element.js';\nimport type { ShapeElement } from '../shape-element.js';\nimport type { ShapeMethods } from '../types.js';\n\nexport const TriangleMethods: ShapeMethods = {\n  render(\n    ctx: CanvasRenderingContext2D,\n    rc: RoughCanvas,\n    element: ShapeElement\n  ) {\n    const {\n      w,\n      h,\n      seed,\n      strokeWidth,\n      filled,\n      realFillColor,\n      realStrokeColor,\n      strokeStyle,\n      roughness,\n    } = element;\n\n    const renderOffset = Math.max(strokeWidth, 0) / 2;\n    const renderWidth = w - renderOffset * 2;\n    const renderHeight = h - renderOffset * 2;\n\n    ctx.translate(renderOffset, renderOffset);\n\n    rc.polygon(\n      [\n        [renderWidth / 2, 0],\n        [renderWidth, renderHeight],\n        [0, renderHeight],\n      ],\n      {\n        seed,\n        roughness,\n        strokeLineDash:\n          strokeStyle === StrokeStyle.Dashed ? [12, 12] : undefined,\n        stroke: realStrokeColor,\n        strokeWidth,\n        fill: filled ? realFillColor : undefined,\n      }\n    );\n  },\n\n  hitTest(x: number, y: number, bound: IBound, options?: HitTestOptions) {\n    const points = [\n      [bound.x + bound.w / 2, bound.y + 0],\n      [bound.x + bound.w, bound.y + bound.h],\n      [bound.x + 0, bound.y + bound.h],\n    ];\n    return Utils.pointInPolygon([x, y], points);\n  },\n};\n", "import type { ShapeMethods, ShapeType } from '../types.js';\nimport { DiamondMethods } from './diamond.js';\nimport { EllipseMethods } from './ellipse.js';\nimport { RectMethods } from './rect.js';\nimport { TriangleMethods } from './triangle.js';\n\nexport const ShapeMethodsMap: Record<ShapeType, ShapeMethods> = {\n  rect: RectMethods,\n  triangle: TriangleMethods,\n  ellipse: EllipseMethods,\n  diamond: DiamondMethods,\n};\n", "import type { RoughCanvas } from 'roughjs/bin/canvas.js';\n\nimport { type HitTestOptions, SurfaceElement } from '../surface-element.js';\nimport { ShapeMethodsMap } from './shapes/index.js';\nimport type { IShape } from './types.js';\n\nexport class ShapeElement extends SurfaceElement<IShape> {\n  get shapeType() {\n    const shapeType = this.yMap.get('shapeType') as IShape['shapeType'];\n    return shapeType;\n  }\n\n  get radius() {\n    const radius = this.yMap.get('radius') as IShape['radius'];\n    return radius;\n  }\n\n  get filled() {\n    const filled = this.yMap.get('filled') as IShape['filled'];\n    return filled;\n  }\n\n  get fillColor() {\n    const fillColor = this.yMap.get('fillColor') as IShape['fillColor'];\n    return fillColor;\n  }\n\n  get strokeWidth() {\n    const strokeWidth = this.yMap.get('strokeWidth') as IShape['strokeWidth'];\n    return strokeWidth;\n  }\n\n  get strokeColor() {\n    const strokeColor = this.yMap.get('strokeColor') as IShape['strokeColor'];\n    return strokeColor;\n  }\n\n  get strokeStyle() {\n    const strokeStyle = this.yMap.get('strokeStyle') as IShape['strokeStyle'];\n    return strokeStyle;\n  }\n\n  get roughness() {\n    const roughness = (this.yMap.get('roughness') as IShape['roughness']) ?? 2;\n    return roughness;\n  }\n\n  get realStrokeColor() {\n    return this.computedValue(this.strokeColor);\n  }\n\n  get realFillColor() {\n    return this.computedValue(this.fillColor);\n  }\n\n  override hitTest(x: number, y: number, options?: HitTestOptions) {\n    const { hitTest } = ShapeMethodsMap[this.shapeType];\n    return hitTest(x, y, this, options);\n  }\n\n  override render(ctx: CanvasRenderingContext2D, rc: RoughCanvas) {\n    const { render } = ShapeMethodsMap[this.shapeType];\n    render(ctx, rc, this);\n  }\n}\n", "import * as Y from 'yjs';\n\nimport type { IElementDefaultProps } from '../index.js';\n\nexport const TextElementDefaultProps: IElementDefaultProps<'text'> = {\n  type: 'text',\n  xywh: '[0,0,0,0]',\n\n  text: new Y.Text(),\n  color: '#000000',\n  fontSize: 16,\n  fontFamily: \"'Kalam', cursive\",\n  textAlign: 'center',\n};\n", "// something comes from https://github.com/excalidraw/excalidraw/blob/b1311a407a636c87ee0ca326fd20599d0ce4ba9b/src/utils.ts\n\nimport type { ITextDelta } from './types.js';\n\nconst RS_LTR_CHARS =\n  'A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02B8\\u0300-\\u0590\\u0800-\\u1FFF' +\n  '\\u2C00-\\uFB1C\\uFDFE-\\uFE6F\\uFEFD-\\uFFFF';\nconst RS_RTL_CHARS = '\\u0591-\\u07FF\\uFB1D-\\uFDFD\\uFE70-\\uFEFC';\n// eslint-disable-next-line no-misleading-character-class\nconst RE_RTL_CHECK = new RegExp(`^[^${RS_LTR_CHARS}]*[${RS_RTL_CHARS}]`);\nexport const isRTL = (text: string) => RE_RTL_CHECK.test(text);\n\nexport const isChrome =\n  globalThis.navigator?.userAgent.indexOf('Chrome') !== -1;\nexport const isSafari =\n  !isChrome && globalThis.navigator?.userAgent.indexOf('Safari') !== -1;\n\nexport const getFontString = ({\n  fontSize,\n  fontFamily,\n  lineHeight,\n}: {\n  fontSize: number;\n  lineHeight: string;\n  fontFamily: string;\n}) => {\n  return `${fontSize}px/${lineHeight} ${fontFamily}`;\n};\n\nexport function normalizeText(text: string): string {\n  return (\n    text\n      // replace tabs with spaces so they render and measure correctly\n      .replace(/\\t/g, '        ')\n      // normalize newlines\n      .replace(/\\r?\\n|\\r/g, '\\n')\n  );\n}\n\nexport const splitIntoLines = (text: string) => {\n  return normalizeText(text).split('\\n');\n};\n\nexport function getLineWidth(text: string, font: string): number {\n  const canvas = document.createElement('canvas');\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const canvas2dContext = canvas.getContext('2d')!;\n  canvas2dContext.font = font;\n  const width = canvas2dContext.measureText(text).width;\n\n  return width;\n}\n\nexport function getTextWidth(text: string, font: string): number {\n  const lines = splitIntoLines(text);\n  let width = 0;\n  lines.forEach(line => {\n    width = Math.max(width, getLineWidth(line, font));\n  });\n  return width;\n}\n\nexport function parseTokens(text: string): string[] {\n  // Splitting words containing \"-\" as those are treated as separate words\n  // by css wrapping algorithm eg non-profit => non-, profit\n  const words = text.split('-');\n  if (words.length > 1) {\n    // non-proft org => ['non-', 'profit org']\n    words.forEach((word, index) => {\n      if (index !== words.length - 1) {\n        words[index] = word += '-';\n      }\n    });\n  }\n  // Joining the words with space and splitting them again with space to get the\n  // final list of tokens\n  // ['non-', 'profit org'] =>,'non- proft org' => ['non-','profit','org']\n  return words.join(' ').split(' ');\n}\n\nexport const charWidth = (() => {\n  const cachedCharWidth: { [key: string]: Array<number> } = {};\n\n  const calculate = (char: string, font: string) => {\n    const ascii = char.charCodeAt(0);\n    if (!cachedCharWidth[font]) {\n      cachedCharWidth[font] = [];\n    }\n    if (!cachedCharWidth[font][ascii]) {\n      const width = getLineWidth(char, font);\n      cachedCharWidth[font][ascii] = width;\n    }\n\n    return cachedCharWidth[font][ascii];\n  };\n\n  const getCache = (font: string) => {\n    return cachedCharWidth[font];\n  };\n  return {\n    calculate,\n    getCache,\n  };\n})();\n\nexport function wrapText(text: string, font: string, maxWidth: number): string {\n  // if maxWidth is not finite or NaN which can happen in case of bugs in\n  // computation, we need to make sure we don't continue as we'll end up\n  // in an infinite loop\n  if (!Number.isFinite(maxWidth) || maxWidth < 0) {\n    return text;\n  }\n\n  const lines: Array<string> = [];\n  const originalLines = text.split('\\n');\n  const spaceWidth = getLineWidth(' ', font);\n\n  let currentLine = '';\n  let currentLineWidthTillNow = 0;\n\n  const push = (str: string) => {\n    if (str.trim()) {\n      lines.push(str);\n    }\n  };\n\n  const resetParams = () => {\n    currentLine = '';\n    currentLineWidthTillNow = 0;\n  };\n  originalLines.forEach(originalLine => {\n    const currentLineWidth = getTextWidth(originalLine, font);\n\n    // Push the line if its <= maxWidth\n    if (currentLineWidth <= maxWidth) {\n      lines.push(originalLine);\n      return; // continue\n    }\n\n    const words = parseTokens(originalLine);\n    resetParams();\n\n    let index = 0;\n\n    while (index < words.length) {\n      const currentWordWidth = getLineWidth(words[index], font);\n\n      // This will only happen when single word takes entire width\n      if (currentWordWidth === maxWidth) {\n        push(words[index]);\n        index++;\n      }\n\n      // Start breaking longer words exceeding max width\n      else if (currentWordWidth > maxWidth) {\n        // push current line since the current word exceeds the max width\n        // so will be appended in next line\n\n        push(currentLine);\n\n        resetParams();\n\n        while (words[index].length > 0) {\n          const currentChar = String.fromCodePoint(\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            words[index].codePointAt(0)!\n          );\n          const width = charWidth.calculate(currentChar, font);\n          currentLineWidthTillNow += width;\n          words[index] = words[index].slice(currentChar.length);\n\n          if (currentLineWidthTillNow >= maxWidth) {\n            push(currentLine);\n            currentLine = currentChar;\n            currentLineWidthTillNow = width;\n          } else {\n            currentLine += currentChar;\n          }\n        }\n        // push current line if appending space exceeds max width\n        if (currentLineWidthTillNow + spaceWidth >= maxWidth) {\n          push(currentLine);\n          resetParams();\n          // space needs to be appended before next word\n          // as currentLine contains chars which couldn't be appended\n          // to previous line unless the line ends with hyphen to sync\n          // with css word-wrap\n        } else if (!currentLine.endsWith('-')) {\n          currentLine += ' ';\n          currentLineWidthTillNow += spaceWidth;\n        }\n        index++;\n      } else {\n        // Start appending words in a line till max width reached\n        while (currentLineWidthTillNow < maxWidth && index < words.length) {\n          const word = words[index];\n          currentLineWidthTillNow = getLineWidth(currentLine + word, font);\n\n          if (currentLineWidthTillNow > maxWidth) {\n            push(currentLine);\n            resetParams();\n\n            break;\n          }\n          index++;\n\n          // if word ends with \"-\" then we don't need to add space\n          // to sync with css word-wrap\n          const shouldAppendSpace = !word.endsWith('-');\n          currentLine += word;\n\n          if (shouldAppendSpace) {\n            currentLine += ' ';\n          }\n\n          // Push the word if appending space exceeds max width\n          if (currentLineWidthTillNow + spaceWidth >= maxWidth) {\n            if (shouldAppendSpace) {\n              lines.push(currentLine.slice(0, -1));\n            } else {\n              lines.push(currentLine);\n            }\n            resetParams();\n            break;\n          }\n        }\n      }\n    }\n    if (currentLine.slice(-1) === ' ') {\n      // only remove last trailing space which we have added when joining words\n      currentLine = currentLine.slice(0, -1);\n      push(currentLine);\n    }\n  });\n  return lines.join('\\n');\n}\n\nfunction transformDelta(delta: ITextDelta): (ITextDelta | '\\n')[] {\n  const result: (ITextDelta | '\\n')[] = [];\n\n  let tmpString = delta.insert;\n  while (tmpString.length > 0) {\n    const index = tmpString.indexOf('\\n');\n    if (index === -1) {\n      result.push({\n        insert: tmpString,\n        attributes: delta.attributes,\n      });\n      break;\n    }\n\n    if (tmpString.slice(0, index).length > 0) {\n      result.push({\n        insert: tmpString.slice(0, index),\n        attributes: delta.attributes,\n      });\n    }\n\n    result.push('\\n');\n    tmpString = tmpString.slice(index + 1);\n  }\n\n  return result;\n}\n\n/**\n * convert a delta insert array to chunks, each chunk is a line\n */\nexport function deltaInsertsToChunks(delta: ITextDelta[]): ITextDelta[][] {\n  if (delta.length === 0) {\n    return [[]];\n  }\n\n  const transformedDelta = delta.flatMap(transformDelta);\n\n  function* chunksGenerator(arr: (ITextDelta | '\\n')[]) {\n    let start = 0;\n    for (let i = 0; i < arr.length; i++) {\n      if (arr[i] === '\\n') {\n        const chunk = arr.slice(start, i);\n        start = i + 1;\n        yield chunk as ITextDelta[];\n      } else if (i === arr.length - 1) {\n        yield arr.slice(start) as ITextDelta[];\n      }\n    }\n\n    if (arr.at(-1) === '\\n') {\n      yield [];\n    }\n  }\n\n  return [...chunksGenerator(transformedDelta)];\n}\n", "import { SurfaceElement } from '../surface-element.js';\nimport type { IText, ITextDelta } from './types.js';\nimport {\n  deltaInsertsToChunks,\n  getFontString,\n  getTextWidth,\n  isRTL,\n} from './utils.js';\n\nexport class TextElement extends SurfaceElement<IText> {\n  get text() {\n    return this.yMap.get('text') as IText['text'];\n  }\n\n  get color() {\n    return this.yMap.get('color') as IText['color'];\n  }\n\n  get fontSize() {\n    return this.yMap.get('fontSize') as IText['fontSize'];\n  }\n\n  get fontFamily() {\n    return this.yMap.get('fontFamily') as IText['fontFamily'];\n  }\n\n  get textAlign() {\n    return this.yMap.get('textAlign') as IText['textAlign'];\n  }\n\n  private _maxTextWidth = 0;\n  private _maxTextHeight = 0;\n\n  override get minWidth() {\n    return this._maxTextWidth;\n  }\n\n  override get minHeight() {\n    return this._maxTextHeight;\n  }\n\n  private _lineHeight = 0;\n  private _lines: ITextDelta[][] = [];\n\n  get lineHeight() {\n    return this._lineHeight;\n  }\n\n  get lines() {\n    return this._lines;\n  }\n\n  override render(ctx: CanvasRenderingContext2D) {\n    const { w, text, color, fontSize, fontFamily, textAlign } = this;\n\n    const yText = text;\n    const deltas: ITextDelta[] = yText.toDelta() as ITextDelta[];\n    const lines = deltaInsertsToChunks(deltas);\n    this._lines = lines;\n\n    const lineHeightPx = this.h / lines.length;\n    const font = getFontString({\n      fontSize: fontSize,\n      lineHeight: `${lineHeightPx}px`,\n      fontFamily: fontFamily,\n    });\n    this._lineHeight = lineHeightPx;\n    const horizontalOffset =\n      textAlign === 'center' ? w / 2 : textAlign === 'right' ? w : 0;\n\n    for (const [lineIndex, line] of lines.entries()) {\n      let beforeTextWidth = 0;\n\n      for (const delta of line) {\n        ctx.save();\n\n        const str = delta.insert;\n        const rtl = isRTL(str);\n        const shouldTemporarilyAttach = rtl && !ctx.canvas.isConnected;\n        if (shouldTemporarilyAttach) {\n          // to correctly render RTL text mixed with LTR, we have to append it\n          // to the DOM\n          document.body.appendChild(ctx.canvas);\n        }\n        ctx.canvas.setAttribute('dir', rtl ? 'rtl' : 'ltr');\n        ctx.font = font;\n        ctx.fillStyle = this.computedValue(color);\n        ctx.textAlign = textAlign;\n\n        ctx.textBaseline = 'ideographic';\n\n        ctx.fillText(\n          str,\n          horizontalOffset + beforeTextWidth,\n          (lineIndex + 1) * lineHeightPx\n        );\n\n        beforeTextWidth += getTextWidth(str, fontFamily);\n\n        if (shouldTemporarilyAttach) {\n          ctx.canvas.remove();\n        }\n\n        ctx.restore();\n      }\n\n      if (beforeTextWidth > this._maxTextWidth) {\n        this._maxTextWidth = beforeTextWidth;\n      }\n    }\n\n    if (this._maxTextHeight < lines.length * lineHeightPx) {\n      this._maxTextHeight = lines.length * lineHeightPx;\n    }\n  }\n}\n", "import type { SurfaceElement } from '../index.js';\nimport { BrushElement } from './brush/brush-element.js';\nimport { BrushElementDefaultProps } from './brush/constants.js';\nimport type { IBrush } from './brush/types.js';\nimport { ConnectorElement } from './connector/connector-element.js';\nimport { ConnectorElementDefaultProps } from './connector/constants.js';\nimport type { IConnector } from './connector/types.js';\nimport {\n  DebugElement,\n  DebugElementDefaultProps,\n  type IDebug,\n} from './debug/debug-element.js';\nimport { ShapeElementDefaultProps } from './shape/constants.js';\nimport { ShapeElement } from './shape/shape-element.js';\nimport type { IShape } from './shape/types.js';\nimport { TextElementDefaultProps } from './text/constants.js';\nimport { TextElement } from './text/text-element.js';\nimport type { IText } from './text/types.js';\n\nexport { BrushElement } from './brush/brush-element.js';\nexport { ConnectorElement } from './connector/connector-element.js';\nexport { DebugElement } from './debug/debug-element.js';\nexport { ShapeElement } from './shape/shape-element.js';\nexport type { ShapeType } from './shape/types.js';\nexport type { SurfaceElement } from './surface-element.js';\nexport { TextElement } from './text/text-element.js';\n\nexport type PhasorElement =\n  | ShapeElement\n  | DebugElement\n  | BrushElement\n  | ConnectorElement\n  | SurfaceElement;\n\nexport type PhasorElementType = {\n  shape: ShapeElement;\n  debug: DebugElement;\n  brush: BrushElement;\n  connector: ConnectorElement;\n  text: TextElement;\n};\n\nexport type IPhasorElementType = {\n  shape: IShape;\n  debug: IDebug;\n  brush: IBrush;\n  connector: IConnector;\n  text: IText;\n};\n\nexport const ElementCtors = {\n  debug: DebugElement,\n  brush: BrushElement,\n  shape: ShapeElement,\n  connector: ConnectorElement,\n  text: TextElement,\n} as const;\n\nexport const ElementDefaultProps: Record<\n  keyof IPhasorElementType,\n  IElementDefaultProps<keyof IPhasorElementType>\n> = {\n  debug: DebugElementDefaultProps,\n  brush: BrushElementDefaultProps,\n  shape: ShapeElementDefaultProps,\n  connector: ConnectorElementDefaultProps,\n  text: TextElementDefaultProps,\n} as const;\n\nexport type IElementCreateProps<T extends keyof IPhasorElementType> = Partial<\n  Omit<IPhasorElementType[T], 'id' | 'index' | 'seed'>\n>;\n\nexport type IElementDefaultProps<T extends keyof IPhasorElementType> = Omit<\n  IPhasorElementType[T],\n  'id' | 'index' | 'seed'\n>;\n\nexport type { IBrush, IConnector, IDebug, IShape, IText };\n", "import { assertExists } from '@blocksuite/store';\n\nimport { GRID_SIZE, type IBound } from './consts.js';\nimport type { SurfaceElement } from './elements/surface-element.js';\nimport { intersects, isPointIn } from './utils/hit-utils.js';\n\nfunction getGridIndex(val: number) {\n  return Math.ceil(val / GRID_SIZE) - 1;\n}\n\nfunction rangeFromBound(a: IBound): number[] {\n  const minRow = getGridIndex(a.x);\n  const maxRow = getGridIndex(a.x + a.w);\n  const minCol = getGridIndex(a.y);\n  const maxCol = getGridIndex(a.y + a.h);\n  return [minRow, maxRow, minCol, maxCol];\n}\n\n// Dont compare by id, '398303718:2' > '398303718:14' is true\nexport function compare<T extends { id: string; index: string }>(\n  a: T,\n  b: T\n): number {\n  if (a.index < b.index) return -1;\n  if (a.index > b.index) return 1;\n  return 0;\n}\n\nexport class GridManager {\n  private _grids: Map<string, Set<SurfaceElement>> = new Map();\n  private _elementToGrids: Map<SurfaceElement, Set<Set<SurfaceElement>>> =\n    new Map();\n\n  private _createGrid(row: number, col: number) {\n    const id = row + '|' + col;\n    const elements: Set<SurfaceElement> = new Set();\n    this._grids.set(id, elements);\n    return elements;\n  }\n\n  private _getGrid(row: number, col: number) {\n    const id = row + '|' + col;\n    return this._grids.get(id);\n  }\n\n  get isEmpty() {\n    return this._grids.size === 0;\n  }\n\n  add(element: SurfaceElement) {\n    const [minRow, maxRow, minCol, maxCol] = rangeFromBound(element);\n    const grids = new Set<Set<SurfaceElement>>();\n    this._elementToGrids.set(element, grids);\n\n    for (let i = minRow; i <= maxRow; i++) {\n      for (let j = minCol; j <= maxCol; j++) {\n        let grid = this._getGrid(i, j);\n        if (!grid) {\n          grid = this._createGrid(i, j);\n        }\n        grid.add(element);\n        grids.add(grid);\n      }\n    }\n  }\n\n  remove(element: SurfaceElement) {\n    const grids = this._elementToGrids.get(element);\n    assertExists(grids);\n\n    for (const grid of grids) {\n      grid.delete(element);\n    }\n  }\n\n  boundHasChanged(a: IBound, b: IBound) {\n    const [minRow, maxRow, minCol, maxCol] = rangeFromBound(a);\n    const [minRow2, maxRow2, minCol2, maxCol2] = rangeFromBound(b);\n    return (\n      minRow !== minRow2 ||\n      maxRow !== maxRow2 ||\n      minCol !== minCol2 ||\n      maxCol !== maxCol2\n    );\n  }\n\n  search(bound: IBound): SurfaceElement[] {\n    const [minRow, maxRow, minCol, maxCol] = rangeFromBound(bound);\n    const results: Set<SurfaceElement> = new Set();\n    for (let i = minRow; i <= maxRow; i++) {\n      for (let j = minCol; j <= maxCol; j++) {\n        const gridElements = this._getGrid(i, j);\n        if (!gridElements) continue;\n\n        for (const element of gridElements) {\n          if (intersects(element, bound)) {\n            results.add(element);\n          }\n        }\n      }\n    }\n\n    // sort elements in set based on index\n    const sorted = Array.from(results).sort(compare);\n\n    return sorted;\n  }\n\n  pick(x: number, y: number): SurfaceElement[] {\n    const row = getGridIndex(x);\n    const col = getGridIndex(y);\n    const gridElements = this._getGrid(row, col);\n    if (!gridElements) return [];\n\n    const results: SurfaceElement[] = [];\n    for (const element of gridElements) {\n      if (isPointIn(element, x, y)) {\n        results.push(element);\n      }\n    }\n\n    return results;\n  }\n}\n", "export function rotatePoints(points, center, degrees) {\n    if (points && points.length) {\n        const [cx, cy] = center;\n        const angle = (Math.PI / 180) * degrees;\n        const cos = Math.cos(angle);\n        const sin = Math.sin(angle);\n        points.forEach((p) => {\n            const [x, y] = p;\n            p[0] = ((x - cx) * cos) - ((y - cy) * sin) + cx;\n            p[1] = ((x - cx) * sin) + ((y - cy) * cos) + cy;\n        });\n    }\n}\nexport function rotateLines(lines, center, degrees) {\n    const points = [];\n    lines.forEach((line) => points.push(...line));\n    rotatePoints(points, center, degrees);\n}\nexport function lineLength(line) {\n    const p1 = line[0];\n    const p2 = line[1];\n    return Math.sqrt(Math.pow(p1[0] - p2[0], 2) + Math.pow(p1[1] - p2[1], 2));\n}\n", "import { rotatePoints, rotateLines } from '../geometry';\nexport function polygonHachureLines(polygonList, o) {\n    const angle = o.hachureAngle + 90;\n    let gap = o.hachureGap;\n    if (gap < 0) {\n        gap = o.strokeWidth * 4;\n    }\n    gap = Math.max(gap, 0.1);\n    const rotationCenter = [0, 0];\n    if (angle) {\n        for (const polygon of polygonList) {\n            rotatePoints(polygon, rotationCenter, angle);\n        }\n    }\n    const lines = straightHachureLines(polygonList, gap);\n    if (angle) {\n        for (const polygon of polygonList) {\n            rotatePoints(polygon, rotationCenter, -angle);\n        }\n        rotateLines(lines, rotationCenter, -angle);\n    }\n    return lines;\n}\nfunction straightHachureLines(polygonList, gap) {\n    const vertexArray = [];\n    for (const polygon of polygonList) {\n        const vertices = [...polygon];\n        if (vertices[0].join(',') !== vertices[vertices.length - 1].join(',')) {\n            vertices.push([vertices[0][0], vertices[0][1]]);\n        }\n        if (vertices.length > 2) {\n            vertexArray.push(vertices);\n        }\n    }\n    const lines = [];\n    gap = Math.max(gap, 0.1);\n    // Create sorted edges table\n    const edges = [];\n    for (const vertices of vertexArray) {\n        for (let i = 0; i < vertices.length - 1; i++) {\n            const p1 = vertices[i];\n            const p2 = vertices[i + 1];\n            if (p1[1] !== p2[1]) {\n                const ymin = Math.min(p1[1], p2[1]);\n                edges.push({\n                    ymin,\n                    ymax: Math.max(p1[1], p2[1]),\n                    x: ymin === p1[1] ? p1[0] : p2[0],\n                    islope: (p2[0] - p1[0]) / (p2[1] - p1[1]),\n                });\n            }\n        }\n    }\n    edges.sort((e1, e2) => {\n        if (e1.ymin < e2.ymin) {\n            return -1;\n        }\n        if (e1.ymin > e2.ymin) {\n            return 1;\n        }\n        if (e1.x < e2.x) {\n            return -1;\n        }\n        if (e1.x > e2.x) {\n            return 1;\n        }\n        if (e1.ymax === e2.ymax) {\n            return 0;\n        }\n        return (e1.ymax - e2.ymax) / Math.abs((e1.ymax - e2.ymax));\n    });\n    if (!edges.length) {\n        return lines;\n    }\n    // Start scanning\n    let activeEdges = [];\n    let y = edges[0].ymin;\n    while (activeEdges.length || edges.length) {\n        if (edges.length) {\n            let ix = -1;\n            for (let i = 0; i < edges.length; i++) {\n                if (edges[i].ymin > y) {\n                    break;\n                }\n                ix = i;\n            }\n            const removed = edges.splice(0, ix + 1);\n            removed.forEach((edge) => {\n                activeEdges.push({ s: y, edge });\n            });\n        }\n        activeEdges = activeEdges.filter((ae) => {\n            if (ae.edge.ymax <= y) {\n                return false;\n            }\n            return true;\n        });\n        activeEdges.sort((ae1, ae2) => {\n            if (ae1.edge.x === ae2.edge.x) {\n                return 0;\n            }\n            return (ae1.edge.x - ae2.edge.x) / Math.abs((ae1.edge.x - ae2.edge.x));\n        });\n        // fill between the edges\n        if (activeEdges.length > 1) {\n            for (let i = 0; i < activeEdges.length; i = i + 2) {\n                const nexti = i + 1;\n                if (nexti >= activeEdges.length) {\n                    break;\n                }\n                const ce = activeEdges[i].edge;\n                const ne = activeEdges[nexti].edge;\n                lines.push([\n                    [Math.round(ce.x), y],\n                    [Math.round(ne.x), y],\n                ]);\n            }\n        }\n        y += gap;\n        activeEdges.forEach((ae) => {\n            ae.edge.x = ae.edge.x + (gap * ae.edge.islope);\n        });\n    }\n    return lines;\n}\n", "import { polygonHachureLines } from './scan-line-hachure';\nexport class HachureFiller {\n    constructor(helper) {\n        this.helper = helper;\n    }\n    fillPolygons(polygonList, o) {\n        return this._fillPolygons(polygonList, o);\n    }\n    _fillPolygons(polygonList, o) {\n        const lines = polygonHachureLines(polygonList, o);\n        const ops = this.renderLines(lines, o);\n        return { type: 'fillSketch', ops };\n    }\n    renderLines(lines, o) {\n        const ops = [];\n        for (const line of lines) {\n            ops.push(...this.helper.doubleLineOps(line[0][0], line[0][1], line[1][0], line[1][1], o));\n        }\n        return ops;\n    }\n}\n", "import { HachureFiller } from './hachure-filler';\nimport { polygonHachureLines } from './scan-line-hachure';\nimport { lineLength } from '../geometry';\nexport class ZigZagFiller extends HachureFiller {\n    fillPolygons(polygonList, o) {\n        let gap = o.hachureGap;\n        if (gap < 0) {\n            gap = o.strokeWidth * 4;\n        }\n        gap = Math.max(gap, 0.1);\n        const o2 = Object.assign({}, o, { hachureGap: gap });\n        const lines = polygonHachureLines(polygonList, o2);\n        const zigZagAngle = (Math.PI / 180) * o.hachureAngle;\n        const zigzagLines = [];\n        const dgx = gap * 0.5 * Math.cos(zigZagAngle);\n        const dgy = gap * 0.5 * Math.sin(zigZagAngle);\n        for (const [p1, p2] of lines) {\n            if (lineLength([p1, p2])) {\n                zigzagLines.push([\n                    [p1[0] - dgx, p1[1] + dgy],\n                    [...p2],\n                ], [\n                    [p1[0] + dgx, p1[1] - dgy],\n                    [...p2],\n                ]);\n            }\n        }\n        const ops = this.renderLines(zigzagLines, o);\n        return { type: 'fillSketch', ops };\n    }\n}\n", "import { HachureFiller } from './hachure-filler';\nexport class HatchFiller extends HachureFiller {\n    fillPolygons(polygonList, o) {\n        const set = this._fillPolygons(polygonList, o);\n        const o2 = Object.assign({}, o, { hachureAngle: o.hachureAngle + 90 });\n        const set2 = this._fillPolygons(polygonList, o2);\n        set.ops = set.ops.concat(set2.ops);\n        return set;\n    }\n}\n", "import { lineLength } from '../geometry';\nimport { polygonHachureLines } from './scan-line-hachure';\nexport class DotFiller {\n    constructor(helper) {\n        this.helper = helper;\n    }\n    fillPolygons(polygonList, o) {\n        o = Object.assign({}, o, { hachureAngle: 0 });\n        const lines = polygonHachureLines(polygonList, o);\n        return this.dotsOnLines(lines, o);\n    }\n    dotsOnLines(lines, o) {\n        const ops = [];\n        let gap = o.hachureGap;\n        if (gap < 0) {\n            gap = o.strokeWidth * 4;\n        }\n        gap = Math.max(gap, 0.1);\n        let fweight = o.fillWeight;\n        if (fweight < 0) {\n            fweight = o.strokeWidth / 2;\n        }\n        const ro = gap / 4;\n        for (const line of lines) {\n            const length = lineLength(line);\n            const dl = length / gap;\n            const count = Math.ceil(dl) - 1;\n            const offset = length - (count * gap);\n            const x = ((line[0][0] + line[1][0]) / 2) - (gap / 4);\n            const minY = Math.min(line[0][1], line[1][1]);\n            for (let i = 0; i < count; i++) {\n                const y = minY + offset + (i * gap);\n                const cx = (x - ro) + Math.random() * 2 * ro;\n                const cy = (y - ro) + Math.random() * 2 * ro;\n                const el = this.helper.ellipse(cx, cy, fweight, fweight, o);\n                ops.push(...el.ops);\n            }\n        }\n        return { type: 'fillSketch', ops };\n    }\n}\n", "import { lineLength } from '../geometry';\nimport { polygonHachureLines } from './scan-line-hachure';\nexport class DashedFiller {\n    constructor(helper) {\n        this.helper = helper;\n    }\n    fillPolygons(polygonList, o) {\n        const lines = polygonHachureLines(polygonList, o);\n        return { type: 'fillSketch', ops: this.dashedLine(lines, o) };\n    }\n    dashedLine(lines, o) {\n        const offset = o.dashOffset < 0 ? (o.hachureGap < 0 ? (o.strokeWidth * 4) : o.hachureGap) : o.dashOffset;\n        const gap = o.dashGap < 0 ? (o.hachureGap < 0 ? (o.strokeWidth * 4) : o.hachureGap) : o.dashGap;\n        const ops = [];\n        lines.forEach((line) => {\n            const length = lineLength(line);\n            const count = Math.floor(length / (offset + gap));\n            const startOffset = (length + gap - (count * (offset + gap))) / 2;\n            let p1 = line[0];\n            let p2 = line[1];\n            if (p1[0] > p2[0]) {\n                p1 = line[1];\n                p2 = line[0];\n            }\n            const alpha = Math.atan((p2[1] - p1[1]) / (p2[0] - p1[0]));\n            for (let i = 0; i < count; i++) {\n                const lstart = i * (offset + gap);\n                const lend = lstart + offset;\n                const start = [p1[0] + (lstart * Math.cos(alpha)) + (startOffset * Math.cos(alpha)), p1[1] + lstart * Math.sin(alpha) + (startOffset * Math.sin(alpha))];\n                const end = [p1[0] + (lend * Math.cos(alpha)) + (startOffset * Math.cos(alpha)), p1[1] + (lend * Math.sin(alpha)) + (startOffset * Math.sin(alpha))];\n                ops.push(...this.helper.doubleLineOps(start[0], start[1], end[0], end[1], o));\n            }\n        });\n        return ops;\n    }\n}\n", "import { lineLength } from '../geometry';\nimport { polygonHachureLines } from './scan-line-hachure';\nexport class ZigZagLineFiller {\n    constructor(helper) {\n        this.helper = helper;\n    }\n    fillPolygons(polygonList, o) {\n        const gap = o.hachureGap < 0 ? (o.strokeWidth * 4) : o.hachureGap;\n        const zo = o.zigzagOffset < 0 ? gap : o.zigzagOffset;\n        o = Object.assign({}, o, { hachureGap: gap + zo });\n        const lines = polygonHachureLines(polygonList, o);\n        return { type: 'fillSketch', ops: this.zigzagLines(lines, zo, o) };\n    }\n    zigzagLines(lines, zo, o) {\n        const ops = [];\n        lines.forEach((line) => {\n            const length = lineLength(line);\n            const count = Math.round(length / (2 * zo));\n            let p1 = line[0];\n            let p2 = line[1];\n            if (p1[0] > p2[0]) {\n                p1 = line[1];\n                p2 = line[0];\n            }\n            const alpha = Math.atan((p2[1] - p1[1]) / (p2[0] - p1[0]));\n            for (let i = 0; i < count; i++) {\n                const lstart = i * 2 * zo;\n                const lend = (i + 1) * 2 * zo;\n                const dz = Math.sqrt(2 * Math.pow(zo, 2));\n                const start = [p1[0] + (lstart * Math.cos(alpha)), p1[1] + lstart * Math.sin(alpha)];\n                const end = [p1[0] + (lend * Math.cos(alpha)), p1[1] + (lend * Math.sin(alpha))];\n                const middle = [start[0] + dz * Math.cos(alpha + Math.PI / 4), start[1] + dz * Math.sin(alpha + Math.PI / 4)];\n                ops.push(...this.helper.doubleLineOps(start[0], start[1], middle[0], middle[1], o), ...this.helper.doubleLineOps(middle[0], middle[1], end[0], end[1], o));\n            }\n        });\n        return ops;\n    }\n}\n", "import { HachureFiller } from './hachure-filler';\nimport { ZigZagFiller } from './zigzag-filler';\nimport { HatchFiller } from './hatch-filler';\nimport { DotFiller } from './dot-filler';\nimport { DashedFiller } from './dashed-filler';\nimport { ZigZagLineFiller } from './zigzag-line-filler';\nconst fillers = {};\nexport function getFiller(o, helper) {\n    let fillerName = o.fillStyle || 'hachure';\n    if (!fillers[fillerName]) {\n        switch (fillerName) {\n            case 'zigzag':\n                if (!fillers[fillerName]) {\n                    fillers[fillerName] = new ZigZagFiller(helper);\n                }\n                break;\n            case 'cross-hatch':\n                if (!fillers[fillerName]) {\n                    fillers[fillerName] = new HatchFiller(helper);\n                }\n                break;\n            case 'dots':\n                if (!fillers[fillerName]) {\n                    fillers[fillerName] = new DotFiller(helper);\n                }\n                break;\n            case 'dashed':\n                if (!fillers[fillerName]) {\n                    fillers[fillerName] = new DashedFiller(helper);\n                }\n                break;\n            case 'zigzag-line':\n                if (!fillers[fillerName]) {\n                    fillers[fillerName] = new ZigZagLineFiller(helper);\n                }\n                break;\n            case 'hachure':\n            default:\n                fillerName = 'hachure';\n                if (!fillers[fillerName]) {\n                    fillers[fillerName] = new HachureFiller(helper);\n                }\n                break;\n        }\n    }\n    return fillers[fillerName];\n}\n", "export function randomSeed() {\n    return Math.floor(Math.random() * 2 ** 31);\n}\nexport class Random {\n    constructor(seed) {\n        this.seed = seed;\n    }\n    next() {\n        if (this.seed) {\n            return ((2 ** 31 - 1) & (this.seed = Math.imul(48271, this.seed))) / 2 ** 31;\n        }\n        else {\n            return Math.random();\n        }\n    }\n}\n", "const COMMAND = 0;\nconst NUMBER = 1;\nconst EOD = 2;\nconst PARAMS = { A: 7, a: 7, C: 6, c: 6, H: 1, h: 1, L: 2, l: 2, M: 2, m: 2, Q: 4, q: 4, S: 4, s: 4, T: 2, t: 2, V: 1, v: 1, Z: 0, z: 0 };\nfunction tokenize(d) {\n    const tokens = new Array();\n    while (d !== '') {\n        if (d.match(/^([ \\t\\r\\n,]+)/)) {\n            d = d.substr(RegExp.$1.length);\n        }\n        else if (d.match(/^([aAcChHlLmMqQsStTvVzZ])/)) {\n            tokens[tokens.length] = { type: COMMAND, text: RegExp.$1 };\n            d = d.substr(RegExp.$1.length);\n        }\n        else if (d.match(/^(([-+]?[0-9]+(\\.[0-9]*)?|[-+]?\\.[0-9]+)([eE][-+]?[0-9]+)?)/)) {\n            tokens[tokens.length] = { type: NUMBER, text: `${parseFloat(RegExp.$1)}` };\n            d = d.substr(RegExp.$1.length);\n        }\n        else {\n            return [];\n        }\n    }\n    tokens[tokens.length] = { type: EOD, text: '' };\n    return tokens;\n}\nfunction isType(token, type) {\n    return token.type === type;\n}\nexport function parsePath(d) {\n    const segments = [];\n    const tokens = tokenize(d);\n    let mode = 'BOD';\n    let index = 0;\n    let token = tokens[index];\n    while (!isType(token, EOD)) {\n        let paramsCount = 0;\n        const params = [];\n        if (mode === 'BOD') {\n            if (token.text === 'M' || token.text === 'm') {\n                index++;\n                paramsCount = PARAMS[token.text];\n                mode = token.text;\n            }\n            else {\n                return parsePath('M0,0' + d);\n            }\n        }\n        else if (isType(token, NUMBER)) {\n            paramsCount = PARAMS[mode];\n        }\n        else {\n            index++;\n            paramsCount = PARAMS[token.text];\n            mode = token.text;\n        }\n        if ((index + paramsCount) < tokens.length) {\n            for (let i = index; i < index + paramsCount; i++) {\n                const numbeToken = tokens[i];\n                if (isType(numbeToken, NUMBER)) {\n                    params[params.length] = +numbeToken.text;\n                }\n                else {\n                    throw new Error('Param not a number: ' + mode + ',' + numbeToken.text);\n                }\n            }\n            if (typeof PARAMS[mode] === 'number') {\n                const segment = { key: mode, data: params };\n                segments.push(segment);\n                index += paramsCount;\n                token = tokens[index];\n                if (mode === 'M')\n                    mode = 'L';\n                if (mode === 'm')\n                    mode = 'l';\n            }\n            else {\n                throw new Error('Bad segment: ' + mode);\n            }\n        }\n        else {\n            throw new Error('Path data ended short');\n        }\n    }\n    return segments;\n}\nexport function serialize(segments) {\n    const tokens = [];\n    for (const { key, data } of segments) {\n        tokens.push(key);\n        switch (key) {\n            case 'C':\n            case 'c':\n                tokens.push(data[0], `${data[1]},`, data[2], `${data[3]},`, data[4], data[5]);\n                break;\n            case 'S':\n            case 's':\n            case 'Q':\n            case 'q':\n                tokens.push(data[0], `${data[1]},`, data[2], data[3]);\n                break;\n            default:\n                tokens.push(...data);\n                break;\n        }\n    }\n    return tokens.join(' ');\n}\n", "// Translate relative commands to absolute commands\nexport function absolutize(segments) {\n    let cx = 0, cy = 0;\n    let subx = 0, suby = 0;\n    const out = [];\n    for (const { key, data } of segments) {\n        switch (key) {\n            case 'M':\n                out.push({ key: 'M', data: [...data] });\n                [cx, cy] = data;\n                [subx, suby] = data;\n                break;\n            case 'm':\n                cx += data[0];\n                cy += data[1];\n                out.push({ key: 'M', data: [cx, cy] });\n                subx = cx;\n                suby = cy;\n                break;\n            case 'L':\n                out.push({ key: 'L', data: [...data] });\n                [cx, cy] = data;\n                break;\n            case 'l':\n                cx += data[0];\n                cy += data[1];\n                out.push({ key: 'L', data: [cx, cy] });\n                break;\n            case 'C':\n                out.push({ key: 'C', data: [...data] });\n                cx = data[4];\n                cy = data[5];\n                break;\n            case 'c': {\n                const newdata = data.map((d, i) => (i % 2) ? (d + cy) : (d + cx));\n                out.push({ key: 'C', data: newdata });\n                cx = newdata[4];\n                cy = newdata[5];\n                break;\n            }\n            case 'Q':\n                out.push({ key: 'Q', data: [...data] });\n                cx = data[2];\n                cy = data[3];\n                break;\n            case 'q': {\n                const newdata = data.map((d, i) => (i % 2) ? (d + cy) : (d + cx));\n                out.push({ key: 'Q', data: newdata });\n                cx = newdata[2];\n                cy = newdata[3];\n                break;\n            }\n            case 'A':\n                out.push({ key: 'A', data: [...data] });\n                cx = data[5];\n                cy = data[6];\n                break;\n            case 'a':\n                cx += data[5];\n                cy += data[6];\n                out.push({ key: 'A', data: [data[0], data[1], data[2], data[3], data[4], cx, cy] });\n                break;\n            case 'H':\n                out.push({ key: 'H', data: [...data] });\n                cx = data[0];\n                break;\n            case 'h':\n                cx += data[0];\n                out.push({ key: 'H', data: [cx] });\n                break;\n            case 'V':\n                out.push({ key: 'V', data: [...data] });\n                cy = data[0];\n                break;\n            case 'v':\n                cy += data[0];\n                out.push({ key: 'V', data: [cy] });\n                break;\n            case 'S':\n                out.push({ key: 'S', data: [...data] });\n                cx = data[2];\n                cy = data[3];\n                break;\n            case 's': {\n                const newdata = data.map((d, i) => (i % 2) ? (d + cy) : (d + cx));\n                out.push({ key: 'S', data: newdata });\n                cx = newdata[2];\n                cy = newdata[3];\n                break;\n            }\n            case 'T':\n                out.push({ key: 'T', data: [...data] });\n                cx = data[0];\n                cy = data[1];\n                break;\n            case 't':\n                cx += data[0];\n                cy += data[1];\n                out.push({ key: 'T', data: [cx, cy] });\n                break;\n            case 'Z':\n            case 'z':\n                out.push({ key: 'Z', data: [] });\n                cx = subx;\n                cy = suby;\n                break;\n        }\n    }\n    return out;\n}\n", "// Normalize path to include only M, L, C, and Z commands\nexport function normalize(segments) {\n    const out = [];\n    let lastType = '';\n    let cx = 0, cy = 0;\n    let subx = 0, suby = 0;\n    let lcx = 0, lcy = 0;\n    for (const { key, data } of segments) {\n        switch (key) {\n            case 'M':\n                out.push({ key: 'M', data: [...data] });\n                [cx, cy] = data;\n                [subx, suby] = data;\n                break;\n            case 'C':\n                out.push({ key: 'C', data: [...data] });\n                cx = data[4];\n                cy = data[5];\n                lcx = data[2];\n                lcy = data[3];\n                break;\n            case 'L':\n                out.push({ key: 'L', data: [...data] });\n                [cx, cy] = data;\n                break;\n            case 'H':\n                cx = data[0];\n                out.push({ key: 'L', data: [cx, cy] });\n                break;\n            case 'V':\n                cy = data[0];\n                out.push({ key: 'L', data: [cx, cy] });\n                break;\n            case 'S': {\n                let cx1 = 0, cy1 = 0;\n                if (lastType === 'C' || lastType === 'S') {\n                    cx1 = cx + (cx - lcx);\n                    cy1 = cy + (cy - lcy);\n                }\n                else {\n                    cx1 = cx;\n                    cy1 = cy;\n                }\n                out.push({ key: 'C', data: [cx1, cy1, ...data] });\n                lcx = data[0];\n                lcy = data[1];\n                cx = data[2];\n                cy = data[3];\n                break;\n            }\n            case 'T': {\n                const [x, y] = data;\n                let x1 = 0, y1 = 0;\n                if (lastType === 'Q' || lastType === 'T') {\n                    x1 = cx + (cx - lcx);\n                    y1 = cy + (cy - lcy);\n                }\n                else {\n                    x1 = cx;\n                    y1 = cy;\n                }\n                const cx1 = cx + 2 * (x1 - cx) / 3;\n                const cy1 = cy + 2 * (y1 - cy) / 3;\n                const cx2 = x + 2 * (x1 - x) / 3;\n                const cy2 = y + 2 * (y1 - y) / 3;\n                out.push({ key: 'C', data: [cx1, cy1, cx2, cy2, x, y] });\n                lcx = x1;\n                lcy = y1;\n                cx = x;\n                cy = y;\n                break;\n            }\n            case 'Q': {\n                const [x1, y1, x, y] = data;\n                const cx1 = cx + 2 * (x1 - cx) / 3;\n                const cy1 = cy + 2 * (y1 - cy) / 3;\n                const cx2 = x + 2 * (x1 - x) / 3;\n                const cy2 = y + 2 * (y1 - y) / 3;\n                out.push({ key: 'C', data: [cx1, cy1, cx2, cy2, x, y] });\n                lcx = x1;\n                lcy = y1;\n                cx = x;\n                cy = y;\n                break;\n            }\n            case 'A': {\n                const r1 = Math.abs(data[0]);\n                const r2 = Math.abs(data[1]);\n                const angle = data[2];\n                const largeArcFlag = data[3];\n                const sweepFlag = data[4];\n                const x = data[5];\n                const y = data[6];\n                if (r1 === 0 || r2 === 0) {\n                    out.push({ key: 'C', data: [cx, cy, x, y, x, y] });\n                    cx = x;\n                    cy = y;\n                }\n                else {\n                    if (cx !== x || cy !== y) {\n                        const curves = arcToCubicCurves(cx, cy, x, y, r1, r2, angle, largeArcFlag, sweepFlag);\n                        curves.forEach(function (curve) {\n                            out.push({ key: 'C', data: curve });\n                        });\n                        cx = x;\n                        cy = y;\n                    }\n                }\n                break;\n            }\n            case 'Z':\n                out.push({ key: 'Z', data: [] });\n                cx = subx;\n                cy = suby;\n                break;\n        }\n        lastType = key;\n    }\n    return out;\n}\nfunction degToRad(degrees) {\n    return (Math.PI * degrees) / 180;\n}\nfunction rotate(x, y, angleRad) {\n    const X = x * Math.cos(angleRad) - y * Math.sin(angleRad);\n    const Y = x * Math.sin(angleRad) + y * Math.cos(angleRad);\n    return [X, Y];\n}\nfunction arcToCubicCurves(x1, y1, x2, y2, r1, r2, angle, largeArcFlag, sweepFlag, recursive) {\n    const angleRad = degToRad(angle);\n    let params = [];\n    let f1 = 0, f2 = 0, cx = 0, cy = 0;\n    if (recursive) {\n        [f1, f2, cx, cy] = recursive;\n    }\n    else {\n        [x1, y1] = rotate(x1, y1, -angleRad);\n        [x2, y2] = rotate(x2, y2, -angleRad);\n        const x = (x1 - x2) / 2;\n        const y = (y1 - y2) / 2;\n        let h = (x * x) / (r1 * r1) + (y * y) / (r2 * r2);\n        if (h > 1) {\n            h = Math.sqrt(h);\n            r1 = h * r1;\n            r2 = h * r2;\n        }\n        const sign = (largeArcFlag === sweepFlag) ? -1 : 1;\n        const r1Pow = r1 * r1;\n        const r2Pow = r2 * r2;\n        const left = r1Pow * r2Pow - r1Pow * y * y - r2Pow * x * x;\n        const right = r1Pow * y * y + r2Pow * x * x;\n        const k = sign * Math.sqrt(Math.abs(left / right));\n        cx = k * r1 * y / r2 + (x1 + x2) / 2;\n        cy = k * -r2 * x / r1 + (y1 + y2) / 2;\n        f1 = Math.asin(parseFloat(((y1 - cy) / r2).toFixed(9)));\n        f2 = Math.asin(parseFloat(((y2 - cy) / r2).toFixed(9)));\n        if (x1 < cx) {\n            f1 = Math.PI - f1;\n        }\n        if (x2 < cx) {\n            f2 = Math.PI - f2;\n        }\n        if (f1 < 0) {\n            f1 = Math.PI * 2 + f1;\n        }\n        if (f2 < 0) {\n            f2 = Math.PI * 2 + f2;\n        }\n        if (sweepFlag && f1 > f2) {\n            f1 = f1 - Math.PI * 2;\n        }\n        if (!sweepFlag && f2 > f1) {\n            f2 = f2 - Math.PI * 2;\n        }\n    }\n    let df = f2 - f1;\n    if (Math.abs(df) > (Math.PI * 120 / 180)) {\n        const f2old = f2;\n        const x2old = x2;\n        const y2old = y2;\n        if (sweepFlag && f2 > f1) {\n            f2 = f1 + (Math.PI * 120 / 180) * (1);\n        }\n        else {\n            f2 = f1 + (Math.PI * 120 / 180) * (-1);\n        }\n        x2 = cx + r1 * Math.cos(f2);\n        y2 = cy + r2 * Math.sin(f2);\n        params = arcToCubicCurves(x2, y2, x2old, y2old, r1, r2, angle, 0, sweepFlag, [f2, f2old, cx, cy]);\n    }\n    df = f2 - f1;\n    const c1 = Math.cos(f1);\n    const s1 = Math.sin(f1);\n    const c2 = Math.cos(f2);\n    const s2 = Math.sin(f2);\n    const t = Math.tan(df / 4);\n    const hx = 4 / 3 * r1 * t;\n    const hy = 4 / 3 * r2 * t;\n    const m1 = [x1, y1];\n    const m2 = [x1 + hx * s1, y1 - hy * c1];\n    const m3 = [x2 + hx * s2, y2 - hy * c2];\n    const m4 = [x2, y2];\n    m2[0] = 2 * m1[0] - m2[0];\n    m2[1] = 2 * m1[1] - m2[1];\n    if (recursive) {\n        return [m2, m3, m4].concat(params);\n    }\n    else {\n        params = [m2, m3, m4].concat(params);\n        const curves = [];\n        for (let i = 0; i < params.length; i += 3) {\n            const r1 = rotate(params[i][0], params[i][1], angleRad);\n            const r2 = rotate(params[i + 1][0], params[i + 1][1], angleRad);\n            const r3 = rotate(params[i + 2][0], params[i + 2][1], angleRad);\n            curves.push([r1[0], r1[1], r2[0], r2[1], r3[0], r3[1]]);\n        }\n        return curves;\n    }\n}\n", "import { getFiller } from './fillers/filler.js';\nimport { Random } from './math.js';\nimport { parsePath, normalize, absolutize } from 'path-data-parser';\nconst helper = {\n    randOffset,\n    randOffsetWithRange,\n    ellipse,\n    doubleLineOps: doubleLineFillOps,\n};\nexport function line(x1, y1, x2, y2, o) {\n    return { type: 'path', ops: _doubleLine(x1, y1, x2, y2, o) };\n}\nexport function linearPath(points, close, o) {\n    const len = (points || []).length;\n    if (len > 2) {\n        const ops = [];\n        for (let i = 0; i < (len - 1); i++) {\n            ops.push(..._doubleLine(points[i][0], points[i][1], points[i + 1][0], points[i + 1][1], o));\n        }\n        if (close) {\n            ops.push(..._doubleLine(points[len - 1][0], points[len - 1][1], points[0][0], points[0][1], o));\n        }\n        return { type: 'path', ops };\n    }\n    else if (len === 2) {\n        return line(points[0][0], points[0][1], points[1][0], points[1][1], o);\n    }\n    return { type: 'path', ops: [] };\n}\nexport function polygon(points, o) {\n    return linearPath(points, true, o);\n}\nexport function rectangle(x, y, width, height, o) {\n    const points = [\n        [x, y],\n        [x + width, y],\n        [x + width, y + height],\n        [x, y + height],\n    ];\n    return polygon(points, o);\n}\nexport function curve(points, o) {\n    let o1 = _curveWithOffset(points, 1 * (1 + o.roughness * 0.2), o);\n    if (!o.disableMultiStroke) {\n        const o2 = _curveWithOffset(points, 1.5 * (1 + o.roughness * 0.22), cloneOptionsAlterSeed(o));\n        o1 = o1.concat(o2);\n    }\n    return { type: 'path', ops: o1 };\n}\nexport function ellipse(x, y, width, height, o) {\n    const params = generateEllipseParams(width, height, o);\n    return ellipseWithParams(x, y, o, params).opset;\n}\nexport function generateEllipseParams(width, height, o) {\n    const psq = Math.sqrt(Math.PI * 2 * Math.sqrt((Math.pow(width / 2, 2) + Math.pow(height / 2, 2)) / 2));\n    const stepCount = Math.ceil(Math.max(o.curveStepCount, (o.curveStepCount / Math.sqrt(200)) * psq));\n    const increment = (Math.PI * 2) / stepCount;\n    let rx = Math.abs(width / 2);\n    let ry = Math.abs(height / 2);\n    const curveFitRandomness = 1 - o.curveFitting;\n    rx += _offsetOpt(rx * curveFitRandomness, o);\n    ry += _offsetOpt(ry * curveFitRandomness, o);\n    return { increment, rx, ry };\n}\nexport function ellipseWithParams(x, y, o, ellipseParams) {\n    const [ap1, cp1] = _computeEllipsePoints(ellipseParams.increment, x, y, ellipseParams.rx, ellipseParams.ry, 1, ellipseParams.increment * _offset(0.1, _offset(0.4, 1, o), o), o);\n    let o1 = _curve(ap1, null, o);\n    if ((!o.disableMultiStroke) && (o.roughness !== 0)) {\n        const [ap2] = _computeEllipsePoints(ellipseParams.increment, x, y, ellipseParams.rx, ellipseParams.ry, 1.5, 0, o);\n        const o2 = _curve(ap2, null, o);\n        o1 = o1.concat(o2);\n    }\n    return {\n        estimatedPoints: cp1,\n        opset: { type: 'path', ops: o1 },\n    };\n}\nexport function arc(x, y, width, height, start, stop, closed, roughClosure, o) {\n    const cx = x;\n    const cy = y;\n    let rx = Math.abs(width / 2);\n    let ry = Math.abs(height / 2);\n    rx += _offsetOpt(rx * 0.01, o);\n    ry += _offsetOpt(ry * 0.01, o);\n    let strt = start;\n    let stp = stop;\n    while (strt < 0) {\n        strt += Math.PI * 2;\n        stp += Math.PI * 2;\n    }\n    if ((stp - strt) > (Math.PI * 2)) {\n        strt = 0;\n        stp = Math.PI * 2;\n    }\n    const ellipseInc = (Math.PI * 2) / o.curveStepCount;\n    const arcInc = Math.min(ellipseInc / 2, (stp - strt) / 2);\n    const ops = _arc(arcInc, cx, cy, rx, ry, strt, stp, 1, o);\n    if (!o.disableMultiStroke) {\n        const o2 = _arc(arcInc, cx, cy, rx, ry, strt, stp, 1.5, o);\n        ops.push(...o2);\n    }\n    if (closed) {\n        if (roughClosure) {\n            ops.push(..._doubleLine(cx, cy, cx + rx * Math.cos(strt), cy + ry * Math.sin(strt), o), ..._doubleLine(cx, cy, cx + rx * Math.cos(stp), cy + ry * Math.sin(stp), o));\n        }\n        else {\n            ops.push({ op: 'lineTo', data: [cx, cy] }, { op: 'lineTo', data: [cx + rx * Math.cos(strt), cy + ry * Math.sin(strt)] });\n        }\n    }\n    return { type: 'path', ops };\n}\nexport function svgPath(path, o) {\n    const segments = normalize(absolutize(parsePath(path)));\n    const ops = [];\n    let first = [0, 0];\n    let current = [0, 0];\n    for (const { key, data } of segments) {\n        switch (key) {\n            case 'M': {\n                const ro = 1 * (o.maxRandomnessOffset || 0);\n                const pv = o.preserveVertices;\n                ops.push({ op: 'move', data: data.map((d) => d + (pv ? 0 : _offsetOpt(ro, o))) });\n                current = [data[0], data[1]];\n                first = [data[0], data[1]];\n                break;\n            }\n            case 'L':\n                ops.push(..._doubleLine(current[0], current[1], data[0], data[1], o));\n                current = [data[0], data[1]];\n                break;\n            case 'C': {\n                const [x1, y1, x2, y2, x, y] = data;\n                ops.push(..._bezierTo(x1, y1, x2, y2, x, y, current, o));\n                current = [x, y];\n                break;\n            }\n            case 'Z':\n                ops.push(..._doubleLine(current[0], current[1], first[0], first[1], o));\n                current = [first[0], first[1]];\n                break;\n        }\n    }\n    return { type: 'path', ops };\n}\n// Fills\nexport function solidFillPolygon(polygonList, o) {\n    const ops = [];\n    for (const points of polygonList) {\n        if (points.length) {\n            const offset = o.maxRandomnessOffset || 0;\n            const len = points.length;\n            if (len > 2) {\n                ops.push({ op: 'move', data: [points[0][0] + _offsetOpt(offset, o), points[0][1] + _offsetOpt(offset, o)] });\n                for (let i = 1; i < len; i++) {\n                    ops.push({ op: 'lineTo', data: [points[i][0] + _offsetOpt(offset, o), points[i][1] + _offsetOpt(offset, o)] });\n                }\n            }\n        }\n    }\n    return { type: 'fillPath', ops };\n}\nexport function patternFillPolygons(polygonList, o) {\n    return getFiller(o, helper).fillPolygons(polygonList, o);\n}\nexport function patternFillArc(x, y, width, height, start, stop, o) {\n    const cx = x;\n    const cy = y;\n    let rx = Math.abs(width / 2);\n    let ry = Math.abs(height / 2);\n    rx += _offsetOpt(rx * 0.01, o);\n    ry += _offsetOpt(ry * 0.01, o);\n    let strt = start;\n    let stp = stop;\n    while (strt < 0) {\n        strt += Math.PI * 2;\n        stp += Math.PI * 2;\n    }\n    if ((stp - strt) > (Math.PI * 2)) {\n        strt = 0;\n        stp = Math.PI * 2;\n    }\n    const increment = (stp - strt) / o.curveStepCount;\n    const points = [];\n    for (let angle = strt; angle <= stp; angle = angle + increment) {\n        points.push([cx + rx * Math.cos(angle), cy + ry * Math.sin(angle)]);\n    }\n    points.push([cx + rx * Math.cos(stp), cy + ry * Math.sin(stp)]);\n    points.push([cx, cy]);\n    return patternFillPolygons([points], o);\n}\nexport function randOffset(x, o) {\n    return _offsetOpt(x, o);\n}\nexport function randOffsetWithRange(min, max, o) {\n    return _offset(min, max, o);\n}\nexport function doubleLineFillOps(x1, y1, x2, y2, o) {\n    return _doubleLine(x1, y1, x2, y2, o, true);\n}\n// Private helpers\nfunction cloneOptionsAlterSeed(ops) {\n    const result = Object.assign({}, ops);\n    result.randomizer = undefined;\n    if (ops.seed) {\n        result.seed = ops.seed + 1;\n    }\n    return result;\n}\nfunction random(ops) {\n    if (!ops.randomizer) {\n        ops.randomizer = new Random(ops.seed || 0);\n    }\n    return ops.randomizer.next();\n}\nfunction _offset(min, max, ops, roughnessGain = 1) {\n    return ops.roughness * roughnessGain * ((random(ops) * (max - min)) + min);\n}\nfunction _offsetOpt(x, ops, roughnessGain = 1) {\n    return _offset(-x, x, ops, roughnessGain);\n}\nfunction _doubleLine(x1, y1, x2, y2, o, filling = false) {\n    const singleStroke = filling ? o.disableMultiStrokeFill : o.disableMultiStroke;\n    const o1 = _line(x1, y1, x2, y2, o, true, false);\n    if (singleStroke) {\n        return o1;\n    }\n    const o2 = _line(x1, y1, x2, y2, o, true, true);\n    return o1.concat(o2);\n}\nfunction _line(x1, y1, x2, y2, o, move, overlay) {\n    const lengthSq = Math.pow((x1 - x2), 2) + Math.pow((y1 - y2), 2);\n    const length = Math.sqrt(lengthSq);\n    let roughnessGain = 1;\n    if (length < 200) {\n        roughnessGain = 1;\n    }\n    else if (length > 500) {\n        roughnessGain = 0.4;\n    }\n    else {\n        roughnessGain = (-0.0016668) * length + 1.233334;\n    }\n    let offset = o.maxRandomnessOffset || 0;\n    if ((offset * offset * 100) > lengthSq) {\n        offset = length / 10;\n    }\n    const halfOffset = offset / 2;\n    const divergePoint = 0.2 + random(o) * 0.2;\n    let midDispX = o.bowing * o.maxRandomnessOffset * (y2 - y1) / 200;\n    let midDispY = o.bowing * o.maxRandomnessOffset * (x1 - x2) / 200;\n    midDispX = _offsetOpt(midDispX, o, roughnessGain);\n    midDispY = _offsetOpt(midDispY, o, roughnessGain);\n    const ops = [];\n    const randomHalf = () => _offsetOpt(halfOffset, o, roughnessGain);\n    const randomFull = () => _offsetOpt(offset, o, roughnessGain);\n    const preserveVertices = o.preserveVertices;\n    if (move) {\n        if (overlay) {\n            ops.push({\n                op: 'move', data: [\n                    x1 + (preserveVertices ? 0 : randomHalf()),\n                    y1 + (preserveVertices ? 0 : randomHalf()),\n                ],\n            });\n        }\n        else {\n            ops.push({\n                op: 'move', data: [\n                    x1 + (preserveVertices ? 0 : _offsetOpt(offset, o, roughnessGain)),\n                    y1 + (preserveVertices ? 0 : _offsetOpt(offset, o, roughnessGain)),\n                ],\n            });\n        }\n    }\n    if (overlay) {\n        ops.push({\n            op: 'bcurveTo',\n            data: [\n                midDispX + x1 + (x2 - x1) * divergePoint + randomHalf(),\n                midDispY + y1 + (y2 - y1) * divergePoint + randomHalf(),\n                midDispX + x1 + 2 * (x2 - x1) * divergePoint + randomHalf(),\n                midDispY + y1 + 2 * (y2 - y1) * divergePoint + randomHalf(),\n                x2 + (preserveVertices ? 0 : randomHalf()),\n                y2 + (preserveVertices ? 0 : randomHalf()),\n            ],\n        });\n    }\n    else {\n        ops.push({\n            op: 'bcurveTo',\n            data: [\n                midDispX + x1 + (x2 - x1) * divergePoint + randomFull(),\n                midDispY + y1 + (y2 - y1) * divergePoint + randomFull(),\n                midDispX + x1 + 2 * (x2 - x1) * divergePoint + randomFull(),\n                midDispY + y1 + 2 * (y2 - y1) * divergePoint + randomFull(),\n                x2 + (preserveVertices ? 0 : randomFull()),\n                y2 + (preserveVertices ? 0 : randomFull()),\n            ],\n        });\n    }\n    return ops;\n}\nfunction _curveWithOffset(points, offset, o) {\n    const ps = [];\n    ps.push([\n        points[0][0] + _offsetOpt(offset, o),\n        points[0][1] + _offsetOpt(offset, o),\n    ]);\n    ps.push([\n        points[0][0] + _offsetOpt(offset, o),\n        points[0][1] + _offsetOpt(offset, o),\n    ]);\n    for (let i = 1; i < points.length; i++) {\n        ps.push([\n            points[i][0] + _offsetOpt(offset, o),\n            points[i][1] + _offsetOpt(offset, o),\n        ]);\n        if (i === (points.length - 1)) {\n            ps.push([\n                points[i][0] + _offsetOpt(offset, o),\n                points[i][1] + _offsetOpt(offset, o),\n            ]);\n        }\n    }\n    return _curve(ps, null, o);\n}\nfunction _curve(points, closePoint, o) {\n    const len = points.length;\n    const ops = [];\n    if (len > 3) {\n        const b = [];\n        const s = 1 - o.curveTightness;\n        ops.push({ op: 'move', data: [points[1][0], points[1][1]] });\n        for (let i = 1; (i + 2) < len; i++) {\n            const cachedVertArray = points[i];\n            b[0] = [cachedVertArray[0], cachedVertArray[1]];\n            b[1] = [cachedVertArray[0] + (s * points[i + 1][0] - s * points[i - 1][0]) / 6, cachedVertArray[1] + (s * points[i + 1][1] - s * points[i - 1][1]) / 6];\n            b[2] = [points[i + 1][0] + (s * points[i][0] - s * points[i + 2][0]) / 6, points[i + 1][1] + (s * points[i][1] - s * points[i + 2][1]) / 6];\n            b[3] = [points[i + 1][0], points[i + 1][1]];\n            ops.push({ op: 'bcurveTo', data: [b[1][0], b[1][1], b[2][0], b[2][1], b[3][0], b[3][1]] });\n        }\n        if (closePoint && closePoint.length === 2) {\n            const ro = o.maxRandomnessOffset;\n            ops.push({ op: 'lineTo', data: [closePoint[0] + _offsetOpt(ro, o), closePoint[1] + _offsetOpt(ro, o)] });\n        }\n    }\n    else if (len === 3) {\n        ops.push({ op: 'move', data: [points[1][0], points[1][1]] });\n        ops.push({\n            op: 'bcurveTo',\n            data: [\n                points[1][0], points[1][1],\n                points[2][0], points[2][1],\n                points[2][0], points[2][1],\n            ],\n        });\n    }\n    else if (len === 2) {\n        ops.push(..._doubleLine(points[0][0], points[0][1], points[1][0], points[1][1], o));\n    }\n    return ops;\n}\nfunction _computeEllipsePoints(increment, cx, cy, rx, ry, offset, overlap, o) {\n    const coreOnly = o.roughness === 0;\n    const corePoints = [];\n    const allPoints = [];\n    if (coreOnly) {\n        increment = increment / 4;\n        allPoints.push([\n            cx + rx * Math.cos(-increment),\n            cy + ry * Math.sin(-increment),\n        ]);\n        for (let angle = 0; angle <= Math.PI * 2; angle = angle + increment) {\n            const p = [\n                cx + rx * Math.cos(angle),\n                cy + ry * Math.sin(angle),\n            ];\n            corePoints.push(p);\n            allPoints.push(p);\n        }\n        allPoints.push([\n            cx + rx * Math.cos(0),\n            cy + ry * Math.sin(0),\n        ]);\n        allPoints.push([\n            cx + rx * Math.cos(increment),\n            cy + ry * Math.sin(increment),\n        ]);\n    }\n    else {\n        const radOffset = _offsetOpt(0.5, o) - (Math.PI / 2);\n        allPoints.push([\n            _offsetOpt(offset, o) + cx + 0.9 * rx * Math.cos(radOffset - increment),\n            _offsetOpt(offset, o) + cy + 0.9 * ry * Math.sin(radOffset - increment),\n        ]);\n        const endAngle = Math.PI * 2 + radOffset - 0.01;\n        for (let angle = radOffset; angle < endAngle; angle = angle + increment) {\n            const p = [\n                _offsetOpt(offset, o) + cx + rx * Math.cos(angle),\n                _offsetOpt(offset, o) + cy + ry * Math.sin(angle),\n            ];\n            corePoints.push(p);\n            allPoints.push(p);\n        }\n        allPoints.push([\n            _offsetOpt(offset, o) + cx + rx * Math.cos(radOffset + Math.PI * 2 + overlap * 0.5),\n            _offsetOpt(offset, o) + cy + ry * Math.sin(radOffset + Math.PI * 2 + overlap * 0.5),\n        ]);\n        allPoints.push([\n            _offsetOpt(offset, o) + cx + 0.98 * rx * Math.cos(radOffset + overlap),\n            _offsetOpt(offset, o) + cy + 0.98 * ry * Math.sin(radOffset + overlap),\n        ]);\n        allPoints.push([\n            _offsetOpt(offset, o) + cx + 0.9 * rx * Math.cos(radOffset + overlap * 0.5),\n            _offsetOpt(offset, o) + cy + 0.9 * ry * Math.sin(radOffset + overlap * 0.5),\n        ]);\n    }\n    return [allPoints, corePoints];\n}\nfunction _arc(increment, cx, cy, rx, ry, strt, stp, offset, o) {\n    const radOffset = strt + _offsetOpt(0.1, o);\n    const points = [];\n    points.push([\n        _offsetOpt(offset, o) + cx + 0.9 * rx * Math.cos(radOffset - increment),\n        _offsetOpt(offset, o) + cy + 0.9 * ry * Math.sin(radOffset - increment),\n    ]);\n    for (let angle = radOffset; angle <= stp; angle = angle + increment) {\n        points.push([\n            _offsetOpt(offset, o) + cx + rx * Math.cos(angle),\n            _offsetOpt(offset, o) + cy + ry * Math.sin(angle),\n        ]);\n    }\n    points.push([\n        cx + rx * Math.cos(stp),\n        cy + ry * Math.sin(stp),\n    ]);\n    points.push([\n        cx + rx * Math.cos(stp),\n        cy + ry * Math.sin(stp),\n    ]);\n    return _curve(points, null, o);\n}\nfunction _bezierTo(x1, y1, x2, y2, x, y, current, o) {\n    const ops = [];\n    const ros = [o.maxRandomnessOffset || 1, (o.maxRandomnessOffset || 1) + 0.3];\n    let f = [0, 0];\n    const iterations = o.disableMultiStroke ? 1 : 2;\n    const preserveVertices = o.preserveVertices;\n    for (let i = 0; i < iterations; i++) {\n        if (i === 0) {\n            ops.push({ op: 'move', data: [current[0], current[1]] });\n        }\n        else {\n            ops.push({ op: 'move', data: [current[0] + (preserveVertices ? 0 : _offsetOpt(ros[0], o)), current[1] + (preserveVertices ? 0 : _offsetOpt(ros[0], o))] });\n        }\n        f = preserveVertices ? [x, y] : [x + _offsetOpt(ros[i], o), y + _offsetOpt(ros[i], o)];\n        ops.push({\n            op: 'bcurveTo',\n            data: [\n                x1 + _offsetOpt(ros[i], o), y1 + _offsetOpt(ros[i], o),\n                x2 + _offsetOpt(ros[i], o), y2 + _offsetOpt(ros[i], o),\n                f[0], f[1],\n            ],\n        });\n    }\n    return ops;\n}\n", "function clone(p) {\n    return [...p];\n}\nexport function curveToBezier(pointsIn, curveTightness = 0) {\n    const len = pointsIn.length;\n    if (len < 3) {\n        throw new Error('A curve must have at least three points.');\n    }\n    const out = [];\n    if (len === 3) {\n        out.push(clone(pointsIn[0]), clone(pointsIn[1]), clone(pointsIn[2]), clone(pointsIn[2]));\n    }\n    else {\n        const points = [];\n        points.push(pointsIn[0], pointsIn[0]);\n        for (let i = 1; i < pointsIn.length; i++) {\n            points.push(pointsIn[i]);\n            if (i === (pointsIn.length - 1)) {\n                points.push(pointsIn[i]);\n            }\n        }\n        const b = [];\n        const s = 1 - curveTightness;\n        out.push(clone(points[0]));\n        for (let i = 1; (i + 2) < points.length; i++) {\n            const cachedVertArray = points[i];\n            b[0] = [cachedVertArray[0], cachedVertArray[1]];\n            b[1] = [cachedVertArray[0] + (s * points[i + 1][0] - s * points[i - 1][0]) / 6, cachedVertArray[1] + (s * points[i + 1][1] - s * points[i - 1][1]) / 6];\n            b[2] = [points[i + 1][0] + (s * points[i][0] - s * points[i + 2][0]) / 6, points[i + 1][1] + (s * points[i][1] - s * points[i + 2][1]) / 6];\n            b[3] = [points[i + 1][0], points[i + 1][1]];\n            out.push(b[1], b[2], b[3]);\n        }\n    }\n    return out;\n}\n", "// distance between 2 points\nfunction distance(p1, p2) {\n    return Math.sqrt(distanceSq(p1, p2));\n}\n// distance between 2 points squared\nfunction distanceSq(p1, p2) {\n    return Math.pow(p1[0] - p2[0], 2) + Math.pow(p1[1] - p2[1], 2);\n}\n// Sistance squared from a point p to the line segment vw\nfunction distanceToSegmentSq(p, v, w) {\n    const l2 = distanceSq(v, w);\n    if (l2 === 0) {\n        return distanceSq(p, v);\n    }\n    let t = ((p[0] - v[0]) * (w[0] - v[0]) + (p[1] - v[1]) * (w[1] - v[1])) / l2;\n    t = Math.max(0, Math.min(1, t));\n    return distanceSq(p, lerp(v, w, t));\n}\nfunction lerp(a, b, t) {\n    return [\n        a[0] + (b[0] - a[0]) * t,\n        a[1] + (b[1] - a[1]) * t,\n    ];\n}\n// Adapted from https://seant23.wordpress.com/2010/11/12/offset-bezier-curves/\nfunction flatness(points, offset) {\n    const p1 = points[offset + 0];\n    const p2 = points[offset + 1];\n    const p3 = points[offset + 2];\n    const p4 = points[offset + 3];\n    let ux = 3 * p2[0] - 2 * p1[0] - p4[0];\n    ux *= ux;\n    let uy = 3 * p2[1] - 2 * p1[1] - p4[1];\n    uy *= uy;\n    let vx = 3 * p3[0] - 2 * p4[0] - p1[0];\n    vx *= vx;\n    let vy = 3 * p3[1] - 2 * p4[1] - p1[1];\n    vy *= vy;\n    if (ux < vx) {\n        ux = vx;\n    }\n    if (uy < vy) {\n        uy = vy;\n    }\n    return ux + uy;\n}\nfunction getPointsOnBezierCurveWithSplitting(points, offset, tolerance, newPoints) {\n    const outPoints = newPoints || [];\n    if (flatness(points, offset) < tolerance) {\n        const p0 = points[offset + 0];\n        if (outPoints.length) {\n            const d = distance(outPoints[outPoints.length - 1], p0);\n            if (d > 1) {\n                outPoints.push(p0);\n            }\n        }\n        else {\n            outPoints.push(p0);\n        }\n        outPoints.push(points[offset + 3]);\n    }\n    else {\n        // subdivide\n        const t = .5;\n        const p1 = points[offset + 0];\n        const p2 = points[offset + 1];\n        const p3 = points[offset + 2];\n        const p4 = points[offset + 3];\n        const q1 = lerp(p1, p2, t);\n        const q2 = lerp(p2, p3, t);\n        const q3 = lerp(p3, p4, t);\n        const r1 = lerp(q1, q2, t);\n        const r2 = lerp(q2, q3, t);\n        const red = lerp(r1, r2, t);\n        getPointsOnBezierCurveWithSplitting([p1, q1, r1, red], 0, tolerance, outPoints);\n        getPointsOnBezierCurveWithSplitting([red, r2, q3, p4], 0, tolerance, outPoints);\n    }\n    return outPoints;\n}\nexport function simplify(points, distance) {\n    return simplifyPoints(points, 0, points.length, distance);\n}\n// RamerDouglasPeucker algorithm\n// https://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm\nfunction simplifyPoints(points, start, end, epsilon, newPoints) {\n    const outPoints = newPoints || [];\n    // find the most distance point from the endpoints\n    const s = points[start];\n    const e = points[end - 1];\n    let maxDistSq = 0;\n    let maxNdx = 1;\n    for (let i = start + 1; i < end - 1; ++i) {\n        const distSq = distanceToSegmentSq(points[i], s, e);\n        if (distSq > maxDistSq) {\n            maxDistSq = distSq;\n            maxNdx = i;\n        }\n    }\n    // if that point is too far, split\n    if (Math.sqrt(maxDistSq) > epsilon) {\n        simplifyPoints(points, start, maxNdx + 1, epsilon, outPoints);\n        simplifyPoints(points, maxNdx, end, epsilon, outPoints);\n    }\n    else {\n        if (!outPoints.length) {\n            outPoints.push(s);\n        }\n        outPoints.push(e);\n    }\n    return outPoints;\n}\nexport function pointsOnBezierCurves(points, tolerance = 0.15, distance) {\n    const newPoints = [];\n    const numSegments = (points.length - 1) / 3;\n    for (let i = 0; i < numSegments; i++) {\n        const offset = i * 3;\n        getPointsOnBezierCurveWithSplitting(points, offset, tolerance, newPoints);\n    }\n    if (distance && distance > 0) {\n        return simplifyPoints(newPoints, 0, newPoints.length, distance);\n    }\n    return newPoints;\n}\n", "import { pointsOnBezierCurves, simplify } from 'points-on-curve';\nimport { parsePath, absolutize, normalize } from 'path-data-parser';\nexport function pointsOnPath(path, tolerance, distance) {\n    const segments = parsePath(path);\n    const normalized = normalize(absolutize(segments));\n    const sets = [];\n    let currentPoints = [];\n    let start = [0, 0];\n    let pendingCurve = [];\n    const appendPendingCurve = () => {\n        if (pendingCurve.length >= 4) {\n            currentPoints.push(...pointsOnBezierCurves(pendingCurve, tolerance));\n        }\n        pendingCurve = [];\n    };\n    const appendPendingPoints = () => {\n        appendPendingCurve();\n        if (currentPoints.length) {\n            sets.push(currentPoints);\n            currentPoints = [];\n        }\n    };\n    for (const { key, data } of normalized) {\n        switch (key) {\n            case 'M':\n                appendPendingPoints();\n                start = [data[0], data[1]];\n                currentPoints.push(start);\n                break;\n            case 'L':\n                appendPendingCurve();\n                currentPoints.push([data[0], data[1]]);\n                break;\n            case 'C':\n                if (!pendingCurve.length) {\n                    const lastPoint = currentPoints.length ? currentPoints[currentPoints.length - 1] : start;\n                    pendingCurve.push([lastPoint[0], lastPoint[1]]);\n                }\n                pendingCurve.push([data[0], data[1]]);\n                pendingCurve.push([data[2], data[3]]);\n                pendingCurve.push([data[4], data[5]]);\n                break;\n            case 'Z':\n                appendPendingCurve();\n                currentPoints.push([start[0], start[1]]);\n                break;\n        }\n    }\n    appendPendingPoints();\n    if (!distance) {\n        return sets;\n    }\n    const out = [];\n    for (const set of sets) {\n        const simplifiedSet = simplify(set, distance);\n        if (simplifiedSet.length) {\n            out.push(simplifiedSet);\n        }\n    }\n    return out;\n}\n", "import { line, solidFillPolygon, patternFillPolygons, rectangle, ellipseWithParams, generateEllipseParams, linearPath, arc, patternFillArc, curve, svgPath } from './renderer.js';\nimport { randomSeed } from './math.js';\nimport { curveToBezier } from 'points-on-curve/lib/curve-to-bezier.js';\nimport { pointsOnBezierCurves } from 'points-on-curve';\nimport { pointsOnPath } from 'points-on-path';\nconst NOS = 'none';\nexport class RoughGenerator {\n    constructor(config) {\n        this.defaultOptions = {\n            maxRandomnessOffset: 2,\n            roughness: 1,\n            bowing: 1,\n            stroke: '#000',\n            strokeWidth: 1,\n            curveTightness: 0,\n            curveFitting: 0.95,\n            curveStepCount: 9,\n            fillStyle: 'hachure',\n            fillWeight: -1,\n            hachureAngle: -41,\n            hachureGap: -1,\n            dashOffset: -1,\n            dashGap: -1,\n            zigzagOffset: -1,\n            seed: 0,\n            disableMultiStroke: false,\n            disableMultiStrokeFill: false,\n            preserveVertices: false,\n        };\n        this.config = config || {};\n        if (this.config.options) {\n            this.defaultOptions = this._o(this.config.options);\n        }\n    }\n    static newSeed() {\n        return randomSeed();\n    }\n    _o(options) {\n        return options ? Object.assign({}, this.defaultOptions, options) : this.defaultOptions;\n    }\n    _d(shape, sets, options) {\n        return { shape, sets: sets || [], options: options || this.defaultOptions };\n    }\n    line(x1, y1, x2, y2, options) {\n        const o = this._o(options);\n        return this._d('line', [line(x1, y1, x2, y2, o)], o);\n    }\n    rectangle(x, y, width, height, options) {\n        const o = this._o(options);\n        const paths = [];\n        const outline = rectangle(x, y, width, height, o);\n        if (o.fill) {\n            const points = [[x, y], [x + width, y], [x + width, y + height], [x, y + height]];\n            if (o.fillStyle === 'solid') {\n                paths.push(solidFillPolygon([points], o));\n            }\n            else {\n                paths.push(patternFillPolygons([points], o));\n            }\n        }\n        if (o.stroke !== NOS) {\n            paths.push(outline);\n        }\n        return this._d('rectangle', paths, o);\n    }\n    ellipse(x, y, width, height, options) {\n        const o = this._o(options);\n        const paths = [];\n        const ellipseParams = generateEllipseParams(width, height, o);\n        const ellipseResponse = ellipseWithParams(x, y, o, ellipseParams);\n        if (o.fill) {\n            if (o.fillStyle === 'solid') {\n                const shape = ellipseWithParams(x, y, o, ellipseParams).opset;\n                shape.type = 'fillPath';\n                paths.push(shape);\n            }\n            else {\n                paths.push(patternFillPolygons([ellipseResponse.estimatedPoints], o));\n            }\n        }\n        if (o.stroke !== NOS) {\n            paths.push(ellipseResponse.opset);\n        }\n        return this._d('ellipse', paths, o);\n    }\n    circle(x, y, diameter, options) {\n        const ret = this.ellipse(x, y, diameter, diameter, options);\n        ret.shape = 'circle';\n        return ret;\n    }\n    linearPath(points, options) {\n        const o = this._o(options);\n        return this._d('linearPath', [linearPath(points, false, o)], o);\n    }\n    arc(x, y, width, height, start, stop, closed = false, options) {\n        const o = this._o(options);\n        const paths = [];\n        const outline = arc(x, y, width, height, start, stop, closed, true, o);\n        if (closed && o.fill) {\n            if (o.fillStyle === 'solid') {\n                const fillOptions = Object.assign({}, o);\n                fillOptions.disableMultiStroke = true;\n                const shape = arc(x, y, width, height, start, stop, true, false, fillOptions);\n                shape.type = 'fillPath';\n                paths.push(shape);\n            }\n            else {\n                paths.push(patternFillArc(x, y, width, height, start, stop, o));\n            }\n        }\n        if (o.stroke !== NOS) {\n            paths.push(outline);\n        }\n        return this._d('arc', paths, o);\n    }\n    curve(points, options) {\n        const o = this._o(options);\n        const paths = [];\n        const outline = curve(points, o);\n        if (o.fill && o.fill !== NOS && points.length >= 3) {\n            const bcurve = curveToBezier(points);\n            const polyPoints = pointsOnBezierCurves(bcurve, 10, (1 + o.roughness) / 2);\n            if (o.fillStyle === 'solid') {\n                paths.push(solidFillPolygon([polyPoints], o));\n            }\n            else {\n                paths.push(patternFillPolygons([polyPoints], o));\n            }\n        }\n        if (o.stroke !== NOS) {\n            paths.push(outline);\n        }\n        return this._d('curve', paths, o);\n    }\n    polygon(points, options) {\n        const o = this._o(options);\n        const paths = [];\n        const outline = linearPath(points, true, o);\n        if (o.fill) {\n            if (o.fillStyle === 'solid') {\n                paths.push(solidFillPolygon([points], o));\n            }\n            else {\n                paths.push(patternFillPolygons([points], o));\n            }\n        }\n        if (o.stroke !== NOS) {\n            paths.push(outline);\n        }\n        return this._d('polygon', paths, o);\n    }\n    path(d, options) {\n        const o = this._o(options);\n        const paths = [];\n        if (!d) {\n            return this._d('path', paths, o);\n        }\n        d = (d || '').replace(/\\n/g, ' ').replace(/(-\\s)/g, '-').replace('/(\\s\\s)/g', ' ');\n        const hasFill = o.fill && o.fill !== 'transparent' && o.fill !== NOS;\n        const hasStroke = o.stroke !== NOS;\n        const simplified = !!(o.simplification && (o.simplification < 1));\n        const distance = simplified ? (4 - 4 * (o.simplification)) : ((1 + o.roughness) / 2);\n        const sets = pointsOnPath(d, 1, distance);\n        if (hasFill) {\n            if (o.fillStyle === 'solid') {\n                paths.push(solidFillPolygon(sets, o));\n            }\n            else {\n                paths.push(patternFillPolygons(sets, o));\n            }\n        }\n        if (hasStroke) {\n            if (simplified) {\n                sets.forEach((set) => {\n                    paths.push(linearPath(set, false, o));\n                });\n            }\n            else {\n                paths.push(svgPath(d, o));\n            }\n        }\n        return this._d('path', paths, o);\n    }\n    opsToPath(drawing, fixedDecimals) {\n        let path = '';\n        for (const item of drawing.ops) {\n            const data = ((typeof fixedDecimals === 'number') && fixedDecimals >= 0) ? (item.data.map((d) => +d.toFixed(fixedDecimals))) : item.data;\n            switch (item.op) {\n                case 'move':\n                    path += `M${data[0]} ${data[1]} `;\n                    break;\n                case 'bcurveTo':\n                    path += `C${data[0]} ${data[1]}, ${data[2]} ${data[3]}, ${data[4]} ${data[5]} `;\n                    break;\n                case 'lineTo':\n                    path += `L${data[0]} ${data[1]} `;\n                    break;\n            }\n        }\n        return path.trim();\n    }\n    toPaths(drawable) {\n        const sets = drawable.sets || [];\n        const o = drawable.options || this.defaultOptions;\n        const paths = [];\n        for (const drawing of sets) {\n            let path = null;\n            switch (drawing.type) {\n                case 'path':\n                    path = {\n                        d: this.opsToPath(drawing),\n                        stroke: o.stroke,\n                        strokeWidth: o.strokeWidth,\n                        fill: NOS,\n                    };\n                    break;\n                case 'fillPath':\n                    path = {\n                        d: this.opsToPath(drawing),\n                        stroke: NOS,\n                        strokeWidth: 0,\n                        fill: o.fill || NOS,\n                    };\n                    break;\n                case 'fillSketch':\n                    path = this.fillSketch(drawing, o);\n                    break;\n            }\n            if (path) {\n                paths.push(path);\n            }\n        }\n        return paths;\n    }\n    fillSketch(drawing, o) {\n        let fweight = o.fillWeight;\n        if (fweight < 0) {\n            fweight = o.strokeWidth / 2;\n        }\n        return {\n            d: this.opsToPath(drawing),\n            stroke: o.fill || NOS,\n            strokeWidth: fweight,\n            fill: NOS,\n        };\n    }\n}\n", "import { RoughGenerator } from './generator';\nexport class RoughCanvas {\n    constructor(canvas, config) {\n        this.canvas = canvas;\n        this.ctx = this.canvas.getContext('2d');\n        this.gen = new RoughGenerator(config);\n    }\n    draw(drawable) {\n        const sets = drawable.sets || [];\n        const o = drawable.options || this.getDefaultOptions();\n        const ctx = this.ctx;\n        const precision = drawable.options.fixedDecimalPlaceDigits;\n        for (const drawing of sets) {\n            switch (drawing.type) {\n                case 'path':\n                    ctx.save();\n                    ctx.strokeStyle = o.stroke === 'none' ? 'transparent' : o.stroke;\n                    ctx.lineWidth = o.strokeWidth;\n                    if (o.strokeLineDash) {\n                        ctx.setLineDash(o.strokeLineDash);\n                    }\n                    if (o.strokeLineDashOffset) {\n                        ctx.lineDashOffset = o.strokeLineDashOffset;\n                    }\n                    this._drawToContext(ctx, drawing, precision);\n                    ctx.restore();\n                    break;\n                case 'fillPath': {\n                    ctx.save();\n                    ctx.fillStyle = o.fill || '';\n                    const fillRule = (drawable.shape === 'curve' || drawable.shape === 'polygon' || drawable.shape === 'path') ? 'evenodd' : 'nonzero';\n                    this._drawToContext(ctx, drawing, precision, fillRule);\n                    ctx.restore();\n                    break;\n                }\n                case 'fillSketch':\n                    this.fillSketch(ctx, drawing, o);\n                    break;\n            }\n        }\n    }\n    fillSketch(ctx, drawing, o) {\n        let fweight = o.fillWeight;\n        if (fweight < 0) {\n            fweight = o.strokeWidth / 2;\n        }\n        ctx.save();\n        if (o.fillLineDash) {\n            ctx.setLineDash(o.fillLineDash);\n        }\n        if (o.fillLineDashOffset) {\n            ctx.lineDashOffset = o.fillLineDashOffset;\n        }\n        ctx.strokeStyle = o.fill || '';\n        ctx.lineWidth = fweight;\n        this._drawToContext(ctx, drawing, o.fixedDecimalPlaceDigits);\n        ctx.restore();\n    }\n    _drawToContext(ctx, drawing, fixedDecimals, rule = 'nonzero') {\n        ctx.beginPath();\n        for (const item of drawing.ops) {\n            const data = ((typeof fixedDecimals === 'number') && fixedDecimals >= 0) ? (item.data.map((d) => +d.toFixed(fixedDecimals))) : item.data;\n            switch (item.op) {\n                case 'move':\n                    ctx.moveTo(data[0], data[1]);\n                    break;\n                case 'bcurveTo':\n                    ctx.bezierCurveTo(data[0], data[1], data[2], data[3], data[4], data[5]);\n                    break;\n                case 'lineTo':\n                    ctx.lineTo(data[0], data[1]);\n                    break;\n            }\n        }\n        if (drawing.type === 'fillPath') {\n            ctx.fill(rule);\n        }\n        else {\n            ctx.stroke();\n        }\n    }\n    get generator() {\n        return this.gen;\n    }\n    getDefaultOptions() {\n        return this.gen.defaultOptions;\n    }\n    line(x1, y1, x2, y2, options) {\n        const d = this.gen.line(x1, y1, x2, y2, options);\n        this.draw(d);\n        return d;\n    }\n    rectangle(x, y, width, height, options) {\n        const d = this.gen.rectangle(x, y, width, height, options);\n        this.draw(d);\n        return d;\n    }\n    ellipse(x, y, width, height, options) {\n        const d = this.gen.ellipse(x, y, width, height, options);\n        this.draw(d);\n        return d;\n    }\n    circle(x, y, diameter, options) {\n        const d = this.gen.circle(x, y, diameter, options);\n        this.draw(d);\n        return d;\n    }\n    linearPath(points, options) {\n        const d = this.gen.linearPath(points, options);\n        this.draw(d);\n        return d;\n    }\n    polygon(points, options) {\n        const d = this.gen.polygon(points, options);\n        this.draw(d);\n        return d;\n    }\n    arc(x, y, width, height, start, stop, closed = false, options) {\n        const d = this.gen.arc(x, y, width, height, start, stop, closed, options);\n        this.draw(d);\n        return d;\n    }\n    curve(points, options) {\n        const d = this.gen.curve(points, options);\n        this.draw(d);\n        return d;\n    }\n    path(d, options) {\n        const drawing = this.gen.path(d, options);\n        this.draw(drawing);\n        return drawing;\n    }\n}\n", "import { clamp, type IPoint, Point } from '@blocksuite/blocks/std';\nimport { assertNotExists } from '@blocksuite/global/utils';\nimport { RoughCanvas } from 'roughjs/bin/canvas.js';\n\nimport { type IBound, ZOOM_MAX, ZOOM_MIN } from './consts.js';\nimport type { SurfaceElement } from './elements/surface-element.js';\nimport { GridManager } from './grid.js';\nimport { intersects } from './utils/hit-utils.js';\n\nexport interface SurfaceViewport {\n  readonly left: number;\n  readonly top: number;\n  readonly width: number;\n  readonly height: number;\n  readonly center: Point;\n  readonly centerX: number;\n  readonly centerY: number;\n  readonly zoom: number;\n  readonly viewportX: number;\n  readonly viewportY: number;\n  readonly viewportMinXY: IPoint;\n  readonly viewportMaxXY: IPoint;\n  readonly viewportBounds: IBound;\n\n  toModelCoord(viewX: number, viewY: number): [number, number];\n  toViewCoord(logicalX: number, logicalY: number): [number, number];\n\n  setCenter(centerX: number, centerY: number): void;\n  setZoom(zoom: number, focusPoint?: Point): void;\n  applyDeltaCenter(deltaX: number, deltaY: number): void;\n}\n\nexport class Renderer implements SurfaceViewport {\n  canvas: HTMLCanvasElement;\n  ctx: CanvasRenderingContext2D;\n  rc: RoughCanvas;\n  gridManager = new GridManager();\n\n  private _container!: HTMLElement;\n  private _left = 0;\n  private _top = 0;\n  private _width = 0;\n  private _height = 0;\n\n  private _zoom = 1.0;\n  private _center = new Point();\n  private _shouldUpdate = false;\n\n  constructor() {\n    const canvas = document.createElement('canvas');\n    this.canvas = canvas;\n    this.ctx = this.canvas.getContext('2d') as CanvasRenderingContext2D;\n    this.rc = new RoughCanvas(canvas);\n  }\n\n  get left() {\n    return this._left;\n  }\n\n  get top() {\n    return this._top;\n  }\n\n  get width() {\n    return this._width;\n  }\n\n  get height() {\n    return this._height;\n  }\n\n  get zoom() {\n    return this._zoom;\n  }\n\n  get centerX() {\n    return this._center.x;\n  }\n\n  get centerY() {\n    return this._center.y;\n  }\n\n  get center() {\n    return this._center;\n  }\n\n  get viewportX() {\n    const { centerX, width, zoom } = this;\n    return centerX - width / 2 / zoom;\n  }\n\n  get viewportY() {\n    const { centerY, height, zoom } = this;\n    return centerY - height / 2 / zoom;\n  }\n\n  get viewportMinXY() {\n    const { centerX, centerY, width, height, zoom } = this;\n    return {\n      x: centerX - width / 2 / zoom,\n      y: centerY - height / 2 / zoom,\n    };\n  }\n\n  get viewportMaxXY() {\n    const { centerX, centerY, width, height, zoom } = this;\n    return {\n      x: centerX + width / 2 / zoom,\n      y: centerY + height / 2 / zoom,\n    };\n  }\n\n  get viewportBounds() {\n    const { viewportMinXY, viewportMaxXY } = this;\n    return {\n      ...viewportMinXY,\n      w: viewportMaxXY.x - viewportMinXY.x,\n      h: viewportMaxXY.y - viewportMinXY.y,\n    };\n  }\n\n  toModelCoord(viewX: number, viewY: number): [number, number] {\n    const { viewportX, viewportY, zoom } = this;\n    return [viewportX + viewX / zoom, viewportY + viewY / zoom];\n  }\n\n  toViewCoord(logicalX: number, logicalY: number): [number, number] {\n    const { viewportX, viewportY, zoom } = this;\n    return [(logicalX - viewportX) * zoom, (logicalY - viewportY) * zoom];\n  }\n\n  setCenter(centerX: number, centerY: number) {\n    this._center.set(centerX, centerY);\n    this._shouldUpdate = true;\n  }\n\n  /**\n   *\n   * @param zoom zoom\n   * @param focusPoint canvas coordinate\n   */\n  setZoom(zoom: number, focusPoint?: Point) {\n    const prevZoom = this.zoom;\n    focusPoint = focusPoint ?? this._center;\n    this._zoom = clamp(zoom, ZOOM_MIN, ZOOM_MAX);\n    const newZoom = this.zoom;\n\n    const offset = this.center.subtract(focusPoint);\n    const newCenter = focusPoint.add(offset.scale(prevZoom / newZoom));\n    this.setCenter(newCenter.x, newCenter.y);\n    this._shouldUpdate = true;\n  }\n\n  applyDeltaCenter = (deltaX: number, deltaY: number) => {\n    this.setCenter(this.centerX + deltaX, this.centerY + deltaY);\n  };\n\n  addElement(element: SurfaceElement) {\n    this.gridManager.add(element);\n    this._shouldUpdate = true;\n  }\n\n  removeElement(element: SurfaceElement) {\n    this.gridManager.remove(element);\n    this._shouldUpdate = true;\n  }\n\n  load(elements: SurfaceElement[]) {\n    for (let i = 0; i < elements.length; i++) {\n      this.gridManager.add(elements[i]);\n    }\n    this._shouldUpdate = true;\n  }\n\n  refresh() {\n    this._shouldUpdate = true;\n  }\n\n  attach(container: HTMLElement) {\n    assertNotExists(\n      this._container,\n      'Phasor surface is attached multiple times'\n    );\n\n    this._container = container;\n    container.appendChild(this.canvas);\n\n    this._resetSize();\n\n    this._loop();\n  }\n\n  onResize() {\n    const oldWidth = this.width;\n    const oldHeight = this.height;\n\n    this._resetSize();\n\n    this.setCenter(\n      this.centerX - (oldWidth - this.width) / 2,\n      this.centerY - (oldHeight - this.height) / 2\n    );\n\n    // Re-render once the canvas size changed. Otherwise it will flicker.\n    // Because the observer will be called after DOM element rendered,\n    // by the time the canvas content is stale.\n    this._render();\n    this._shouldUpdate = false;\n  }\n\n  private _resetSize() {\n    const { canvas } = this;\n    const dpr = window.devicePixelRatio;\n\n    canvas.style.width = '100%';\n    canvas.style.height = '100%';\n\n    const bbox = canvas.getBoundingClientRect();\n    canvas.width = Math.ceil(bbox.width * dpr);\n    canvas.height = Math.ceil(bbox.height * dpr);\n    this._left = bbox.left;\n    this._top = bbox.top;\n    this._width = bbox.width;\n    this._height = bbox.height;\n\n    this._shouldUpdate = true;\n  }\n\n  private _loop() {\n    requestAnimationFrame(() => {\n      if (this._shouldUpdate) {\n        this._render();\n      }\n      this._shouldUpdate = false;\n      this._loop();\n    });\n  }\n\n  private _render() {\n    const { ctx, gridManager, viewportBounds, width, height, rc, zoom } = this;\n    const dpr = window.devicePixelRatio;\n\n    ctx.clearRect(0, 0, width * dpr, height * dpr);\n    ctx.save();\n\n    ctx.setTransform(zoom * dpr, 0, 0, zoom * dpr, 0, 0);\n\n    const elements = gridManager.search(viewportBounds);\n    for (const element of elements) {\n      const dx = element.x - viewportBounds.x;\n      const dy = element.y - viewportBounds.y;\n      ctx.save();\n      ctx.translate(dx, dy);\n\n      if (intersects(element, viewportBounds) && element.display) {\n        element.render(ctx, rc);\n      }\n\n      ctx.restore();\n    }\n\n    ctx.restore();\n  }\n}\n", "// License: CC0 (no rights reserved).\n\n// This is based on https://observablehq.com/@dgreensp/implementing-fractional-indexing\n\nexport const BASE_62_DIGITS =\n  \"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\";\n\n// `a` may be empty string, `b` is null or non-empty string.\n// `a < b` lexicographically if `b` is non-null.\n// no trailing zeros allowed.\n// digits is a string such as '0123456789' for base 10.  Digits must be in\n// ascending character code order!\n/**\n * @param {string} a\n * @param {string | null | undefined} b\n * @param {string} digits\n * @returns {string}\n */\nfunction midpoint(a, b, digits) {\n  const zero = digits[0];\n  if (b != null && a >= b) {\n    throw new Error(a + \" >= \" + b);\n  }\n  if (a.slice(-1) === zero || (b && b.slice(-1) === zero)) {\n    throw new Error(\"trailing zero\");\n  }\n  if (b) {\n    // remove longest common prefix.  pad `a` with 0s as we\n    // go.  note that we don't need to pad `b`, because it can't\n    // end before `a` while traversing the common prefix.\n    let n = 0;\n    while ((a[n] || zero) === b[n]) {\n      n++;\n    }\n    if (n > 0) {\n      return b.slice(0, n) + midpoint(a.slice(n), b.slice(n), digits);\n    }\n  }\n  // first digits (or lack of digit) are different\n  const digitA = a ? digits.indexOf(a[0]) : 0;\n  const digitB = b != null ? digits.indexOf(b[0]) : digits.length;\n  if (digitB - digitA > 1) {\n    const midDigit = Math.round(0.5 * (digitA + digitB));\n    return digits[midDigit];\n  } else {\n    // first digits are consecutive\n    if (b && b.length > 1) {\n      return b.slice(0, 1);\n    } else {\n      // `b` is null or has length 1 (a single digit).\n      // the first digit of `a` is the previous digit to `b`,\n      // or 9 if `b` is null.\n      // given, for example, midpoint('49', '5'), return\n      // '4' + midpoint('9', null), which will become\n      // '4' + '9' + midpoint('', null), which is '495'\n      return digits[digitA] + midpoint(a.slice(1), null, digits);\n    }\n  }\n}\n\n/**\n * @param {string} int\n * @return {void}\n */\n\nfunction validateInteger(int) {\n  if (int.length !== getIntegerLength(int[0])) {\n    throw new Error(\"invalid integer part of order key: \" + int);\n  }\n}\n\n/**\n * @param {string} head\n * @return {number}\n */\n\nfunction getIntegerLength(head) {\n  if (head >= \"a\" && head <= \"z\") {\n    return head.charCodeAt(0) - \"a\".charCodeAt(0) + 2;\n  } else if (head >= \"A\" && head <= \"Z\") {\n    return \"Z\".charCodeAt(0) - head.charCodeAt(0) + 2;\n  } else {\n    throw new Error(\"invalid order key head: \" + head);\n  }\n}\n\n/**\n * @param {string} key\n * @return {string}\n */\n\nfunction getIntegerPart(key) {\n  const integerPartLength = getIntegerLength(key[0]);\n  if (integerPartLength > key.length) {\n    throw new Error(\"invalid order key: \" + key);\n  }\n  return key.slice(0, integerPartLength);\n}\n\n/**\n * @param {string} key\n * @param {string} digits\n * @return {void}\n */\n\nfunction validateOrderKey(key, digits) {\n  if (key === \"A\" + digits[0].repeat(26)) {\n    throw new Error(\"invalid order key: \" + key);\n  }\n  // getIntegerPart will throw if the first character is bad,\n  // or the key is too short.  we'd call it to check these things\n  // even if we didn't need the result\n  const i = getIntegerPart(key);\n  const f = key.slice(i.length);\n  if (f.slice(-1) === digits[0]) {\n    throw new Error(\"invalid order key: \" + key);\n  }\n}\n\n// note that this may return null, as there is a largest integer\n/**\n * @param {string} x\n * @param {string} digits\n * @return {string | null}\n */\nfunction incrementInteger(x, digits) {\n  validateInteger(x);\n  const [head, ...digs] = x.split(\"\");\n  let carry = true;\n  for (let i = digs.length - 1; carry && i >= 0; i--) {\n    const d = digits.indexOf(digs[i]) + 1;\n    if (d === digits.length) {\n      digs[i] = digits[0];\n    } else {\n      digs[i] = digits[d];\n      carry = false;\n    }\n  }\n  if (carry) {\n    if (head === \"Z\") {\n      return \"a\" + digits[0];\n    }\n    if (head === \"z\") {\n      return null;\n    }\n    const h = String.fromCharCode(head.charCodeAt(0) + 1);\n    if (h > \"a\") {\n      digs.push(digits[0]);\n    } else {\n      digs.pop();\n    }\n    return h + digs.join(\"\");\n  } else {\n    return head + digs.join(\"\");\n  }\n}\n\n// note that this may return null, as there is a smallest integer\n/**\n * @param {string} x\n * @param {string} digits\n * @return {string | null}\n */\n\nfunction decrementInteger(x, digits) {\n  validateInteger(x);\n  const [head, ...digs] = x.split(\"\");\n  let borrow = true;\n  for (let i = digs.length - 1; borrow && i >= 0; i--) {\n    const d = digits.indexOf(digs[i]) - 1;\n    if (d === -1) {\n      digs[i] = digits.slice(-1);\n    } else {\n      digs[i] = digits[d];\n      borrow = false;\n    }\n  }\n  if (borrow) {\n    if (head === \"a\") {\n      return \"Z\" + digits.slice(-1);\n    }\n    if (head === \"A\") {\n      return null;\n    }\n    const h = String.fromCharCode(head.charCodeAt(0) - 1);\n    if (h < \"Z\") {\n      digs.push(digits.slice(-1));\n    } else {\n      digs.pop();\n    }\n    return h + digs.join(\"\");\n  } else {\n    return head + digs.join(\"\");\n  }\n}\n\n// `a` is an order key or null (START).\n// `b` is an order key or null (END).\n// `a < b` lexicographically if both are non-null.\n// digits is a string such as '0123456789' for base 10.  Digits must be in\n// ascending character code order!\n/**\n * @param {string | null | undefined} a\n * @param {string | null | undefined} b\n * @param {string=} digits\n * @return {string}\n */\nexport function generateKeyBetween(a, b, digits = BASE_62_DIGITS) {\n  if (a != null) {\n    validateOrderKey(a, digits);\n  }\n  if (b != null) {\n    validateOrderKey(b, digits);\n  }\n  if (a != null && b != null && a >= b) {\n    throw new Error(a + \" >= \" + b);\n  }\n  if (a == null) {\n    if (b == null) {\n      return \"a\" + digits[0];\n    }\n\n    const ib = getIntegerPart(b);\n    const fb = b.slice(ib.length);\n    if (ib === \"A\" + digits[0].repeat(26)) {\n      return ib + midpoint(\"\", fb, digits);\n    }\n    if (ib < b) {\n      return ib;\n    }\n    const res = decrementInteger(ib, digits);\n    if (res == null) {\n      throw new Error(\"cannot decrement any more\");\n    }\n    return res;\n  }\n\n  if (b == null) {\n    const ia = getIntegerPart(a);\n    const fa = a.slice(ia.length);\n    const i = incrementInteger(ia, digits);\n    return i == null ? ia + midpoint(fa, null, digits) : i;\n  }\n\n  const ia = getIntegerPart(a);\n  const fa = a.slice(ia.length);\n  const ib = getIntegerPart(b);\n  const fb = b.slice(ib.length);\n  if (ia === ib) {\n    return ia + midpoint(fa, fb, digits);\n  }\n  const i = incrementInteger(ia, digits);\n  if (i == null) {\n    throw new Error(\"cannot increment any more\");\n  }\n  if (i < b) {\n    return i;\n  }\n  return ia + midpoint(fa, null, digits);\n}\n\n/**\n * same preconditions as generateKeysBetween.\n * n >= 0.\n * Returns an array of n distinct keys in sorted order.\n * If a and b are both null, returns [a0, a1, ...]\n * If one or the other is null, returns consecutive \"integer\"\n * keys.  Otherwise, returns relatively short keys between\n * a and b.\n * @param {string | null | undefined} a\n * @param {string | null | undefined} b\n * @param {number} n\n * @param {string} digits\n * @return {string[]}\n */\nexport function generateNKeysBetween(a, b, n, digits = BASE_62_DIGITS) {\n  if (n === 0) {\n    return [];\n  }\n  if (n === 1) {\n    return [generateKeyBetween(a, b, digits)];\n  }\n  if (b == null) {\n    let c = generateKeyBetween(a, b, digits);\n    const result = [c];\n    for (let i = 0; i < n - 1; i++) {\n      c = generateKeyBetween(c, b, digits);\n      result.push(c);\n    }\n    return result;\n  }\n  if (a == null) {\n    let c = generateKeyBetween(a, b, digits);\n    const result = [c];\n    for (let i = 0; i < n - 1; i++) {\n      c = generateKeyBetween(a, c, digits);\n      result.push(c);\n    }\n    result.reverse();\n    return result;\n  }\n  const mid = Math.floor(n / 2);\n  const c = generateKeyBetween(a, b, digits);\n  return [\n    ...generateNKeysBetween(a, c, mid, digits),\n    c,\n    ...generateNKeysBetween(c, b, n - mid - 1, digits),\n  ];\n}\n", "import { nanoid } from 'nanoid';\n\nimport { ZOOM_STEP } from '../consts.js';\n\nexport { generateKeyBetween, generateNKeysBetween } from 'fractional-indexing';\n\nexport function generateElementId() {\n  return nanoid(10);\n}\n\n/**\n * Normalizes wheel delta.\n *\n * See https://stackoverflow.com/a/13650579\n *\n * From https://github.com/excalidraw/excalidraw/blob/master/src/components/App.tsx\n * MIT License\n */\nexport function normalizeWheelDeltaY(delta: number, zoom = 1) {\n  const sign = Math.sign(delta);\n  const abs = Math.abs(delta);\n  const maxStep = ZOOM_STEP * 100;\n  if (abs > maxStep) {\n    delta = maxStep * sign;\n  }\n  let newZoom = zoom - delta / 100;\n  // increase zoom steps the more zoomed-in we are (applies to >100% only)\n  newZoom +=\n    Math.log10(Math.max(1, zoom)) *\n    -sign *\n    // reduced amplification for small deltas (small movements on a trackpad)\n    Math.min(1, abs / 20);\n  return newZoom;\n}\n", "import { assertExists } from '@blocksuite/global/utils';\nimport { randomSeed } from 'roughjs/bin/math.js';\nimport * as Y from 'yjs';\n\nimport type { IBound } from './consts.js';\nimport {\n  ConnectorElement,\n  ElementCtors,\n  ElementDefaultProps,\n  type IElementCreateProps,\n  type IPhasorElementType,\n  type PhasorElement,\n  type PhasorElementType,\n  type SurfaceElement,\n} from './elements/index.js';\nimport type {\n  ComputedValue,\n  HitTestOptions,\n} from './elements/surface-element.js';\nimport { compare } from './grid.js';\nimport type { SurfaceViewport } from './renderer.js';\nimport { Renderer } from './renderer.js';\nimport { contains, getCommonBound } from './utils/bound.js';\nimport { intersects } from './utils/hit-utils.js';\nimport {\n  generateElementId,\n  generateKeyBetween,\n  normalizeWheelDeltaY,\n} from './utils/std.js';\nimport { serializeXYWH } from './utils/xywh.js';\n\nexport class SurfaceManager {\n  private _renderer: Renderer;\n  private _yContainer: Y.Map<Y.Map<unknown>>;\n  private _elements = new Map<string, SurfaceElement>();\n  private _bindings = new Map<string, Set<string>>();\n\n  private _computedValue: ComputedValue;\n\n  indexes = { min: 'a0', max: 'a0' };\n\n  constructor(\n    yContainer: Y.Map<unknown>,\n    computedValue: ComputedValue = v => v\n  ) {\n    this._renderer = new Renderer();\n    this._yContainer = yContainer as Y.Map<Y.Map<unknown>>;\n    this._computedValue = computedValue;\n\n    this._syncFromExistingContainer();\n    this._yContainer.observe(this._onYContainer);\n  }\n\n  get viewport(): SurfaceViewport {\n    return this._renderer;\n  }\n\n  private _addBinding(id0: string, id1: string) {\n    if (!this._bindings.has(id0)) {\n      this._bindings.set(id0, new Set());\n    }\n    this._bindings.get(id0)?.add(id1);\n  }\n\n  private _updateBindings(element: SurfaceElement) {\n    if (element instanceof ConnectorElement) {\n      if (element.startElement) {\n        this._addBinding(element.startElement.id, element.id);\n        this._addBinding(element.id, element.startElement.id);\n      }\n      if (element.endElement) {\n        this._addBinding(element.endElement.id, element.id);\n        this._addBinding(element.id, element.endElement.id);\n      }\n    }\n  }\n\n  private _syncFromExistingContainer() {\n    this._transact(() => {\n      this._yContainer.forEach(yElement => {\n        const type = yElement.get('type') as keyof PhasorElementType;\n\n        const ElementCtor = ElementCtors[type];\n        assertExists(ElementCtor);\n        const element = new ElementCtor(yElement, this);\n        element.computedValue = this._computedValue;\n        element.mount(this._renderer);\n\n        this._elements.set(element.id, element);\n\n        if (element.index > this.indexes.max) {\n          this.indexes.max = element.index;\n        } else if (element.index < this.indexes.min) {\n          this.indexes.min = element.index;\n        }\n\n        this._updateBindings(element);\n      });\n    });\n  }\n\n  private _onYContainer = (event: Y.YMapEvent<Y.Map<unknown>>) => {\n    // skip empty event\n    if (event.changes.keys.size === 0) return;\n    event.keysChanged.forEach(id => {\n      const type = event.changes.keys.get(id);\n      if (!type) {\n        console.error('invalid event', event);\n        return;\n      }\n\n      if (type.action === 'add') {\n        const yElement = this._yContainer.get(id) as Y.Map<unknown>;\n        const type = yElement.get('type') as keyof PhasorElementType;\n\n        const ElementCtor = ElementCtors[type];\n        assertExists(ElementCtor);\n        const element = new ElementCtor(yElement, this);\n        element.computedValue = this._computedValue;\n        element.mount(this._renderer);\n\n        this._elements.set(element.id, element);\n\n        if (element.index > this.indexes.max) {\n          this.indexes.max = element.index;\n        }\n\n        this._updateBindings(element);\n      } else if (type.action === 'update') {\n        console.error('update event on yElements is not supported', event);\n      } else if (type.action === 'delete') {\n        const element = this._elements.get(id);\n        assertExists(element);\n        element.unmount();\n        this._elements.delete(id);\n\n        if (element.index === this.indexes.min) {\n          this.indexes.min = generateKeyBetween(element.index, null);\n        }\n      }\n    });\n  };\n\n  private _transact(callback: () => void) {\n    const doc = this._yContainer.doc as Y.Doc;\n    doc.transact(callback, doc.clientID);\n  }\n\n  refresh() {\n    this._renderer.refresh();\n  }\n\n  updateIndexes(\n    keys: string[],\n    elements: PhasorElement[],\n    callback: (keys: string[]) => void\n  ) {\n    this._transact(() => {\n      let newIndex;\n      let i = 0;\n      const len = elements.length;\n      for (; i < len; i++) {\n        newIndex = keys[i];\n        const yElement = this._yContainer.get(elements[i].id) as Y.Map<unknown>;\n        const oldIndex = yElement.get('index') as string;\n        if (oldIndex === newIndex) continue;\n        yElement.set('index', newIndex);\n      }\n\n      callback(keys);\n    });\n  }\n\n  attach(container: HTMLElement) {\n    this._renderer.attach(container);\n  }\n\n  onResize() {\n    this._renderer.onResize();\n  }\n\n  getElementsBound(): IBound | null {\n    return getCommonBound([...this._elements.values()]);\n  }\n\n  addElement<T extends keyof IPhasorElementType>(\n    type: T,\n    properties: IElementCreateProps<T>\n  ): PhasorElement['id'] {\n    const id = generateElementId();\n\n    const yMap = new Y.Map();\n\n    const defaultProps = ElementDefaultProps[type];\n    const props: IElementCreateProps<T> = {\n      ...defaultProps,\n      ...properties,\n      id,\n      index: generateKeyBetween(this.indexes.max, null),\n      seed: randomSeed(),\n    };\n\n    this._transact(() => {\n      for (const [key, value] of Object.entries(props)) {\n        if (key === 'text' && !(value instanceof Y.Text)) {\n          yMap.set(key, new Y.Text(value));\n        } else {\n          yMap.set(key, value);\n        }\n      }\n      this._yContainer.set(id, yMap);\n    });\n\n    return id;\n  }\n\n  updateElement<T extends keyof IPhasorElementType>(\n    id: string,\n    properties: IElementCreateProps<T>\n  ) {\n    this._transact(() => {\n      const element = this._elements.get(id);\n      assertExists(element);\n      element.applyUpdate(properties);\n    });\n  }\n\n  setElementBound(id: string, bound: IBound) {\n    this.updateElement(id, {\n      xywh: serializeXYWH(bound.x, bound.y, bound.w, bound.h),\n    });\n  }\n\n  removeElement(id: string) {\n    this._transact(() => {\n      this._yContainer.delete(id);\n    });\n  }\n\n  hasElement(id: string) {\n    return this._yContainer.has(id);\n  }\n\n  toModelCoord(viewX: number, viewY: number): [number, number] {\n    return this._renderer.toModelCoord(viewX, viewY);\n  }\n\n  toViewCoord(modelX: number, modelY: number): [number, number] {\n    return this._renderer.toViewCoord(modelX, modelY);\n  }\n\n  pickById(id: string) {\n    return this._elements.get(id);\n  }\n\n  pickByPoint(\n    x: number,\n    y: number,\n    options?: HitTestOptions\n  ): SurfaceElement[] {\n    const bound: IBound = { x: x - 1, y: y - 1, w: 2, h: 2 };\n    const candidates = this._renderer.gridManager.search(bound);\n    const picked = candidates.filter(element => {\n      return element.hitTest(x, y, options);\n    });\n\n    return picked;\n  }\n\n  pickTop(x: number, y: number): SurfaceElement | null {\n    const results = this.pickByPoint(x, y);\n    return results[results.length - 1] ?? null;\n  }\n\n  pickByBound(bound: IBound): SurfaceElement[] {\n    const candidates = this._renderer.gridManager.search(bound);\n    const picked = candidates.filter((element: SurfaceElement) => {\n      return contains(bound, element) || intersects(bound, element);\n    });\n\n    return picked;\n  }\n\n  getSortedElementsWithViewportBounds() {\n    return this.pickByBound(this.viewport.viewportBounds).sort(compare);\n  }\n\n  getBindingElements(id: string) {\n    const bindingIds = this._bindings.get(id);\n    if (!bindingIds?.size) {\n      return [];\n    }\n    return [...bindingIds.values()]\n      .map(bindingId => this.pickById(bindingId))\n      .filter(e => !!e) as SurfaceElement[];\n  }\n\n  dispose() {\n    this._yContainer.unobserve(this._onYContainer);\n  }\n\n  /** @internal Only for testing */\n  initDefaultGestureHandler() {\n    const { _renderer } = this;\n    _renderer.canvas.addEventListener('wheel', e => {\n      e.preventDefault();\n      // pan\n      if (!e.ctrlKey) {\n        const dx = e.deltaX / _renderer.zoom;\n        const dy = e.deltaY / _renderer.zoom;\n        _renderer.setCenter(_renderer.centerX + dx, _renderer.centerY + dy);\n      }\n      // zoom\n      else {\n        const zoom = normalizeWheelDeltaY(e.deltaY);\n        _renderer.setZoom(zoom);\n      }\n    });\n  }\n\n  getElements() {\n    return [...this._elements.values()];\n  }\n}\n", "import {\n  type Bound,\n  type PhasorElement,\n  type PhasorElementType,\n  TextElement,\n} from '@blocksuite/phasor';\nimport {\n  deserializeXYWH,\n  getCommonBound,\n  serializeXYWH,\n} from '@blocksuite/phasor';\nimport type { Page } from '@blocksuite/store';\nimport { assertExists } from '@blocksuite/store';\n\nimport type { EdgelessPageBlockComponent } from '../../page-block/edgeless/edgeless-page-block.js';\nimport type { Selectable } from '../../page-block/edgeless/selection-manager.js';\nimport {\n  DEFAULT_FRAME_HEIGHT,\n  DEFAULT_FRAME_WIDTH,\n  isTopLevelBlock,\n} from '../../page-block/edgeless/utils.js';\nimport { deleteModelsByRange } from '../../page-block/utils/container-operations.js';\nimport type { SerializedBlock, TopLevelBlockModel } from '../index.js';\nimport { getService } from '../service.js';\nimport { addSerializedBlocks } from '../service/json2block.js';\nimport { activeEditorManager } from '../utils/active-editor-manager.js';\nimport { getCurrentBlockRange } from '../utils/block-range.js';\nimport { groupBy } from '../utils/std.js';\nimport type { Clipboard } from './type.js';\nimport {\n  clipboardData2Blocks,\n  copyBlocks,\n  copySurfaceText,\n  getBlockClipboardInfo,\n} from './utils/commons.js';\nimport {\n  createSurfaceClipboardItems,\n  getSurfaceClipboardData,\n  performNativeCopy,\n} from './utils/index.js';\n\nexport class EdgelessClipboard implements Clipboard {\n  private _page!: Page;\n  private _edgeless: EdgelessPageBlockComponent;\n\n  constructor(page: Page, edgeless: EdgelessPageBlockComponent) {\n    this._page = page;\n    this._edgeless = edgeless;\n  }\n\n  init(page: Page = this._page) {\n    this._page = page;\n    document.body.addEventListener('cut', this._onCut);\n    document.body.addEventListener('copy', this._onCopy);\n    document.body.addEventListener('paste', this._onPaste);\n  }\n\n  get selection() {\n    return this._edgeless.selection;\n  }\n\n  get slots() {\n    return this._edgeless.slots;\n  }\n\n  get surface() {\n    return this._edgeless.surface;\n  }\n\n  public dispose() {\n    document.body.removeEventListener('cut', this._onCut);\n    document.body.removeEventListener('copy', this._onCopy);\n    document.body.removeEventListener('paste', this._onPaste);\n  }\n\n  private _onCut = (e: ClipboardEvent) => {\n    if (!activeEditorManager.isActive(this._edgeless)) {\n      return;\n    }\n    e.preventDefault();\n    this._onCopy(e);\n\n    const { state } = this.selection;\n    if (state.active) {\n      deleteModelsByRange(this._page);\n      return;\n    }\n\n    this._page.transact(() => {\n      state.selected.forEach(selected => {\n        if (isTopLevelBlock(selected)) {\n          this._page.deleteBlock(selected);\n        } else {\n          this.surface.removeElement(selected.id);\n        }\n      });\n    });\n    this.slots.selectionUpdated.emit({ active: false, selected: [] });\n  };\n\n  private _onCopy = (e: ClipboardEvent) => {\n    if (!activeEditorManager.isActive(this._edgeless)) {\n      return;\n    }\n    e.preventDefault();\n    const { state } = this.selection;\n    // when frame active, handle copy like page mode\n    if (state.active) {\n      if (state.selected[0] instanceof TextElement) {\n        copySurfaceText(this._edgeless);\n      } else {\n        const range = getCurrentBlockRange(this._page);\n        assertExists(range);\n        copyBlocks(range);\n      }\n      return;\n    }\n    const data = state.selected\n      .map(selected => {\n        if (isTopLevelBlock(selected)) {\n          return getBlockClipboardInfo(selected).json;\n        } else {\n          return selected.serialize();\n        }\n      })\n      .filter(d => !!d);\n\n    const clipboardItems = createSurfaceClipboardItems(data);\n    performNativeCopy(clipboardItems);\n  };\n\n  private _onPaste = async (e: ClipboardEvent) => {\n    if (!activeEditorManager.isActive(this._edgeless)) {\n      return;\n    }\n    e.preventDefault();\n    const { state } = this.selection;\n    if (state.active) {\n      if (!(state.selected[0] instanceof TextElement)) {\n        this._pasteInTextFrame(e);\n      }\n      // use build-in paste handler in virgo when paste in surface text element\n      return;\n    }\n\n    const elementsRawData = getSurfaceClipboardData(e);\n    if (!elementsRawData) {\n      return;\n    }\n\n    this._pasteShapesAndFrames(elementsRawData);\n  };\n\n  private async _pasteInTextFrame(e: ClipboardEvent) {\n    const blocks = await clipboardData2Blocks(this._page, e.clipboardData);\n    if (!blocks.length) {\n      return;\n    }\n    this._page.captureSync();\n\n    deleteModelsByRange(this._page);\n\n    const range = getCurrentBlockRange(this._page);\n\n    const focusedBlockModel = range?.models[0];\n    assertExists(focusedBlockModel);\n    const service = getService(focusedBlockModel.flavour);\n    assertExists(range);\n    await service.json2Block(focusedBlockModel, blocks, range);\n  }\n\n  private _createPhasorElements(elements: Record<string, unknown>[]) {\n    const phasorElements =\n      (elements\n        ?.map(d => {\n          const id = this.surface.addElement(\n            d.type as keyof PhasorElementType,\n            d\n          );\n          const element = this.surface.pickById(id);\n          return element;\n        })\n        .filter(e => !!e) as PhasorElement[]) || [];\n    return phasorElements;\n  }\n\n  private async _createFrameBlocks(\n    frames: SerializedBlock[],\n    pasteX: number,\n    pasteY: number,\n    oldCommonBound: Bound\n  ) {\n    const frameIds = await Promise.all(\n      frames.map(async ({ xywh, children, background }) => {\n        const [oldX, oldY, oldW, oldH] = xywh\n          ? deserializeXYWH(xywh)\n          : [\n              oldCommonBound.x,\n              oldCommonBound.y,\n              DEFAULT_FRAME_WIDTH,\n              DEFAULT_FRAME_HEIGHT,\n            ];\n        const newXywh = serializeXYWH(\n          pasteX + oldX - oldCommonBound.x,\n          pasteY + oldY - oldCommonBound.y,\n          oldW,\n          oldH\n        );\n        const frameId = this._page.addBlock(\n          'affine:frame',\n          {\n            xywh: newXywh,\n            background,\n          },\n          this._page.root?.id\n        );\n        const frame = this._page.getBlockById(frameId);\n        assertExists(frame);\n\n        await addSerializedBlocks(this._page, children, frame, 0);\n        return frameId;\n      })\n    );\n    return frameIds;\n  }\n\n  private _getOldCommonBound(\n    phasorElements: PhasorElement[],\n    frames: SerializedBlock[]\n  ) {\n    const commonBound = getCommonBound([\n      ...phasorElements,\n      ...(frames\n        .map(({ xywh }) => {\n          if (!xywh) {\n            return;\n          }\n          const [x, y, w, h] = deserializeXYWH(xywh);\n          return {\n            x,\n            y,\n            w,\n            h,\n          };\n        })\n        .filter(b => !!b) as Bound[]),\n    ]);\n    assertExists(commonBound);\n    return commonBound;\n  }\n\n  private _emitSelectionChangeAfterPaste(\n    phasorElementIds: string[],\n    frameIds: string[]\n  ) {\n    const newSelected = [\n      ...(phasorElementIds\n        .map(id => this.surface.pickById(id))\n        .filter(e => !!e) as PhasorElement[]),\n      ...(frameIds\n        .map(id => this._page.getBlockById(id))\n        .filter(\n          f => !!f && f.flavour === 'affine:frame'\n        ) as TopLevelBlockModel[]),\n    ];\n\n    this.slots.selectionUpdated.emit({\n      active: false,\n      selected: newSelected,\n    });\n  }\n\n  private async _pasteShapesAndFrames(\n    elementsRawData: Record<string, unknown>[]\n  ) {\n    const groupedByType = groupBy(elementsRawData, data =>\n      isTopLevelBlock(data as unknown as Selectable) ? 'frames' : 'elements'\n    ) as unknown as {\n      frames?: SerializedBlock[];\n      elements?: { type: PhasorElement['type'] }[];\n    };\n\n    const elements = this._createPhasorElements(groupedByType.elements || []);\n\n    const oldCommonBound = this._getOldCommonBound(\n      elements,\n      groupedByType.frames || []\n    );\n\n    const { lastMousePos } = this.selection;\n    const [modelX, modelY] = this.surface.toModelCoord(\n      lastMousePos.x,\n      lastMousePos.y\n    );\n    const pasteX = modelX - oldCommonBound.w / 2;\n    const pasteY = modelY - oldCommonBound.h / 2;\n\n    // update phasor elements' position to mouse position\n    elements.forEach(ele => {\n      const newXYWH = serializeXYWH(\n        pasteX + ele.x - oldCommonBound.x,\n        pasteY + ele.y - oldCommonBound.y,\n        ele.w,\n        ele.h\n      );\n\n      this.surface.updateElement(ele.id, {\n        xywh: newXYWH,\n      });\n    });\n    // create and add blocks to page\n    const frameIds = await this._createFrameBlocks(\n      groupedByType.frames || [],\n      pasteX,\n      pasteY,\n      oldCommonBound\n    );\n\n    this._emitSelectionChangeAfterPaste(\n      elements.map(ele => ele.id),\n      frameIds\n    );\n  }\n}\n", "import type { Page } from '@blocksuite/store';\nimport { assertExists } from '@blocksuite/store';\n\nimport { getService } from '../../__internal__/service.js';\nimport { deleteModelsByRange } from '../../page-block/index.js';\nimport { activeEditorManager } from '../utils/active-editor-manager.js';\nimport { getCurrentBlockRange } from '../utils/index.js';\nimport type { Clipboard } from './type.js';\nimport {\n  clipboardData2Blocks,\n  copyBlocks,\n  normalizePasteBlocks,\n} from './utils/commons.js';\n\n// TODO: getCurrentBlockRange can not get embed block when selection is native, so clipboard can not copy embed block\n\nexport class PageClipboard implements Clipboard {\n  _page!: Page;\n  _ele: Element;\n  constructor(pageEle: Element) {\n    this._ele = pageEle;\n  }\n  init(page: Page) {\n    this._page = page;\n    document.body.addEventListener('cut', this._onCut);\n    document.body.addEventListener('copy', this._onCopy);\n    document.body.addEventListener('paste', this._onPaste);\n  }\n\n  dispose() {\n    document.body.removeEventListener('cut', this._onCut);\n    document.body.removeEventListener('copy', this._onCopy);\n    document.body.removeEventListener('paste', this._onPaste);\n  }\n\n  private _onPaste = async (e: ClipboardEvent) => {\n    if (!activeEditorManager.isActive(this._ele)) {\n      return;\n    }\n    const range = getCurrentBlockRange(this._page);\n    if (!e.clipboardData || !range) {\n      return;\n    }\n    e.preventDefault();\n\n    const blocks = await clipboardData2Blocks(this._page, e.clipboardData);\n    const normalizedBlocks = normalizePasteBlocks(this._page, blocks);\n\n    if (!normalizedBlocks.length) {\n      return;\n    }\n    this._page.captureSync();\n\n    const focusedBlockModel = deleteModelsByRange(this._page, range);\n    // This assert is unreliable\n    // but it's reasonable to paste nothing when focus block is not found\n    assertExists(focusedBlockModel);\n    const service = getService(focusedBlockModel.flavour);\n    assertExists(range);\n    await service.json2Block(focusedBlockModel, normalizedBlocks, range);\n\n    this._page.captureSync();\n\n    this._page.slots.pasted.emit(blocks);\n  };\n\n  private _onCopy = (\n    e: ClipboardEvent,\n    range = getCurrentBlockRange(this._page)\n  ) => {\n    if (!activeEditorManager.isActive(this._ele)) {\n      return;\n    }\n    if (!range) {\n      return;\n    }\n    e.preventDefault();\n    this._page.captureSync();\n\n    copyBlocks(range);\n\n    this._page.captureSync();\n\n    this._page.slots.copied.emit();\n  };\n\n  private _onCut = (e: ClipboardEvent) => {\n    if (!activeEditorManager.isActive(this._ele)) {\n      return;\n    }\n    const range = getCurrentBlockRange(this._page);\n    if (!range) {\n      return;\n    }\n    e.preventDefault();\n    this._onCopy(e, range);\n    deleteModelsByRange(this._page, range);\n  };\n}\n", "import { defineBlockSchema, type SchemaToModel } from '@blocksuite/store';\nimport { literal } from 'lit/static-html.js';\n\n// This type is declared in Affine, this block will move to Affine\ntype MetaData = {\n  title?: string;\n  description?: string;\n  icon?: string;\n  image?: string;\n  // keywords?: string[];\n  // language?: string;\n  // type?: string;\n  // url?: string;\n  // provider?: string;\n  [x: string]: string | string[] | undefined | boolean;\n};\nexport type BookmarkProps = {\n  url: string;\n  caption?: string;\n  crawled?: boolean;\n} & MetaData;\n\nexport const defaultBookmarkProps: BookmarkProps = {\n  url: '',\n  title: '',\n  description: '',\n  icon: '',\n  image: '',\n  caption: '',\n  crawled: false,\n};\n\nexport const BookmarkBlockSchema = defineBlockSchema({\n  flavour: 'affine:bookmark',\n  props: (internal): BookmarkProps => defaultBookmarkProps,\n  metadata: {\n    version: 1,\n    role: 'content',\n    tag: literal`affine-bookmark`,\n    parent: ['affine:frame'],\n  },\n});\n\nexport type BookmarkBlockModel = SchemaToModel<typeof BookmarkBlockSchema>;\n", "import type { BaseBlockModel } from '@blocksuite/store';\n\nimport type { BookmarkBlockComponent } from './bookmark-block.js';\nimport type { BookmarkBlockModel, BookmarkProps } from './bookmark-model.js';\nimport { defaultBookmarkProps } from './bookmark-model.js';\n\n// Result is boolean used to record whether the meta data is crawled\nexport async function reloadBookmarkBlock(\n  model: BaseBlockModel<BookmarkBlockModel>,\n  bookmarkElement: BookmarkBlockComponent,\n  force = false\n) {\n  // @ts-ignore\n  if (window?.apis?.ui?.getBookmarkDataByLink) {\n    if ((model.crawled || !model.url) && !force) {\n      return;\n    }\n\n    bookmarkElement.loading = true;\n    // This method is get website's metaData by link\n    // And only exists in the AFFiNE client\n    // @ts-ignore\n    const metaData = (await window.apis.ui.getBookmarkDataByLink(\n      model.url\n    )) as BookmarkProps;\n\n    // check is block exist\n    if (!model.page.getBlockById(model.id)) {\n      return;\n    }\n\n    model.page.withoutTransact(() => {\n      model.page.updateBlock(model, {\n        ...metaData,\n        url: model.url,\n        crawled: true,\n      });\n    });\n\n    bookmarkElement.loading = false;\n  }\n}\n\nexport function cloneBookmarkProperties(\n  model: BaseBlockModel<BookmarkBlockModel>\n) {\n  return Object.keys(defaultBookmarkProps).reduce<BookmarkProps>(\n    (props, key) => {\n      props[key] = model[key];\n      return props;\n    },\n    {} as BookmarkProps\n  );\n}\n", "import { WithDisposable } from '@blocksuite/lit';\nimport type { BaseBlockModel } from '@blocksuite/store';\nimport { createPopper } from '@popperjs/core';\nimport { css, html, LitElement, nothing, type TemplateResult } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport { toast } from '../..//components/toast.js';\nimport { copyBlocks } from '../../__internal__/clipboard/index.js';\nimport { getBlockElementByModel } from '../../__internal__/index.js';\nimport type { BookmarkBlockComponent } from '../bookmark-block.js';\nimport type { BookmarkBlockModel } from '../bookmark-model.js';\nimport {\n  CopyIcon,\n  DeleteIcon,\n  DuplicateIcon,\n  RefreshIcon,\n} from '../images/icons.js';\nimport { cloneBookmarkProperties, reloadBookmarkBlock } from '../utils.js';\n\nexport type OperationMenuPopper = {\n  element: BookmarkOperationMenu;\n  dispose: () => void;\n};\n\nexport function createBookmarkOperationMenu(\n  reference: HTMLElement,\n  props: {\n    model: BaseBlockModel<BookmarkBlockModel>;\n    onSelected?: MenuActionCallback;\n  }\n): OperationMenuPopper {\n  const menu = document.createElement('bookmark-operation-menu');\n  menu.model = props.model;\n  menu.onSelected = props.onSelected;\n\n  reference.appendChild(menu);\n  const popper = createPopper(reference, menu, {\n    placement: 'top-start',\n    modifiers: [\n      {\n        name: 'offset',\n        options: {\n          offset: [0, 6],\n        },\n      },\n    ],\n  });\n\n  return {\n    element: menu,\n    dispose: () => {\n      menu.remove();\n      popper.destroy();\n    },\n  };\n}\n\nexport type MenuActionCallback = (type: Operation['type']) => void;\n\ntype Operation = {\n  type: 'reload' | 'copy' | 'delete' | 'duplicate';\n  icon: TemplateResult;\n  label: string;\n  action: (\n    model: BaseBlockModel<BookmarkBlockModel>,\n    callback?: MenuActionCallback,\n    element?: HTMLElement\n  ) => void;\n  divider?: boolean;\n};\nconst operations: Operation[] = [\n  {\n    type: 'copy',\n    icon: CopyIcon,\n    label: 'Copy original link',\n    action: (model, callback) => {\n      copyBlocks({\n        type: 'Block',\n        models: [model],\n        startOffset: 0,\n        endOffset: 0,\n      });\n      toast('Copied link to clipboard');\n      callback?.('copy');\n    },\n  },\n  {\n    type: 'duplicate',\n    icon: DuplicateIcon,\n    label: 'Duplicate',\n    action: (model, callback) => {\n      const { page } = model;\n\n      const parent = page.getParent(model);\n      const index = parent?.children.indexOf(model);\n\n      const clonedProps = cloneBookmarkProperties(model);\n\n      page.addBlock('affine:bookmark', clonedProps, parent, index);\n\n      callback?.('duplicate');\n    },\n  },\n  {\n    type: 'reload',\n    icon: RefreshIcon,\n    label: 'Reload',\n    action: (model, callback) => {\n      reloadBookmarkBlock(\n        model,\n        getBlockElementByModel(model) as BookmarkBlockComponent,\n        true\n      );\n      callback?.('reload');\n    },\n  },\n  {\n    type: 'delete',\n    icon: DeleteIcon,\n    label: 'Delete',\n    action: (model, callback) => {\n      model.page.deleteBlock(model);\n      callback?.('delete');\n    },\n  },\n];\n\n@customElement('bookmark-operation-menu')\nexport class BookmarkOperationMenu extends WithDisposable(LitElement) {\n  static override styles = css`\n    .bookmark-operation-menu {\n      border-radius: 8px 8px 8px 0;\n      padding: 8px;\n      background: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-shadow-2);\n    }\n    .menu-item {\n      display: flex;\n      justify-content: flex-start;\n      align-items: center;\n      fill: var(--affine-icon-color);\n      color: var(--affine-text-primary-color);\n    }\n    .menu-item:hover {\n      background: var(--affine-hover-color);\n      fill: var(--affine-primary-color);\n      color: var(--affine-primary-color);\n    }\n    .menu-item svg {\n      margin: 0 8px;\n    }\n  `;\n\n  @property()\n  model!: BaseBlockModel;\n\n  @property()\n  root!: BookmarkBlockComponent;\n\n  @property()\n  onSelected?: MenuActionCallback;\n\n  @query('.bookmark-bar')\n  formatQuickBarElement!: HTMLElement;\n\n  override connectedCallback() {\n    super.connectedCallback();\n  }\n\n  override render() {\n    const menuItems = repeat(\n      operations,\n      ({ type }) => type,\n      ({ type, icon, label, action, divider }) => {\n        return html`<icon-button\n            width=\"130px\"\n            height=\"32px\"\n            class=\"menu-item ${type}\"\n            @click=${() => {\n              action(this.model, this.onSelected, this);\n            }}\n          >\n            ${icon} ${label}\n          </icon-button>\n          ${divider ? html`<div class=\"divider\"></div>` : nothing} `;\n      }\n    );\n\n    return html` <div class=\"bookmark-operation-menu\">${menuItems}</div> `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'bookmark-operation-menu': BookmarkOperationMenu;\n  }\n}\n", "import '../../components/button.js';\n\nimport { WithDisposable } from '@blocksuite/lit';\nimport { type BaseBlockModel } from '@blocksuite/store';\nimport type { TemplateResult } from 'lit';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport * as Y from 'yjs';\n\nimport { tooltipStyle } from '../../components/tooltip/tooltip.js';\nimport type { BookmarkBlockModel } from '../bookmark-model.js';\nimport { CaptionIcon, EditIcon, LinkIcon, MoreIcon } from '../images/icons.js';\nimport type {\n  MenuActionCallback,\n  OperationMenuPopper,\n} from './bookmark-operation-popper.js';\nimport { createBookmarkOperationMenu } from './bookmark-operation-popper.js';\nexport type ConfigItem = {\n  type: 'link' | 'edit' | 'caption';\n  icon: TemplateResult;\n  tooltip: string;\n  action: (\n    model: BaseBlockModel<BookmarkBlockModel>,\n    callback?: ToolbarActionCallback,\n    element?: HTMLElement\n  ) => void;\n  divider?: boolean;\n};\n\nexport type ToolbarActionCallback = (type: ConfigItem['type']) => void;\nconst config: ConfigItem[] = [\n  {\n    type: 'link',\n    icon: LinkIcon,\n    tooltip: 'Turn into Link view',\n    action: (model, callback) => {\n      const { page } = model;\n\n      const parent = page.getParent(model);\n      const index = parent?.children.indexOf(model);\n\n      const yText = new Y.Text();\n      const insert = model.title || model.caption || model.url;\n      yText.insert(0, insert);\n      yText.format(0, insert.length, { link: model.url });\n      const text = new page.Text(yText);\n      page.addBlock(\n        'affine:paragraph',\n        {\n          text,\n        },\n        parent,\n        index\n      );\n\n      model.page.deleteBlock(model);\n      callback?.('link');\n    },\n    divider: true,\n  },\n  {\n    type: 'caption',\n    icon: CaptionIcon,\n    tooltip: 'Add Caption',\n    action: (model, callback) => {\n      callback?.('caption');\n    },\n  },\n  {\n    type: 'edit',\n    icon: EditIcon,\n    tooltip: 'Edit',\n    action: (model, callback) => {\n      callback?.('edit');\n    },\n    divider: true,\n  },\n];\n\n@customElement('bookmark-toolbar')\nexport class BookmarkToolbar extends WithDisposable(LitElement) {\n  static override styles = css`\n    ${tooltipStyle}\n    .bookmark-bar {\n      box-sizing: border-box;\n      position: absolute;\n      right: 0;\n      top: -40px;\n      display: flex;\n      align-items: center;\n      padding: 4px 8px;\n      gap: 4px;\n      height: 40px;\n\n      border-radius: 8px;\n      background: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-shadow-2);\n      z-index: var(--affine-z-index-popover);\n      user-select: none;\n    }\n    .divider {\n      width: 1px;\n      height: 24px;\n      background-color: var(--affine-border-color);\n    }\n  `;\n\n  @property()\n  model!: BaseBlockModel;\n\n  @property()\n  onSelected?: ToolbarActionCallback & MenuActionCallback;\n\n  @query('.bookmark-bar')\n  formatQuickBarElement!: HTMLElement;\n\n  @query('.more-button-wrapper')\n  moreButton!: HTMLElement;\n\n  private _menu: OperationMenuPopper | null = null;\n\n  private _toggleMenu() {\n    if (this._menu) {\n      this._menu.dispose();\n      this._menu = null;\n    } else {\n      this._menu = createBookmarkOperationMenu(this.moreButton, {\n        model: this.model,\n        onSelected: type => {\n          this._toggleMenu();\n          this.onSelected?.(type);\n        },\n      });\n    }\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n  }\n\n  override render() {\n    const buttons = repeat(\n      config,\n      ({ type }) => type,\n      ({ type, icon, tooltip, action, divider }) => {\n        return html`<icon-button\n            width=\"32px\"\n            height=\"32px\"\n            class=\"bookmark-toolbar-button has-tool-tip ${type}\"\n            @click=${() => {\n              action(this.model, this.onSelected, this);\n            }}\n          >\n            ${icon}\n            <tool-tip inert role=\"tooltip\">${tooltip}</tool-tip>\n          </icon-button>\n          ${divider ? html`<div class=\"divider\"></div>` : nothing} `;\n      }\n    );\n\n    return html`\n      <div class=\"bookmark-bar\">\n        ${buttons}\n\n        <div class=\"more-button-wrapper\">\n          <icon-button\n            width=\"32px\"\n            height=\"32px\"\n            class=\"has-tool-tip more-button\"\n            @click=${() => {\n              this._toggleMenu();\n            }}\n          >\n            ${MoreIcon}\n            <tool-tip inert role=\"tooltip\">More</tool-tip>\n          </icon-button>\n        </div>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'bookmark-toolbar': BookmarkToolbar;\n  }\n}\n", "import '../../components/button.js';\nimport '../../components/portal.js';\nimport '../../components/button.js';\n\nimport { WithDisposable } from '@blocksuite/lit';\nimport { type BaseBlockModel } from '@blocksuite/store';\nimport { html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport type { BookmarkBlockModel } from '../bookmark-model.js';\nimport { CloseIcon } from '../images/icons.js';\n\nexport const bookmarkModalStyles = html`\n  <style>\n    .bookmark-modal-container {\n      position: fixed;\n      width: 100vw;\n      height: 100vh;\n      display: flex;\n    }\n    .bookmark-modal-mask {\n      position: absolute;\n      left: 0;\n      right: 0;\n      top: 0;\n      bottom: 0;\n      margin: auto;\n    }\n    .bookmark-modal-wrapper {\n      position: absolute;\n      left: 0;\n      right: 0;\n      top: 0;\n      bottom: 0;\n      margin: auto;\n\n      width: 360px;\n      height: 260px;\n      background: var(--affine-background-primary-color);\n      box-shadow: var(--affine-menu-shadow);\n      border-radius: var(--affine-popover-radius);\n      padding: 36px 40px 24px;\n    }\n    .bookmark-modal-close-button {\n      position: absolute;\n      right: 20px;\n      top: 12px;\n    }\n    .bookmark-modal-title {\n      font-size: var(--affine-font-h-6);\n      font-weight: 600;\n    }\n    .bookmark-modal-desc {\n      font-size: var(--affine-font-base);\n      margin-top: 20px;\n      caret-color: var(--affine-primary-color);\n    }\n    .bookmark-input {\n      width: 100%;\n      height: 32px;\n      font-size: var(--affine-font-base);\n      margin-top: 20px;\n      caret-color: var(--affine-primary-color);\n      transition: border-color 0.15s;\n\n      line-height: 22px;\n      padding: 8px 12px;\n      color: var(--affine-text-primary-color);\n      border: 1px solid;\n      border-color: var(--affine-border-color);\n      background-color: var(--affine-white);\n      border-radius: 10px;\n      outline: medium;\n    }\n    .bookmark-input:focus {\n      border-color: var(--affine-primary-color);\n    }\n\n    .bookmark-input::placeholder {\n      color: var(--affine-placeholder-color);\n      font-size: var(--affine-font-base);\n    }\n\n    .bookmark-modal-footer {\n      display: flex;\n      justify-content: flex-end;\n      margin-top: 40px;\n    }\n    .bookmark-confirm-button {\n      padding: 4px 20px;\n      height: 32px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      font-size: var(--affine-font-base);\n      background: var(--affine-primary-color);\n      color: var(--affine-white);\n      border-color: var(--affine-primary-color);\n      border-radius: 8px;\n      cursor: pointer;\n    }\n  </style>\n`;\n@customElement('bookmark-edit-modal')\nexport class BookmarkEditModal extends WithDisposable(LitElement) {\n  @property()\n  model!: BaseBlockModel<BookmarkBlockModel>;\n  @property()\n  onCancel?: () => void;\n  @property()\n  onConfirm?: () => void;\n\n  override get id() {\n    return `bookmark-modal-${this.model.id.split(':')[0]}`;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    document.addEventListener('keydown', this._modalKeyboardListener);\n    requestAnimationFrame(() => {\n      const titleInput = document.querySelector(\n        `#${this.id} input.title`\n      ) as HTMLInputElement;\n      titleInput.focus();\n      titleInput.setSelectionRange(0, titleInput.value.length);\n    });\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    document.removeEventListener('keydown', this._modalKeyboardListener);\n  }\n\n  private _modalKeyboardListener = (e: KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      this._onConfirm();\n    }\n    if (e.key === 'Escape') {\n      this.onCancel?.();\n    }\n  };\n\n  private _onConfirm() {\n    const titleInput = document.querySelector(\n      `#${this.id} input.title`\n    ) as HTMLInputElement;\n    const descInput = document.querySelector(\n      `#${this.id} input.description`\n    ) as HTMLInputElement;\n\n    this.model.page.updateBlock(this.model, {\n      title: titleInput.value,\n      description: descInput.value,\n    });\n    this.onConfirm?.();\n  }\n\n  override render() {\n    const modal = html`${bookmarkModalStyles}\n      <div class=\"bookmark-modal\" id=\"${this.id}\">\n        <div\n          class=\"bookmark-modal-mask\"\n          @click=${() => {\n            this.onCancel?.();\n          }}\n        ></div>\n        <div class=\"bookmark-modal-wrapper\">\n          <icon-button\n            width=\"32px\"\n            height=\"32px\"\n            class=\"bookmark-modal-close-button\"\n            @click=${() => {\n              this.onCancel?.();\n            }}\n            >${CloseIcon}</icon-button\n          >\n\n          <div class=\"bookmark-modal-title\">Edit</div>\n          <input\n            type=\"text\"\n            class=\"bookmark-input title\"\n            placeholder=\"Title\"\n            value=${this.model.title || 'Bookmark'}\n            tabindex=\"1\"\n          />\n          <input\n            type=\"text\"\n            class=\"bookmark-input description\"\n            placeholder=\"Description\"\n            value=${this.model.description || this.model.url}\n            tabindex=\"2\"\n          />\n          <div class=\"bookmark-modal-footer\">\n            <div\n              class=\"bookmark-confirm-button\"\n              tabindex=\"3\"\n              @click=${() => {\n                this._onConfirm();\n              }}\n            >\n              Save\n            </div>\n          </div>\n        </div>\n      </div>`;\n    return html`<affine-portal .template=${modal}></affine-portal>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'bookmark-edit-modal': BookmarkEditModal;\n  }\n}\n", "import '../../components/button.js';\nimport '../../components/portal.js';\nimport '../../components/button.js';\n\nimport { WithDisposable } from '@blocksuite/lit';\nimport { type BaseBlockModel } from '@blocksuite/store';\nimport { html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport { toast } from '../..//components/toast.js';\nimport type { BookmarkBlockModel } from '../bookmark-model.js';\nimport { CloseIcon } from '../images/icons.js';\nimport { bookmarkModalStyles } from './bookmark-edit-modal.js';\n\n@customElement('bookmark-create-modal')\nexport class BookmarkCreateModal extends WithDisposable(LitElement) {\n  @property()\n  model!: BaseBlockModel<BookmarkBlockModel>;\n\n  @property()\n  onCancel?: () => void;\n\n  @property()\n  onConfirm?: () => void;\n\n  override get id() {\n    return `bookmark-create-modal-${this.model.id.split(':')[0]}`;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    requestAnimationFrame(() => {\n      const linkInput = document.querySelector(\n        `#${this.id} input.link`\n      ) as HTMLInputElement;\n      linkInput.focus();\n    });\n\n    document.addEventListener('keydown', this._modalKeyboardListener);\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    document.removeEventListener('keydown', this._modalKeyboardListener);\n  }\n\n  private _modalKeyboardListener = (e: KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      this._onConfirm();\n    }\n    if (e.key === 'Escape') {\n      this.onCancel?.();\n    }\n  };\n\n  private _onConfirm() {\n    const linkInput = document.querySelector(\n      `#${this.id} input.link`\n    ) as HTMLInputElement;\n\n    if (!linkInput.value) {\n      toast('Bookmark url can not be empty');\n      return;\n    }\n\n    this.model.page.updateBlock(this.model, {\n      url: linkInput.value,\n    });\n    this.onConfirm?.();\n  }\n\n  override render() {\n    const modal = html`${bookmarkModalStyles}\n      <div class=\"bookmark-modal\" id=\"${this.id}\">\n        <div\n          class=\"bookmark-modal-mask\"\n          @click=${() => {\n            this.onCancel?.();\n            this.model.page.deleteBlock(this.model);\n          }}\n        ></div>\n        <div class=\"bookmark-modal-wrapper\" style=\"width:480px\">\n          <icon-button\n            width=\"32px\"\n            height=\"32px\"\n            class=\"bookmark-modal-close-button\"\n            @click=${() => {\n              this.onCancel?.();\n              this.model.page.deleteBlock(this.model);\n            }}\n            >${CloseIcon}</icon-button\n          >\n\n          <div class=\"bookmark-modal-title\">Bookmark</div>\n          <div class=\"bookmark-modal-desc\">\n            Create a Bookmark that previews a link in card view.\n          </div>\n          <input\n            tabindex=\"1\"\n            type=\"text\"\n            class=\"bookmark-input link\"\n            placeholder=\"Input in https://...\"\n          />\n\n          <div class=\"bookmark-modal-footer\">\n            <div\n              tabindex=\"2\"\n              class=\"bookmark-confirm-button\"\n              @click=${() => this._onConfirm()}\n            >\n              Confirm\n            </div>\n          </div>\n        </div>\n      </div>`;\n    return html`<affine-portal .template=${modal}></affine-portal>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'bookmark-create-modal': BookmarkCreateModal;\n  }\n}\n", "import { css, html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\n@customElement('bookmark-loader')\nexport class Loader extends LitElement {\n  static override styles = css`\n    .bookmark-loader-wrapper {\n      display: flex;\n      width: var(--loader-size);\n      height: var(--loader-size);\n    }\n    .bookmark-loader {\n      width: var(--loader-size);\n      animation: loading 3s linear infinite;\n    }\n    .bookmark-loader-block {\n      animation: loading-circle 2s linear infinite;\n      stroke-dashoffset: 0;\n      stroke-dasharray: 300;\n      stroke-width: 15;\n      stroke-miterlimit: 10;\n      stroke-linecap: round;\n      stroke: var(--loader-color);\n      fill: transparent;\n    }\n\n    @keyframes loading {\n      0% {\n        transform: rotate(0);\n      }\n      100% {\n        transform: rotate(360deg);\n      }\n    }\n    @keyframes loading-circle {\n      0% {\n        stroke-dashoffset: 0;\n      }\n      100% {\n        stroke-dashoffset: -600;\n      }\n    }\n  `;\n\n  @property()\n  size: string | number = '50px';\n\n  @property()\n  color = 'blue';\n\n  override firstUpdated() {\n    this.updateComplete.then(() => {\n      const { size, color } = this;\n\n      this.style.setProperty(\n        '--loader-size',\n        typeof size === 'string' ? size : `${size}px`\n      );\n      this.style.setProperty('--loader-color', color);\n    });\n  }\n\n  override render() {\n    return html`<div class=\"bookmark-loader-wrapper\">\n      <svg class=\"bookmark-loader\" x=\"0px\" y=\"0px\" viewBox=\"0 0 150 150\">\n        <circle class=\"bookmark-loader-block\" cx=\"75\" cy=\"75\" r=\"60\" />\n      </svg>\n    </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'bookmark-loader': Loader;\n  }\n}\n", "import type {\n  BlockTransformContext,\n  SerializedBlock,\n} from '../__internal__/index.js';\nimport { BaseService } from '../__internal__/service/index.js';\nimport type { BookmarkBlockModel } from './bookmark-model.js';\nimport { cloneBookmarkProperties } from './utils.js';\n\nexport class BookmarkBlockService extends BaseService<BookmarkBlockModel> {\n  override block2html(\n    block: BookmarkBlockModel,\n    { childText = '', begin, end }: BlockTransformContext = {}\n  ) {\n    return block.url;\n  }\n  override block2Text(\n    block: BookmarkBlockModel,\n    { childText = '', begin = 0, end }: BlockTransformContext = {}\n  ): string {\n    return block.url;\n  }\n\n  override block2Json(\n    block: BookmarkBlockModel,\n    begin?: number,\n    end?: number\n  ): SerializedBlock {\n    const clonedProps = cloneBookmarkProperties(block);\n\n    return {\n      flavour: block.flavour,\n      children: [],\n      ...clonedProps,\n    };\n  }\n}\n", "import { html } from 'lit';\n\nexport const DefaultBanner = html`<svg\n  width=\"140\"\n  height=\"96\"\n  viewBox=\"0 0 140 96\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_3433_80247)\">\n    <g opacity=\"0.4\">\n      <g clip-path=\"url(#clip1_3433_80247)\">\n        <g clip-path=\"url(#clip2_3433_80247)\">\n          <g opacity=\"0.8\" filter=\"url(#filter0_f_3433_80247)\">\n            <ellipse\n              cx=\"45.5713\"\n              cy=\"61.2938\"\n              rx=\"45.5713\"\n              ry=\"61.2938\"\n              transform=\"matrix(-0.275152 -0.961401 0.994111 -0.108365 23.6692 80.3025)\"\n              fill=\"#5076FF\"\n            />\n          </g>\n          <g opacity=\"0.8\" filter=\"url(#filter1_f_3433_80247)\">\n            <ellipse\n              cx=\"49.6555\"\n              cy=\"50.1114\"\n              rx=\"49.6555\"\n              ry=\"50.1114\"\n              transform=\"matrix(-0.517539 -0.855659 0.945307 -0.326182 10.3975 87.9766)\"\n              fill=\"#77FFCE\"\n            />\n          </g>\n          <g opacity=\"0.8\" filter=\"url(#filter2_f_3433_80247)\">\n            <path\n              d=\"M141.154 3.03247C167.539 22.8936 134.54 99.5878 124.212 92.7915C117.912 88.6456 113.733 60.4772 94.173 45.9086C81.6691 36.5955 56.6586 38.5939 41.1056 37.1878C1.22291 33.5821 114.548 -16.9943 141.154 3.03247Z\"\n              fill=\"#35B7E0\"\n            />\n          </g>\n          <path\n            d=\"M78.5971 45.1263C77.9794 49.5216 81.121 53.5957 85.6131 54.2271C90.1053 54.8584 94.2481 51.808 94.8658 47.4128C95.4835 43.0175 92.342 38.9434 87.8498 38.312C83.3577 37.6807 79.2149 40.7311 78.5971 45.1263Z\"\n            fill=\"url(#paint0_linear_3433_80247)\"\n          />\n          <path\n            d=\"M120.378 78.3637L119.989 81.1303C119.731 82.9654 119.562 84.15 119.36 85.0413C119.166 85.8959 118.999 86.1992 118.895 86.3451C118.499 86.9002 117.932 87.3171 117.277 87.5363C117.105 87.5938 116.76 87.6677 115.867 87.6141C114.934 87.5582 113.723 87.3905 111.847 87.1268L80.6109 82.7369C78.735 82.4733 77.524 82.3006 76.6125 82.0973C75.7385 81.9024 75.4276 81.7365 75.278 81.6337C74.7087 81.2424 74.2794 80.6856 74.0516 80.0428C73.9917 79.8739 73.9142 79.5361 73.9635 78.6612C74.0149 77.7488 74.1789 76.5635 74.4369 74.7283L75.6584 66.0369C75.8058 65.9369 75.9505 65.8411 76.0924 65.7498C77.1899 65.0437 78.3629 64.4423 79.7464 64.1873C81.8083 63.8072 83.9443 64.0829 85.8427 64.9742C87.1166 65.5723 88.0991 66.452 88.9822 67.4137C89.5619 68.0451 90.1807 68.8058 90.8604 69.6691L94.5285 66.9912C95.9295 65.9684 97.1371 65.0867 98.1922 64.4415C99.3051 63.761 100.491 63.1868 101.879 62.9626C103.947 62.6286 106.075 62.9506 107.951 63.8817C109.21 64.5065 110.172 65.4058 111.033 66.385C111.033 66.385 117.277 74.3919 120.378 78.3637Z\"\n            fill=\"url(#paint1_linear_3433_80247)\"\n          />\n          <path\n            fill-rule=\"evenodd\"\n            clip-rule=\"evenodd\"\n            d=\"M18.0193 52.2289C18.1346 51.4086 18.8931 50.837 19.7134 50.9523L67.2463 57.6326C68.0667 57.7479 68.6382 58.5064 68.5229 59.3268C68.4076 60.1471 67.6491 60.7187 66.8288 60.6034L19.2959 53.9231C18.4755 53.8078 17.904 53.0493 18.0193 52.2289Z\"\n            fill=\"white\"\n            fill-opacity=\"0.8\"\n          />\n          <path\n            fill-rule=\"evenodd\"\n            clip-rule=\"evenodd\"\n            d=\"M21.5681 26.9771C21.7218 25.8833 22.7332 25.1212 23.827 25.2749L47.5934 28.6151C48.6872 28.7688 49.4493 29.7801 49.2956 30.874C49.1419 31.9678 48.1305 32.7299 47.0367 32.5762L23.2703 29.236C22.1765 29.0823 21.4144 28.0709 21.5681 26.9771Z\"\n            fill=\"white\"\n            fill-opacity=\"0.8\"\n          />\n          <path\n            fill-rule=\"evenodd\"\n            clip-rule=\"evenodd\"\n            d=\"M19.55 41.336C19.6653 40.5156 20.4238 39.9441 21.2442 40.0593L68.7771 46.7397C69.5974 46.8549 70.169 47.6135 70.0537 48.4338C69.9384 49.2542 69.1799 49.8258 68.3595 49.7105L20.8267 43.0301C20.0063 42.9149 19.4347 42.1564 19.55 41.336Z\"\n            fill=\"white\"\n            fill-opacity=\"0.8\"\n          />\n          <path\n            fill-rule=\"evenodd\"\n            clip-rule=\"evenodd\"\n            d=\"M16.4883 63.1219C16.6036 62.3015 17.3621 61.7299 18.1824 61.8452L65.7153 68.5255C66.5357 68.6408 67.1072 69.3993 66.9919 70.2197C66.8766 71.0401 66.1181 71.6116 65.2978 71.4963L17.7649 64.816C16.9445 64.7007 16.373 63.9422 16.4883 63.1219Z\"\n            fill=\"white\"\n            fill-opacity=\"0.8\"\n          />\n          <path\n            fill-rule=\"evenodd\"\n            clip-rule=\"evenodd\"\n            d=\"M15.2358 72.0344C15.3511 71.214 16.1096 70.6424 16.93 70.7577L64.4628 77.438C65.2832 77.5533 65.8548 78.3118 65.7395 79.1322C65.6242 79.9525 64.8657 80.5241 64.0453 80.4088L16.5125 73.7285C15.6921 73.6132 15.1205 72.8547 15.2358 72.0344Z\"\n            fill=\"white\"\n            fill-opacity=\"0.4\"\n          />\n        </g>\n      </g>\n    </g>\n  </g>\n  <defs>\n    <filter\n      id=\"filter0_f_3433_80247\"\n      x=\"-14.1589\"\n      y=\"-38.4709\"\n      width=\"172.444\"\n      height=\"136.638\"\n      filterUnits=\"userSpaceOnUse\"\n      color-interpolation-filters=\"sRGB\"\n    >\n      <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n      <feBlend\n        mode=\"normal\"\n        in=\"SourceGraphic\"\n        in2=\"BackgroundImageFix\"\n        result=\"shape\"\n      />\n      <feGaussianBlur\n        stdDeviation=\"12\"\n        result=\"effect1_foregroundBlur_3433_80247\"\n      />\n    </filter>\n    <filter\n      id=\"filter1_f_3433_80247\"\n      x=\"-45.8333\"\n      y=\"-40.3932\"\n      width=\"155.805\"\n      height=\"139.072\"\n      filterUnits=\"userSpaceOnUse\"\n      color-interpolation-filters=\"sRGB\"\n    >\n      <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n      <feBlend\n        mode=\"normal\"\n        in=\"SourceGraphic\"\n        in2=\"BackgroundImageFix\"\n        result=\"shape\"\n      />\n      <feGaussianBlur\n        stdDeviation=\"12\"\n        result=\"effect1_foregroundBlur_3433_80247\"\n      />\n    </filter>\n    <filter\n      id=\"filter2_f_3433_80247\"\n      x=\"8.68726\"\n      y=\"-25.6425\"\n      width=\"166.468\"\n      height=\"142.859\"\n      filterUnits=\"userSpaceOnUse\"\n      color-interpolation-filters=\"sRGB\"\n    >\n      <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n      <feBlend\n        mode=\"normal\"\n        in=\"SourceGraphic\"\n        in2=\"BackgroundImageFix\"\n        result=\"shape\"\n      />\n      <feGaussianBlur\n        stdDeviation=\"12\"\n        result=\"effect1_foregroundBlur_3433_80247\"\n      />\n    </filter>\n    <linearGradient\n      id=\"paint0_linear_3433_80247\"\n      x1=\"102.492\"\n      y1=\"40.3698\"\n      x2=\"96.2289\"\n      y2=\"84.9319\"\n      gradientUnits=\"userSpaceOnUse\"\n    >\n      <stop offset=\"0.578125\" stop-color=\"white\" />\n      <stop offset=\"1\" stop-color=\"white\" stop-opacity=\"0\" />\n    </linearGradient>\n    <linearGradient\n      id=\"paint1_linear_3433_80247\"\n      x1=\"102.492\"\n      y1=\"40.3698\"\n      x2=\"96.2289\"\n      y2=\"84.9319\"\n      gradientUnits=\"userSpaceOnUse\"\n    >\n      <stop offset=\"0.578125\" stop-color=\"white\" />\n      <stop offset=\"1\" stop-color=\"white\" stop-opacity=\"0\" />\n    </linearGradient>\n    <clipPath id=\"clip0_3433_80247\">\n      <rect width=\"140\" height=\"96\" fill=\"white\" />\n    </clipPath>\n    <clipPath id=\"clip1_3433_80247\">\n      <rect\n        x=\"11.7563\"\n        y=\"3.38196\"\n        width=\"130\"\n        height=\"88\"\n        rx=\"4\"\n        transform=\"rotate(8 11.7563 3.38196)\"\n        fill=\"white\"\n      />\n    </clipPath>\n    <clipPath id=\"clip2_3433_80247\">\n      <rect\n        width=\"130\"\n        height=\"88\"\n        fill=\"white\"\n        transform=\"translate(11.7563 3.38196) rotate(8)\"\n      />\n    </clipPath>\n  </defs>\n</svg>`;\n", "import './components/bookmark-toolbar.js';\nimport './components/bookmark-edit-modal.js';\nimport './components/bookmark-create-modal.js';\nimport './components/loader.js';\n\nimport { BlockElement } from '@blocksuite/lit';\nimport { Slot } from '@blocksuite/store';\nimport { css, html, nothing } from 'lit';\nimport { customElement, query, state } from 'lit/decorators.js';\n\nimport { queryCurrentMode } from '../__internal__/index.js';\nimport { registerService } from '../__internal__/service.js';\nimport type { BookmarkBlockModel } from './bookmark-model.js';\nimport { BookmarkBlockService } from './bookmark-service.js';\nimport type { MenuActionCallback } from './components/bookmark-operation-popper.js';\nimport type { ToolbarActionCallback } from './components/bookmark-toolbar.js';\nimport { DefaultBanner } from './images/banners.js';\nimport {\n  DarkLoadingBanner,\n  DefaultIcon,\n  LoadingBanner,\n} from './images/icons.js';\nimport { reloadBookmarkBlock } from './utils.js';\n\n@customElement('affine-bookmark')\nexport class BookmarkBlockComponent extends BlockElement<BookmarkBlockModel> {\n  static override styles = css`\n    .affine-bookmark-block-container {\n      width: 100%;\n      margin-top: calc(var(--affine-paragraph-space) + 8px);\n      position: relative;\n    }\n    .affine-bookmark-link {\n      height: 112px;\n      box-shadow: var(--affine-shadow-1);\n      background: var(--affine-card-background-blue);\n      border: 3px solid var(--affine-background-secondary-color);\n      border-radius: 12px;\n      padding: 16px 24px;\n      display: flex;\n      cursor: pointer;\n      text-decoration: none;\n      color: var(--affine-text-primary-color);\n      overflow: hidden;\n      line-height: calc(1em + 4px);\n      position: relative;\n    }\n    .affine-bookmark-banner {\n      width: 140px;\n      height: 93px;\n      margin-left: 20px;\n      border-radius: 8px 8px 0 0;\n      overflow: hidden;\n      flex-shrink: 0;\n    }\n    .affine-bookmark-banner.shadow {\n      box-shadow: var(--affine-shadow-1);\n    }\n\n    .affine-bookmark-banner img,\n    .affine-bookmark-banner svg {\n      width: 140px;\n      height: 93px;\n      object-fit: cover;\n    }\n    .affine-bookmark-content-wrapper {\n      flex-grow: 1;\n      overflow: hidden;\n    }\n    .affine-bookmark-title {\n      height: 18px;\n      display: flex;\n      align-items: center;\n      font-size: var(--affine-font-sm);\n      font-weight: 600;\n    }\n    .affine-bookmark-title-content {\n      flex-grow: 1;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n      margin-left: 8px;\n    }\n    .affine-bookmark-icon {\n      width: 18px;\n      height: 18px;\n      color: var(--affine-text-secondary-color);\n      flex-shrink: 0;\n    }\n    .affine-bookmark-icon img {\n      width: 100%;\n      height: 100%;\n      object-fit: cover;\n    }\n    .affine-bookmark-description {\n      height: 32px;\n      line-height: 16px;\n      margin-top: 4px;\n      font-size: var(--affine-font-xs);\n\n      display: -webkit-box;\n      word-break: break-all;\n      -webkit-box-orient: vertical;\n      -webkit-line-clamp: 2;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n    .affine-bookmark-url {\n      font-size: var(--affine-font-xs);\n      color: var(--affine-text-secondary-color);\n      overflow: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n      margin-top: 2px;\n    }\n    .affine-bookmark-caption {\n      width: 100%;\n      font-size: var(--affine-font-sm);\n      outline: none;\n      border: 0;\n      font-family: inherit;\n      text-align: center;\n      color: var(--affine-icon-color);\n      display: none;\n      background: var(--affine-background-primary-color);\n    }\n    .affine-bookmark-caption::placeholder {\n      color: var(--affine-placeholder-color);\n    }\n    .affine-bookmark-caption.caption-show {\n      display: inline-block;\n    }\n    .affine-bookmark-loading {\n      width: 100%;\n      height: 112px;\n      padding: 16px 24px;\n      display: flex;\n      justify-content: space-between;\n      box-shadow: var(--affine-shadow-1);\n      background: var(--affine-hover-color);\n      border: 3px solid var(--affine-background-secondary-color);\n      color: var(--affine-placeholder-color);\n      border-radius: 12px;\n    }\n  `;\n\n  slots = {\n    openInitialModal: new Slot(),\n  };\n\n  @query('input.affine-bookmark-caption')\n  _input!: HTMLInputElement;\n\n  @state()\n  private _showCreateModal = false;\n\n  @state()\n  private _showToolbar = false;\n\n  @state()\n  private _showEditModal = false;\n\n  @state()\n  private _caption!: string;\n\n  @state()\n  private _isLoading = false;\n\n  private _timer: ReturnType<typeof setTimeout> | null = null;\n\n  set loading(value: boolean) {\n    this._isLoading = value;\n  }\n\n  get loading() {\n    return this._isLoading;\n  }\n\n  override firstUpdated() {\n    this.model.propsUpdated.on(() => this.requestUpdate());\n\n    this.updateComplete.then(() => {\n      this._caption = this.model?.caption ?? '';\n\n      if (this._caption) {\n        // Caption input should be toggled manually.\n        // However, it will be lost if the caption is deleted into empty state.\n        this._input.classList.add('caption-show');\n      }\n    });\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    registerService('affine:bookmark', BookmarkBlockService);\n    reloadBookmarkBlock(this.model, this);\n    this.slots.openInitialModal.on(() => {\n      this._showCreateModal = true;\n    });\n  }\n\n  private _onInputChange() {\n    this._caption = this._input.value;\n    this.model.page.updateBlock(this.model, { caption: this._caption });\n  }\n\n  private _onInputBlur() {\n    if (!this._caption) {\n      this._input.classList.remove('caption-show');\n    }\n  }\n\n  private _onHover() {\n    if (this._isLoading) return;\n\n    this._showToolbar = true;\n    this._timer && clearTimeout(this._timer);\n  }\n\n  private _onHoverOut() {\n    this._timer = setTimeout(() => {\n      this._showToolbar = false;\n    }, 100);\n  }\n\n  private _onToolbarSelected: ToolbarActionCallback & MenuActionCallback =\n    type => {\n      if (type === 'caption') {\n        this._input.classList.add('caption-show');\n        requestAnimationFrame(() => {\n          this._input.focus();\n        });\n      }\n\n      if (type === 'edit') {\n        this._showEditModal = true;\n      }\n\n      this._showToolbar = false;\n    };\n\n  override render() {\n    const { url, title, description, icon, image } = this.model;\n    const mode = queryCurrentMode();\n\n    const createModal = this._showCreateModal\n      ? html`<bookmark-create-modal\n          .model=${this.model}\n          .onCancel=${() => {\n            this._showCreateModal = false;\n          }}\n          .onConfirm=${() => {\n            reloadBookmarkBlock(this.model, this, true);\n            this._showCreateModal = false;\n          }}\n        ></bookmark-create-modal>`\n      : nothing;\n    const editModal = this._showEditModal\n      ? html`<bookmark-edit-modal\n          .model=${this.model}\n          .onCancel=${() => {\n            this._showEditModal = false;\n          }}\n          .onConfirm=${() => {\n            this._showEditModal = false;\n          }}\n        ></bookmark-edit-modal>`\n      : nothing;\n    const toolbar = this._showToolbar\n      ? html`<bookmark-toolbar\n          .model=${this.model}\n          .onSelected=${this._onToolbarSelected}\n        ></bookmark-toolbar>`\n      : nothing;\n\n    const loading = this._isLoading\n      ? html`<div\n          class=\"affine-bookmark-loading ${mode === 'light' ? '' : 'dark'}\"\n        >\n          <div class=\"affine-bookmark-title\">\n            <bookmark-loader\n              size=\"15px\"\n              color=\"var(--affine-primary-color)\"\n            ></bookmark-loader>\n            <div class=\"affine-bookmark-title-content\">Loading...</div>\n          </div>\n          <div class=\"affine-bookmark-banner\">\n            ${mode === 'light' ? LoadingBanner : DarkLoadingBanner}\n          </div>\n        </div>`\n      : nothing;\n\n    const linkCard = html`<a\n      href=\"${url}\"\n      target=\"_blank\"\n      class=\"affine-bookmark-link\"\n    >\n      <div class=\"affine-bookmark-content-wrapper\">\n        <div class=\"affine-bookmark-title\">\n          <div class=\"affine-bookmark-icon\">\n            ${icon ? html`<img src=\"${icon}\" alt=\"icon\" />` : DefaultIcon}\n          </div>\n          <div class=\"affine-bookmark-title-content\">\n            ${title || 'Bookmark'}\n          </div>\n        </div>\n\n        <div class=\"affine-bookmark-description\">${description || url}</div>\n        <div class=\"affine-bookmark-url\">${url}</div>\n      </div>\n      <div class=\"affine-bookmark-banner ${image ? 'shadow' : ''}\">\n        ${image ? html`<img src=\"${image}\" alt=\"image\" />` : DefaultBanner}\n      </div>\n    </a>`;\n\n    if (!url) {\n      return createModal;\n    }\n\n    return html`\n      ${editModal}\n      <div\n        class=\"affine-bookmark-block-container\"\n        @mouseover=\"${this._onHover}\"\n        @mouseout=\"${this._onHoverOut}\"\n      >\n        ${toolbar} ${this._isLoading ? loading : linkCard}\n        <input\n          .disabled=${this.model.page.readonly}\n          placeholder=\"Write a caption\"\n          class=\"affine-bookmark-caption\"\n          value=${this._caption}\n          @input=${this._onInputChange}\n          @blur=${this._onInputBlur}\n          @click=${(e: Event) => {\n            e.stopPropagation();\n          }}\n        />\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-bookmark': BookmarkBlockComponent;\n  }\n}\n", "import type { UnionToIntersection } from '@blocksuite/global/types';\n\nimport type { BaseService } from './__internal__/service/index.js';\nimport { BookmarkBlockService } from './bookmark-block/index.js';\nimport { CodeBlockService } from './code-block/index.js';\nimport { DatabaseBlockService } from './database-block/database-service.js';\nimport { DividerBlockService } from './divider-block/index.js';\nimport { EmbedBlockService } from './embed-block/index.js';\nimport { FrameBlockService } from './frame-block/index.js';\nimport { ListBlockService } from './list-block/index.js';\nimport type { Flavour } from './models.js';\nimport { ParagraphBlockService } from './paragraph-block/index.js';\n\nexport const blockService = {\n  'affine:code': CodeBlockService,\n  'affine:database': DatabaseBlockService,\n  'affine:paragraph': ParagraphBlockService,\n  'affine:list': ListBlockService,\n  'affine:embed': EmbedBlockService,\n  'affine:divider': DividerBlockService,\n  'affine:frame': FrameBlockService,\n  'affine:bookmark': BookmarkBlockService,\n} satisfies {\n  [key in Flavour]?: { new (): BaseService };\n};\n\nexport type BlockService = typeof blockService;\nexport type ServiceFlavour = keyof BlockService;\n\nexport type BlockServiceInstance = {\n  [Key in Flavour]: Key extends ServiceFlavour\n    ? BlockService[Key] extends { new (): unknown }\n      ? InstanceType<BlockService[Key]>\n      : never\n    : InstanceType<typeof BaseService>;\n};\n\nexport type BlockServiceInstanceByKey<Key extends Flavour> =\n  UnionToIntersection<BlockServiceInstance[Key]>;\n", "import type { Flavour } from '../models.js';\nimport type { BlockServiceInstanceByKey } from '../services.js';\nimport { type BlockService, blockService } from '../services.js';\nimport { BaseService } from './service/index.js';\n\nconst services = new Map<string, BaseService>();\n\nexport function hasService(flavour: string): boolean {\n  return services.has(flavour);\n}\n\nexport function registerService(\n  flavour: string,\n  Constructor: { new (): BaseService }\n): Promise<void> | void {\n  if (services.has(flavour)) {\n    return;\n  }\n  const service = new Constructor();\n  services.set(flavour, service);\n  return;\n}\n\n/**\n * @internal\n */\nexport function getService<Key extends Flavour>(\n  flavour: Key\n): BlockServiceInstanceByKey<Key>;\nexport function getService(flavour: string): BaseService;\nexport function getService(flavour: string): BaseService {\n  const service = services.get(flavour);\n  if (!service) {\n    throw new Error(`cannot find service by flavour ${flavour}`);\n  }\n  return service as BaseService;\n}\n\nexport function getServiceOrRegister<Key extends Flavour>(\n  flavour: Key\n): BlockServiceInstanceByKey<Key> | Promise<BlockServiceInstanceByKey<Key>>;\nexport function getServiceOrRegister(\n  flavour: string\n): BaseService | Promise<BaseService>;\nexport function getServiceOrRegister(\n  flavour: string\n): BaseService | Promise<BaseService> {\n  const service = services.get(flavour);\n  if (!service) {\n    const Constructor =\n      blockService[flavour as keyof BlockService] ?? BaseService;\n    const result = registerService(flavour, Constructor);\n    if (result instanceof Promise) {\n      return result.then(() => services.get(flavour) as BaseService);\n    } else {\n      return services.get(flavour) as BaseService;\n    }\n  }\n  return service as BaseService;\n}\n"],
  "mappings": "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BAAA,SAAS;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6BzBC,YAAA;EADC,SAAQ;;AAITA,YAAA;EADC,SAAQ;;AAITA,YAAA;EADC,SAAQ;;AAITA,YAAA;EADC,SAAQ;;AAITA,YAAA;EADC,SAAQ;;AAIDA,YAAA;EADP,MAAK;;AAIEA,YAAA;EADP,MAAM,oBAAoB;;AAGnBA,YAAA;EADP,MAAM,mCAAmC;;AAMlCA,YAAA;EADP,MAAM,oBAAoB;;AAGnBA,YAAA;EADP,MAAM,mCAAmC;;AAxD/B,2BAAwBA,YAAA;EADpC,cAAc,6BAA6B;GAC/B,wBAAwB;;;ACjD9B,IAAM,kBAAkB;EAC7B;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;AAGK,IAAM,iBAAiB;EAC5B;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;AAGK,IAAM,wBAAwB;EACnC;EACA;EACA;;AAGK,IAAM,YAAY;EACvB;EAEA;EACA;;EAEA;EAEA;EACA;EACA;EACA;EACA;EACA;EAEA;EACA;EACA;EACA;EACA,GAAG;EACH,GAAG;EACH,GAAG;;AAWC,SAAU,cAAc,MAAY;AACxC,SAAO,UAAU,SAAS,IAAuB;AACnD;;;;;;;;;;;;;AC9HA,IAAa,oBAAb,MAAaC,2BAA0B,eAAe,iBAAiB,EAAC;EAAxE,cAAA;;AAIU,SAAA,WAA2B;AAE3B,SAAA,WAA+B;AAC/B,SAAA,YAA+C;AAC/C,SAAA,WAAW;EAmHrB;EAjHE,IAA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AAI,EAAE,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,IAAI,IAAI,EAAE,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,IAAI,IAAI,EAAE,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,IAAI,IAAI,EAAE,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,IAAI,IAAI,EAAE,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,IAAI,IAAI,EAAE,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,IAAI,IAAI,EAAE,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,IAAI,IAAI,EAAE,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,IAAI,IAAI,EAAE,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,IAAI,IAAI,EAAE,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,GAAG,IAAI;AAC5C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;AAC3C,EAAAA,gBAAeA,gBAAe,GAAG,IAAI,EAAE,IAAI;A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",
  "names": ["t", "n", "e", "r", "i", "o", "a", "s", "f", "u", "c", "z", "root", "factory", "exports", "module", "define", "amd", "this", "e", "t", "Object", "defineProperty", "value", "UseOnigurumaFindOptions", "DebugFlags", "InDebugMode", "process", "env", "EncodedTokenAttributes", "toOptionalTokenType", "toBinaryStr", "encodedTokenAttributes", "r", "toString", "length", "print", "languageId", "getLanguageId", "tokenType", "getTokenType", "fontStyle", "getFontStyle", "foreground", "getForeground", "background", "getBackground", "console", "log", "containsBalancedBrackets", "set", "_languageId", "_tokenType", "_containsBalancedBracketsBit", "_fontStyle", "_foreground", "_background", "standardType", "BasicScopeAttributesProvider", "BasicScopeAttributes", "utils_1", "constructor", "initialLanguageId", "embeddedLanguages", "_getBasicScopeAttributes", "CachedFn", "scopeName", "_scopeToLanguage", "standardTokenType", "_toStandardTokenType", "_defaultAttributes", "_embeddedLanguagesMatcher", "ScopeMatcher", "entries", "getDefaultAttributes", "getBasicScopeAttributes", "_NULL_SCOPE_METADATA", "get", "scope", "match", "m", "STANDARD_TOKEN_TYPE_REGEXP", "Error", "values", "scopesRegExp", "Map", "escapedScopes", "map", "escapeRegExpCharacters", "sort", "reverse", "RegExp", "join", "LineTokens", "BalancedBracketSelectors", "StateStack", "AttributedScopeStack", "Grammar", "createGrammar", "debug_1", "encodedTokenAttributes_1", "matcher_1", "onigLib_1", "rule_1", "theme_1", "basicScopesAttributeProvider_1", "tokenizeString_1", "collectInjections", "result", "selector", "rule", "ruleFactoryHelper", "grammar", "matchers", "createMatchers", "nameMatcher", "ruleId", "RuleFactory", "getCompiledRuleId", "repository", "matcher", "push", "debugSelector", "priority", "identifers", "scopes", "lastIndex", "every", "identifier", "i", "scopesAreMatching", "thisScopeName", "len", "substr", "initialLanguage", "tokenTypes", "balancedBracketSelectors", "grammarRepository", "onigLib", "_rootScopeName", "_onigLib", "_basicScopeAttributesProvider", "_rootId", "_lastRuleId", "_ruleId2desc", "_includedGrammars", "_grammarRepository", "_grammar", "initGrammar", "_injections", "_tokenTypeMatchers", "keys", "type", "themeProvider", "dispose", "createOnigScanner", "sources", "createOnigString", "getMetadataForScope", "_collectInjections", "getExternalGrammar", "rawInjections", "injections", "expression", "injectionScopeNames", "forEach", "injectionScopeName", "injectionGrammar", "injectionSelector", "i1", "i2", "getInjections", "injection", "registerRule", "id", "ruleIdFromNumber", "getRule", "ruleIdToNumber", "rawIncludedGrammar", "lookup", "$base", "tokenizeLine", "lineText", "prevState", "timeLimit", "_tokenize", "tokens", "lineTokens", "getResult", "ruleStack", "lineLength", "stoppedEarly", "tokenizeLine2", "getBinaryResult", "emitBinaryTokens", "isFirstLine", "$self", "NULL", "reset", "rawDefaultMetadata", "defaultStyle", "getDefaults", "defaultMetadata", "foregroundId", "backgroundId", "rootScopeName", "getName", "scopeList", "createRootAndLookUpScopeName", "createRoot", "onigLineText", "content", "_tokenizeString", "disposeOnigString", "stack", "base", "clone", "$vscodeTextmateLocation", "patterns", "name", "parent", "scopePath", "tokenAttributes", "static", "ScopeStack", "rawRootMetadata", "rootStyle", "themeMatch", "resolvedTokenAttributes", "mergeAttributes", "equals", "other", "_equals", "a", "b", "existingTokenAttributes", "basicScopeAttributes", "styleAttributes", "pushAttributed", "indexOf", "_pushAttributed", "split", "target", "rawMetadata", "newPath", "scopeThemeMatchResult", "metadata", "getScopeNames", "getSegments", "enterPos", "anchorPos", "beginRuleCapturedEOL", "endRule", "nameScopesList", "contentNameScopesList", "_stackElementBrand", "depth", "_enterPos", "_anchorPos", "_structuralEquals", "el", "_reset", "pop", "safePop", "getEnterPos", "getAnchorPos", "_writeString", "res", "outIndex", "withContentNameScopesList", "contentNameScopeStack", "withEndRule", "hasSameRuleAs", "balancedBracketScopes", "unbalancedBracketScopes", "allowAny", "flatMap", "matchesAlways", "matchesNever", "excluder", "includer", "tokenTypeOverrides", "_emitBinaryTokens", "_tokenTypeOverrides", "_lineText", "_tokens", "_binaryTokens", "_lastTokenEndIndex", "produce", "endIndex", "produceFromScopes", "scopesList", "substring", "replace", "k", "startIndex", "Uint32Array", "parseInclude", "TopLevelRepositoryReference", "TopLevelReference", "RelativeReference", "SelfReference", "BaseReference", "ScopeDependencyProcessor", "ExternalReferenceCollector", "TopLevelRepositoryRuleReference", "TopLevelRuleReference", "toKey", "ruleName", "_references", "_seenReferenceKeys", "Set", "visitedRule", "references", "add", "reference", "key", "has", "collectReferencesOfReference", "baseGrammarScopeName", "repo", "selfGrammar", "baseGrammar", "collectExternalReferencesInTopLevelRule", "collectExternalReferencesInTopLevelRepositoryRule", "context", "collectExternalReferencesInRules", "Array", "isArray", "rules", "patternRepository", "mergeObjects", "include", "kind", "newContext", "initialScopeName", "seenFullScopeRequests", "seenPartialScopeRequests", "Q", "processQueue", "q", "deps", "dep", "indexOfSharp", "__createBinding", "create", "o", "k2", "enumerable", "__exportStar", "p", "prototype", "hasOwnProperty", "call", "LocalStackElement", "TokenizeStringResult", "linePos", "checkWhileConditions", "STOP", "anchorPosition", "whileCheckResult", "whileRules", "node", "nodeRule", "BeginWhileRule", "whileRule", "ruleScanner", "findOptions", "prepareRuleWhileSearch", "findNextMatchSync", "debugName", "debugWhileRegExp", "whileRuleId", "captureIndices", "start", "handleCaptures", "whileCaptures", "end", "startTime", "Date", "now", "scanNext", "matchResult", "prepareRuleSearch", "perfStart", "performanceNow", "elapsedMillis", "warn", "matchedRuleId", "injectionResult", "bestMatchRuleId", "bestMatchRating", "Number", "MAX_VALUE", "bestMatchCaptureIndices", "bestMatchResultPriority", "matchRating", "priorityMatch", "matchResultScore", "injectionResultScore", "hasAdvanced", "endRuleId", "poppedRule", "debugEndRegExp", "endCaptures", "popped", "error", "_rule", "beforePush", "BeginEndRule", "pushedRule", "debugBeginRegExp", "beginCaptures", "contentName", "getContentName", "endHasBackReferences", "getEndWithResolvedBackReferences", "whileHasBackReferences", "getWhileWithResolvedBackReferences", "matchingRule", "debugMatchRegExp", "captures", "endRegexSource", "allowA", "allowG", "compile", "getFindOptions", "compileAG", "compileWhile", "compileWhileAG", "options", "lineTextContent", "Math", "min", "localStack", "maxEnd", "captureRule", "captureIndex", "endPos", "retokenizeCapturedWithRuleId", "stackClone", "onigSubStr", "captureRuleScopeName", "captureRuleScopesList", "doFail", "streamState", "msg", "pos", "source", "parseJSON", "filename", "withMetadata", "JSONStreamState", "token", "JSONToken", "state", "cur", "stateStack", "objStack", "pushState", "popState", "fail", "nextJSONToken", "toLocation", "keyValue", "parseFloat", "newArr", "newDict", "line", "char", "offset", "_state", "_out", "chCode", "charCodeAt", "_", "m0", "String", "fromCodePoint", "parseInt", "parseRawGrammar", "INITIAL", "Registry", "grammar_1", "grammarReader", "registry_1", "grammarDependencies_1", "_options", "_syncRegistry", "SyncRegistry", "Theme", "createFromRawTheme", "theme", "colorMap", "_ensureGrammarCache", "setTheme", "getColorMap", "loadGrammarWithEmbeddedLanguages", "loadGrammarWithConfiguration", "configuration", "_loadGrammar", "unbalancedBracketSelectors", "loadGrammar", "async", "dependencyProcessor", "Promise", "all", "request", "_loadSingleGrammar", "_grammarForScopeName", "_doLoadSingleGrammar", "addGrammar", "rawGrammar", "grammarForScopeName", "isIdentifier", "matchesName", "results", "tokenizer", "input", "regex", "exec", "next", "charAt", "parseConjunction", "parseOperand", "expressionToNegate", "matcherInput", "expressionInParents", "some", "parseInnerExpression", "identifiers", "str", "plist", "json_1", "filePath", "test", "contents", "JSON", "parse", "parseWithLocation", "parsePLIST", "_parse", "locationKeyName", "advancePosBy", "by", "advancePosTo", "to", "skipWhitespace", "advanceIfStartsWith", "advanceUntil", "nextOccurence", "captureUntil", "curKey", "newState", "newCur", "dictState", "arrState", "leaveDict", "leaveArray", "acceptString", "val", "acceptReal", "isNaN", "acceptInteger", "acceptDate", "acceptData", "acceptBool", "parseOpenTag", "isClosed", "trim", "parseTagValue", "tag", "peekChCode", "_onigLibPromise", "_grammars", "_rawGrammars", "_injectionGrammars", "_theme", "targetScope", "CompiledRule", "RegExpSourceList", "RegExpSource", "IncludeOnlyRule", "MatchRule", "CaptureRule", "Rule", "HAS_BACK_REFERENCES", "BACK_REFERENCING_END", "Symbol", "$location", "_name", "_nameIsCapturing", "RegexSource", "hasCaptures", "_contentName", "_contentNameIsCapturing", "location", "basename", "replaceCaptures", "super", "collectPatterns", "out", "_match", "_cachedCompiledPatterns", "_getCachedCompiledPatterns", "hasMissingPatterns", "pattern", "begin", "applyEndPatternLast", "_begin", "_end", "hasBackReferences", "resolveBackReferences", "unshift", "setSource", "_while", "_cachedCompiledWhilePatterns", "_getCachedCompiledWhilePatterns", "helper", "desc", "_compileCaptures", "_compilePatterns", "while", "maximumCaptureId", "captureId", "numericCaptureId", "createCaptureRule", "localIncludedRule", "externalGrammarName", "externalGrammarInclude", "externalGrammar", "externalIncludedRule", "skipRule", "regExpSource", "lastPushedPos", "output", "hasAnchor", "nextCh", "_anchorCache", "_buildAnchorCache", "newSource", "capturedValues", "capture", "g1", "ch", "A0_G0_result", "A0_G1_result", "A1_G0_result", "A1_G1_result", "A0_G0", "A0_G1", "A1_G0", "A1_G1", "resolveAnchors", "_items", "_hasAnchors", "_cached", "_disposeCaches", "item", "index", "regExps", "_resolveAnchors", "scanner", "string", "startPosition", "ThemeTrieElement", "ThemeTrieElementRule", "ColorMap", "fontStyleToString", "ParsedThemeRule", "parseTheme", "StyleAttributes", "_colorMap", "_defaults", "_root", "_cachedMatchRoot", "createFromParsedTheme", "parsedThemeRules", "strcmp", "strArrCmp", "parentScopes", "defaultFontStyle", "defaultForeground", "defaultBackground", "incomingDefaults", "shift", "defaults", "getId", "insert", "effectiveRule", "find", "v", "scopePattern", "_matchesScope", "segments", "startsWith", "settings", "resultLen", "entry", "_scope", "j", "lenJ", "isValidHexColor", "slice", "style", "_lastColorId", "_id2color", "_color2id", "_isFrozen", "color", "toUpperCase", "scopeDepth", "arr", "acceptOverwrite", "_mainRule", "rulesWithParentScopes", "_children", "_rulesWithParentScopes", "_cmpBySpecificity", "aParentScopes", "bParentScopes", "aParentScopesLen", "bParentScopesLen", "aLen", "bLen", "_sortBySpecificity", "concat", "head", "tail", "dotIndex", "_doInsertHere", "child", "cloneArr", "doClone", "something", "obj", "path", "idx", "lastIndexOf", "CAPTURING_REGEX_SOURCE", "regexSource", "captureSource", "commandIndex", "command", "toLowerCase", "len1", "len2", "hex", "fn", "cache", "performance", "__webpack_module_cache__", "__webpack_require__", "moduleId", "cachedModule", "__webpack_modules__", "e", "t", "r", "c", "n", "i", "s", "z", "a", "o", "h", "u", "l", "f", "d", "p", "m", "IconButton", "styles", "__decorate", "html", "svg", "state", "state", "root", "BlockSuiteRoot", "html", "root", "__decorate", "PageIcon", "DeleteIcon", "EditIcon", "LinkIcon", "CopyIcon", "CaptionIcon", "DuplicateIcon", "CloseIcon", "read", "isElement", "state", "name", "style", "property", "isElement", "contains", "next", "isElement", "isFirefox", "css", "window", "min", "max", "toPaddingObject", "state", "options", "popperOffsets", "len", "min", "max", "offset", "effect", "contains", "dpr", "popper", "state", "options", "effect", "state", "options", "window", "hash", "html", "html", "isElement", "clippingParents", "contains", "reference", "len", "state", "options", "isElement", "popperOffsets", "offset", "state", "options", "placements", "placement", "state", "options", "placements", "placement", "len", "_loop", "_i", "checks", "state", "offset", "distance", "state", "options", "state", "state", "options", "popperOffsets", "len", "offset", "min", "max", "_offset", "debounce", "fn", "merged", "defaultModifiers", "createPopper", "reference", "popper", "options", "state", "setOptions", "isElement", "fn", "debounce", "effect", "noopFn", "createPopper", "defaultModifiers", "createPopper", "html", "styles", "options", "StrokeStyle", "ConnectorMode", "isEqual", "px", "min", "points", "options", "start", "end", "distance", "offset", "points", "options", "_a", "max", "isEqual", "distance", "points", "options", "_a", "startNode", "startOffset", "endNode", "endOffset", "range", "offset", "_a", "distanceToTop", "distanceToBottom", "before", "next", "top", "options", "code", "getKey", "getModifier", "eachUnbind", "len", "hotkey", "options", "fn", "start", "end", "len", "start", "end", "len", "compare", "start", "end", "order", "BacklinkButton", "__decorate", "FormatBarButton", "__decorate", "offset", "popper", "reference", "end", "length", "start", "end", "points", "cache", "points", "points", "points", "points", "min", "points", "len", "points", "start", "end", "EdgelessAlignPanel", "__decorate", "EdgelessColorPanel", "__decorate", "viewport", "reference", "popper", "createPopper", "options", "hide", "max", "EdgelessChangeTextButton", "_a", "__decorate", "SurfaceTextEditor", "_a", "viewport", "__decorate", "isPointIn", "block", "contains", "viewport", "filter", "_a", "distance", "start", "end", "random", "options", "svg", "html", "process", "options", "options", "dataURL", "_a", "clone", "use", "svg", "options", "css", "options", "_a", "options", "cache", "options", "matches", "inline", "rules", "options", "svg", "options", "html", "resolveUrl", "noopTest", "offset", "lexer", "options", "top", "line", "start", "text", "mangle", "smartypants", "rules", "next", "code", "parser", "src", "args", "ret", "walkTokens", "CLIPBOARD_MIMETYPE", "html", "repeat", "options", "start", "code", "reference", "matches", "filter", "fn", "rules", "isBlock", "isVoid", "node", "next", "Parser", "root", "Node", "defaults", "process", "escape", "self", "start", "end", "length", "options", "string", "join", "groupBy", "len", "value", "start", "end", "code", "CharacterCodes", "ParseOptions", "options", "offset", "length", "onError", "ScanError", "SyntaxKind", "ParseErrorCode", "join", "_a", "options", "len", "line", "offset", "code", "parser", "groupBy", "html", "Registry$1", "options2", "isPlaintext", "_a", "_a", "texts", "ele", "style", "root", "block", "html", "_a", "getServiceOrRegister", "end", "html", "block", "styles", "DatabaseModal", "styles", "__decorate", "URL_REGEX", "LinkPopover", "_a", "__decorate", "_a", "viewport", "AffineText", "__decorate", "AffineLink", "_a", "__decorate", "LinkMockSelection", "__decorate", "_a", "styles", "_a", "FormatQuickBar", "__decorate", "next", "_a", "query", "DEFAULT_PAGE_NAME", "AffineReference", "_a", "page", "root", "__decorate", "_a", "DragIndicator", "left", "top", "__decorate", "DragPreview", "__decorate", "DragHandle", "options", "_a", "top", "blockElements", "e", "__decorate", "styles", "shouldDisplayCard", "type", "BlockHub", "options", "_a", "__decorate", "Loader", "__decorate", "styles", "ImportPage", "_a", "JSZip", "file", "fileName", "_b", "styles", "__decorate", "MenuDivider", "__decorate", "RemoteSelection", "_a", "__decorate", "AffineSelectedBlocks", "__decorate", "_a", "performNativeCopy", "blocks", "block", "blockElements", "service", "styles", "DEFAULT_PAGE_NAME", "LinkedPagePopover", "styles", "__decorate", "updatePosition", "len", "Text", "styles", "SlashMenu", "next", "query", "item", "_a", "styles", "__decorate", "updatePosition", "Text", "_a", "block", "state", "left", "top", "bottom", "_a", "endModel", "selection", "intersects", "offset", "len", "block", "state", "viewport", "max", "auto", "autoScroll", "state", "state", "_a", "left", "_a", "state", "left", "top", "offset", "end", "block", "fn", "_a", "container", "state", "viewport", "element", "left", "top", "block", "start", "end", "DefaultPageBlockComponent", "right", "block", "_a", "state", "viewport", "max", "top", "left", "isEmpty", "__decorate", "EdgelessToolIconButton", "__decorate", "config", "EdgelessShapeMenu", "__decorate", "max", "EdgelessChangeShapeButton", "_a", "__decorate", "getMostCommonColor", "max", "EdgelessChangeBrushButton", "_a", "__decorate", "getMostCommonColor", "max", "getMostCommonLineStyle", "EdgelessChangeConnectorButton", "start", "end", "route", "_a", "__decorate", "max", "EdgelessChangeFrameButton", "_a", "__decorate", "EdgelessMoreButton", "_a", "__decorate", "join", "EdgelessComponentToolbar", "join", "__decorate", "HandleDirection", "e", "start", "end", "next", "point1", "EdgelessSelectedRect", "state", "createPopper", "_a", "__decorate", "EdgelessShapeToolButton", "_a", "__decorate", "EdgelessBrushMenu", "__decorate", "reference", "popper", "createPopper", "EdgelessBrushToolButton", "_a", "__decorate", "EdgelessConnectorMenu", "__decorate", "reference", "popper", "createPopper", "EdgelessConnectorToolButton", "_a", "__decorate", "EdgelessToolbar", "viewport", "options", "left", "top", "frame", "__decorate", "_a", "DefaultModeDragType", "block", "_a", "createDragHandle", "blockElements", "parent", "_a", "state", "_a", "viewport", "points", "filter", "viewport", "end", "viewport", "viewport", "end", "w", "h", "shouldFilterMouseEvent", "start", "end", "fn", "container", "state", "viewport", "_a", "EdgelessPageBlockComponent", "createDragHandle", "_a", "elements", "keys", "min", "max", "state", "start", "end", "len", "order", "options", "left", "top", "viewport", "__decorate", "options", "_a", "Text", "matches", "_a", "start", "offset", "block", "end", "_a", "html", "handleUnindent", "block", "end", "_a", "CounterBlock", "options", "__decorate", "len", "curRange", "normalize", "matches", "line", "offset", "_a", "delta", "length", "match", "line", "RichText", "__decorate", "end", "ParagraphBlockComponent", "_a", "__decorate", "block", "end", "len", "_a", "ListBlockComponent", "__decorate", "block", "end", "_a", "FrameBlockComponent", "__decorate", "block", "end", "DividerBlockComponent", "__decorate", "AffineCodeLine", "cache", "__decorate", "block", "end", "EmbedBlockComponent", "_a", "__decorate", "AffineImageBlockCircleLoading", "__decorate", "ELEMENT_TAG", "AffineImageBlockLoadingCard", "__decorate", "ELEMENT_TAG", "AffineImageBlockNotFoundCard", "__decorate", "ImageBlockComponent", "__decorate", "event", "ColumnInsertPosition", "SearchState", "SelectMode", "styles", "styles", "ColumnTypePopup", "__decorate", "EditColumnPopup", "createPopper", "_a", "styles", "__decorate", "ColumnDragIndicator", "__decorate", "ColumnDragPreview", "__decorate", "left", "right", "auto", "autoScroll", "stopPropagation", "_a", "length", "styles", "DatabaseColumnHeader", "reference", "createPopper", "target", "columnId", "length", "html", "style", "styles", "__decorate", "__decorate", "config", "DatabaseCellContainer", "html", "__decorate", "DatabaseTypePopup", "__decorate", "ToolbarActionPopup", "createPopper", "_a", "NewRecordPreview", "__decorate", "indicator", "_a", "top", "bottom", "stopPropagation", "length", "styles", "DatabaseToolbar", "createPopper", "_a", "__decorate", "options", "_a", "length", "text", "DatabaseTitle", "_a", "isEmpty", "__decorate", "CheckboxCell", "_a", "__decorate", "MultiSelectCell", "html", "__decorate", "MultiSelectCellEditing", "NumberCellEditing", "_a", "__decorate", "styles", "ProgressCellEditing", "left", "_a", "__decorate", "root", "TextCell", "Text", "_a", "html", "__decorate", "SelectOption", "__decorate", "CellLevelSelection", "state", "left", "top", "styles", "__decorate", "RowLevelSelection", "left", "top", "styles", "__decorate", "_a", "start", "left", "top", "_a", "fn", "SelectActionPopup", "__decorate", "styles", "SelectCellEditing", "_a", "nanoid", "property", "createPopper", "html", "__decorate", "SelectCell", "_a", "html", "__decorate", "root", "_a", "_a", "left", "right", "fn", "styles", "DatabaseTable", "state", "_a", "html", "__decorate", "styles", "DatabaseKanban", "html", "__decorate", "state", "block", "end", "_a", "DatabaseBlockComponent", "html", "__decorate", "Text", "styles", "_a", "Portal", "_a", "__decorate", "LangList", "_a", "__decorate", "start", "end", "block", "line", "_a", "CodeBlockComponent", "updatePosition", "_a", "lang", "richText", "vEditor", "next", "__decorate", "top", "lineNumberRender", "min", "max", "z", "px", "clamp", "TLBoundsEdge", "TLBoundsCorner", "SnapPoints", "result", "clamp", "min", "max", "clone", "z", "next", "points", "distance", "cache", "offset", "fn", "len", "length", "contains", "points", "_a", "options", "points", "points", "end", "controllers", "options", "points", "options", "options", "options", "points", "options", "render", "_a", "line", "start", "line", "points", "line", "polygon", "helper", "line", "helper", "line", "length", "offset", "helper", "offset", "line", "length", "start", "end", "helper", "line", "length", "start", "end", "helper", "curve", "left", "right", "r1", "r2", "points", "len", "start", "offset", "min", "max", "length", "len", "points", "points", "offset", "distance", "start", "end", "distance", "start", "config", "options", "points", "start", "distance", "config", "options", "points", "start", "Renderer", "offset", "dpr", "ib", "fb", "ia", "fa", "i", "c", "type", "Renderer", "_a", "len", "options", "contains", "state", "_a", "_a", "reference", "popper", "createPopper", "CopyIcon", "DuplicateIcon", "DeleteIcon", "BookmarkOperationMenu", "__decorate", "LinkIcon", "CaptionIcon", "EditIcon", "BookmarkToolbar", "_a", "__decorate", "BookmarkEditModal", "_a", "CloseIcon", "__decorate", "BookmarkCreateModal", "_a", "CloseIcon", "__decorate", "Loader", "__decorate", "block", "end", "BookmarkBlockComponent", "_a", "__decorate"]
}
